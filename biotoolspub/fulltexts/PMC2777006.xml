<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Archiving and Interchange DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName archivearticle.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Adv Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Adv Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">ABI</journal-id>
    <journal-title-group>
      <journal-title>Advances in Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1687-8027</issn>
    <issn pub-type="epub">1687-8035</issn>
    <publisher>
      <publisher-name>Hindawi Publishing Corporation</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">2777006</article-id>
    <article-id pub-id-type="doi">10.1155/2009/356141</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Analysis of High-Throughput Flow Cytometry Data Using plateCore</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Strain</surname>
          <given-names>Errol</given-names>
        </name>
        <xref ref-type="aff" rid="I1">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="cor1">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Hahne</surname>
          <given-names>Florian</given-names>
        </name>
        <xref ref-type="aff" rid="I2">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Brinkman</surname>
          <given-names>Ryan R.</given-names>
        </name>
        <xref ref-type="aff" rid="I3">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Haaland</surname>
          <given-names>Perry</given-names>
        </name>
        <xref ref-type="aff" rid="I4">
          <sup>4</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="I1"><sup>1</sup>FDA-Center for Food Safety and Nutrition, HFS-013 5100 Paint Branch Parkway, College Park, MD 20740, USA</aff>
    <aff id="I2"><sup>2</sup>Fred Hutchison Cancer Research Center, M2-B514 P.O. Box 19024 Seattle, WA 98109, USA</aff>
    <aff id="I3"><sup>3</sup>Terry Fox Laboratory, British Columbia Cancer Agency, 675 West 10th Avenue, Vancouver, BC, Canada V5Z 1L3</aff>
    <aff id="I4"><sup>4</sup>BD Technologies, 21 Davis Dr, Research Triangle Park, NC 27709, USA</aff>
    <author-notes>
      <corresp id="cor1">*Errol Strain: <email>estrain@gmail.com</email></corresp>
      <fn fn-type="other">
        <p>Recommended by Matt Wand</p>
      </fn>
    </author-notes>
    <pub-date pub-type="ppub">
      <year>2009</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>11</day>
      <month>10</month>
      <year>2009</year>
    </pub-date>
    <volume>2009</volume>
    <elocation-id>356141</elocation-id>
    <history>
      <date date-type="received">
        <day>2</day>
        <month>4</month>
        <year>2009</year>
      </date>
      <date date-type="accepted">
        <day>21</day>
        <month>7</month>
        <year>2009</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2009 Errol Strain et al.</copyright-statement>
      <copyright-year>2009</copyright-year>
      <license xlink:href="https://creativecommons.org/licenses/by/3.0/">
        <license-p>This is an open access article distributed under the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p>Flow cytometry (FCM) software packages from R/Bioconductor, such as flowCore and flowViz, serve as an open platform for development of new analysis tools and methods. We created plateCore, a new package that extends the functionality in these core packages to enable automated negative control-based gating and make the processing and analysis of plate-based data sets from high-throughput FCM screening experiments easier. plateCore was used to analyze data from a BD FACS CAP screening experiment where five Peripheral Blood Mononucleocyte Cell (PBMC) samples were assayed for 189 different human cell surface markers. This same data set was also manually analyzed by a cytometry expert using the FlowJo data analysis software package (TreeStar, USA). We show that the expression values for markers characterized using the automated approach in plateCore are in good agreement with those from FlowJo, and that using plateCore allows for more reproducible analyses of FCM screening data.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <sec id="sec1">
    <title>1. Introduction</title>
    <p>While there are a number of different software packages available for analysis of FCM data, these programs are often ill-suited to the development of new methods needed for analyzing high-throughput FCM studies. Flow Cytometry-High-Content Screening (FC-HCS) experiments generate large volumes of data [<xref rid="B9" ref-type="bibr">1</xref>, <xref rid="B10" ref-type="bibr">2</xref>], which requires a systematic approach to preprocessing, gating (i.e., filtering), and summarizing results for robust analyses. Current FC-HCS data analysis methods often use a combination of software packages for different parts of the analysis. The raw FCM files are processed and gated using FCM specific software, such as FlowJo or FCS Express (De Novo Software, USA). Results are then exported, and statistical analysis is performed in packages like MATLAB (USA) and R (<ext-link ext-link-type="uri" xlink:href="http://www.r-project.org/">http://www.r-project.org/</ext-link>) [<xref rid="B3" ref-type="bibr">3</xref>]. Unfortunately, this approach to FC-HCS analysis results in methods that are semiautomated at best, and they often require significant subjective and error-prone manual intervention to identify cells of interest [<xref rid="B7" ref-type="bibr">4</xref>]. It is therefore desirable to develop programmatic approaches to process FCM data so that FC-HCS analysis pipelines are robust, objective, and able to match the high-throughput capacity of modern cytometers.</p>
    <p>FCM packages available through the Bioconductor [<xref rid="B3" ref-type="bibr">3</xref>] project provide an open platform that can be used by cytometrists, bioinformaticians, and statisticians to collaboratively develop new methods for automated FC-HCS analysis. The basic data processing tools for importing, transforming, gating, and organizing raw FCM data are in the flowCore package [<xref rid="B4" ref-type="bibr">5</xref>] and the visualization functions are in flowViz [<xref rid="B8" ref-type="bibr">6</xref>]. The Bioconductor model for FCM data analysis facilitates the development of new analysis methods, since the overhead associated with accessing and visualizing FCM data is handled by flowCore and flowViz. The availability of flowCore and flowViz has enabled the creation of new tools for quality assessment of large FCM experiments, such as flowQ [<xref rid="B2" ref-type="bibr">7</xref>], and for model-based clustering and automated gating, such as flowClust [<xref rid="B6" ref-type="bibr">8</xref>].</p>
    <p>We have developed an R package (plateCore) that also takes advantage of the functionality in flowCore and flowViz to create methods and data structures for processing large, plate-based FCM data sets. Additionally, we have implemented new tools to make it easier to integrate textual descriptions of plate layouts and also to perform automated gating based on nonparametric analysis of negative control wells. This study presents results from an automated plateCore analysis of a PBMC lymphocyte BD FACS CAP (Combinational Antibody Profile) data set, which included 189 different antibody-dye conjugates and their controls arranged on 5 replicate 96-well plates. The output of plateCore was compared to an analysis by an expert cytometrist using FlowJo, one of the standard FCM analysis programs, to evaluate the performance of the automated approach.</p>
    <p>plateCore is not designed to be a graphical user interface driven tool, but rather to help develop a standardized platform for the analysis of FC-HCS data. These analyses often represent a collaborative effort between cytometry experts who generate the data and the quantitative individuals who help deal with the large volume information. In order for this collaboration to work, the cytometrists must have confidence in the results of the automated analysis. To this point, we demonstrate the equivalence of our results to those produced by an expert cytometrist using FlowJo.</p>
  </sec>
  <sec id="sec2">
    <title>2. Materials and Methods</title>
    <sec sec-type="subsection" id="sec2.1">
      <title>2.1. Flow Cytometry Data</title>
      <p>The data analyzed in this study was part of the initial set of experiments used to validate the BD FACS CAP platform. BD FACS CAP was designed as a cell characterization tool to screen for the presence of a large number of different human cell surface markers, and it was important to show that the assay was able to correctly identify positive and negatively staining markers on a well-studied cell population, such as PBMC lymphocytes. Previously frozen PBMC samples from two donors were analyzed on a BD FACS Calibur using BD FACS CAP staining plates. The analysis was performed on 96-well plates with 189 different antibodies arrayed three per well in 63 test wells, along with 30 isotype control wells and three unstained controls. The complete list of BD FACS CAP antibodies can be found at <ext-link ext-link-type="uri" xlink:href="http://www.bd.com/technologies/discovery_platform/BD_FACS_CAP.asp">http://www.bd.com/technologies/discovery_platform/BD_FACS_CAP.asp</ext-link>. FCM files for the five plates (two for Donor 1 and three for Donor 2) are available for download from <ext-link ext-link-type="uri" xlink:href="http://www.ficcs.org/data/plateData.tar.gz">http://www.ficcs.org/data/plateData.tar.gz</ext-link>.</p>
    </sec>
    <sec sec-type="subsection" id="sec2.2">
      <title>2.2. Data Analysis</title>
      <p>FCM output was analyzed in parallel using FlowJo and plateCore. Short descriptions of the steps in each software package are provided below. Additionally, the plateCore script used to perform the analysis is provided in Supplementary Materials available online at doi: 10.1155/2009/356141, and an example of the progression from raw FCM data files to a completed plateCore analysis for a single plate is shown in <xref ref-type="fig" rid="fig1">Figure 1</xref>.</p>
    </sec>
    <sec sec-type="subsection" id="sec2.3">
      <title>2.3. plateCore</title>
      <p>
        <statement id="head1">
          <title>(1) Template Construction</title>
          <p>A tab delimited text file was created that describes the contents of each well on the replicate plates. This information includes the marker name, fluorophore, antibody type, and the isotype group assignment. In this early version of BD FACS CAP the combination of antibodies in a well was based on available antibody-dye combinations. Newer versions of BD FACS CAP use biological information to assign markers to wells and are able extract more useful coexpression information.</p>
        </statement>
      </p>
      <p>
        <statement id="head2">
          <title>(2) Data Import</title>
          <p>FCM files for each plate were imported using flowCore. The import operation produces 5 flowSet objects, one for each plate, which were then integrated with the layout information in the template to create 5 flowPlates.</p>
        </statement>
      </p>
      <p>
        <statement id="head3">
          <title>(3) Gating</title>
          <p>flowPlates were processed using a combination of static gates (rectangleGate) and data driven gates (using norm2filter in flowCore) to pick out the lymphocytes in the forward (FSC) and side scatter (SSC) channels.</p>
        </statement>
      </p>
      <p>
        <statement id="head4">
          <title>(4) Plate Level Quality Assessment</title>
          <p>The quality of the data was then assessed by looking for fluidic events such as bubbles, pressure drops, or large aggregates that can shift the baseline fluorescence readings. Fluidic events can often be identified by plotting the empirical cumulative distribution function (ecdf) plots of FSC values for each well and looking for distributions shifted relative to other wells [<xref rid="B5" ref-type="bibr">9</xref>]. Based on the ecdf plots, several wells were further investigated by cytometry experts who determined that the shifts were in an acceptable range.</p>
        </statement>
      </p>
      <p>
        <statement id="head5">
          <title>(5) Isotype-Based Gating</title>
          <p>The threshold between positive and negative cells was determined using the isotype controls, which provided a gross estimate of nonspecific binding in the primary antibodies. One-dimensional gates were created using the isotype thresholds, and these gates were applied to identify cells that had specific staining in channels of interest. Details about the nonparametric isotype gating strategy implemented in plateCore are provided in the results section.</p>
        </statement>
      </p>
      <p>
        <statement id="head6">
          <title>(6) Summarization</title>
          <p>The 5 flowPlates were then aggregated into a single flowPlate using the fpbind operation from plateCore. Having the data in this format makes it easier to plot replicate wells from different plates, perform statistical analyses, and to export a single, experiment level results text file.</p>
        </statement>
      </p>
    </sec>
    <sec sec-type="subsection" id="sec2.4">
      <title>2.4. FlowJo</title>
      <p>
        <statement id="head7">
          <title>(1) Template Construction</title>
          <p>An XML-based FlowJo template was created where test wells and their corresponding isotype control well were assigned to one of 30 groups. Wells in each group contained similar sets of antibody-dye conjugates.</p>
        </statement>
      </p>
      <p>
        <statement id="head8">
          <title>(2) Data Import</title>
          <p>FCM files were imported using the FlowJo template.</p>
        </statement>
      </p>
      <p>
        <statement id="head9">
          <title>(3) Gating</title>
          <p>Lymphocytes were selected using polygonal gates in the FSC-SSC view.</p>
        </statement>
      </p>
      <p>
        <statement id="head10">
          <title>(4) Plate Level Quality Assessment</title>
          <p>Quality assessment was performed by looking for wells where the FSC-SSC location of the lymphocyte population shifted relative to other wells on a plate.</p>
        </statement>
      </p>
      <p>
        <statement id="head11">
          <title>(5) Isotype-Based Gating</title>
          <p>Event data for isotype wells was visualized on a log scale, and the expression threshold for each stained channel was set by picking a value that lies above the bulk of the events. Isotype gates were initially set so that approximately 0.5% of the events in the isotype well were above the threshold. These gates were then applied to the test wells, and the gates were moved up or down depending upon positive and negative test well populations. If the population of cells in positive wells was much higher than the isotype gate, then the gate was moved up to help reduce false positives associated with nonspecific staining. Similarly, if the isotype gate was higher than negative samples, the gate would be moved down to ensure that positive cells were classified correctly.</p>
        </statement>
      </p>
      <p>
        <statement id="head12">
          <title>(6) Summarization</title>
          <p>The percentage of cells above the threshold for each of the 189 antibodies was then exported for each plate, and these results were merged to create the analysis report.</p>
        </statement>
      </p>
    </sec>
  </sec>
  <sec id="sec3">
    <title>3. Results</title>
    <p>Although this study focuses on comparing two different FC-HCS analysis methods, it is important to consider the original goal of the experiment used to generate the data when interpreting the results. BD FACS CAP was designed to provide a standard assay platform for screening a large number of markers on many different cell types. The validation effort for BD FACS CAP included running the assay on well-characterized cell types to find markers with either positive or negative staining and comparing these results to published cell expression profiles in literature. The PBMC lymphocyte staining results presented in the following section represent one of the cell types used for validating the technology.</p>
    <sec sec-type="subsection" id="sec3.1">
      <title>3.1. FlowJo Output</title>
      <p>Descriptions of marker expression profiles for particular cell populations in flow cytometry often use terms like positive-negative, or bright-dim, to qualify the amount of target present. Since BD FACS CAP is a standard platform for screening a wide range of cell types, and antibody concentrations were not optimized for these particular PMBC samples, results are reported as the percentage of cells above the isotype gate rather than positive or negative. Followup studies, including single color titrations and competition experiments, are needed to definitively show that a marker is present. Markers that have been previously characterized using BD FACS CAP with ≥90% of the cells above the isotype threshold are usually confirmed as positive using titration and competition experiments, while staining in markers with ≤10% of cells above the isotype threshold is often the result of nonspecific binding (data not shown). Note that these percentages refer to the fraction of cells above the isotype threshold, but this does not necessarily imply heterogeneous staining in multiple populations.</p>
      <p>Automating the creation and modification of isotype gates made by cytometrists analyzing BD FACS CAP data using FlowJo is challenging. Cytometrists adjust gates based on expert knowledge about the performance of specific antibody types and dyes, or after identifying positive or negative test samples. If the isotype gate cut off the bottom portion of a positive cell population in a test well, then the gate was moved down. Similarly, if the isotype gate included too many cells from negative test wells, it was moved up. Results from the FlowJo-based gating of replicate PBMC plates are shown in <xref ref-type="fig" rid="fig2">Figure 2</xref>. Detailed results for each marker are not presented in this study, but since the majority of antibodies on the BD FACS CAP staining plate are known to bind different leukocytes, it is not surprising that a large fraction would be identified as positive on PBMCs. Markers such as CD44, CD45, CD47, and CD59 are broadly expressed on lymphocytes and were positive (&gt;99%) in this study.</p>
    </sec>
    <sec sec-type="subsection" id="sec3.2">
      <title>3.2. plateCore versus FlowJo</title>
      <p>Isotype controls are used to determine the threshold between background staining and specific binding of an antibody conjugate to its target. For the FlowJo analysis, the gate was initially set at the 99.5th quantile of the fluorescence signal in each stained channel of the isotype and then adjusted based on results from test wells. In plateCore, we have implemented two approaches to automatically creating gates based on negative controls. The first simply replicates the initial creation of the FlowJo gates and determines the threshold based on a set quantile, while the second uses a nonparametric approach where the gate (<italic>G</italic>
<sub><italic>ij</italic></sub>) for isotype <italic>i</italic>, channel <italic>j</italic> was set according to
<disp-formula id="EEq1"><label>(1)</label><mml:math id="M1"><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mtext>MFI</mml:mtext></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>4</mml:mn><mml:msub><mml:mrow><mml:mtext>MAD</mml:mtext></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math></disp-formula>
where MFI is the Median Fluorescence Intensity and MAD is Median Absolute Deviation in the raw data (linear scale). Although FCM fluorescence signals are approximately lognormal, as evident from density plots shown in this study (Figures <xref ref-type="fig" rid="fig5">5 </xref> and <xref ref-type="fig" rid="fig8">8</xref>), it is difficult to reliably make distributional assumptions, and the choice of 4 MADS represents a conservative attempt to set the gate above the 99th quantile of cells in the isotype stained wells.</p>
      <p>The nonparametric gating approach is obviously more robust to outliers than a static gate based on the 99.5th quantile, but in practice both methods produce very similar results if the data is good quality and there are a sufficient number of cells (over 1000) in the isotype well. The plateCore analysis presented in this study used the nonparametric approach to gating, and while this relatively simple method works surprisingly well for BD FACS CAP, advances in model-based clustering methods, such as those in flowClust, should lead to future performance improvements in automated gating.</p>
      <p>Comparisons of the output from the plateCore and FlowJo analyses are shown in <xref ref-type="fig" rid="fig3">Figure 3</xref>. Both methods produce nearly identical estimates for markers that were either clearly positive (≥99%) or clearly negative (≤1%), and R-squared values for all makers were between 0.83 and 0.93 (<xref ref-type="fig" rid="fig3">Figure 3</xref>). These cell populations are not close to the isotype threshold, and therefore different isotype gate settings have little or no effect on estimates of the percentage of cells above the gate. In situations where the isotype gate splits a test cell population, small changes to the gate can dramatically change these estimates. This effect is evident in the results from replicate plates using FlowJo (<xref ref-type="fig" rid="fig2">Figure 2</xref>) and in comparisons of FlowJo and plateCore (<xref ref-type="fig" rid="fig3">Figure 3</xref>), where estimates for markers having approximately 50% of the cells above the isotype gate are more variable than markers having ≤1% or ≥99%.</p>
      <p><xref ref-type="fig" rid="fig4">Figure 4 </xref>shows the plateCore and FlowJo comparison broken down by channel, and we can see that a large portion of the markers that disagree were stained with Phycoerythrin (PE) in FL2-H. plateCore estimates for antibodies conjugated to PE were almost always higher than FlowJo, indicating that the isotype gates in FlowJo were moved above their initial setting. Looking in detail at one PE conjugate where the two methods disagree, CD112 IgG1-PE, we can see how the gate for was changed in the manual analysis based on what looks like nonspecific staining in a related test sample, CD109 IgG1-PE (<xref ref-type="fig" rid="fig5">Figure 5</xref>). Since the gene for CD112 (PVRL2) has been shown to be expressed on a subset of lymphocytes in healthy donors using microarrays [<xref rid="B1" ref-type="bibr">10</xref>], the plateCore results showing 65%–92% of the cells above the isotype gate may actually represent specific staining. Unfortunately, increasing the isotype (IGg1-PE) threshold in FlowJo to eliminate what looks like background staining in CD109 also seems reasonable. More focused studies will have to be performed to determine if the staining for CD112, and other markers that disagreed, was positive or negative.</p>
    </sec>
    <sec sec-type="subsection" id="sec3.3">
      <title>3.3. Gating Quality Assessment</title>
      <p>Since we may not always have access to output from expert cytometrists to help determine if our automated gating is reasonable, we need alternative approaches to assessing the quality of our isotype-based gates. The strategy we used for this PBMC study involves visually checking density plots of the isotype wells for replicate plates and also comparing the percentage of cells above the isotype gates versus the MFI ratio to see if the gating was consistent across the experiment. Plates for each PBMC donor are purely technical replicates; so any differences should be due to variation in cell staining or changes in instrument settings.</p>
      <p>An example of the plots used to check replicate isotype gates is shown in <xref ref-type="fig" rid="fig6">Figure 6</xref>. In this case the threshold for one of the 3 replicate plates for donor 2 was lower than the other 2, indicating that the marker expression values from this isotype should be further evaluated. Fortunately, the difference is relatively small and did not change the estimate for the test well associated to this isotype (CXCR5 IgG1-Alexa 488). If the difference between replicates had been larger, we would have averaged the isotype thresholds from the remaining replicates and replaced the setting for plate 9207.</p>
      <p>The MFI ratio is defined as the ratio of the MFI for a marker to the MFI of its isotype control. Essentially, this ratio tells us how well separated a population of stained test cells is from the population of cells in the isotype control. The distance between these two populations is related to the percentage of cells above the isotype gate (<xref ref-type="fig" rid="fig7">Figure 7</xref>). To evaluate isotype gating at the experiment level for these 5 plates we performed a robust logistic regression for the percentage of positive cells on the MFI ratio and looked for values that were more than 2 standard residuals from the best fit line. We chose 2 standard residuals in a conservative attempt to ensure that any questionable automated gating decisions were examined in detail. Deviation from the best fit line can indicate either a problem with the isotype gate or that the sample has multiple cell populations (<xref ref-type="fig" rid="fig8">Figure 8</xref>). If the percentage of cells above the gate is significantly different than we would predict from the MFI ratio, then the isotype gate was checked. We note that this approach does not actually tell us if the gating was correct, simply whether or not the isotype gating was consistent.</p>
      <p>The bulk of the measured responses for the markers (927 out of 945) is within two standard residuals from the best fit line (<xref ref-type="fig" rid="fig7">Figure 7</xref>), which is surprising since the 189 different antibodies were conjugated to different fluorophores (either Alexa 488, FITC, PE, PerCP, APC, or Alexa 647) and matched against different isotypes (either IgG1, IgG2, IgG2a, IgG2b, IgG3, or IgM). We expected that differences in fluorescence intensity between dyes, and variation in nonspecific binding by different antibody types, would make direct comparisons difficult. The 18 values that were more than two standard deviations away from the line were examined in detail, and the isotype gate settings were found to be reasonable. In this case the flagging was the result of a positive and negative staining population of cells, which made the relationship between the MFI ratio and the fraction of cells above the isotype gate look very different than markers staining a single population. Density plots for one of the flagged markers, CD3, are shown in <xref ref-type="fig" rid="fig8">Figure 8</xref>.</p>
    </sec>
  </sec>
  <sec id="sec4">
    <title>4. Discussion</title>
    <p>We were motivated to use the flowCore package for BD FACS CAP data analysis by a desire to reduce subjectivity associated with isotype gating and also to make the more analyses more reproducible. We found that while flowCore was very powerful, both in terms of efficient use of memory for large data sets and an extensive collection of FCM functions, it did not scale well to BD FACS CAP experiments with multiple plates and a complex layout. plateCore was developed to make it easier to perform operations and produce visualizations that are technically challenging to do in flowCore and flowViz. For example, creating a set of threshold gates based on negative control wells, either isotype or unstimulated cells, and then applying those gates to test wells on a plate is a relatively common FC-HCS operation. In this study, the PBMC isotype gates were created and applied to test wells in two steps, using setControlGates and applyControlGates (<xref ref-type="fig" rid="fig1">Figure 1</xref>). Replicating this same operation in flowCore would require either many individual custom gating steps or users to develop their own methods that duplicate the functionality in plateCore.</p>
    <p>plateCore provided the ability to quickly analyze complex BD FACS CAP plates and produce useful visualizations (such as Figures <xref ref-type="fig" rid="fig2">2</xref>–<xref ref-type="fig" rid="fig8">8</xref>), which facilitated discussions with the cytometry experts and helped to develop approaches to automate the gating process. Since this was a screening assay, the goal was to quickly and reproducibly process a large volume of data to get an approximate expression value for each of the 189 human cell surface markers and then perform more in-depth analysis for markers that were of biological interest. Using plateCore, we were able to reduce the level subjectivity in setting isotype gates, eliminate mistakes associated with manual data annotation and export, and automate the creation of plots and data quality reports that summarized the experiment. Additionally, the plateCore scripts and experimental annotation can be shared with other cytometry groups, allowing them to reproduce our analysis.</p>
    <p>An important realization from our experience developing plateCore and analyzing BD FACS CAP experiments was that individual isotype gates should not be changed by cytometrists when performing FC-HCS experiments. The cytometrist does not have any information other than expert opinion about where a gate should go for a particular set of values, and making adjustments adds both bias and noise to the end result. In addition, the use of a more uniform gating approach facilitates the use of plateCore to combine and analyze results across many samples, which is one of the important new capabilities of this software. The functionality in plateCore enables cytometrists and statisticians to work together and make higher level decisions about gating strategies, based on methods like the gating quality assessment shown in <xref ref-type="fig" rid="fig7">Figure 7</xref>. Also, the gating in this experiment is relatively simple since we were only concerned with one dimension at a time. Developing new methods to reproducibly gate samples in three or more dimensions requires tools like flowCore and flowClust. plateCore provides infrastructure that makes the data available to quantitative scientists to further develop and apply these research tools.</p>
    <p>The complexity of large FCM experiments, like BD FACS CAP, highlights the difficulty of applying existing FCM analysis platforms to high-throughput studies. Generating and interpreting results from this PBMC study required extensive collaboration between flow cytometrists, bioinformaticians, and statisticians. At various points in the analysis, each group needed to access the raw data, annotation, and details about the experimental design. Providing this access using stand-alone FCM platforms is expensive in terms of the price of multiple software licenses and in time spent training statisticians and bioinformaticians to use the programs. Fortunately the Bioconductor FCM packages are modeled on standard data structures used for microarrays, which should already be familiar to most quantitative individuals working on high-throughput biological problems. In addition, this approach allows scientists to use modern software development tools, including version control software, to manage plateCore scripts and make the analysis reproducible in a way that is generally not possible with GUI-based tools. Finally, we found that flowCore, flowViz, and plateCore provide an open analysis platform that facilitates communication between the flow cytometrists generating the data and the computational experts analyzing the data.</p>
  </sec>
  <sec sec-type="supplementary-material" id="supplementary-material-sec">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="f1">
      <caption>
        <p>Supplementary materials include:</p>
        <p>1) the comma delimited percentagesRandFJ.csv file with the percentage of positive cells in each channel on each plate from both 
the plateCore and FlowJo analyses;</p>
        <p>2) a detailed vignette (plateCoreVig.pdf) showing how to use the plateCore package and how to replicate the analysis.</p>
      </caption>
      <media xlink:href="356141.f1.zip">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>The authors would like to thank Megan Gottlieb, Ruiling Yuan, and Ling Wang for collecting and sharing the data and for performing the FlowJo analysis and sharing the results with them in a compatible format. Their patience and expertise were critical to the development of plateCore. Support for this research was provided by Grant no. EB005034 from the National Institute of Biomedical Imaging and Bioengineering and by the Michael Smith Foundation for Health Resarch.</p>
  </ack>
  <ref-list>
    <ref id="B9">
      <label>1</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gasparetto</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gentry</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Sebti</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of compounds that enhance the anti-lymphoma activity of rituximab using flow cytometric high-content screening</article-title>
        <source>
          <italic>Journal of Immunological Methods</italic>
        </source>
        <year>2004</year>
        <volume>292</volume>
        <issue>1-2</issue>
        <fpage>59</fpage>
        <lpage>71</lpage>
        <pub-id pub-id-type="pmid">15350512</pub-id>
      </element-citation>
    </ref>
    <ref id="B10">
      <label>2</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Brinkman</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Gasparetto</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High-content flow cytometry and temporal data analysis for defining a cellular signature of graft-versus-host disease</article-title>
        <source>
          <italic>Biology of Blood and Marrow Transplantation</italic>
        </source>
        <year>2007</year>
        <volume>13</volume>
        <issue>6</issue>
        <fpage>691</fpage>
        <lpage>700</lpage>
        <pub-id pub-id-type="pmid">17531779</pub-id>
      </element-citation>
    </ref>
    <ref id="B3">
      <label>3</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gentleman</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Carey</surname>
            <given-names>VJ</given-names>
          </name>
          <name>
            <surname>Bates</surname>
            <given-names>DM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Bioconductor: open software development for computational biology and bioinformatics</article-title>
        <source>
          <italic>Genome Biology</italic>
        </source>
        <year>2004</year>
        <volume>5</volume>
        <issue>10, article R80</issue>
      </element-citation>
    </ref>
    <ref id="B7">
      <label>4</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Maecker</surname>
            <given-names>HT</given-names>
          </name>
          <name>
            <surname>Rinfret</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>D'Souza</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Standardization of cytokine flow cytometry assays</article-title>
        <source>
          <italic>BMC Immunology</italic>
        </source>
        <year>2005</year>
        <volume>6, article 13</volume>
      </element-citation>
    </ref>
    <ref id="B4">
      <label>5</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hahne</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Le Meur</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Brinkman</surname>
            <given-names>RR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>flowCore a bioconductor package for high throughput flow cytometry</article-title>
        <source>
          <italic>BMC Bioinformatics</italic>
        </source>
        <year>2009</year>
        <volume>10</volume>
        <issue>1, article 106</issue>
      </element-citation>
    </ref>
    <ref id="B8">
      <label>6</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sarkar</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Le Meur</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Gentleman</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Using flowViz to visualize flow cytometry data</article-title>
        <source>
          <italic>Bioinformatics</italic>
        </source>
        <year>2008</year>
        <volume>24</volume>
        <issue>6</issue>
        <fpage>878</fpage>
        <lpage>879</lpage>
        <pub-id pub-id-type="pmid">18245128</pub-id>
      </element-citation>
    </ref>
    <ref id="B2">
      <label>7</label>
      <element-citation publication-type="other">
        <person-group person-group-type="author">
          <name>
            <surname>Gentleman</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Hahne</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Kettman</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Le Meur</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Bioconductor package flowQ</article-title>
        <comment><ext-link ext-link-type="uri" xlink:href="http://www.bioconductor.org/">http://www.bioconductor.org/</ext-link>.</comment>
      </element-citation>
    </ref>
    <ref id="B6">
      <label>8</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lo</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Hahne</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Brinkman</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Gottardo</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>flowClust: a bioconductor package for automated gating of flow cytometry data</article-title>
        <source>
          <italic>BMC Bioinformatics</italic>
        </source>
        <year>2009</year>
        <volume>10</volume>
        <issue>1, article 145</issue>
      </element-citation>
    </ref>
    <ref id="B5">
      <label>9</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Le Meur</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Rossini</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Gasparetto</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Smith</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Brinkman</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Gentleman</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Data quality assessment of ungated flow cytometry data in high throughput experiments</article-title>
        <source>
          <italic>Cytometry A</italic>
        </source>
        <year>2007</year>
        <volume>71</volume>
        <issue>6</issue>
        <fpage>393</fpage>
        <lpage>403</lpage>
        <pub-id pub-id-type="pmid">17366638</pub-id>
      </element-citation>
    </ref>
    <ref id="B1">
      <label>10</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Critchley-Thorne</surname>
            <given-names>RJ</given-names>
          </name>
          <name>
            <surname>Yan</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Nacu</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Weber</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Holmes</surname>
            <given-names>SP</given-names>
          </name>
          <name>
            <surname>Lee</surname>
            <given-names>PP</given-names>
          </name>
        </person-group>
        <article-title>Down-regulation of the interferon signaling pathway in T lymphocytes from patients with metastatic melanoma</article-title>
        <source>
          <italic>PLoS Medicine</italic>
        </source>
        <year>2007</year>
        <volume>4</volume>
        <issue>5, article e176</issue>
      </element-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="fig1" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Typical FC-HCS plate workflow on the left and corresponding steps from a PBMC lymphocyte plateCore analysis on the right.</p>
    </caption>
    <graphic xlink:href="ABI2009-356141.001"/>
  </fig>
  <fig id="fig2" position="float">
    <label>Figure 2</label>
    <caption>
      <p>FlowJo estimates for the percentage of cells above the isotype threshold for 189 markers on replicate plates for donor 1 and donor 2. Estimates from markers where the center of the cell population was near the isotype threshold, around 50%, were more variable than samples which were clearly positive (≥99%) or negative (≤1%). The correlation for replicate plates was strong in both donors, with donor 1 at 0.92 and donor 2 at 0.98. Plate 9208 for donor 2 is not shown, since the results are very similar to 9206 and 9207.</p>
    </caption>
    <graphic xlink:href="ABI2009-356141.002"/>
  </fig>
  <fig id="fig3" position="float">
    <label>Figure 3</label>
    <caption>
      <p>Plot showing the percentage of cells above the isotype threshold from plateCore (<italic>x</italic>-axis) and FlowJo (<italic>y</italic>-axis) for each of the 189 markers on the 5 PBMC plates. If the two methods produce similar estimates, then the values should be near the red line (<italic>y</italic> = <italic>x</italic>). In plateCore the isotype threshold was determined using only information from the isotype control well, while the threshold in FlowJo may be adjusted after identifying either positively or negatively staining test samples. Generally, these FlowJo adjustments resulted in the isotype gate being set a higher level to exclude a negative test sample. The effect of increasing the isotype threshold can be seen in these plots, where most disagreements are cases where plateCore estimates are higher than FlowJo. Detailed plots for one marker, CD112 (red diamond), where the two methods give different results are shown in <xref ref-type="fig" rid="fig5">Figure 5</xref>.</p>
    </caption>
    <graphic xlink:href="ABI2009-356141.003"/>
  </fig>
  <fig id="fig4" position="float">
    <label>Figure 4</label>
    <caption>
      <p>Plot showing the percentage of cells above the isotype threshold from plateCore (<italic>x</italic>-axis) and FlowJo (<italic>y</italic>-axis) for donor 1 (red) and 2 (blue) in channels FL1-H through FL4-H. plateCore gating for Phycoerythrin (PE) conjugated antibodies (FL2-H) was consistently lower than FlowJo, resulting in more cells above the isotype gate.</p>
    </caption>
    <graphic xlink:href="ABI2009-356141.004"/>
  </fig>
  <fig id="fig5" position="float">
    <label>Figure 5</label>
    <caption>
      <p>Density plots showing the plateCore (solid black) and FlowJo (dashed black) isotype gates for CD112 and CD109, which shared the same isotype control (IgG1-PE). The plateCore and FlowJo analyses gave different estimates for CD112 (see <xref ref-type="fig" rid="fig3">Figure 3</xref>), which was caused by the gate being moved higher in FlowJo based on the presumed negative staining for CD109.</p>
    </caption>
    <graphic xlink:href="ABI2009-356141.005"/>
  </fig>
  <fig id="fig6" position="float">
    <label>Figure 6</label>
    <caption>
      <p>Density plot showing an example of one case where the isotype (IgG1-Alexa 488) gate settings differed between replicate plates for donor 2 (blue). In this case, the low setting for plate 9207 did not result in a significant difference between plates for the percentage of cells above the gate in the corresponding test well (CXCR5), so the gate was not modified. Plates 9206, 9207, and 9208 had 14%, 16%, and 15% percent of cells above the gate, respectively.</p>
    </caption>
    <graphic xlink:href="ABI2009-356141.006"/>
  </fig>
  <fig id="fig7" position="float">
    <label>Figure 7</label>
    <caption>
      <p>Quality of the automated gating was assessed by performing a robust logistic regression of the percentage of cells above the isotype gate on the log transformed MFI ratio and looking for estimates that were more than 2 standardized residuals away from the best fit line (red line). There were 18 estimates flagged in this study (red diamonds) where the value was different than we would predict from the MFI ratio. Detailed examination of these 18 cases showed that the isotype gate settings were reasonable, but they differed from other markers in that they had more than one population of stained cells. Sample density plots for one of these markers, CD3, are provided in <xref ref-type="fig" rid="fig8">Figure 8</xref>.</p>
    </caption>
    <graphic xlink:href="ABI2009-356141.007"/>
  </fig>
  <fig id="fig8" position="float">
    <label>Figure 8</label>
    <caption>
      <p>Density plot for CD3 (IgG1-Alexa 488), which was flagged for further evaluation by our gating quality assessment (<xref ref-type="fig" rid="fig7">Figure 7</xref>). The isotype gate settings look reasonable; however the MFI ratio for CD3 was very different from other markers that also had 75%–80% of their cells above the isotype gate. Looking at <xref ref-type="fig" rid="fig7">Figure 7</xref>, other markers with 75%–80% had MFI ratios near 5, while CD3 has an MFI ratio of 31–37. The flagging was the result of 2 cell populations for CD3, whereas most other markers stain a single population.</p>
    </caption>
    <graphic xlink:href="ABI2009-356141.008"/>
  </fig>
</floats-group>
