<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10359421</article-id>
    <article-id pub-id-type="pmid">37474509</article-id>
    <article-id pub-id-type="publisher-id">39985</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-39985-2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Identification of transcriptional programs using dense vector representations defined by mutual information with GeneVector</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Ceglia</surname>
          <given-names>Nicholas</given-names>
        </name>
        <address>
          <email>ceglian@mskcc.org</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Sethna</surname>
          <given-names>Zachary</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Freeman</surname>
          <given-names>Samuel S.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Uhlitz</surname>
          <given-names>Florian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bojilova</surname>
          <given-names>Viktoria</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2663-6288</contrib-id>
        <name>
          <surname>Rusk</surname>
          <given-names>Nicole</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Burman</surname>
          <given-names>Bharat</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1151-2450</contrib-id>
        <name>
          <surname>Chow</surname>
          <given-names>Andrew</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Salehi</surname>
          <given-names>Sohrab</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kabeer</surname>
          <given-names>Farhia</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Aparicio</surname>
          <given-names>Samuel</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6153-8793</contrib-id>
        <name>
          <surname>Greenbaum</surname>
          <given-names>Benjamin D.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6402-523X</contrib-id>
        <name>
          <surname>Shah</surname>
          <given-names>Sohrab P.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>McPherson</surname>
          <given-names>Andrew</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Computational Oncology, Department of Epidemiology and Biostatistics, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Immuno-Oncology Service, Human Oncology and Pathogenesis Program, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Hepatopancreatobiliary Service, Department of Surgery, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Department of Medicine, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Department of Medicine, Thoracic Oncology Service, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="GRID">grid.248762.d</institution-id><institution-id institution-id-type="ISNI">0000 0001 0702 3000</institution-id><institution>Department of Molecular Oncology, British Columbia Cancer Research Centre, Vancouver, </institution></institution-wrap>British Columbia, Canada </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="GRID">grid.17091.3e</institution-id><institution-id institution-id-type="ISNI">0000 0001 2288 9830</institution-id><institution>Department of Pathology and Laboratory Medicine, </institution><institution>University of British Columbia, Vancouver, </institution></institution-wrap>British Columbia, Canada </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="GRID">grid.5386.8</institution-id><institution-id institution-id-type="ISNI">000000041936877X</institution-id><institution>Physiology, Biophysics &amp; Systems Biology, </institution><institution>Weill Cornell Medicine, Weill Cornell Medical College, </institution></institution-wrap>New York, NY USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>20</day>
      <month>7</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>7</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>4400</elocation-id>
    <history>
      <date date-type="received">
        <day>8</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>4</day>
        <month>7</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Deciphering individual cell phenotypes from cell-specific transcriptional processes requires high dimensional single cell RNA sequencing. However, current dimensionality reduction methods aggregate sparse gene information across cells, without directly measuring the relationships that exist between genes. By performing dimensionality reduction with respect to gene co-expression, low-dimensional features can model these gene-specific relationships and leverage shared signal to overcome sparsity. We describe GeneVector, a scalable framework for dimensionality reduction implemented as a vector space model using mutual information between gene expression. Unlike other methods, including principal component analysis and variational autoencoders, GeneVector uses latent space arithmetic in a lower dimensional gene embedding to identify transcriptional programs and classify cell types. In this work, we show in four single cell RNA-seq datasets that GeneVector was able to capture phenotype-specific pathways, perform batch effect correction, interactively annotate cell types, and identify pathway variation with treatment over time.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">In single-cell RNA-seq analyses, it would be critical to measure the relationships between genes. Here, the authors develop a framework for single-cell dimensionality reduction that incorporates gene-specific relationships - GeneVector -, and use it for tasks such as annotating cell types and analysing pathway variation after treatment.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Machine learning</kwd>
      <kwd>Software</kwd>
      <kwd>Cancer genomics</kwd>
      <kwd>Tumour heterogeneity</kwd>
      <kwd>Transcriptomics</kwd>
    </kwd-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Maintenance of cell state and execution of cellular function are based on coordinated activity within networks of related genes. To approximate these connections, transcriptomic studies have conceptually organized the transcriptome into sets of co-regulated genes, termed gene programs<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> or metagenes<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. The first intuitive step to identify such co-regulated genes is the reduction of dimensionality for sparse expression measurements: high dimensional gene expression data is compressed into a minimal set of explanatory features that highlight similarities in cellular function. However, to map existing biological knowledge to each cell, the derived features must be interpretable at the gene level.</p>
    <p id="Par4">To find similarities in lower dimensions, biology can borrow from the field of natural language processing (NLP). NLP commonly uses dimensionality reduction to identify word associations within a body of text<sup><xref ref-type="bibr" rid="CR3">3</xref>,<xref ref-type="bibr" rid="CR4">4</xref></sup>. To find contextually similar words, NLP methods make use of vector space models to represent similarities in a lower dimensional space. Similar methodology has been applied to bulk RNA-seq expression for finding co-expression patterns<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>. Inspired by such work, we developed a tool that generates gene vectors based on single cell RNA (scRNA)-seq expression data. While current methods reduce dimensionality with respect to sparse expression across each cell, our tool produces a lower dimensional embedding with respect to each gene. The vectors derived from GeneVector provide a framework for identifying metagenes within a gene co-expression graph and relating these metagenes back to each cell using latent space arithmetic.</p>
    <p id="Par5">The most pervasive method for identifying the sources of variation in scRNA-seq studies is principal component analysis (PCA)<sup><xref ref-type="bibr" rid="CR6">6</xref>–<xref ref-type="bibr" rid="CR8">8</xref></sup>. The relationship of principal components to gene expression is linear, allowing lower dimensional structure to be directly related to variation in expression. A PCA embedding is an ideal input for building a nearest neighbor graph for unsupervised clustering algorithms<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> and visualization methods including t-SNE<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and UMAP<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>. However, the assumption of a continuous multivariate gaussian distribution creates distortion in modeling read counts generated by a true distribution that is over-dispersed, possibly zero-inflated<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, with positive support and mean close to zero<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. Despite such issues, gene programs generated from PCA loadings have been used to generate metagenes that explain each principal component<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. While these loadings highlight sets of genes that explain each orthogonal axis of variation, pathways and cell type signatures can be conflated within a single axis.</p>
    <p id="Par6">In addition to PCA, more sophisticated methods have been developed to better handle the specific challenges of scRNA data. The single cell variational inference (scVI) framework<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> generates an embedding using non-linear autoencoders that can be used in a range of analyses including normalization, batch correction, gene-dropout correction, and visualization. While scVI embeddings show improved performance over traditional PCA-based analysis in these tasks, they have a non-linear relationship to the original count matrix that may distort the link between structure in the generated embedding and potentially identifiable gene programs<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. A subsequent method uses a linearly decoded variational autoencoder (LDVAE), which combines a variational autoencoder with a factor model of negative binomial distributed read counts to learn an interpretable linear embedding of cell expression profiles<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. However, the relationship between gene expression and cell representation is still tied to correlated variation across cells, which may confound co-varying pathway and phenotypic signatures.</p>
    <p id="Par7">Recognizing the importance of modeling the non-linearity of gene expression and the complexity of statistical dependencies between genes, several methods have adopted information theoretical approaches. Many of these methods use mutual information (MI), an information theoretic measure of the statistical dependence between two variables. ARACNE<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> uses MI to prune independent and indirectly interacting genes during construction of a gene regulatory network from microarray expression data. PIDC<sup><xref ref-type="bibr" rid="CR16">16</xref></sup> identifies regulatory relationships using partial information decomposition (PID), a measure of the dependence between triples of variables. The authors apply PIDC to relatively high-depth single-cell qPCR datasets and restrict their analysis to on the order of hundreds of genes. More recently, IQCELL<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> uses MAGIC<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> to impute missing gene expression, builds a GRN from pairwise MI between genes, and applies a series of filters to produce a GRN composed of only functional relationships. The authors use IQCELL to identify known causal gene interactions in scRNA-seq data from mouse T-cell and red blood cell development experiments. Because of the success of these methods, we hypothesized that MI could be combined with vector space models to produce a meaningful low dimensional representation of genes from scRNA data.</p>
    <p id="Par8">In this work, we present GeneVector (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) as a framework for generating low dimensional embeddings constructed from the mutual information between genes. GeneVector summarizes co-expression of genes as mutual information between the probability distribution of read counts across cells. We showcase GeneVector on four scRNA datasets produced from a diverse set of experiments: peripheral blood mononuclear cells (PBMCs) subjected to interferon beta stimulation<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, the Tumor Immune Cell Atlas (TICA)<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, treatment naive multi-site samples from High Grade Serous Ovarian Cancers (HGSOC)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> and a time series of cisplatin treatment in patient-derived xenografts (PDX) of triple negative breast cancer (TNBC)<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. We first confirm GeneVector’s ability to identify putatively co-regulated gene pairs from sparse single cell expression measurements using the TICA and PBMC datasets. We demonstrate that latent space arithmetic can be used to accurately label cell types in the TICA dataset and validate our cell type predictions against published annotations. Next, we show that GeneVector can identify metagenes corresponding to cell-specific transcriptional processes in PBMCs, including interferon activated gene expression (ISG). We use vector space arithmetic to directly map metagenes to site specific changes in primary and metastatic sites in the HGSOC dataset, capturing changes in MHC class I expression and epithelial-mesenchymal transition (EMT). Finally, we show GeneVector can identify cisplatin treatment dependent transcriptional programs related to TGF-beta in TNBC PDXs.<fig id="Fig1"><label>Fig. 1</label><caption><title>GeneVector Framework.</title><p>Overview of GeneVector framework starting from single cell read counts. Mutual information is computed on the joint probability distribution of read counts for each gene pair. Each pair is used to train a single layer neural network where the MSE loss is evaluated from the model output (<bold>w</bold><sub>1</sub><sup>T</sup><bold>w</bold><sub>2</sub>) with the mutual information between genes. From the resulting weight matrix, a gene embedding, cell embedding, and co-expression similarity graph are constructed. Using vector space arithmetic, downstream analyses include identification of cell-specific metagenes, batch effect correction, and cell type classification.</p></caption><graphic xlink:href="41467_2023_39985_Fig1_HTML" id="d32e538"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Defining the GeneVector framework</title>
      <p id="Par9">We trained a single layer neural network over all gene pairs to generate low dimensional gene embeddings and identify metagenes from a co-expression similarity graph. The input weights (<bold>w</bold><sub>1</sub>) and output weights (<bold>w</bold><sub>2</sub>) are updated with adaptive gradient descent (ADADELTA)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. Gene co-expression relationships are defined using mutual information (Methods<bold>:</bold> Mutual Information) computed from a joint probability distribution of expression counts. Training loss is evaluated as the mean squared error of mutual information with the model output, defined as <bold>w</bold><sub>1</sub><sup>T</sup><bold>w</bold><sub>2</sub>. The final latent space is a matrix defined as a series of vectors for each gene.</p>
      <p id="Par10">Gene vectors produced by the framework are useful for several fundamental gene expression analyses. Gene vectors weighted by expression in each cell are combined to generate the cell embedding analysis of cell populations and their relationships to experimental covariates. The cell embedding can be batch corrected by using vector arithmetic to identify vectors that represent batch effects and then shift cells in the opposite direction (Methods<bold>:</bold> Batch correction). A co-expression graph is constructed in which each node is defined as a gene and each edge is weighted by cosine similarity. After generating the co-expression graph, we use Leiden clustering<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> to identify metagene clusters. Further downstream analysis of the cell embedding includes phenotype assignment based on sets of marker genes and computation of the distances between cells and metagenes to highlight changes related to experimental covariates (Fig. <xref rid="Fig1" ref-type="fig">1</xref>).</p>
      <p id="Par11">To perform cell type assignment, a set of known marker genes is used to generate a representative vector for each cell type, where each gene vector is weighted by the normalized and log-transformed gene expression. The cosine similarity of each possible phenotype is computed between the cell vector and the marker gene vector. SoftMax is applied to cosine distances to obtain a pseudo-probability over each phenotype (Methods: Cell type assignment). Discrete labels can be assigned to cells by selecting the phenotype corresponding to the maximum pseudo-probability. More generally, gene vectors can be composed together to describe interesting gene expression features. Cell or gene vectors can then be compared against these feature vectors to evaluate the relevance of that feature to a given cell or gene (Methods: Generation of Predictive Genes).</p>
    </sec>
    <sec id="Sec4">
      <title>Robust inference of gene co-regulation with GeneVector</title>
      <p id="Par12">Our model relies on the advantages of mutual information to define relationships between genes, as opposed to other distance metrics. To evaluate how MI contributes to the observed performance of the model, we first validated that the vectors inferred by GeneVector capture semantic qualities of genes including pathway memberships and regulatory relationships. Specifically, we assessed the extent to which pairs of genes within the same pathway, or expressed within the same cell types, produced similar vector representations in the PBMC dataset. As a ground truth we computed, for each gene pair, the number of combined pathways from Reactome<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> and MSigDB<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup> cell type signatures (C8) for which both genes were members. In addition to training GeneVector using raw read counts with an MI target, we trained GeneVector using normalized and log-transformed read counts on Pearson correlation coefficient to evaluate the relative benefit of MI on the accuracy of the model output. For both the correlation and MI based models, cosine similarities between gene vectors showed a stronger relationship with the number of shared pathways and cell type signatures than randomly shuffled gene pairs (Fig. <xref rid="Fig2" ref-type="fig">2A, C</xref>). Comparing the MI model and the correlation model directly, the MI model produced a much stronger relationship than the correlation based model (r<sup>2</sup> = 0.233 vs. r<sup>2</sup> = 0.093, Fig. <xref rid="Fig2" ref-type="fig">2B, D</xref>). To provide a pathway specific example, we found that the most similar genes by cosine similarity to <italic>IFIT1</italic> (a known interferon stimulated gene) using the correlation objective were less coherent in terms of ISG pathway membership signal (6 of 16 genes were in the Interferon Signaling Reactome pathway R-HSA-913531) (Fig. <xref rid="Fig2" ref-type="fig">2E</xref>) than with mutual information (12 of 16 genes) (Fig. <xref rid="Fig2" ref-type="fig">2F</xref>). The greater proportion of interferon stimulated pathway genes with high similarity to <italic>IFIT1</italic> using a mutual information objective function (Fig. <xref rid="Fig2" ref-type="fig">2F</xref> vs. <xref rid="Fig2" ref-type="fig">2E</xref>) is consistent with the improved correlation between pathway co-membership and cosine similarity over the Pearson correlation coefficient objective (Fig. <xref rid="Fig2" ref-type="fig">2D</xref> vs. <xref rid="Fig2" ref-type="fig">2FB</xref>).<fig id="Fig2"><label>Fig. 2</label><caption><title>Comparison of Results using Mutual Information.</title><p><bold>A</bold>–<bold>D</bold> Pathway co-membership vs. cosine similarity between gene vectors for all gene pairs in PBMCs. Each point represents one gene pair, and plots show the number of pathways (combined Reactome and MSigDB cell type signatures [C8]) that contain both genes (y-axis) and the cosine distance between the two genes (x-axis). The results show both correlation <bold>A</bold>, <bold>B</bold> and MI (Mutual Information) <bold>C</bold>, <bold>D</bold> based GeneVector. In addition to a standard set of results <bold>B</bold>, <bold>D</bold>, a baseline relationship between pathway co-membership and cosine similarity is established by performing an identical analysis over randomly shuffled gene <bold>A</bold>, <bold>C</bold>. <bold>E</bold> Top 16 most similar genes by cosine similarity to IFIT1 using correlation coefficient. Genes in the interferon signaling pathway are colored orange. <bold>F</bold> Top 16 most similar genes to IFIT1 after training GeneVector using mutual information shows a higher number of interferon signaling pathway genes. <bold>G</bold>, <bold>H</bold> Cosine similarity and Pearson correlation coefficient for un-annotated gene pairs (<italic>n</italic> = 314090), ChIP-Seq annotated TF-targets pairs (<italic>n</italic> = 1275), and literature annotated activator (<italic>n</italic> = 26) or repressor (<italic>n</italic> = 26) TF-target pairs. The center of the box plot is denoted by the median, a horizontal line dividing the box into two equal halves. The bounds of the box are defined by the lower quartile (25th percentile) and the upper quartile (75th percentile). The whiskers extend from the box and represent the data points that fall within 1.5 times the interquartile range (IQR) from the lower and upper quartiles. Any data point outside this range is considered an outlier and plotted individually. Significance assessed using Mann-Whitney-Wilcoxon two-sided test. <bold>I</bold> Cosine similarity versus correlation coefficient for gene pairs in the TICA (Tumor Immune Cell Atlas) dataset with TF-target gene pairs highlighted (blue) and colored by activator/repressor status (green/orange respectively). <bold>J</bold>, <bold>K</bold> Linear regression of mean log-normalized expression per cell type±95% confidence interval for repressor TF-target pair <italic>SOCS3</italic>-<italic>STAT4</italic> and activator TF-target pair <italic>KLF-THBD</italic>, respectively. <bold>L</bold> Mean log-normalized expression for <italic>SOCS3-STAT4</italic> and <italic>KLF4-THBD</italic> across annotated cell types. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig2_HTML" id="d32e738"/></fig></p>
      <p id="Par13">Next, we sought to understand whether GeneVector was able to capture relationships between genes with known interactions such as transcription factors (TF) and their targets. GeneVector cosine similarities of TF-target pairs annotated based on ChIP-Seq data<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> were significantly increased relative to un-annotated gene pairs in the TICA dataset (Fig. <xref rid="Fig2" ref-type="fig">2G</xref>). We also considered literature annotated activator-target and repressor-target TF-target gene pairs<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. As expected, activator-target pairs showed increased cosine similarity above unannotated pairs. Importantly, repressor-target pairs showed an equally strong increase in cosine similarity above unannotated pairs highlighting GeneVector’s ability to identify a diversity of statistical dependencies between co-regulated genes. By comparison, Pearson correlation coefficients of ChIP-seq annotated TF-target pairs were not significantly different from unannotated gene pairs (Fig. <xref rid="Fig2" ref-type="fig">2H</xref>). Both activator-target and repressor-target pairs were significantly different from unannotated pairs, though correlation was on-average positive for both repressor-target and activator-target pairs (Fig. <xref rid="Fig2" ref-type="fig">2H</xref>). In fact, while many repressor-target pairs had high cosine similarity indicative of a meaningful regulatory relationship, their correlation coefficients, computed with normalized and log-transformed counts, were always positive (Fig. <xref rid="Fig2" ref-type="fig">2I</xref>). For example, <italic>SOCS3</italic>-<italic>STAT4</italic> exhibited the lowest correlation of annotated repressor-target pairs (<italic>r</italic><sup>2</sup> = 0.017) and aggregating normalized and log-transformed expression across cell types showed an absence of any relationship between these genes (Fig. <xref rid="Fig2" ref-type="fig">2J</xref>). In contrast, analysis of activator-target pair <italic>KLF4</italic>-<italic>THBD</italic> revealed a positive correlation driven by co-expression in myeloid cells and T cells (Fig. <xref rid="Fig2" ref-type="fig">2K</xref>). This relationship is further evidenced when looking at the expression in more detailed cell type annotations (Fig. <xref rid="Fig2" ref-type="fig">2L</xref>). Identification of mutually exclusive expression is a theoretical benefit of correlation-based similarity measures, however, the sparsity of scRNA likely results in positive or low correlation even for known examples of mutual exclusivity. In summary, the vector space produced by GeneVector successfully recovers the latent similarities between functionally related genes, including negative regulators and their targets, overcoming the sparsity of scRNA data that confounds simpler approaches.</p>
    </sec>
    <sec id="Sec5">
      <title>Fast and accurate cell type classification using GeneVector</title>
      <p id="Par14">Comparative analysis of gene expression programs across large cohorts of patients can potentially identify transcriptional patterns in common cell types shared between many cancers. However, classification of cell types using methods such as CellAssign<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> are computationally expensive. Furthermore, the large number of covariates in these datasets makes disentangling patient-specific signals from disease and therapy difficult. GeneVector provides a fast and accurate method of cell type classification. We perform cell type classification on a subset of 23,764 cells from the Tumor Immune Cell Atlas (TICA) composed of 181 patients and 18 cancer types<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>. The dataset was subset to 2000 highly variable genes and the unnormalized read counts were used train GeneVector. Cell vectors were generated by weighting each gene vector by the normalized and log-transformed expression per cell. Cell types were summarized into three main immune cell types: T cells, B/Plasma, and Myeloid cells (Fig. <xref rid="Fig3" ref-type="fig">3A</xref>) from the original annotations (Fig. <xref rid="Fig3" ref-type="fig">3B</xref>). We selected a set of gene markers for each cell type (T cells: <italic>CD3D</italic>, <italic>CD3G</italic>, <italic>CD3E</italic>, <italic>TRAC</italic>, <italic>IL32</italic>, <italic>CD2</italic>; B cells: <italic>CD79A</italic>, <italic>CD79B</italic>, <italic>MZB1</italic>, <italic>CD19</italic>, <italic>BANK1</italic>; and Myeloid cells: <italic>LYZ</italic>, <italic>CST3</italic>, <italic>AIF1</italic>, <italic>CD68</italic>, <italic>C1QA</italic>, <italic>C1QB</italic>, <italic>C1QC</italic>) based on signatures obtained from CellTypist<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. For each phenotype and each cell, we computed the cosine distance to the log-normalized expression weighted average of the marker gene vectors. The pseudo-probabilities for the three cell types are generated by applying a SoftMax function to the set of cosine distances. The maximum pseudo-probability is used to classify each cell into T cell, B/Plasma, or Myeloid (Fig. <xref rid="Fig3" ref-type="fig">3C</xref>).<fig id="Fig3"><label>Fig. 3</label><caption><title>GeneVector Accurately Classifies Cells in TICA Cell Atlas.</title><p><bold>A</bold> Cells annotated by cell type summarized from the original TICA provided annotations. <bold>B</bold> Original annotations provided in TICA (Tumor Immune Cell Atlas). <bold>C</bold> GeneVector classification results for each cell type. <bold>D</bold> Confusion matrix comparing GeneVector classification with summarized cell types. <bold>E</bold> Confusion matrix using the same gene markers with CellAssign shows decreased performance in myeloid cells. <bold>F</bold> Pseudo-probability values for each summarized cell type. <bold>G</bold> Marker gene log-normalized expression over all cells grouped by GeneVector classification. <bold>H</bold> Original annotations reassigned by GeneVector. <bold>I</bold> Marker gene mean log-normalized expression for cell type reassignments highlights misclassifications in B/Plasma cells and doublet transcriptional signatures in T and myeloid cells. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig3_HTML" id="d32e910"/></fig></p>
      <p id="Par15">To assess performance, we computed accuracy against the coarse labels in a confusion matrix as the percentage of correctly classified cells over the total number cells for each summarized cell type. We found 97.1% of T cells, 95% of myeloid cells, and 94.3% of B/Plasma cells were correctly classified with respect to the original annotations (Fig. <xref rid="Fig3" ref-type="fig">3D</xref>). Additionally, we classified cells using the same marker genes with CellAssign and found significantly decreased performance in the classification of myeloid cells (85.6%) (Fig. <xref rid="Fig3" ref-type="fig">3E</xref>). Overall, the percentage of cells misclassified using GeneVector (3.977%) showed improvement over CellAssign (7.54%). Using the pseudo-probabilities, GeneVector can highlight cells that share gene signatures including plasmacytoid dendritic cells (pDCs), where cell type definition is difficult<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> (Fig. <xref rid="Fig3" ref-type="fig">3F</xref>). For each cell type, we validated that the classified cells are indeed expressing the supplied markers by showing the normalized and log-transformed expression for each marker grouped by classified cell type (Fig. <xref rid="Fig3" ref-type="fig">3G</xref>). For those cells GeneVector reassigned from the original annotations (Fig. <xref rid="Fig3" ref-type="fig">3H</xref>), we examined the mean normalized and log-transformed expression per marker gene and found that many of these cells appear misclassified in original annotations (Fig. <xref rid="Fig3" ref-type="fig">3I</xref>). Cells originally annotated as T cells that were reassigned as B/Plasma by GeneVector show high expression for only B/Plasma markers (<italic>CD19</italic>, <italic>BANK1</italic>, <italic>CD79A</italic>, and <italic>CD79B</italic>). Additionally, there is evidence that many of these reassigned cells may be doublets. B/Plasma cells reassigned to T or myeloid cells show simultaneous expression of both gene markers. While any computational cell type classification cannot be considered ground truth, cell type assignment with GeneVector is an improvement over CellAssign and demonstrates sensitivity to cells that express overlapping cell type transcriptional signatures.</p>
      <p id="Par16">Next, we benchmarked GeneVector’s cell type assignment performance with respect to four input types: raw read counts, log-transformed raw counts, normalized total counts per cell, and normalized total counts per cell with log-transformation. We evaluated each approach on the original TICA dataset, in addition to a series of datasets for which we artificially generated a library size batch effect by down sampling reads in subsets of cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1A–E</xref>). Performance was evaluated by calculating cell type assignment accuracy and by ranking gene pairs by cosine similarity for annotated co-expressed and mutually exclusive gene pairs using CellTypist (Methods: Coexpressed and Mutually Exclusive Markers)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. Evaluating gene pair rankings on repeat trained models of the full TICA dataset, we find that all four preprocessing types show a similar ranking of co-expressed gene pairs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1A</xref>, left). Interestingly, raw counts produce significantly lower rankings for mutually exclusive gene pairs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1A</xref>, right). When introducing an artificial batch effect, we find that raw counts generate significantly lower rankings for mutually exclusive marker pairs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2B</xref>). Next, we compared the cell type prediction accuracy between normalization procedures using the same gene markers used to perform cell type prediction in the main results section on both the full and subset datasets with artificial batch effect. Raw counts significantly outperformed all other preprocessing inputs by a large margin, with both normalized and log-normalized showing very poor performance (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2C, D</xref>). Our results suggest that normalization increases association between pairs of genes with mutually exclusive expression, resulting in negative downstream performance of cell type prediction. Cell typing appears to be sensitive to mutual exclusivity of cell type markers, and normalization produces slight increases in cosine similarity between gene vectors of mutually exclusive genes resulting in poor cell typing accuracy.</p>
      <p id="Par17">After learning the gene embedding, GeneVector allows rapid testing of different marker genes and phenotypes in exploratory analysis settings. Increased performance in classification is important given the large variation of markers used to define the same phenotypes across different studies. Cell type prediction can be recomputed interactively within a Jupyter notebook within twenty seconds for even large datasets on most machines (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). An additional advantage of having a probability is the ability to map genes from known pathways to a continuous value in each cell. In both phenotype and pathway, demonstration of continuous gradients across cells provides a measure of change and activation that cannot be seen from unsupervised clustering.</p>
    </sec>
    <sec id="Sec6">
      <title>Comparison of Methods in Identification of Interferon Metagenes in 10k Human PBMCs</title>
      <p id="Par18">To identify cell-specific metagenes related to interferon beta stimulation and compare with transcriptional programs identified by PCA and LDVAE loadings, we trained GeneVector using peripheral blood mononuclear cells (PBMCs) scRNA-seq data from 6855 quality control filtered cells composed of an interferon beta stimulated sample and a control sample<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. The raw count matrix was subset to 1000 highly variable genes using the Seurat V3 method<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> as implemented in Scanpy<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. We used previously annotated cell types generated from unsupervised clustering as ground truth labels<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The cell embedding used for batch correction was generated by weighting gene vectors by the normalized, log-transformed expression in each cell. A comparison of the uncorrected UMAP embedding (Fig. <xref rid="Fig4" ref-type="fig">4A</xref>) and subsequent GeneVector-based batch correction (Fig. <xref rid="Fig4" ref-type="fig">4B</xref>) demonstrates correction in the alignment of cell types between the two conditions. However, in contrast to batch correction using Harmony<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> (Fig. <xref rid="Fig4" ref-type="fig">4C</xref>), not all variation is lost between the interferon beta stimulated and control cells. Specifically, GeneVector does not align myeloid cell types, suggesting a larger effect of the interferon beta stimulation treatment in these cells. Finally, we explored the impact of cell type composition on batch correction performance and found that CD14+ Monocytes had the largest batch silhouette coefficient, indicating that stimulated and control Monocytes differed the most across cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6G</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Comparing Methods with Interferon Beta Stimulated 10 K PBMC.</title><p><bold>A</bold> Uncorrected GeneVector UMAPs showing stimulated condition (left) and cell type annotation (right) on 10k PBMCs with control and interferon beta stimulated cells. <bold>B</bold> GeneVector batch corrected UMAPs showing stimulated condition (left) and cell type annotation (right) indicated stronger interferon-beta stimulated response in myeloid cells. <bold>C</bold> Harmony batch correction applied to normalized expression eliminates all variation related to interferon beta stimulation. <bold>D</bold> Most similar genes by cosine similarity to <italic>IFIT1</italic> includes genes found in Reactome interferon related pathways. <bold>E</bold> Gene embedding UMAP highlighting an ISG (interferon stimulated genes) metagene that includes genes most similar to <italic>IFIT1</italic>. <bold>F</bold> Scaled log-normalized expression of ISG (interferon stimulated gene) metagene shows increased expression across stimulated cells without cell type specific effects. <bold>G</bold> PCA embedding colored by cell type (left) and stimulation (right). <bold>H</bold> Top genes by contribution to variance indicates PC1 defines cell type. <bold>I</bold> Top genes by contribution to PC2 defined by ISG stimulation colored by scaled normalized, log-transformed gene expression scaled by variable. <bold>J</bold>, <bold>K</bold> Scaled normalized, log-transformed expression scaled by variable of ISG related loadings from PCA (left) and LDVAE (right) includes cell type specific markers intermixed with ISGs. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig4_HTML" id="d32e1063"/></fig></p>
      <p id="Par19">As a method of both validation and exploration, GeneVector provides the ability to query similarity in genes. For a given target gene, a list of the closest genes sorted by cosine similarity can be generated. This is useful in both validating known markers and identifying the function of unfamiliar genes by context. The genes most similar to IFIT1 (Fig. <xref rid="Fig4" ref-type="fig">4D</xref>) include a large proportion of genes found in the Reactome pathway Interferon Signaling (R-I-913531) (Gillespie et al. 2022). After clustering gene vectors, we identify a single metagene that includes these genes (<italic>IFIT1</italic>, <italic>IFIT2</italic>, <italic>IFIT3</italic>, <italic>ISG15</italic>, <italic>ISG20</italic>, <italic>TFGS10</italic>, <italic>RSAD2</italic>, <italic>LYSE</italic>, <italic>OAS1</italic>, and <italic>MX1</italic>). The ISG metagene can be visualized on a UMAP generated from the gene embedding, like the familiar cell-based visualizations common in scRNA-seq studies (Fig. <xref rid="Fig4" ref-type="fig">4E</xref>). The mean and scaled log-normalized expression of each gene identified in the ISG metagene is significantly higher in interferon beta stimulated cells over control cells (Fig. <xref rid="Fig4" ref-type="fig">4F</xref>). Importantly, the increased expression is found in each cell type, indicating a global relation to treatment.</p>
      <p id="Par20">To compare the ISG metagene with results generated from PCA loadings, we performed PCA on the normalized and log-transformed gene-by-cell expression matrix (Fig. <xref rid="Fig4" ref-type="fig">4G</xref>) and colored the embedding by cell type and treatment. After computing the PCA loadings using Scanpy<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, we identified the top genes by contribution score to variation in the first and second principal components. The first principal component (PC1) explains variation related to cell type and the differences between myeloid (<italic>TYROBP</italic>, <italic>FCER1G</italic>, <italic>FTL</italic>, <italic>CST3</italic>) and T cells <italic>(LTB</italic>, <italic>CCR7</italic>) (Fig. <xref rid="Fig4" ref-type="fig">4H</xref>). The second principal highlights the variation related to interferon beta stimulation and includes the genes found in the ISG metagene generated by GeneVector (Fig. <xref rid="Fig4" ref-type="fig">4I</xref>). However, the increased effect of interferon stimulation in myeloid cells, conflates myeloid specific ISGs with the interferon signature. One such gene is <italic>CXCL10</italic>, which shows cell type specificity to myeloid cells (Fig. <xref rid="Fig4" ref-type="fig">4J</xref>) and is not found in the interferon signaling Reactome pathways. Additionally, <italic>IFITM3</italic> shows increased expression only in myeloid cells within these PBMCs. In contrast, GeneVector produces a metagene that groups myeloid specific genes into a single metagene including <italic>CXCL10</italic> and <italic>IFITM3</italic>. A full list of metagenes produced by GeneVector is presented in Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>. Among these metagenes, we identify transcriptional programs specific to each cell type and treatment condition, including those found in the least represented cell type Megakaryocytes (132 of 14,038 cells).</p>
      <p id="Par21">To compare the GeneVector ISG metagene with LDVAE, we trained an LDVAE model using 10 latent dimensions for 250 epochs with control and stimulated batch labels in the SCVI framework on the unnormalized read counts. In contrast to the specificity of the GeneVector ISG metagene that includes only interferon stimulated genes, the nearest LDVAE loading mixes interferon-related genes with markers of T cell activation (<italic>PRF1</italic>) and T cell dysfunction (<italic>LAG3</italic>) (Fig. <xref rid="Fig4" ref-type="fig">4K</xref>). With respect to PCA and LDVAE loadings, GeneVector identified an ISG metagene that is not confounded by cell type and includes only interferon pathway related genes.</p>
    </sec>
    <sec id="Sec7">
      <title>Metagenes changes between primary and metastatic site in HGSOC</title>
      <p id="Par22">Studies with scRNA-seq data sampled from multiple tumor sites in the same patient provide a wide picture of cancer progression and spread. As these datasets grow larger and more complex, understanding the transcriptional changes that occur from primary to metastatic sites can help identify mechanisms that aid in the process of the invasion-metastasis cascade. GeneVector provides a framework for asking such questions in the form of latent space arithmetic. By defining the difference between two sites as a vector, where the direction defines transcriptional change, we identify metagenes associated with expression loss and gain between primary and metastasis sites from six patients in the Memorial Sloan Kettering Cancer Center SPECTRUM cohort of patients with high-grade serous ovarian cancer (HGSOC)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>.</p>
      <p id="Par23">A set of 270,833 cells quality control filtered cells from adnexa (primary) and bowel (metastasis) samples were processed with GeneVector (Fig. <xref rid="Fig5" ref-type="fig">5A</xref>). The unnormalized counts were subset to 2000 highly variable genes were used as input to GeneVector and cells were classified to one of six cell types using gene markers curated for HGSOC and two markers for cancer cells (<italic>EPCAM</italic> and <italic>CD24</italic>)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. We performed cell type classification (Methods: Cell Type Assignment) and compared GeneVector accuracy to the original annotations generated from CellAssign for each cell type in a confusion matrix (Fig. <xref rid="Fig5" ref-type="fig">5B</xref>). Accuracy reached 99.7% in three cell types with a minimum classification rate of 94.1%. In cells where GeneVector annotated differently than previous annotations, there is evidence from the differentially expressed genes that these cells may have been initially mislabeled. GeneVector reassigned a subset of cancer cells to fibroblast and the differentially expressed genes between these cells and the cells annotated as cancer by GeneVector highlighted fibroblast cell type markers including <italic>COL1A1</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4A</xref>). In B/Plasma cells reassigned as T cells, the differentially expressed genes highlight B cell receptor genes <italic>IGK</italic> and <italic>IGLC2</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4B</xref>). Finally, in B/Plasma cells classified as myeloid, the top differentially expressed genes include known canonical markers for macrophage/monocyte cells (<italic>TYROBP</italic>, <italic>LYZ</italic>, <italic>CD4</italic>, and <italic>AIF1</italic>)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4C</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>Metagenes Associated with Directional Difference in HGSOC Cancer Cells from Adnexa to Bowel.</title><p><bold>A</bold> UMAP of HGSOC cells with classified by GeneVector. <bold>B</bold> Uncorrected UMAP of cancer cells from patients with adnexa and bowel samples. <bold>C</bold> GeneVector batch corrected UMAP with patient labels on site labels on batch corrected UMAP. <bold>D</bold> Confusion matrix of accuracy comparing SPECTRUM annotated cell types with GeneVector classification. <bold>E</bold> Hallmark pathway enrichment for top 30 metagenes by cosine similarity to <bold>V</bold><sub>adnexa</sub> – <bold>V</bold><sub>bowel</sub>. <bold>F</bold> Hallmark pathway enrichment for top 30 metagenes by cosine similarity to <bold>V</bold><sub>bowel</sub> – <bold>V</bold><sub>adnexa</sub>. <bold>G</bold> Pseudo-probabilities for metagenes associated with up-regulation in bowel to adnexa (Epithelial-to-Mesenchymal Transition) and down-regulation (Major Histocompatibility Class I). <bold>H</bold> EMT (Epithelial-Mesenchymal Transition) metagene significantly up regulated in four of six patients by gene module score. <bold>I</bold> MHC Class I (MHCI) metagene significantly downregulated in the metastatic site (bowel) in three of six patients by gene module score. Source data provided as a Source Data file. The center of the box plot is denoted by the median, a horizontal line dividing the box into two equal halves. The bounds of the box are defined by the lower quartile (25th percentile) and the upper quartile (75th percentile). The whiskers extend from the box and represent the data points that fall within 1.5 times the interquartile range (IQR) from the lower and upper quartiles. Any data point outside this range is considered an outlier and plotted separately. Significance assessed using Mann-Whitney-Wilcoxon two-sided test.</p></caption><graphic xlink:href="41467_2023_39985_Fig5_HTML" id="d32e1292"/></fig></p>
      <p id="Par24">We recomputed the gene embedding and metagenes on only those cells classified as cancer by GeneVector with both adnexa and bowel samples. We found these cells exhibited large patient specific batch effects (Fig. <xref rid="Fig5" ref-type="fig">5C</xref>) and applied GeneVector batch correction (Fig. <xref rid="Fig5" ref-type="fig">5D, E</xref>). To understand the changes between primary and metastatic sites, we computed an average vector for all cells from the adnexa (<bold>V</bold><sub>adnexa</sub>) as the primary site and bowel (<bold>V</bold><sub>bowel</sub>) as the site of metastasis. We mapped the top 30 most similar metagenes to vectors representing expression gain in metastasis (<bold>V</bold><sub>adnexa</sub> - <bold>V</bold><sub>bowel</sub>) (Fig. <xref rid="Fig5" ref-type="fig">5F</xref>) and expression loss (v<sub>bowel</sub> - v<sub>adnexa</sub>) (Fig. <xref rid="Fig5" ref-type="fig">5G</xref>). Gene Set Enrichment Analysis (GSEA) using GSEAPY with Hallmark gene set annotations from Enrichr<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> was performed to assess whether metagenes were enriched for genes from known pathways. Metagenes enriched for E2F targets and Epithelial-to-Mesenchymal Transition (EMT) pathway genes were found gained in metastasis. Conversely, the set of metagenes representative of loss from adnexa to bowel included MHC Class I (<italic>HLA-A</italic>, <italic>HLA-B</italic>, <italic>HLA-C</italic>, <italic>HLA-E</italic>, and <italic>HLA-F</italic>) and the transcriptional regulator <italic>B2M</italic>, suggesting a means of immune escape via loss of MHC Class I expression and higher immune pressure in metastatic sites may increase the potential fitness benefit of MHC Class I loss. For both the EMT and MHCI metagenes, pseudo-probabilities computed using GeneVector highlight pathway activity in either site in the UMAP embedding (Fig. <xref rid="Fig5" ref-type="fig">5H</xref><bold>)</bold>. Computing the gene module scoring on the normalized, log-transformed expression<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>, we examined the change between sites in each patient for the EMT and MHCI metagenes. We found that the MHCI metagene is significantly downregulated in metastatic sites in four of six patients (Fig. <xref rid="Fig5" ref-type="fig">5I</xref>). Conversely, the EMT metagene was significantly up regulated in metastatic sites for three of six patients (Fig. <xref rid="Fig5" ref-type="fig">5J</xref>). The ability to phrase questions about transcriptional change as vector arithmetic provides a powerful platform for more complex queries than can be performed with differential expression analysis alone.</p>
      <p id="Par25">It is possible to perform latent space arithmetic operations on any embedding that is computed from a linear transformation of the gene space, including PCA. To assess the performance of latent space arithmetic using GeneVector and the principal components of a PCA decomposition of the gene expression matrix, we performed the same analysis on the cell-by-gene matrix. After clustering the gene embedding using the Leiden algorithm and we generated a list of candidate metagenes. We recomputed a representative vector for changes from bowel to adnexa by subtracting <bold>V</bold><sub>adnexa</sub> - <bold>V</bold><sub>bowel</sub> and selected the most similar metagenes. Like the GeneVector analysis, we recovered a metagene related to MHC Class I using the PCA embedding. However, several of the genes within this metagene were not present in the Reactome MHC Class I pathway (HSA-983169), in contrast to the GeneVector results which found a metagene containing only <italic>HLA-A</italic>, <italic>HLA-B</italic>, <italic>HLA-C</italic>, and <italic>B2M</italic>. To test if the unannotated genes defined by the PCA embedding were members of any gene signatures which contained HLA genes, we calculated the percentage of Reactome pathways that include individual gene pairs and plotted this as a heatmap over all genes in the metagene <bold>(</bold>Supplementary Fig. <xref rid="MOESM1" ref-type="media">5A</xref>). The genes <italic>TMEM59, SERINC2, FOLR1</italic>, and <italic>WFDC2</italic> were not found as a pair within any Reactome pathway. We concluded that the PCA embedding identified an MHC Class I metagene that was less consistent with previously annotated pathways than GeneVector.</p>
      <p id="Par26">Given that the metagenes are computed using Leiden clustering, the resolution parameter affects the coarseness of the PCA embedding. We performed a parameter sweep over resolution values and found that the genes identified by the PCA analysis are robustly clustered together over a wide range of resolutions (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5B</xref>). In comparison, GeneVector identifies a metagene containing <italic>HLA-A</italic>, <italic>HLA-B</italic>, <italic>HLA-C</italic>, and <italic>B2M</italic> over a wide range of resolution parameters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5C</xref>). The interval of values used for the parameter sweep was selected to keep metagene membership between three and 50 genes and represents the most reasonable range of values for generating metagenes of this size. To understand why non MHCI-annotated genes appear in the context of MHC genes in the PCA embedding, we looked at differentially expressed genes up-regulated in adnexa over bowel. We found that while these genes do not appear in Reactome pathways together, they do appear significantly differentially expressed between adnexa and bowel. Here, we draw the conclusion that PCA combines multiple pathways to explain as much variance as possible when constructing successive orthogonal PCA components. As a result, PCA will combine multiple underlying sources of variance such as bowel/adnexa variation, and MHC I variation between cells. By contrast, GeneVector has no orthogonality constraints and is not constructed to maximize variance explained by individual vectors, allowing GeneVector to decompose pathway specific metagenes in a more flexible manner.</p>
    </sec>
    <sec id="Sec8">
      <title>Metagenes associated with cisplatin treatment resistance</title>
      <p id="Par27">Understanding the transcriptional processes that generate resistance to chemotherapies has immense clinical value. However, the transcriptional organization of resistance is complex with many parallel mechanisms contributing to cancer cell survival<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. We analyzed longitudinal single cell RNA-seq collected from a triple negative breast cancer patient-derived xenograft model (SA609 PDX) along a treated and untreated time series<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. Using a total of 19,799 cancer cells with treatment and timepoint labels (Fig. <xref rid="Fig6" ref-type="fig">6A</xref>), GeneVector was trained using unnormalized read counts to generate metagenes that identify programs potentially related to cisplatin resistance. For each metagene, we computed gene module scores over normalized and log-transformed expression<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> over the four timepoint (X1, X2, X3, and X4) within the treated and untreated cells. Using these scores, we calculated linear regression coefficients over the four time points and selected candidate chemotherapy resistant and untreated metagenes (<italic>β</italic><sub><italic>treated</italic></sub> and <italic>β</italic><sub><italic>untreated</italic></sub><italic>)</italic> over a coefficient threshold (<italic>β</italic><sub><italic>treated</italic></sub> &gt; 0.1 and Bonferroni adjusted <italic>p</italic> = 0.001) with an untreated coefficient less than the treated coefficient (<italic>β</italic><sub><italic>treated</italic></sub>
<italic>&gt; β</italic><sub><italic>untreated</italic></sub><italic>)</italic>
<bold>(</bold>Fig. <xref rid="Fig6" ref-type="fig">6B</xref>). Mean log-normalized expression per gene was computed for each timepoint in five metagenes that were identified as treatment specific (Fig. <xref rid="Fig6" ref-type="fig">6C</xref>).<fig id="Fig6"><label>Fig. 6</label><caption><title>Analysis of Metagenes in Cisplatin-treated PDX Time Series.</title><p><bold>A</bold> UMAP of cisplatin treated PDX (patient derived xenograft) cells annotated by time point (left) and treatment status (right). <bold>B</bold> Metagenes plotted with respect to regression coefficients (β<sub>treated</sub> and β<sub>untreated</sub>) over four timepoints in either treated or untreated cells with Bonferroni adjusted <italic>p</italic>-values = 0.001. <bold>C</bold> Hallmark combined enrichment scores for candidate chemo resistant metagenes. <bold>D</bold> Gene expression profiles for each timepoint for the five metagenes associated with increase in treatment. Metagene 24 is associated with TGF-beta signaling includes <italic>EPCAM</italic>, <italic>FOXP1</italic>, and <italic>ID</italic> family genes with known cisplatin resistance function. <bold>E</bold> Most similar genes for treated and untreated cells computed from cosine similarity to global vectors. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig6_HTML" id="d32e1543"/></fig></p>
      <p id="Par28">Pathway enrichment on each of the five metagenes using GSEAPY with Hallmark gene set annotations from Enrichr<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> showed that metagene 24 was enriched for TGF-beta signaling (Fig. <xref rid="Fig6" ref-type="fig">6D</xref>), a pathway frequently up-regulated during chemo-resistance<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>. This metagene includes genes <italic>ID1</italic>, <italic>ID2</italic>, <italic>ID3</italic>, <italic>ID4</italic>, <italic>EPCAM</italic>, and <italic>FOXP1</italic>, all of which have been found to be overexpressed in chemotherapy-resistant samples in several cancer types<sup><xref ref-type="bibr" rid="CR39">39</xref>–<xref ref-type="bibr" rid="CR41">41</xref></sup>. GeneVector also identified these genes in global expression differences between treated and untreated cells from the set of most similar genes to vectors <bold>V</bold><sub>treated</sub> and <bold>V</bold><sub>untreated</sub> (Fig. <xref rid="Fig6" ref-type="fig">6E</xref>). Several studies have implicated multiple resistance mechanisms involving FOXP1 including transcriptional regulation, immune response, and MAPK signaling<sup><xref ref-type="bibr" rid="CR42">42</xref>–<xref ref-type="bibr" rid="CR44">44</xref></sup>. Additionally, GeneVector identifies <italic>EPCAM</italic>, whose high expression has been associated with increased viability of cancer cells in diverse cancer types<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. <italic>EPCAM</italic> has been shown to have a role in resistance to chemotherapy in both breast and ovarian cancers through WNT signaling and Epithelial-Mesenchymal Transition (EMT)<sup><xref ref-type="bibr" rid="CR46">46</xref>,<xref ref-type="bibr" rid="CR47">47</xref></sup>.</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par29">In this paper we propose GeneVector, a method for building a latent vector representation of scRNA expression capturing the relevant statistical dependencies between genes. By borrowing expression signal across genes, GeneVector overcomes sparsity and produces an information dense representation of each gene. The resulting vectors can be used to generate a gene co-expression graph, and can be clustered to predict transcriptional programs, or metagenes, in an unsupervised fashion. Metagenes can be related to a cell embedding to identify transcriptional changes related to conditional labels or time points. We show that gene vectors can be used to annotate cells with a pseudo-probability, and that these labels are accurate with respect to previously defined cell types.</p>
    <p id="Par30">We show that a single GeneVector embedding can be used for many important downstream analyses. In interferon-stimulated PBMCs, we identify a cell type independent ISG metagene that summarizes interferon-stimulation across cell types and is not conflated with cell type signature. We demonstrate accurate cell type assignment across 18 different cancers in 181 patients described in the Tumor Immune Cell Atlas (TICA). In high grade serous ovarian cancer, we identify metagenes that describe transcriptional changes from primary to metastatic sites. Our results implicate the loss of MHC class I gene expression as a potential immune escape mechanism in ovarian cancer metastasis. In cisplatin treated TNBC PDXs, GeneVector uncovers transcriptional signatures active in drug resistance, most notably metagenes enriched in TGF-beta signaling. This signaling pathway is a cornerstone in cancer progression since it promotes EMT transition and invasion in advanced cancers; it is the target of various therapies, but success has been mixed<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> making it even more important to employ tools that identify the multitude of players contributing to therapy response.</p>
    <p id="Par31">GeneVector can produce an interpretable batch correction by decomposing the derived correction vectors into transcriptional signatures. Using both the full PBMC dataset and simulated mixtures of CD14+ monocytes and CD4 T cells, we systematically evaluated the quality of batch correction using a series of benchmarking metrics (ARI, kBET, cLISI, and silhouette score)<sup><xref ref-type="bibr" rid="CR49">49</xref>,<xref ref-type="bibr" rid="CR50">50</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6A–I</xref>). For the interferon beta stimulated PBMC dataset, we expect the proper batch correction to include ISGs, and indeed the batch correction vector had high cosine similarity to an ISG metagene. In simulated mixtures of cell types, we found that the similarity of the batch correction vector to ISGs was highest when the ratio of cell types was balanced in the unstimulated and stimulated batches, we obtained the best batch correction performance for balanced batches (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6J</xref>). By contrast, when cell types were imbalanced, batch correction vectors had high similarity to cell type specific vectors (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6K, L</xref>). Batch correction is challenging in the presence of batch-specific differences in cell type composition. As opposed to other batch correction methods, the GeneVector implementation is highly interpretable, so users can verify whether batch correction vectors are similar to cell type signatures or other biologically relevant metagenes.</p>
    <p id="Par32">Identifying correlations across scRNA data is a fundamental analysis task, necessary for identifying cells with similar phenotype or activity, or genes with similar pathways or functional relationships. As has been shown by us and in previous work<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR16">16</xref>,<xref ref-type="bibr" rid="CR51">51</xref></sup>, the sparsity and non-linearity of scRNA data impact the performance of both standard measures of correlations between variables and global analysis of assumed linear correlations using PCA. While some methods tailor complex custom probabilistic models to the specific properties of scRNA data, GeneVector instead builds upon MI, a simple yet powerful tool for calculating the amount of information shared between two variables. We show that MI and the vector space trained from the MI matrix both capture relevant gene pair relationships including between TF activators and repressors and their targets. Nevertheless, GeneVector is unable to discern repression from activation, as it builds MI that is agnostic to the direction of the statistical dependency. Pearson correlation, theoretically sensitive to the direction of a dependency, also performs poorly. Due to the high-level of sparsity, absence of expression is not a significant event and repressed expression could just as easily be explained by under-sampling an expressed gene. We suggest that identifying negative regulation and mutually exclusive expression is one of the more difficult problems in scRNA-seq analysis.</p>
    <p id="Par33">As shown with correlation, the objective function employed in training GeneVector has a significant effect on the resulting gene embedding. Mutual information calculated empirically from the histogram of binned expression counts for gene pairs is limited by the available number of cells, fidelity of the counts, and discretization strategy. By modeling the underlying distribution for each gene more accurately, the joint probability distribution between genes can more accurately reflect expression-based relationships and improve model results. Additionally, while only a one-time cost, the MI calculation is computationally expensive. By improving the calculation of mutual information, others have achieved improved performance in related tasks including the identification of GRNs<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>.</p>
    <p id="Par34">The high dimensionality of scRNA and the vast complexity of biological systems to which it is applied necessitate analytical tools that facilitate intuitive and efficient data exploration and produce easily interpretable results. GeneVector performs upfront computation of a meaningful low dimensional representation, transforming sparse and correlated expression measurements into a concise vector space summarizing the underlying structure in the data. The resulting vector space is amenable to intuitive vector arithmetic operations that can be composed into higher level analyses including cell type classification, treatment related gene signature discovery, and identification of functionally related genes. Importantly, the vector arithmetic operations and higher-level analyses can be performed interactively, allowing for faster iteration in developing cell type and context specific gene signatures or testing hypotheses related to experimental covariates. GeneVector is implemented as a python package available on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/nceglia/genevector">https://github.com/nceglia/genevector</ext-link>) and installable via PIP.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Dataset preprocessing</title>
      <p id="Par35">Each single cell RNA-seq dataset in this study was processed using the Scanpy python library<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. All highly variable gene selection was performed using the Seurat V3<sup><xref ref-type="bibr" rid="CR6">6</xref></sup> method implemented in Scanpy. We performed cell type classification on 23,764 cells from the Tumor Immune Cell Atlas (TICA)<sup><xref ref-type="bibr" rid="CR20">20</xref></sup> using raw read counts from 2,000 highly variable after removal of non-protein coding genes. We performed analysis of 6,855 cells composed of an interferon beta stimulated sample and a control sample using raw counts and cell type annotations obtained from the SeuratData R package<sup><xref ref-type="bibr" rid="CR33">33</xref></sup> and subset to 1000 highly variable genes. The fitness PDX dataset<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> consisted of raw counts from 19,799 cancer cells with treatment and timepoint labels subset to 2000 highly variable genes. Coefficients and <italic>p</italic>-values were computed over gene module scores using the statsmodels python package. Cell type classification and vector arithmetic for the changes between metastatic and primary sites was performed on 270,833 cells from adnexa (primary) and bowel (metastasis) samples using 2000 highly variable genes. Normalization comparisons were made using the Scanpy normalize_total and log1p functions. All subsampling of datasets for simulated batch effects was performed using the Scanpy subsample function.</p>
    </sec>
    <sec id="Sec12">
      <title>Gene expression mutual information</title>
      <p id="Par36">In NLP applications, vector space models are trained by defining an association between words that appear in the same context. In single cell RNA sequencing data, we can redefine this textual context as co-expression within a given cell and mutual information across cells. The simplest metric to define association is the overall number of co-expression events between genes. However, the expression profiles over cells may differ due to both technical and biological factors. To summarize the variability in this relationship, we generate a joint probability distribution on the co-occurrence of read counts. The ranges of each bin are defined separately for each gene based on a user defined number of quantiles. By defining the bin ranges separately, the lowest counts in one gene can be compared directly to the lowest counts in another gene without need for further normalization. Using the joint probability distribution, we compute the mutual information between genes defined in Eq. <xref rid="Equ1" ref-type="disp-formula">1</xref>. The mutual information value is subsequently used as the target in training the model, allowing us to highlight the relationship between genes as a single-valued quantity.<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$I\left({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\right)=\mathop{\sum }\limits_{i}^{n}\mathop{\sum }\limits_{j}^{n}p\left({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\right)\log \left(\frac{p\big({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\big)}{p\left({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}}\right),p\big({{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\big)}\right)$$\end{document}</tex-math><mml:math id="M2"><mml:mi>I</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mi>p</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>log</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par37">Equation <xref rid="Equ1" ref-type="disp-formula">1</xref>: Mutual information between <bold>G</bold><sub>i</sub> and <bold>G</bold><sub>j</sub> computed on the empirical joint probability distribution over expression bins for <bold>G</bold><sub>i</sub> and <bold>G</bold><sub>j</sub>.</p>
    </sec>
    <sec id="Sec13">
      <title>Model training</title>
      <p id="Par38">A neural network is constructed from a single hidden layer corresponding to the size of the latent space vectors. A set of independently updated weights connects the one-hot encoded input and output layers that are defined from each pair of genes. These weights, <bold>w</bold><sub>1</sub> and <bold>w</bold><sub>2</sub>, are matrices with dimensions equal to <italic>N</italic> expressed genes by <italic>I</italic> hidden units. Initial values for <bold>w</bold><sub>1</sub> and <bold>w</bold><sub>2</sub> are generated uniformly on the interval −1 to 1. The objective function, as a minimization of least squares, is defined in Eq. <xref rid="Equ2" ref-type="disp-formula">2</xref>. The final latent space, defined as the gene embedding, is computed as the vector average of weights <italic>w</italic><sub><italic>1</italic></sub> and <italic>w</italic><sub><italic>2</italic></sub>. For NLP applications, this is a preferred approach over selecting either weight matrix<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>. Each co-expressed gene pair is used as a single training example. The maximum number of examples for a full training epoch is given by the total number of co-expressed gene pairs. Weights are batch updated with adaptive gradient descent (ADADELTA)<sup><xref ref-type="bibr" rid="CR53">53</xref></sup>. Training is halted at either a maximum number of epochs, or when the change in loss falls below a specified threshold. The results presented used unnormalized integer read counts, but any matrix can be used as input to the model. The model is implemented in PyTorch.<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$J={\left({{{{{{{\bf{w}}}}}}}_{i}}^{T}{\hat{{{{{{\bf{w}}}}}}}}_{j}-C*I({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}})\right)}^{2}$$\end{document}</tex-math><mml:math id="M4"><mml:mi>J</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>C</mml:mi><mml:mo>*</mml:mo><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par39">Equation <xref rid="Equ2" ref-type="disp-formula">2</xref>: Objective function for weights corresponding to gene <bold>G</bold><sub><bold>i</bold></sub> and <bold>G</bold><sub><bold>j</bold></sub>, where <inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$I({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}})$$\end{document}</tex-math><mml:math id="M6"><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq1.gif"/></alternatives></inline-formula> is the mutual information and <italic>C</italic> is a constant.</p>
    </sec>
    <sec id="Sec14">
      <title>Gene vectors</title>
      <p id="Par40">The cosine similarity function, defined in Eq. <xref rid="Equ3" ref-type="disp-formula">3</xref>, is used to measure similarity between vectors, defined as 1 - cosine distance or dot product. Values closer to 1 indicate strong association within the dataset. A gene vector is defined as the learned weights in the gene embedding for a particular gene. Vectors describing groups of cells are generated by computing a weighted average vector, described in Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref>, from a set of individual gene vectors.<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${cosinesimilarity}=1-\frac{{{{{{\bf{A}}}}}}*{{{{{\bf{B}}}}}}}{\left|\left|{{{{{\bf{A}}}}}}\right|\right |*\left|\left|{{{{{\bf{B}}}}}}\right|\right|}$$\end{document}</tex-math><mml:math id="M8"><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="bold">A</mml:mi><mml:mo>*</mml:mo><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mi mathvariant="bold">A</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>*</mml:mo><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par41">Equation <xref rid="Equ3" ref-type="disp-formula">3</xref>: Cosine similarity as the dot-product between feature vectors <inline-formula id="IEq2"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M10"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq2.gif"/></alternatives></inline-formula> and <inline-formula id="IEq3"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$B$$\end{document}</tex-math><mml:math id="M12"><mml:mi>B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq3.gif"/></alternatives></inline-formula>.</p>
      <p id="Par42">To assign a vector to each cell, the average vector is computed across the gene embedding weighted by the normalized, log-transformed expression observed in each cell. The matrix of all cell vectors in the dataset is defined as the cell embedding. This cell embedding can be used in place of PCA or embeddings obtained with variational auto-encoders. Each cell vector maintains a linear relationship with the gene embedding. The computation of vectors describing groups of cells is described in Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref>.<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\bf{C}}}}}}}_{{{{{{\bf{k}}}}}}}=\frac{{\sum }_{i=1}^{n}{{{{{\bf{w}}}}}}_{i\ast}{\underline{{{{{{\bf{x}}}}}}}_{{{{{{\bf{i}}}}}}}}}{{\sum }_{i=1}^{n}{{{{{\bf{w}}}}}}_{i}}$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:munder accentunder="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="true">_</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par43">Equation <xref rid="Equ4" ref-type="disp-formula">4</xref>: Vector <inline-formula id="IEq4"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{k}$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq4.gif"/></alternatives></inline-formula> defined as the <inline-formula id="IEq5"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M18"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq5.gif"/></alternatives></inline-formula> th component of the cell embedding computed from the average mean of vectors <inline-formula id="IEq6"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\underline{x}}_{i\to n}$$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:munder accentunder="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="true">_</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq6.gif"/></alternatives></inline-formula> where <inline-formula id="IEq7"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n$$\end{document}</tex-math><mml:math id="M22"><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq7.gif"/></alternatives></inline-formula> is equal to the number of hidden units.</p>
    </sec>
    <sec id="Sec15">
      <title>Co-expression similarity graph</title>
      <p id="Par44">A co-expression similarity graph is constructed from cosine similarity between each pair of genes using Scanpy neighborhood function with a default value for <italic>k</italic> of 15. A node in the graph represents a single gene and edges are weighted by cosine similarity. To generate metagenes, we apply Leiden clustering to the neighborhood graph with a user defined resolution argument. We have found that metagene clustering is robust to a range of resolution values ranging from 15 to 1000 when assessing the identification of an MHCI-like metagene in a single patient in the SPECTRUM cohort (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5C</xref>).</p>
    </sec>
    <sec id="Sec16">
      <title>Cell type assignment</title>
      <p id="Par45">A set of cell types with user defined marker genes are used to perform a pseudo-probabilistic phenotype assignment in a single cell. A representative vector for the cell type is computed from the user defined marker genes weighted by the normalized and log-transformed expression of the cell to be classified. The cosine distances of each cell type vector with cell vector are passed through a SoftMax function, given in Eq. <xref rid="Equ5" ref-type="disp-formula">5</xref>, to provide a pseudo-probability distribution for each phenotype. The argument maximum of this distribution is used to classify the most likely cell type for a given cell. This procedure is repeated for every cell in the dataset.<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma (z)_{i}=\frac{{e}^{{Z}_{i}}}{{\sum }_{j=1}^{n}{e}^{{Z}_{i}}}$$\end{document}</tex-math><mml:math id="M24"><mml:mi>σ</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par46">Equation <xref rid="Equ5" ref-type="disp-formula">5</xref>: SoftMax function where <inline-formula id="IEq8"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$z$$\end{document}</tex-math><mml:math id="M26"><mml:mi>z</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq8.gif"/></alternatives></inline-formula> is the set of cosine similarities for <inline-formula id="IEq9"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n$$\end{document}</tex-math><mml:math id="M28"><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq9.gif"/></alternatives></inline-formula> cell types.</p>
    </sec>
    <sec id="Sec17">
      <title>Generation of predictive genes</title>
      <p id="Par47">The method of phenotype assignment can be reversed to produce a set of genes that are most similar, or predictive, to any group of cells. The cell vectors belonging to this group can be averaged to generate a group vector representing a label in the dataset. The transcriptional signature associated with this group of cells can be computed using vector arithmetic <bold>V</bold><sub>group</sub> – <bold>V</bold><sub>dataset</sub>, where <bold>V</bold><sub>dataset</sub> is the average vector over all cells. Gene vectors are sorted by cosine similarity to the group vector to produce a ranked list of candidate genes that are most like the set of cells in the group.</p>
    </sec>
    <sec id="Sec18">
      <title>Batch correction</title>
      <p id="Par48">Batch correction is applied to cells over a given set of batch labels with the goal of correcting the difference between these batches and a user-specified reference batch. With the set of cells labeled for a batch, we can compute an average batch vector. A correction vector can then be computed for each batch using vector arithmetic to describe the direction and magnitude of the change from the batch to the reference. The correction vector is then added to each cell in the batch. After computing the cell embedding, the following procedure is applied to each batch label:<list list-type="order"><list-item><p id="Par49">Compute the average vector <bold>V</bold><sub>batch</sub> for a set of cells.</p></list-item><list-item><p id="Par50">Compute the reference vector <bold>V</bold><sub>reference</sub> for cells in the reference batch.</p></list-item><list-item><p id="Par51">Compute a correction vector <bold>V</bold><sub>correction</sub> = <bold>V</bold><sub>reference</sub> – <bold>V</bold><sub>batch</sub>.</p></list-item><list-item><p id="Par52">For each cell in the batch, subtract <bold>V</bold><sub>correction</sub> from each cell vector.</p></list-item><list-item><p id="Par53">Repeat for all <italic>n</italic> batches.</p></list-item></list></p>
    </sec>
    <sec id="Sec19">
      <title>Co-expressed and mutually exclusive markers</title>
      <p id="Par54">Cell type marker gene pairs used to benchmark normalization methods by identifying common differentially expressed genes in T cell, B cell, and monocyte lineage cell types across multiple datasets and extracting the top 10 markers of each cell type in each dataset. The union of extracted marker genes over all cell types for a given lineage (T cell, B cell, or monocyte) were ranked by the number of datasets where that gene was a marker. All combinations of markers in the top 10 ranked genes that were unique to a cell type were selected as the co-expressed pairs for T cell, B cell, and monocyte lineages. Mutually exclusive markers were defined as all combinations of gene pairs that were not found together in a single lineage.</p>
    </sec>
    <sec id="Sec20">
      <title>Time-series analysis of metagenes</title>
      <p id="Par55">Linear regression is applied to gene module scores computed over normalized, log-transformed expression<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> over a series of time points for each metagene resulting in a <italic>p</italic>-value and slope coefficient from each series. Metagenes with a Bonferroni adjusted <italic>p</italic> = 0.001 and a treated coefficient greater than the untreated coefficient, with a minimum threshold of 0.1 were selected as treatment specific gene programs.</p>
    </sec>
    <sec id="Sec21">
      <title>Reporting summary</title>
      <p id="Par56">Further information on research design is available in the <xref rid="MOESM2" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec22">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_39985_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_39985_MOESM2_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec23">
        <title>Source data</title>
        <p id="Par60">
          <media position="anchor" xlink:href="41467_2023_39985_MOESM3_ESM.xlsx" id="MOESM3">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Zachary Sethna, Samuel S. Freeman.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-39985-2.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was funded in part by awards to S.P.S.: Susan G. Komen Breast Cancer Foundation (SAC220206), the Department of Defense Congressionally Directed Medical Research Programs (CDMRP) award W81XWH2210759 and award W81XWH-20-1-0565, the Cancer Research UK Grand Challenge Program (GC-243330), the Ovarian Cancer Research Fund (1468), a National Cancer Institute (NCI) grant (P50-CA247749), an NIH U24 award (CA264028), an NIH RM1 award (RM1-HG011014). The work received further support from awards to B.D.G.: NCI grant RO1 CA269382-01A1, NIH SPORE grant P50-CA257881-01A1, NIH-SPORE grant P50- CA257881-01A1, the Department of Defense Congressionally Directed Medical Research Programs (CDMRP) award 582539, NCI UO1 CA228963-03, NCI RO1 CA240924, NCI RO1 CA262516-01A1, the Mark Foundation for Cancer Research (1388), Stand Up To Cancer (21-A0-00-1007566). S.P.S. holds the Nicholls-Biondi endowed chair in Computational Oncology. The project was further supported by the Marie-Josée and Henry R. Kravis Center for Molecular Oncology and NCI Cancer Center Core grant P30-CA008748 and by Cycle for Survival supporting Memorial Sloan Kettering Cancer Center. S.A. holds the Nan and Lorraine Robertson Chair in Breast Cancer and is a Canada Research Chair in Molecular Oncology (950–230610). Additional funding was provided by a Terry Fox Research Institute grant (1082), a Canadian Cancer Society Research Institute Impact program grant (705617), a CIHR grant (FDN-148429), Breast Cancer Research Foundation awards (BCRF-18-180, BCRF-19-180 and BCRF-20-180), a CCSRI grant (705636), the Canada Foundation for Innovation (40044) to S.A., and the Department of Defense Congressionally Directed Medical Research Programs (CDMRP) award W81XWH-20-10565 to S.A. and S.P.S.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>N.C. developed method, implemented software, performed analysis, authored manuscript. Z.S. developed method, guided analysis framework, and authored manuscript. S.S.F. developed method, performed data analysis, and authored manuscript. F.U. performed analysis. V.B. performed data analysis and developed visualizations. N.R. authored manuscript and provided analysis guidance. B.B. provided analysis guidance, biological interpretations, and manuscript editing. A.C. provided analysis guidance, biological interpretations, and manuscript editing. S.S. provided biological interpretations and manuscript editing. F.K. provided biological interpretations and manuscript editing. S.A. provided biological interpretations. B.G. supervised method development. S.P.S. supervised method development. A.M. developed method, authored manuscript, and supervised method development.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par57"><italic>Nature Communications</italic> thanks the anonymous reviewers for their contribution to the peer review of this work.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>No novel sequencing data were generated for this current study. All pre-processed single cell RNA-seq data analyzed in this study are available in the Zenodo database here [10.5281/zenodo.8079610]<sup><xref ref-type="bibr" rid="CR54">54</xref></sup>. The Tumor Immune Cell Atlas (TICA) processed data can be accessed here [<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/4263972">https://zenodo.org/record/4263972</ext-link>] and the raw data has been deposited in the Gene Expression Ominibus under the accession <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE158803">GSE158803</ext-link>. The PBMC dataset can be accessed through SeuratData R package<sup><xref ref-type="bibr" rid="CR32">32</xref>,<xref ref-type="bibr" rid="CR33">33</xref></sup> and has been deposited in the Gene Expression Omnibus under the accession number <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE96583">GSE96583</ext-link>. The SPECTRUM High Grade Serous Ovarian Cancer dataset can be accessed here [<ext-link ext-link-type="uri" xlink:href="https://cellxgene.cziscience.com/collections/4796c91c-9d8f-4692-be43-347b1727f9d8">https://cellxgene.cziscience.com/collections/4796c91c-9d8f-4692-be43-347b1727f9d8</ext-link>]. Raw 10x sequencing for the Fitness dataset is available from the European Genome-Phenome under study ID <ext-link ext-link-type="uri" xlink:href="https://ega-archive.org/studies/EGAS00001004448">EGAS00001004448</ext-link>. <xref rid="Sec23" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The authors declare that the code needed to reproduce analysis and findings of this study are available in the GitHub repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/nceglia/genevector">https://github.com/nceglia/genevector</ext-link>) and the GeneVector python package can be installed directly from using the Python installer package (PIP). Code released with this manuscript can be found at 10.5281/zenodo.8079885<sup><xref ref-type="bibr" rid="CR55">55</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par58">B.D.G. has received honoraria for speaking engagements from Merck, Bristol-Meyers Squibb and Chugai Pharmaceuticals; has received research funding from Bristol-Meyers Squibb; and has been a compensated consultant for PMV Pharma and Rome Therapeutics of which he is a co-founder. S.P.S. reports personal fees from Imagia Canexia Inc. S.S.F. is a co-inventor on provisional patent application No.62/866,261 titled “Methods for predicting outcomes of checkpoint inhibition and treatment thereof” related to prediction of melanoma immunotherapy outcomes. The remaining authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Segal</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Koller</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>SK</given-names>
          </name>
        </person-group>
        <article-title>A gene-coexpression network for global discovery of conserved genetic modules</article-title>
        <source>Science</source>
        <year>2003</year>
        <volume>302</volume>
        <fpage>249</fpage>
        <lpage>255</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1087447</pub-id>
        <pub-id pub-id-type="pmid">12934013</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Svensson</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Gayoso</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Interpretable factor models of single-cell RNA-seq via variational autoencoders</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>3418</fpage>
        <lpage>3421</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa169</pub-id>
        <pub-id pub-id-type="pmid">32176273</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <mixed-citation publication-type="other">Mikolov, T., Chen, K., Corrado, G. &amp; Dean, J. <italic>Efficient Estimation of Word Representations in Vector Space</italic>. <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1301.3781">https://arxiv.org/abs/1301.3781</ext-link> (2013).</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <mixed-citation publication-type="other">Pennington, J., Socher, R. &amp; Manning, C. Glove: Global vectors for word representation. In <italic>Proceedings of the 2014 Conference on Empirical Methods in Natural Language Processing (EMNLP)</italic> (Association for Computational Linguistics, 2014). 10.3115/v1/d14-1162.</mixed-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Du</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene2vec: distributed representation of genes based on co-expression</article-title>
        <source>BMC Genomics</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>82</fpage>
        <pub-id pub-id-type="doi">10.1186/s12864-018-5370-x</pub-id>
        <pub-id pub-id-type="pmid">30712510</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GXY</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id>
        <pub-id pub-id-type="pmid">28232747</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Traag</surname>
            <given-names>VA</given-names>
          </name>
          <name>
            <surname>Waltman</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>van Eck</surname>
            <given-names>NJ</given-names>
          </name>
        </person-group>
        <article-title>From Louvain to Leiden: guaranteeing well-connected communities</article-title>
        <source>Sci. Rep.</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>5233</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-019-41695-z</pub-id>
        <pub-id pub-id-type="pmid">30914743</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van der Maaten</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Visualizing data using t-SNE</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <mixed-citation publication-type="other">McInnes, L., Healy, J. &amp; Melville, J. UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction. <ext-link ext-link-type="uri" xlink:href="https://arXiv.org/abs/1802.03426">https://arXiv.org/abs/1802.03426</ext-link> (2018).</mixed-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Song</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>JJ</given-names>
          </name>
        </person-group>
        <article-title>Statistics or biology: the zero-inflation controversy about scRNA-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>31</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-022-02601-5</pub-id>
        <pub-id pub-id-type="pmid">35063006</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tsuyuzaki</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Sato</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Sato</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Nikaido</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Benchmarking principal component analysis for large-scale single-cell RNA-sequencing</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>9</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1900-3</pub-id>
        <pub-id pub-id-type="pmid">31955711</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Margolin</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ARACNE: an algorithm for the reconstruction of gene regulatory networks in a mammalian cellular context</article-title>
        <source>BMC Bioinf.</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>S7</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-7-S1-S7</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chan</surname>
            <given-names>TE</given-names>
          </name>
          <name>
            <surname>Stumpf</surname>
            <given-names>MPH</given-names>
          </name>
          <name>
            <surname>Babtie</surname>
            <given-names>AC</given-names>
          </name>
        </person-group>
        <article-title>Gene regulatory network inference from single-cell data using multivariate information measures</article-title>
        <source>Cell Syst.</source>
        <year>2017</year>
        <volume>5</volume>
        <fpage>251</fpage>
        <lpage>267.e3</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2017.08.014</pub-id>
        <pub-id pub-id-type="pmid">28957658</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heydari</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>IQCELL: A platform for predicting the effect of gene perturbations on developmental trajectories using single-cell RNA-seq data</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2022</year>
        <volume>18</volume>
        <fpage>e1009907</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1009907</pub-id>
        <pub-id pub-id-type="pmid">35213533</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van Dijk</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Recovering gene interactions from single-cell data using data diffusion</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>716</fpage>
        <lpage>729.e27</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.05.061</pub-id>
        <?supplied-pmid 29961576?>
        <pub-id pub-id-type="pmid">29961576</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kang</surname>
            <given-names>HM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplexed droplet single-cell RNA-sequencing using natural genetic variation</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>89</fpage>
        <lpage>94</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4042</pub-id>
        <pub-id pub-id-type="pmid">29227470</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell tumor immune atlas for precision oncology</article-title>
        <source>Genome Res.</source>
        <year>2021</year>
        <volume>31</volume>
        <fpage>1913</fpage>
        <lpage>1926</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.273300.120</pub-id>
        <?supplied-pmid 34548323?>
        <pub-id pub-id-type="pmid">34548323</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vázquez-García</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ovarian cancer mutational processes drive site-specific immune evasion</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>612</volume>
        <fpage>778</fpage>
        <lpage>786</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-022-05496-1</pub-id>
        <?supplied-pmid 36517593?>
        <pub-id pub-id-type="pmid">36517593</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Salehi</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clonal fitness inferred from time-series modelling of single-cell cancer genomes</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>595</volume>
        <fpage>585</fpage>
        <lpage>590</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-03648-3</pub-id>
        <?supplied-pmid 34163070?>
        <pub-id pub-id-type="pmid">34163070</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Zeiler, M. D. ADADELTA: An Adaptive Learning Rate Method. <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1212.5701">http://arxiv.org/abs/1212.5701</ext-link> (2012).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gillespie</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The reactome pathway knowledgebase 2022</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>D687</fpage>
        <lpage>D692</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab1028</pub-id>
        <?supplied-pmid 34788843?>
        <pub-id pub-id-type="pmid">34788843</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liberzon</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular signatures database (MSigDB) 3.0</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>1739</fpage>
        <lpage>1740</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr260</pub-id>
        <?supplied-pmid 21546393?>
        <pub-id pub-id-type="pmid">21546393</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Subramanian</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2005</year>
        <volume>102</volume>
        <fpage>15545</fpage>
        <lpage>15550</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id>
        <?supplied-pmid 16199517?>
        <pub-id pub-id-type="pmid">16199517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>hTFtarget: A Comprehensive Database for Regulations of Human Transcription Factors and Their Targets</article-title>
        <source>Genomics Proteomics Bioinformatics</source>
        <year>2020</year>
        <volume>18</volume>
        <fpage>120</fpage>
        <lpage>128</lpage>
        <pub-id pub-id-type="doi">10.1016/j.gpb.2019.09.006</pub-id>
        <?supplied-pmid 32858223?>
        <pub-id pub-id-type="pmid">32858223</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TRRUST v2: an expanded reference database of human and mouse transcriptional regulatory interactions</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2018</year>
        <volume>46</volume>
        <fpage>D380</fpage>
        <lpage>D386</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkx1013</pub-id>
        <pub-id pub-id-type="pmid">29087512</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>AW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic cell-type assignment of single-cell RNA-seq for tumor microenvironment profiling</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1007</fpage>
        <lpage>1015</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0529-1</pub-id>
        <pub-id pub-id-type="pmid">31501550</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Conde</surname>
            <given-names>CD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cross-tissue immune cell analysis reveals tissue-specific features in humans</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>376</volume>
        <fpage>eabl5197</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abl5197</pub-id>
        <pub-id pub-id-type="pmid">35549406</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ziegler-Heitbrock</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Ohteki</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Ginhoux</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Shortman</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Spits</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Reclassifying plasmacytoid dendritic cells as innate lymphocytes</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2023</year>
        <volume>23</volume>
        <fpage>1</fpage>
        <lpage>2</lpage>
        <pub-id pub-id-type="doi">10.1038/s41577-022-00806-0</pub-id>
        <pub-id pub-id-type="pmid">36380022</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive Integration of Single-</article-title>
        <source>Cell Data. Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902.e21</lpage>
        <?supplied-pmid 31178118?>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nature Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuleshov</surname>
            <given-names>MV</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Enrichr: a comprehensive gene set enrichment analysis web server 2016 update</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>W90</fpage>
        <lpage>W97</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkw377</pub-id>
        <?supplied-pmid 27141961?>
        <pub-id pub-id-type="pmid">27141961</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id>
        <?supplied-pmid 25867923?>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>D-W</given-names>
          </name>
          <name>
            <surname>Pouliot</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Hall</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Gottesman</surname>
            <given-names>MM</given-names>
          </name>
        </person-group>
        <article-title>Cisplatin resistance: a cellular self-defense mechanism resulting from multiple epigenetic and genetic changes</article-title>
        <source>Pharmacol. Rev.</source>
        <year>2012</year>
        <volume>64</volume>
        <fpage>706</fpage>
        <lpage>721</lpage>
        <pub-id pub-id-type="doi">10.1124/pr.111.005637</pub-id>
        <pub-id pub-id-type="pmid">22659329</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bhola</surname>
            <given-names>NE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TGF-β inhibition enhances chemotherapy action against triple-negative breast cancer</article-title>
        <source>J. Clin. Invest.</source>
        <year>2013</year>
        <volume>123</volume>
        <fpage>1348</fpage>
        <lpage>1358</lpage>
        <pub-id pub-id-type="doi">10.1172/JCI65416</pub-id>
        <pub-id pub-id-type="pmid">23391723</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of genes associated with cisplatin resistance in human oral squamous cell carcinoma cell line</article-title>
        <source>BMC Cancer</source>
        <year>2006</year>
        <volume>6</volume>
        <fpage>224</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2407-6-224</pub-id>
        <pub-id pub-id-type="pmid">16978399</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yamano</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of cisplatin-resistance related genes in head and neck squamous cell carcinoma</article-title>
        <source>Int. J. Cancer</source>
        <year>2010</year>
        <volume>126</volume>
        <fpage>437</fpage>
        <lpage>449</lpage>
        <pub-id pub-id-type="doi">10.1002/ijc.24704</pub-id>
        <pub-id pub-id-type="pmid">19569180</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Roberts</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of genes associated with platinum drug sensitivity and resistance in human ovarian cancer cells</article-title>
        <source>Br. J. Cancer</source>
        <year>2005</year>
        <volume>92</volume>
        <fpage>1149</fpage>
        <lpage>1158</lpage>
        <pub-id pub-id-type="doi">10.1038/sj.bjc.6602447</pub-id>
        <pub-id pub-id-type="pmid">15726096</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Expression of FOXP1 in epithelial ovarian cancer (EOC) and its correlation with chemotherapy resistance and prognosis</article-title>
        <source>Tumour Biol.</source>
        <year>2015</year>
        <volume>36</volume>
        <fpage>7269</fpage>
        <lpage>7275</lpage>
        <pub-id pub-id-type="doi">10.1007/s13277-015-3383-5</pub-id>
        <pub-id pub-id-type="pmid">25895457</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Choi</surname>
            <given-names>EJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>FOXP1 functions as an oncogene in promoting cancer stem cell-like characteristics in ovarian cancer cells</article-title>
        <source>Oncotarget</source>
        <year>2016</year>
        <volume>7</volume>
        <fpage>3506</fpage>
        <lpage>3519</lpage>
        <pub-id pub-id-type="doi">10.18632/oncotarget.6510</pub-id>
        <pub-id pub-id-type="pmid">26654944</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhu</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Gao</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Gene expression profile analysis identifies metastasis and chemoresistance-associated genes in epithelial ovarian carcinoma cells</article-title>
        <source>Med. Oncol.</source>
        <year>2015</year>
        <volume>32</volume>
        <fpage>426</fpage>
        <pub-id pub-id-type="doi">10.1007/s12032-014-0426-5</pub-id>
        <pub-id pub-id-type="pmid">25502083</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Imrich</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hachmeister</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gires</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>EpCAM and its potential role in tumor-initiating cells</article-title>
        <source>Cell Adh. Migr.</source>
        <year>2012</year>
        <volume>6</volume>
        <fpage>30</fpage>
        <lpage>38</lpage>
        <pub-id pub-id-type="doi">10.4161/cam.18953</pub-id>
        <pub-id pub-id-type="pmid">22647938</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tayama</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The impact of EpCAM expression on response to chemotherapy and clinical outcomes in patients with epithelial ovarian cancer</article-title>
        <source>Oncotarget</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>44312</fpage>
        <lpage>44325</lpage>
        <pub-id pub-id-type="doi">10.18632/oncotarget.17871</pub-id>
        <pub-id pub-id-type="pmid">28574829</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Latifi</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cisplatin treatment of primary and metastatic epithelial ovarian carcinomas generates residual cells with mesenchymal stem cell-like profile</article-title>
        <source>J. Cell. Biochem.</source>
        <year>2011</year>
        <volume>112</volume>
        <fpage>2850</fpage>
        <lpage>2864</lpage>
        <pub-id pub-id-type="doi">10.1002/jcb.23199</pub-id>
        <pub-id pub-id-type="pmid">21618587</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TGF-β Signaling and Resistance to Cancer Therapy</article-title>
        <source>Front Cell Dev Biol</source>
        <year>2021</year>
        <volume>9</volume>
        <fpage>786728</fpage>
        <pub-id pub-id-type="doi">10.3389/fcell.2021.786728</pub-id>
        <pub-id pub-id-type="pmid">34917620</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tran</surname>
            <given-names>HTN</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A benchmark of batch-effect correction methods for single-cell RNA sequencing data</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>12</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1850-9</pub-id>
        <?supplied-pmid 31948481?>
        <pub-id pub-id-type="pmid">31948481</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>19</volume>
        <fpage>41</fpage>
        <lpage>50</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01336-8</pub-id>
        <pub-id pub-id-type="pmid">34949812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA sequencing reveals the tissue architecture in human high-grade serous ovarian cancer</article-title>
        <source>Clin. Cancer Res.</source>
        <year>2022</year>
        <volume>28</volume>
        <fpage>3590</fpage>
        <lpage>3602</lpage>
        <pub-id pub-id-type="doi">10.1158/1078-0432.CCR-22-0296</pub-id>
        <pub-id pub-id-type="pmid">35675036</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lachmann</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Giorgi</surname>
            <given-names>FM</given-names>
          </name>
          <name>
            <surname>Lopez</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Califano</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>ARACNe-AP: gene network reverse engineering through adaptive partitioning inference of mutual information</article-title>
        <source>Bioinformatics</source>
        <year>2016</year>
        <volume>32</volume>
        <fpage>2233</fpage>
        <lpage>2235</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw216</pub-id>
        <pub-id pub-id-type="pmid">27153652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Duchi</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hazan</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Singer</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Adaptive subgradient methods for online learning and stochastic optimization</article-title>
        <source>J. Mach. Learn. Res</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>2121</fpage>
        <lpage>2159</lpage>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <mixed-citation publication-type="other">Ceglia, N. et al. Processed files for Identification of transcriptional programs using dense vector representations defined by mutual information with GeneVector. <italic>Release Zenodo</italic>. 10.5281/zenodo.8079610 (2023).</mixed-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <mixed-citation publication-type="other">Ceglia, N. et al. nceglia/genevector: v0.0.1. Release Zenodo. 10.5281/zenodo.8079885 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10359421</article-id>
    <article-id pub-id-type="pmid">37474509</article-id>
    <article-id pub-id-type="publisher-id">39985</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-39985-2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Identification of transcriptional programs using dense vector representations defined by mutual information with GeneVector</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Ceglia</surname>
          <given-names>Nicholas</given-names>
        </name>
        <address>
          <email>ceglian@mskcc.org</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Sethna</surname>
          <given-names>Zachary</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Freeman</surname>
          <given-names>Samuel S.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Uhlitz</surname>
          <given-names>Florian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bojilova</surname>
          <given-names>Viktoria</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2663-6288</contrib-id>
        <name>
          <surname>Rusk</surname>
          <given-names>Nicole</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Burman</surname>
          <given-names>Bharat</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1151-2450</contrib-id>
        <name>
          <surname>Chow</surname>
          <given-names>Andrew</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Salehi</surname>
          <given-names>Sohrab</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kabeer</surname>
          <given-names>Farhia</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Aparicio</surname>
          <given-names>Samuel</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6153-8793</contrib-id>
        <name>
          <surname>Greenbaum</surname>
          <given-names>Benjamin D.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6402-523X</contrib-id>
        <name>
          <surname>Shah</surname>
          <given-names>Sohrab P.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>McPherson</surname>
          <given-names>Andrew</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Computational Oncology, Department of Epidemiology and Biostatistics, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Immuno-Oncology Service, Human Oncology and Pathogenesis Program, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Hepatopancreatobiliary Service, Department of Surgery, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Department of Medicine, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Department of Medicine, Thoracic Oncology Service, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="GRID">grid.248762.d</institution-id><institution-id institution-id-type="ISNI">0000 0001 0702 3000</institution-id><institution>Department of Molecular Oncology, British Columbia Cancer Research Centre, Vancouver, </institution></institution-wrap>British Columbia, Canada </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="GRID">grid.17091.3e</institution-id><institution-id institution-id-type="ISNI">0000 0001 2288 9830</institution-id><institution>Department of Pathology and Laboratory Medicine, </institution><institution>University of British Columbia, Vancouver, </institution></institution-wrap>British Columbia, Canada </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="GRID">grid.5386.8</institution-id><institution-id institution-id-type="ISNI">000000041936877X</institution-id><institution>Physiology, Biophysics &amp; Systems Biology, </institution><institution>Weill Cornell Medicine, Weill Cornell Medical College, </institution></institution-wrap>New York, NY USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>20</day>
      <month>7</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>7</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>4400</elocation-id>
    <history>
      <date date-type="received">
        <day>8</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>4</day>
        <month>7</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Deciphering individual cell phenotypes from cell-specific transcriptional processes requires high dimensional single cell RNA sequencing. However, current dimensionality reduction methods aggregate sparse gene information across cells, without directly measuring the relationships that exist between genes. By performing dimensionality reduction with respect to gene co-expression, low-dimensional features can model these gene-specific relationships and leverage shared signal to overcome sparsity. We describe GeneVector, a scalable framework for dimensionality reduction implemented as a vector space model using mutual information between gene expression. Unlike other methods, including principal component analysis and variational autoencoders, GeneVector uses latent space arithmetic in a lower dimensional gene embedding to identify transcriptional programs and classify cell types. In this work, we show in four single cell RNA-seq datasets that GeneVector was able to capture phenotype-specific pathways, perform batch effect correction, interactively annotate cell types, and identify pathway variation with treatment over time.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">In single-cell RNA-seq analyses, it would be critical to measure the relationships between genes. Here, the authors develop a framework for single-cell dimensionality reduction that incorporates gene-specific relationships - GeneVector -, and use it for tasks such as annotating cell types and analysing pathway variation after treatment.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Machine learning</kwd>
      <kwd>Software</kwd>
      <kwd>Cancer genomics</kwd>
      <kwd>Tumour heterogeneity</kwd>
      <kwd>Transcriptomics</kwd>
    </kwd-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Maintenance of cell state and execution of cellular function are based on coordinated activity within networks of related genes. To approximate these connections, transcriptomic studies have conceptually organized the transcriptome into sets of co-regulated genes, termed gene programs<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> or metagenes<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. The first intuitive step to identify such co-regulated genes is the reduction of dimensionality for sparse expression measurements: high dimensional gene expression data is compressed into a minimal set of explanatory features that highlight similarities in cellular function. However, to map existing biological knowledge to each cell, the derived features must be interpretable at the gene level.</p>
    <p id="Par4">To find similarities in lower dimensions, biology can borrow from the field of natural language processing (NLP). NLP commonly uses dimensionality reduction to identify word associations within a body of text<sup><xref ref-type="bibr" rid="CR3">3</xref>,<xref ref-type="bibr" rid="CR4">4</xref></sup>. To find contextually similar words, NLP methods make use of vector space models to represent similarities in a lower dimensional space. Similar methodology has been applied to bulk RNA-seq expression for finding co-expression patterns<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>. Inspired by such work, we developed a tool that generates gene vectors based on single cell RNA (scRNA)-seq expression data. While current methods reduce dimensionality with respect to sparse expression across each cell, our tool produces a lower dimensional embedding with respect to each gene. The vectors derived from GeneVector provide a framework for identifying metagenes within a gene co-expression graph and relating these metagenes back to each cell using latent space arithmetic.</p>
    <p id="Par5">The most pervasive method for identifying the sources of variation in scRNA-seq studies is principal component analysis (PCA)<sup><xref ref-type="bibr" rid="CR6">6</xref>–<xref ref-type="bibr" rid="CR8">8</xref></sup>. The relationship of principal components to gene expression is linear, allowing lower dimensional structure to be directly related to variation in expression. A PCA embedding is an ideal input for building a nearest neighbor graph for unsupervised clustering algorithms<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> and visualization methods including t-SNE<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and UMAP<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>. However, the assumption of a continuous multivariate gaussian distribution creates distortion in modeling read counts generated by a true distribution that is over-dispersed, possibly zero-inflated<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, with positive support and mean close to zero<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. Despite such issues, gene programs generated from PCA loadings have been used to generate metagenes that explain each principal component<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. While these loadings highlight sets of genes that explain each orthogonal axis of variation, pathways and cell type signatures can be conflated within a single axis.</p>
    <p id="Par6">In addition to PCA, more sophisticated methods have been developed to better handle the specific challenges of scRNA data. The single cell variational inference (scVI) framework<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> generates an embedding using non-linear autoencoders that can be used in a range of analyses including normalization, batch correction, gene-dropout correction, and visualization. While scVI embeddings show improved performance over traditional PCA-based analysis in these tasks, they have a non-linear relationship to the original count matrix that may distort the link between structure in the generated embedding and potentially identifiable gene programs<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. A subsequent method uses a linearly decoded variational autoencoder (LDVAE), which combines a variational autoencoder with a factor model of negative binomial distributed read counts to learn an interpretable linear embedding of cell expression profiles<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. However, the relationship between gene expression and cell representation is still tied to correlated variation across cells, which may confound co-varying pathway and phenotypic signatures.</p>
    <p id="Par7">Recognizing the importance of modeling the non-linearity of gene expression and the complexity of statistical dependencies between genes, several methods have adopted information theoretical approaches. Many of these methods use mutual information (MI), an information theoretic measure of the statistical dependence between two variables. ARACNE<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> uses MI to prune independent and indirectly interacting genes during construction of a gene regulatory network from microarray expression data. PIDC<sup><xref ref-type="bibr" rid="CR16">16</xref></sup> identifies regulatory relationships using partial information decomposition (PID), a measure of the dependence between triples of variables. The authors apply PIDC to relatively high-depth single-cell qPCR datasets and restrict their analysis to on the order of hundreds of genes. More recently, IQCELL<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> uses MAGIC<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> to impute missing gene expression, builds a GRN from pairwise MI between genes, and applies a series of filters to produce a GRN composed of only functional relationships. The authors use IQCELL to identify known causal gene interactions in scRNA-seq data from mouse T-cell and red blood cell development experiments. Because of the success of these methods, we hypothesized that MI could be combined with vector space models to produce a meaningful low dimensional representation of genes from scRNA data.</p>
    <p id="Par8">In this work, we present GeneVector (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) as a framework for generating low dimensional embeddings constructed from the mutual information between genes. GeneVector summarizes co-expression of genes as mutual information between the probability distribution of read counts across cells. We showcase GeneVector on four scRNA datasets produced from a diverse set of experiments: peripheral blood mononuclear cells (PBMCs) subjected to interferon beta stimulation<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, the Tumor Immune Cell Atlas (TICA)<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, treatment naive multi-site samples from High Grade Serous Ovarian Cancers (HGSOC)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> and a time series of cisplatin treatment in patient-derived xenografts (PDX) of triple negative breast cancer (TNBC)<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. We first confirm GeneVector’s ability to identify putatively co-regulated gene pairs from sparse single cell expression measurements using the TICA and PBMC datasets. We demonstrate that latent space arithmetic can be used to accurately label cell types in the TICA dataset and validate our cell type predictions against published annotations. Next, we show that GeneVector can identify metagenes corresponding to cell-specific transcriptional processes in PBMCs, including interferon activated gene expression (ISG). We use vector space arithmetic to directly map metagenes to site specific changes in primary and metastatic sites in the HGSOC dataset, capturing changes in MHC class I expression and epithelial-mesenchymal transition (EMT). Finally, we show GeneVector can identify cisplatin treatment dependent transcriptional programs related to TGF-beta in TNBC PDXs.<fig id="Fig1"><label>Fig. 1</label><caption><title>GeneVector Framework.</title><p>Overview of GeneVector framework starting from single cell read counts. Mutual information is computed on the joint probability distribution of read counts for each gene pair. Each pair is used to train a single layer neural network where the MSE loss is evaluated from the model output (<bold>w</bold><sub>1</sub><sup>T</sup><bold>w</bold><sub>2</sub>) with the mutual information between genes. From the resulting weight matrix, a gene embedding, cell embedding, and co-expression similarity graph are constructed. Using vector space arithmetic, downstream analyses include identification of cell-specific metagenes, batch effect correction, and cell type classification.</p></caption><graphic xlink:href="41467_2023_39985_Fig1_HTML" id="d32e538"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Defining the GeneVector framework</title>
      <p id="Par9">We trained a single layer neural network over all gene pairs to generate low dimensional gene embeddings and identify metagenes from a co-expression similarity graph. The input weights (<bold>w</bold><sub>1</sub>) and output weights (<bold>w</bold><sub>2</sub>) are updated with adaptive gradient descent (ADADELTA)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. Gene co-expression relationships are defined using mutual information (Methods<bold>:</bold> Mutual Information) computed from a joint probability distribution of expression counts. Training loss is evaluated as the mean squared error of mutual information with the model output, defined as <bold>w</bold><sub>1</sub><sup>T</sup><bold>w</bold><sub>2</sub>. The final latent space is a matrix defined as a series of vectors for each gene.</p>
      <p id="Par10">Gene vectors produced by the framework are useful for several fundamental gene expression analyses. Gene vectors weighted by expression in each cell are combined to generate the cell embedding analysis of cell populations and their relationships to experimental covariates. The cell embedding can be batch corrected by using vector arithmetic to identify vectors that represent batch effects and then shift cells in the opposite direction (Methods<bold>:</bold> Batch correction). A co-expression graph is constructed in which each node is defined as a gene and each edge is weighted by cosine similarity. After generating the co-expression graph, we use Leiden clustering<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> to identify metagene clusters. Further downstream analysis of the cell embedding includes phenotype assignment based on sets of marker genes and computation of the distances between cells and metagenes to highlight changes related to experimental covariates (Fig. <xref rid="Fig1" ref-type="fig">1</xref>).</p>
      <p id="Par11">To perform cell type assignment, a set of known marker genes is used to generate a representative vector for each cell type, where each gene vector is weighted by the normalized and log-transformed gene expression. The cosine similarity of each possible phenotype is computed between the cell vector and the marker gene vector. SoftMax is applied to cosine distances to obtain a pseudo-probability over each phenotype (Methods: Cell type assignment). Discrete labels can be assigned to cells by selecting the phenotype corresponding to the maximum pseudo-probability. More generally, gene vectors can be composed together to describe interesting gene expression features. Cell or gene vectors can then be compared against these feature vectors to evaluate the relevance of that feature to a given cell or gene (Methods: Generation of Predictive Genes).</p>
    </sec>
    <sec id="Sec4">
      <title>Robust inference of gene co-regulation with GeneVector</title>
      <p id="Par12">Our model relies on the advantages of mutual information to define relationships between genes, as opposed to other distance metrics. To evaluate how MI contributes to the observed performance of the model, we first validated that the vectors inferred by GeneVector capture semantic qualities of genes including pathway memberships and regulatory relationships. Specifically, we assessed the extent to which pairs of genes within the same pathway, or expressed within the same cell types, produced similar vector representations in the PBMC dataset. As a ground truth we computed, for each gene pair, the number of combined pathways from Reactome<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> and MSigDB<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup> cell type signatures (C8) for which both genes were members. In addition to training GeneVector using raw read counts with an MI target, we trained GeneVector using normalized and log-transformed read counts on Pearson correlation coefficient to evaluate the relative benefit of MI on the accuracy of the model output. For both the correlation and MI based models, cosine similarities between gene vectors showed a stronger relationship with the number of shared pathways and cell type signatures than randomly shuffled gene pairs (Fig. <xref rid="Fig2" ref-type="fig">2A, C</xref>). Comparing the MI model and the correlation model directly, the MI model produced a much stronger relationship than the correlation based model (r<sup>2</sup> = 0.233 vs. r<sup>2</sup> = 0.093, Fig. <xref rid="Fig2" ref-type="fig">2B, D</xref>). To provide a pathway specific example, we found that the most similar genes by cosine similarity to <italic>IFIT1</italic> (a known interferon stimulated gene) using the correlation objective were less coherent in terms of ISG pathway membership signal (6 of 16 genes were in the Interferon Signaling Reactome pathway R-HSA-913531) (Fig. <xref rid="Fig2" ref-type="fig">2E</xref>) than with mutual information (12 of 16 genes) (Fig. <xref rid="Fig2" ref-type="fig">2F</xref>). The greater proportion of interferon stimulated pathway genes with high similarity to <italic>IFIT1</italic> using a mutual information objective function (Fig. <xref rid="Fig2" ref-type="fig">2F</xref> vs. <xref rid="Fig2" ref-type="fig">2E</xref>) is consistent with the improved correlation between pathway co-membership and cosine similarity over the Pearson correlation coefficient objective (Fig. <xref rid="Fig2" ref-type="fig">2D</xref> vs. <xref rid="Fig2" ref-type="fig">2FB</xref>).<fig id="Fig2"><label>Fig. 2</label><caption><title>Comparison of Results using Mutual Information.</title><p><bold>A</bold>–<bold>D</bold> Pathway co-membership vs. cosine similarity between gene vectors for all gene pairs in PBMCs. Each point represents one gene pair, and plots show the number of pathways (combined Reactome and MSigDB cell type signatures [C8]) that contain both genes (y-axis) and the cosine distance between the two genes (x-axis). The results show both correlation <bold>A</bold>, <bold>B</bold> and MI (Mutual Information) <bold>C</bold>, <bold>D</bold> based GeneVector. In addition to a standard set of results <bold>B</bold>, <bold>D</bold>, a baseline relationship between pathway co-membership and cosine similarity is established by performing an identical analysis over randomly shuffled gene <bold>A</bold>, <bold>C</bold>. <bold>E</bold> Top 16 most similar genes by cosine similarity to IFIT1 using correlation coefficient. Genes in the interferon signaling pathway are colored orange. <bold>F</bold> Top 16 most similar genes to IFIT1 after training GeneVector using mutual information shows a higher number of interferon signaling pathway genes. <bold>G</bold>, <bold>H</bold> Cosine similarity and Pearson correlation coefficient for un-annotated gene pairs (<italic>n</italic> = 314090), ChIP-Seq annotated TF-targets pairs (<italic>n</italic> = 1275), and literature annotated activator (<italic>n</italic> = 26) or repressor (<italic>n</italic> = 26) TF-target pairs. The center of the box plot is denoted by the median, a horizontal line dividing the box into two equal halves. The bounds of the box are defined by the lower quartile (25th percentile) and the upper quartile (75th percentile). The whiskers extend from the box and represent the data points that fall within 1.5 times the interquartile range (IQR) from the lower and upper quartiles. Any data point outside this range is considered an outlier and plotted individually. Significance assessed using Mann-Whitney-Wilcoxon two-sided test. <bold>I</bold> Cosine similarity versus correlation coefficient for gene pairs in the TICA (Tumor Immune Cell Atlas) dataset with TF-target gene pairs highlighted (blue) and colored by activator/repressor status (green/orange respectively). <bold>J</bold>, <bold>K</bold> Linear regression of mean log-normalized expression per cell type±95% confidence interval for repressor TF-target pair <italic>SOCS3</italic>-<italic>STAT4</italic> and activator TF-target pair <italic>KLF-THBD</italic>, respectively. <bold>L</bold> Mean log-normalized expression for <italic>SOCS3-STAT4</italic> and <italic>KLF4-THBD</italic> across annotated cell types. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig2_HTML" id="d32e738"/></fig></p>
      <p id="Par13">Next, we sought to understand whether GeneVector was able to capture relationships between genes with known interactions such as transcription factors (TF) and their targets. GeneVector cosine similarities of TF-target pairs annotated based on ChIP-Seq data<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> were significantly increased relative to un-annotated gene pairs in the TICA dataset (Fig. <xref rid="Fig2" ref-type="fig">2G</xref>). We also considered literature annotated activator-target and repressor-target TF-target gene pairs<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. As expected, activator-target pairs showed increased cosine similarity above unannotated pairs. Importantly, repressor-target pairs showed an equally strong increase in cosine similarity above unannotated pairs highlighting GeneVector’s ability to identify a diversity of statistical dependencies between co-regulated genes. By comparison, Pearson correlation coefficients of ChIP-seq annotated TF-target pairs were not significantly different from unannotated gene pairs (Fig. <xref rid="Fig2" ref-type="fig">2H</xref>). Both activator-target and repressor-target pairs were significantly different from unannotated pairs, though correlation was on-average positive for both repressor-target and activator-target pairs (Fig. <xref rid="Fig2" ref-type="fig">2H</xref>). In fact, while many repressor-target pairs had high cosine similarity indicative of a meaningful regulatory relationship, their correlation coefficients, computed with normalized and log-transformed counts, were always positive (Fig. <xref rid="Fig2" ref-type="fig">2I</xref>). For example, <italic>SOCS3</italic>-<italic>STAT4</italic> exhibited the lowest correlation of annotated repressor-target pairs (<italic>r</italic><sup>2</sup> = 0.017) and aggregating normalized and log-transformed expression across cell types showed an absence of any relationship between these genes (Fig. <xref rid="Fig2" ref-type="fig">2J</xref>). In contrast, analysis of activator-target pair <italic>KLF4</italic>-<italic>THBD</italic> revealed a positive correlation driven by co-expression in myeloid cells and T cells (Fig. <xref rid="Fig2" ref-type="fig">2K</xref>). This relationship is further evidenced when looking at the expression in more detailed cell type annotations (Fig. <xref rid="Fig2" ref-type="fig">2L</xref>). Identification of mutually exclusive expression is a theoretical benefit of correlation-based similarity measures, however, the sparsity of scRNA likely results in positive or low correlation even for known examples of mutual exclusivity. In summary, the vector space produced by GeneVector successfully recovers the latent similarities between functionally related genes, including negative regulators and their targets, overcoming the sparsity of scRNA data that confounds simpler approaches.</p>
    </sec>
    <sec id="Sec5">
      <title>Fast and accurate cell type classification using GeneVector</title>
      <p id="Par14">Comparative analysis of gene expression programs across large cohorts of patients can potentially identify transcriptional patterns in common cell types shared between many cancers. However, classification of cell types using methods such as CellAssign<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> are computationally expensive. Furthermore, the large number of covariates in these datasets makes disentangling patient-specific signals from disease and therapy difficult. GeneVector provides a fast and accurate method of cell type classification. We perform cell type classification on a subset of 23,764 cells from the Tumor Immune Cell Atlas (TICA) composed of 181 patients and 18 cancer types<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>. The dataset was subset to 2000 highly variable genes and the unnormalized read counts were used train GeneVector. Cell vectors were generated by weighting each gene vector by the normalized and log-transformed expression per cell. Cell types were summarized into three main immune cell types: T cells, B/Plasma, and Myeloid cells (Fig. <xref rid="Fig3" ref-type="fig">3A</xref>) from the original annotations (Fig. <xref rid="Fig3" ref-type="fig">3B</xref>). We selected a set of gene markers for each cell type (T cells: <italic>CD3D</italic>, <italic>CD3G</italic>, <italic>CD3E</italic>, <italic>TRAC</italic>, <italic>IL32</italic>, <italic>CD2</italic>; B cells: <italic>CD79A</italic>, <italic>CD79B</italic>, <italic>MZB1</italic>, <italic>CD19</italic>, <italic>BANK1</italic>; and Myeloid cells: <italic>LYZ</italic>, <italic>CST3</italic>, <italic>AIF1</italic>, <italic>CD68</italic>, <italic>C1QA</italic>, <italic>C1QB</italic>, <italic>C1QC</italic>) based on signatures obtained from CellTypist<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. For each phenotype and each cell, we computed the cosine distance to the log-normalized expression weighted average of the marker gene vectors. The pseudo-probabilities for the three cell types are generated by applying a SoftMax function to the set of cosine distances. The maximum pseudo-probability is used to classify each cell into T cell, B/Plasma, or Myeloid (Fig. <xref rid="Fig3" ref-type="fig">3C</xref>).<fig id="Fig3"><label>Fig. 3</label><caption><title>GeneVector Accurately Classifies Cells in TICA Cell Atlas.</title><p><bold>A</bold> Cells annotated by cell type summarized from the original TICA provided annotations. <bold>B</bold> Original annotations provided in TICA (Tumor Immune Cell Atlas). <bold>C</bold> GeneVector classification results for each cell type. <bold>D</bold> Confusion matrix comparing GeneVector classification with summarized cell types. <bold>E</bold> Confusion matrix using the same gene markers with CellAssign shows decreased performance in myeloid cells. <bold>F</bold> Pseudo-probability values for each summarized cell type. <bold>G</bold> Marker gene log-normalized expression over all cells grouped by GeneVector classification. <bold>H</bold> Original annotations reassigned by GeneVector. <bold>I</bold> Marker gene mean log-normalized expression for cell type reassignments highlights misclassifications in B/Plasma cells and doublet transcriptional signatures in T and myeloid cells. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig3_HTML" id="d32e910"/></fig></p>
      <p id="Par15">To assess performance, we computed accuracy against the coarse labels in a confusion matrix as the percentage of correctly classified cells over the total number cells for each summarized cell type. We found 97.1% of T cells, 95% of myeloid cells, and 94.3% of B/Plasma cells were correctly classified with respect to the original annotations (Fig. <xref rid="Fig3" ref-type="fig">3D</xref>). Additionally, we classified cells using the same marker genes with CellAssign and found significantly decreased performance in the classification of myeloid cells (85.6%) (Fig. <xref rid="Fig3" ref-type="fig">3E</xref>). Overall, the percentage of cells misclassified using GeneVector (3.977%) showed improvement over CellAssign (7.54%). Using the pseudo-probabilities, GeneVector can highlight cells that share gene signatures including plasmacytoid dendritic cells (pDCs), where cell type definition is difficult<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> (Fig. <xref rid="Fig3" ref-type="fig">3F</xref>). For each cell type, we validated that the classified cells are indeed expressing the supplied markers by showing the normalized and log-transformed expression for each marker grouped by classified cell type (Fig. <xref rid="Fig3" ref-type="fig">3G</xref>). For those cells GeneVector reassigned from the original annotations (Fig. <xref rid="Fig3" ref-type="fig">3H</xref>), we examined the mean normalized and log-transformed expression per marker gene and found that many of these cells appear misclassified in original annotations (Fig. <xref rid="Fig3" ref-type="fig">3I</xref>). Cells originally annotated as T cells that were reassigned as B/Plasma by GeneVector show high expression for only B/Plasma markers (<italic>CD19</italic>, <italic>BANK1</italic>, <italic>CD79A</italic>, and <italic>CD79B</italic>). Additionally, there is evidence that many of these reassigned cells may be doublets. B/Plasma cells reassigned to T or myeloid cells show simultaneous expression of both gene markers. While any computational cell type classification cannot be considered ground truth, cell type assignment with GeneVector is an improvement over CellAssign and demonstrates sensitivity to cells that express overlapping cell type transcriptional signatures.</p>
      <p id="Par16">Next, we benchmarked GeneVector’s cell type assignment performance with respect to four input types: raw read counts, log-transformed raw counts, normalized total counts per cell, and normalized total counts per cell with log-transformation. We evaluated each approach on the original TICA dataset, in addition to a series of datasets for which we artificially generated a library size batch effect by down sampling reads in subsets of cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1A–E</xref>). Performance was evaluated by calculating cell type assignment accuracy and by ranking gene pairs by cosine similarity for annotated co-expressed and mutually exclusive gene pairs using CellTypist (Methods: Coexpressed and Mutually Exclusive Markers)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. Evaluating gene pair rankings on repeat trained models of the full TICA dataset, we find that all four preprocessing types show a similar ranking of co-expressed gene pairs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1A</xref>, left). Interestingly, raw counts produce significantly lower rankings for mutually exclusive gene pairs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1A</xref>, right). When introducing an artificial batch effect, we find that raw counts generate significantly lower rankings for mutually exclusive marker pairs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2B</xref>). Next, we compared the cell type prediction accuracy between normalization procedures using the same gene markers used to perform cell type prediction in the main results section on both the full and subset datasets with artificial batch effect. Raw counts significantly outperformed all other preprocessing inputs by a large margin, with both normalized and log-normalized showing very poor performance (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2C, D</xref>). Our results suggest that normalization increases association between pairs of genes with mutually exclusive expression, resulting in negative downstream performance of cell type prediction. Cell typing appears to be sensitive to mutual exclusivity of cell type markers, and normalization produces slight increases in cosine similarity between gene vectors of mutually exclusive genes resulting in poor cell typing accuracy.</p>
      <p id="Par17">After learning the gene embedding, GeneVector allows rapid testing of different marker genes and phenotypes in exploratory analysis settings. Increased performance in classification is important given the large variation of markers used to define the same phenotypes across different studies. Cell type prediction can be recomputed interactively within a Jupyter notebook within twenty seconds for even large datasets on most machines (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). An additional advantage of having a probability is the ability to map genes from known pathways to a continuous value in each cell. In both phenotype and pathway, demonstration of continuous gradients across cells provides a measure of change and activation that cannot be seen from unsupervised clustering.</p>
    </sec>
    <sec id="Sec6">
      <title>Comparison of Methods in Identification of Interferon Metagenes in 10k Human PBMCs</title>
      <p id="Par18">To identify cell-specific metagenes related to interferon beta stimulation and compare with transcriptional programs identified by PCA and LDVAE loadings, we trained GeneVector using peripheral blood mononuclear cells (PBMCs) scRNA-seq data from 6855 quality control filtered cells composed of an interferon beta stimulated sample and a control sample<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. The raw count matrix was subset to 1000 highly variable genes using the Seurat V3 method<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> as implemented in Scanpy<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. We used previously annotated cell types generated from unsupervised clustering as ground truth labels<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The cell embedding used for batch correction was generated by weighting gene vectors by the normalized, log-transformed expression in each cell. A comparison of the uncorrected UMAP embedding (Fig. <xref rid="Fig4" ref-type="fig">4A</xref>) and subsequent GeneVector-based batch correction (Fig. <xref rid="Fig4" ref-type="fig">4B</xref>) demonstrates correction in the alignment of cell types between the two conditions. However, in contrast to batch correction using Harmony<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> (Fig. <xref rid="Fig4" ref-type="fig">4C</xref>), not all variation is lost between the interferon beta stimulated and control cells. Specifically, GeneVector does not align myeloid cell types, suggesting a larger effect of the interferon beta stimulation treatment in these cells. Finally, we explored the impact of cell type composition on batch correction performance and found that CD14+ Monocytes had the largest batch silhouette coefficient, indicating that stimulated and control Monocytes differed the most across cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6G</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Comparing Methods with Interferon Beta Stimulated 10 K PBMC.</title><p><bold>A</bold> Uncorrected GeneVector UMAPs showing stimulated condition (left) and cell type annotation (right) on 10k PBMCs with control and interferon beta stimulated cells. <bold>B</bold> GeneVector batch corrected UMAPs showing stimulated condition (left) and cell type annotation (right) indicated stronger interferon-beta stimulated response in myeloid cells. <bold>C</bold> Harmony batch correction applied to normalized expression eliminates all variation related to interferon beta stimulation. <bold>D</bold> Most similar genes by cosine similarity to <italic>IFIT1</italic> includes genes found in Reactome interferon related pathways. <bold>E</bold> Gene embedding UMAP highlighting an ISG (interferon stimulated genes) metagene that includes genes most similar to <italic>IFIT1</italic>. <bold>F</bold> Scaled log-normalized expression of ISG (interferon stimulated gene) metagene shows increased expression across stimulated cells without cell type specific effects. <bold>G</bold> PCA embedding colored by cell type (left) and stimulation (right). <bold>H</bold> Top genes by contribution to variance indicates PC1 defines cell type. <bold>I</bold> Top genes by contribution to PC2 defined by ISG stimulation colored by scaled normalized, log-transformed gene expression scaled by variable. <bold>J</bold>, <bold>K</bold> Scaled normalized, log-transformed expression scaled by variable of ISG related loadings from PCA (left) and LDVAE (right) includes cell type specific markers intermixed with ISGs. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig4_HTML" id="d32e1063"/></fig></p>
      <p id="Par19">As a method of both validation and exploration, GeneVector provides the ability to query similarity in genes. For a given target gene, a list of the closest genes sorted by cosine similarity can be generated. This is useful in both validating known markers and identifying the function of unfamiliar genes by context. The genes most similar to IFIT1 (Fig. <xref rid="Fig4" ref-type="fig">4D</xref>) include a large proportion of genes found in the Reactome pathway Interferon Signaling (R-I-913531) (Gillespie et al. 2022). After clustering gene vectors, we identify a single metagene that includes these genes (<italic>IFIT1</italic>, <italic>IFIT2</italic>, <italic>IFIT3</italic>, <italic>ISG15</italic>, <italic>ISG20</italic>, <italic>TFGS10</italic>, <italic>RSAD2</italic>, <italic>LYSE</italic>, <italic>OAS1</italic>, and <italic>MX1</italic>). The ISG metagene can be visualized on a UMAP generated from the gene embedding, like the familiar cell-based visualizations common in scRNA-seq studies (Fig. <xref rid="Fig4" ref-type="fig">4E</xref>). The mean and scaled log-normalized expression of each gene identified in the ISG metagene is significantly higher in interferon beta stimulated cells over control cells (Fig. <xref rid="Fig4" ref-type="fig">4F</xref>). Importantly, the increased expression is found in each cell type, indicating a global relation to treatment.</p>
      <p id="Par20">To compare the ISG metagene with results generated from PCA loadings, we performed PCA on the normalized and log-transformed gene-by-cell expression matrix (Fig. <xref rid="Fig4" ref-type="fig">4G</xref>) and colored the embedding by cell type and treatment. After computing the PCA loadings using Scanpy<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, we identified the top genes by contribution score to variation in the first and second principal components. The first principal component (PC1) explains variation related to cell type and the differences between myeloid (<italic>TYROBP</italic>, <italic>FCER1G</italic>, <italic>FTL</italic>, <italic>CST3</italic>) and T cells <italic>(LTB</italic>, <italic>CCR7</italic>) (Fig. <xref rid="Fig4" ref-type="fig">4H</xref>). The second principal highlights the variation related to interferon beta stimulation and includes the genes found in the ISG metagene generated by GeneVector (Fig. <xref rid="Fig4" ref-type="fig">4I</xref>). However, the increased effect of interferon stimulation in myeloid cells, conflates myeloid specific ISGs with the interferon signature. One such gene is <italic>CXCL10</italic>, which shows cell type specificity to myeloid cells (Fig. <xref rid="Fig4" ref-type="fig">4J</xref>) and is not found in the interferon signaling Reactome pathways. Additionally, <italic>IFITM3</italic> shows increased expression only in myeloid cells within these PBMCs. In contrast, GeneVector produces a metagene that groups myeloid specific genes into a single metagene including <italic>CXCL10</italic> and <italic>IFITM3</italic>. A full list of metagenes produced by GeneVector is presented in Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>. Among these metagenes, we identify transcriptional programs specific to each cell type and treatment condition, including those found in the least represented cell type Megakaryocytes (132 of 14,038 cells).</p>
      <p id="Par21">To compare the GeneVector ISG metagene with LDVAE, we trained an LDVAE model using 10 latent dimensions for 250 epochs with control and stimulated batch labels in the SCVI framework on the unnormalized read counts. In contrast to the specificity of the GeneVector ISG metagene that includes only interferon stimulated genes, the nearest LDVAE loading mixes interferon-related genes with markers of T cell activation (<italic>PRF1</italic>) and T cell dysfunction (<italic>LAG3</italic>) (Fig. <xref rid="Fig4" ref-type="fig">4K</xref>). With respect to PCA and LDVAE loadings, GeneVector identified an ISG metagene that is not confounded by cell type and includes only interferon pathway related genes.</p>
    </sec>
    <sec id="Sec7">
      <title>Metagenes changes between primary and metastatic site in HGSOC</title>
      <p id="Par22">Studies with scRNA-seq data sampled from multiple tumor sites in the same patient provide a wide picture of cancer progression and spread. As these datasets grow larger and more complex, understanding the transcriptional changes that occur from primary to metastatic sites can help identify mechanisms that aid in the process of the invasion-metastasis cascade. GeneVector provides a framework for asking such questions in the form of latent space arithmetic. By defining the difference between two sites as a vector, where the direction defines transcriptional change, we identify metagenes associated with expression loss and gain between primary and metastasis sites from six patients in the Memorial Sloan Kettering Cancer Center SPECTRUM cohort of patients with high-grade serous ovarian cancer (HGSOC)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>.</p>
      <p id="Par23">A set of 270,833 cells quality control filtered cells from adnexa (primary) and bowel (metastasis) samples were processed with GeneVector (Fig. <xref rid="Fig5" ref-type="fig">5A</xref>). The unnormalized counts were subset to 2000 highly variable genes were used as input to GeneVector and cells were classified to one of six cell types using gene markers curated for HGSOC and two markers for cancer cells (<italic>EPCAM</italic> and <italic>CD24</italic>)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. We performed cell type classification (Methods: Cell Type Assignment) and compared GeneVector accuracy to the original annotations generated from CellAssign for each cell type in a confusion matrix (Fig. <xref rid="Fig5" ref-type="fig">5B</xref>). Accuracy reached 99.7% in three cell types with a minimum classification rate of 94.1%. In cells where GeneVector annotated differently than previous annotations, there is evidence from the differentially expressed genes that these cells may have been initially mislabeled. GeneVector reassigned a subset of cancer cells to fibroblast and the differentially expressed genes between these cells and the cells annotated as cancer by GeneVector highlighted fibroblast cell type markers including <italic>COL1A1</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4A</xref>). In B/Plasma cells reassigned as T cells, the differentially expressed genes highlight B cell receptor genes <italic>IGK</italic> and <italic>IGLC2</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4B</xref>). Finally, in B/Plasma cells classified as myeloid, the top differentially expressed genes include known canonical markers for macrophage/monocyte cells (<italic>TYROBP</italic>, <italic>LYZ</italic>, <italic>CD4</italic>, and <italic>AIF1</italic>)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4C</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>Metagenes Associated with Directional Difference in HGSOC Cancer Cells from Adnexa to Bowel.</title><p><bold>A</bold> UMAP of HGSOC cells with classified by GeneVector. <bold>B</bold> Uncorrected UMAP of cancer cells from patients with adnexa and bowel samples. <bold>C</bold> GeneVector batch corrected UMAP with patient labels on site labels on batch corrected UMAP. <bold>D</bold> Confusion matrix of accuracy comparing SPECTRUM annotated cell types with GeneVector classification. <bold>E</bold> Hallmark pathway enrichment for top 30 metagenes by cosine similarity to <bold>V</bold><sub>adnexa</sub> – <bold>V</bold><sub>bowel</sub>. <bold>F</bold> Hallmark pathway enrichment for top 30 metagenes by cosine similarity to <bold>V</bold><sub>bowel</sub> – <bold>V</bold><sub>adnexa</sub>. <bold>G</bold> Pseudo-probabilities for metagenes associated with up-regulation in bowel to adnexa (Epithelial-to-Mesenchymal Transition) and down-regulation (Major Histocompatibility Class I). <bold>H</bold> EMT (Epithelial-Mesenchymal Transition) metagene significantly up regulated in four of six patients by gene module score. <bold>I</bold> MHC Class I (MHCI) metagene significantly downregulated in the metastatic site (bowel) in three of six patients by gene module score. Source data provided as a Source Data file. The center of the box plot is denoted by the median, a horizontal line dividing the box into two equal halves. The bounds of the box are defined by the lower quartile (25th percentile) and the upper quartile (75th percentile). The whiskers extend from the box and represent the data points that fall within 1.5 times the interquartile range (IQR) from the lower and upper quartiles. Any data point outside this range is considered an outlier and plotted separately. Significance assessed using Mann-Whitney-Wilcoxon two-sided test.</p></caption><graphic xlink:href="41467_2023_39985_Fig5_HTML" id="d32e1292"/></fig></p>
      <p id="Par24">We recomputed the gene embedding and metagenes on only those cells classified as cancer by GeneVector with both adnexa and bowel samples. We found these cells exhibited large patient specific batch effects (Fig. <xref rid="Fig5" ref-type="fig">5C</xref>) and applied GeneVector batch correction (Fig. <xref rid="Fig5" ref-type="fig">5D, E</xref>). To understand the changes between primary and metastatic sites, we computed an average vector for all cells from the adnexa (<bold>V</bold><sub>adnexa</sub>) as the primary site and bowel (<bold>V</bold><sub>bowel</sub>) as the site of metastasis. We mapped the top 30 most similar metagenes to vectors representing expression gain in metastasis (<bold>V</bold><sub>adnexa</sub> - <bold>V</bold><sub>bowel</sub>) (Fig. <xref rid="Fig5" ref-type="fig">5F</xref>) and expression loss (v<sub>bowel</sub> - v<sub>adnexa</sub>) (Fig. <xref rid="Fig5" ref-type="fig">5G</xref>). Gene Set Enrichment Analysis (GSEA) using GSEAPY with Hallmark gene set annotations from Enrichr<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> was performed to assess whether metagenes were enriched for genes from known pathways. Metagenes enriched for E2F targets and Epithelial-to-Mesenchymal Transition (EMT) pathway genes were found gained in metastasis. Conversely, the set of metagenes representative of loss from adnexa to bowel included MHC Class I (<italic>HLA-A</italic>, <italic>HLA-B</italic>, <italic>HLA-C</italic>, <italic>HLA-E</italic>, and <italic>HLA-F</italic>) and the transcriptional regulator <italic>B2M</italic>, suggesting a means of immune escape via loss of MHC Class I expression and higher immune pressure in metastatic sites may increase the potential fitness benefit of MHC Class I loss. For both the EMT and MHCI metagenes, pseudo-probabilities computed using GeneVector highlight pathway activity in either site in the UMAP embedding (Fig. <xref rid="Fig5" ref-type="fig">5H</xref><bold>)</bold>. Computing the gene module scoring on the normalized, log-transformed expression<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>, we examined the change between sites in each patient for the EMT and MHCI metagenes. We found that the MHCI metagene is significantly downregulated in metastatic sites in four of six patients (Fig. <xref rid="Fig5" ref-type="fig">5I</xref>). Conversely, the EMT metagene was significantly up regulated in metastatic sites for three of six patients (Fig. <xref rid="Fig5" ref-type="fig">5J</xref>). The ability to phrase questions about transcriptional change as vector arithmetic provides a powerful platform for more complex queries than can be performed with differential expression analysis alone.</p>
      <p id="Par25">It is possible to perform latent space arithmetic operations on any embedding that is computed from a linear transformation of the gene space, including PCA. To assess the performance of latent space arithmetic using GeneVector and the principal components of a PCA decomposition of the gene expression matrix, we performed the same analysis on the cell-by-gene matrix. After clustering the gene embedding using the Leiden algorithm and we generated a list of candidate metagenes. We recomputed a representative vector for changes from bowel to adnexa by subtracting <bold>V</bold><sub>adnexa</sub> - <bold>V</bold><sub>bowel</sub> and selected the most similar metagenes. Like the GeneVector analysis, we recovered a metagene related to MHC Class I using the PCA embedding. However, several of the genes within this metagene were not present in the Reactome MHC Class I pathway (HSA-983169), in contrast to the GeneVector results which found a metagene containing only <italic>HLA-A</italic>, <italic>HLA-B</italic>, <italic>HLA-C</italic>, and <italic>B2M</italic>. To test if the unannotated genes defined by the PCA embedding were members of any gene signatures which contained HLA genes, we calculated the percentage of Reactome pathways that include individual gene pairs and plotted this as a heatmap over all genes in the metagene <bold>(</bold>Supplementary Fig. <xref rid="MOESM1" ref-type="media">5A</xref>). The genes <italic>TMEM59, SERINC2, FOLR1</italic>, and <italic>WFDC2</italic> were not found as a pair within any Reactome pathway. We concluded that the PCA embedding identified an MHC Class I metagene that was less consistent with previously annotated pathways than GeneVector.</p>
      <p id="Par26">Given that the metagenes are computed using Leiden clustering, the resolution parameter affects the coarseness of the PCA embedding. We performed a parameter sweep over resolution values and found that the genes identified by the PCA analysis are robustly clustered together over a wide range of resolutions (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5B</xref>). In comparison, GeneVector identifies a metagene containing <italic>HLA-A</italic>, <italic>HLA-B</italic>, <italic>HLA-C</italic>, and <italic>B2M</italic> over a wide range of resolution parameters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5C</xref>). The interval of values used for the parameter sweep was selected to keep metagene membership between three and 50 genes and represents the most reasonable range of values for generating metagenes of this size. To understand why non MHCI-annotated genes appear in the context of MHC genes in the PCA embedding, we looked at differentially expressed genes up-regulated in adnexa over bowel. We found that while these genes do not appear in Reactome pathways together, they do appear significantly differentially expressed between adnexa and bowel. Here, we draw the conclusion that PCA combines multiple pathways to explain as much variance as possible when constructing successive orthogonal PCA components. As a result, PCA will combine multiple underlying sources of variance such as bowel/adnexa variation, and MHC I variation between cells. By contrast, GeneVector has no orthogonality constraints and is not constructed to maximize variance explained by individual vectors, allowing GeneVector to decompose pathway specific metagenes in a more flexible manner.</p>
    </sec>
    <sec id="Sec8">
      <title>Metagenes associated with cisplatin treatment resistance</title>
      <p id="Par27">Understanding the transcriptional processes that generate resistance to chemotherapies has immense clinical value. However, the transcriptional organization of resistance is complex with many parallel mechanisms contributing to cancer cell survival<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. We analyzed longitudinal single cell RNA-seq collected from a triple negative breast cancer patient-derived xenograft model (SA609 PDX) along a treated and untreated time series<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. Using a total of 19,799 cancer cells with treatment and timepoint labels (Fig. <xref rid="Fig6" ref-type="fig">6A</xref>), GeneVector was trained using unnormalized read counts to generate metagenes that identify programs potentially related to cisplatin resistance. For each metagene, we computed gene module scores over normalized and log-transformed expression<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> over the four timepoint (X1, X2, X3, and X4) within the treated and untreated cells. Using these scores, we calculated linear regression coefficients over the four time points and selected candidate chemotherapy resistant and untreated metagenes (<italic>β</italic><sub><italic>treated</italic></sub> and <italic>β</italic><sub><italic>untreated</italic></sub><italic>)</italic> over a coefficient threshold (<italic>β</italic><sub><italic>treated</italic></sub> &gt; 0.1 and Bonferroni adjusted <italic>p</italic> = 0.001) with an untreated coefficient less than the treated coefficient (<italic>β</italic><sub><italic>treated</italic></sub>
<italic>&gt; β</italic><sub><italic>untreated</italic></sub><italic>)</italic>
<bold>(</bold>Fig. <xref rid="Fig6" ref-type="fig">6B</xref>). Mean log-normalized expression per gene was computed for each timepoint in five metagenes that were identified as treatment specific (Fig. <xref rid="Fig6" ref-type="fig">6C</xref>).<fig id="Fig6"><label>Fig. 6</label><caption><title>Analysis of Metagenes in Cisplatin-treated PDX Time Series.</title><p><bold>A</bold> UMAP of cisplatin treated PDX (patient derived xenograft) cells annotated by time point (left) and treatment status (right). <bold>B</bold> Metagenes plotted with respect to regression coefficients (β<sub>treated</sub> and β<sub>untreated</sub>) over four timepoints in either treated or untreated cells with Bonferroni adjusted <italic>p</italic>-values = 0.001. <bold>C</bold> Hallmark combined enrichment scores for candidate chemo resistant metagenes. <bold>D</bold> Gene expression profiles for each timepoint for the five metagenes associated with increase in treatment. Metagene 24 is associated with TGF-beta signaling includes <italic>EPCAM</italic>, <italic>FOXP1</italic>, and <italic>ID</italic> family genes with known cisplatin resistance function. <bold>E</bold> Most similar genes for treated and untreated cells computed from cosine similarity to global vectors. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig6_HTML" id="d32e1543"/></fig></p>
      <p id="Par28">Pathway enrichment on each of the five metagenes using GSEAPY with Hallmark gene set annotations from Enrichr<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> showed that metagene 24 was enriched for TGF-beta signaling (Fig. <xref rid="Fig6" ref-type="fig">6D</xref>), a pathway frequently up-regulated during chemo-resistance<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>. This metagene includes genes <italic>ID1</italic>, <italic>ID2</italic>, <italic>ID3</italic>, <italic>ID4</italic>, <italic>EPCAM</italic>, and <italic>FOXP1</italic>, all of which have been found to be overexpressed in chemotherapy-resistant samples in several cancer types<sup><xref ref-type="bibr" rid="CR39">39</xref>–<xref ref-type="bibr" rid="CR41">41</xref></sup>. GeneVector also identified these genes in global expression differences between treated and untreated cells from the set of most similar genes to vectors <bold>V</bold><sub>treated</sub> and <bold>V</bold><sub>untreated</sub> (Fig. <xref rid="Fig6" ref-type="fig">6E</xref>). Several studies have implicated multiple resistance mechanisms involving FOXP1 including transcriptional regulation, immune response, and MAPK signaling<sup><xref ref-type="bibr" rid="CR42">42</xref>–<xref ref-type="bibr" rid="CR44">44</xref></sup>. Additionally, GeneVector identifies <italic>EPCAM</italic>, whose high expression has been associated with increased viability of cancer cells in diverse cancer types<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. <italic>EPCAM</italic> has been shown to have a role in resistance to chemotherapy in both breast and ovarian cancers through WNT signaling and Epithelial-Mesenchymal Transition (EMT)<sup><xref ref-type="bibr" rid="CR46">46</xref>,<xref ref-type="bibr" rid="CR47">47</xref></sup>.</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par29">In this paper we propose GeneVector, a method for building a latent vector representation of scRNA expression capturing the relevant statistical dependencies between genes. By borrowing expression signal across genes, GeneVector overcomes sparsity and produces an information dense representation of each gene. The resulting vectors can be used to generate a gene co-expression graph, and can be clustered to predict transcriptional programs, or metagenes, in an unsupervised fashion. Metagenes can be related to a cell embedding to identify transcriptional changes related to conditional labels or time points. We show that gene vectors can be used to annotate cells with a pseudo-probability, and that these labels are accurate with respect to previously defined cell types.</p>
    <p id="Par30">We show that a single GeneVector embedding can be used for many important downstream analyses. In interferon-stimulated PBMCs, we identify a cell type independent ISG metagene that summarizes interferon-stimulation across cell types and is not conflated with cell type signature. We demonstrate accurate cell type assignment across 18 different cancers in 181 patients described in the Tumor Immune Cell Atlas (TICA). In high grade serous ovarian cancer, we identify metagenes that describe transcriptional changes from primary to metastatic sites. Our results implicate the loss of MHC class I gene expression as a potential immune escape mechanism in ovarian cancer metastasis. In cisplatin treated TNBC PDXs, GeneVector uncovers transcriptional signatures active in drug resistance, most notably metagenes enriched in TGF-beta signaling. This signaling pathway is a cornerstone in cancer progression since it promotes EMT transition and invasion in advanced cancers; it is the target of various therapies, but success has been mixed<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> making it even more important to employ tools that identify the multitude of players contributing to therapy response.</p>
    <p id="Par31">GeneVector can produce an interpretable batch correction by decomposing the derived correction vectors into transcriptional signatures. Using both the full PBMC dataset and simulated mixtures of CD14+ monocytes and CD4 T cells, we systematically evaluated the quality of batch correction using a series of benchmarking metrics (ARI, kBET, cLISI, and silhouette score)<sup><xref ref-type="bibr" rid="CR49">49</xref>,<xref ref-type="bibr" rid="CR50">50</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6A–I</xref>). For the interferon beta stimulated PBMC dataset, we expect the proper batch correction to include ISGs, and indeed the batch correction vector had high cosine similarity to an ISG metagene. In simulated mixtures of cell types, we found that the similarity of the batch correction vector to ISGs was highest when the ratio of cell types was balanced in the unstimulated and stimulated batches, we obtained the best batch correction performance for balanced batches (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6J</xref>). By contrast, when cell types were imbalanced, batch correction vectors had high similarity to cell type specific vectors (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6K, L</xref>). Batch correction is challenging in the presence of batch-specific differences in cell type composition. As opposed to other batch correction methods, the GeneVector implementation is highly interpretable, so users can verify whether batch correction vectors are similar to cell type signatures or other biologically relevant metagenes.</p>
    <p id="Par32">Identifying correlations across scRNA data is a fundamental analysis task, necessary for identifying cells with similar phenotype or activity, or genes with similar pathways or functional relationships. As has been shown by us and in previous work<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR16">16</xref>,<xref ref-type="bibr" rid="CR51">51</xref></sup>, the sparsity and non-linearity of scRNA data impact the performance of both standard measures of correlations between variables and global analysis of assumed linear correlations using PCA. While some methods tailor complex custom probabilistic models to the specific properties of scRNA data, GeneVector instead builds upon MI, a simple yet powerful tool for calculating the amount of information shared between two variables. We show that MI and the vector space trained from the MI matrix both capture relevant gene pair relationships including between TF activators and repressors and their targets. Nevertheless, GeneVector is unable to discern repression from activation, as it builds MI that is agnostic to the direction of the statistical dependency. Pearson correlation, theoretically sensitive to the direction of a dependency, also performs poorly. Due to the high-level of sparsity, absence of expression is not a significant event and repressed expression could just as easily be explained by under-sampling an expressed gene. We suggest that identifying negative regulation and mutually exclusive expression is one of the more difficult problems in scRNA-seq analysis.</p>
    <p id="Par33">As shown with correlation, the objective function employed in training GeneVector has a significant effect on the resulting gene embedding. Mutual information calculated empirically from the histogram of binned expression counts for gene pairs is limited by the available number of cells, fidelity of the counts, and discretization strategy. By modeling the underlying distribution for each gene more accurately, the joint probability distribution between genes can more accurately reflect expression-based relationships and improve model results. Additionally, while only a one-time cost, the MI calculation is computationally expensive. By improving the calculation of mutual information, others have achieved improved performance in related tasks including the identification of GRNs<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>.</p>
    <p id="Par34">The high dimensionality of scRNA and the vast complexity of biological systems to which it is applied necessitate analytical tools that facilitate intuitive and efficient data exploration and produce easily interpretable results. GeneVector performs upfront computation of a meaningful low dimensional representation, transforming sparse and correlated expression measurements into a concise vector space summarizing the underlying structure in the data. The resulting vector space is amenable to intuitive vector arithmetic operations that can be composed into higher level analyses including cell type classification, treatment related gene signature discovery, and identification of functionally related genes. Importantly, the vector arithmetic operations and higher-level analyses can be performed interactively, allowing for faster iteration in developing cell type and context specific gene signatures or testing hypotheses related to experimental covariates. GeneVector is implemented as a python package available on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/nceglia/genevector">https://github.com/nceglia/genevector</ext-link>) and installable via PIP.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Dataset preprocessing</title>
      <p id="Par35">Each single cell RNA-seq dataset in this study was processed using the Scanpy python library<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. All highly variable gene selection was performed using the Seurat V3<sup><xref ref-type="bibr" rid="CR6">6</xref></sup> method implemented in Scanpy. We performed cell type classification on 23,764 cells from the Tumor Immune Cell Atlas (TICA)<sup><xref ref-type="bibr" rid="CR20">20</xref></sup> using raw read counts from 2,000 highly variable after removal of non-protein coding genes. We performed analysis of 6,855 cells composed of an interferon beta stimulated sample and a control sample using raw counts and cell type annotations obtained from the SeuratData R package<sup><xref ref-type="bibr" rid="CR33">33</xref></sup> and subset to 1000 highly variable genes. The fitness PDX dataset<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> consisted of raw counts from 19,799 cancer cells with treatment and timepoint labels subset to 2000 highly variable genes. Coefficients and <italic>p</italic>-values were computed over gene module scores using the statsmodels python package. Cell type classification and vector arithmetic for the changes between metastatic and primary sites was performed on 270,833 cells from adnexa (primary) and bowel (metastasis) samples using 2000 highly variable genes. Normalization comparisons were made using the Scanpy normalize_total and log1p functions. All subsampling of datasets for simulated batch effects was performed using the Scanpy subsample function.</p>
    </sec>
    <sec id="Sec12">
      <title>Gene expression mutual information</title>
      <p id="Par36">In NLP applications, vector space models are trained by defining an association between words that appear in the same context. In single cell RNA sequencing data, we can redefine this textual context as co-expression within a given cell and mutual information across cells. The simplest metric to define association is the overall number of co-expression events between genes. However, the expression profiles over cells may differ due to both technical and biological factors. To summarize the variability in this relationship, we generate a joint probability distribution on the co-occurrence of read counts. The ranges of each bin are defined separately for each gene based on a user defined number of quantiles. By defining the bin ranges separately, the lowest counts in one gene can be compared directly to the lowest counts in another gene without need for further normalization. Using the joint probability distribution, we compute the mutual information between genes defined in Eq. <xref rid="Equ1" ref-type="disp-formula">1</xref>. The mutual information value is subsequently used as the target in training the model, allowing us to highlight the relationship between genes as a single-valued quantity.<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$I\left({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\right)=\mathop{\sum }\limits_{i}^{n}\mathop{\sum }\limits_{j}^{n}p\left({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\right)\log \left(\frac{p\big({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\big)}{p\left({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}}\right),p\big({{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\big)}\right)$$\end{document}</tex-math><mml:math id="M2"><mml:mi>I</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mi>p</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>log</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par37">Equation <xref rid="Equ1" ref-type="disp-formula">1</xref>: Mutual information between <bold>G</bold><sub>i</sub> and <bold>G</bold><sub>j</sub> computed on the empirical joint probability distribution over expression bins for <bold>G</bold><sub>i</sub> and <bold>G</bold><sub>j</sub>.</p>
    </sec>
    <sec id="Sec13">
      <title>Model training</title>
      <p id="Par38">A neural network is constructed from a single hidden layer corresponding to the size of the latent space vectors. A set of independently updated weights connects the one-hot encoded input and output layers that are defined from each pair of genes. These weights, <bold>w</bold><sub>1</sub> and <bold>w</bold><sub>2</sub>, are matrices with dimensions equal to <italic>N</italic> expressed genes by <italic>I</italic> hidden units. Initial values for <bold>w</bold><sub>1</sub> and <bold>w</bold><sub>2</sub> are generated uniformly on the interval −1 to 1. The objective function, as a minimization of least squares, is defined in Eq. <xref rid="Equ2" ref-type="disp-formula">2</xref>. The final latent space, defined as the gene embedding, is computed as the vector average of weights <italic>w</italic><sub><italic>1</italic></sub> and <italic>w</italic><sub><italic>2</italic></sub>. For NLP applications, this is a preferred approach over selecting either weight matrix<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>. Each co-expressed gene pair is used as a single training example. The maximum number of examples for a full training epoch is given by the total number of co-expressed gene pairs. Weights are batch updated with adaptive gradient descent (ADADELTA)<sup><xref ref-type="bibr" rid="CR53">53</xref></sup>. Training is halted at either a maximum number of epochs, or when the change in loss falls below a specified threshold. The results presented used unnormalized integer read counts, but any matrix can be used as input to the model. The model is implemented in PyTorch.<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$J={\left({{{{{{{\bf{w}}}}}}}_{i}}^{T}{\hat{{{{{{\bf{w}}}}}}}}_{j}-C*I({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}})\right)}^{2}$$\end{document}</tex-math><mml:math id="M4"><mml:mi>J</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>C</mml:mi><mml:mo>*</mml:mo><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par39">Equation <xref rid="Equ2" ref-type="disp-formula">2</xref>: Objective function for weights corresponding to gene <bold>G</bold><sub><bold>i</bold></sub> and <bold>G</bold><sub><bold>j</bold></sub>, where <inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$I({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}})$$\end{document}</tex-math><mml:math id="M6"><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq1.gif"/></alternatives></inline-formula> is the mutual information and <italic>C</italic> is a constant.</p>
    </sec>
    <sec id="Sec14">
      <title>Gene vectors</title>
      <p id="Par40">The cosine similarity function, defined in Eq. <xref rid="Equ3" ref-type="disp-formula">3</xref>, is used to measure similarity between vectors, defined as 1 - cosine distance or dot product. Values closer to 1 indicate strong association within the dataset. A gene vector is defined as the learned weights in the gene embedding for a particular gene. Vectors describing groups of cells are generated by computing a weighted average vector, described in Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref>, from a set of individual gene vectors.<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${cosinesimilarity}=1-\frac{{{{{{\bf{A}}}}}}*{{{{{\bf{B}}}}}}}{\left|\left|{{{{{\bf{A}}}}}}\right|\right |*\left|\left|{{{{{\bf{B}}}}}}\right|\right|}$$\end{document}</tex-math><mml:math id="M8"><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="bold">A</mml:mi><mml:mo>*</mml:mo><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mi mathvariant="bold">A</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>*</mml:mo><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par41">Equation <xref rid="Equ3" ref-type="disp-formula">3</xref>: Cosine similarity as the dot-product between feature vectors <inline-formula id="IEq2"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M10"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq2.gif"/></alternatives></inline-formula> and <inline-formula id="IEq3"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$B$$\end{document}</tex-math><mml:math id="M12"><mml:mi>B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq3.gif"/></alternatives></inline-formula>.</p>
      <p id="Par42">To assign a vector to each cell, the average vector is computed across the gene embedding weighted by the normalized, log-transformed expression observed in each cell. The matrix of all cell vectors in the dataset is defined as the cell embedding. This cell embedding can be used in place of PCA or embeddings obtained with variational auto-encoders. Each cell vector maintains a linear relationship with the gene embedding. The computation of vectors describing groups of cells is described in Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref>.<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\bf{C}}}}}}}_{{{{{{\bf{k}}}}}}}=\frac{{\sum }_{i=1}^{n}{{{{{\bf{w}}}}}}_{i\ast}{\underline{{{{{{\bf{x}}}}}}}_{{{{{{\bf{i}}}}}}}}}{{\sum }_{i=1}^{n}{{{{{\bf{w}}}}}}_{i}}$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:munder accentunder="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="true">_</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par43">Equation <xref rid="Equ4" ref-type="disp-formula">4</xref>: Vector <inline-formula id="IEq4"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{k}$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq4.gif"/></alternatives></inline-formula> defined as the <inline-formula id="IEq5"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M18"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq5.gif"/></alternatives></inline-formula> th component of the cell embedding computed from the average mean of vectors <inline-formula id="IEq6"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\underline{x}}_{i\to n}$$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:munder accentunder="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="true">_</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq6.gif"/></alternatives></inline-formula> where <inline-formula id="IEq7"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n$$\end{document}</tex-math><mml:math id="M22"><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq7.gif"/></alternatives></inline-formula> is equal to the number of hidden units.</p>
    </sec>
    <sec id="Sec15">
      <title>Co-expression similarity graph</title>
      <p id="Par44">A co-expression similarity graph is constructed from cosine similarity between each pair of genes using Scanpy neighborhood function with a default value for <italic>k</italic> of 15. A node in the graph represents a single gene and edges are weighted by cosine similarity. To generate metagenes, we apply Leiden clustering to the neighborhood graph with a user defined resolution argument. We have found that metagene clustering is robust to a range of resolution values ranging from 15 to 1000 when assessing the identification of an MHCI-like metagene in a single patient in the SPECTRUM cohort (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5C</xref>).</p>
    </sec>
    <sec id="Sec16">
      <title>Cell type assignment</title>
      <p id="Par45">A set of cell types with user defined marker genes are used to perform a pseudo-probabilistic phenotype assignment in a single cell. A representative vector for the cell type is computed from the user defined marker genes weighted by the normalized and log-transformed expression of the cell to be classified. The cosine distances of each cell type vector with cell vector are passed through a SoftMax function, given in Eq. <xref rid="Equ5" ref-type="disp-formula">5</xref>, to provide a pseudo-probability distribution for each phenotype. The argument maximum of this distribution is used to classify the most likely cell type for a given cell. This procedure is repeated for every cell in the dataset.<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma (z)_{i}=\frac{{e}^{{Z}_{i}}}{{\sum }_{j=1}^{n}{e}^{{Z}_{i}}}$$\end{document}</tex-math><mml:math id="M24"><mml:mi>σ</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par46">Equation <xref rid="Equ5" ref-type="disp-formula">5</xref>: SoftMax function where <inline-formula id="IEq8"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$z$$\end{document}</tex-math><mml:math id="M26"><mml:mi>z</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq8.gif"/></alternatives></inline-formula> is the set of cosine similarities for <inline-formula id="IEq9"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n$$\end{document}</tex-math><mml:math id="M28"><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq9.gif"/></alternatives></inline-formula> cell types.</p>
    </sec>
    <sec id="Sec17">
      <title>Generation of predictive genes</title>
      <p id="Par47">The method of phenotype assignment can be reversed to produce a set of genes that are most similar, or predictive, to any group of cells. The cell vectors belonging to this group can be averaged to generate a group vector representing a label in the dataset. The transcriptional signature associated with this group of cells can be computed using vector arithmetic <bold>V</bold><sub>group</sub> – <bold>V</bold><sub>dataset</sub>, where <bold>V</bold><sub>dataset</sub> is the average vector over all cells. Gene vectors are sorted by cosine similarity to the group vector to produce a ranked list of candidate genes that are most like the set of cells in the group.</p>
    </sec>
    <sec id="Sec18">
      <title>Batch correction</title>
      <p id="Par48">Batch correction is applied to cells over a given set of batch labels with the goal of correcting the difference between these batches and a user-specified reference batch. With the set of cells labeled for a batch, we can compute an average batch vector. A correction vector can then be computed for each batch using vector arithmetic to describe the direction and magnitude of the change from the batch to the reference. The correction vector is then added to each cell in the batch. After computing the cell embedding, the following procedure is applied to each batch label:<list list-type="order"><list-item><p id="Par49">Compute the average vector <bold>V</bold><sub>batch</sub> for a set of cells.</p></list-item><list-item><p id="Par50">Compute the reference vector <bold>V</bold><sub>reference</sub> for cells in the reference batch.</p></list-item><list-item><p id="Par51">Compute a correction vector <bold>V</bold><sub>correction</sub> = <bold>V</bold><sub>reference</sub> – <bold>V</bold><sub>batch</sub>.</p></list-item><list-item><p id="Par52">For each cell in the batch, subtract <bold>V</bold><sub>correction</sub> from each cell vector.</p></list-item><list-item><p id="Par53">Repeat for all <italic>n</italic> batches.</p></list-item></list></p>
    </sec>
    <sec id="Sec19">
      <title>Co-expressed and mutually exclusive markers</title>
      <p id="Par54">Cell type marker gene pairs used to benchmark normalization methods by identifying common differentially expressed genes in T cell, B cell, and monocyte lineage cell types across multiple datasets and extracting the top 10 markers of each cell type in each dataset. The union of extracted marker genes over all cell types for a given lineage (T cell, B cell, or monocyte) were ranked by the number of datasets where that gene was a marker. All combinations of markers in the top 10 ranked genes that were unique to a cell type were selected as the co-expressed pairs for T cell, B cell, and monocyte lineages. Mutually exclusive markers were defined as all combinations of gene pairs that were not found together in a single lineage.</p>
    </sec>
    <sec id="Sec20">
      <title>Time-series analysis of metagenes</title>
      <p id="Par55">Linear regression is applied to gene module scores computed over normalized, log-transformed expression<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> over a series of time points for each metagene resulting in a <italic>p</italic>-value and slope coefficient from each series. Metagenes with a Bonferroni adjusted <italic>p</italic> = 0.001 and a treated coefficient greater than the untreated coefficient, with a minimum threshold of 0.1 were selected as treatment specific gene programs.</p>
    </sec>
    <sec id="Sec21">
      <title>Reporting summary</title>
      <p id="Par56">Further information on research design is available in the <xref rid="MOESM2" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec22">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_39985_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_39985_MOESM2_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec23">
        <title>Source data</title>
        <p id="Par60">
          <media position="anchor" xlink:href="41467_2023_39985_MOESM3_ESM.xlsx" id="MOESM3">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Zachary Sethna, Samuel S. Freeman.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-39985-2.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was funded in part by awards to S.P.S.: Susan G. Komen Breast Cancer Foundation (SAC220206), the Department of Defense Congressionally Directed Medical Research Programs (CDMRP) award W81XWH2210759 and award W81XWH-20-1-0565, the Cancer Research UK Grand Challenge Program (GC-243330), the Ovarian Cancer Research Fund (1468), a National Cancer Institute (NCI) grant (P50-CA247749), an NIH U24 award (CA264028), an NIH RM1 award (RM1-HG011014). The work received further support from awards to B.D.G.: NCI grant RO1 CA269382-01A1, NIH SPORE grant P50-CA257881-01A1, NIH-SPORE grant P50- CA257881-01A1, the Department of Defense Congressionally Directed Medical Research Programs (CDMRP) award 582539, NCI UO1 CA228963-03, NCI RO1 CA240924, NCI RO1 CA262516-01A1, the Mark Foundation for Cancer Research (1388), Stand Up To Cancer (21-A0-00-1007566). S.P.S. holds the Nicholls-Biondi endowed chair in Computational Oncology. The project was further supported by the Marie-Josée and Henry R. Kravis Center for Molecular Oncology and NCI Cancer Center Core grant P30-CA008748 and by Cycle for Survival supporting Memorial Sloan Kettering Cancer Center. S.A. holds the Nan and Lorraine Robertson Chair in Breast Cancer and is a Canada Research Chair in Molecular Oncology (950–230610). Additional funding was provided by a Terry Fox Research Institute grant (1082), a Canadian Cancer Society Research Institute Impact program grant (705617), a CIHR grant (FDN-148429), Breast Cancer Research Foundation awards (BCRF-18-180, BCRF-19-180 and BCRF-20-180), a CCSRI grant (705636), the Canada Foundation for Innovation (40044) to S.A., and the Department of Defense Congressionally Directed Medical Research Programs (CDMRP) award W81XWH-20-10565 to S.A. and S.P.S.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>N.C. developed method, implemented software, performed analysis, authored manuscript. Z.S. developed method, guided analysis framework, and authored manuscript. S.S.F. developed method, performed data analysis, and authored manuscript. F.U. performed analysis. V.B. performed data analysis and developed visualizations. N.R. authored manuscript and provided analysis guidance. B.B. provided analysis guidance, biological interpretations, and manuscript editing. A.C. provided analysis guidance, biological interpretations, and manuscript editing. S.S. provided biological interpretations and manuscript editing. F.K. provided biological interpretations and manuscript editing. S.A. provided biological interpretations. B.G. supervised method development. S.P.S. supervised method development. A.M. developed method, authored manuscript, and supervised method development.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par57"><italic>Nature Communications</italic> thanks the anonymous reviewers for their contribution to the peer review of this work.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>No novel sequencing data were generated for this current study. All pre-processed single cell RNA-seq data analyzed in this study are available in the Zenodo database here [10.5281/zenodo.8079610]<sup><xref ref-type="bibr" rid="CR54">54</xref></sup>. The Tumor Immune Cell Atlas (TICA) processed data can be accessed here [<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/4263972">https://zenodo.org/record/4263972</ext-link>] and the raw data has been deposited in the Gene Expression Ominibus under the accession <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE158803">GSE158803</ext-link>. The PBMC dataset can be accessed through SeuratData R package<sup><xref ref-type="bibr" rid="CR32">32</xref>,<xref ref-type="bibr" rid="CR33">33</xref></sup> and has been deposited in the Gene Expression Omnibus under the accession number <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE96583">GSE96583</ext-link>. The SPECTRUM High Grade Serous Ovarian Cancer dataset can be accessed here [<ext-link ext-link-type="uri" xlink:href="https://cellxgene.cziscience.com/collections/4796c91c-9d8f-4692-be43-347b1727f9d8">https://cellxgene.cziscience.com/collections/4796c91c-9d8f-4692-be43-347b1727f9d8</ext-link>]. Raw 10x sequencing for the Fitness dataset is available from the European Genome-Phenome under study ID <ext-link ext-link-type="uri" xlink:href="https://ega-archive.org/studies/EGAS00001004448">EGAS00001004448</ext-link>. <xref rid="Sec23" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The authors declare that the code needed to reproduce analysis and findings of this study are available in the GitHub repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/nceglia/genevector">https://github.com/nceglia/genevector</ext-link>) and the GeneVector python package can be installed directly from using the Python installer package (PIP). Code released with this manuscript can be found at 10.5281/zenodo.8079885<sup><xref ref-type="bibr" rid="CR55">55</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par58">B.D.G. has received honoraria for speaking engagements from Merck, Bristol-Meyers Squibb and Chugai Pharmaceuticals; has received research funding from Bristol-Meyers Squibb; and has been a compensated consultant for PMV Pharma and Rome Therapeutics of which he is a co-founder. S.P.S. reports personal fees from Imagia Canexia Inc. S.S.F. is a co-inventor on provisional patent application No.62/866,261 titled “Methods for predicting outcomes of checkpoint inhibition and treatment thereof” related to prediction of melanoma immunotherapy outcomes. The remaining authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Segal</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Koller</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>SK</given-names>
          </name>
        </person-group>
        <article-title>A gene-coexpression network for global discovery of conserved genetic modules</article-title>
        <source>Science</source>
        <year>2003</year>
        <volume>302</volume>
        <fpage>249</fpage>
        <lpage>255</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1087447</pub-id>
        <pub-id pub-id-type="pmid">12934013</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Svensson</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Gayoso</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Interpretable factor models of single-cell RNA-seq via variational autoencoders</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>3418</fpage>
        <lpage>3421</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa169</pub-id>
        <pub-id pub-id-type="pmid">32176273</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <mixed-citation publication-type="other">Mikolov, T., Chen, K., Corrado, G. &amp; Dean, J. <italic>Efficient Estimation of Word Representations in Vector Space</italic>. <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1301.3781">https://arxiv.org/abs/1301.3781</ext-link> (2013).</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <mixed-citation publication-type="other">Pennington, J., Socher, R. &amp; Manning, C. Glove: Global vectors for word representation. In <italic>Proceedings of the 2014 Conference on Empirical Methods in Natural Language Processing (EMNLP)</italic> (Association for Computational Linguistics, 2014). 10.3115/v1/d14-1162.</mixed-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Du</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene2vec: distributed representation of genes based on co-expression</article-title>
        <source>BMC Genomics</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>82</fpage>
        <pub-id pub-id-type="doi">10.1186/s12864-018-5370-x</pub-id>
        <pub-id pub-id-type="pmid">30712510</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GXY</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id>
        <pub-id pub-id-type="pmid">28232747</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Traag</surname>
            <given-names>VA</given-names>
          </name>
          <name>
            <surname>Waltman</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>van Eck</surname>
            <given-names>NJ</given-names>
          </name>
        </person-group>
        <article-title>From Louvain to Leiden: guaranteeing well-connected communities</article-title>
        <source>Sci. Rep.</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>5233</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-019-41695-z</pub-id>
        <pub-id pub-id-type="pmid">30914743</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van der Maaten</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Visualizing data using t-SNE</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <mixed-citation publication-type="other">McInnes, L., Healy, J. &amp; Melville, J. UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction. <ext-link ext-link-type="uri" xlink:href="https://arXiv.org/abs/1802.03426">https://arXiv.org/abs/1802.03426</ext-link> (2018).</mixed-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Song</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>JJ</given-names>
          </name>
        </person-group>
        <article-title>Statistics or biology: the zero-inflation controversy about scRNA-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>31</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-022-02601-5</pub-id>
        <pub-id pub-id-type="pmid">35063006</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tsuyuzaki</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Sato</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Sato</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Nikaido</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Benchmarking principal component analysis for large-scale single-cell RNA-sequencing</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>9</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1900-3</pub-id>
        <pub-id pub-id-type="pmid">31955711</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Margolin</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ARACNE: an algorithm for the reconstruction of gene regulatory networks in a mammalian cellular context</article-title>
        <source>BMC Bioinf.</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>S7</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-7-S1-S7</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chan</surname>
            <given-names>TE</given-names>
          </name>
          <name>
            <surname>Stumpf</surname>
            <given-names>MPH</given-names>
          </name>
          <name>
            <surname>Babtie</surname>
            <given-names>AC</given-names>
          </name>
        </person-group>
        <article-title>Gene regulatory network inference from single-cell data using multivariate information measures</article-title>
        <source>Cell Syst.</source>
        <year>2017</year>
        <volume>5</volume>
        <fpage>251</fpage>
        <lpage>267.e3</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2017.08.014</pub-id>
        <pub-id pub-id-type="pmid">28957658</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heydari</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>IQCELL: A platform for predicting the effect of gene perturbations on developmental trajectories using single-cell RNA-seq data</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2022</year>
        <volume>18</volume>
        <fpage>e1009907</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1009907</pub-id>
        <pub-id pub-id-type="pmid">35213533</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van Dijk</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Recovering gene interactions from single-cell data using data diffusion</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>716</fpage>
        <lpage>729.e27</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.05.061</pub-id>
        <?supplied-pmid 29961576?>
        <pub-id pub-id-type="pmid">29961576</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kang</surname>
            <given-names>HM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplexed droplet single-cell RNA-sequencing using natural genetic variation</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>89</fpage>
        <lpage>94</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4042</pub-id>
        <pub-id pub-id-type="pmid">29227470</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell tumor immune atlas for precision oncology</article-title>
        <source>Genome Res.</source>
        <year>2021</year>
        <volume>31</volume>
        <fpage>1913</fpage>
        <lpage>1926</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.273300.120</pub-id>
        <?supplied-pmid 34548323?>
        <pub-id pub-id-type="pmid">34548323</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vázquez-García</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ovarian cancer mutational processes drive site-specific immune evasion</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>612</volume>
        <fpage>778</fpage>
        <lpage>786</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-022-05496-1</pub-id>
        <?supplied-pmid 36517593?>
        <pub-id pub-id-type="pmid">36517593</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Salehi</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clonal fitness inferred from time-series modelling of single-cell cancer genomes</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>595</volume>
        <fpage>585</fpage>
        <lpage>590</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-03648-3</pub-id>
        <?supplied-pmid 34163070?>
        <pub-id pub-id-type="pmid">34163070</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Zeiler, M. D. ADADELTA: An Adaptive Learning Rate Method. <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1212.5701">http://arxiv.org/abs/1212.5701</ext-link> (2012).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gillespie</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The reactome pathway knowledgebase 2022</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>D687</fpage>
        <lpage>D692</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab1028</pub-id>
        <?supplied-pmid 34788843?>
        <pub-id pub-id-type="pmid">34788843</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liberzon</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular signatures database (MSigDB) 3.0</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>1739</fpage>
        <lpage>1740</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr260</pub-id>
        <?supplied-pmid 21546393?>
        <pub-id pub-id-type="pmid">21546393</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Subramanian</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2005</year>
        <volume>102</volume>
        <fpage>15545</fpage>
        <lpage>15550</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id>
        <?supplied-pmid 16199517?>
        <pub-id pub-id-type="pmid">16199517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>hTFtarget: A Comprehensive Database for Regulations of Human Transcription Factors and Their Targets</article-title>
        <source>Genomics Proteomics Bioinformatics</source>
        <year>2020</year>
        <volume>18</volume>
        <fpage>120</fpage>
        <lpage>128</lpage>
        <pub-id pub-id-type="doi">10.1016/j.gpb.2019.09.006</pub-id>
        <?supplied-pmid 32858223?>
        <pub-id pub-id-type="pmid">32858223</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TRRUST v2: an expanded reference database of human and mouse transcriptional regulatory interactions</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2018</year>
        <volume>46</volume>
        <fpage>D380</fpage>
        <lpage>D386</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkx1013</pub-id>
        <pub-id pub-id-type="pmid">29087512</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>AW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic cell-type assignment of single-cell RNA-seq for tumor microenvironment profiling</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1007</fpage>
        <lpage>1015</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0529-1</pub-id>
        <pub-id pub-id-type="pmid">31501550</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Conde</surname>
            <given-names>CD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cross-tissue immune cell analysis reveals tissue-specific features in humans</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>376</volume>
        <fpage>eabl5197</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abl5197</pub-id>
        <pub-id pub-id-type="pmid">35549406</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ziegler-Heitbrock</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Ohteki</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Ginhoux</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Shortman</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Spits</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Reclassifying plasmacytoid dendritic cells as innate lymphocytes</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2023</year>
        <volume>23</volume>
        <fpage>1</fpage>
        <lpage>2</lpage>
        <pub-id pub-id-type="doi">10.1038/s41577-022-00806-0</pub-id>
        <pub-id pub-id-type="pmid">36380022</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive Integration of Single-</article-title>
        <source>Cell Data. Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902.e21</lpage>
        <?supplied-pmid 31178118?>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nature Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuleshov</surname>
            <given-names>MV</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Enrichr: a comprehensive gene set enrichment analysis web server 2016 update</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>W90</fpage>
        <lpage>W97</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkw377</pub-id>
        <?supplied-pmid 27141961?>
        <pub-id pub-id-type="pmid">27141961</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id>
        <?supplied-pmid 25867923?>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>D-W</given-names>
          </name>
          <name>
            <surname>Pouliot</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Hall</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Gottesman</surname>
            <given-names>MM</given-names>
          </name>
        </person-group>
        <article-title>Cisplatin resistance: a cellular self-defense mechanism resulting from multiple epigenetic and genetic changes</article-title>
        <source>Pharmacol. Rev.</source>
        <year>2012</year>
        <volume>64</volume>
        <fpage>706</fpage>
        <lpage>721</lpage>
        <pub-id pub-id-type="doi">10.1124/pr.111.005637</pub-id>
        <pub-id pub-id-type="pmid">22659329</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bhola</surname>
            <given-names>NE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TGF-β inhibition enhances chemotherapy action against triple-negative breast cancer</article-title>
        <source>J. Clin. Invest.</source>
        <year>2013</year>
        <volume>123</volume>
        <fpage>1348</fpage>
        <lpage>1358</lpage>
        <pub-id pub-id-type="doi">10.1172/JCI65416</pub-id>
        <pub-id pub-id-type="pmid">23391723</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of genes associated with cisplatin resistance in human oral squamous cell carcinoma cell line</article-title>
        <source>BMC Cancer</source>
        <year>2006</year>
        <volume>6</volume>
        <fpage>224</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2407-6-224</pub-id>
        <pub-id pub-id-type="pmid">16978399</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yamano</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of cisplatin-resistance related genes in head and neck squamous cell carcinoma</article-title>
        <source>Int. J. Cancer</source>
        <year>2010</year>
        <volume>126</volume>
        <fpage>437</fpage>
        <lpage>449</lpage>
        <pub-id pub-id-type="doi">10.1002/ijc.24704</pub-id>
        <pub-id pub-id-type="pmid">19569180</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Roberts</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of genes associated with platinum drug sensitivity and resistance in human ovarian cancer cells</article-title>
        <source>Br. J. Cancer</source>
        <year>2005</year>
        <volume>92</volume>
        <fpage>1149</fpage>
        <lpage>1158</lpage>
        <pub-id pub-id-type="doi">10.1038/sj.bjc.6602447</pub-id>
        <pub-id pub-id-type="pmid">15726096</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Expression of FOXP1 in epithelial ovarian cancer (EOC) and its correlation with chemotherapy resistance and prognosis</article-title>
        <source>Tumour Biol.</source>
        <year>2015</year>
        <volume>36</volume>
        <fpage>7269</fpage>
        <lpage>7275</lpage>
        <pub-id pub-id-type="doi">10.1007/s13277-015-3383-5</pub-id>
        <pub-id pub-id-type="pmid">25895457</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Choi</surname>
            <given-names>EJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>FOXP1 functions as an oncogene in promoting cancer stem cell-like characteristics in ovarian cancer cells</article-title>
        <source>Oncotarget</source>
        <year>2016</year>
        <volume>7</volume>
        <fpage>3506</fpage>
        <lpage>3519</lpage>
        <pub-id pub-id-type="doi">10.18632/oncotarget.6510</pub-id>
        <pub-id pub-id-type="pmid">26654944</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhu</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Gao</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Gene expression profile analysis identifies metastasis and chemoresistance-associated genes in epithelial ovarian carcinoma cells</article-title>
        <source>Med. Oncol.</source>
        <year>2015</year>
        <volume>32</volume>
        <fpage>426</fpage>
        <pub-id pub-id-type="doi">10.1007/s12032-014-0426-5</pub-id>
        <pub-id pub-id-type="pmid">25502083</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Imrich</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hachmeister</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gires</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>EpCAM and its potential role in tumor-initiating cells</article-title>
        <source>Cell Adh. Migr.</source>
        <year>2012</year>
        <volume>6</volume>
        <fpage>30</fpage>
        <lpage>38</lpage>
        <pub-id pub-id-type="doi">10.4161/cam.18953</pub-id>
        <pub-id pub-id-type="pmid">22647938</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tayama</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The impact of EpCAM expression on response to chemotherapy and clinical outcomes in patients with epithelial ovarian cancer</article-title>
        <source>Oncotarget</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>44312</fpage>
        <lpage>44325</lpage>
        <pub-id pub-id-type="doi">10.18632/oncotarget.17871</pub-id>
        <pub-id pub-id-type="pmid">28574829</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Latifi</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cisplatin treatment of primary and metastatic epithelial ovarian carcinomas generates residual cells with mesenchymal stem cell-like profile</article-title>
        <source>J. Cell. Biochem.</source>
        <year>2011</year>
        <volume>112</volume>
        <fpage>2850</fpage>
        <lpage>2864</lpage>
        <pub-id pub-id-type="doi">10.1002/jcb.23199</pub-id>
        <pub-id pub-id-type="pmid">21618587</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TGF-β Signaling and Resistance to Cancer Therapy</article-title>
        <source>Front Cell Dev Biol</source>
        <year>2021</year>
        <volume>9</volume>
        <fpage>786728</fpage>
        <pub-id pub-id-type="doi">10.3389/fcell.2021.786728</pub-id>
        <pub-id pub-id-type="pmid">34917620</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tran</surname>
            <given-names>HTN</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A benchmark of batch-effect correction methods for single-cell RNA sequencing data</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>12</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1850-9</pub-id>
        <?supplied-pmid 31948481?>
        <pub-id pub-id-type="pmid">31948481</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>19</volume>
        <fpage>41</fpage>
        <lpage>50</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01336-8</pub-id>
        <pub-id pub-id-type="pmid">34949812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA sequencing reveals the tissue architecture in human high-grade serous ovarian cancer</article-title>
        <source>Clin. Cancer Res.</source>
        <year>2022</year>
        <volume>28</volume>
        <fpage>3590</fpage>
        <lpage>3602</lpage>
        <pub-id pub-id-type="doi">10.1158/1078-0432.CCR-22-0296</pub-id>
        <pub-id pub-id-type="pmid">35675036</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lachmann</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Giorgi</surname>
            <given-names>FM</given-names>
          </name>
          <name>
            <surname>Lopez</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Califano</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>ARACNe-AP: gene network reverse engineering through adaptive partitioning inference of mutual information</article-title>
        <source>Bioinformatics</source>
        <year>2016</year>
        <volume>32</volume>
        <fpage>2233</fpage>
        <lpage>2235</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw216</pub-id>
        <pub-id pub-id-type="pmid">27153652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Duchi</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hazan</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Singer</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Adaptive subgradient methods for online learning and stochastic optimization</article-title>
        <source>J. Mach. Learn. Res</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>2121</fpage>
        <lpage>2159</lpage>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <mixed-citation publication-type="other">Ceglia, N. et al. Processed files for Identification of transcriptional programs using dense vector representations defined by mutual information with GeneVector. <italic>Release Zenodo</italic>. 10.5281/zenodo.8079610 (2023).</mixed-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <mixed-citation publication-type="other">Ceglia, N. et al. nceglia/genevector: v0.0.1. Release Zenodo. 10.5281/zenodo.8079885 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10359421</article-id>
    <article-id pub-id-type="pmid">37474509</article-id>
    <article-id pub-id-type="publisher-id">39985</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-39985-2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Identification of transcriptional programs using dense vector representations defined by mutual information with GeneVector</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Ceglia</surname>
          <given-names>Nicholas</given-names>
        </name>
        <address>
          <email>ceglian@mskcc.org</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Sethna</surname>
          <given-names>Zachary</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Freeman</surname>
          <given-names>Samuel S.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Uhlitz</surname>
          <given-names>Florian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bojilova</surname>
          <given-names>Viktoria</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2663-6288</contrib-id>
        <name>
          <surname>Rusk</surname>
          <given-names>Nicole</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Burman</surname>
          <given-names>Bharat</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-1151-2450</contrib-id>
        <name>
          <surname>Chow</surname>
          <given-names>Andrew</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Salehi</surname>
          <given-names>Sohrab</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kabeer</surname>
          <given-names>Farhia</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Aparicio</surname>
          <given-names>Samuel</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6153-8793</contrib-id>
        <name>
          <surname>Greenbaum</surname>
          <given-names>Benjamin D.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6402-523X</contrib-id>
        <name>
          <surname>Shah</surname>
          <given-names>Sohrab P.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>McPherson</surname>
          <given-names>Andrew</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Computational Oncology, Department of Epidemiology and Biostatistics, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Immuno-Oncology Service, Human Oncology and Pathogenesis Program, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Hepatopancreatobiliary Service, Department of Surgery, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Department of Medicine, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.51462.34</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9952</institution-id><institution>Department of Medicine, Thoracic Oncology Service, </institution><institution>Memorial Sloan Kettering Cancer Center, </institution></institution-wrap>New York, NY USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="GRID">grid.248762.d</institution-id><institution-id institution-id-type="ISNI">0000 0001 0702 3000</institution-id><institution>Department of Molecular Oncology, British Columbia Cancer Research Centre, Vancouver, </institution></institution-wrap>British Columbia, Canada </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="GRID">grid.17091.3e</institution-id><institution-id institution-id-type="ISNI">0000 0001 2288 9830</institution-id><institution>Department of Pathology and Laboratory Medicine, </institution><institution>University of British Columbia, Vancouver, </institution></institution-wrap>British Columbia, Canada </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="GRID">grid.5386.8</institution-id><institution-id institution-id-type="ISNI">000000041936877X</institution-id><institution>Physiology, Biophysics &amp; Systems Biology, </institution><institution>Weill Cornell Medicine, Weill Cornell Medical College, </institution></institution-wrap>New York, NY USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>20</day>
      <month>7</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>20</day>
      <month>7</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>4400</elocation-id>
    <history>
      <date date-type="received">
        <day>8</day>
        <month>7</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>4</day>
        <month>7</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Deciphering individual cell phenotypes from cell-specific transcriptional processes requires high dimensional single cell RNA sequencing. However, current dimensionality reduction methods aggregate sparse gene information across cells, without directly measuring the relationships that exist between genes. By performing dimensionality reduction with respect to gene co-expression, low-dimensional features can model these gene-specific relationships and leverage shared signal to overcome sparsity. We describe GeneVector, a scalable framework for dimensionality reduction implemented as a vector space model using mutual information between gene expression. Unlike other methods, including principal component analysis and variational autoencoders, GeneVector uses latent space arithmetic in a lower dimensional gene embedding to identify transcriptional programs and classify cell types. In this work, we show in four single cell RNA-seq datasets that GeneVector was able to capture phenotype-specific pathways, perform batch effect correction, interactively annotate cell types, and identify pathway variation with treatment over time.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">In single-cell RNA-seq analyses, it would be critical to measure the relationships between genes. Here, the authors develop a framework for single-cell dimensionality reduction that incorporates gene-specific relationships - GeneVector -, and use it for tasks such as annotating cell types and analysing pathway variation after treatment.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Machine learning</kwd>
      <kwd>Software</kwd>
      <kwd>Cancer genomics</kwd>
      <kwd>Tumour heterogeneity</kwd>
      <kwd>Transcriptomics</kwd>
    </kwd-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature Limited 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Maintenance of cell state and execution of cellular function are based on coordinated activity within networks of related genes. To approximate these connections, transcriptomic studies have conceptually organized the transcriptome into sets of co-regulated genes, termed gene programs<sup><xref ref-type="bibr" rid="CR1">1</xref></sup> or metagenes<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. The first intuitive step to identify such co-regulated genes is the reduction of dimensionality for sparse expression measurements: high dimensional gene expression data is compressed into a minimal set of explanatory features that highlight similarities in cellular function. However, to map existing biological knowledge to each cell, the derived features must be interpretable at the gene level.</p>
    <p id="Par4">To find similarities in lower dimensions, biology can borrow from the field of natural language processing (NLP). NLP commonly uses dimensionality reduction to identify word associations within a body of text<sup><xref ref-type="bibr" rid="CR3">3</xref>,<xref ref-type="bibr" rid="CR4">4</xref></sup>. To find contextually similar words, NLP methods make use of vector space models to represent similarities in a lower dimensional space. Similar methodology has been applied to bulk RNA-seq expression for finding co-expression patterns<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>. Inspired by such work, we developed a tool that generates gene vectors based on single cell RNA (scRNA)-seq expression data. While current methods reduce dimensionality with respect to sparse expression across each cell, our tool produces a lower dimensional embedding with respect to each gene. The vectors derived from GeneVector provide a framework for identifying metagenes within a gene co-expression graph and relating these metagenes back to each cell using latent space arithmetic.</p>
    <p id="Par5">The most pervasive method for identifying the sources of variation in scRNA-seq studies is principal component analysis (PCA)<sup><xref ref-type="bibr" rid="CR6">6</xref>–<xref ref-type="bibr" rid="CR8">8</xref></sup>. The relationship of principal components to gene expression is linear, allowing lower dimensional structure to be directly related to variation in expression. A PCA embedding is an ideal input for building a nearest neighbor graph for unsupervised clustering algorithms<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> and visualization methods including t-SNE<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> and UMAP<sup><xref ref-type="bibr" rid="CR11">11</xref></sup>. However, the assumption of a continuous multivariate gaussian distribution creates distortion in modeling read counts generated by a true distribution that is over-dispersed, possibly zero-inflated<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, with positive support and mean close to zero<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. Despite such issues, gene programs generated from PCA loadings have been used to generate metagenes that explain each principal component<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>. While these loadings highlight sets of genes that explain each orthogonal axis of variation, pathways and cell type signatures can be conflated within a single axis.</p>
    <p id="Par6">In addition to PCA, more sophisticated methods have been developed to better handle the specific challenges of scRNA data. The single cell variational inference (scVI) framework<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> generates an embedding using non-linear autoencoders that can be used in a range of analyses including normalization, batch correction, gene-dropout correction, and visualization. While scVI embeddings show improved performance over traditional PCA-based analysis in these tasks, they have a non-linear relationship to the original count matrix that may distort the link between structure in the generated embedding and potentially identifiable gene programs<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. A subsequent method uses a linearly decoded variational autoencoder (LDVAE), which combines a variational autoencoder with a factor model of negative binomial distributed read counts to learn an interpretable linear embedding of cell expression profiles<sup><xref ref-type="bibr" rid="CR2">2</xref></sup>. However, the relationship between gene expression and cell representation is still tied to correlated variation across cells, which may confound co-varying pathway and phenotypic signatures.</p>
    <p id="Par7">Recognizing the importance of modeling the non-linearity of gene expression and the complexity of statistical dependencies between genes, several methods have adopted information theoretical approaches. Many of these methods use mutual information (MI), an information theoretic measure of the statistical dependence between two variables. ARACNE<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> uses MI to prune independent and indirectly interacting genes during construction of a gene regulatory network from microarray expression data. PIDC<sup><xref ref-type="bibr" rid="CR16">16</xref></sup> identifies regulatory relationships using partial information decomposition (PID), a measure of the dependence between triples of variables. The authors apply PIDC to relatively high-depth single-cell qPCR datasets and restrict their analysis to on the order of hundreds of genes. More recently, IQCELL<sup><xref ref-type="bibr" rid="CR17">17</xref></sup> uses MAGIC<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> to impute missing gene expression, builds a GRN from pairwise MI between genes, and applies a series of filters to produce a GRN composed of only functional relationships. The authors use IQCELL to identify known causal gene interactions in scRNA-seq data from mouse T-cell and red blood cell development experiments. Because of the success of these methods, we hypothesized that MI could be combined with vector space models to produce a meaningful low dimensional representation of genes from scRNA data.</p>
    <p id="Par8">In this work, we present GeneVector (Fig. <xref rid="Fig1" ref-type="fig">1</xref>) as a framework for generating low dimensional embeddings constructed from the mutual information between genes. GeneVector summarizes co-expression of genes as mutual information between the probability distribution of read counts across cells. We showcase GeneVector on four scRNA datasets produced from a diverse set of experiments: peripheral blood mononuclear cells (PBMCs) subjected to interferon beta stimulation<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, the Tumor Immune Cell Atlas (TICA)<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>, treatment naive multi-site samples from High Grade Serous Ovarian Cancers (HGSOC)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> and a time series of cisplatin treatment in patient-derived xenografts (PDX) of triple negative breast cancer (TNBC)<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. We first confirm GeneVector’s ability to identify putatively co-regulated gene pairs from sparse single cell expression measurements using the TICA and PBMC datasets. We demonstrate that latent space arithmetic can be used to accurately label cell types in the TICA dataset and validate our cell type predictions against published annotations. Next, we show that GeneVector can identify metagenes corresponding to cell-specific transcriptional processes in PBMCs, including interferon activated gene expression (ISG). We use vector space arithmetic to directly map metagenes to site specific changes in primary and metastatic sites in the HGSOC dataset, capturing changes in MHC class I expression and epithelial-mesenchymal transition (EMT). Finally, we show GeneVector can identify cisplatin treatment dependent transcriptional programs related to TGF-beta in TNBC PDXs.<fig id="Fig1"><label>Fig. 1</label><caption><title>GeneVector Framework.</title><p>Overview of GeneVector framework starting from single cell read counts. Mutual information is computed on the joint probability distribution of read counts for each gene pair. Each pair is used to train a single layer neural network where the MSE loss is evaluated from the model output (<bold>w</bold><sub>1</sub><sup>T</sup><bold>w</bold><sub>2</sub>) with the mutual information between genes. From the resulting weight matrix, a gene embedding, cell embedding, and co-expression similarity graph are constructed. Using vector space arithmetic, downstream analyses include identification of cell-specific metagenes, batch effect correction, and cell type classification.</p></caption><graphic xlink:href="41467_2023_39985_Fig1_HTML" id="d32e538"/></fig></p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Defining the GeneVector framework</title>
      <p id="Par9">We trained a single layer neural network over all gene pairs to generate low dimensional gene embeddings and identify metagenes from a co-expression similarity graph. The input weights (<bold>w</bold><sub>1</sub>) and output weights (<bold>w</bold><sub>2</sub>) are updated with adaptive gradient descent (ADADELTA)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. Gene co-expression relationships are defined using mutual information (Methods<bold>:</bold> Mutual Information) computed from a joint probability distribution of expression counts. Training loss is evaluated as the mean squared error of mutual information with the model output, defined as <bold>w</bold><sub>1</sub><sup>T</sup><bold>w</bold><sub>2</sub>. The final latent space is a matrix defined as a series of vectors for each gene.</p>
      <p id="Par10">Gene vectors produced by the framework are useful for several fundamental gene expression analyses. Gene vectors weighted by expression in each cell are combined to generate the cell embedding analysis of cell populations and their relationships to experimental covariates. The cell embedding can be batch corrected by using vector arithmetic to identify vectors that represent batch effects and then shift cells in the opposite direction (Methods<bold>:</bold> Batch correction). A co-expression graph is constructed in which each node is defined as a gene and each edge is weighted by cosine similarity. After generating the co-expression graph, we use Leiden clustering<sup><xref ref-type="bibr" rid="CR9">9</xref></sup> to identify metagene clusters. Further downstream analysis of the cell embedding includes phenotype assignment based on sets of marker genes and computation of the distances between cells and metagenes to highlight changes related to experimental covariates (Fig. <xref rid="Fig1" ref-type="fig">1</xref>).</p>
      <p id="Par11">To perform cell type assignment, a set of known marker genes is used to generate a representative vector for each cell type, where each gene vector is weighted by the normalized and log-transformed gene expression. The cosine similarity of each possible phenotype is computed between the cell vector and the marker gene vector. SoftMax is applied to cosine distances to obtain a pseudo-probability over each phenotype (Methods: Cell type assignment). Discrete labels can be assigned to cells by selecting the phenotype corresponding to the maximum pseudo-probability. More generally, gene vectors can be composed together to describe interesting gene expression features. Cell or gene vectors can then be compared against these feature vectors to evaluate the relevance of that feature to a given cell or gene (Methods: Generation of Predictive Genes).</p>
    </sec>
    <sec id="Sec4">
      <title>Robust inference of gene co-regulation with GeneVector</title>
      <p id="Par12">Our model relies on the advantages of mutual information to define relationships between genes, as opposed to other distance metrics. To evaluate how MI contributes to the observed performance of the model, we first validated that the vectors inferred by GeneVector capture semantic qualities of genes including pathway memberships and regulatory relationships. Specifically, we assessed the extent to which pairs of genes within the same pathway, or expressed within the same cell types, produced similar vector representations in the PBMC dataset. As a ground truth we computed, for each gene pair, the number of combined pathways from Reactome<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> and MSigDB<sup><xref ref-type="bibr" rid="CR25">25</xref>,<xref ref-type="bibr" rid="CR26">26</xref></sup> cell type signatures (C8) for which both genes were members. In addition to training GeneVector using raw read counts with an MI target, we trained GeneVector using normalized and log-transformed read counts on Pearson correlation coefficient to evaluate the relative benefit of MI on the accuracy of the model output. For both the correlation and MI based models, cosine similarities between gene vectors showed a stronger relationship with the number of shared pathways and cell type signatures than randomly shuffled gene pairs (Fig. <xref rid="Fig2" ref-type="fig">2A, C</xref>). Comparing the MI model and the correlation model directly, the MI model produced a much stronger relationship than the correlation based model (r<sup>2</sup> = 0.233 vs. r<sup>2</sup> = 0.093, Fig. <xref rid="Fig2" ref-type="fig">2B, D</xref>). To provide a pathway specific example, we found that the most similar genes by cosine similarity to <italic>IFIT1</italic> (a known interferon stimulated gene) using the correlation objective were less coherent in terms of ISG pathway membership signal (6 of 16 genes were in the Interferon Signaling Reactome pathway R-HSA-913531) (Fig. <xref rid="Fig2" ref-type="fig">2E</xref>) than with mutual information (12 of 16 genes) (Fig. <xref rid="Fig2" ref-type="fig">2F</xref>). The greater proportion of interferon stimulated pathway genes with high similarity to <italic>IFIT1</italic> using a mutual information objective function (Fig. <xref rid="Fig2" ref-type="fig">2F</xref> vs. <xref rid="Fig2" ref-type="fig">2E</xref>) is consistent with the improved correlation between pathway co-membership and cosine similarity over the Pearson correlation coefficient objective (Fig. <xref rid="Fig2" ref-type="fig">2D</xref> vs. <xref rid="Fig2" ref-type="fig">2FB</xref>).<fig id="Fig2"><label>Fig. 2</label><caption><title>Comparison of Results using Mutual Information.</title><p><bold>A</bold>–<bold>D</bold> Pathway co-membership vs. cosine similarity between gene vectors for all gene pairs in PBMCs. Each point represents one gene pair, and plots show the number of pathways (combined Reactome and MSigDB cell type signatures [C8]) that contain both genes (y-axis) and the cosine distance between the two genes (x-axis). The results show both correlation <bold>A</bold>, <bold>B</bold> and MI (Mutual Information) <bold>C</bold>, <bold>D</bold> based GeneVector. In addition to a standard set of results <bold>B</bold>, <bold>D</bold>, a baseline relationship between pathway co-membership and cosine similarity is established by performing an identical analysis over randomly shuffled gene <bold>A</bold>, <bold>C</bold>. <bold>E</bold> Top 16 most similar genes by cosine similarity to IFIT1 using correlation coefficient. Genes in the interferon signaling pathway are colored orange. <bold>F</bold> Top 16 most similar genes to IFIT1 after training GeneVector using mutual information shows a higher number of interferon signaling pathway genes. <bold>G</bold>, <bold>H</bold> Cosine similarity and Pearson correlation coefficient for un-annotated gene pairs (<italic>n</italic> = 314090), ChIP-Seq annotated TF-targets pairs (<italic>n</italic> = 1275), and literature annotated activator (<italic>n</italic> = 26) or repressor (<italic>n</italic> = 26) TF-target pairs. The center of the box plot is denoted by the median, a horizontal line dividing the box into two equal halves. The bounds of the box are defined by the lower quartile (25th percentile) and the upper quartile (75th percentile). The whiskers extend from the box and represent the data points that fall within 1.5 times the interquartile range (IQR) from the lower and upper quartiles. Any data point outside this range is considered an outlier and plotted individually. Significance assessed using Mann-Whitney-Wilcoxon two-sided test. <bold>I</bold> Cosine similarity versus correlation coefficient for gene pairs in the TICA (Tumor Immune Cell Atlas) dataset with TF-target gene pairs highlighted (blue) and colored by activator/repressor status (green/orange respectively). <bold>J</bold>, <bold>K</bold> Linear regression of mean log-normalized expression per cell type±95% confidence interval for repressor TF-target pair <italic>SOCS3</italic>-<italic>STAT4</italic> and activator TF-target pair <italic>KLF-THBD</italic>, respectively. <bold>L</bold> Mean log-normalized expression for <italic>SOCS3-STAT4</italic> and <italic>KLF4-THBD</italic> across annotated cell types. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig2_HTML" id="d32e738"/></fig></p>
      <p id="Par13">Next, we sought to understand whether GeneVector was able to capture relationships between genes with known interactions such as transcription factors (TF) and their targets. GeneVector cosine similarities of TF-target pairs annotated based on ChIP-Seq data<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> were significantly increased relative to un-annotated gene pairs in the TICA dataset (Fig. <xref rid="Fig2" ref-type="fig">2G</xref>). We also considered literature annotated activator-target and repressor-target TF-target gene pairs<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>. As expected, activator-target pairs showed increased cosine similarity above unannotated pairs. Importantly, repressor-target pairs showed an equally strong increase in cosine similarity above unannotated pairs highlighting GeneVector’s ability to identify a diversity of statistical dependencies between co-regulated genes. By comparison, Pearson correlation coefficients of ChIP-seq annotated TF-target pairs were not significantly different from unannotated gene pairs (Fig. <xref rid="Fig2" ref-type="fig">2H</xref>). Both activator-target and repressor-target pairs were significantly different from unannotated pairs, though correlation was on-average positive for both repressor-target and activator-target pairs (Fig. <xref rid="Fig2" ref-type="fig">2H</xref>). In fact, while many repressor-target pairs had high cosine similarity indicative of a meaningful regulatory relationship, their correlation coefficients, computed with normalized and log-transformed counts, were always positive (Fig. <xref rid="Fig2" ref-type="fig">2I</xref>). For example, <italic>SOCS3</italic>-<italic>STAT4</italic> exhibited the lowest correlation of annotated repressor-target pairs (<italic>r</italic><sup>2</sup> = 0.017) and aggregating normalized and log-transformed expression across cell types showed an absence of any relationship between these genes (Fig. <xref rid="Fig2" ref-type="fig">2J</xref>). In contrast, analysis of activator-target pair <italic>KLF4</italic>-<italic>THBD</italic> revealed a positive correlation driven by co-expression in myeloid cells and T cells (Fig. <xref rid="Fig2" ref-type="fig">2K</xref>). This relationship is further evidenced when looking at the expression in more detailed cell type annotations (Fig. <xref rid="Fig2" ref-type="fig">2L</xref>). Identification of mutually exclusive expression is a theoretical benefit of correlation-based similarity measures, however, the sparsity of scRNA likely results in positive or low correlation even for known examples of mutual exclusivity. In summary, the vector space produced by GeneVector successfully recovers the latent similarities between functionally related genes, including negative regulators and their targets, overcoming the sparsity of scRNA data that confounds simpler approaches.</p>
    </sec>
    <sec id="Sec5">
      <title>Fast and accurate cell type classification using GeneVector</title>
      <p id="Par14">Comparative analysis of gene expression programs across large cohorts of patients can potentially identify transcriptional patterns in common cell types shared between many cancers. However, classification of cell types using methods such as CellAssign<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> are computationally expensive. Furthermore, the large number of covariates in these datasets makes disentangling patient-specific signals from disease and therapy difficult. GeneVector provides a fast and accurate method of cell type classification. We perform cell type classification on a subset of 23,764 cells from the Tumor Immune Cell Atlas (TICA) composed of 181 patients and 18 cancer types<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>. The dataset was subset to 2000 highly variable genes and the unnormalized read counts were used train GeneVector. Cell vectors were generated by weighting each gene vector by the normalized and log-transformed expression per cell. Cell types were summarized into three main immune cell types: T cells, B/Plasma, and Myeloid cells (Fig. <xref rid="Fig3" ref-type="fig">3A</xref>) from the original annotations (Fig. <xref rid="Fig3" ref-type="fig">3B</xref>). We selected a set of gene markers for each cell type (T cells: <italic>CD3D</italic>, <italic>CD3G</italic>, <italic>CD3E</italic>, <italic>TRAC</italic>, <italic>IL32</italic>, <italic>CD2</italic>; B cells: <italic>CD79A</italic>, <italic>CD79B</italic>, <italic>MZB1</italic>, <italic>CD19</italic>, <italic>BANK1</italic>; and Myeloid cells: <italic>LYZ</italic>, <italic>CST3</italic>, <italic>AIF1</italic>, <italic>CD68</italic>, <italic>C1QA</italic>, <italic>C1QB</italic>, <italic>C1QC</italic>) based on signatures obtained from CellTypist<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. For each phenotype and each cell, we computed the cosine distance to the log-normalized expression weighted average of the marker gene vectors. The pseudo-probabilities for the three cell types are generated by applying a SoftMax function to the set of cosine distances. The maximum pseudo-probability is used to classify each cell into T cell, B/Plasma, or Myeloid (Fig. <xref rid="Fig3" ref-type="fig">3C</xref>).<fig id="Fig3"><label>Fig. 3</label><caption><title>GeneVector Accurately Classifies Cells in TICA Cell Atlas.</title><p><bold>A</bold> Cells annotated by cell type summarized from the original TICA provided annotations. <bold>B</bold> Original annotations provided in TICA (Tumor Immune Cell Atlas). <bold>C</bold> GeneVector classification results for each cell type. <bold>D</bold> Confusion matrix comparing GeneVector classification with summarized cell types. <bold>E</bold> Confusion matrix using the same gene markers with CellAssign shows decreased performance in myeloid cells. <bold>F</bold> Pseudo-probability values for each summarized cell type. <bold>G</bold> Marker gene log-normalized expression over all cells grouped by GeneVector classification. <bold>H</bold> Original annotations reassigned by GeneVector. <bold>I</bold> Marker gene mean log-normalized expression for cell type reassignments highlights misclassifications in B/Plasma cells and doublet transcriptional signatures in T and myeloid cells. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig3_HTML" id="d32e910"/></fig></p>
      <p id="Par15">To assess performance, we computed accuracy against the coarse labels in a confusion matrix as the percentage of correctly classified cells over the total number cells for each summarized cell type. We found 97.1% of T cells, 95% of myeloid cells, and 94.3% of B/Plasma cells were correctly classified with respect to the original annotations (Fig. <xref rid="Fig3" ref-type="fig">3D</xref>). Additionally, we classified cells using the same marker genes with CellAssign and found significantly decreased performance in the classification of myeloid cells (85.6%) (Fig. <xref rid="Fig3" ref-type="fig">3E</xref>). Overall, the percentage of cells misclassified using GeneVector (3.977%) showed improvement over CellAssign (7.54%). Using the pseudo-probabilities, GeneVector can highlight cells that share gene signatures including plasmacytoid dendritic cells (pDCs), where cell type definition is difficult<sup><xref ref-type="bibr" rid="CR31">31</xref></sup> (Fig. <xref rid="Fig3" ref-type="fig">3F</xref>). For each cell type, we validated that the classified cells are indeed expressing the supplied markers by showing the normalized and log-transformed expression for each marker grouped by classified cell type (Fig. <xref rid="Fig3" ref-type="fig">3G</xref>). For those cells GeneVector reassigned from the original annotations (Fig. <xref rid="Fig3" ref-type="fig">3H</xref>), we examined the mean normalized and log-transformed expression per marker gene and found that many of these cells appear misclassified in original annotations (Fig. <xref rid="Fig3" ref-type="fig">3I</xref>). Cells originally annotated as T cells that were reassigned as B/Plasma by GeneVector show high expression for only B/Plasma markers (<italic>CD19</italic>, <italic>BANK1</italic>, <italic>CD79A</italic>, and <italic>CD79B</italic>). Additionally, there is evidence that many of these reassigned cells may be doublets. B/Plasma cells reassigned to T or myeloid cells show simultaneous expression of both gene markers. While any computational cell type classification cannot be considered ground truth, cell type assignment with GeneVector is an improvement over CellAssign and demonstrates sensitivity to cells that express overlapping cell type transcriptional signatures.</p>
      <p id="Par16">Next, we benchmarked GeneVector’s cell type assignment performance with respect to four input types: raw read counts, log-transformed raw counts, normalized total counts per cell, and normalized total counts per cell with log-transformation. We evaluated each approach on the original TICA dataset, in addition to a series of datasets for which we artificially generated a library size batch effect by down sampling reads in subsets of cells (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1A–E</xref>). Performance was evaluated by calculating cell type assignment accuracy and by ranking gene pairs by cosine similarity for annotated co-expressed and mutually exclusive gene pairs using CellTypist (Methods: Coexpressed and Mutually Exclusive Markers)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. Evaluating gene pair rankings on repeat trained models of the full TICA dataset, we find that all four preprocessing types show a similar ranking of co-expressed gene pairs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1A</xref>, left). Interestingly, raw counts produce significantly lower rankings for mutually exclusive gene pairs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1A</xref>, right). When introducing an artificial batch effect, we find that raw counts generate significantly lower rankings for mutually exclusive marker pairs (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2B</xref>). Next, we compared the cell type prediction accuracy between normalization procedures using the same gene markers used to perform cell type prediction in the main results section on both the full and subset datasets with artificial batch effect. Raw counts significantly outperformed all other preprocessing inputs by a large margin, with both normalized and log-normalized showing very poor performance (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2C, D</xref>). Our results suggest that normalization increases association between pairs of genes with mutually exclusive expression, resulting in negative downstream performance of cell type prediction. Cell typing appears to be sensitive to mutual exclusivity of cell type markers, and normalization produces slight increases in cosine similarity between gene vectors of mutually exclusive genes resulting in poor cell typing accuracy.</p>
      <p id="Par17">After learning the gene embedding, GeneVector allows rapid testing of different marker genes and phenotypes in exploratory analysis settings. Increased performance in classification is important given the large variation of markers used to define the same phenotypes across different studies. Cell type prediction can be recomputed interactively within a Jupyter notebook within twenty seconds for even large datasets on most machines (Supplementary Fig. <xref rid="MOESM1" ref-type="media">2</xref>). An additional advantage of having a probability is the ability to map genes from known pathways to a continuous value in each cell. In both phenotype and pathway, demonstration of continuous gradients across cells provides a measure of change and activation that cannot be seen from unsupervised clustering.</p>
    </sec>
    <sec id="Sec6">
      <title>Comparison of Methods in Identification of Interferon Metagenes in 10k Human PBMCs</title>
      <p id="Par18">To identify cell-specific metagenes related to interferon beta stimulation and compare with transcriptional programs identified by PCA and LDVAE loadings, we trained GeneVector using peripheral blood mononuclear cells (PBMCs) scRNA-seq data from 6855 quality control filtered cells composed of an interferon beta stimulated sample and a control sample<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. The raw count matrix was subset to 1000 highly variable genes using the Seurat V3 method<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> as implemented in Scanpy<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. We used previously annotated cell types generated from unsupervised clustering as ground truth labels<sup><xref ref-type="bibr" rid="CR33">33</xref></sup>. The cell embedding used for batch correction was generated by weighting gene vectors by the normalized, log-transformed expression in each cell. A comparison of the uncorrected UMAP embedding (Fig. <xref rid="Fig4" ref-type="fig">4A</xref>) and subsequent GeneVector-based batch correction (Fig. <xref rid="Fig4" ref-type="fig">4B</xref>) demonstrates correction in the alignment of cell types between the two conditions. However, in contrast to batch correction using Harmony<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> (Fig. <xref rid="Fig4" ref-type="fig">4C</xref>), not all variation is lost between the interferon beta stimulated and control cells. Specifically, GeneVector does not align myeloid cell types, suggesting a larger effect of the interferon beta stimulation treatment in these cells. Finally, we explored the impact of cell type composition on batch correction performance and found that CD14+ Monocytes had the largest batch silhouette coefficient, indicating that stimulated and control Monocytes differed the most across cell types (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6G</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Comparing Methods with Interferon Beta Stimulated 10 K PBMC.</title><p><bold>A</bold> Uncorrected GeneVector UMAPs showing stimulated condition (left) and cell type annotation (right) on 10k PBMCs with control and interferon beta stimulated cells. <bold>B</bold> GeneVector batch corrected UMAPs showing stimulated condition (left) and cell type annotation (right) indicated stronger interferon-beta stimulated response in myeloid cells. <bold>C</bold> Harmony batch correction applied to normalized expression eliminates all variation related to interferon beta stimulation. <bold>D</bold> Most similar genes by cosine similarity to <italic>IFIT1</italic> includes genes found in Reactome interferon related pathways. <bold>E</bold> Gene embedding UMAP highlighting an ISG (interferon stimulated genes) metagene that includes genes most similar to <italic>IFIT1</italic>. <bold>F</bold> Scaled log-normalized expression of ISG (interferon stimulated gene) metagene shows increased expression across stimulated cells without cell type specific effects. <bold>G</bold> PCA embedding colored by cell type (left) and stimulation (right). <bold>H</bold> Top genes by contribution to variance indicates PC1 defines cell type. <bold>I</bold> Top genes by contribution to PC2 defined by ISG stimulation colored by scaled normalized, log-transformed gene expression scaled by variable. <bold>J</bold>, <bold>K</bold> Scaled normalized, log-transformed expression scaled by variable of ISG related loadings from PCA (left) and LDVAE (right) includes cell type specific markers intermixed with ISGs. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig4_HTML" id="d32e1063"/></fig></p>
      <p id="Par19">As a method of both validation and exploration, GeneVector provides the ability to query similarity in genes. For a given target gene, a list of the closest genes sorted by cosine similarity can be generated. This is useful in both validating known markers and identifying the function of unfamiliar genes by context. The genes most similar to IFIT1 (Fig. <xref rid="Fig4" ref-type="fig">4D</xref>) include a large proportion of genes found in the Reactome pathway Interferon Signaling (R-I-913531) (Gillespie et al. 2022). After clustering gene vectors, we identify a single metagene that includes these genes (<italic>IFIT1</italic>, <italic>IFIT2</italic>, <italic>IFIT3</italic>, <italic>ISG15</italic>, <italic>ISG20</italic>, <italic>TFGS10</italic>, <italic>RSAD2</italic>, <italic>LYSE</italic>, <italic>OAS1</italic>, and <italic>MX1</italic>). The ISG metagene can be visualized on a UMAP generated from the gene embedding, like the familiar cell-based visualizations common in scRNA-seq studies (Fig. <xref rid="Fig4" ref-type="fig">4E</xref>). The mean and scaled log-normalized expression of each gene identified in the ISG metagene is significantly higher in interferon beta stimulated cells over control cells (Fig. <xref rid="Fig4" ref-type="fig">4F</xref>). Importantly, the increased expression is found in each cell type, indicating a global relation to treatment.</p>
      <p id="Par20">To compare the ISG metagene with results generated from PCA loadings, we performed PCA on the normalized and log-transformed gene-by-cell expression matrix (Fig. <xref rid="Fig4" ref-type="fig">4G</xref>) and colored the embedding by cell type and treatment. After computing the PCA loadings using Scanpy<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>, we identified the top genes by contribution score to variation in the first and second principal components. The first principal component (PC1) explains variation related to cell type and the differences between myeloid (<italic>TYROBP</italic>, <italic>FCER1G</italic>, <italic>FTL</italic>, <italic>CST3</italic>) and T cells <italic>(LTB</italic>, <italic>CCR7</italic>) (Fig. <xref rid="Fig4" ref-type="fig">4H</xref>). The second principal highlights the variation related to interferon beta stimulation and includes the genes found in the ISG metagene generated by GeneVector (Fig. <xref rid="Fig4" ref-type="fig">4I</xref>). However, the increased effect of interferon stimulation in myeloid cells, conflates myeloid specific ISGs with the interferon signature. One such gene is <italic>CXCL10</italic>, which shows cell type specificity to myeloid cells (Fig. <xref rid="Fig4" ref-type="fig">4J</xref>) and is not found in the interferon signaling Reactome pathways. Additionally, <italic>IFITM3</italic> shows increased expression only in myeloid cells within these PBMCs. In contrast, GeneVector produces a metagene that groups myeloid specific genes into a single metagene including <italic>CXCL10</italic> and <italic>IFITM3</italic>. A full list of metagenes produced by GeneVector is presented in Supplementary Fig. <xref rid="MOESM1" ref-type="media">3</xref>. Among these metagenes, we identify transcriptional programs specific to each cell type and treatment condition, including those found in the least represented cell type Megakaryocytes (132 of 14,038 cells).</p>
      <p id="Par21">To compare the GeneVector ISG metagene with LDVAE, we trained an LDVAE model using 10 latent dimensions for 250 epochs with control and stimulated batch labels in the SCVI framework on the unnormalized read counts. In contrast to the specificity of the GeneVector ISG metagene that includes only interferon stimulated genes, the nearest LDVAE loading mixes interferon-related genes with markers of T cell activation (<italic>PRF1</italic>) and T cell dysfunction (<italic>LAG3</italic>) (Fig. <xref rid="Fig4" ref-type="fig">4K</xref>). With respect to PCA and LDVAE loadings, GeneVector identified an ISG metagene that is not confounded by cell type and includes only interferon pathway related genes.</p>
    </sec>
    <sec id="Sec7">
      <title>Metagenes changes between primary and metastatic site in HGSOC</title>
      <p id="Par22">Studies with scRNA-seq data sampled from multiple tumor sites in the same patient provide a wide picture of cancer progression and spread. As these datasets grow larger and more complex, understanding the transcriptional changes that occur from primary to metastatic sites can help identify mechanisms that aid in the process of the invasion-metastasis cascade. GeneVector provides a framework for asking such questions in the form of latent space arithmetic. By defining the difference between two sites as a vector, where the direction defines transcriptional change, we identify metagenes associated with expression loss and gain between primary and metastasis sites from six patients in the Memorial Sloan Kettering Cancer Center SPECTRUM cohort of patients with high-grade serous ovarian cancer (HGSOC)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>.</p>
      <p id="Par23">A set of 270,833 cells quality control filtered cells from adnexa (primary) and bowel (metastasis) samples were processed with GeneVector (Fig. <xref rid="Fig5" ref-type="fig">5A</xref>). The unnormalized counts were subset to 2000 highly variable genes were used as input to GeneVector and cells were classified to one of six cell types using gene markers curated for HGSOC and two markers for cancer cells (<italic>EPCAM</italic> and <italic>CD24</italic>)<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>. We performed cell type classification (Methods: Cell Type Assignment) and compared GeneVector accuracy to the original annotations generated from CellAssign for each cell type in a confusion matrix (Fig. <xref rid="Fig5" ref-type="fig">5B</xref>). Accuracy reached 99.7% in three cell types with a minimum classification rate of 94.1%. In cells where GeneVector annotated differently than previous annotations, there is evidence from the differentially expressed genes that these cells may have been initially mislabeled. GeneVector reassigned a subset of cancer cells to fibroblast and the differentially expressed genes between these cells and the cells annotated as cancer by GeneVector highlighted fibroblast cell type markers including <italic>COL1A1</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4A</xref>). In B/Plasma cells reassigned as T cells, the differentially expressed genes highlight B cell receptor genes <italic>IGK</italic> and <italic>IGLC2</italic> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4B</xref>). Finally, in B/Plasma cells classified as myeloid, the top differentially expressed genes include known canonical markers for macrophage/monocyte cells (<italic>TYROBP</italic>, <italic>LYZ</italic>, <italic>CD4</italic>, and <italic>AIF1</italic>)<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">4C</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>Metagenes Associated with Directional Difference in HGSOC Cancer Cells from Adnexa to Bowel.</title><p><bold>A</bold> UMAP of HGSOC cells with classified by GeneVector. <bold>B</bold> Uncorrected UMAP of cancer cells from patients with adnexa and bowel samples. <bold>C</bold> GeneVector batch corrected UMAP with patient labels on site labels on batch corrected UMAP. <bold>D</bold> Confusion matrix of accuracy comparing SPECTRUM annotated cell types with GeneVector classification. <bold>E</bold> Hallmark pathway enrichment for top 30 metagenes by cosine similarity to <bold>V</bold><sub>adnexa</sub> – <bold>V</bold><sub>bowel</sub>. <bold>F</bold> Hallmark pathway enrichment for top 30 metagenes by cosine similarity to <bold>V</bold><sub>bowel</sub> – <bold>V</bold><sub>adnexa</sub>. <bold>G</bold> Pseudo-probabilities for metagenes associated with up-regulation in bowel to adnexa (Epithelial-to-Mesenchymal Transition) and down-regulation (Major Histocompatibility Class I). <bold>H</bold> EMT (Epithelial-Mesenchymal Transition) metagene significantly up regulated in four of six patients by gene module score. <bold>I</bold> MHC Class I (MHCI) metagene significantly downregulated in the metastatic site (bowel) in three of six patients by gene module score. Source data provided as a Source Data file. The center of the box plot is denoted by the median, a horizontal line dividing the box into two equal halves. The bounds of the box are defined by the lower quartile (25th percentile) and the upper quartile (75th percentile). The whiskers extend from the box and represent the data points that fall within 1.5 times the interquartile range (IQR) from the lower and upper quartiles. Any data point outside this range is considered an outlier and plotted separately. Significance assessed using Mann-Whitney-Wilcoxon two-sided test.</p></caption><graphic xlink:href="41467_2023_39985_Fig5_HTML" id="d32e1292"/></fig></p>
      <p id="Par24">We recomputed the gene embedding and metagenes on only those cells classified as cancer by GeneVector with both adnexa and bowel samples. We found these cells exhibited large patient specific batch effects (Fig. <xref rid="Fig5" ref-type="fig">5C</xref>) and applied GeneVector batch correction (Fig. <xref rid="Fig5" ref-type="fig">5D, E</xref>). To understand the changes between primary and metastatic sites, we computed an average vector for all cells from the adnexa (<bold>V</bold><sub>adnexa</sub>) as the primary site and bowel (<bold>V</bold><sub>bowel</sub>) as the site of metastasis. We mapped the top 30 most similar metagenes to vectors representing expression gain in metastasis (<bold>V</bold><sub>adnexa</sub> - <bold>V</bold><sub>bowel</sub>) (Fig. <xref rid="Fig5" ref-type="fig">5F</xref>) and expression loss (v<sub>bowel</sub> - v<sub>adnexa</sub>) (Fig. <xref rid="Fig5" ref-type="fig">5G</xref>). Gene Set Enrichment Analysis (GSEA) using GSEAPY with Hallmark gene set annotations from Enrichr<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> was performed to assess whether metagenes were enriched for genes from known pathways. Metagenes enriched for E2F targets and Epithelial-to-Mesenchymal Transition (EMT) pathway genes were found gained in metastasis. Conversely, the set of metagenes representative of loss from adnexa to bowel included MHC Class I (<italic>HLA-A</italic>, <italic>HLA-B</italic>, <italic>HLA-C</italic>, <italic>HLA-E</italic>, and <italic>HLA-F</italic>) and the transcriptional regulator <italic>B2M</italic>, suggesting a means of immune escape via loss of MHC Class I expression and higher immune pressure in metastatic sites may increase the potential fitness benefit of MHC Class I loss. For both the EMT and MHCI metagenes, pseudo-probabilities computed using GeneVector highlight pathway activity in either site in the UMAP embedding (Fig. <xref rid="Fig5" ref-type="fig">5H</xref><bold>)</bold>. Computing the gene module scoring on the normalized, log-transformed expression<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>, we examined the change between sites in each patient for the EMT and MHCI metagenes. We found that the MHCI metagene is significantly downregulated in metastatic sites in four of six patients (Fig. <xref rid="Fig5" ref-type="fig">5I</xref>). Conversely, the EMT metagene was significantly up regulated in metastatic sites for three of six patients (Fig. <xref rid="Fig5" ref-type="fig">5J</xref>). The ability to phrase questions about transcriptional change as vector arithmetic provides a powerful platform for more complex queries than can be performed with differential expression analysis alone.</p>
      <p id="Par25">It is possible to perform latent space arithmetic operations on any embedding that is computed from a linear transformation of the gene space, including PCA. To assess the performance of latent space arithmetic using GeneVector and the principal components of a PCA decomposition of the gene expression matrix, we performed the same analysis on the cell-by-gene matrix. After clustering the gene embedding using the Leiden algorithm and we generated a list of candidate metagenes. We recomputed a representative vector for changes from bowel to adnexa by subtracting <bold>V</bold><sub>adnexa</sub> - <bold>V</bold><sub>bowel</sub> and selected the most similar metagenes. Like the GeneVector analysis, we recovered a metagene related to MHC Class I using the PCA embedding. However, several of the genes within this metagene were not present in the Reactome MHC Class I pathway (HSA-983169), in contrast to the GeneVector results which found a metagene containing only <italic>HLA-A</italic>, <italic>HLA-B</italic>, <italic>HLA-C</italic>, and <italic>B2M</italic>. To test if the unannotated genes defined by the PCA embedding were members of any gene signatures which contained HLA genes, we calculated the percentage of Reactome pathways that include individual gene pairs and plotted this as a heatmap over all genes in the metagene <bold>(</bold>Supplementary Fig. <xref rid="MOESM1" ref-type="media">5A</xref>). The genes <italic>TMEM59, SERINC2, FOLR1</italic>, and <italic>WFDC2</italic> were not found as a pair within any Reactome pathway. We concluded that the PCA embedding identified an MHC Class I metagene that was less consistent with previously annotated pathways than GeneVector.</p>
      <p id="Par26">Given that the metagenes are computed using Leiden clustering, the resolution parameter affects the coarseness of the PCA embedding. We performed a parameter sweep over resolution values and found that the genes identified by the PCA analysis are robustly clustered together over a wide range of resolutions (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5B</xref>). In comparison, GeneVector identifies a metagene containing <italic>HLA-A</italic>, <italic>HLA-B</italic>, <italic>HLA-C</italic>, and <italic>B2M</italic> over a wide range of resolution parameters (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5C</xref>). The interval of values used for the parameter sweep was selected to keep metagene membership between three and 50 genes and represents the most reasonable range of values for generating metagenes of this size. To understand why non MHCI-annotated genes appear in the context of MHC genes in the PCA embedding, we looked at differentially expressed genes up-regulated in adnexa over bowel. We found that while these genes do not appear in Reactome pathways together, they do appear significantly differentially expressed between adnexa and bowel. Here, we draw the conclusion that PCA combines multiple pathways to explain as much variance as possible when constructing successive orthogonal PCA components. As a result, PCA will combine multiple underlying sources of variance such as bowel/adnexa variation, and MHC I variation between cells. By contrast, GeneVector has no orthogonality constraints and is not constructed to maximize variance explained by individual vectors, allowing GeneVector to decompose pathway specific metagenes in a more flexible manner.</p>
    </sec>
    <sec id="Sec8">
      <title>Metagenes associated with cisplatin treatment resistance</title>
      <p id="Par27">Understanding the transcriptional processes that generate resistance to chemotherapies has immense clinical value. However, the transcriptional organization of resistance is complex with many parallel mechanisms contributing to cancer cell survival<sup><xref ref-type="bibr" rid="CR37">37</xref></sup>. We analyzed longitudinal single cell RNA-seq collected from a triple negative breast cancer patient-derived xenograft model (SA609 PDX) along a treated and untreated time series<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>. Using a total of 19,799 cancer cells with treatment and timepoint labels (Fig. <xref rid="Fig6" ref-type="fig">6A</xref>), GeneVector was trained using unnormalized read counts to generate metagenes that identify programs potentially related to cisplatin resistance. For each metagene, we computed gene module scores over normalized and log-transformed expression<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> over the four timepoint (X1, X2, X3, and X4) within the treated and untreated cells. Using these scores, we calculated linear regression coefficients over the four time points and selected candidate chemotherapy resistant and untreated metagenes (<italic>β</italic><sub><italic>treated</italic></sub> and <italic>β</italic><sub><italic>untreated</italic></sub><italic>)</italic> over a coefficient threshold (<italic>β</italic><sub><italic>treated</italic></sub> &gt; 0.1 and Bonferroni adjusted <italic>p</italic> = 0.001) with an untreated coefficient less than the treated coefficient (<italic>β</italic><sub><italic>treated</italic></sub>
<italic>&gt; β</italic><sub><italic>untreated</italic></sub><italic>)</italic>
<bold>(</bold>Fig. <xref rid="Fig6" ref-type="fig">6B</xref>). Mean log-normalized expression per gene was computed for each timepoint in five metagenes that were identified as treatment specific (Fig. <xref rid="Fig6" ref-type="fig">6C</xref>).<fig id="Fig6"><label>Fig. 6</label><caption><title>Analysis of Metagenes in Cisplatin-treated PDX Time Series.</title><p><bold>A</bold> UMAP of cisplatin treated PDX (patient derived xenograft) cells annotated by time point (left) and treatment status (right). <bold>B</bold> Metagenes plotted with respect to regression coefficients (β<sub>treated</sub> and β<sub>untreated</sub>) over four timepoints in either treated or untreated cells with Bonferroni adjusted <italic>p</italic>-values = 0.001. <bold>C</bold> Hallmark combined enrichment scores for candidate chemo resistant metagenes. <bold>D</bold> Gene expression profiles for each timepoint for the five metagenes associated with increase in treatment. Metagene 24 is associated with TGF-beta signaling includes <italic>EPCAM</italic>, <italic>FOXP1</italic>, and <italic>ID</italic> family genes with known cisplatin resistance function. <bold>E</bold> Most similar genes for treated and untreated cells computed from cosine similarity to global vectors. Source data provided as a Source Data file.</p></caption><graphic xlink:href="41467_2023_39985_Fig6_HTML" id="d32e1543"/></fig></p>
      <p id="Par28">Pathway enrichment on each of the five metagenes using GSEAPY with Hallmark gene set annotations from Enrichr<sup><xref ref-type="bibr" rid="CR35">35</xref></sup> showed that metagene 24 was enriched for TGF-beta signaling (Fig. <xref rid="Fig6" ref-type="fig">6D</xref>), a pathway frequently up-regulated during chemo-resistance<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>. This metagene includes genes <italic>ID1</italic>, <italic>ID2</italic>, <italic>ID3</italic>, <italic>ID4</italic>, <italic>EPCAM</italic>, and <italic>FOXP1</italic>, all of which have been found to be overexpressed in chemotherapy-resistant samples in several cancer types<sup><xref ref-type="bibr" rid="CR39">39</xref>–<xref ref-type="bibr" rid="CR41">41</xref></sup>. GeneVector also identified these genes in global expression differences between treated and untreated cells from the set of most similar genes to vectors <bold>V</bold><sub>treated</sub> and <bold>V</bold><sub>untreated</sub> (Fig. <xref rid="Fig6" ref-type="fig">6E</xref>). Several studies have implicated multiple resistance mechanisms involving FOXP1 including transcriptional regulation, immune response, and MAPK signaling<sup><xref ref-type="bibr" rid="CR42">42</xref>–<xref ref-type="bibr" rid="CR44">44</xref></sup>. Additionally, GeneVector identifies <italic>EPCAM</italic>, whose high expression has been associated with increased viability of cancer cells in diverse cancer types<sup><xref ref-type="bibr" rid="CR45">45</xref></sup>. <italic>EPCAM</italic> has been shown to have a role in resistance to chemotherapy in both breast and ovarian cancers through WNT signaling and Epithelial-Mesenchymal Transition (EMT)<sup><xref ref-type="bibr" rid="CR46">46</xref>,<xref ref-type="bibr" rid="CR47">47</xref></sup>.</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par29">In this paper we propose GeneVector, a method for building a latent vector representation of scRNA expression capturing the relevant statistical dependencies between genes. By borrowing expression signal across genes, GeneVector overcomes sparsity and produces an information dense representation of each gene. The resulting vectors can be used to generate a gene co-expression graph, and can be clustered to predict transcriptional programs, or metagenes, in an unsupervised fashion. Metagenes can be related to a cell embedding to identify transcriptional changes related to conditional labels or time points. We show that gene vectors can be used to annotate cells with a pseudo-probability, and that these labels are accurate with respect to previously defined cell types.</p>
    <p id="Par30">We show that a single GeneVector embedding can be used for many important downstream analyses. In interferon-stimulated PBMCs, we identify a cell type independent ISG metagene that summarizes interferon-stimulation across cell types and is not conflated with cell type signature. We demonstrate accurate cell type assignment across 18 different cancers in 181 patients described in the Tumor Immune Cell Atlas (TICA). In high grade serous ovarian cancer, we identify metagenes that describe transcriptional changes from primary to metastatic sites. Our results implicate the loss of MHC class I gene expression as a potential immune escape mechanism in ovarian cancer metastasis. In cisplatin treated TNBC PDXs, GeneVector uncovers transcriptional signatures active in drug resistance, most notably metagenes enriched in TGF-beta signaling. This signaling pathway is a cornerstone in cancer progression since it promotes EMT transition and invasion in advanced cancers; it is the target of various therapies, but success has been mixed<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> making it even more important to employ tools that identify the multitude of players contributing to therapy response.</p>
    <p id="Par31">GeneVector can produce an interpretable batch correction by decomposing the derived correction vectors into transcriptional signatures. Using both the full PBMC dataset and simulated mixtures of CD14+ monocytes and CD4 T cells, we systematically evaluated the quality of batch correction using a series of benchmarking metrics (ARI, kBET, cLISI, and silhouette score)<sup><xref ref-type="bibr" rid="CR49">49</xref>,<xref ref-type="bibr" rid="CR50">50</xref></sup> (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6A–I</xref>). For the interferon beta stimulated PBMC dataset, we expect the proper batch correction to include ISGs, and indeed the batch correction vector had high cosine similarity to an ISG metagene. In simulated mixtures of cell types, we found that the similarity of the batch correction vector to ISGs was highest when the ratio of cell types was balanced in the unstimulated and stimulated batches, we obtained the best batch correction performance for balanced batches (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6J</xref>). By contrast, when cell types were imbalanced, batch correction vectors had high similarity to cell type specific vectors (Supplementary Fig. <xref rid="MOESM1" ref-type="media">6K, L</xref>). Batch correction is challenging in the presence of batch-specific differences in cell type composition. As opposed to other batch correction methods, the GeneVector implementation is highly interpretable, so users can verify whether batch correction vectors are similar to cell type signatures or other biologically relevant metagenes.</p>
    <p id="Par32">Identifying correlations across scRNA data is a fundamental analysis task, necessary for identifying cells with similar phenotype or activity, or genes with similar pathways or functional relationships. As has been shown by us and in previous work<sup><xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR16">16</xref>,<xref ref-type="bibr" rid="CR51">51</xref></sup>, the sparsity and non-linearity of scRNA data impact the performance of both standard measures of correlations between variables and global analysis of assumed linear correlations using PCA. While some methods tailor complex custom probabilistic models to the specific properties of scRNA data, GeneVector instead builds upon MI, a simple yet powerful tool for calculating the amount of information shared between two variables. We show that MI and the vector space trained from the MI matrix both capture relevant gene pair relationships including between TF activators and repressors and their targets. Nevertheless, GeneVector is unable to discern repression from activation, as it builds MI that is agnostic to the direction of the statistical dependency. Pearson correlation, theoretically sensitive to the direction of a dependency, also performs poorly. Due to the high-level of sparsity, absence of expression is not a significant event and repressed expression could just as easily be explained by under-sampling an expressed gene. We suggest that identifying negative regulation and mutually exclusive expression is one of the more difficult problems in scRNA-seq analysis.</p>
    <p id="Par33">As shown with correlation, the objective function employed in training GeneVector has a significant effect on the resulting gene embedding. Mutual information calculated empirically from the histogram of binned expression counts for gene pairs is limited by the available number of cells, fidelity of the counts, and discretization strategy. By modeling the underlying distribution for each gene more accurately, the joint probability distribution between genes can more accurately reflect expression-based relationships and improve model results. Additionally, while only a one-time cost, the MI calculation is computationally expensive. By improving the calculation of mutual information, others have achieved improved performance in related tasks including the identification of GRNs<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>.</p>
    <p id="Par34">The high dimensionality of scRNA and the vast complexity of biological systems to which it is applied necessitate analytical tools that facilitate intuitive and efficient data exploration and produce easily interpretable results. GeneVector performs upfront computation of a meaningful low dimensional representation, transforming sparse and correlated expression measurements into a concise vector space summarizing the underlying structure in the data. The resulting vector space is amenable to intuitive vector arithmetic operations that can be composed into higher level analyses including cell type classification, treatment related gene signature discovery, and identification of functionally related genes. Importantly, the vector arithmetic operations and higher-level analyses can be performed interactively, allowing for faster iteration in developing cell type and context specific gene signatures or testing hypotheses related to experimental covariates. GeneVector is implemented as a python package available on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/nceglia/genevector">https://github.com/nceglia/genevector</ext-link>) and installable via PIP.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Dataset preprocessing</title>
      <p id="Par35">Each single cell RNA-seq dataset in this study was processed using the Scanpy python library<sup><xref ref-type="bibr" rid="CR7">7</xref></sup>. All highly variable gene selection was performed using the Seurat V3<sup><xref ref-type="bibr" rid="CR6">6</xref></sup> method implemented in Scanpy. We performed cell type classification on 23,764 cells from the Tumor Immune Cell Atlas (TICA)<sup><xref ref-type="bibr" rid="CR20">20</xref></sup> using raw read counts from 2,000 highly variable after removal of non-protein coding genes. We performed analysis of 6,855 cells composed of an interferon beta stimulated sample and a control sample using raw counts and cell type annotations obtained from the SeuratData R package<sup><xref ref-type="bibr" rid="CR33">33</xref></sup> and subset to 1000 highly variable genes. The fitness PDX dataset<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> consisted of raw counts from 19,799 cancer cells with treatment and timepoint labels subset to 2000 highly variable genes. Coefficients and <italic>p</italic>-values were computed over gene module scores using the statsmodels python package. Cell type classification and vector arithmetic for the changes between metastatic and primary sites was performed on 270,833 cells from adnexa (primary) and bowel (metastasis) samples using 2000 highly variable genes. Normalization comparisons were made using the Scanpy normalize_total and log1p functions. All subsampling of datasets for simulated batch effects was performed using the Scanpy subsample function.</p>
    </sec>
    <sec id="Sec12">
      <title>Gene expression mutual information</title>
      <p id="Par36">In NLP applications, vector space models are trained by defining an association between words that appear in the same context. In single cell RNA sequencing data, we can redefine this textual context as co-expression within a given cell and mutual information across cells. The simplest metric to define association is the overall number of co-expression events between genes. However, the expression profiles over cells may differ due to both technical and biological factors. To summarize the variability in this relationship, we generate a joint probability distribution on the co-occurrence of read counts. The ranges of each bin are defined separately for each gene based on a user defined number of quantiles. By defining the bin ranges separately, the lowest counts in one gene can be compared directly to the lowest counts in another gene without need for further normalization. Using the joint probability distribution, we compute the mutual information between genes defined in Eq. <xref rid="Equ1" ref-type="disp-formula">1</xref>. The mutual information value is subsequently used as the target in training the model, allowing us to highlight the relationship between genes as a single-valued quantity.<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$I\left({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\right)=\mathop{\sum }\limits_{i}^{n}\mathop{\sum }\limits_{j}^{n}p\left({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\right)\log \left(\frac{p\big({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\big)}{p\left({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}}\right),p\big({{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}}\big)}\right)$$\end{document}</tex-math><mml:math id="M2"><mml:mi>I</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:munderover accent="false" accentunder="false"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mi>p</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>log</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mstyle mathsize="1.19em"><mml:mfenced open="("><mml:mrow/></mml:mfenced></mml:mstyle><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub><mml:mstyle mathsize="1.19em"><mml:mfenced open=")"><mml:mrow/></mml:mfenced></mml:mstyle></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par37">Equation <xref rid="Equ1" ref-type="disp-formula">1</xref>: Mutual information between <bold>G</bold><sub>i</sub> and <bold>G</bold><sub>j</sub> computed on the empirical joint probability distribution over expression bins for <bold>G</bold><sub>i</sub> and <bold>G</bold><sub>j</sub>.</p>
    </sec>
    <sec id="Sec13">
      <title>Model training</title>
      <p id="Par38">A neural network is constructed from a single hidden layer corresponding to the size of the latent space vectors. A set of independently updated weights connects the one-hot encoded input and output layers that are defined from each pair of genes. These weights, <bold>w</bold><sub>1</sub> and <bold>w</bold><sub>2</sub>, are matrices with dimensions equal to <italic>N</italic> expressed genes by <italic>I</italic> hidden units. Initial values for <bold>w</bold><sub>1</sub> and <bold>w</bold><sub>2</sub> are generated uniformly on the interval −1 to 1. The objective function, as a minimization of least squares, is defined in Eq. <xref rid="Equ2" ref-type="disp-formula">2</xref>. The final latent space, defined as the gene embedding, is computed as the vector average of weights <italic>w</italic><sub><italic>1</italic></sub> and <italic>w</italic><sub><italic>2</italic></sub>. For NLP applications, this is a preferred approach over selecting either weight matrix<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>. Each co-expressed gene pair is used as a single training example. The maximum number of examples for a full training epoch is given by the total number of co-expressed gene pairs. Weights are batch updated with adaptive gradient descent (ADADELTA)<sup><xref ref-type="bibr" rid="CR53">53</xref></sup>. Training is halted at either a maximum number of epochs, or when the change in loss falls below a specified threshold. The results presented used unnormalized integer read counts, but any matrix can be used as input to the model. The model is implemented in PyTorch.<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$J={\left({{{{{{{\bf{w}}}}}}}_{i}}^{T}{\hat{{{{{{\bf{w}}}}}}}}_{j}-C*I({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}})\right)}^{2}$$\end{document}</tex-math><mml:math id="M4"><mml:mi>J</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfenced close=")" open="("><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>C</mml:mi><mml:mo>*</mml:mo><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par39">Equation <xref rid="Equ2" ref-type="disp-formula">2</xref>: Objective function for weights corresponding to gene <bold>G</bold><sub><bold>i</bold></sub> and <bold>G</bold><sub><bold>j</bold></sub>, where <inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$I({{{{{{\bf{G}}}}}}}_{{{{{{\bf{i}}}}}}},{{{{{{\bf{G}}}}}}}_{{{{{{\bf{j}}}}}}})$$\end{document}</tex-math><mml:math id="M6"><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq1.gif"/></alternatives></inline-formula> is the mutual information and <italic>C</italic> is a constant.</p>
    </sec>
    <sec id="Sec14">
      <title>Gene vectors</title>
      <p id="Par40">The cosine similarity function, defined in Eq. <xref rid="Equ3" ref-type="disp-formula">3</xref>, is used to measure similarity between vectors, defined as 1 - cosine distance or dot product. Values closer to 1 indicate strong association within the dataset. A gene vector is defined as the learned weights in the gene embedding for a particular gene. Vectors describing groups of cells are generated by computing a weighted average vector, described in Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref>, from a set of individual gene vectors.<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${cosinesimilarity}=1-\frac{{{{{{\bf{A}}}}}}*{{{{{\bf{B}}}}}}}{\left|\left|{{{{{\bf{A}}}}}}\right|\right |*\left|\left|{{{{{\bf{B}}}}}}\right|\right|}$$\end{document}</tex-math><mml:math id="M8"><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="bold">A</mml:mi><mml:mo>*</mml:mo><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mi mathvariant="bold">A</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>*</mml:mo><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mfenced close="∣" open="∣"><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par41">Equation <xref rid="Equ3" ref-type="disp-formula">3</xref>: Cosine similarity as the dot-product between feature vectors <inline-formula id="IEq2"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$A$$\end{document}</tex-math><mml:math id="M10"><mml:mi>A</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq2.gif"/></alternatives></inline-formula> and <inline-formula id="IEq3"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$B$$\end{document}</tex-math><mml:math id="M12"><mml:mi>B</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq3.gif"/></alternatives></inline-formula>.</p>
      <p id="Par42">To assign a vector to each cell, the average vector is computed across the gene embedding weighted by the normalized, log-transformed expression observed in each cell. The matrix of all cell vectors in the dataset is defined as the cell embedding. This cell embedding can be used in place of PCA or embeddings obtained with variational auto-encoders. Each cell vector maintains a linear relationship with the gene embedding. The computation of vectors describing groups of cells is described in Eq. <xref rid="Equ4" ref-type="disp-formula">4</xref>.<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{\bf{C}}}}}}}_{{{{{{\bf{k}}}}}}}=\frac{{\sum }_{i=1}^{n}{{{{{\bf{w}}}}}}_{i\ast}{\underline{{{{{{\bf{x}}}}}}}_{{{{{{\bf{i}}}}}}}}}{{\sum }_{i=1}^{n}{{{{{\bf{w}}}}}}_{i}}$$\end{document}</tex-math><mml:math id="M14"><mml:msub><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>*</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:munder accentunder="true"><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="true">_</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mi mathvariant="bold">i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold">w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par43">Equation <xref rid="Equ4" ref-type="disp-formula">4</xref>: Vector <inline-formula id="IEq4"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${C}_{k}$$\end{document}</tex-math><mml:math id="M16"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq4.gif"/></alternatives></inline-formula> defined as the <inline-formula id="IEq5"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$k$$\end{document}</tex-math><mml:math id="M18"><mml:mi>k</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq5.gif"/></alternatives></inline-formula> th component of the cell embedding computed from the average mean of vectors <inline-formula id="IEq6"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\underline{x}}_{i\to n}$$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:munder accentunder="true"><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="true">_</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>→</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq6.gif"/></alternatives></inline-formula> where <inline-formula id="IEq7"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n$$\end{document}</tex-math><mml:math id="M22"><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq7.gif"/></alternatives></inline-formula> is equal to the number of hidden units.</p>
    </sec>
    <sec id="Sec15">
      <title>Co-expression similarity graph</title>
      <p id="Par44">A co-expression similarity graph is constructed from cosine similarity between each pair of genes using Scanpy neighborhood function with a default value for <italic>k</italic> of 15. A node in the graph represents a single gene and edges are weighted by cosine similarity. To generate metagenes, we apply Leiden clustering to the neighborhood graph with a user defined resolution argument. We have found that metagene clustering is robust to a range of resolution values ranging from 15 to 1000 when assessing the identification of an MHCI-like metagene in a single patient in the SPECTRUM cohort (Supplementary Fig. <xref rid="MOESM1" ref-type="media">5C</xref>).</p>
    </sec>
    <sec id="Sec16">
      <title>Cell type assignment</title>
      <p id="Par45">A set of cell types with user defined marker genes are used to perform a pseudo-probabilistic phenotype assignment in a single cell. A representative vector for the cell type is computed from the user defined marker genes weighted by the normalized and log-transformed expression of the cell to be classified. The cosine distances of each cell type vector with cell vector are passed through a SoftMax function, given in Eq. <xref rid="Equ5" ref-type="disp-formula">5</xref>, to provide a pseudo-probability distribution for each phenotype. The argument maximum of this distribution is used to classify the most likely cell type for a given cell. This procedure is repeated for every cell in the dataset.<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\sigma (z)_{i}=\frac{{e}^{{Z}_{i}}}{{\sum }_{j=1}^{n}{e}^{{Z}_{i}}}$$\end{document}</tex-math><mml:math id="M24"><mml:mi>σ</mml:mi><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo mathsize="big">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:math><graphic xlink:href="41467_2023_39985_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p>
      <p id="Par46">Equation <xref rid="Equ5" ref-type="disp-formula">5</xref>: SoftMax function where <inline-formula id="IEq8"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$z$$\end{document}</tex-math><mml:math id="M26"><mml:mi>z</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq8.gif"/></alternatives></inline-formula> is the set of cosine similarities for <inline-formula id="IEq9"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$n$$\end{document}</tex-math><mml:math id="M28"><mml:mi>n</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_39985_Article_IEq9.gif"/></alternatives></inline-formula> cell types.</p>
    </sec>
    <sec id="Sec17">
      <title>Generation of predictive genes</title>
      <p id="Par47">The method of phenotype assignment can be reversed to produce a set of genes that are most similar, or predictive, to any group of cells. The cell vectors belonging to this group can be averaged to generate a group vector representing a label in the dataset. The transcriptional signature associated with this group of cells can be computed using vector arithmetic <bold>V</bold><sub>group</sub> – <bold>V</bold><sub>dataset</sub>, where <bold>V</bold><sub>dataset</sub> is the average vector over all cells. Gene vectors are sorted by cosine similarity to the group vector to produce a ranked list of candidate genes that are most like the set of cells in the group.</p>
    </sec>
    <sec id="Sec18">
      <title>Batch correction</title>
      <p id="Par48">Batch correction is applied to cells over a given set of batch labels with the goal of correcting the difference between these batches and a user-specified reference batch. With the set of cells labeled for a batch, we can compute an average batch vector. A correction vector can then be computed for each batch using vector arithmetic to describe the direction and magnitude of the change from the batch to the reference. The correction vector is then added to each cell in the batch. After computing the cell embedding, the following procedure is applied to each batch label:<list list-type="order"><list-item><p id="Par49">Compute the average vector <bold>V</bold><sub>batch</sub> for a set of cells.</p></list-item><list-item><p id="Par50">Compute the reference vector <bold>V</bold><sub>reference</sub> for cells in the reference batch.</p></list-item><list-item><p id="Par51">Compute a correction vector <bold>V</bold><sub>correction</sub> = <bold>V</bold><sub>reference</sub> – <bold>V</bold><sub>batch</sub>.</p></list-item><list-item><p id="Par52">For each cell in the batch, subtract <bold>V</bold><sub>correction</sub> from each cell vector.</p></list-item><list-item><p id="Par53">Repeat for all <italic>n</italic> batches.</p></list-item></list></p>
    </sec>
    <sec id="Sec19">
      <title>Co-expressed and mutually exclusive markers</title>
      <p id="Par54">Cell type marker gene pairs used to benchmark normalization methods by identifying common differentially expressed genes in T cell, B cell, and monocyte lineage cell types across multiple datasets and extracting the top 10 markers of each cell type in each dataset. The union of extracted marker genes over all cell types for a given lineage (T cell, B cell, or monocyte) were ranked by the number of datasets where that gene was a marker. All combinations of markers in the top 10 ranked genes that were unique to a cell type were selected as the co-expressed pairs for T cell, B cell, and monocyte lineages. Mutually exclusive markers were defined as all combinations of gene pairs that were not found together in a single lineage.</p>
    </sec>
    <sec id="Sec20">
      <title>Time-series analysis of metagenes</title>
      <p id="Par55">Linear regression is applied to gene module scores computed over normalized, log-transformed expression<sup><xref ref-type="bibr" rid="CR36">36</xref></sup> over a series of time points for each metagene resulting in a <italic>p</italic>-value and slope coefficient from each series. Metagenes with a Bonferroni adjusted <italic>p</italic> = 0.001 and a treated coefficient greater than the untreated coefficient, with a minimum threshold of 0.1 were selected as treatment specific gene programs.</p>
    </sec>
    <sec id="Sec21">
      <title>Reporting summary</title>
      <p id="Par56">Further information on research design is available in the <xref rid="MOESM2" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec22">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_39985_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_39985_MOESM2_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec23">
        <title>Source data</title>
        <p id="Par60">
          <media position="anchor" xlink:href="41467_2023_39985_MOESM3_ESM.xlsx" id="MOESM3">
            <caption>
              <p>Source Data</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Zachary Sethna, Samuel S. Freeman.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-39985-2.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>This work was funded in part by awards to S.P.S.: Susan G. Komen Breast Cancer Foundation (SAC220206), the Department of Defense Congressionally Directed Medical Research Programs (CDMRP) award W81XWH2210759 and award W81XWH-20-1-0565, the Cancer Research UK Grand Challenge Program (GC-243330), the Ovarian Cancer Research Fund (1468), a National Cancer Institute (NCI) grant (P50-CA247749), an NIH U24 award (CA264028), an NIH RM1 award (RM1-HG011014). The work received further support from awards to B.D.G.: NCI grant RO1 CA269382-01A1, NIH SPORE grant P50-CA257881-01A1, NIH-SPORE grant P50- CA257881-01A1, the Department of Defense Congressionally Directed Medical Research Programs (CDMRP) award 582539, NCI UO1 CA228963-03, NCI RO1 CA240924, NCI RO1 CA262516-01A1, the Mark Foundation for Cancer Research (1388), Stand Up To Cancer (21-A0-00-1007566). S.P.S. holds the Nicholls-Biondi endowed chair in Computational Oncology. The project was further supported by the Marie-Josée and Henry R. Kravis Center for Molecular Oncology and NCI Cancer Center Core grant P30-CA008748 and by Cycle for Survival supporting Memorial Sloan Kettering Cancer Center. S.A. holds the Nan and Lorraine Robertson Chair in Breast Cancer and is a Canada Research Chair in Molecular Oncology (950–230610). Additional funding was provided by a Terry Fox Research Institute grant (1082), a Canadian Cancer Society Research Institute Impact program grant (705617), a CIHR grant (FDN-148429), Breast Cancer Research Foundation awards (BCRF-18-180, BCRF-19-180 and BCRF-20-180), a CCSRI grant (705636), the Canada Foundation for Innovation (40044) to S.A., and the Department of Defense Congressionally Directed Medical Research Programs (CDMRP) award W81XWH-20-10565 to S.A. and S.P.S.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>N.C. developed method, implemented software, performed analysis, authored manuscript. Z.S. developed method, guided analysis framework, and authored manuscript. S.S.F. developed method, performed data analysis, and authored manuscript. F.U. performed analysis. V.B. performed data analysis and developed visualizations. N.R. authored manuscript and provided analysis guidance. B.B. provided analysis guidance, biological interpretations, and manuscript editing. A.C. provided analysis guidance, biological interpretations, and manuscript editing. S.S. provided biological interpretations and manuscript editing. F.K. provided biological interpretations and manuscript editing. S.A. provided biological interpretations. B.G. supervised method development. S.P.S. supervised method development. A.M. developed method, authored manuscript, and supervised method development.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par57"><italic>Nature Communications</italic> thanks the anonymous reviewers for their contribution to the peer review of this work.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>No novel sequencing data were generated for this current study. All pre-processed single cell RNA-seq data analyzed in this study are available in the Zenodo database here [10.5281/zenodo.8079610]<sup><xref ref-type="bibr" rid="CR54">54</xref></sup>. The Tumor Immune Cell Atlas (TICA) processed data can be accessed here [<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/4263972">https://zenodo.org/record/4263972</ext-link>] and the raw data has been deposited in the Gene Expression Ominibus under the accession <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE158803">GSE158803</ext-link>. The PBMC dataset can be accessed through SeuratData R package<sup><xref ref-type="bibr" rid="CR32">32</xref>,<xref ref-type="bibr" rid="CR33">33</xref></sup> and has been deposited in the Gene Expression Omnibus under the accession number <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE96583">GSE96583</ext-link>. The SPECTRUM High Grade Serous Ovarian Cancer dataset can be accessed here [<ext-link ext-link-type="uri" xlink:href="https://cellxgene.cziscience.com/collections/4796c91c-9d8f-4692-be43-347b1727f9d8">https://cellxgene.cziscience.com/collections/4796c91c-9d8f-4692-be43-347b1727f9d8</ext-link>]. Raw 10x sequencing for the Fitness dataset is available from the European Genome-Phenome under study ID <ext-link ext-link-type="uri" xlink:href="https://ega-archive.org/studies/EGAS00001004448">EGAS00001004448</ext-link>. <xref rid="Sec23" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The authors declare that the code needed to reproduce analysis and findings of this study are available in the GitHub repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/nceglia/genevector">https://github.com/nceglia/genevector</ext-link>) and the GeneVector python package can be installed directly from using the Python installer package (PIP). Code released with this manuscript can be found at 10.5281/zenodo.8079885<sup><xref ref-type="bibr" rid="CR55">55</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par58">B.D.G. has received honoraria for speaking engagements from Merck, Bristol-Meyers Squibb and Chugai Pharmaceuticals; has received research funding from Bristol-Meyers Squibb; and has been a compensated consultant for PMV Pharma and Rome Therapeutics of which he is a co-founder. S.P.S. reports personal fees from Imagia Canexia Inc. S.S.F. is a co-inventor on provisional patent application No.62/866,261 titled “Methods for predicting outcomes of checkpoint inhibition and treatment thereof” related to prediction of melanoma immunotherapy outcomes. The remaining authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Segal</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Koller</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Kim</surname>
            <given-names>SK</given-names>
          </name>
        </person-group>
        <article-title>A gene-coexpression network for global discovery of conserved genetic modules</article-title>
        <source>Science</source>
        <year>2003</year>
        <volume>302</volume>
        <fpage>249</fpage>
        <lpage>255</lpage>
        <pub-id pub-id-type="doi">10.1126/science.1087447</pub-id>
        <pub-id pub-id-type="pmid">12934013</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Svensson</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Gayoso</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Pachter</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>Interpretable factor models of single-cell RNA-seq via variational autoencoders</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>3418</fpage>
        <lpage>3421</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa169</pub-id>
        <pub-id pub-id-type="pmid">32176273</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <mixed-citation publication-type="other">Mikolov, T., Chen, K., Corrado, G. &amp; Dean, J. <italic>Efficient Estimation of Word Representations in Vector Space</italic>. <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1301.3781">https://arxiv.org/abs/1301.3781</ext-link> (2013).</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <mixed-citation publication-type="other">Pennington, J., Socher, R. &amp; Manning, C. Glove: Global vectors for word representation. In <italic>Proceedings of the 2014 Conference on Empirical Methods in Natural Language Processing (EMNLP)</italic> (Association for Computational Linguistics, 2014). 10.3115/v1/d14-1162.</mixed-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Du</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene2vec: distributed representation of genes based on co-expression</article-title>
        <source>BMC Genomics</source>
        <year>2019</year>
        <volume>20</volume>
        <fpage>82</fpage>
        <pub-id pub-id-type="doi">10.1186/s12864-018-5370-x</pub-id>
        <pub-id pub-id-type="pmid">30712510</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hao</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrated analysis of multimodal single-cell data</article-title>
        <source>Cell</source>
        <year>2021</year>
        <volume>184</volume>
        <fpage>3573</fpage>
        <lpage>3587.e29</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id>
        <?supplied-pmid 34062119?>
        <pub-id pub-id-type="pmid">34062119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zheng</surname>
            <given-names>GXY</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>
        <source>Nat. Commun.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1038/ncomms14049</pub-id>
        <pub-id pub-id-type="pmid">28232747</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Traag</surname>
            <given-names>VA</given-names>
          </name>
          <name>
            <surname>Waltman</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>van Eck</surname>
            <given-names>NJ</given-names>
          </name>
        </person-group>
        <article-title>From Louvain to Leiden: guaranteeing well-connected communities</article-title>
        <source>Sci. Rep.</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>5233</fpage>
        <pub-id pub-id-type="doi">10.1038/s41598-019-41695-z</pub-id>
        <pub-id pub-id-type="pmid">30914743</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van der Maaten</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hinton</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>Visualizing data using t-SNE</article-title>
        <source>J. Mach. Learn. Res.</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>2579</fpage>
        <lpage>2605</lpage>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <mixed-citation publication-type="other">McInnes, L., Healy, J. &amp; Melville, J. UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction. <ext-link ext-link-type="uri" xlink:href="https://arXiv.org/abs/1802.03426">https://arXiv.org/abs/1802.03426</ext-link> (2018).</mixed-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Song</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Li</surname>
            <given-names>JJ</given-names>
          </name>
        </person-group>
        <article-title>Statistics or biology: the zero-inflation controversy about scRNA-seq data</article-title>
        <source>Genome Biol.</source>
        <year>2022</year>
        <volume>23</volume>
        <fpage>31</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-022-02601-5</pub-id>
        <pub-id pub-id-type="pmid">35063006</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tsuyuzaki</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Sato</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Sato</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Nikaido</surname>
            <given-names>I</given-names>
          </name>
        </person-group>
        <article-title>Benchmarking principal component analysis for large-scale single-cell RNA-sequencing</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>9</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1900-3</pub-id>
        <pub-id pub-id-type="pmid">31955711</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Margolin</surname>
            <given-names>AA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>ARACNE: an algorithm for the reconstruction of gene regulatory networks in a mammalian cellular context</article-title>
        <source>BMC Bioinf.</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>S7</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-7-S1-S7</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chan</surname>
            <given-names>TE</given-names>
          </name>
          <name>
            <surname>Stumpf</surname>
            <given-names>MPH</given-names>
          </name>
          <name>
            <surname>Babtie</surname>
            <given-names>AC</given-names>
          </name>
        </person-group>
        <article-title>Gene regulatory network inference from single-cell data using multivariate information measures</article-title>
        <source>Cell Syst.</source>
        <year>2017</year>
        <volume>5</volume>
        <fpage>251</fpage>
        <lpage>267.e3</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2017.08.014</pub-id>
        <pub-id pub-id-type="pmid">28957658</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Heydari</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>IQCELL: A platform for predicting the effect of gene perturbations on developmental trajectories using single-cell RNA-seq data</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2022</year>
        <volume>18</volume>
        <fpage>e1009907</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1009907</pub-id>
        <pub-id pub-id-type="pmid">35213533</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>van Dijk</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Recovering gene interactions from single-cell data using data diffusion</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>716</fpage>
        <lpage>729.e27</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.05.061</pub-id>
        <?supplied-pmid 29961576?>
        <pub-id pub-id-type="pmid">29961576</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kang</surname>
            <given-names>HM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplexed droplet single-cell RNA-sequencing using natural genetic variation</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>89</fpage>
        <lpage>94</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4042</pub-id>
        <pub-id pub-id-type="pmid">29227470</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nieto</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A single-cell tumor immune atlas for precision oncology</article-title>
        <source>Genome Res.</source>
        <year>2021</year>
        <volume>31</volume>
        <fpage>1913</fpage>
        <lpage>1926</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.273300.120</pub-id>
        <?supplied-pmid 34548323?>
        <pub-id pub-id-type="pmid">34548323</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vázquez-García</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Ovarian cancer mutational processes drive site-specific immune evasion</article-title>
        <source>Nature</source>
        <year>2022</year>
        <volume>612</volume>
        <fpage>778</fpage>
        <lpage>786</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-022-05496-1</pub-id>
        <?supplied-pmid 36517593?>
        <pub-id pub-id-type="pmid">36517593</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Salehi</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Clonal fitness inferred from time-series modelling of single-cell cancer genomes</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>595</volume>
        <fpage>585</fpage>
        <lpage>590</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-03648-3</pub-id>
        <?supplied-pmid 34163070?>
        <pub-id pub-id-type="pmid">34163070</pub-id>
      </element-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Zeiler, M. D. ADADELTA: An Adaptive Learning Rate Method. <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1212.5701">http://arxiv.org/abs/1212.5701</ext-link> (2012).</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gillespie</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The reactome pathway knowledgebase 2022</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2022</year>
        <volume>50</volume>
        <fpage>D687</fpage>
        <lpage>D692</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkab1028</pub-id>
        <?supplied-pmid 34788843?>
        <pub-id pub-id-type="pmid">34788843</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Liberzon</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Molecular signatures database (MSigDB) 3.0</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>1739</fpage>
        <lpage>1740</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr260</pub-id>
        <?supplied-pmid 21546393?>
        <pub-id pub-id-type="pmid">21546393</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Subramanian</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2005</year>
        <volume>102</volume>
        <fpage>15545</fpage>
        <lpage>15550</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id>
        <?supplied-pmid 16199517?>
        <pub-id pub-id-type="pmid">16199517</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>Q</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>hTFtarget: A Comprehensive Database for Regulations of Human Transcription Factors and Their Targets</article-title>
        <source>Genomics Proteomics Bioinformatics</source>
        <year>2020</year>
        <volume>18</volume>
        <fpage>120</fpage>
        <lpage>128</lpage>
        <pub-id pub-id-type="doi">10.1016/j.gpb.2019.09.006</pub-id>
        <?supplied-pmid 32858223?>
        <pub-id pub-id-type="pmid">32858223</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TRRUST v2: an expanded reference database of human and mouse transcriptional regulatory interactions</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2018</year>
        <volume>46</volume>
        <fpage>D380</fpage>
        <lpage>D386</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkx1013</pub-id>
        <pub-id pub-id-type="pmid">29087512</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>AW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Probabilistic cell-type assignment of single-cell RNA-seq for tumor microenvironment profiling</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1007</fpage>
        <lpage>1015</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0529-1</pub-id>
        <pub-id pub-id-type="pmid">31501550</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Conde</surname>
            <given-names>CD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cross-tissue immune cell analysis reveals tissue-specific features in humans</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>376</volume>
        <fpage>eabl5197</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abl5197</pub-id>
        <pub-id pub-id-type="pmid">35549406</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ziegler-Heitbrock</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Ohteki</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Ginhoux</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Shortman</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Spits</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Reclassifying plasmacytoid dendritic cells as innate lymphocytes</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2023</year>
        <volume>23</volume>
        <fpage>1</fpage>
        <lpage>2</lpage>
        <pub-id pub-id-type="doi">10.1038/s41577-022-00806-0</pub-id>
        <pub-id pub-id-type="pmid">36380022</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive Integration of Single-</article-title>
        <source>Cell Data. Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902.e21</lpage>
        <?supplied-pmid 31178118?>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Korsunsky</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title>
        <source>Nature Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>1289</fpage>
        <lpage>1296</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id>
        <?supplied-pmid 31740819?>
        <pub-id pub-id-type="pmid">31740819</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuleshov</surname>
            <given-names>MV</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Enrichr: a comprehensive gene set enrichment analysis web server 2016 update</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2016</year>
        <volume>44</volume>
        <fpage>W90</fpage>
        <lpage>W97</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkw377</pub-id>
        <?supplied-pmid 27141961?>
        <pub-id pub-id-type="pmid">27141961</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id>
        <?supplied-pmid 25867923?>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shen</surname>
            <given-names>D-W</given-names>
          </name>
          <name>
            <surname>Pouliot</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Hall</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Gottesman</surname>
            <given-names>MM</given-names>
          </name>
        </person-group>
        <article-title>Cisplatin resistance: a cellular self-defense mechanism resulting from multiple epigenetic and genetic changes</article-title>
        <source>Pharmacol. Rev.</source>
        <year>2012</year>
        <volume>64</volume>
        <fpage>706</fpage>
        <lpage>721</lpage>
        <pub-id pub-id-type="doi">10.1124/pr.111.005637</pub-id>
        <pub-id pub-id-type="pmid">22659329</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Bhola</surname>
            <given-names>NE</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TGF-β inhibition enhances chemotherapy action against triple-negative breast cancer</article-title>
        <source>J. Clin. Invest.</source>
        <year>2013</year>
        <volume>123</volume>
        <fpage>1348</fpage>
        <lpage>1358</lpage>
        <pub-id pub-id-type="doi">10.1172/JCI65416</pub-id>
        <pub-id pub-id-type="pmid">23391723</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of genes associated with cisplatin resistance in human oral squamous cell carcinoma cell line</article-title>
        <source>BMC Cancer</source>
        <year>2006</year>
        <volume>6</volume>
        <fpage>224</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2407-6-224</pub-id>
        <pub-id pub-id-type="pmid">16978399</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yamano</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of cisplatin-resistance related genes in head and neck squamous cell carcinoma</article-title>
        <source>Int. J. Cancer</source>
        <year>2010</year>
        <volume>126</volume>
        <fpage>437</fpage>
        <lpage>449</lpage>
        <pub-id pub-id-type="doi">10.1002/ijc.24704</pub-id>
        <pub-id pub-id-type="pmid">19569180</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Roberts</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Identification of genes associated with platinum drug sensitivity and resistance in human ovarian cancer cells</article-title>
        <source>Br. J. Cancer</source>
        <year>2005</year>
        <volume>92</volume>
        <fpage>1149</fpage>
        <lpage>1158</lpage>
        <pub-id pub-id-type="doi">10.1038/sj.bjc.6602447</pub-id>
        <pub-id pub-id-type="pmid">15726096</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hu</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Expression of FOXP1 in epithelial ovarian cancer (EOC) and its correlation with chemotherapy resistance and prognosis</article-title>
        <source>Tumour Biol.</source>
        <year>2015</year>
        <volume>36</volume>
        <fpage>7269</fpage>
        <lpage>7275</lpage>
        <pub-id pub-id-type="doi">10.1007/s13277-015-3383-5</pub-id>
        <pub-id pub-id-type="pmid">25895457</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Choi</surname>
            <given-names>EJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>FOXP1 functions as an oncogene in promoting cancer stem cell-like characteristics in ovarian cancer cells</article-title>
        <source>Oncotarget</source>
        <year>2016</year>
        <volume>7</volume>
        <fpage>3506</fpage>
        <lpage>3519</lpage>
        <pub-id pub-id-type="doi">10.18632/oncotarget.6510</pub-id>
        <pub-id pub-id-type="pmid">26654944</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhu</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Hu</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Gao</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Lin</surname>
            <given-names>B</given-names>
          </name>
        </person-group>
        <article-title>Gene expression profile analysis identifies metastasis and chemoresistance-associated genes in epithelial ovarian carcinoma cells</article-title>
        <source>Med. Oncol.</source>
        <year>2015</year>
        <volume>32</volume>
        <fpage>426</fpage>
        <pub-id pub-id-type="doi">10.1007/s12032-014-0426-5</pub-id>
        <pub-id pub-id-type="pmid">25502083</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Imrich</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hachmeister</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Gires</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>EpCAM and its potential role in tumor-initiating cells</article-title>
        <source>Cell Adh. Migr.</source>
        <year>2012</year>
        <volume>6</volume>
        <fpage>30</fpage>
        <lpage>38</lpage>
        <pub-id pub-id-type="doi">10.4161/cam.18953</pub-id>
        <pub-id pub-id-type="pmid">22647938</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tayama</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The impact of EpCAM expression on response to chemotherapy and clinical outcomes in patients with epithelial ovarian cancer</article-title>
        <source>Oncotarget</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>44312</fpage>
        <lpage>44325</lpage>
        <pub-id pub-id-type="doi">10.18632/oncotarget.17871</pub-id>
        <pub-id pub-id-type="pmid">28574829</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Latifi</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cisplatin treatment of primary and metastatic epithelial ovarian carcinomas generates residual cells with mesenchymal stem cell-like profile</article-title>
        <source>J. Cell. Biochem.</source>
        <year>2011</year>
        <volume>112</volume>
        <fpage>2850</fpage>
        <lpage>2864</lpage>
        <pub-id pub-id-type="doi">10.1002/jcb.23199</pub-id>
        <pub-id pub-id-type="pmid">21618587</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhang</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TGF-β Signaling and Resistance to Cancer Therapy</article-title>
        <source>Front Cell Dev Biol</source>
        <year>2021</year>
        <volume>9</volume>
        <fpage>786728</fpage>
        <pub-id pub-id-type="doi">10.3389/fcell.2021.786728</pub-id>
        <pub-id pub-id-type="pmid">34917620</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Tran</surname>
            <given-names>HTN</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A benchmark of batch-effect correction methods for single-cell RNA sequencing data</article-title>
        <source>Genome Biol.</source>
        <year>2020</year>
        <volume>21</volume>
        <fpage>12</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-019-1850-9</pub-id>
        <?supplied-pmid 31948481?>
        <pub-id pub-id-type="pmid">31948481</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Luecken</surname>
            <given-names>MD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Benchmarking atlas-level data integration in single-cell genomics</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>19</volume>
        <fpage>41</fpage>
        <lpage>50</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01336-8</pub-id>
        <pub-id pub-id-type="pmid">34949812</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Xu</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell RNA sequencing reveals the tissue architecture in human high-grade serous ovarian cancer</article-title>
        <source>Clin. Cancer Res.</source>
        <year>2022</year>
        <volume>28</volume>
        <fpage>3590</fpage>
        <lpage>3602</lpage>
        <pub-id pub-id-type="doi">10.1158/1078-0432.CCR-22-0296</pub-id>
        <pub-id pub-id-type="pmid">35675036</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lachmann</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Giorgi</surname>
            <given-names>FM</given-names>
          </name>
          <name>
            <surname>Lopez</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Califano</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>ARACNe-AP: gene network reverse engineering through adaptive partitioning inference of mutual information</article-title>
        <source>Bioinformatics</source>
        <year>2016</year>
        <volume>32</volume>
        <fpage>2233</fpage>
        <lpage>2235</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btw216</pub-id>
        <pub-id pub-id-type="pmid">27153652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Duchi</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hazan</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Singer</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Adaptive subgradient methods for online learning and stochastic optimization</article-title>
        <source>J. Mach. Learn. Res</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>2121</fpage>
        <lpage>2159</lpage>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <mixed-citation publication-type="other">Ceglia, N. et al. Processed files for Identification of transcriptional programs using dense vector representations defined by mutual information with GeneVector. <italic>Release Zenodo</italic>. 10.5281/zenodo.8079610 (2023).</mixed-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <mixed-citation publication-type="other">Ceglia, N. et al. nceglia/genevector: v0.0.1. Release Zenodo. 10.5281/zenodo.8079885 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
