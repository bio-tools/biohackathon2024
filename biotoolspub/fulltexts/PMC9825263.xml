<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9825263</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac825</article-id>
    <article-id pub-id-type="publisher-id">btac825</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Paper</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>EnDecon: cell type deconvolution of spatially resolved transcriptomics data via ensemble learning</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Tu</surname>
          <given-names>Jia-Juan</given-names>
        </name>
        <aff><institution>Centre for Intelligent Multidimensional Data Analysis, Hong Kong Science Park</institution>, Hong Kong 999077, <country country="CN">China</country></aff>
        <xref rid="btac825-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Hui-Sheng</given-names>
        </name>
        <aff><institution>Centre for Intelligent Multidimensional Data Analysis, Hong Kong Science Park</institution>, Hong Kong 999077, <country country="CN">China</country></aff>
        <aff><institution>Department of Statistics, School of Mathematics and Statistics &amp; Hubei Key Laboratory of Mathematical Sciences, Central China Normal University</institution>, Wuhan 430079, <country country="CN">China</country></aff>
        <xref rid="btac825-FM1" ref-type="author-notes"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Yan</surname>
          <given-names>Hong</given-names>
        </name>
        <aff><institution>Centre for Intelligent Multidimensional Data Analysis, Hong Kong Science Park</institution>, Hong Kong 999077, <country country="CN">China</country></aff>
        <aff><institution>Department of Electrical Engineering, City University of Hong Kong</institution>, Hong Kong 999077, <country country="CN">China</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-5052-9725</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Xiao-Fei</given-names>
        </name>
        <aff><institution>Department of Statistics, School of Mathematics and Statistics &amp; Hubei Key Laboratory of Mathematical Sciences, Central China Normal University</institution>, Wuhan 430079, <country country="CN">China</country></aff>
        <xref rid="btac825-cor1" ref-type="corresp"/>
        <!--zhangxf@ccnu.edu.cn-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Boeva</surname>
          <given-names>Valentina</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <fn id="btac825-FM1">
        <p>The authors wish it to be known that, in their opinion, Jia-Juan Tu and Hui-Sheng Li authors should be regarded as Joint First Authors.</p>
      </fn>
      <corresp id="btac825-cor1">To whom correspondence should be addressed. <email>zhangxf@ccnu.edu.cn</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-12-22">
      <day>22</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>22</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <volume>39</volume>
    <issue>1</issue>
    <elocation-id>btac825</elocation-id>
    <history>
      <date date-type="received">
        <day>23</day>
        <month>8</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>08</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>20</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>21</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>04</day>
        <month>1</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac825.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Spatially resolved gene expression profiles are the key to exploring the cell type spatial distributions and understanding the architecture of tissues. Many spatially resolved transcriptomics (SRT) techniques do not provide single-cell resolutions, but they measure gene expression profiles on captured locations (spots) instead, which are mixtures of potentially heterogeneous cell types. Currently, several cell-type deconvolution methods have been proposed to deconvolute SRT data. Due to the different model strategies of these methods, their deconvolution results also vary.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>Leveraging the strengths of multiple deconvolution methods, we introduce a new weighted ensemble learning deconvolution method, EnDecon, to predict cell-type compositions on SRT data in this work. EnDecon integrates multiple base deconvolution results using a weighted optimization model to generate a more accurate result. Simulation studies demonstrate that EnDecon outperforms the competing methods and the learned weights assigned to base deconvolution methods have high positive correlations with the performances of these base methods. Applied to real datasets from different spatial techniques, EnDecon identifies multiple cell types on spots, localizes these cell types to specific spatial regions and distinguishes distinct spatial colocalization and enrichment patterns, providing valuable insights into spatial heterogeneity and regionalization of tissues.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p> The source code is available at <ext-link xlink:href="https://github.com/Zhangxf-ccnu/EnDecon" ext-link-type="uri">https://github.com/Zhangxf-ccnu/EnDecon</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Natural Science Foundation of China</institution>
            <institution-id institution-id-type="DOI">10.13039/501100001809</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>11871026</award-id>
        <award-id>12271198</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Hong Kong Research Grants Council</institution>
          </institution-wrap>
        </funding-source>
        <award-id>11204821</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>Hong Kong Innovation and Technology Commission</institution>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>City University of Hong Kong</institution>
            <institution-id institution-id-type="DOI">10.13039/100007567</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>9610034</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="9"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Spatially resolved transcriptomics (SRT) technologies perform gene expression profiling on capture tissue locations (spots) while maintaining spatial localization information of spots (<xref rid="btac825-B4" ref-type="bibr">Asp <italic toggle="yes">et al.</italic>, 2020</xref>; <xref rid="btac825-B7" ref-type="bibr">Burgess, 2019</xref>; <xref rid="btac825-B26" ref-type="bibr">Marx, 2021</xref>). Spatially resolved gene expression profiles provide an opportunity to characterize cellular heterogeneity in the spatial context and investigate the architectures of the tissues (<xref rid="btac825-B3" ref-type="bibr">Andersson <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="btac825-B7" ref-type="bibr">Burgess, 2019</xref>; <xref rid="btac825-B16" ref-type="bibr">Dries <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="btac825-B18" ref-type="bibr">Eng <italic toggle="yes">et al.</italic>, 2019</xref>; <xref rid="btac825-B30" ref-type="bibr">Moses <italic toggle="yes">et al.</italic>, 2022</xref>; <xref rid="btac825-B33" ref-type="bibr">Pham <italic toggle="yes">et al.</italic>, 2020</xref>; <xref rid="btac825-B47" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic>, 2021</xref>). However, despite the rapid development of SRT, many SRT technologies lack single-cell resolutions, such as the spatial transcriptomics (ST) technique (<xref rid="btac825-B38" ref-type="bibr">Ståhl <italic toggle="yes">et al.</italic>, 2016</xref>) and the commercialized 10× Genomics Visium system. Each detected spot is generally a mixture of multiple homos or heterogeneous cell types, which may make it difficult to explore the spatial distribution of cell types in complex tissues. Compared with the SRT technologies, single-cell RNA-sequencing (scRNA-seq) technologies enable quantifying transcriptome profiling at the single-cell level, while cells’ spatial localization information is lost during the process of cell isolation (<xref rid="btac825-B1" ref-type="bibr">Abdelaal <italic toggle="yes">et al.</italic>, 2020</xref>). To explore the spatial cellular heterogeneity, it is reasonable to leverage cell type profiles learned from scRAN-seq data to decompose mixture cells within each spot of SRT data.</p>
    <p>In the context of bulk RNA-seq data, which measures the average gene expression level of thousands of cells within a sample, several deconvolution methods have been proposed to infer cell type abundances for each sample, such as DeconRNASeq (<xref rid="btac825-B20" ref-type="bibr">Gong <italic toggle="yes">et al.</italic>, 2013</xref>), DWLS (<xref rid="btac825-B43" ref-type="bibr">Tsoucas <italic toggle="yes">et al.</italic>, 2019</xref>), MuSiC (<xref rid="btac825-B45" ref-type="bibr">Wang <italic toggle="yes">et al.</italic>, 2019</xref>) and SCDC (<xref rid="btac825-B14" ref-type="bibr">Dong <italic toggle="yes">et al.</italic>, 2021a</xref>). By treating one spot as a bulk sample, the deconvolution methods designed for bulk RNA-seq data could be applied directly to SRT data (<xref rid="btac825-B5" ref-type="bibr">Avila Cobos <italic toggle="yes">et al.</italic>, 2020</xref>; <xref rid="btac825-B39" ref-type="bibr">Sturm <italic toggle="yes">et al.</italic>, 2019</xref>). However, compared with bulk RNA-seq data, SRT data contain a lower quantity of cells within each capture spot. For example, the 10× Genomics Visium platform treats an area of 55 μm as a spot, which contains around 5–10 cells. As limited cells are contained on each spot, spatially resolved gene expression profiles are sparser and have lower signals than bulk gene expression profiles (<xref rid="btac825-B12" ref-type="bibr">Danaher <italic toggle="yes">et al.</italic>, 2022</xref>). On the other hand, SRT data could obtain the spatial localization information of captured spots, providing the opportunity to explore the cell-type spatial distributions in a spatial context. Hence, existing methods developed for deconvoluting bulk RNA-seq data may produce misleading results if one applies them directly to SRT data (<xref rid="btac825-B15" ref-type="bibr">Dong <italic toggle="yes">et al.</italic>, 2021b</xref>). To accommodate the special characteristics of SRT data, several cell-type deconvolution methods have been developed, such as CARD (<xref rid="btac825-B25" ref-type="bibr">Ma <italic toggle="yes">et al.</italic>, 2022</xref>), Cell2location (<xref rid="btac825-B21" ref-type="bibr">Kleshchevnikov <italic toggle="yes">et al.</italic>, 2022</xref>), DestVI (<xref rid="btac825-B24" ref-type="bibr">Lopez <italic toggle="yes">et al.</italic>, 2022</xref>), RCTD (<xref rid="btac825-B8" ref-type="bibr">Cable <italic toggle="yes">et al.</italic>, 2021</xref>), STdeconvolve (<xref rid="btac825-B28" ref-type="bibr">Miller <italic toggle="yes">et al.</italic>, 2022</xref>), Stereoscope (<xref rid="btac825-B2" ref-type="bibr">Andersson <italic toggle="yes">et al.</italic>, 2020</xref>), SpatialDWLS (<xref rid="btac825-B15" ref-type="bibr">Dong <italic toggle="yes">et al.</italic>, 2021b</xref>) and SPOTlight (<xref rid="btac825-B17" ref-type="bibr">Elosua Bayes <italic toggle="yes">et al.</italic>, 2021</xref>).</p>
    <p>The deconvolution methods designed for bulk RNA-seq data and SRT data are often based on different model assumptions and strategies (<xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>). Each deconvolution method has its own strengths and limitations (<xref rid="btac825-B5" ref-type="bibr">Avila Cobos <italic toggle="yes">et al.</italic>, 2020</xref>; <xref rid="btac825-B9" ref-type="bibr">Chen <italic toggle="yes">et al.</italic>, 2022</xref>; <xref rid="btac825-B22" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2022a</xref>). Besides, the deconvolution methods highly depend on the reference scRNA-seq data (<xref rid="btac825-B40" ref-type="bibr">Sun <italic toggle="yes">et al.</italic>, 2022</xref>) and the complexity of the underlying tissue (<xref rid="btac825-B21" ref-type="bibr">Kleshchevnikov <italic toggle="yes">et al.</italic>, 2022</xref>). The deconvolution results produced by different methods may be quite different from each other. Thus, it is difficult to choose the best deconvolution method for new SRT data in reality. In machine learning, the weighted average ensemble method is widely used to obtain better performance by weighted averaging of the results from multiple base methods (<xref rid="btac825-B14" ref-type="bibr">Dong <italic toggle="yes">et al.</italic>, 2021a</xref>; <xref rid="btac825-B23" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2022b</xref>; <xref rid="btac825-B48" ref-type="bibr">Zhang <italic toggle="yes">et al.</italic>, 2019</xref>). Therefore, a weighted average ensemble method can also be developed to deconvolute the SRT data. However, how to determine the weights assigned to the base deconvolution methods is a key issue. If each method is assigned the same weight, it is possible to produce a poor ensemble result due to the influence of the poorly performing methods.</p>
    <p>In this study, we propose an ensemble learning-based cell-type deconvolution method (<xref rid="btac825-F1" ref-type="fig">Fig. 1</xref>), called EnDecon, to estimate cell-type abundances within spots by borrowing strengths from existing cell-type deconvolution methods. EnDecon utilizes an optimization strategy for the combination of the base deconvolution results from 14 individual methods to produce a consistent and accurate deconvolution result. It achieves the optimal solution by alternatively updating the ensemble result, which is produced based on a weighted median of the base deconvolution results, and the weights of base results, which are evaluated based on their Manhattan distances to the corresponding ensemble results. Simulation results show the advantages of EnDecon over base deconvolution methods and a baseline ensemble learning method in terms of inferred cell type proportions on spots. Furthermore, strong positive correlations are observed between the weights learned by EnDecon and the performance of base deconvolution methods. Comprehensive experiments on four real SRT data show that EnDecon has advantages in predicting the cell type proportions on spots in terms of tissue region segmentation, concordance analysis of the spatial distribution of cell types and their marker genes, region-based cell type enrichment analysis and cell type colocalization analysis.</p>
    <fig position="float" id="btac825-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Overview of EnDecon. (<bold>a</bold>) EnDecon takes spatially resolved transcriptomics data with spot localizations and annotated reference scRNA-seq dataset as input. Spatially resolved gene expression data is performed for deconvolution to obtain cell type compositions on each capture spot. The scRNA-seq dataset consisting of a gene expression matrix and corresponding cell label information serves as reference cell type-specific gene expression data. (<bold>b</bold>) Multiple deconvolution methods are run individually to obtain multiple base deconvolution results on the SRT data. (<bold>c</bold>) EnDecon uses a new optimization model to integrate these base results. The optimal ensemble result is obtained by alternatively updating the ensemble result and the weights of base results. (<bold>d</bold>) EnDecon predicts an ensemble deconvolution result based on multiple based deconvolution results from the SRT data. Each spot is composed of varying cell types with different proportions</p>
      </caption>
      <graphic xlink:href="btac825f1" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <sec>
      <title>2.1 Overview of EnDecon</title>
      <p>Given observed SRT data and a coupled reference scRNA-seq gene expression dataset with pre-defined cell type information, EnDecon leverages the ensemble learning approach to integrate the results from multiple base deconvolution methods. The overview of EnDecon is presented in <xref rid="btac825-F1" ref-type="fig">Figure 1</xref>. EnDecon includes two main steps (i) running each base deconvolution method individually to obtain the base cell type deconvolution results and (ii) integrating these base deconvolution results into a better deconvolution result using a new proposed ensemble strategy. EnDecon obtains the ensemble result by alternatively updating the ensemble result as a weighted median of the base results, and the weights of base results based on their distances to their corresponding ensemble results.</p>
    </sec>
    <sec>
      <title>2.2 Implementation of the individual deconvolution methods</title>
      <p>The current implementation of EnDecon combines 14 state-of-the-art cell-type deconvolution methods (consisting of methods designed for both bulk RNA-seq and scRNA-seq datasets): Conditional Auto Regressive-based Deconvolution (CARD) (<xref rid="btac825-B25" ref-type="bibr">Ma <italic toggle="yes">et al.</italic>, 2022</xref>), Cell2location (<xref rid="btac825-B21" ref-type="bibr">Kleshchevnikov <italic toggle="yes">et al.</italic>, 2022</xref>), DeconRNASeq (<xref rid="btac825-B20" ref-type="bibr">Gong <italic toggle="yes">et al.</italic>, 2013</xref>), DestVI (<xref rid="btac825-B24" ref-type="bibr">Lopez <italic toggle="yes">et al.</italic>, 2022</xref>), Dampened Weighted Least Squares (DWLS) (<xref rid="btac825-B43" ref-type="bibr">Tsoucas <italic toggle="yes">et al.</italic>, 2019</xref>), v-support vector regression (SVR) (<xref rid="btac825-B43" ref-type="bibr">Tsoucas <italic toggle="yes">et al.</italic>, 2019</xref>), MUlti-Subject SIngle Cell deconvolution (MuSiC) (<xref rid="btac825-B45" ref-type="bibr">Wang <italic toggle="yes">et al.</italic>, 2019</xref>), Robust Cell Type Decomposition (RCTD) (<xref rid="btac825-B8" ref-type="bibr">Cable <italic toggle="yes">et al.</italic>, 2021</xref>), SCDC (<xref rid="btac825-B14" ref-type="bibr">Dong <italic toggle="yes">et al.</italic>, 2021a</xref>), SpatialDWLS (<xref rid="btac825-B15" ref-type="bibr">Dong <italic toggle="yes">et al.</italic>, 2021b</xref>), SPOTlight (<xref rid="btac825-B17" ref-type="bibr">Elosua Bayes <italic toggle="yes">et al.</italic>, 2021</xref>), STdeconvolve (<xref rid="btac825-B28" ref-type="bibr">Miller <italic toggle="yes">et al.</italic>, 2022</xref>) and Stereoscope (<xref rid="btac825-B2" ref-type="bibr">Andersson <italic toggle="yes">et al.</italic>, 2020</xref>). The main features of these base deconvolution methods are summarized in <xref rid="sup1" ref-type="supplementary-material">Supplementary Table S1</xref>. We run these base deconvolution methods using the packages provided by the authors and following the corresponding guidelines. For details, please refer to <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.1</xref>.</p>
    </sec>
    <sec>
      <title>2.3 Integrating deconvolution results generated by individual deconvolution methods</title>
      <p>After applying the 14 base deconvolution methods mentioned above, we can obtain 14 base deconvolution results <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, where <italic toggle="yes">N</italic> represents the number of spots, <italic toggle="yes">K</italic> represents the number of cell types, and <italic toggle="yes">m</italic> represents the <italic toggle="yes">m</italic>th base deconvolution method for <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:math></inline-formula> (<italic toggle="yes">M </italic>=<italic toggle="yes"> </italic>14 by default). The goal of this study is to learn an ensemble cell type deconvolution result <italic toggle="yes">H</italic> by integrating the results generated by the 14 base deconvolution methods.</p>
      <p>Due to the variation of base deconvolution results, integrating multiple base deconvolution results may help to learn a better ensemble deconvolution result. A widely used ensemble learning strategy is to treat each base deconvolution result equally and use their average as the ensemble result, which we refer to as EnDecon_mean in this article. However, the accuracy of different deconvolution results may be different. If we treat these base deconvolution results equally, the poor performance results may lead to biased deconvolution results. Instead of using an average ensemble strategy, we propose the following optimization model to integrate these base results (called as EnDecon),
<disp-formula id="E1"><label>(1)</label><mml:math id="M1" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:mi>H</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo> </mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mo>λ</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mtext>subject</mml:mtext><mml:mo> </mml:mo><mml:mtext>to</mml:mtext><mml:mo> </mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>≥</mml:mo><mml:mn>0.</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>where the first term measures the total weighted Manhattan distance between the ensemble deconvolution result <italic toggle="yes">H</italic> and base deconvolution results <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mo>.</mml:mo><mml:mo>‖</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> represents the <italic toggle="yes">L</italic><sub>1</sub> norm of a matrix, and <italic toggle="yes">ω<sub>m</sub></italic> represents the weight assigned to the <italic toggle="yes">m</italic>th base deconvolution result. By minimizing this term with respect to <italic toggle="yes">H</italic>, we can learn a consensus cell-type abundance matrix. The second term is a negative entropy regularization of weights, which is used to prevent the ensemble deconvolution result from overfitting to a certain base deconvolution result. By minimizing the first term and the regularization term with respect to <italic toggle="yes">ω</italic>, we can learn weights assigned to the base deconvolution results. If the value of weight <italic toggle="yes">ω<sub>m</sub></italic> is large, the ensemble result is encouraged to be close to the corresponding base deconvolution result <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. Otherwise, the ensemble result may be apart from this deconvolution result. The parameter <italic toggle="yes">λ</italic> is a tuning parameter to control the strength of regularization. After obtaining the estimates of model parameters, EnDecon can obtain an ensemble deconvolution result <italic toggle="yes">H</italic> by assigning appropriate weights <italic toggle="yes">ω<sub>m</sub></italic> to different base deconvolution results <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec>
      <title>2.4 Optimization algorithm</title>
      <p>There are two sets of model parameters, <italic toggle="yes">H</italic> and <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, to estimate in <xref rid="E1" ref-type="disp-formula">Equation (1)</xref>. We develop a coordinate descent algorithm to solve the optimization problem, in which we iteratively update one parameter while keeping the other constant.</p>
      <p>We first estimate <italic toggle="yes">H</italic> while holding <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> fixed. When we calculate <italic toggle="yes">H</italic>, the optimization problem can be rewritten as follows:
<disp-formula id="E2"><label>(2)</label><mml:math id="M2" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mi>H</mml:mi></mml:munder><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
      <p>The above optimization problem is a classic post office location problem, for which the weighted median would be the solution (<xref rid="btac825-B11" ref-type="bibr">Clarkson, 1985</xref>; <xref rid="btac825-B19" ref-type="bibr">Fletcher <italic toggle="yes">et al.</italic>, 2009</xref>). The function <italic toggle="yes">weighted.median</italic> in R package <italic toggle="yes">spatstat.geom</italic> is used to solve <xref rid="E2" ref-type="disp-formula">Equation (2)</xref>.</p>
      <p>We then compute <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> while keeping model parameter <italic toggle="yes">H</italic> fixed and rewrite the optimization problem in <xref rid="E1" ref-type="disp-formula">Equation (1)</xref> as follows:
<disp-formula id="E3"><label>(3)</label><mml:math id="M3" display="block" overflow="scroll"><mml:mrow><mml:mtable><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo> </mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mo>λ</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo> </mml:mo><mml:mtext>log</mml:mtext><mml:mo> </mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mtext>subject</mml:mtext><mml:mo> </mml:mo><mml:mtext>to</mml:mtext><mml:mo> </mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>≥</mml:mo><mml:mn>0.</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p>
      <p>According to the method of Lagrange multipliers, the above optimization problem has a closed-form solution for each <italic toggle="yes">ω<sub>m</sub></italic>:
<disp-formula id="E4"><label>(4)</label><mml:math id="M4" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mo>λ</mml:mo></mml:mfrac><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mo>λ</mml:mo></mml:mfrac><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>H</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
      <p>For the coordinate descent algorithm, the iteration process is conducted until the relative change of the objective function in <xref rid="E1" ref-type="disp-formula">Equation (1)</xref> is less than <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. As can be seen from <xref rid="E2" ref-type="disp-formula">Equation (2)</xref>, the ensemble result will be a weighted median of base deconvolution results. From <xref rid="E4" ref-type="disp-formula">Equation (4)</xref>, the weights assigned to base deconvolution results are associated with their distances from the ensemble result. We will assess the accuracy of the ensemble result and the rationality of the weights learned by EnDecon in the following experiments. The complete procedure of EnDecon is summarized in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.2</xref>.</p>
      <p>In <xref rid="E1" ref-type="disp-formula">Equation (1)</xref>, the tuning parameter <italic toggle="yes">λ</italic> is used to control the strength of entropy regularization and needs to be predetermined before estimating <italic toggle="yes">H</italic> and <inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>ω</mml:mo></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. In this work, we set its value empirically to the median of <italic toggle="yes">L</italic><sub>1</sub> norm distances between the EnDecon_mean result <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> and these base deconvolution results <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>:
<disp-formula id="E5"><label>(5)</label><mml:math id="M5" display="block" overflow="scroll"><mml:mrow><mml:mo>λ</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="italic">median</mml:mi><mml:msubsup><mml:mrow><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="true">‖</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
    </sec>
  </sec>
  <sec>
    <title>3 Simulation study</title>
    <sec>
      <title>3.1 Data generation</title>
      <p>To test the performance of different methods, we use single-cell resolution gene expression data to construct spot-based gene expression data and generate corresponding cell type components within spots. Here, we generate simulation data in three different scenarios based on different settings. Specifically, the SRT and scRNA-seq datasets are generated from the same technology in Scenario 1. We conduct two experiments based on data from two different tissues respectively: pancreas [Baron: scRNA-seq data from inDrop (<xref rid="btac825-B6" ref-type="bibr">Baron <italic toggle="yes">et al.</italic>, 2016</xref>) and ovarian cancer (Ovarian cancer: scRNA-seq data from 10× Genomic]. In Scenario 2, in order to show how batch effects between different techniques affect the deconvolution results, we use the Baron dataset used in Scenario 1 to generate SRT dataset and datasets from other three techniques [e.g. Muraro: CEL-Seq2 (<xref rid="btac825-B31" ref-type="bibr">Muraro <italic toggle="yes">et al.</italic>, 2016</xref>), Segerstolpe: SMART-Seq2 (<xref rid="btac825-B37" ref-type="bibr">Segerstolpe <italic toggle="yes">et al.</italic>, 2016</xref>) and Wang: SMARTer (<xref rid="btac825-B46" ref-type="bibr">Wang <italic toggle="yes">et al.</italic>, 2016</xref>)] as references. In Scenario 3, a real single-cell resolution SRT data from the mouse visual cortex generated by STARmap (<xref rid="btac825-B44" ref-type="bibr">Wang <italic toggle="yes">et al.</italic>, 2018</xref>) is used to mimic the SRT data, and a scRNA-seq dataset from Smart-seq (<xref rid="btac825-B42" ref-type="bibr">Tasic <italic toggle="yes">et al.</italic>, 2018</xref>) is used as a reference. Details are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.3.1</xref>.</p>
    </sec>
    <sec>
      <title>3.2 Benchmarking different deconvolution methods</title>
      <p>We compare the performance of our EnDecon with each base deconvolution method on different simulated SRT data. All base deconvolution methods are run with the recommended default parameters. To demonstrate the advantages of the new ensemble strategy used in EnDecon, we also compare EnDecon with a baseline ensemble method (EnDecon_mean), taking the mean of different base deconvolution results as the ensemble result. Following previous studies (<xref rid="btac825-B17" ref-type="bibr">Elosua Bayes <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="btac825-B45" ref-type="bibr">Wang <italic toggle="yes">et al.</italic>, 2019</xref>), we quantify the deconvolution performance by computing the Pearson correlation coefficient (PCC), root means square error (RMSE) and <italic toggle="yes">Jensen—Shannon</italic> Divergence distance (JSD) between the predicted and the ground truth cell type compositions within each spot. We measure the rationality of the weights learned by EnDecon by calculating Pearson correlation coefficient (<italic toggle="yes">τ</italic>) and Spearman correlation coefficient (<italic toggle="yes">ρ</italic>) between the learned weights and PCC scores of base methods. Multiple simulation replicates are performed in Scenarios 1 and 2, with a default of 10 times, to capture data variation and assess the robustness of each method. In Scenario 3, we do one replicate as in the previous studies (<xref rid="btac825-B8" ref-type="bibr">Cable <italic toggle="yes">et al.</italic>, 2021</xref>; <xref rid="btac825-B17" ref-type="bibr">Elosua Bayes <italic toggle="yes">et al.</italic>, 2021</xref>).</p>
      <p>On the pancreas dataset in Scenario 1, EnDecon outperforms all base deconvolution methods (median PCC 0.923), with 1.954%, 2.055% and 2.538% improvements in terms of PCC compared with those of the top three base deconvolution methods, such as RCTD (median 0.905), DWLS (median 0.904) and Cell2location (median 0.900) (<xref rid="btac825-F2" ref-type="fig">Fig. 2a</xref>). The statistical differences between the pairwise base deconvolution results and the result of EnDecon are significant. By computing the RMSE between the predicted cell type proportions and the ground truth, EnDecon induces the smallest error (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1a</xref>). The calculated JSD indicates that the value of EnDecon (median 0.031) is closer to 0, signifying a higher similarity between the inferred cell type proportions and the ground truth (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S1b</xref>). In terms of JSD, EnDecon outperforms all base deconvolution methods with 22.153% improvement compared with the top one base method DWLS (median 0.040). Compared with the baseline ensemble method, EnDecon_mean, the performance of EnDecon significantly improves by 1.613%, 5.973% and 111.503% in terms of these three metrics (<italic toggle="yes">t</italic>-test: <italic toggle="yes">P-</italic>value &lt; 0.05 for PCC scores; Diebold–Mariano test: <italic toggle="yes">P-</italic>value &lt;2.2e−16 for RMSE scores; Kolmogorov–Smirnov test: <italic toggle="yes">P-</italic>value &lt;2.2e−16 for JSD scores), respectively. In addition, the weights assigned to base deconvolution methods by EnDecon show a strong and significant positive correlation with the corresponding PCC (median value of each method) (<xref rid="btac825-F2" ref-type="fig">Fig. 2b</xref>). EnDecon assigns larger weights to the base deconvolution methods that have higher accuracies and assigns smaller weights to the ones that have poor performance. In line with performance on pancreas data, EnDecon shows the best performance and the learned weights by EnDecon appear positive correlation with PCC scores of the base deconvolution method on ovarian cancer data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S2 and S3</xref>). These results demonstrate that EnDecon can effectively combine the base methods by automatically assigning larger weights to methods with higher performance.</p>
      <fig position="float" id="btac825-F2">
        <label>Fig. 2.</label>
        <caption>
          <p>Analysis of the simulation SRT data. (<bold>a</bold>) The performance of the deconvolution methods on simulated pancreas data in Scenario 1. A two-sided <italic toggle="yes">t</italic>-test is performed to assess statistical differences between the results of compared methods and EnDecon. (<bold>b</bold>) The dotplot shows the correlation between the weights inferred by EnDecon and the PCC scores of corresponding base deconvolution methods on simulation data in pancreas data. The Pearson correlation coefficient (<italic toggle="yes">τ</italic>) and Spearman correlation coefficient (<italic toggle="yes">ρ</italic>) between the learned weights and PCC scores of base methods, and the corresponding <italic toggle="yes">P</italic>-values (from a one-sided <italic toggle="yes">t</italic>-test) are provided. (<bold>c</bold>) The performance of the deconvolution methods with reference data from different techniques in Scenario 2</p>
        </caption>
        <graphic xlink:href="btac825f2" position="float"/>
      </fig>
      <p>Then, we use data generated from different platforms in Scenario 2 to check the robustness of EnDecon. We find that the performance of different methods may vary slightly depending on the reference datasets (<xref rid="btac825-F2" ref-type="fig">Fig. 2c</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S4</xref>). EnDecon provides stable and accurate, either the best or close to the best, results in terms of all three evaluation metrics in most cases (<xref rid="btac825-F2" ref-type="fig">Fig. 2c</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S4</xref>). With existing batch effects between SRT and reference data, the cell type deconvolution results inferred by some base deconvolution methods such as DestVI and STdeconvolve may depart away from the ground truth. The corresponding weights estimated by EnDecon for these methods are also relatively small (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S5</xref>). Overall, EnDecon provides comparable and stable results compared to all compared deconvolution methods.</p>
      <p>In Scenario 3, we evaluate the performance of EnDecon on more realistic simulated data generated from single-cell resolution SRT data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S6</xref>). In terms of PCC, RMSE and JSD, EnDecon is still the top-performing method regards predicting the cell type proportions and shows positive correlation between learned weights and the performance of base deconvolution methods (<xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S7 and S8</xref>). By visualizing predicted cell type proportions, we find EnDecon accurately localizes L4 excitatory neurons to the specific layer of L4 (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S9</xref>). In contrast, CARD and ‘MuSiC all gene’ do not capture the expected spatial localization. When integrating all base deconvolution results, EnDecon assigns the smaller weights to them (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S8</xref>). The excellent performance of EnDecon demonstrates the advantage of our weighted ensemble learning strategy.</p>
      <p>Since the sample size obtained may vary for different cell types, we examine the effect of the sample size of the reference scRNA-seq data on the performance of our method (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.3.2</xref>). The simulation results also show that our method works better than other compared methods. The comparison of running time between different methods on the simulated data is presented in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.3.3</xref>.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Evaluating performance using real SRT data</title>
    <p>We apply EnDecon to two mouse brain SRT data from 10× Visium protocol and two cancer SRT data [pancreatic ductal adenocarcinoma (PDAC) and breast cancers] from ST protocol to chart spatial cellular heterogeneity (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.4.1</xref>). First, an adult mouse brain SRT dataset, for which the matched immunofluorescence (IF) staining images for cell-type marker proteins are available, is used to quantitatively evaluate the performance of different deconvolution methods. We then present four applications of EnDecon on the other three datasets: (i) visualization analysis of cell type spatial distribution; (ii) concordance analysis of the spatial distribution of cell types and their corresponding marker genes; (iii) cell type colocalization analysis (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.4.2</xref>); and (iv) cell type regional enrichment analysis (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.4.2</xref>). The results on an adult mouse brain and two cancer SRT data are presented as follows and the results on another mouse cortex SRT data are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3.4.3</xref> due to limited space here.</p>
    <sec>
      <title>4.1 Evaluation of the performance on an adult mouse brain SRT dataset</title>
      <p>The lack of ground truth for the cell type composition of spots in ST or 10× Visium experiments makes evaluation using real data challenging (<xref rid="btac825-B9" ref-type="bibr">Chen <italic toggle="yes">et al.</italic>, 2022</xref>; <xref rid="btac825-B24" ref-type="bibr">Lopez <italic toggle="yes">et al.</italic>, 2022</xref>; <xref rid="btac825-B49" ref-type="bibr">Zubair <italic toggle="yes">et al.</italic>, 2022</xref>). To compare the performance of EnDecon with other methods, we conduct an experiment following (<xref rid="btac825-B49" ref-type="bibr">Zubair <italic toggle="yes">et al.</italic>, 2022</xref>). We use a dataset that measures gene expression in an adult mouse brain using the 10× Genomics Visium platform and performs immunofluorescent (IF) staining on the reverse side of tissue sections for two proteins (GFAP and RBFOX3), which are protein markers specific to glial and neurons cells, respectively (<xref rid="btac825-F3" ref-type="fig">Fig. 3a</xref>). In a similar way to <xref rid="btac825-B49" ref-type="bibr">Zubair <italic toggle="yes">et al.</italic> (2022)</xref>, we use the estimated spot-level intensity of two marker proteins as ground truth for each matched spot (<xref rid="btac825-F3" ref-type="fig">Fig. 3a</xref>). For details, please refer to <xref rid="sup1" ref-type="supplementary-material">Supplementary Section 3.4.1</xref>.</p>
      <fig position="float" id="btac825-F3">
        <label>Fig. 3.</label>
        <caption>
          <p>Analysis of the adult mouse brain SRT data (coronal section 2). (<bold>a</bold>) Top, the raw immunofluorescence (IF) images of the adult mouse brain tissue section show the glial (marker protein: GFAP) and neuronal (marker protein: RBFOX3) cells intensity information. Bottom, the spatial distribution of the rescaled intensity values for glial and neuronal cells are matched to each corresponding spot’s spatial location for SRT data. (<bold>b</bold>) Visualization of deconvolution results of EnDecon and EnDecon_mean. Each scatter represents a spot in SRT data. Arrows highlight the strong instance information, where there is a significant difference in cell type proportions predicted by EnDecon and EnDecon_mean. Note that for the convenience of typesetting, when zooming in and visualizing glial cells, we rotate the image 90° counterclockwise. (<bold>c</bold>) Barplot represents PCC scores between the ground truth (intensity values of corresponding glial and neuronal cells) and cell type proportions inferred by different methods</p>
        </caption>
        <graphic xlink:href="btac825f3" position="float"/>
      </fig>
      <p>For each deconvolution method, we predict cell type compositions within spots by leveraging cell type information from the reference scRNA-seq dataset and compute the abundance of glial and neuron cell types for each spot. Cell type abundance inferred by EnDecon can accurately depict these two structures derived from IF image by visual inspection (<xref rid="btac825-F3" ref-type="fig">Fig. 3b</xref>), while the results of some compared methods (e.g. ‘MuSiC all gene’, SCDC and STdeconvolve) are not consistent with the expected structures (<xref rid="sup1" ref-type="supplementary-material">Supplementary Figs S10 and S11</xref>). Compared with EnDecon_mean, EnDecon can correctly capture glial cells outside mouse brain tissue (highlighted by arrows) that are incorrectly predicted as neuron cells by EnDecon_mean, and the neuron cells in the hippocampal region (highlighted arrows) that are incorrectly predicted as glial cells by EnDecon_mean (<xref rid="btac825-F3" ref-type="fig">Fig. 3b</xref>).</p>
      <p>To quantitatively compare the performance of different deconvolution methods, we calculate the PCC between cell type proportions estimated by different deconvolution methods and IF-derived intensities of corresponding marker proteins for each cell type (<xref rid="btac825-B49" ref-type="bibr">Zubair <italic toggle="yes">et al.</italic>, 2022</xref>). EnDecon obtains the largest PCC values (0.745 for glial cells and 0.764 for neuron cells) (<xref rid="btac825-F3" ref-type="fig">Fig. 3c</xref>). It achieves improvements of 2.762%, 3.223% and 3.310% compared with those of the top three methods EnDecon_mean (0.724), Cell2location (0.721) and DWLS (0.720) for glial cells, and 1.427%, 2.945% and 3.048% compared with those of the top three methods ‘MuSiC weighted’ (0.753), DeconRNASeq (0.741) and Stereoscope (0.740) for neuron cells. The weights assigned to base deconvolution methods by EnDecon are positively correlated to their performance (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S12</xref>). Overall, EnDecon is competitive with existing deconvolution methods on real SRT data, and the weights assigned to the base methods by EnDecon may provide a clue about their performance when ground truth is not available.</p>
    </sec>
    <sec>
      <title>4.2 Charting spatial heterogeneity in PDAC</title>
      <p>To validate the performance of EnDecon on real SRT data, we apply it to the human PDAC sample with the sample-matched scRNA-seq dataset (inDrop) as reference data (<xref rid="btac825-F4" ref-type="fig">Fig. 4a</xref>). Through deconvolution, EnDecon localizes various pancreatic and tumor cell types to distinct tissue regions (<xref rid="btac825-F4" ref-type="fig">Fig. 4b</xref>). We observe that the cell type compositions inferred by EnDecon clearly show overall regional segregation between cancerous and non-cancerous regions, between ductal and stromal regions and between ductal and pancreatic regions. Neoplastic cell types are mainly located in the cancer region, while the normal cell types of the pancreas are mainly located in ductal and pancreatic regions excluded from the tumor regions. In contrast, the compared methods, such as SCDC, SPOTlight and SVR, do not clearly delineate these regional segmentations (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S13</xref>). The dominant cell types inferred by EnDecon in each spot also show a clear separation between cancerous and non-cancerous regions, whereas most compared methods do not show effectiveness in distinguishing these two regions compared with EnDecon (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S14</xref>). The two ensemble methods, EnDecon and EnDecon_mean, delineate cancer and non-cancer regions. EnDecon clearly delineates the segmentation between pancreatic interstitial regions, while EnDecon_mean blends these regions together (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S14</xref>).</p>
      <fig position="float" id="btac825-F4">
        <label>Fig. 4.</label>
        <caption>
          <p>Analysis of the PDAC SRT data. (<bold>a</bold>) Annotation of PDAC tissue slice. H&amp;E staining image of the PDAC (left) displays four regions annotated by histologists from the original study (right). (<bold>b</bold>) Visualization of deconvolution result. A spatial scatter pie chart displays cell-type compositions predicted by EnDecon and each scatter represents a spot in SRT data. (<bold>c</bold>) Comparisons of cell type proportions in cancer and non-cancer regions. The boxplot represents the distribution of cell type proportions in each region. For each cell type, a two-sided Wilcoxon Rank Sum test is used to test the difference. In the diagrams, ‘ns’ represents <italic toggle="yes">P</italic>-value &gt; 0.05, * represents 0.01 &lt; <italic toggle="yes">P</italic>-value <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mo>≤</mml:mo></mml:math></inline-formula> 0.05, and **** represents <italic toggle="yes">P</italic>-value <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mo>≤</mml:mo></mml:math></inline-formula> 1e−4. (<bold>d</bold>) Top, the abundances of cell types by EnDecon are visualized on each spatial location. Bottom, the expression level of the corresponding canonical cell type marker genes is displayed</p>
        </caption>
        <graphic xlink:href="btac825f4" position="float"/>
      </fig>
      <p>To quantify the difference in the proportion of predicted cell types in cancer and non-cancer regions, we first divided the spots into two complementary subsets according to the region in which they are located (cancer and non-cancer regions) and test them using a two-sided Wilcoxon Rank Sum test Differences for each cell type. The distributions of most predicted cell type proportion in these two regions show significant differences (<xref rid="btac825-F4" ref-type="fig">Fig. 4c</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S15</xref>). The predicted cell type proportion distribution of tumor cells (e.g. cancer clone A and B cells) shows a significant difference between these two regions (<xref rid="btac825-F4" ref-type="fig">Fig. 4c</xref>). The proportion of two different macrophage subpopulations predicted by EnDecon reveals different distributions between cancer and non-cancer regions, which may be a key functional feature of cancer tissue compartmentalization (<xref rid="btac825-B25" ref-type="bibr">Ma <italic toggle="yes">et al.</italic>, 2022</xref>).</p>
      <p>Many cell types are localized to specific spatial regions by EnDecon. Examining the agreement between the spatial distribution of specific cell types and expression patterns of matched marker genes confirms the high accuracy predicted by EnDecon (<xref rid="btac825-F4" ref-type="fig">Fig. 4d</xref>). In line with the previous results (<xref rid="btac825-B29" ref-type="bibr">Moncada <italic toggle="yes">et al.</italic>, 2020</xref>), the cancer clone A and B cells are located in two subregions of the cancer region, in which the cancer clone A cells mainly distribute in an upper subregion and the cancer clone B cells mainly distribute in a bottom subregion. These results are consistent with the spatial expression patterns of the marker genes TM4SF1 and S000A4 (<xref rid="btac825-F4" ref-type="fig">Fig. 4d</xref>). The proportions of ductal centroacinar cells inferred by EnDecon mainly appear in the ductal epithelium region, consistent with the spatial expression pattern of the marker gene CRISP3 (<xref rid="btac825-B34" ref-type="bibr">Röder <italic toggle="yes">et al.</italic>, 2016</xref>). Ductal high hypoxic cells are mainly located in the surrounding cancerous part of the tissue, similar to the expression of marker gene APOL1 (<xref rid="btac825-B36" ref-type="bibr">Sedlakova <italic toggle="yes">et al.</italic>, 2014</xref>). The compositions of terminal ductal cells inferred by EnDecon mainly reside around the ductal epithelium area and pancreatic region, consistent with the expression pattern of the marker gene TFF33 (<xref rid="btac825-B35" ref-type="bibr">Rovira <italic toggle="yes">et al.</italic>, 2010</xref>).</p>
      <p>When examining cell type enrichment/depletion within annotated tissue regions, we observe different regional enrichment patterns of normal pancreatic and tumor cells (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S16</xref>). The cancer clone A and B cells are enriched in the cancerous region. As expected, all ductal cells are mainly enriched in the duct epithelium region, and only the ductal high hypoxic cells are also enriched in the cancer region (<xref rid="btac825-B29" ref-type="bibr">Moncada <italic toggle="yes">et al.</italic>, 2020</xref>). We observe that two subpopulations of myeloid dendritic cells, mDCs A and B, appear in different regions. The mDCs A cells are enriched in the pancreatic region while the mDCs B cells are enriched in all regions except for the cancer region (<xref rid="btac825-B29" ref-type="bibr">Moncada <italic toggle="yes">et al.</italic>, 2020</xref>). These quantified enrichment results are consistent with the cell type localization.</p>
      <p>We then depict cell type colocalization map to explore the potential cellular interactions. A well-preserved colocalization pattern of cancer clone A and B cells supports a role in the formation of tissue carcinogenesis (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S17</xref>). Ductal centroacinar and duct terminal cells are captured with spatial correlation as expected (<xref rid="btac825-B27" ref-type="bibr">Means <italic toggle="yes">et al.</italic>, 2001</xref>) and show anti-correlation with neoplastic cells. Ductal high hypoxic is positive correlative with neoplastic cells, supporting the role in forming the hypoxic and nutrient-poor tumor microenvironment (<xref rid="btac825-B41" ref-type="bibr">Tao <italic toggle="yes">et al.</italic>, 2021</xref>). mDCs serve as a bridge linking to immune responses responsible for capturing, processing and presentation of antigens on their surface to T cells, and we observe that mDCs are colocalized with T cells (<xref rid="btac825-B10" ref-type="bibr">Chistiakov <italic toggle="yes">et al.</italic>, 2015</xref>).</p>
    </sec>
    <sec>
      <title>4.3 Charting spatial heterogeneity in breast cancer</title>
      <p>To delineate the complex tumor microenvironment, we apply EnDecon to a human breast cancer dataset generated using the ST protocol with published scRNA-seq data from 10× chromium as reference (<xref rid="btac825-F5" ref-type="fig">Fig. 5a</xref>). As annotated by a pathologist based on the morphology of the associated H&amp;E staining image, the SRT data consist of three annotated regions [connective tissue (CT), immune infiltrate (II) and invasive cancer (IC) regions] and one undetermined (UN) region. We observe that the cell type compositions of epithelial cells estimated by EnDecon have higher values in the IC region than in other regions (<xref rid="btac825-F5" ref-type="fig">Fig. 5b</xref>). The distribution of epithelial cells may form regional segment between IC and CT regions. However, most of the compared methods (e.g. CARD, ‘MuSiC weighted’ and SPOTlight) do not show clearly this regional segregation, which is evidenced by the distribution of cell type proportions within spots (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S18</xref>). The dominant cell types across spots inferred by EnDecon also clearly delineate regional segmentation between IC and CT regions, which are not captured by most comparison methods, such as CARD, SCDC and SPOTlight (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S19</xref>).</p>
      <fig position="float" id="btac825-F5">
        <label>Fig. 5.</label>
        <caption>
          <p>Analysis of the breast cancer SRT data. (<bold>a</bold>) Annotation of breast cancer tissue region. H&amp;E staining image of the breast cancer (left) displays three annotated and an undetermined regions (right), annotated by histologists from the original publication. (<bold>b</bold>) Visualization of deconvolution result. A spatial scatter pie chart displays cell-type compositions predicted by EnDecon and each scatter represents a spot in SRT data. (<bold>c</bold>) Comparisons of cell type proportions in three refined annotated regions. The boxplot represents the distribution of cell type proportions in each region. For each cell type, a two-sided Wilcoxon Rank Sum test is used to test the significance of difference. In the diagrams, ‘ns’ represents <italic toggle="yes">P</italic>-value &gt; 0.05, * represents 0.01 &lt; <italic toggle="yes">P</italic>-value <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mo>≤</mml:mo></mml:math></inline-formula> 0.05, and **** represents <italic toggle="yes">P</italic>-value <inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mo>≤</mml:mo></mml:math></inline-formula> 1e−4. (<bold>d</bold>) Top, the spatial distribution of abundances of different cell types estimated by EnDecon. Bottom, the spatial distribution of expression level of the corresponding canonical cell type marker genes. (<bold>e</bold>) Enrichment (red) and depletion (green) of predicted cell types in the four main annotated regions. The enrichment scores are proportional to the size of the circles (A color version of this figure appears in the online version of this article)</p>
        </caption>
        <graphic xlink:href="btac825f5" position="float"/>
      </fig>
      <p>To further explore the effectiveness of EnDecon in distinguishing cell type compositions across regions, we focus on the cell type compositions of spots located in the well-refined annotated regions [CT (109 spots), IC (139 spots) and II (7 spots)]. We correlate pathologist-annotated regions with predicted cell-type proportions to quantify differences in the distribution of cell-type proportions across tissue regions. By dividing the spots into three subsets based on their regions, we observe that the spatial distributions of the most inferred cell type proportions show significant differences in different regions (<xref rid="btac825-F5" ref-type="fig">Fig. 5c</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S20</xref>). The predicted spatial distributions of immune B and T cells show significant differences between the II and the other regions. In contrast, the proportion of epithelial cells was greatest in the IC area and the smallest in the IC area. The proportion of CAFs cells varied slightly between regions, being minimal in region II. Endothelial cells are evenly distributed throughout the tissue.</p>
      <p>To further validate the accuracy of the predicted cell type compositions by EnDecon, we compare the spatial distribution of cell types with that of the corresponding marker gene expression levels (<xref rid="btac825-F5" ref-type="fig">Fig. 5d</xref> and <xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S21</xref>). The results confirm the high accuracy of the predicted cell type compositions. For example, B cells are mainly distributed in II and UN regions, and its marker gene, MS4A1, highly expressed in the two regions. A marker gene of CAFs, COL1A1, shows clearly expression pattern in the CT region, consistent with the distribution of CAF cells. The located region of epithelial cells is consistent with the expression pattern of the corresponding marker gene EPCAM.</p>
      <p>We examine the accuracy of predicted cell type spatial mapping by performing region-based cell type enrichment analysis. Cell types are enriched in diverse regions, which are matched with the cell type abundances inferred by EnDecon (<xref rid="btac825-F5" ref-type="fig">Fig. 5e</xref>). Epithelial and PVL cells are enriched in the IC region, and CAFs are enriched in the CT region. These enrichment results further illustrate the accuracy of EnDecon in predicted cell-type compositions.</p>
      <p>The cell type colocalization map is also characterized (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S22</xref>). Two cell types are regarded as colocalization in a spatial context when the corresponding spot-wise PCC score is positive. In the immune cell populations, B cells are anti-correlated with plasmablasts cells, reflecting that the B cells and plasmablasts cells reside in distinct regions within tumor (<xref rid="btac825-B32" ref-type="bibr">Öhlund <italic toggle="yes">et al.</italic>, 2017</xref>). In contrast, B cells and T cells exhibit strong colocalization signal and both are enriched in the II region (<xref rid="btac825-F5" ref-type="fig">Fig. 5d and e</xref>). On the other hand, T cells are colocalized with myeloid cells (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S22</xref>), which agrees with the fact that they often interact with each other in the tumor microenvironment (<xref rid="btac825-B13" ref-type="bibr">DeNardo <italic toggle="yes">et al.</italic>, 2010</xref>). Epithelial and PVL cells are colocalized with each other, and both anticorrelate with the other cell types as expected.</p>
    </sec>
  </sec>
  <sec>
    <title>5 Discussion</title>
    <p>By integrating the base deconvolution results produced by 14 individual cell-type deconvolution methods, we propose a new weighted ensemble learning method to predict cell-type compositions for SRT data. The superior performance of our method on simulated datasets and a real adult mouse brain dataset demonstrates the accuracy of EnDecon in cell-type deconvolution. We also apply our method to three real SRT data to explore the spatial distributions of cell types on those tissues. Mapping cell type compositions predicted by EnDecon into spatial context, our method can successfully segment tissue regions predefined by pathologists. EnDecon correctly locates cell type to the specific spatial regions, which are consistent with the gene expression patterns of the corresponding cell type marker genes. Furthermore, cell type-enriched regions are in line with those of located regions. These comprehensive analysis results confirm the effectiveness of EnDecon in predicting cell type compositions within spots for SRT data.</p>
    <p>We find that individual methods such as Cell2location, DWLS, ‘MuSiC weighted’ and RCTD tend to have better performance on different datasets (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S25</xref>), which is partly consistent with previous benchmark studies (<xref rid="btac825-B9" ref-type="bibr">Chen <italic toggle="yes">et al.</italic>, 2022</xref>; <xref rid="btac825-B22" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2022a</xref>). However, none of them is an apparent winner across all datasets. EnDecon outperforms all individual methods in almost all cases, suggesting that using ensemble learning to integrate different deconvolution methods is more reasonable than selecting better-performing methods. In addition, it would be a good idea to remove poorly performing methods before integrating them. We do not take this step for the following reasons. First, few methods perform poorly in all situations, and a method that performs poorly in some situations may perform well in others. Second, in real data applications, we often do not have the ground truth of the proportion of cell types within each spot, so we cannot directly quantify the performance of individual methods. Third, our weighted approach is developed to handle situations where the performance of different individual methods varies widely for a considered dataset. Our method can automatically compute weights for each integrated method and combine the base deconvolution results based on the weights. Experiment results show that the weights assigned by EnDecon to base deconvolution methods have a significant positive correlation with their performance, indicating that EnDecon can automatically increase the weights of better-performing methods and decrease the weights of poorer-performing methods without ground truth.</p>
    <p>To show the effectiveness of our weighted ensemble approach, we have compared EnDecon with a baseline ensemble approach, EnDecon_mean, which treats each base deconvolution result equally and uses their average as the ensemble results. Although the performance difference between EnDecon and EnDecon_mean is relatively small in some cases, our weighted approach would be more reasonable. First, EnDecon outperforms EnDecon_mean in 16 out of 18 simulation results (6 datasets × 3 metrics) (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S25</xref>). Second, EnDecon can provide more meaningful and reasonable results than EnDecon_mean in real data experiments. For example, EnDecon can correctly capture glial cells outside the mouse brain that are incorrectly predicted as neuron cells by EnDecon_mean, and the neuron cells in the hippocampal region that are incorrectly predicted as glial cells by EnDecon_mean (<xref rid="btac825-F3" ref-type="fig">Fig. 3b</xref>). In addition, the dominant cell types within spots inferred by EnDecon can clearly delineate the segmentation between pancreatic interstitial regions, while the dominant cell types inferred by EnDecon_mean blend these regions together (<xref rid="sup1" ref-type="supplementary-material">Supplementary Fig. S14</xref>). Third, compared to EnDecon_mean, EnDecon can compute a weight for each base method. Experiment results have shown that the weights assigned to base methods are positively correlated with their performance on both simulated and real datasets. Therefore, the weights that EnDecon assigns to the base deconvolution methods are meaningful, as they may provide clues about the performance of the base deconvolution methods when the ground truth is unavailable.</p>
    <p>It is important to note that the performance of an individual method may vary across different settings. Running with different settings of the individual method may improve its and EnDecon’s performance. However, we adopt default settings suggested by the authors for each base deconvolution method and do not explore different settings for the following reasons. First, the default settings suggested by the authors may have been tested extensively by them, which may generalize well to new test scenarios. Second, each individual method may have multiple parameters that need to be set, making it impractical to try all possible combinations of parameter settings for the 14 individual methods. Third, a good method should not be very sensitive to parameter settings, and most previous benchmark studies (<xref rid="btac825-B9" ref-type="bibr">Chen <italic toggle="yes">et al.</italic>, 2022</xref>; <xref rid="btac825-B22" ref-type="bibr">Li <italic toggle="yes">et al.</italic>, 2022a</xref>) and research articles also adopt default settings. Fourth, when ground truth is available, we can choose the best settings in terms of accuracy. However, in most real data applications, we usually do not have a metric score to choose the optimal settings since this is no ground truth of cell type compositions. Fifth, our goal is to develop an easy-to-use, robust and accurate ensemble method that can generalize to new datasets without fine-tuning the base method settings. Our EnDecon will be inconvenient to use if we let the users try different settings of the base methods.</p>
    <p>EnDecon will be improved in two directions in the future. First, while we have endeavored to include more of the currently available individual deconvolution methods in EnDecon, cell-type deconvolution of SRT data is a rapidly developing field that will soon yield more effective and efficient methods. Integrating more individual deconvolution methods into EnDecon will not only improve the accuracy of deconvolution but also make it more robust to noise in SRT data and batch effects between SRT data and reference scRNA-seq datasets. Thus, we will integrate more individual methods into EnDecon. Second, the rapid development of scRNA-seq technologies allows us to have multiple reference scRNA-seq datasets from different platforms or samples for the same tissue. Borrowing strength from multiple reference datasets may increase the accuracy and robustness. Currently, EnDecon and all individual methods it includes are based on only a single reference scRNA-seq dataset. In the future, we will extend our EnDecon to better integrate the complementary strengths between different scRNA-seq reference datasets.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac825_Supplementary_Data</label>
      <media xlink:href="btac825_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the National Natural Science Foundation of China [11871026 and 12271198]; Hong Kong Research Grants Council [Projects 11204821]; and Hong Kong Innovation and Technology Commission (InnoHK Project CIMDA), and City University of Hong Kong [Project 9610034].</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: The authors decare that they have no conflict of interest.</p>
  </sec>
  <sec sec-type="data-availability">
    <title>Data availability</title>
    <p>The datasets are derived from sources in the public domain: the adult mouse brain and mouse brain cortex SRT data are obtained from the 10x Genomics websites (<ext-link xlink:href="https://www.10xgenomics.com/resources/datasets/adult-mouse-brain-section-2-coronal-stains-dapi-anti-gfap-anti-neu-n-1-standard-1-1-0" ext-link-type="uri">https://www.10xgenomics.com/resources/datasets/adult-mouse-brain-section-2-coronal-stains-dapi-anti-gfap-anti-neu-n-1-standard-1-1-0</ext-link> and <ext-link xlink:href="https://www.10xgenomics.com/resources/datasets/mouse-brain-section-coronal-1-standard-1-1-0" ext-link-type="uri">https://www.10xgenomics.com/resources/datasets/mouse-brain-section-coronal-1-standard-1-1-0</ext-link>) and the corresponding scRNA-seq data from the Gene Expression Omnibus (GEO) website under accession number ID GSE71585, the human pancreatic ductal adenocarcinoma (PDAC) SRT and the corresponding scRNA-seq data from the GEO website under accession number ID GSE111672, the human breast cancer SRT data from the Zenodo data repository (<ext-link xlink:href="https://doi.org/10.5281/zenodo.4739739" ext-link-type="uri">https://doi.org/10.5281/zenodo.4739739</ext-link>) and the corresponding scRNA-seq data from the GEO website under accession number ID GSM5354515.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac825-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Abdelaal</surname><given-names>T.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>SpaGE: spatial gene enhancement using scRNA-seq</article-title>. <source>Nucleic Acids Res</source>., <volume>48</volume>, <fpage>e107</fpage>.<pub-id pub-id-type="pmid">32955565</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Andersson</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Single-cell and spatial transcriptomics enables probabilistic inference of cell type topography</article-title>. <source>Commun. Biol</source>., <volume>3</volume>, <fpage>1</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">31925316</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Andersson</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Spatial deconvolution of HER2-positive breast cancer delineates tumor-associated cell type interactions</article-title>. <source>Nat. Commun</source>., <volume>12</volume>, <fpage>1</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">33397941</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Asp</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Spatially resolved transcriptomes-next generation tools for tissue exploration</article-title>. <source>BioEssays</source>, <volume>42</volume>, <fpage>1900221</fpage>.</mixed-citation>
    </ref>
    <ref id="btac825-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Avila Cobos</surname><given-names>F.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Benchmarking of cell type deconvolution pipelines for transcriptomics data</article-title>. <source>Nat. Commun</source>., <volume>11</volume>, <fpage>1</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">31911652</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Baron</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter-and intra-cell population structure</article-title>. <source>Cell Syst</source>., <volume>3</volume>, <fpage>346</fpage>–<lpage>360.e4</lpage>.<pub-id pub-id-type="pmid">27667365</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Burgess</surname><given-names>D.J.</given-names></string-name></person-group> (<year>2019</year>) <article-title>Spatial transcriptomics coming of age</article-title>. <source>Nat. Rev. Genet</source>., <volume>20</volume>, <fpage>317</fpage>.<pub-id pub-id-type="pmid">30980030</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cable</surname><given-names>D.M.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Robust decomposition of cell type mixtures in spatial transcriptomics</article-title>. <source>Nat. Biotechnol</source>., <volume>40</volume>(4), <fpage>517</fpage>–<lpage>526</lpage>.<pub-id pub-id-type="pmid">33603203</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chen</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>A comprehensive comparison on cell-type composition inference for spatial transcriptomics data</article-title>. <source>Brief. Bioinform</source>., <volume>23</volume>, <fpage>bbac245</fpage>.<pub-id pub-id-type="pmid">35753702</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chistiakov</surname><given-names>D.A.</given-names></string-name></person-group><etal>et al</etal> (<year>2015</year>) <article-title>Myeloid dendritic cells: development, functions, and role in atherosclerotic inflammation</article-title>. <source>Immunobiology</source>, <volume>220</volume>, <fpage>833</fpage>–<lpage>844</lpage>.<pub-id pub-id-type="pmid">25595536</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B11">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Clarkson</surname><given-names>K.L.</given-names></string-name></person-group> (<year>1985</year>) A probabilistic algorithm for the post office problem. In: <italic toggle="yes">Proceedings of the 17th Annual ACM Symposium on Theory of Computing</italic>, May 6–8, Providence, Rhode Island, USA.</mixed-citation>
    </ref>
    <ref id="btac825-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Danaher</surname><given-names>P.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Advances in mixed cell deconvolution enable quantification of cell types in spatial transcriptomic data</article-title>. <source>Nat. Commun</source>., <volume>13</volume>, <fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">34983933</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>DeNardo</surname><given-names>D.G.</given-names></string-name></person-group><etal>et al</etal> (<year>2010</year>) <article-title>Interactions between lymphocytes and myeloid cells regulate pro-versus anti-tumor immunity</article-title>. <source>Cancer Metastasis Rev</source>., <volume>29</volume>, <fpage>309</fpage>–<lpage>316</lpage>.<pub-id pub-id-type="pmid">20405169</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dong</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2021a</year>) <article-title>SCDC: bulk gene expression deconvolution by multiple single-cell RNA sequencing references</article-title>. <source>Brief. Bioinform</source>., <volume>22</volume>, <fpage>416</fpage>–<lpage>427</lpage>.<pub-id pub-id-type="pmid">31925417</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dong</surname><given-names>R.</given-names></string-name></person-group><etal>et al</etal> (<year>2021b</year>) <article-title>SpatialDWLS: accurate deconvolution of spatial transcriptomic data</article-title>. <source>Genome Biol</source>., <volume>22</volume>, <fpage>1</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">33397451</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Dries</surname><given-names>R.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Giotto: a toolbox for integrative analysis and visualization of spatial expression data</article-title>. <source>Genome Biol</source>., <volume>22</volume>, <fpage>1</fpage>–<lpage>31</lpage>.<pub-id pub-id-type="pmid">33397451</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Elosua Bayes</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>SPOTlight: seeded NMF regression to deconvolute spatial transcriptomics spots with single-cell transcriptomes</article-title>. <source>Nucleic Acids Res</source>., <volume>49</volume>, <fpage>e50</fpage>.<pub-id pub-id-type="pmid">33544846</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Eng</surname><given-names>C.-H.L.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Transcriptome-scale super-resolved imaging in tissues by RNA seqFISH</article-title>. <source>Nature</source>, <volume>568</volume>, <fpage>235</fpage>–<lpage>239</lpage>.<pub-id pub-id-type="pmid">30911168</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fletcher</surname><given-names>P.T.</given-names></string-name></person-group><etal>et al</etal> (<year>2009</year>) <article-title>The geometric median on riemannian manifolds with application to robust atlas estimation</article-title>. <source>Neuroimage</source>, <volume>45</volume>, <fpage>S143</fpage>–<lpage>S152</lpage>.<pub-id pub-id-type="pmid">19056498</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gong</surname><given-names>T.</given-names></string-name></person-group><etal>et al</etal> (<year>2013</year>) <article-title>DeconRNASeq: a statistical framework for deconvolution of heterogeneous tissue samples based on mRNA-seq data</article-title>. <source>Bioinformatics</source>, <volume>29</volume>, <fpage>1083</fpage>–<lpage>1085</lpage>.<pub-id pub-id-type="pmid">23428642</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kleshchevnikov</surname><given-names>V.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Cell2location maps fine-grained cell types in spatial transcriptomics</article-title>. <source>Nat. Biotechnol</source>., <volume>40</volume>, <fpage>661</fpage>–<lpage>671</lpage>.<pub-id pub-id-type="pmid">35027729</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>B.</given-names></string-name></person-group><etal>et al</etal> (<year>2022a</year>) <article-title>Benchmarking spatial and single-cell transcriptomics integration methods for transcript distribution prediction and cell type deconvolution</article-title>. <source>Nat. Methods</source>, <volume>19</volume>, <fpage>662</fpage>–<lpage>670</lpage>.<pub-id pub-id-type="pmid">35577954</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Li</surname><given-names>H.S.</given-names></string-name></person-group><etal>et al</etal> (<year>2022b</year>) <article-title>scDEA: differential expression analysis in single-cell RNA-sequencing data via ensemble learning</article-title>. <source>Brief. Bioinform</source>., <volume>23</volume>, <fpage>bbab402</fpage>.<pub-id pub-id-type="pmid">34571530</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lopez</surname><given-names>R.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>DestVI identifies continuums of cell types in spatial transcriptomics data</article-title>. <source>Nat. Biotechnol</source>., <volume>40</volume>, <fpage>1360</fpage>–<lpage>1369</lpage>.<pub-id pub-id-type="pmid">35449415</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ma</surname><given-names>Y.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Spatially informed cell-type deconvolution for spatial transcriptomics</article-title>. <source>Nat. Biotechnol</source>., <volume>40</volume>, <fpage>1349</fpage>–<lpage>1359</lpage>.<pub-id pub-id-type="pmid">35501392</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Marx</surname><given-names>V.</given-names></string-name></person-group> (<year>2021</year>) <article-title>Method of the year: spatially resolved transcriptomics</article-title>. <source>Nat. Methods</source>, <volume>18</volume>, <fpage>9</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">33408395</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Means</surname><given-names>A.L.</given-names></string-name></person-group><etal>et al</etal> (<year>2001</year>) <article-title>Lineage commitment and cellular differentiation in exocrine pancreas</article-title>. <source>Pancreatology</source>, <volume>1</volume>, <fpage>587</fpage>–<lpage>596</lpage>.<pub-id pub-id-type="pmid">12120241</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Miller</surname><given-names>B.F.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Reference-free cell type deconvolution of multi-cellular pixel-resolution spatially resolved transcriptomics data</article-title>. <source>Nat. Commun</source>., <volume>13</volume>, <fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">34983933</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moncada</surname><given-names>R.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <article-title>Integrating microarray-based spatial transcriptomics and single-cell RNA-seq reveals tissue architecture in pancreatic ductal adenocarcinomas</article-title>. <source>Nat. Biotechnol</source>., <volume>38</volume>, <fpage>333</fpage>–<lpage>342</lpage>.<pub-id pub-id-type="pmid">31932730</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moses</surname><given-names>L.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Museum of spatial transcriptomics</article-title>. <source>Nat. Methods</source>, <volume>19</volume>, <fpage>534</fpage>–<lpage>546</lpage>.<pub-id pub-id-type="pmid">35273392</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Muraro</surname><given-names>M.J.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>A single-cell transcriptome atlas of the human pancreas</article-title>. <source>Cell Syst</source>., <volume>3</volume>, <fpage>385</fpage>–<lpage>394.e3</lpage>.<pub-id pub-id-type="pmid">27693023</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Öhlund</surname><given-names>D.</given-names></string-name></person-group><etal>et al</etal> (<year>2017</year>) <article-title>Distinct populations of inflammatory fibroblasts and myofibroblasts in pancreatic cancer</article-title>. <source>J. Exp. Med</source>., <volume>214</volume>, <fpage>579</fpage>–<lpage>596</lpage>.<pub-id pub-id-type="pmid">28232471</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B33">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Pham</surname><given-names>D.</given-names></string-name></person-group><etal>et al</etal> (<year>2020</year>) <italic toggle="yes">stLearn: integrating spatial location, tissue morphology and gene expression to find cell types, cell-cell interactions and spatial trajectories within undissociated tissues</italic>. bioRxiv 2020.05.31.125658. <pub-id pub-id-type="doi">10.1101/2020.05.31.125658</pub-id>.</mixed-citation>
    </ref>
    <ref id="btac825-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Röder</surname><given-names>P.V.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>Pancreatic regulation of glucose homeostasis</article-title>. <source>Exp. Mol. Med</source>., <volume>48</volume>, <fpage>e219</fpage>.<pub-id pub-id-type="pmid">26964835</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rovira</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2010</year>) <article-title>Isolation and characterization of centroacinar/terminal ductal progenitor cells in adult mouse pancreas</article-title>. <source>Proc. Natl. Acad. Sci. USA</source>, <volume>107</volume>, <fpage>75</fpage>–<lpage>80</lpage>.<pub-id pub-id-type="pmid">20018761</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sedlakova</surname><given-names>O.</given-names></string-name></person-group><etal>et al</etal> (<year>2014</year>) <article-title>Carbonic anhydrase IX, a hypoxia-induced catalytic component of the pH regulating machinery in tumors</article-title>. <source>Front. Physiol</source>., <volume>4</volume>, <fpage>400</fpage>.<pub-id pub-id-type="pmid">24409151</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Segerstolpe</surname><given-names>Å.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>Single-cell transcriptome profiling of human pancreatic islets in health and type 2 diabetes</article-title>. <source>Cell Metab</source>., <volume>24</volume>, <fpage>593</fpage>–<lpage>607</lpage>.<pub-id pub-id-type="pmid">27667667</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ståhl</surname><given-names>P.L.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>. <source>Science</source>, <volume>353</volume>, <fpage>78</fpage>–<lpage>82</lpage>.<pub-id pub-id-type="pmid">27365449</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sturm</surname><given-names>G.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Comprehensive evaluation of transcriptome-based cell-type quantification methods for immuno-oncology</article-title>. <source>Bioinformatics</source>, <volume>35</volume>, <fpage>i436</fpage>–<lpage>i445</lpage>.<pub-id pub-id-type="pmid">31510660</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sun</surname><given-names>D.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>STRIDE: accurately decomposing and integrating spatial transcriptomics using single-cell RNA sequencing</article-title>. <source>Nucleic Acids Res</source>., <volume>50</volume>, <fpage>e42</fpage>.<pub-id pub-id-type="pmid">35253896</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tao</surname><given-names>J.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Targeting hypoxic tumor microenvironment in pancreatic cancer</article-title>. <source>J. Hematol</source>., <volume>14</volume>, <fpage>1</fpage>–<lpage>25</lpage>.</mixed-citation>
    </ref>
    <ref id="btac825-B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tasic</surname><given-names>B.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>Shared and distinct transcriptomic cell types across neocortical areas</article-title>. <source>Nature</source>, <volume>563</volume>, <fpage>72</fpage>–<lpage>78</lpage>.<pub-id pub-id-type="pmid">30382198</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tsoucas</surname><given-names>D.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Accurate estimation of cell-type composition from gene expression data</article-title>. <source>Nat. Commun</source>., <volume>10</volume>, <fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">30602773</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B44">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>X.</given-names></string-name></person-group><etal>et al</etal> (<year>2018</year>) <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>. <source>Science</source>, <volume>361</volume>, <fpage>eaat5691</fpage>.<pub-id pub-id-type="pmid">29930089</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B45">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>X.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Bulk tissue cell type deconvolution with multi-subject single-cell expression reference</article-title>. <source>Nat. Commun</source>., <volume>10</volume>, <fpage>1</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">30602773</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B46">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname><given-names>Y.J.</given-names></string-name></person-group><etal>et al</etal> (<year>2016</year>) <article-title>Single-cell transcriptomics of the human endocrine pancreas</article-title>. <source>Diabetes</source>, <volume>65</volume>, <fpage>3028</fpage>–<lpage>3038</lpage>.<pub-id pub-id-type="pmid">27364731</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B47">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>M.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Spatially resolved cell atlas of the mouse primary motor cortex by MERFISH</article-title>. <source>Nature</source>, <volume>598</volume>, <fpage>137</fpage>–<lpage>143</lpage>.<pub-id pub-id-type="pmid">34616063</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B48">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname><given-names>X.F.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>EnImpute: imputing dropout events in single-cell RNA-sequencing data via ensemble learning</article-title>. <source>Bioinformatics</source>, <volume>35</volume>, <fpage>4827</fpage>–<lpage>4829</lpage>.<pub-id pub-id-type="pmid">31125056</pub-id></mixed-citation>
    </ref>
    <ref id="btac825-B49">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zubair</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Cell type identification in spatial transcriptomics data can be improved by leveraging cell-type-informative paired tissue images using a Bayesian probabilistic model</article-title>. <source>Nucleic Acids Res</source>., <bold>50</bold>, e80.</mixed-citation>
    </ref>
  </ref-list>
</back>
