<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.0 20120330//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Res</journal-id>
    <journal-id journal-id-type="hwp">genome</journal-id>
    <journal-id journal-id-type="publisher-id">GENOME</journal-id>
    <journal-title-group>
      <journal-title>Genome Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1088-9051</issn>
    <issn pub-type="epub">1549-5469</issn>
    <publisher>
      <publisher-name>Cold Spring Harbor Laboratory Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10691543</article-id>
    <article-id pub-id-type="pmid">37903634</article-id>
    <article-id pub-id-type="medline">9509184</article-id>
    <article-id pub-id-type="doi">10.1101/gr.277891.123</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methods</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Latent feature extraction with a prior-based self-attention framework for spatial transcriptomics</article-title>
      <alt-title alt-title-type="left-running">Li et al.</alt-title>
      <alt-title alt-title-type="right-running">Embedding method for spatial transcriptomics</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Zhen</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chen</surname>
          <given-names>Xiaoyang</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9684-5643</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Xuegong</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jiang</surname>
          <given-names>Rui</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Chen</surname>
          <given-names>Shengquan</given-names>
        </name>
        <xref rid="af2" ref-type="aff">2</xref>
      </contrib>
    </contrib-group>
    <aff id="af1"><label>1</label>Ministry of Education Key Laboratory of Bioinformatics, Bioinformatics Division at the Beijing National Research Center for Information Science and Technology, Center for Synthetic and Systems Biology, Department of Automation, Tsinghua University, Beijing 100084, China;</aff>
    <aff id="af2"><label>2</label>School of Mathematical Sciences and LPMC, Nankai University, Tianjin 300071, China</aff>
    <author-notes>
      <corresp>Corresponding author: <email>chenshengquan@nankai.edu.cn</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>10</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <month>10</month>
      <year>2023</year>
    </pub-date>
    <volume>33</volume>
    <issue>10</issue>
    <fpage>1757</fpage>
    <lpage>1773</lpage>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>3</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>19</day>
        <month>9</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>
        <ext-link xlink:href="http://genome.cshlp.org/site/misc/terms.xhtml" ext-link-type="uri">© 2023 Li et al.; Published by Cold Spring Harbor Laboratory Press</ext-link>
      </copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This article, published in <italic>Genome Research</italic>, is available under a Creative Commons License (Attribution-NonCommercial 4.0 International), as described at <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="1757.pdf"/>
    <abstract>
      <p>Rapid advances in spatial transcriptomics (ST) have revolutionized the interrogation of spatial heterogeneity and increase the demand for comprehensive methods to effectively characterize spatial domains. As a prerequisite for ST data analysis, spatial domain characterization is a crucial step for downstream analyses and biological implications. Here we propose a prior-based self-attention framework for spatial transcriptomics (PAST), a variational graph convolutional autoencoder for ST, which effectively integrates prior information via a Bayesian neural network, captures spatial patterns via a self-attention mechanism, and enables scalable application via a ripple walk sampler strategy. Through comprehensive experiments on data sets generated by different technologies, we show that PAST can effectively characterize spatial domains and facilitate various downstream analyses, including ST visualization, spatial trajectory inference and pseudotime analysis. Also, we highlight the advantages of PAST for multislice joint embedding and automatic annotation of spatial domains in newly sequenced ST data. Compared with existing methods, PAST is the first ST method that integrates reference data to analyze ST data. We anticipate that PAST will open up new avenues for researchers to decipher ST data with customized reference data, which expands the applicability of ST technology.</p>
    </abstract>
    <funding-group>
      <award-group id="funding-1">
        <funding-source>National Key Research and Development Program of China</funding-source>
        <award-id>2021YFF1200902</award-id>
      </award-group>
      <award-group id="funding-2">
        <funding-source>
          <institution-wrap>
            <institution>National Natural Science Foundation of China </institution>
            <institution-id institution-id-type="doi">10.13039/501100001809</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>62203236</award-id>
        <award-id>62273194</award-id>
        <award-id>61721003</award-id>
      </award-group>
      <award-group id="funding-3">
        <funding-source>
          <institution-wrap>
            <institution>Central Universities, Nankai University </institution>
            <institution-id institution-id-type="doi">10.13039/501100004945</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>63231137</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="17"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>Recent innovations in spatially resolved transcriptomics grant us a novel perspective on the cellular transcriptome, and hence have stimulated efforts to unravel cell transcriptomes in the context of cellular organizations and catalyze new discoveries in different areas of biological research (<xref rid="GR277891LIC14" ref-type="bibr">Crosetto et al. 2015</xref>; <xref rid="GR277891LIC17" ref-type="bibr">Dries et al. 2021</xref>; <xref rid="GR277891LIC33" ref-type="bibr">Larsson et al. 2021</xref>; <xref rid="GR277891LIC67" ref-type="bibr">Zhuang 2021</xref>; <xref rid="GR277891LIC42" ref-type="bibr">Moses and Pachter 2022</xref>). Advanced spatial transcriptomic (ST) techniques, including Visium (10x Genomics), Slide-seq (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>), and Stereo-seq (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>), could print spatially barcoded and oligo(dT) probes as microarrays of spots on the surface of glass slides, measuring genome-wide expression levels in captured locations, referred to as spots. When performing exploratory analysis of ST data, one of the most critical steps is characterizing spatial domains, which display spatially organized and functionally distinct anatomical structures on tissues. Nevertheless, low capture efficiency is one of the key reasons for high dropouts in single-cell RNA sequencing, leading to sparse and noisy data (<xref rid="GR277891LIC26" ref-type="bibr">Haque et al. 2017</xref>; <xref rid="GR277891LIC45" ref-type="bibr">Qiu 2020</xref>), and the limitations are also inherited by spatial transcriptomics data, making characterizing ST data computationally challenging (<xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). Also, ST data usually represents substantial spatial correlation across tissues, requiring advanced approaches to take spatial localization information into account (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>; <xref rid="GR277891LIC29" ref-type="bibr">Jiang et al. 2023</xref>).</p>
  <p>Several computational methods have been proposed to analyze ST data (<xref rid="GR277891LIC17" ref-type="bibr">Dries et al. 2021</xref>; <xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). BayesSpace performs spatial clustering via modeling the spatial correlation of gene profiles between neighboring spots (<xref rid="GR277891LIC66" ref-type="bibr">Zhao et al. 2021</xref>). SpaGCN identifies spatial domains by integrating gene expression, spatial location and histology through the construction of an undirected weighted graph (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>). CCST is an unsupervised cell clustering method based on graph neural networks for ST data (<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>). STAGATE integrates spatial information and gene profiles with an adaptive graph attention autoencoder to learn low-dimensional embeddings (<xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>). DR-SC uses a hidden Markov random field to perform dimension reduction and spatial clustering within a unified framework (<xref rid="GR277891LIC38" ref-type="bibr">Liu et al. 2022b</xref>). Non-negative spatial factorization (NSF) is a spatially aware probabilistic dimension reduction method which assumes an exponentiated Gaussian process prior over the spatial locations (<xref rid="GR277891LIC54" ref-type="bibr">Townes and Engelhardt 2023</xref>). SpatialPCA integrates localization information with a kernel matrix and performs spatial-aware principle component analysis (PCA) for ST data (<xref rid="GR277891LIC49" ref-type="bibr">Shang and Zhou 2022</xref>). Also, SCANPY and Seurat, two widely-used single-cell analysis workflows in the Python and R communities, respectively, also provide vignettes tailored for ST data analysis (<xref rid="GR277891LIC59" ref-type="bibr">Wolf et al. 2018</xref>; <xref rid="GR277891LIC25" ref-type="bibr">Hao et al. 2021</xref>).</p>
  <p>However, effective approaches for characterizing spatial domains in ST data need to overcome several challenges. First, existing methods failed to incorporate prior information from reference data to facilitate ST data analysis. Incorporating prior information in analyzing single-cell genomic data can better tackle the high level of noise and technical variation, and has been successfully applied in the analysis of various single-cell genomic data (<xref rid="GR277891LIC34" ref-type="bibr">Li et al. 2017</xref>; <xref rid="GR277891LIC32" ref-type="bibr">Lareau et al. 2019</xref>; <xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>; <xref rid="GR277891LIC50" ref-type="bibr">Shengquan et al. 2021</xref>). With the advanced technologies, massive amounts of ST data have been generated by consortiums or individual research groups (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>; <xref rid="GR277891LIC56" ref-type="bibr">Vickovic et al. 2019</xref>; <xref rid="GR277891LIC52" ref-type="bibr">Stickels et al. 2021</xref>) and accumulated in repositories and databases (<xref rid="GR277891LIC18" ref-type="bibr">Fan et al. 2020</xref>; <xref rid="GR277891LIC42" ref-type="bibr">Moses and Pachter 2022</xref>; <xref rid="GR277891LIC61" ref-type="bibr">Xu et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>; <xref rid="GR277891LIC62" ref-type="bibr">Yuan et al. 2023</xref>), paving the way to taking full advantage of the existing data and leveraging the data as reference to characterize spatial domains. Second, local spatial patterns should be effectively captured. Although it has been observed that aggregating information from each spot's neighbors via a graph convolutional network (GCN) is a promising approach to identify localized gene expression patterns (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>; <xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>), tailored model design for better characterization of local spatial patterns is still demanded (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>). Third, global spatial patterns should be carefully preserved. With the exponential growth of profiled spots and genes, the graph-based approach becomes cumbersome and time-consuming, requiring strategies that perform memory and time-efficient minibatch training and prediction while preserving global spatial patterns. Fourth, there is an emerging need for the automatic annotation of spatial domains, because advanced protocols constantly increase sequencing throughput, and the typical approach, which performs unsupervised spatial clustering and then assigns the putative domain to each cluster subjectively, would be cumbersome and irreproducible for large-scale ST data.</p>
  <p>To this end, we propose PAST, a <underline>P</underline>rior-based self-<underline>A</underline>ttention framework for <underline>S</underline>patial <underline>T</underline>ranscriptomics, which incorporates the graph residual network (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>; <xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to effectively characterize spatial domains. PAST is a variational graph convolutional autoencoder, and uses a Bayesian neural network (BNN) (<xref rid="GR277891LIC7" ref-type="bibr">Blundell et al. 2015</xref>) to incorporate prior information from reference data, self-attention mechanism (<xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to capture spatial patterns, and a ripple walk sampler (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>) to enable scalable subgraph-based training and prediction. Featured as the first ST method which integrates reference data from various sources, PAST aims to extract latent embeddings of ST data in a self-supervised manner. The latent embeddings obtained from PAST contain valuable spatial correlation patterns and can be directly fed into existing scRNA-seq computational tools for effective and novel downstream analyses.</p>
  <sec sec-type="results" id="s1">
    <title>Results</title>
    <sec id="s1a">
      <title>Overview of PAST</title>
      <p>PAST is a self-supervised representation learning model based on a framework of variational graph convolutional autoencoder, taking transcriptomic profiles and spatial coordinates of the target ST data and transcriptomic profiles of the reference data as input. As shown in <xref rid="GR277891LIF1" ref-type="fig">Figure 1</xref>B, the first layer of the encoder decomposes the total variation in ST data into two components (<xref rid="GR277891LIC34" ref-type="bibr">Li et al. 2017</xref>; <xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>): the component that captures the shared biological variation from reference data based on the BNN module, and the component that captures the unique biological variation in target ST data based on an unconstrained fully connected network (FCN). The choice of the reference data is flexible and can be constructed from various sources (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>A; <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S1</xref>), including: (1) external ST data of the same tissue and from the same protocol with the target ST data, (2) external ST data of similar tissues and from other protocols, (3) scRNA-seq data of similar tissues, or (4) the target ST data itself. In practice, the reference data can be incomplete: novel domains of biological variation that are not captured in the reference data can be present in target ST data. The second component uses an unconstrained FCN to adaptively capture the unique variation in target ST data that is not present in reference data.</p>
      <fig position="float" id="GR277891LIF1">
        <label>Figure 1.</label>
        <caption>
          <p>The PAST framework. (<italic>A</italic>) Four approaches for PAST to construct reference data, including three for external reference data (PAST-E) and one from the target data itself (PAST-S). (<italic>B</italic>) PAST is built on a variational graph convolutional autoencoder. The encoder of PAST consists of three layers, including the concatenation of a BNN and a FCN as the first layer and two self-attention modules as the subsequent two layers. The reparameterization module acquires the mean and log-variance matrix based on two FCNs, in which the mean matrix is the latent embedding obtained of PAST. The decoder of PAST is also a three-layer network, including a FCN layer and two stacked self-attention modules. The loss function of PAST consists of four parts, including reconstruction loss <italic>L</italic><sub><italic>recons</italic></sub>, Kullback-Leibler divergence (KLD) loss <italic>L</italic><sub><italic>kld</italic></sub>, metric learning loss <italic>L</italic><sub><italic>metric</italic></sub> and loss of BNN module <italic>L</italic><sub><italic>bnn</italic></sub>. (<italic>C</italic>) Ripple walk sampler samples high-quality subgraphs based on the spatial neighborhood graph and outputs minibatch gene expression matrices. (<italic>D</italic>) BNN module integrates shared biological variation through restricting the KLD distance between prior Gaussian distribution parameterized by reference data and Gaussian distribution parameterized by parameters of BNN. (<italic>E</italic>) The self-attention mechanism captures spatial correlation between neighbor spots, where FCN is used to generate queries, keys, and values for the calculation of attention weights. (<italic>F</italic>) The latent embeddings, that is, mean matrix in the reparameterization module, obtained by PAST facilitate various tasks including domain identification, trajectory inference, pseudotime analysis, multislice integration, and automatic annotation.</p>
        </caption>
        <graphic xlink:href="1757f01" position="float"/>
      </fig>
      <p>To integrate information of transcriptomic profiles and spatial coordinates, PAST identifies <italic>k</italic>-nearest neighbors (<italic>k</italic>-NN) for each spot using spatial coordinates in a Euclidean space, and adopts the graph residual network (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>) with a self-attention mechanism (<xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to aggregate information from each spot's neighbors. Specifically, the self-attention mechanism, which fits the relationship between words well in machine translation tasks (<xref rid="GR277891LIC46" ref-type="bibr">Raffel et al. 2020</xref>), is used to model local spatial patterns between neighboring spots, whereas the ripple walk sampler (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>), which enables efficient subgraph-based training for large and deep GCNs, is used to achieve better scalability on large-scale ST data and preserve global spatial patterns simultaneously. PAST also restricts the distance of latent embeddings between neighbors through metric learning (<xref rid="GR277891LIC23" ref-type="bibr">Hadsell et al. 2006</xref>), the insight of which is that spatially close spots are more likely to be positive pairs to show similar latent patterns, illustrated in detail in the Loss function part of the Methods section. After model training and prediction, the latent embeddings, that is, the mean matrix of the reparameterization module (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>B), can be applied to spatial domain characterization, spatial visualization, trajectory inference, pseudotime analysis, multislice joint embedding, and automatic annotation (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>F).</p>
    </sec>
    <sec id="s1b">
      <title>PAST effectively leverages reference data from various sources for spatial domain characterization</title>
      <p>We first use an example as a proof of concept to show the capability of PAST in incorporating reference data from different sources for spatial domain characterization. We collected ST data from a STARmap data set of the mouse primary visual cortex (MPVC) (<xref rid="GR277891LIC57" ref-type="bibr">Wang et al. 2018</xref>). We also constructed the reference data from the target ST data itself, a 10x Visium ST data set of the mouse brain coronal region (<xref rid="GR277891LIC44" ref-type="bibr">Palla et al. 2022</xref>), and a scRNA-seq data set of the mouse cortex (<xref rid="GR277891LIC53" ref-type="bibr">Tasic et al. 2016</xref>), which were referred to as PAST-S, PAST-E-Visium, and PAST-E-scRNA, respectively. The three variants of PAST were benchmarked against eight baseline methods, including two widely-used single-cell analysis workflows in Python and R community (SCANPY [<xref rid="GR277891LIC59" ref-type="bibr">Wolf et al. 2018</xref>] and Seurat [<xref rid="GR277891LIC25" ref-type="bibr">Hao et al. 2021</xref>]), and six methods for ST data analysis (SpaGCN [<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>], CCST [<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>], DR-SC [<xref rid="GR277891LIC38" ref-type="bibr">Liu et al. 2022b</xref>], NSF [<xref rid="GR277891LIC54" ref-type="bibr">Townes and Engelhardt 2023</xref>], SpatialPCA [<xref rid="GR277891LIC49" ref-type="bibr">Shang and Zhou 2022</xref>], and STAGATE [<xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>]). We first show the advantages of PAST quantitatively from the following three perspectives. The detailed information about baseline methods and quantitative evaluation metrics are described in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S2</xref>.</p>
      <p>First, we quantitatively evaluated the performance of spatial domain characterization via supervised cross-validation (Cross-validation). The supervised cross-validation aims to assess the representation capabilities of the latent embeddings learned by various methods. Specifically, we treated the latent embeddings as the input and the labels of spatial domains as the output, adopted support vector machine (SVM) as the classifier as suggested by a benchmark study on supervised single-cell annotation (<xref rid="GR277891LIC1" ref-type="bibr">Abdelaal et al. 2019</xref>), and conducted fivefold cross-validation experiments. We evaluated the performance by the average score of accuracy (Acc), Cohen's kappa value (κ), mean F1 score (mF1), and weighted F1 score (wF1), respectively, in the fivefold experiments. A higher score of the metrics suggests that the latent embeddings can better predict the spatial domains and, consequently, have superior representation capabilities. As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S1A</xref>, except SpatialPCA, PAST-S and PAST-E-Visium outperform the remaining seven baseline methods for excellent embedding capabilities. Although PAST-E-scRNA performed worse than SpatialPCA and STAGATE, which may be caused by the inconsistency of tissues and protocols between ST data and the reference scRNA-seq data, it still outperforms the other six baseline methods. To qualitatively evaluate the representation capabilities of low-dimensional embeddings, we also visualized the spots using uniform manifold approximation and projection (UMAP) and t-distributed stochastic neighbor embedding (t-SNE) based on the latent embeddings learned by different methods (<xref rid="GR277891LIF2" ref-type="fig">Fig. 2</xref>B; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S2A</xref>). Except L2/3, L6, and CC, SCANPY and Seurat could hardly distinguish other domains. SpaGCN, DR-SC, NSF provide relatively better performance. STAGATE succeeded to detect most of the domains but still failed to decipher the heterogeneity of HPC. The three variants of PAST consistently achieve satisfactory visualization results compared with other methods and only SpatialPCA, PAST-S, and PAST-E-Visium successfully distinguished HPC from other domains.</p>
      <fig position="float" id="GR277891LIF2">
        <label>Figure 2.</label>
        <caption>
          <p>PAST effectively leverages reference data from various sources for spatial domain characterization. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on STARmap MPVC data set via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). (<italic>B</italic>) UMAP visualization results, (<italic>C</italic>) spatial visualization of clustering with a specified number of clusters and the manual annotation and (<italic>D</italic>) clustering evaluation of different methods under various dropout rates on MPVC data set.</p>
        </caption>
        <graphic xlink:href="1757f02" position="float"/>
      </fig>
      <p>Second, we compared the performance of spatial domain characterization through the unsupervised spatial clustering with a specified number of clusters (Ncluster), in which the specified number of clusters is set to the number of unique ground-truth spatial domains. We directly used the baseline spatial clustering methods, such as CCST (<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>) and SpaGCN (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>), or the accompanying spatial clustering strategy of each of the other baseline methods on the learned latent embeddings. Following STAGATE, PAST performed clustering with a specified number of clusters by the mclust algorithm. For SCANPY, Seurat and NSF which perform clustering by Louvain or Leiden, we implemented a binary search to tune the resolution parameter in clustering to make the number of clusters and the specified number as close as possible. We evaluated the clustering performance by six metrics: adjusted rand index (ARI), adjusted mutual information (AMI), normalized mutual information (NMI), Fowlkes-Mallows index (FMI), completeness (Comp), and homogeneity (Homo). As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S1A</xref>, PAST-S and PAST-E-Visium provide superior performance than all eight baseline methods on all six metrics. PAST-E-scRNA only performs slightly worse than SpatialPCA even when integrating incompatible scRNA-seq data as reference. SCANPY and Seurat, two widely-used single-cell analysis workflows, provided a relatively poor performance even using the vignettes tailored for ST data, indicating the importance of utilizing spatial information. Furthermore, visualization of the spatial domains characterized by clustering with a specified number of clusters and the ground-truth spatial domains on the spatial coordinates of ST data also show consistent results with the quantitative evaluation (<xref rid="GR277891LIF2" ref-type="fig">Fig. 2</xref>C). Note that for CCST, we only evaluated the clustering performance with a specified number of clusters because it is a spatial clustering method and does not provide latent embeddings.</p>
      <p>Third, we test the performance of PAST and other methods for the unsupervised spatial clustering with default resolution (Dlouvain), which is useful for the general situation in which the number of unique ground-truth spatial domains is unknown (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>). We performed Louvain clustering algorithm, one of the most widely-used community-based clustering methods in single-cell studies, with default resolution based on the latent embeddings learned by different methods. As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S1A</xref>, PAST-S again achieves overall the best performance whereas PAST-E-Visium and PAST-E-scRNA perform better than any other baseline methods except SpatialPCA. It is vital to emphasize that PAST-scRNA, which incorporates scRNA-seq data to analyze ST data, even achieved 28.2% and 32.0% improvement compared to a competitive ST method STAGATE in terms of ARI and AMI, respectively (31.6%, 18.3%, 29.1%, 34.1% for NMI, FMI, Comp, and Homo, respectively). The evaluation results are detailed in <xref rid="SD1" ref-type="supplementary-material">Supplemental Table S1</xref>.</p>
      <p>To mimic protocols that provide low coverage, we down sampled the reads in the target ST data by randomly dropping out the entries in the expression matrix to zero with a probability equal to the specified dropout rate, as suggested by a recent benchmark study (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>). As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>D, all methods including the three variants of PAST were affected by the increase in the dropout rate, however, PAST with external reference (i.e., PAST-E-Visium and PAST-E-scRNA) consistently outperform the remaining methods over all different dropout rates. Altogether, the results above suggest PAST effectively deciphers spatial patterns through integrating external reference data constructed from various sources and when target ST data has a higher degree of sparsity and noise, the benefit of utilizing external reference data increases. Furthermore, we also showed that PAST is robust to model hyperparameters including the number of neighbors and latent dimensions on the STARmap MPVC data set (<xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S3, S4</xref>).</p>
    </sec>
    <sec id="s1c">
      <title>PAST robustly obtains informative low-dimensional embeddings and facilitates diverse downstream analyses</title>
      <p>To test the capability of PAST in learning effective embeddings and accomplishing downstream tasks, we further collected 12 human dorsolateral prefrontal cortex (DLPFC) slices from a 10x Visium data set (<xref rid="GR277891LIC40" ref-type="bibr">Maynard et al. 2021</xref>). For each slice, we constructed the reference data from the ST data itself and from external ST data, namely the remaining 11 slices. The two variants of PAST have different application scenarios and are referred to as PAST-S and PAST-E, respectively. First, we benchmarked PAST from the three quantitative perspectives against nine baseline methods, including the eight methods tested on the STARmap MPVC data set and a clustering method specifically designed for spatial transcriptomics (<xref rid="GR277891LIC51" ref-type="bibr">Ståhl et al. 2016</xref>) and 10x Visium data, namely BayesSpace (<xref rid="GR277891LIC66" ref-type="bibr">Zhao et al. 2021</xref>). Similar to CCST, we only evaluated the clustering performance with a specified number of clusters. As shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S5A</xref>, for supervised cross-validation, PAST-S and PAST-E performs better than other five baseline methods except NSF and SpatialPCA. Furthermore, PAST-S and PAST-E outperforms all the baseline methods in terms of unsupervised spatial clustering with a specified number of clusters and unsupervised spatial clustering with default resolution on the 12 DLPFC slices (<xref rid="SD2" ref-type="supplementary-material">Supplemental Table S2</xref>). One-sided paired Wilcoxon signed-rank tests showed that PAST-E showed much more advantages than PAST-S in terms of various clustering metrics in the two different clustering scenarios, with <italic>P</italic>-values of 0.0105 and 0.0002 for ARI, respectively (0.0061 and 0.0002 for AMI, 0.0061 and 0.0002 for NMI, 0.0105 and 0.0005 for FMI, 0.0105 and 0.0002 for Comp, and 0.0134 and 0.0002 for Homo), highlighting the benefit of integrating high-quality external reference data. Similarly, we visualized the spatial domains characterized by clustering with a specified number of clusters and the ground-truth spatial domains on the spatial coordinates of ST data to qualitatively evaluate the performance of different methods (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S6</xref>). Taking Slice 151,673 as an example, the spatial domain assignment of the nonspatial approaches, namely SCANPY and Seurat, provide poor continuity and smoothness, which is consistent with the above quantitative results. SpaGCN, NSF, and BayesSpace fail to decipher the expected layer pattern in layer 4–layer 6 of this slice, which impairs the spatial clustering accuracy, whereas CCST, DR-SC, SpatialPCA, STAGATE, PAST-S, and PAST-E successfully characterized the expected cortical layer structures, indicating the effective spatial domain characterization.</p>
      <fig position="float" id="GR277891LIF3">
        <label>Figure 3.</label>
        <caption>
          <p>PAST robustly obtains informative low-dimensional embeddings and facilitates diverse downstream analyses. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on 12 DLPFC slices via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). The center line, box limits and whiskers in the boxplots are the median, upper and lower quartiles, and 1.5× interquartile range, respectively. (<italic>B</italic>) UMAP visualization, (<italic>C</italic>) PAGA trajectory inference results, and (<italic>D</italic>) DPT pseudotime analysis results of Slice 151,673. (<italic>E</italic>) The number of shared spatial domains in external reference data gradually deceased. (<italic>F</italic>) The spots in external reference data of PAST were down sampled with a stratified random sampling strategy to construct reference data with various scales. The horizontal dashed lines represent the corresponding median scores of STAGATE.</p>
        </caption>
        <graphic xlink:href="1757f03" position="float"/>
      </fig>
      <p>Second, taking Slice 151,673 as an example, we performed various downstream analyses based on the low-dimensional embeddings obtained by different methods. For low-dimensional visualization based on the UMAP and t-SNE algorithm (<xref rid="GR277891LIF3" ref-type="fig">Fig. 3</xref>B; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S7, S8</xref>), except the white matter (WM), SCANPY and Seurat could hardly distinguish the cortical layers. SpaGCN DR-SC, and NSF provided relatively better performance, whereas SpatialPCA, STAGATE, PAST-S, and PAST-E successfully identified all the spatial structures and reconstructed the manifold of them. Also, UMAP and t-SNE visualization for the other 11 DLPFC slices provided similar results (<xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S7, S8</xref>). For spatial trajectory inference, based on the latent embeddings learned by different methods, we performed trajectory inference using PAGA on Slice 151,673 (<xref rid="GR277891LIC60" ref-type="bibr">Wolf et al. 2019</xref>). As shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>C, PAST captured the well-known corticogenesis patterns (<xref rid="GR277891LIC22" ref-type="bibr">Gilmore and Herrup 1997</xref>; <xref rid="GR277891LIC2" ref-type="bibr">Agirman et al. 2017</xref>) and inferred a nearly linear development trajectory from inner to outer layers, indicating the utility of PAST in revealing development trajectory. For spatial pseudotime analysis using the DPT algorithm (<xref rid="GR277891LIC24" ref-type="bibr">Haghverdi et al. 2016</xref>), PAST successfully characterized all the continuous development stages, whereas the other baseline methods only captured the pseudotime variation between WM and other cortical layers (<xref rid="GR277891LIF3" ref-type="fig">Fig. 3</xref>D). Trajectory inference and pseudotime analysis for other slices also provided similar results (<xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S9, S10</xref>), highlighting the potential of PAST to extract informative features and facilitate downstream analyses and biological implications. The detailed implementation of visualization, clustering and other downstream analyses are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S3</xref>.</p>
      <p>The previous example on DLPFC slices used external reference data constructed from the other slices, which contains more than 40,000 spots and heterogeneous information of almost all the domains (PAST-E). However, the prior information in external reference data is generally incomplete for the target ST data and the scale of high-quality reference data is generally limited. Therefore, we further carefully examined the robustness of PAST-E to the number of shared domains and scale of reference data, using STAGATE, a competitive method on DLPFC data set, as the baseline. We gradually left out different number of spatial domains in external reference data, and obtained PAST-E-LO1, PAST-E-LO2, PAST-E-LO3, and PAST-E-LO4, which denote leaving out layer 1, layers 1 and layer 2, layers 1 through layer 3, and layers 1 through layer 4, respectively. The results shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>E and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S11A</xref> were in line with intuition because as the spatial domains are continuously left out, the effective prior information in the reference data is decreased. Except PAST-E-LO4, the overall clustering performance of PAST-E when integrating reference with different number of shared domains is superior to STAGATE (the horizontal dashed lines), and PAST-E performs well even based on the reference data containing only nearly half of shared domains. Furthermore, another two different schedules removing the same number of shared domains in external reference data obtained similar results (shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S12, S13</xref>), suggesting the robustness of PAST to the number of shared domains in reference data. Meanwhile, to test the influence of limited scale of reference data without reducing the number of shared domains, we randomly down sampled the spots in reference data based on a stratified random sampling strategy, that is, sampling spots from each domain with a given rate. We obtained PAST-E-DS50, PAST-E-DS40, PAST-E-DS30, PAST-E-DS20, PAST-E-DS10, PAST-E-DS5, and PAST-E-DS1, which denote remaining sampled 50%, 40%, 30%, 20%, 10%, 5%, and 1% of the spots, respectively. Compared with PAST-E which integrated prior information from more than 40,000 spots, the data scale of reference of PAST-E-DS50 through PAST-E-DS1 was only 21,949 through 425. As shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>F and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S11B</xref>, PAST-E with down sampled reference data consistently achieves satisfactory performance for supervised cross-validation and spatial clustering, until only 1% of the spots in reference data remained. We then performed two-sided Wilcoxon signed-rank tests on the quantitative results of different reference data scales. As shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S14</xref>, the scale of reference data, which may range from a few hundred to tens of thousands, has no significant impact on the performance of PAST-E, indicating that PAST-E is highly robust to the data scale of reference data when the number of shared domains in reference is sufficient.</p>
    </sec>
    <sec id="s1d">
      <title>PAST captures local spatial patterns with self-attention mechanism</title>
      <p>Next, we tested whether PAST could provide insights into local spatial patterns. We applied PAST to an osmFISH mouse somatosensory cortex data set (MSC) (<xref rid="GR277891LIC13" ref-type="bibr">Codeluppi et al. 2018</xref>), and used the target data itself as reference. As shown in <xref rid="GR277891LIF4" ref-type="fig">Figure 4</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S15</xref>, PAST-S effectively characterizes spatial domains, and achieves significant improvement compared to the baseline methods in terms of cross-validation, and spatial clustering with a specified number of clusters or with default resolution (<xref rid="SD3" ref-type="supplementary-material">Supplemental Table S3</xref>). Also, PAST with different numbers of neighbors also showed its consistent superiority (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S16</xref>). For spatial visualization, PAST-S successfully identifies the expected structures and delineated the layer borders clearly, and the identified domains are more consistent with the original annotation of the data set (<xref rid="GR277891LIF4" ref-type="fig">Fig. 4</xref>B,C).</p>
      <fig position="float" id="GR277891LIF4">
        <label>Figure 4.</label>
        <caption>
          <p>PAST capably captures local spatial patterns with self-attention mechanism. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on the osmFISH MSC data set via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). (<italic>B</italic>) Visualization of the results of spatial clustering with a specified number of clusters on MSC. (<italic>C</italic>) The manual annotation of MSC. (<italic>D</italic>) UMAP visualization of spots in MSC. The blue, orange, and brown circles denote Layer 2–3 lateral, Layer 2–3 medial, and ventricle, respectively. (<italic>E</italic>) The neighbor proportion and attention proportion for border spots of domains Layer 2–3 lateral, Layer 2–3 medial, and ventricle, respectively.</p>
        </caption>
        <graphic xlink:href="1757f04" position="float"/>
      </fig>
      <p>We then explored the capability of the self-attention module of PAST-S in capturing local spatial patterns. As shown in <xref rid="GR277891LIF4" ref-type="fig">Figure 4</xref>D and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S17</xref>, compared with baseline methods like SCANPY, Seurat, DR-S,C and SpaGCN, PAST could effectively identify domains like Layer 2–3 lateral, Layer 2–3 medial, and ventricle in UMAP and t-SNE visualization (blue, orange, and brown circles). For these three spatial domains, we selected the border spots whose spatial neighbors were originated from at least one other spatial domain, and calculated the neighbor proportion and attention proportion of each domain. More specifically, for each border spot of each domain, we recorded the proportion of different spatial domains in the six nearest neighboring spots, and calculated the average proportion for all the border spots of each domain, resulting in the neighbor proportion. In comparison with the neighbor proportion, the attention proportion recorded the attention-weighted proportion of different spatial domains in the six nearest neighboring spots. As shown in <xref rid="GR277891LIF4" ref-type="fig">Figure 4</xref>E, the self-attention mechanism successfully identifies the neighboring spots from the same domain and improves the corresponding weights, that is, from 70.15% to 72.14% for Layer 2–3 lateral, from 72.41% to 75.92% for Layer 2–3 medial, and from 72.77% to 80.45% for ventricle, indicating that self-attention mechanism enables border spots to aggregate more information from neighbor spots belonging to the same domain. Taken together, PAST could effectively capture the local spatial patterns with the self-attention mechanism and characterize the spatial correlation of the spots in ST data, especially the easily confused border spots.</p>
    </sec>
    <sec id="s1e">
      <title>PAST enables scalable training and prediction on large data while preserving global spatial patterns</title>
      <p>With the development of ST technologies, the number of profiled spots and genes increases exponentially, requiring the scalability of computational methods. Traditional minibatch training strategy for deep learning, which partition entire data set into minibatches based on random sampling, is not suitable for graph neural network (GNN) because of the destruction to the connectivity and structure of graph (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>), making GNN-based methods such as SpaGCN (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>) and CCST (<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>) not applicable to large-scale ST data. STAGATE partitioned the profiled slice and constructed a graph for each part to enable training on large data (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>D), which may lead to the loss of global spatial patterns (<xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>). We thus introduced a subgraph-based strategy for scalable training and prediction that considers both the randomness and connectivity of the graph and samples high-quality subgraphs based on a ripple walk sampler (RWS). RWS was originally proposed only for training, and was extended by us from training to prediction by sampling subgraphs covering all spots of the target data set and aggregating the latent embeddings of different subgraphs in an ensemble manner (Methods). Based on the RWS strategy, PAST preserves global spatial patterns and enables efficient application simultaneously.</p>
      <fig position="float" id="GR277891LIF5">
        <label>Figure 5.</label>
        <caption>
          <p>PAST enables scalable training and prediction on large data while preserving global spatial patterns. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on the Stereo-seq MOBS1 data set via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). (<italic>B</italic>) The manual annotation of MOBS1. (<italic>C</italic>) Visualization of the results of spatial clustering with a specified number of clusters on MOBS1. (<italic>D</italic>) Sampling strategy of STAGATE for minibatch training. (<italic>E</italic>) Ripple walk sampling strategy of PAST for scalable subgraph-based training and prediction. (<italic>F</italic>) Average time cost of different methods on MOBS1. (<italic>G</italic>) Peak memory usage of different methods on MOBS1.</p>
        </caption>
        <graphic xlink:href="1757f05" position="float"/>
      </fig>
      <p>We collected a Stereo-seq mouse olfactory bulb section (MOBS1) with 107,416 spots and 26,145 genes and analyzed the data set on a standard desktop with an AMD Ryzen 7 Eight-Core 3800X CPU, 64GB of RAM and an NVIDIA GeForce RTX 2080 Ti GPU. We collected another Stereo-seq mouse olfactory bulb section (MOBS2) with 104,931 spots and 23,815 genes to construct the external reference for PAST. Note that we encountered memory errors when performing Seurat, SpaGCN, CCST, NSF, and SpatialPCA on MOBS1. As shown in <xref rid="GR277891LIF5" ref-type="fig">Figure 5</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S18</xref>, PAST-S and PAST-E, which incorporated self-prior information from MOBS1 itself and external-prior information from MOBS2, respectively, achieve overall the best performance for spatial domain characterization. The quantitative results are listed in <xref rid="SD4" ref-type="supplementary-material">Supplemental Table S4</xref>. Furthermore, PAST-S and PAST-E also achieve satisfactory performance in UMAP and t-SNE visualization (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S19</xref>). Also, the spatial domains detected by PAST-S and PAST-E were spatially continuous and smooth, and the subependymal zone (SEZ) domain, denoted as Cluster 1, was only successfully characterized by these two variants of PAST (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>B,C). We performed differential expression gene (DEG) analysis for Cluster 1 of PAST-S and PAST-E, respectively. The results of both of these two variants showed that the top two DEGs were <italic>Mbp</italic> and <italic>Plp1</italic>, which are classical genes encoding myelin proteins (<xref rid="GR277891LIC6" ref-type="bibr">Bitar et al. 2022</xref>). Myelin proteins were usually used as markers for striatal contamination or staining to facilitate accurate dissection of the SEZ (<xref rid="GR277891LIC19" ref-type="bibr">Friess et al. 2021</xref>; <xref rid="GR277891LIC6" ref-type="bibr">Bitar et al. 2022</xref>). We further performed Gene Ontology (GO) analysis for the top 10 DEGs with the lowest adjusted <italic>P</italic>-values of Cluster 1, and identified the most significant molecular function, that is, structural constituent of myelin sheath, with false discovery rates (FDR) of 1.28 × 10<sup>−4</sup> and 9.33 × 10<sup>−5</sup> for PAST-S and PAST-E, respectively. The GO analysis results were well consistent with the molecular function of SEZ domain, that is, deriving oligodendrocytes to form mature myelin sheaths around axons (<xref rid="GR277891LIC41" ref-type="bibr">Menn et al. 2006</xref>; <xref rid="GR277891LIC30" ref-type="bibr">Kazanis 2009</xref>), suggesting the ability of PAST to facilitate functional implication.</p>
      <p>We also recorded the computational time and peak memory usage of different methods, especially the two GNN-based methods, that is, STAGATE and PAST, which used different sampling strategies (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>D,E). As shown in <xref rid="GR277891LIF5" ref-type="fig">Figure 5</xref>F, the average computational time of PAST-S and PAST-E (168 and 164 sec) in 10 replicated experiments were approximately 30× less than STAGATE (5304 sec). In terms of peak memory usage, PAST-S and PAST-E also consumed significantly less memory than STAGATE (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>G), indicating that the RWS of PAST has a significant advantage over the partition strategy of STAGATE. SCANPY adopts the straightforward representation learning methods, that is, principle component analysis, without incorporating spatial information of ST data, thus providing relatively inferior performance but consuming the lowest computation time (26 Sec). In summary, PAST enables scalable subgraph-based training and prediction while preserving global spatial patterns to better characterize spatial organizations.</p>
    </sec>
    <sec id="s1f">
      <title>PAST facilitates multislice joint embedding and automatic domain annotation</title>
      <p>Advanced ST sequencing technologies like 10x Visium, Slide-seq (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>), Slide-seq v2 (<xref rid="GR277891LIC52" ref-type="bibr">Stickels et al. 2021</xref>), and Stereo-seq (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) generate multiple sequencing slices for the same tissue at one time. However, because of the difference in the dissection of the tissue slices and their placement on array, the spatial coordinate system of multiple slices are different and cannot be easily compared across slices (<xref rid="GR277891LIC63" ref-type="bibr">Zeira et al. 2022</xref>), urgently requiring computational methods for multislice joint embedding and automatic domain annotation. We hence proposed two strategies, namely a transfer learning (TL) strategy and a three-dimensional (3D) stacking (3DStack) strategy, based on current representation learning framework to acquire joint embeddings of multiple slices (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S4</xref>). Specifically, given multiple slices with inconsistent coordinates and a deep representation learning model, TL strategy chooses one among these slices to train the deep representation learning model and then acquires the joint embeddings of all slices based on the trained model. In comparison, the 3D stacking strategy adds a third dimension to stack the multiple slices in a 3D space and only considers spatial relationship between spots from the same slice by setting the distance between different slices to a large value (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S20</xref>). Based on the 3D coordinates reconstructed by 3D stacking strategy, current representation learning methods can be easily applied to multiple slices for joint embedding. After obtaining joint embeddings of multiple slices, automatic domain annotation can be easily implemented with a specified classifier (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S4</xref>). Specifically, we first split the data into a reference set with domain labels and a target set without labels, then based on the joint embeddings, we trained a SVM on the reference set with its embeddings and labels, and predicted the labels of target set with the trained SVM. Note that the official implementation of DR-SC, SpaGCN, SpatialPCA, and STAGATE cannot use 3D coordinates, whereas SCANPYand Seurat cannot integrate spatial information, thus not applicable to 3D stacking strategy. Nondeep learning models like SCANPY, Seurat, NSF, DR-SC and SpatialPCA are not applicable to TL strategy designed for deep methods, and acquire the latent embeddings of each slice separately in the subsequent experiments.</p>
      <p>We first adopted the 12 DLPFC slices to quantitatively show the integration and annotation performance of different methods based on the two strategies, denoting methods using the TL and 3DStack strategies as *-TL and *-3DStack, respectively. We split the DLPFC data set into a reference set, that is, Slice 151,673 with domain labels, and a target set, that is, remaining slices without labels. Naturally, PAST constructed reference data of the BNN module using Slice 151,673 with domain labels. As the UMAP and t-SNE visualization shown in <xref rid="GR277891LIF6" ref-type="fig">Figure 6</xref>A,B and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S21A–C</xref>, methods like SCANPY, Seurat, NSF, DR-SC, and SpatialPCA, which were directly applied to multiple slices and acquired the latent embeddings separately, obtain relatively poor performance, whereas STAGATE-TL, PAST-TL, and PAST-3DStack succeed in batch correction and domain identification, based on the joint embeddings of all the 12 slices obtained by TL and 3DStack strategy. We next used the embeddings and domain labels of Slice 151,673 to train a SVM classifier and annotated the spatial domains in other slices. For quantitative comparison of annotation results, PAST-TL consistently outperforms the baseline methods (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>C), and achieved significantly higher scores of Acc, κ, mF1, and wF1 than STAGATE-TL, the second-best method, with <italic>P</italic>-values of 0.0034, 0.0024, 0.0005, and 0.0005, respectively, in one-sided paired Wilcoxon signed-rank tests. PAST based on the 3D stacking strategy, namely PAST-3DStack, provides even better performance than PAST-TL and naturally outperforms any other baseline methods. Furthermore, clustering evaluation of the joint embeddings showed similar results (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S21D</xref>), highlighting the superiority of the TL and 3DStack strategies and PAST in multislice integration and automatic annotation.</p>
      <fig position="float" id="GR277891LIF6">
        <label>Figure 6.</label>
        <caption>
          <p>PAST facilitates multislice joint embedding and automatic domain annotation. UMAP visualization of spots based on the joint embeddings of all the 12 DLPFC slices colored by (<italic>A</italic>) slices and (<italic>B</italic>) spatial domains. (<italic>C</italic>) Performance of supervised annotation evaluated by accuracy (Acc), Cohen's kappa value (κ), mean F1 score (mF1), and weighted F1 score (wF1), where Slice 151,673 was taken as the training set and other 11 slices were taken as test sets. The center line, box limits, and whiskers in the boxplots are the median, upper and lower quartiles, and 1.5× interquartile range, respectively. (<italic>D</italic>) The manual annotation of BCS1, in which the IDC_3 tumor region was black circled. UMAP visualization of the joint embeddings of spots in BCS1/2 sections colored by (<italic>E</italic>) sections and (<italic>F</italic>) spatial domains. (<italic>G</italic>) The supervised annotation results on BCS2 by different methods. The black circle denotes the supervised annotated IDC_3 and Tumor_edge_3, whereas the blue and orange circles denote the supervised annotated DCIS/LCIS_1 and DCIS/LCIS_2, respectively. (<italic>H</italic>) The annotation results of Tumor_edge_3 and DCIS/LCIS_2 by PAST-TL and PAST-3DStack and the spatial expression patterns of BCS1-marker genes on BCS2.</p>
        </caption>
        <graphic xlink:href="1757f06" position="float"/>
      </fig>
      <p>We further collected another two 10x Visium human breast cancer sections (BCSs) for integration and annotation, where the first section (BCS1) of the data set is precisely annotated by (<xref rid="GR277891LIC20" ref-type="bibr">Fu et al. 2021</xref>) and the second section (BCS2) is not annotated. Naturally, we treated BCS1 (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>D) as reference set with domain labels and treated BCS2 as target set for annotation. PAST-TL and PAST-3DStack again successfully correct the batch effect between the sections and separate spots from different domains (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>E,F; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S22A,B,D</xref>). Based on joint embeddings acquired by different methods, we next trained a SVM classifier with embeddings and labels of BCS1, and annotated BCS2 (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>G; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S22C</xref>). For the evaluation of annotation results, we identified marker genes for each domain based on the ground-truth labels on BCS1 (referred to as BCS1-marker genes), and found that BCS1-marker genes of each domain were also differentially expressed in most of the corresponding PAST-TL and PAST-3DStack annotated tumor areas on BCS2 (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S23</xref>), indicating the ability of PAST-TL and PAST-3DStack to reveal biological variation among tumor areas. In addition, PAST successfully captured BCS2-specific spatial domains by separating the IDC_3 region on BCS1 into IDC_3 and Tumor_edge_3 on BCS2 (black circles in <xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>D,G). The BCS1-marker genes of Tumor_edge_3 also showed the unique spatial pattern of the newly annotated Tumor_edge_3 on BCS2, which further suggests the accuracy of annotation results on BCS2 (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>H). We also performed DEG analysis for Tumor_edge_3 region based on the annotation results of PAST-TL and PAST-3DStack on BCS2, and identified the same five most significant DEGs including <italic>IGHG3, IGKC, IGLC2, IGHG4</italic>, and <italic>IGHG1</italic> with adjusted <italic>P</italic>-values of 1.11 × 10<sup>−83</sup>, 1.86 × 10<sup>−78</sup>, 9.18 × 10<sup>−74</sup>, 9.18 × 10<sup>−74</sup>, 1.66 × 10<sup>−69</sup> for PAST-TL and 4.52 × 10<sup>−74</sup>, 2.60 × 10<sup>−69</sup>, 8.11 × 10<sup>−66</sup>, 1.75 × 10<sup>−62</sup>, 3.21 × 10<sup>−60</sup> for PAST-3DStack, respectively. Based on previous literature, the linkage of <italic>IGHG1/3/4</italic> provides information for prognosis of diseases like autoimmunity and malignancy (<xref rid="GR277891LIC43" ref-type="bibr">Oxelius and Pandey 2013</xref>), <italic>IGKC</italic>, serving as a robust immune marker, could predict metastasis-free survival and response to chemotherapy (<xref rid="GR277891LIC48" ref-type="bibr">Schmidt et al. 2012</xref>), and <italic>IGLC2</italic> was proven to be a significant prognostic biomarker for triple-negative breast cancer patients (<xref rid="GR277891LIC8" ref-type="bibr">Chang et al. 2021</xref>). The Gene Ontology enrichment for the top 10 DEGs of Tumor_edge_3 also significantly revealed lots of biological immune processes for both PAST-TL (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S24</xref>) and PAST-3DStack model (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S25</xref>).</p>
      <p>PAST-TL and PAST-3DStack also successfully captured the biological difference between DCIS/LCIS_1 and DCIS/LCIS_2 (blue and orange circles in <xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>G) and accurately annotated DCIS/LCIS_2 on BCS2, which was missed by other methods. The spatial expression visualization of BCS1-marker genes of DCIS/LCIS_2 on BCS2 illustrated the accurate annotation of DCIS/LCIS_2 by PAST and the two strategies (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>H). To summarize, based on the two strategies, PAST cannot only effectively facilitate multislice joint embedding and automatic domain annotation, but also identify test set-specific spatial patterns and reveal the corresponding biological implications.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s2">
    <title>Discussion</title>
    <p>In this article, we introduce PAST, a comprehensive and scalable framework that effectively integrates prior information via Bayesian neural networks, deciphers global and local spatial correlations based on graph residual network integrated with self-attention mechanism, and enables scalable training and prediction on large data sets with RWS strategy. With comprehensive experiments on multiple data sets generated by various technologies, we have shown that PAST capably incorporates prior information from various sources to better tackle the high-level technical variation and effectively integrates spatial information to characterize spatial domains, highlighting the superior information fusion capabilities of PAST. We have also showed the successful applications of PAST in downstream tasks including spatial domain characterization, ST visualization, spatial trajectory inference, and pseudotime analysis. Experiments on large-scale data sets also proved the scalability and effectiveness of PAST. Furthermore, PAST not only enables multislice joint embedding and automatic annotation of spatial domains for multiple ST data, but also provides biological insights into the annotated domains.</p>
    <p>PAST stands out as a representation learning method tailored for ST data by incorporating reference data, which can be constructed from four different approaches (Methods). This inherent property of PAST showcases remarkable potential in deciphering ST data, especially in light of the ever-growing reservoir of both ST data and scRNA-seq data, while it simultaneously poses challenges in selecting top-notch reference data for better performance. To offer practical suggestions and recommendations for users, we diligently constructed reference data encompassing all the four approaches for the data sets in the aforementioned experiments and reported their performance outcomes (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S5</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S26</xref>), which highlights the superiority of PAST even when integrating reference from completely different technologies. Nevertheless, owing to the potential uncertainty stemming from incongruity of external reference, it is advisable to prioritize reference data from the same technique, of the same tissue type, containing more shared domains, and of a larger scale. Furthermore, we also proposed three recommendation scores, that is, maxMAP, maxSC, and maxCHS, to guide users to select high-quality reference data in an adaptive way (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S5</xref>). The three recommendation scores assess the latent embeddings acquired by PAST with different external reference data, signifying stronger recommendation levels through higher values. Finally, the scores have been proven to effectively steer users towards selecting the optimal approach for reference construction across all data sets, while maintaining satisfactory computational time (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S26</xref>; <xref rid="SD5" ref-type="supplementary-material">Supplemental Tables S5</xref>, <xref rid="SD6" ref-type="supplementary-material">S6</xref>), which provides an adaptive, accurate, and scalable approach for users to select optimal reference data in ST data analysis.</p>
    <p>The self-attention mechanism of PAST is implemented to adaptively learn attention weights and proven to capably aggregates more information from neighbor spots belonging to the same domain. This capability can be translated into several practical benefits for researchers to analyze ST data, including interpretable visualization, effective clustering, and accurate annotation, which has been systematically showed in the aforementioned experiments. In addition, we further envision an extension of the self-attention mechanism, which models the relationship between spatially close spots based on the transcriptional information, to unravel intricate cell-cell interactions (CCI), because recent research has underscored the reliability of deciphering CCI from transcriptomic data (<xref rid="GR277891LIC3" ref-type="bibr">Armingol et al. 2021</xref>) and the strong relationship between spatial structures and CCI in the microenvironment (<xref rid="GR277891LIC4" ref-type="bibr">Asp et al. 2020</xref>; <xref rid="GR277891LIC39" ref-type="bibr">Liu et al. 2022c</xref>). Massively parallel sequencing-based technologies like 10x Visium, Slide-seq (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>), Slide-seq v2 (<xref rid="GR277891LIC52" ref-type="bibr">Stickels et al. 2021</xref>), and Stereo-seq (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) generates multiple sequencing slices for the same tissue with inconsistent coordinates. We propose a 3D stacking strategy to stack the slices into a 3D coordinate system and only consider the attention weights between spots from the same slice (PAST-3DStack). A recent method, called PASTE (<xref rid="GR277891LIC63" ref-type="bibr">Zeira et al. 2022</xref>), has been proposed to align multiple adjacent tissue slices into a consistent spatial coordinate system. Based on the coordinates obtained by PASTE, PAST capably implements cross-slice attention weights and obtain joint embeddings of multiple slices, denoted as PASTE-PAST. We compared PAST-3DStack with PASTE-PAST and other baseline methods for joint embedding on three donors of the human DLPFC data set, highlighting the superiority of PAST-3DStack (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S6</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S27, S28</xref>). Nevertheless, compared with PAST-3DStack, the combination of PASTE and PAST enables the characterization of cross-slice attention and inspires us to explore the extension of self-attention mechanism to model cross-data-set attention for multislice integration.</p>
    <p>Generalizability of computational methods across technologies, species, and tissue types holds immense significance. To test the consistency of PAST across various biological systems, we further extend our model to another two data sets of different species and tissue types, namely a Stereo-seq axolotl brain data set (<xref rid="GR277891LIC58" ref-type="bibr">Wei et al. 2022</xref>) and a Stereo-seq zebrafish embryo data set (<xref rid="GR277891LIC37" ref-type="bibr">Liu et al. 2022a</xref>) (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S7</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S29, S30</xref>). The experimental results showed the superiority of PAST in term of spatial clustering, UMAP, t-SNE, and spatial visualization. We also implemented PAST-3DStack to the Stereo-seq zebrafish embryo data set, which is composed of 12 slices, for joint embedding, illustrating the superiority of PAST and the 3D stacking strategy in multislice integration across different species (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S8</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S31</xref>). In summary, we have showcased the superior performance of PAST across four sequencing technologies, encompassing four species and spanning seven tissue types, which underscores the broad applicability and unwavering consistency of PAST across various biological systems.</p>
    <p>Certainly, there are several avenues for improving PAST. First, given that Chen et al. achieved satisfactory annotation and simulation performance in scATAC-seq data through assuming the latent embeddings follow a Gaussian mixture distribution (<xref rid="GR277891LIC11" ref-type="bibr">Chen et al. 2022b</xref>), we can explore the application of PAST in ST data simulation by adding more complex assumptions on latent distribution. Second, with the rapid development of ST sequencing technologies, many massively parallel sequencing-based methods are often complemented by high-resolution hematoxylin and eosin (H&amp;E) histology images, demanding methods like PAST to incorporate cross-modality information which contains valuable heterogeneity and pathological information (<xref rid="GR277891LIC28" ref-type="bibr">Hu et al. 2021b</xref>). Third, the rapid development of graph neural network and large language model field provide advanced methodology to model the relationship between connected nodes in graph or related words in sentence, which also opens new horizons for better characterization of relationship between neighboring spots. Finally, Chen et al. have already proven the effectiveness of leveraging reference data in the analysis of scATAC-seq data (<xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>), so we anticipate the extended application of PAST in other spatial omics data like spatial-ATAC-seq data (<xref rid="GR277891LIC15" ref-type="bibr">Deng et al. 2022</xref>; <xref rid="GR277891LIC21" ref-type="bibr">Gao et al. 2023</xref>).</p>
  </sec>
  <sec sec-type="methods" id="s3">
    <title>Methods</title>
    <sec id="s3a">
      <title>The model of PAST</title>
      <p>PAST is a self-supervised representation learning framework built upon variational graph convolutional autoencoder (<xref rid="GR277891LIC31" ref-type="bibr">Kingma and Welling 2014</xref>) and integrates a graph residual network (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>; <xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to model the node dependency in spatial graph. It takes three kinds of data as input, including preprocessed target gene expression matrix, target spatial coordinate matrix and reference gene expression matrix (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>B). The details about data preprocessing are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S9</xref>.</p>
      <sec id="s3a1">
        <title>Encoder</title>
        <p>The encoder of PAST is a three-layer neural network. The first layer consists of a BNN module and a parallel FCN, and the output of the first layer is the concatenation of the two modules. It decomposes the total variation in ST data into two components (<xref rid="GR277891LIC34" ref-type="bibr">Li et al. 2017</xref>; <xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>): the component that captures the shared biological variation from reference data with a BNN module, and the component that captures the unique biological variation in target ST data with an unconstrained FCN. This property has been validated through ablation study of BNN module and the FCN module, shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S10</xref> and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figures S32, S1B, S5B, and S15B</xref>. The second and third layers are two stacked self-attention modules. The input of self-attention module includes a feature matrix from the last layer and the <italic>k</italic>-NN graph constructed with spatial coordinates of the target data.</p>
      </sec>
      <sec id="s3a2">
        <title>Reparameterization module</title>
        <p>As suggested by variational autoencoder (VAE), we assume the prior of latent embeddings is centered isotropic multivariate Gaussian distribution, use two FCNs to obtain the mean and logarithmic variance matrices of latent space based on the output of encoder, and obtain normally distributed samples through the reparameterization trick. We emphasize that the mean matrix of this module is the final output of PAST, that is, latent embeddings.</p>
      </sec>
      <sec id="s3a3">
        <title>Decoder</title>
        <p>The decoder of PAST is also a three-layer network, in which the first and second layers are stacked self-attention modules and the third layer is a FCN. The decoder takes multivariate normally distributed samples from the reparameterization module as input and then outputs the reconstructed gene expression matrix of the target data.</p>
      </sec>
      <sec id="s3a4">
        <title>Training and prediction workflow</title>
        <p>In the forward propagation phase of training workflow, a <italic>k</italic>-NN graph is first constructed based on the target spatial coordinate matrix. Second, PAST samples high-quality subgraphs using the ripple walk training strategy based on the <italic>k</italic>-NN graph, providing subgraphs and minibatch gene expression matrices for encoder. The encoder of PAST takes the subgraphs and the target and reference gene expression matrices as input, in which the subgraphs serve as the spatial neighborhood graph for the self-attention module and the reference gene expression matrix provides prior parameters for BNN module. Third, reparameterization module uses the output feature matrix of encoder to acquire the parameters of latent Gaussian distribution based on two FCNs, implements the reparameterization trick (<xref rid="GR277891LIC31" ref-type="bibr">Kingma and Welling 2014</xref>) to sample multivariate normally distributed vectors, and then feeds the vectors and the subgraphs obtained from ripple walk sampler into the decoder to get a target reconstructed gene expression matrix. In the backward propagation phase, the gradient of each parameter in the model is calculated according to the loss function of PAST and is updated based on the Adam optimizer with default initial learning rate <italic>lr</italic> = 0.001. The detailed model structure and hyperparameter settings of PAST are summarized in <xref rid="SD7" ref-type="supplementary-material">Supplemental Table S7</xref>. The prediction workflow only contains the forward propagation of the encoder to acquire the mean matrix of the reparameterization module, that is, the latent embeddings. Furthermore, PAST implements ripple walk prediction strategy instead of the ripple walk training strategy in the prediction workflow.</p>
      </sec>
    </sec>
    <sec id="s3b">
      <title>Ripple walk sampler</title>
      <p>To extend our model to large-scale application scenarios, we adopt a subgraph-based sampling strategy called ripple walk sampler (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>C), which samples high-quality subgraphs to enable minibatch training (ripple walk training) under the premise of satisfying randomness and connectivity (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>). Furthermore, we extend the ripple walk sampler for scalable prediction, called ripple walk prediction. The detailed explanations of ripple walk sampler, training, and prediction are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S11</xref> and <xref rid="SD10" ref-type="supplementary-material">Supplemental Algorithms S1, S2, S3</xref>.</p>
    </sec>
    <sec id="s3c">
      <title>Bayesian neural network</title>
      <p>BNN introduces uncertainty into weights of the neural network to improve generalization in nonlinear regression problems (<xref rid="GR277891LIC7" ref-type="bibr">Blundell et al. 2015</xref>). Here we use BNN to integrate shared biological information from reference data (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>D).</p>
      <p>Parameters of the BNN module could be represented by <bold><italic>P</italic></bold> ∈ <italic>d</italic><sub><italic>in</italic></sub> × <italic>d</italic><sub><italic>out</italic></sub>, and each element in <bold><italic>P</italic></bold> is subject to a Gaussian distribution,<disp-formula id="GR277891LIUM1"><mml:math id="UM1" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>∼</mml:mo><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <inline-formula id="il1"><mml:math id="IL1" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> and <inline-formula id="il2"><mml:math id="IL2" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> are elements in the <italic>i</italic>th row and <italic>j</italic>th column of the mean matrix <bold><italic>μ</italic></bold><sub><italic>b</italic></sub> and variance matrix <inline-formula id="il3"><mml:math id="IL3" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula>, respectively. We get normally distributed parameters <bold><italic>P</italic></bold><sub><italic>ij</italic></sub> through reparameterization trick in each forward propagation process. Given an input matrix <bold><italic>M</italic></bold> ∈ <italic>B</italic> × <italic>d</italic><sub><italic>in</italic></sub> in a minibatch, the output matrix of shape <italic>B</italic> × <italic>d</italic><sub><italic>out</italic></sub> of BNN module is<disp-formula id="GR277891LIUM2"><mml:math id="UM2" display="block" overflow="scroll"><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">δ</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>⊙</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>f</italic><sub><italic>bnn</italic></sub>( · ) denotes the function of BNN module, <bold>δ</bold> is the standard gaussian noise matrix and <inline-formula id="il4"><mml:math id="IL4" display="inline" overflow="scroll"><mml:mo>⊙</mml:mo></mml:math></inline-formula> denotes element-wise product.</p>
      <p>To integrate shared biological variation information in reference data, we assume elements in <bold><italic>P</italic></bold> are subject to a prior Gaussian distribution parameterized by <bold><italic>μ</italic></bold><sub><italic>p</italic></sub> and <inline-formula id="il5"><mml:math id="IL5" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula>, where <bold><italic>μ</italic></bold><sub><italic>p</italic></sub> is the PCA projection weight matrix of the reference gene expression matrix and <bold><italic>σ</italic></bold><sub><italic>p</italic></sub> contains elements equal to one-tenth standard deviation of <bold><italic>μ</italic></bold><sub><italic>p</italic></sub>. The step-by-step construction of reference gene expression matrix from various sources is illustrated in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S1</xref> and <xref rid="SD10" ref-type="supplementary-material">Supplemental Algorithm S4</xref>. KLD is used to restrict the distance between the Gaussian distribution parameterized by the parameters of BNN module and the prior Gaussian distribution parameterized by reference data:<disp-formula id="GR277891LIUM3"><mml:math id="UM3" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:math></disp-formula>
<disp-formula id="GR277891LIUM4"><mml:math id="UM4" display="block" overflow="scroll"><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>−</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
</p>
    </sec>
    <sec id="s3d">
      <title>Self-attention mechanism</title>
      <p>Self-attention mechanism is the key mechanism of transformer for capturing the relationship between words in a given sentence in machine translation tasks, showing superior performance compared with other recurrent neural network-based models (<xref rid="GR277891LIC55" ref-type="bibr">Vaswani et al. 2017</xref>; <xref rid="GR277891LIC46" ref-type="bibr">Raffel et al. 2020</xref>). Recent advances have revealed that gene expression levels of neighboring spots in a tissue microenvironment tend to be correlated (<xref rid="GR277891LIC17" ref-type="bibr">Dries et al. 2021</xref>; <xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). Inspired by the above understanding, PAST adopts a self-attention mechanism to model the relationship between neighboring spots (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>E).</p>
      <p>The input of the self-attention module is a feature matrix <bold><italic>M</italic></bold> and the corresponding <italic>k</italic>-NN graph <inline-formula id="il6"><mml:math id="IL6" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>. <inline-formula id="il7"><mml:math id="IL7" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> is constructed using spatial coordinates with <italic>k</italic> = 6. The input matrix <bold><italic>M</italic></bold> is mapped to obtain query <bold><italic>Q</italic></bold>, key <bold><italic>K</italic></bold>, and value <bold><italic>V</italic></bold> through three FCNs, and the adjacent matrix <inline-formula id="il8"><mml:math id="IL8" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> can then be calculated as follows:<disp-formula id="GR277891LIUM5"><mml:math id="UM5" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">Q</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">K</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>d</italic><sub><italic>k</italic></sub> is the feature dimension of query <bold><italic>Q</italic></bold> and key <bold><italic>K</italic></bold>. The attention weight matrix <bold><italic>A</italic></bold> can be obtained by normalizing the adjacent matrix <inline-formula id="il9"><mml:math id="IL9" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>,<disp-formula id="GR277891LIUM6"><mml:math id="UM6" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">A</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold><italic>A</italic></bold><sub><italic>ij</italic></sub> is the attention weight from spot <italic>j</italic> to spot <italic>i</italic>, and <italic>S</italic><sub><italic>i</italic></sub> denotes the set of neighbors of spot <italic>i</italic> in <inline-formula id="il10"><mml:math id="IL10" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>. To avoid excessive spatial smoothing of hidden features, we add a shortcut in the self-attention module (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>; <xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) and the output of self-attention module can be written as the subsequent form:<disp-formula id="GR277891LIUM7"><mml:math id="UM7" display="block" overflow="scroll"><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>t</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">V</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">A</mml:mi><mml:mi>V</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where <italic>f</italic><sub><italic>attn</italic></sub>( · ) denotes the function of self-attention module.</p>
    </sec>
    <sec id="s3e">
      <title>Loss function</title>
      <p>Analysis of omics data is susceptible to sequencing noise such as dropout, and recent studies have proven that it is beneficial to consider data sparsity and dropout in spatial transcriptomic data (<xref rid="GR277891LIC50" ref-type="bibr">Shengquan et al. 2021</xref>). Here we design sparsity adaptive reconstruction loss based on the insight that the higher the data sparsity, the more serious the dropout phenomenon is, and the higher probability the zero gene expression observations are false negative. Given a minibatch containing <italic>B</italic> spots and <italic>M</italic> genes, the sparsity adaptive reconstruction loss is shown as<disp-formula id="GR277891LIUM8"><mml:math id="UM8" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>B</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold><italic>x</italic></bold><sub><italic>ij</italic></sub> denotes the profiled expression level of gene <italic>j</italic> in spot <italic>i</italic>, <inline-formula id="il11"><mml:math id="IL11" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the reconstructed expression level of gene <italic>j</italic> in spot <italic>i</italic>, and the function <italic>I</italic>( · ) is (<italic>s</italic><sub><italic>i</italic></sub> represents the sparsity of spot <italic>i</italic>)<disp-formula id="GR277891LIUM9"><mml:math id="UM9" display="block" overflow="scroll"><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mspace width="0.4em"/><mml:mo>=</mml:mo><mml:mspace width="0.4em"/><mml:mn>0</mml:mn></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula>
We assume the low-dimensional embeddings follow multivariate Gaussian distribution and the prior is the centered isotropic multivariate Gaussian distribution. The distance between the latent distribution and the prior distribution is restricted by KLD (<xref rid="GR277891LIC31" ref-type="bibr">Kingma and Welling 2014</xref>):<disp-formula id="GR277891LIUM10"><mml:math id="UM10" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">I</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:math></disp-formula>
<disp-formula id="GR277891LIUM11"><mml:math id="UM11" display="block" overflow="scroll"><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>B</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold>μ</bold> and <bold>σ</bold> are the mean vectors and standard deviation vectors of latent space, respectively, whereas <italic>d</italic><sub><italic>lat</italic></sub> denotes the dimension of latent space.</p>
      <p>Metric learning has been proposed to model the distance between samples, making the distance between positive sample pairs closer and the distance between negative sample pairs farther (<xref rid="GR277891LIC23" ref-type="bibr">Hadsell et al. 2006</xref>). Samples in spatial transcriptomics are of strong spatial autocorrelation, which means that spatial neighboring spots may have similar gene expression patterns and tend to belong to the same functional structure (<xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). Here we design a metric learning loss function to restrict the distance of low-dimensional representations between neighbor samples:<disp-formula id="GR277891LIUM12"><mml:math id="UM12" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:msub><mml:mo fence="false">|</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <bold><italic>G</italic></bold> is the weighted spatial neighbor graph and the connection weights between samples are calculated using the Student's <italic>t</italic>-distribution kernel, <bold>μ</bold><sub><italic>i</italic></sub> and <bold>μ</bold><sub><italic>j</italic></sub> denote the latent embeddings of spot <italic>i</italic> and spot <italic>j</italic>, respectively. The calculation of <bold><italic>G</italic></bold> can be denoted as<disp-formula id="GR277891LIUM13"><mml:math id="UM13" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:msup><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:msup><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold><italic>c</italic></bold><sub><italic>i</italic></sub> denotes the spatial coordinate of spot <italic>i</italic>, <italic>S</italic><sub><italic>i</italic></sub> denotes the set of neighbors of spot <italic>i</italic>, α is a scale factor that is set to 1 by default. We also tried to build the graph <bold><italic>G</italic></bold> with gene expression information of spots, that is, denoting the above <bold><italic>c</italic></bold><sub><italic>i</italic></sub> as gene expression vector of spot <italic>i</italic>, and compared the two different approaches (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S12</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S33</xref>), illustrating the effectiveness of building graph <bold><italic>G</italic></bold> with spatial information.</p>
      <p>As described in the above section, we integrate prior information through the BNN (<xref rid="GR277891LIC7" ref-type="bibr">Blundell et al. 2015</xref>) module and restrict the distance between parameter of the BNN module and prior distribution through <italic>L</italic><sub><italic>bnn</italic></sub> loss function. The objective function of PAST is the combination of the aforementioned four parts:<disp-formula id="GR277891LIUM14"><mml:math id="UM14" display="block" overflow="scroll"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>3</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>4</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>β</italic><sub>1</sub>, <italic>β</italic><sub>2</sub>, <italic>β</italic><sub>3</sub>, <italic>β</italic><sub>4</sub> are coefficients served as a trade-off between the four parts and we set <italic>β</italic><sub>1</sub> = 1, <italic>β</italic><sub>2</sub> = 1, <italic>β</italic><sub>3</sub> = 1, <italic>β</italic><sub>4</sub> = 1 by default. We have evaluated the impact of the four coefficients and the contribution of the four loss function parts through experimental analysis, which finally illustrates the robustness of PAST to different hyperparameter settings and the significance of each part of the loss function (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S13</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S34, S35</xref>).</p>
    </sec>
    <sec id="s3f">
      <title>Multislice joint embedding and automatic annotation</title>
      <p>We propose two strategies, namely a transfer learning strategy and a 3D stacking strategy, to apply representation learning methods designed for single slice to multiple slices for joint embedding. Furthermore, we annotate the domain labels of multiple slices in ST data based on the joint embeddings obtained by the aforementioned strategies. The detailed explanations of the joint embedding and automatic annotation strategies are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S4</xref>.</p>
    </sec>
    <sec id="s3g">
      <title>Baseline methods, downstream analyses, and evaluation metrics</title>
      <p>Downstream applications including visualization, clustering, trajectory inference, and pseudotime analysis are detailed in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S3</xref>. To evaluate the performance of our model, we benchmarked PAST with nine baseline methods in term of 16 quantitative metrics and various downstream analyses. We describe the baseline methods, parameter settings, and the evaluation metrics in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S2</xref>. The details about data collection and preprocessing are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S9</xref>. The information about all the target data sets and reference data sets is summarized in <xref rid="SD8" ref-type="supplementary-material">Supplemental Table S8</xref>.</p>
    </sec>
    <sec id="s3h">
      <title>Data sets</title>
      <p>The STARmap mouse primary visual cortex (MPVC) data set (<xref rid="GR277891LIC57" ref-type="bibr">Wang et al. 2018</xref>) is available at <uri xlink:href="https://kangaroo-goby.squarespace.com/data">https://kangaroo-goby.squarespace.com/data</uri>. The 10x Visium dorsolateral prefrontal cortex (DLPFC) data set (<xref rid="GR277891LIC40" ref-type="bibr">Maynard et al. 2021</xref>) includes 12 slices from 3 neurotypical adult donors and is accessible through <uri xlink:href="http://spatial.libd.org/spatialLIBD">http://spatial.libd.org/spatialLIBD</uri>. The osmFISH mouse somatosensory cortex (MSC) data set (<xref rid="GR277891LIC13" ref-type="bibr">Codeluppi et al. 2018</xref>) is available at website <uri xlink:href="http://linnarssonlab.org/osmFISH/availability/">http://linnarssonlab.org/osmFISH/availability/</uri>. The Stereo-seq mouse olfactory bulb (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) Sections 1 (MOBS1) and Section 2 (MOBS2) are accessible at <uri xlink:href="https://db.cngb.org/stomics/mosta/download/">https://db.cngb.org/stomics/mosta/download/</uri>, where MOBS2 was taken as the reference data for MOBS1. The 10x Visium human breast cancer Section 1 (BCS1) was precisely annotated by <xref rid="GR277891LIC20" ref-type="bibr">Fu et al. (2021)</xref>, whereas Section 2 (BCS2) is not manually annotated, available at the 10x Genomics website <uri xlink:href="https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-1-1-standard-1-1-0">https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-1-1-standard-1-1-0</uri> and <uri xlink:href="https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-2-1-standard-1-1-0">https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-2-1-standard-1-1-0</uri>, respectively. The three Stereo-seq axolotl brain data sets (<xref rid="GR277891LIC58" ref-type="bibr">Wei et al. 2022</xref>) identified by 2DPI are available through the website <uri xlink:href="https://db.cngb.org/stomics/artista/download/">https://db.cngb.org/stomics/artista/download/</uri>. The Stereo-seq zebrafish embryo data set (<xref rid="GR277891LIC37" ref-type="bibr">Liu et al. 2022a</xref>) contains 12 slices of 12 h post-fertilization zebrafish embryo and can be downloaded from <uri xlink:href="https://db.cngb.org/stomics/zesta/download/">https://db.cngb.org/stomics/zesta/download/</uri>. The 10x Visium mouse brain coronal data set is accessible through <uri xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets/1.1.0/V1_Adult_Mouse_Brain">https://support.10xgenomics.com/spatial-gene-expression/datasets/1.1.0/V1_Adult_Mouse_Brain</uri>. The Stereo-seq mouse brain data set (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) can be downloaded from <uri xlink:href="https://db.cngb.org/stomics/mosta/download">https://db.cngb.org/stomics/mosta/download</uri>. The scRNA-seq mouse primary visual cortex data set was obtained from the NCBI Gene Expression Omnibus (GEO; <uri xlink:href="https://www.ncbi.nlm.nih.gov/geo/">https://www.ncbi.nlm.nih.gov/geo/</uri>) under accession number GSE71585.</p>
    </sec>
    <sec id="s3i">
      <title>Software availability</title>
      <p>The PAST algorithm is implemented in Python and the source code for reproduction is available at GitHub (<uri xlink:href="https://github.com/lizhen18THU/PAST">https://github.com/lizhen18THU/PAST</uri>) and <xref rid="SD9" ref-type="supplementary-material">Supplemental Code</xref>. We also provided detailed documentation and step-by-step tutorials for applying PAST to ST data generated by different technologies at Read the Docs website (<uri xlink:href="https://past.readthedocs.io/en/latest">https://past.readthedocs.io/en/latest</uri>).</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM1">
    <title>Supplementary Material</title>
    <supplementary-material id="SD1" position="float" content-type="local-data">
      <label>Supplement 1</label>
      <media xlink:href="Supplemental_Table_S1.xlsx" id="d64e3065" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD2" position="float" content-type="local-data">
      <label>Supplement 2</label>
      <media xlink:href="Supplemental_Table_S2.xlsx" id="d64e3068" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD3" position="float" content-type="local-data">
      <label>Supplement 3</label>
      <media xlink:href="Supplemental_Table_S3.xlsx" id="d64e3071" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD4" position="float" content-type="local-data">
      <label>Supplement 4</label>
      <media xlink:href="Supplemental_Table_S4.xlsx" id="d64e3074" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD5" position="float" content-type="local-data">
      <label>Supplement 5</label>
      <media xlink:href="Supplemental_Table_S5.xlsx" id="d64e3077" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD6" position="float" content-type="local-data">
      <label>Supplement 6</label>
      <media xlink:href="Supplemental_Table_S6.xlsx" id="d64e3080" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD7" position="float" content-type="local-data">
      <label>Supplement 7</label>
      <media xlink:href="Supplemental_Table_S7.xlsx" id="d64e3083" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD8" position="float" content-type="local-data">
      <label>Supplement 8</label>
      <media xlink:href="Supplemental_Table_S8.xlsx" id="d64e3086" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD9" position="float" content-type="local-data">
      <label>Supplement 9</label>
      <media xlink:href="Supplemental_Code.zip" id="d64e3089" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD10" position="float" content-type="local-data">
      <label>Supplement 10</label>
      <media xlink:href="Supplemental_Materials.pdf" id="d64e3092" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>This work was supported by the National Key Research and Development Program of China Grant No. 2021YFF1200902 (R.J.), the National Natural Science Foundation of China Grants No. 62203236 (S.C.), No. 62273194 (R.J.), No. 61721003 (X.Z.), and the Fundamental Research Funds for the Central Universities, Nankai University, Grant No. 63231137 (S.C.).</p>
    <p><italic>Author contributions:</italic> S.C. conceived the study and supervised the project. Z.L. and S.C. designed, implemented, and validated PAST. X.C. and X.Z. helped with analyzing the results. S.C., Z.L., X.Z., and R.J. wrote the manuscript, with input from all the authors.</p>
  </ack>
  <fn-group>
    <fn fn-type="supplementary-material">
      <p>[Supplemental material is available for this article.]</p>
    </fn>
    <fn>
      <p>Article published online before print. Article, supplemental material, and publication date are at <ext-link xlink:href="https://www.genome.org/cgi/doi/10.1101/gr.277891.123" ext-link-type="uri">https://www.genome.org/cgi/doi/10.1101/gr.277891.123</ext-link>.</p>
    </fn>
    <fn>
      <p>Freely available online through the <italic>Genome Research</italic> Open Access option.</p>
    </fn>
  </fn-group>
  <sec id="s5">
    <title>Competing interest statement</title>
    <p>The authors declare no competing interests.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="GR277891LIC1">
      <mixed-citation publication-type="journal"><string-name><surname>Abdelaal</surname><given-names>T</given-names></string-name>, <string-name><surname>Michielsen</surname><given-names>L</given-names></string-name>, <string-name><surname>Cats</surname><given-names>D</given-names></string-name>, <string-name><surname>Hoogduin</surname><given-names>D</given-names></string-name>, <string-name><surname>Mei</surname><given-names>H</given-names></string-name>, <string-name><surname>Reinders</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Mahfouz</surname><given-names>A</given-names></string-name>. <year>2019</year>. <article-title>A comparison of automatic cell identification methods for single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><volume>20</volume>: <fpage>194</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-019-1795-z</pub-id><pub-id pub-id-type="pmid">31500660</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC2">
      <mixed-citation publication-type="journal"><string-name><surname>Agirman</surname><given-names>G</given-names></string-name>, <string-name><surname>Broix</surname><given-names>L</given-names></string-name>, <string-name><surname>Nguyen</surname><given-names>L</given-names></string-name>. <year>2017</year>. <article-title>Cerebral cortex development: An outside-in perspective</article-title>. <source>FEBS Lett</source><volume>591</volume>: <fpage>3978</fpage>–<lpage>3992</lpage>. <pub-id pub-id-type="doi">10.1002/1873-3468.12924</pub-id><pub-id pub-id-type="pmid">29194577</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC3">
      <mixed-citation publication-type="journal"><string-name><surname>Armingol</surname><given-names>E</given-names></string-name>, <string-name><surname>Officer</surname><given-names>A</given-names></string-name>, <string-name><surname>Harismendy</surname><given-names>O</given-names></string-name>, <string-name><surname>Lewis</surname><given-names>NE</given-names></string-name>. <year>2021</year>. <article-title>Deciphering cell–cell interactions and communication from gene expression</article-title>. <source>Nat Rev Genet</source><volume>22</volume>: <fpage>71</fpage>–<lpage>88</lpage>. <pub-id pub-id-type="doi">10.1038/s41576-020-00292-x</pub-id><pub-id pub-id-type="pmid">33168968</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC4">
      <mixed-citation publication-type="journal"><string-name><surname>Asp</surname><given-names>M</given-names></string-name>, <string-name><surname>Bergenstråhle</surname><given-names>J</given-names></string-name>, <string-name><surname>Lundeberg</surname><given-names>J</given-names></string-name>. <year>2020</year>. <article-title>Spatially resolved transcriptomes—next generation tools for tissue exploration</article-title>. <source>Bioessays</source><volume>42</volume>: <fpage>1900221</fpage>. <pub-id pub-id-type="doi">10.1002/bies.201900221</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC5">
      <mixed-citation publication-type="confproc"><string-name><surname>Bai</surname><given-names>J</given-names></string-name>, <string-name><surname>Ren</surname><given-names>Y</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>Ripple walk training: a subgraph-based training framework for large and deep graph neural network</article-title>. In <conf-name>International Joint Conference on Neural Networks</conf-name>. <comment>IEEE, Shenzhen</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC6">
      <mixed-citation publication-type="journal"><string-name><surname>Bitar</surname><given-names>M</given-names></string-name>, <string-name><surname>Weissleder</surname><given-names>C</given-names></string-name>, <string-name><surname>North</surname><given-names>HF</given-names></string-name>, <string-name><surname>Clearwater</surname><given-names>MS</given-names></string-name>, <string-name><surname>Zalucki</surname><given-names>O</given-names></string-name>, <string-name><surname>Halliday</surname><given-names>GM</given-names></string-name>, <string-name><surname>Webster</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Piper</surname><given-names>M</given-names></string-name>, <string-name><surname>Weickert</surname><given-names>CS</given-names></string-name>, <string-name><surname>Barry</surname><given-names>G</given-names></string-name>. <year>2022</year>. <article-title>Identifying gene expression profiles associated with neurogenesis and inflammation in the human subependymal zone from development through aging</article-title>. <source>Sci Rep</source><volume>12</volume>: <fpage>40</fpage>. <pub-id pub-id-type="doi">10.1038/s41598-021-03976-4</pub-id><pub-id pub-id-type="pmid">34997023</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC7">
      <mixed-citation publication-type="confproc"><string-name><surname>Blundell</surname><given-names>C</given-names></string-name>, <string-name><surname>Cornebise</surname><given-names>J</given-names></string-name>, <string-name><surname>Kavukcuoglu</surname><given-names>K</given-names></string-name>, <string-name><surname>Wierstra</surname><given-names>D</given-names></string-name>. <year>2015</year>. <article-title>Weight</article-title><article-title>uncertainty in neural network</article-title>. In <conf-name>International Conference on Machine Learning</conf-name>. <comment>PMLR, Lille</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC8">
      <mixed-citation publication-type="journal"><string-name><surname>Chang</surname><given-names>Y-T</given-names></string-name>, <string-name><surname>Tsai</surname><given-names>W-C</given-names></string-name>, <string-name><surname>Lin</surname><given-names>W-Z</given-names></string-name>, <string-name><surname>Wu</surname><given-names>C-C</given-names></string-name>, <string-name><surname>Yu</surname><given-names>J-C</given-names></string-name>, <string-name><surname>Tseng</surname><given-names>VS</given-names></string-name>, <string-name><surname>Liao</surname><given-names>G-S</given-names></string-name>, <string-name><surname>Hu</surname><given-names>J-M</given-names></string-name>, <string-name><surname>Hsu</surname><given-names>H-M</given-names></string-name>, <string-name><surname>Chang</surname><given-names>Y-J</given-names></string-name>. <year>2021</year>. <article-title>A novel IGLC2 gene linked with prognosis of triple-negative breast cancer</article-title>. <source>Front Oncol</source><volume>11</volume>: <fpage>759952</fpage>. <pub-id pub-id-type="doi">10.3389/fonc.2021.759952</pub-id><pub-id pub-id-type="pmid">35155184</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC9">
      <mixed-citation publication-type="journal"><string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Yan</surname><given-names>G</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>W</given-names></string-name>, <string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>R</given-names></string-name>, <string-name><surname>Lin</surname><given-names>Z</given-names></string-name>. <year>2021</year>. <article-title>RA3 is a reference-guided approach for epigenetic characterization of single cells</article-title>. <source>Nat Commun</source><volume>12</volume>: <fpage>2177</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-021-22495-4</pub-id><pub-id pub-id-type="pmid">33846355</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC10">
      <mixed-citation publication-type="journal"><string-name><surname>Chen</surname><given-names>A</given-names></string-name>, <string-name><surname>Liao</surname><given-names>S</given-names></string-name>, <string-name><surname>Cheng</surname><given-names>M</given-names></string-name>, <string-name><surname>Ma</surname><given-names>K</given-names></string-name>, <string-name><surname>Wu</surname><given-names>L</given-names></string-name>, <string-name><surname>Lai</surname><given-names>Y</given-names></string-name>, <string-name><surname>Qiu</surname><given-names>X</given-names></string-name>, <string-name><surname>Yang</surname><given-names>J</given-names></string-name>, <string-name><surname>Xu</surname><given-names>J</given-names></string-name>, <string-name><surname>Hao</surname><given-names>S</given-names></string-name>, <etal/><year>2022a</year>. <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>. <source>Cell</source><volume>185</volume>: <fpage>1777</fpage>–<lpage>1792.e21</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2022.04.003</pub-id><pub-id pub-id-type="pmid">35512705</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC11">
      <mixed-citation publication-type="journal"><string-name><surname>Chen</surname><given-names>X</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Song</surname><given-names>S</given-names></string-name>, <string-name><surname>Gao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Hou</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>X</given-names></string-name>, <string-name><surname>Lv</surname><given-names>H</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>R</given-names></string-name>. <year>2022b</year>. <article-title>Cell type annotation of single-cell chromatin accessibility data via supervised Bayesian embedding</article-title>. <source>Nat Mach Intell</source><volume>4</volume>: <fpage>116</fpage>–<lpage>126</lpage>. <pub-id pub-id-type="doi">10.1038/s42256-021-00432-w</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC12">
      <mixed-citation publication-type="journal"><string-name><surname>Cheng</surname><given-names>A</given-names></string-name>, <string-name><surname>Hu</surname><given-names>G</given-names></string-name>, <string-name><surname>Li</surname><given-names>WV</given-names></string-name>. <year>2022</year>. <article-title>Benchmarking cell-type clustering methods for spatially resolved transcriptomics data</article-title>. <source>Brief Bioinform</source><volume>24</volume>: <fpage>bbac475</fpage>. <pub-id pub-id-type="doi">10.1093/bib/bbac475</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC13">
      <mixed-citation publication-type="journal"><string-name><surname>Codeluppi</surname><given-names>S</given-names></string-name>, <string-name><surname>Borm</surname><given-names>LE</given-names></string-name>, <string-name><surname>Zeisel</surname><given-names>A</given-names></string-name>, <string-name><surname>La Manno</surname><given-names>G</given-names></string-name>, <string-name><surname>van Lunteren</surname><given-names>JA</given-names></string-name>, <string-name><surname>Svensson</surname><given-names>CI</given-names></string-name>, <string-name><surname>Linnarsson</surname><given-names>S</given-names></string-name>. <year>2018</year>. <article-title>Spatial organization of the somatosensory cortex revealed by osmFISH</article-title>. <source>Nat Methods</source><volume>15</volume>: <fpage>932</fpage>–<lpage>935</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-018-0175-z</pub-id><pub-id pub-id-type="pmid">30377364</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC14">
      <mixed-citation publication-type="journal"><string-name><surname>Crosetto</surname><given-names>N</given-names></string-name>, <string-name><surname>Bienko</surname><given-names>M</given-names></string-name>, <string-name><surname>Van Oudenaarden</surname><given-names>A</given-names></string-name>. <year>2015</year>. <article-title>Spatially resolved transcriptomics and beyond</article-title>. <source>Nat Rev Genet</source><volume>16</volume>: <fpage>57</fpage>–<lpage>66</lpage>. <pub-id pub-id-type="doi">10.1038/nrg3832</pub-id><pub-id pub-id-type="pmid">25446315</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC15">
      <mixed-citation publication-type="journal"><string-name><surname>Deng</surname><given-names>Y</given-names></string-name>, <string-name><surname>Bartosovic</surname><given-names>M</given-names></string-name>, <string-name><surname>Ma</surname><given-names>S</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>D</given-names></string-name>, <string-name><surname>Kukanja</surname><given-names>P</given-names></string-name>, <string-name><surname>Xiao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Su</surname><given-names>G</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Qin</surname><given-names>X</given-names></string-name>, <string-name><surname>Rosoklija</surname><given-names>GB</given-names></string-name>, <etal/><year>2022</year>. <article-title>Spatial profiling of chromatin accessibility in mouse and human tissues</article-title>. <source>Nature</source><volume>609</volume>: <fpage>375</fpage>–<lpage>383</lpage>. <pub-id pub-id-type="doi">10.1038/s41586-022-05094-1</pub-id><pub-id pub-id-type="pmid">35978191</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC16">
      <mixed-citation publication-type="journal"><string-name><surname>Dong</surname><given-names>K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>S</given-names></string-name>. <year>2022</year>. <article-title>Deciphering spatial domains from spatially resolved transcriptomics with an adaptive graph attention autoencoder</article-title>. <source>Nat Commun</source><volume>13</volume>: <fpage>1739</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-022-29439-6</pub-id><pub-id pub-id-type="pmid">35365632</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC17">
      <mixed-citation publication-type="journal"><string-name><surname>Dries</surname><given-names>R</given-names></string-name>, <string-name><surname>Chen</surname><given-names>J</given-names></string-name>, <string-name><surname>Del Rossi</surname><given-names>N</given-names></string-name>, <string-name><surname>Khan</surname><given-names>MM</given-names></string-name>, <string-name><surname>Sistig</surname><given-names>A</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>G-C</given-names></string-name>. <year>2021</year>. <article-title>Advances in spatial transcriptomic data analysis</article-title>. <source>Genome Res</source><volume>31</volume>: <fpage>1706</fpage>–<lpage>1718</lpage>. <pub-id pub-id-type="doi">10.1101/gr.275224.121</pub-id><pub-id pub-id-type="pmid">34599004</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC18">
      <mixed-citation publication-type="journal"><string-name><surname>Fan</surname><given-names>Z</given-names></string-name>, <string-name><surname>Chen</surname><given-names>R</given-names></string-name>, <string-name><surname>Chen</surname><given-names>X</given-names></string-name>. <year>2020</year>. <article-title>SpatialDB: a database for spatially resolved transcriptomes</article-title>. <source>Nucleic Acids Res</source><volume>48</volume>: <fpage>D233</fpage>–<lpage>D237</lpage>. <pub-id pub-id-type="doi">10.1093/nar/gkz934</pub-id><pub-id pub-id-type="pmid">31713629</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC19">
      <mixed-citation publication-type="journal"><string-name><surname>Friess</surname><given-names>C</given-names></string-name>, <string-name><surname>Gotz</surname><given-names>M</given-names></string-name>, <string-name><surname>Kjell</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>Cryo-section dissection of the adult subependymal zone for accurate and deep quantitative proteome analysis</article-title>. <source>J Vis Exp</source><comment><bold>176:</bold> e63047</comment>. <pub-id pub-id-type="doi">10.3791/63047</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC20">
      <mixed-citation publication-type="other"><string-name><surname>Fu</surname><given-names>H</given-names></string-name>, <string-name><surname>Xu</surname><given-names>H</given-names></string-name>, <string-name><surname>Chong</surname><given-names>K</given-names></string-name>, <string-name><surname>Li</surname><given-names>M</given-names></string-name>, <string-name><surname>Ang</surname><given-names>KS</given-names></string-name>, <string-name><surname>Lee</surname><given-names>HK</given-names></string-name>, <string-name><surname>Ling</surname><given-names>J</given-names></string-name>, <string-name><surname>Chen</surname><given-names>A</given-names></string-name>, <string-name><surname>Shao</surname><given-names>L</given-names></string-name>, <string-name><surname>Liu</surname><given-names>L</given-names></string-name>. <year>2021</year>. <article-title>Unsupervised spatially embedded deep representation of spatial transcriptomics</article-title>. <source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2021.06.15.448542</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC21">
      <mixed-citation publication-type="other"><string-name><surname>Gao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Chen</surname><given-names>X</given-names></string-name>, <string-name><surname>Li</surname><given-names>Z</given-names></string-name>, <string-name><surname>Cui</surname><given-names>X</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>Q</given-names></string-name>, <string-name><surname>Li</surname><given-names>K</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>R</given-names></string-name>. <year>2023</year>. <article-title>scEpiTools: a database to comprehensively interrogate analytic tools for single-cell epigenomic data</article-title>. <source>J Genet Genomics</source><pub-id pub-id-type="doi">10.1016/j.jgg.2023.09.011</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC22">
      <mixed-citation publication-type="journal"><string-name><surname>Gilmore</surname><given-names>EC</given-names></string-name>, <string-name><surname>Herrup</surname><given-names>K</given-names></string-name>. <year>1997</year>. <article-title>Cortical development: Layers of complexity</article-title>. <source>Curr Biol</source><volume>7</volume>: <fpage>R231</fpage>–<lpage>R234</lpage>. <pub-id pub-id-type="doi">10.1016/S0960-9822(06)00108-4</pub-id><pub-id pub-id-type="pmid">9162498</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC23">
      <mixed-citation publication-type="confproc"><string-name><surname>Hadsell</surname><given-names>R</given-names></string-name>, <string-name><surname>Chopra</surname><given-names>S</given-names></string-name>, <string-name><surname>LeCun</surname><given-names>Y</given-names></string-name>. <year>2006</year>. <article-title>Dimensionality reduction by learning an invariant mapping</article-title>. In <conf-name>IEEE Computer Society Conference on Computer Vision and Pattern Recognition</conf-name>. <publisher-name>IEEE</publisher-name>, <publisher-loc>New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC24">
      <mixed-citation publication-type="journal"><string-name><surname>Haghverdi</surname><given-names>L</given-names></string-name>, <string-name><surname>Büttner</surname><given-names>M</given-names></string-name>, <string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Buettner</surname><given-names>F</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2016</year>. <article-title>Diffusion pseudotime robustly reconstructs lineage branching</article-title>. <source>Nat Methods</source><volume>13</volume>: <fpage>845</fpage>–<lpage>848</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.3971</pub-id><pub-id pub-id-type="pmid">27571553</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC25">
      <mixed-citation publication-type="journal"><string-name><surname>Hao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Hao</surname><given-names>S</given-names></string-name>, <string-name><surname>Andersen-Nissen</surname><given-names>E</given-names></string-name>, <string-name><surname>Mauck</surname><given-names>WM</given-names><suffix>III</suffix></string-name>, <string-name><surname>Zheng</surname><given-names>S</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Lee</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Wilk</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Darby</surname><given-names>C</given-names></string-name>, <string-name><surname>Zager</surname><given-names>M</given-names></string-name>, <etal/><year>2021</year>. <article-title>Integrated analysis of multimodal single-cell data</article-title>. <source>Cell</source><volume>184</volume>: <fpage>3573</fpage>–<lpage>3587.e29</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id><pub-id pub-id-type="pmid">34062119</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC26">
      <mixed-citation publication-type="journal"><string-name><surname>Haque</surname><given-names>A</given-names></string-name>, <string-name><surname>Engel</surname><given-names>J</given-names></string-name>, <string-name><surname>Teichmann</surname><given-names>SA</given-names></string-name>, <string-name><surname>Lönnberg</surname><given-names>T</given-names></string-name>. <year>2017</year>. <article-title>A practical guide to single-cell RNA-sequencing for biomedical research and clinical applications</article-title>. <source>Genome Med</source><volume>9</volume>: <fpage>75</fpage>. <pub-id pub-id-type="doi">10.1186/s13073-017-0467-4</pub-id><pub-id pub-id-type="pmid">28821273</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC27">
      <mixed-citation publication-type="journal"><string-name><surname>Hu</surname><given-names>J</given-names></string-name>, <string-name><surname>Li</surname><given-names>X</given-names></string-name>, <string-name><surname>Coleman</surname><given-names>K</given-names></string-name>, <string-name><surname>Schroeder</surname><given-names>A</given-names></string-name>, <string-name><surname>Ma</surname><given-names>N</given-names></string-name>, <string-name><surname>Irwin</surname><given-names>DJ</given-names></string-name>, <string-name><surname>Lee</surname><given-names>EB</given-names></string-name>, <string-name><surname>Shinohara</surname><given-names>RT</given-names></string-name>, <string-name><surname>Li</surname><given-names>M</given-names></string-name>. <year>2021a</year>. <article-title>SpaGCN: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>. <source>Nat Methods</source><volume>18</volume>: <fpage>1342</fpage>–<lpage>1351</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-021-01255-8</pub-id><pub-id pub-id-type="pmid">34711970</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC28">
      <mixed-citation publication-type="journal"><string-name><surname>Hu</surname><given-names>J</given-names></string-name>, <string-name><surname>Schroeder</surname><given-names>A</given-names></string-name>, <string-name><surname>Coleman</surname><given-names>K</given-names></string-name>, <string-name><surname>Chen</surname><given-names>C</given-names></string-name>, <string-name><surname>Auerbach</surname><given-names>BJ</given-names></string-name>, <string-name><surname>Li</surname><given-names>M</given-names></string-name>. <year>2021b</year>. <article-title>Statistical and machine learning methods for spatially resolved transcriptomics with histology</article-title>. <source>Comput Struct Biotechnol J</source><volume>19</volume>: <fpage>3829</fpage>–<lpage>3841</lpage>. <pub-id pub-id-type="doi">10.1016/j.csbj.2021.06.052</pub-id><pub-id pub-id-type="pmid">34285782</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC29">
      <mixed-citation publication-type="journal"><string-name><surname>Jiang</surname><given-names>R</given-names></string-name>, <string-name><surname>Li</surname><given-names>Z</given-names></string-name>, <string-name><surname>Jia</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>S</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>. <year>2023</year>. <article-title>SINFONIA: Scalable identification of spatially variable genes for deciphering spatial domains</article-title>. <source>Cells</source><volume>12</volume>: <fpage>604</fpage>. <pub-id pub-id-type="doi">10.3390/cells12040604</pub-id><pub-id pub-id-type="pmid">36831270</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC30">
      <mixed-citation publication-type="journal"><string-name><surname>Kazanis</surname><given-names>I</given-names></string-name>. <year>2009</year>. <article-title>The subependymal zone neurogenic niche: a beating heart in the centre of the brain: How plastic is adult neurogenesis? Opportunities for therapy and questions to be addressed</article-title>. <source>Brain</source><volume>132</volume>: <fpage>2909</fpage>–<lpage>2921</lpage>. <pub-id pub-id-type="doi">10.1093/brain/awp237</pub-id><pub-id pub-id-type="pmid">19773354</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC31">
      <mixed-citation publication-type="book"><string-name><surname>Kingma</surname><given-names>DP</given-names></string-name>, <string-name><surname>Welling</surname><given-names>M</given-names></string-name>. <year>2014</year>. <article-title>Auto-encoding variational Bayes</article-title>. In <source>International Conference on Learning Representations</source>, <publisher-name>ICLR</publisher-name>, <publisher-loc>Banff, Canada</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC32">
      <mixed-citation publication-type="journal"><string-name><surname>Lareau</surname><given-names>CA</given-names></string-name>, <string-name><surname>Duarte</surname><given-names>FM</given-names></string-name>, <string-name><surname>Chew</surname><given-names>JG</given-names></string-name>, <string-name><surname>Kartha</surname><given-names>VK</given-names></string-name>, <string-name><surname>Burkett</surname><given-names>ZD</given-names></string-name>, <string-name><surname>Kohlway</surname><given-names>AS</given-names></string-name>, <string-name><surname>Pokholok</surname><given-names>D</given-names></string-name>, <string-name><surname>Aryee</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Steemers</surname><given-names>FJ</given-names></string-name>, <string-name><surname>Lebofsky</surname><given-names>R</given-names></string-name>, <etal/><year>2019</year>. <article-title>Droplet-based combinatorial indexing for massive-scale single-cell chromatin accessibility</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>916</fpage>–<lpage>924</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0147-6</pub-id><pub-id pub-id-type="pmid">31235917</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC33">
      <mixed-citation publication-type="journal"><string-name><surname>Larsson</surname><given-names>L</given-names></string-name>, <string-name><surname>Frisén</surname><given-names>J</given-names></string-name>, <string-name><surname>Lundeberg</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>Spatially resolved transcriptomics adds a new dimension to genomics</article-title>. <source>Nat Methods</source><volume>18</volume>: <fpage>15</fpage>–<lpage>18</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-020-01038-7</pub-id><pub-id pub-id-type="pmid">33408402</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC34">
      <mixed-citation publication-type="journal"><string-name><surname>Li</surname><given-names>H</given-names></string-name>, <string-name><surname>Courtois</surname><given-names>ET</given-names></string-name>, <string-name><surname>Sengupta</surname><given-names>D</given-names></string-name>, <string-name><surname>Tan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Chen</surname><given-names>KH</given-names></string-name>, <string-name><surname>Goh</surname><given-names>JJL</given-names></string-name>, <string-name><surname>Kong</surname><given-names>SL</given-names></string-name>, <string-name><surname>Chua</surname><given-names>C</given-names></string-name>, <string-name><surname>Hon</surname><given-names>LK</given-names></string-name>, <string-name><surname>Tan</surname><given-names>WS</given-names></string-name>, <etal/><year>2017</year>. <article-title>Reference component analysis of single-cell transcriptomes elucidates cellular heterogeneity in human colorectal tumors</article-title>. <source>Nat Genet</source><volume>49</volume>: <fpage>708</fpage>–<lpage>718</lpage>. <pub-id pub-id-type="doi">10.1038/ng.3818</pub-id><pub-id pub-id-type="pmid">28319088</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC35">
      <mixed-citation publication-type="journal"><string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Pan</surname><given-names>X</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Shen</surname><given-names>H-B</given-names></string-name>. <year>2022</year>. <article-title>Cell clustering for spatial transcriptomics data with graph neural networks</article-title>. <source>Nat Comput Sci</source><volume>2</volume>: <fpage>399</fpage>–<lpage>408</lpage>. <pub-id pub-id-type="doi">10.1038/s43588-022-00266-5</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC36">
      <mixed-citation publication-type="book"><string-name><surname>Liu</surname><given-names>A</given-names></string-name>, <string-name><surname>Xu</surname><given-names>N</given-names></string-name>, <string-name><surname>Liu</surname><given-names>H</given-names></string-name>. <year>2021</year>. <article-title>Self-attention graph residual convolutional networks for event detection with dependency relations</article-title>. In <source>Findings of the Association for Computational Linguistics</source>. <publisher-name>Association for Computational Linguistics</publisher-name>, <publisher-loc>Punta Cana, Dominican Republic</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC37">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>C</given-names></string-name>, <string-name><surname>Li</surname><given-names>R</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>, <string-name><surname>Lin</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>K</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Q</given-names></string-name>, <string-name><surname>Wang</surname><given-names>S</given-names></string-name>, <string-name><surname>Yang</surname><given-names>X</given-names></string-name>, <string-name><surname>Shi</surname><given-names>X</given-names></string-name>, <string-name><surname>Ma</surname><given-names>Y</given-names></string-name>, <etal/><year>2022a</year>. <article-title>Spatiotemporal mapping of gene expression landscapes and developmental trajectories during zebrafish embryogenesis</article-title>. <source>Dev Cell</source><volume>57</volume>: <fpage>1284</fpage>–<lpage>1298.e5</lpage>. <pub-id pub-id-type="doi">10.1016/j.devcel.2022.04.009</pub-id><pub-id pub-id-type="pmid">35512701</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC38">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>W</given-names></string-name>, <string-name><surname>Liao</surname><given-names>X</given-names></string-name>, <string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Lin</surname><given-names>H</given-names></string-name>, <string-name><surname>Yeong</surname><given-names>J</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>X</given-names></string-name>, <string-name><surname>Shi</surname><given-names>X</given-names></string-name>, <string-name><surname>Liu</surname><given-names>J</given-names></string-name>. <year>2022b</year>. <article-title>Joint dimension reduction and clustering analysis of single-cell RNA-seq and spatial transcriptomics data</article-title>. <source>Nucleic Acids Res</source><volume>50</volume>: <fpage>e72</fpage>. <pub-id pub-id-type="doi">10.1093/nar/gkac219</pub-id><pub-id pub-id-type="pmid">35349708</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC39">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Sun</surname><given-names>D</given-names></string-name>, <string-name><surname>Wang</surname><given-names>C</given-names></string-name>. <year>2022c</year>. <article-title>Evaluation of cell-cell interaction methods by integrating single-cell RNA sequencing data with spatial information</article-title>. <source>Genome Biol</source><volume>23</volume>: <fpage>218</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-021-02568-9</pub-id><pub-id pub-id-type="pmid">36253792</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC40">
      <mixed-citation publication-type="journal"><string-name><surname>Maynard</surname><given-names>KR</given-names></string-name>, <string-name><surname>Collado-Torres</surname><given-names>L</given-names></string-name>, <string-name><surname>Weber</surname><given-names>LM</given-names></string-name>, <string-name><surname>Uytingco</surname><given-names>C</given-names></string-name>, <string-name><surname>Barry</surname><given-names>BK</given-names></string-name>, <string-name><surname>Williams</surname><given-names>SR</given-names></string-name>, <string-name><surname>Catallini</surname><given-names>JL</given-names></string-name>, <string-name><surname>Tran</surname><given-names>MN</given-names></string-name>, <string-name><surname>Besich</surname><given-names>Z</given-names></string-name>, <string-name><surname>Tippani</surname><given-names>M</given-names></string-name>, <etal/><year>2021</year>. <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>. <source>Nat Neurosci</source><volume>24</volume>: <fpage>425</fpage>–<lpage>436</lpage>. <pub-id pub-id-type="doi">10.1038/s41593-020-00787-0</pub-id><pub-id pub-id-type="pmid">33558695</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC41">
      <mixed-citation publication-type="journal"><string-name><surname>Menn</surname><given-names>B</given-names></string-name>, <string-name><surname>Garcia-Verdugo</surname><given-names>JM</given-names></string-name>, <string-name><surname>Yaschine</surname><given-names>C</given-names></string-name>, <string-name><surname>Gonzalez-Perez</surname><given-names>O</given-names></string-name>, <string-name><surname>Rowitch</surname><given-names>D</given-names></string-name>, <string-name><surname>Alvarez-Buylla</surname><given-names>A</given-names></string-name>. <year>2006</year>. <article-title>Origin of oligodendrocytes in the subventricular zone of the adult brain</article-title>. <source>J Neurosci</source><volume>26</volume>: <fpage>7907</fpage>–<lpage>7918</lpage>. <pub-id pub-id-type="doi">10.1523/JNEUROSCI.1299-06.2006</pub-id><pub-id pub-id-type="pmid">16870736</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC42">
      <mixed-citation publication-type="journal"><string-name><surname>Moses</surname><given-names>L</given-names></string-name>, <string-name><surname>Pachter</surname><given-names>L</given-names></string-name>. <year>2022</year>. <article-title>Museum of spatial transcriptomics</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>534</fpage>–<lpage>546</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-022-01409-2</pub-id><pub-id pub-id-type="pmid">35273392</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC43">
      <mixed-citation publication-type="journal"><string-name><surname>Oxelius</surname><given-names>V-A</given-names></string-name>, <string-name><surname>Pandey</surname><given-names>JP</given-names></string-name>. <year>2013</year>. <article-title>Human immunoglobulin constant heavy G chain (IGHG) (Fcγ) (GM) genes, defining innate variants of IgG molecules and B cells, have impact on disease and therapy</article-title>. <source>Clin Immunol</source><volume>149</volume>: <fpage>475</fpage>–<lpage>486</lpage>. <pub-id pub-id-type="doi">10.1016/j.clim.2013.10.003</pub-id><pub-id pub-id-type="pmid">24239836</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC44">
      <mixed-citation publication-type="journal"><string-name><surname>Palla</surname><given-names>G</given-names></string-name>, <string-name><surname>Spitzer</surname><given-names>H</given-names></string-name>, <string-name><surname>Klein</surname><given-names>M</given-names></string-name>, <string-name><surname>Fischer</surname><given-names>D</given-names></string-name>, <string-name><surname>Schaar</surname><given-names>AC</given-names></string-name>, <string-name><surname>Kuemmerle</surname><given-names>LB</given-names></string-name>, <string-name><surname>Rybakov</surname><given-names>S</given-names></string-name>, <string-name><surname>Ibarra</surname><given-names>IL</given-names></string-name>, <string-name><surname>Holmberg</surname><given-names>O</given-names></string-name>, <string-name><surname>Virshup</surname><given-names>I</given-names></string-name>, <etal/><year>2022</year>. <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>171</fpage>–<lpage>178</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-021-01358-2</pub-id><pub-id pub-id-type="pmid">35102346</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC45">
      <mixed-citation publication-type="journal"><string-name><surname>Qiu</surname><given-names>P</given-names></string-name>. <year>2020</year>. <article-title>Embracing the dropouts in single-cell RNA-seq analysis</article-title>. <source>Nat Commun</source><volume>11</volume>: <fpage>1169</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-020-14976-9</pub-id><pub-id pub-id-type="pmid">32127540</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC46">
      <mixed-citation publication-type="journal"><string-name><surname>Raffel</surname><given-names>C</given-names></string-name>, <string-name><surname>Shazeer</surname><given-names>N</given-names></string-name>, <string-name><surname>Roberts</surname><given-names>A</given-names></string-name>, <string-name><surname>Lee</surname><given-names>K</given-names></string-name>, <string-name><surname>Narang</surname><given-names>S</given-names></string-name>, <string-name><surname>Matena</surname><given-names>M</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>W</given-names></string-name>, <string-name><surname>Liu</surname><given-names>PJ</given-names></string-name>. <year>2020</year>. <article-title>Exploring the limits of transfer learning with a unified text-to-text transformer</article-title>. <source>J Mach Learn Res</source><volume>21</volume>: <fpage>1</fpage>–<lpage>67</lpage>.<pub-id pub-id-type="pmid">34305477</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC47">
      <mixed-citation publication-type="journal"><string-name><surname>Rodriques</surname><given-names>SG</given-names></string-name>, <string-name><surname>Stickels</surname><given-names>RR</given-names></string-name>, <string-name><surname>Goeva</surname><given-names>A</given-names></string-name>, <string-name><surname>Martin</surname><given-names>CA</given-names></string-name>, <string-name><surname>Murray</surname><given-names>E</given-names></string-name>, <string-name><surname>Vanderburg</surname><given-names>CR</given-names></string-name>, <string-name><surname>Welch</surname><given-names>J</given-names></string-name>, <string-name><surname>Chen</surname><given-names>LM</given-names></string-name>, <string-name><surname>Chen</surname><given-names>F</given-names></string-name>, <string-name><surname>Macosko</surname><given-names>EZ</given-names></string-name>. <year>2019</year>. <article-title>Slide-seq: a scalable technology for measuring genome-wide expression at high spatial resolution</article-title>. <source>Science</source><volume>363</volume>: <fpage>1463</fpage>–<lpage>1467</lpage>. <pub-id pub-id-type="doi">10.1126/science.aaw1219</pub-id><pub-id pub-id-type="pmid">30923225</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC48">
      <mixed-citation publication-type="journal"><string-name><surname>Schmidt</surname><given-names>M</given-names></string-name>, <string-name><surname>Micke</surname><given-names>P</given-names></string-name>, <string-name><surname>Gehrmann</surname><given-names>M</given-names></string-name>, <string-name><surname>Hengstler</surname><given-names>JG</given-names></string-name>. <year>2012</year>. <article-title>Immunoglobulin kappa chain as an immunologic biomarker of prognosis and chemotherapy response in solid tumors</article-title>. <source>Oncoimmunology</source><volume>1</volume>: <fpage>1156</fpage>–<lpage>1158</lpage>. <pub-id pub-id-type="doi">10.4161/onci.21653</pub-id><pub-id pub-id-type="pmid">23170262</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC49">
      <mixed-citation publication-type="journal"><string-name><surname>Shang</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>X</given-names></string-name>. <year>2022</year>. <article-title>Spatially aware dimension reduction for spatial transcriptomics</article-title>. <source>Nat Commun</source><volume>13</volume>: <fpage>7203</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-022-34879-1</pub-id><pub-id pub-id-type="pmid">36418351</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC50">
      <mixed-citation publication-type="journal"><string-name><surname>Shengquan</surname><given-names>C</given-names></string-name>, <string-name><surname>Boheng</surname><given-names>Z</given-names></string-name>, <string-name><surname>Xiaoyang</surname><given-names>C</given-names></string-name>, <string-name><surname>Xuegong</surname><given-names>Z</given-names></string-name>, <string-name><surname>Rui</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>stPlus: a reference-based method for the accurate enhancement of spatial transcriptomics</article-title>. <source>Bioinformatics</source><volume>37</volume>: <fpage>i299</fpage>–<lpage>i307</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btab298</pub-id><pub-id pub-id-type="pmid">34252941</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC51">
      <mixed-citation publication-type="journal"><string-name><surname>Ståhl</surname><given-names>PL</given-names></string-name>, <string-name><surname>Salmén</surname><given-names>F</given-names></string-name>, <string-name><surname>Vickovic</surname><given-names>S</given-names></string-name>, <string-name><surname>Lundmark</surname><given-names>A</given-names></string-name>, <string-name><surname>Navarro</surname><given-names>JF</given-names></string-name>, <string-name><surname>Magnusson</surname><given-names>J</given-names></string-name>, <string-name><surname>Giacomello</surname><given-names>S</given-names></string-name>, <string-name><surname>Asp</surname><given-names>M</given-names></string-name>, <string-name><surname>Westholm</surname><given-names>JO</given-names></string-name>, <string-name><surname>Huss</surname><given-names>M</given-names></string-name>, <etal/><year>2016</year>. <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>. <source>Science</source><volume>353</volume>: <fpage>78</fpage>–<lpage>82</lpage>. <pub-id pub-id-type="doi">10.1126/science.aaf2403</pub-id><pub-id pub-id-type="pmid">27365449</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC52">
      <mixed-citation publication-type="journal"><string-name><surname>Stickels</surname><given-names>RR</given-names></string-name>, <string-name><surname>Murray</surname><given-names>E</given-names></string-name>, <string-name><surname>Kumar</surname><given-names>P</given-names></string-name>, <string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Marshall</surname><given-names>JL</given-names></string-name>, <string-name><surname>Di Bella</surname><given-names>DJ</given-names></string-name>, <string-name><surname>Arlotta</surname><given-names>P</given-names></string-name>, <string-name><surname>Macosko</surname><given-names>EZ</given-names></string-name>, <string-name><surname>Chen</surname><given-names>F</given-names></string-name>. <year>2021</year>. <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with slide-seqV2</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>313</fpage>–<lpage>319</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-020-0739-1</pub-id><pub-id pub-id-type="pmid">33288904</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC53">
      <mixed-citation publication-type="journal"><string-name><surname>Tasic</surname><given-names>B</given-names></string-name>, <string-name><surname>Menon</surname><given-names>V</given-names></string-name>, <string-name><surname>Nguyen</surname><given-names>TN</given-names></string-name>, <string-name><surname>Kim</surname><given-names>TK</given-names></string-name>, <string-name><surname>Jarsky</surname><given-names>T</given-names></string-name>, <string-name><surname>Yao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Levi</surname><given-names>B</given-names></string-name>, <string-name><surname>Gray</surname><given-names>LT</given-names></string-name>, <string-name><surname>Sorensen</surname><given-names>SA</given-names></string-name>, <string-name><surname>Dolbeare</surname><given-names>T</given-names></string-name>, <etal/><year>2016</year>. <article-title>Adult mouse cortical cell taxonomy revealed by single cell transcriptomics</article-title>. <source>Nat Neurosci</source><volume>19</volume>: <fpage>335</fpage>–<lpage>346</lpage>. <pub-id pub-id-type="doi">10.1038/nn.4216</pub-id><pub-id pub-id-type="pmid">26727548</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC54">
      <mixed-citation publication-type="journal"><string-name><surname>Townes</surname><given-names>FW</given-names></string-name>, <string-name><surname>Engelhardt</surname><given-names>BE</given-names></string-name>. <year>2023</year>. <article-title>Nonnegative spatial factorization applied to spatial genomics</article-title>. <source>Nat Methods</source><volume>20</volume>: <fpage>229</fpage>–<lpage>238</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-022-01687-w</pub-id><pub-id pub-id-type="pmid">36587187</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC55">
      <mixed-citation publication-type="confproc"><string-name><surname>Vaswani</surname><given-names>A</given-names></string-name>, <string-name><surname>Shazeer</surname><given-names>N</given-names></string-name>, <string-name><surname>Parmar</surname><given-names>N</given-names></string-name>, <string-name><surname>Uszkoreit</surname><given-names>J</given-names></string-name>, <string-name><surname>Jones</surname><given-names>L</given-names></string-name>, <string-name><surname>Gomez</surname><given-names>AN</given-names></string-name>, <string-name><surname>Kaiser</surname><given-names>Ł</given-names></string-name>, <string-name><surname>Polosukhin</surname><given-names>I</given-names></string-name>. <year>2017</year>. <article-title>Attention is all you need</article-title>. In <conf-name>Conference on Neural Information Processing Systems</conf-name>. <comment>Curran Associates, Long Beach, CA</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC56">
      <mixed-citation publication-type="journal"><string-name><surname>Vickovic</surname><given-names>S</given-names></string-name>, <string-name><surname>Eraslan</surname><given-names>G</given-names></string-name>, <string-name><surname>Salmén</surname><given-names>F</given-names></string-name>, <string-name><surname>Klughammer</surname><given-names>J</given-names></string-name>, <string-name><surname>Stenbeck</surname><given-names>L</given-names></string-name>, <string-name><surname>Schapiro</surname><given-names>D</given-names></string-name>, <string-name><surname>Äijö</surname><given-names>T</given-names></string-name>, <string-name><surname>Bonneau</surname><given-names>R</given-names></string-name>, <string-name><surname>Bergenstråhle</surname><given-names>L</given-names></string-name>, <string-name><surname>Navarro</surname><given-names>JF</given-names></string-name>, <etal/><year>2019</year>. <article-title>High-definition spatial transcriptomics for in situ tissue profiling</article-title>. <source>Nat Methods</source><volume>16</volume>: <fpage>987</fpage>–<lpage>990</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-019-0548-y</pub-id><pub-id pub-id-type="pmid">31501547</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC57">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>X</given-names></string-name>, <string-name><surname>Allen</surname><given-names>WE</given-names></string-name>, <string-name><surname>Wright</surname><given-names>MA</given-names></string-name>, <string-name><surname>Sylwestrak</surname><given-names>EL</given-names></string-name>, <string-name><surname>Samusik</surname><given-names>N</given-names></string-name>, <string-name><surname>Vesuna</surname><given-names>S</given-names></string-name>, <string-name><surname>Evans</surname><given-names>K</given-names></string-name>, <string-name><surname>Liu</surname><given-names>C</given-names></string-name>, <string-name><surname>Ramakrishnan</surname><given-names>C</given-names></string-name>, <string-name><surname>Liu</surname><given-names>J</given-names></string-name>, <etal/><year>2018</year>. <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>. <source>Science</source><volume>361</volume>: <fpage>eaat5691</fpage>. <pub-id pub-id-type="doi">10.1126/science.aat5691</pub-id><pub-id pub-id-type="pmid">29930089</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC58">
      <mixed-citation publication-type="journal"><string-name><surname>Wei</surname><given-names>X</given-names></string-name>, <string-name><surname>Fu</surname><given-names>S</given-names></string-name>, <string-name><surname>Li</surname><given-names>H</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Wang</surname><given-names>S</given-names></string-name>, <string-name><surname>Feng</surname><given-names>W</given-names></string-name>, <string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Liu</surname><given-names>X</given-names></string-name>, <string-name><surname>Zeng</surname><given-names>Y-Y</given-names></string-name>, <string-name><surname>Cheng</surname><given-names>M</given-names></string-name>, <etal/><year>2022</year>. <article-title>Single-cell stereo-seq reveals induced progenitor cells involved in axolotl brain regeneration</article-title>. <source>Science</source><volume>377</volume>: <fpage>eabp9444</fpage>. <pub-id pub-id-type="doi">10.1126/science.abp9444</pub-id><pub-id pub-id-type="pmid">36048929</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC59">
      <mixed-citation publication-type="journal"><string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Angerer</surname><given-names>P</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2018</year>. <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>. <source>Genome Biol</source><volume>19</volume>: <fpage>15</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id><pub-id pub-id-type="pmid">29409532</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC60">
      <mixed-citation publication-type="journal"><string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Hamey</surname><given-names>FK</given-names></string-name>, <string-name><surname>Plass</surname><given-names>M</given-names></string-name>, <string-name><surname>Solana</surname><given-names>J</given-names></string-name>, <string-name><surname>Dahlin</surname><given-names>JS</given-names></string-name>, <string-name><surname>Göttgens</surname><given-names>B</given-names></string-name>, <string-name><surname>Rajewsky</surname><given-names>N</given-names></string-name>, <string-name><surname>Simon</surname><given-names>L</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2019</year>. <article-title>PAGA: graph abstraction reconciles clustering with trajectory inference through a topology preserving map of single cells</article-title>. <source>Genome Biol</source><volume>20</volume>: <fpage>59</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-019-1663-x</pub-id><pub-id pub-id-type="pmid">30890159</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC61">
      <mixed-citation publication-type="other"><string-name><surname>Xu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Wang</surname><given-names>W</given-names></string-name>, <string-name><surname>Yang</surname><given-names>T</given-names></string-name>, <string-name><surname>Chen</surname><given-names>J</given-names></string-name>, <string-name><surname>Huang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Gould</surname><given-names>J</given-names></string-name>, <string-name><surname>Du</surname><given-names>W</given-names></string-name>, <string-name><surname>Yang</surname><given-names>F</given-names></string-name>, <string-name><surname>Li</surname><given-names>L</given-names></string-name>, <string-name><surname>Lai</surname><given-names>T</given-names></string-name>, <etal/><year>2022</year>. <article-title>STOmicsDB: a database of spatial transcriptomic data</article-title>. <source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2022.03.11.481421</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC62">
      <mixed-citation publication-type="journal"><string-name><surname>Yuan</surname><given-names>Z</given-names></string-name>, <string-name><surname>Pan</surname><given-names>W</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>F</given-names></string-name>, <string-name><surname>Xu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Li</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>MQ</given-names></string-name>, <string-name><surname>Yao</surname><given-names>J</given-names></string-name>. <year>2023</year>. <article-title>SODB facilitates comprehensive exploration of spatial omics data</article-title>. <source>Nat Methods</source><volume>20</volume>: <fpage>387</fpage>–<lpage>399</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-023-01773-7</pub-id><pub-id pub-id-type="pmid">36797409</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC63">
      <mixed-citation publication-type="journal"><string-name><surname>Zeira</surname><given-names>R</given-names></string-name>, <string-name><surname>Land</surname><given-names>M</given-names></string-name>, <string-name><surname>Strzalkowski</surname><given-names>A</given-names></string-name>, <string-name><surname>Raphael</surname><given-names>BJ</given-names></string-name>. <year>2022</year>. <article-title>Alignment and integration of spatial transcriptomics data</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>567</fpage>–<lpage>575</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-022-01459-6</pub-id><pub-id pub-id-type="pmid">35577957</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC64">
      <mixed-citation publication-type="journal"><string-name><surname>Zeng</surname><given-names>Z</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>, <string-name><surname>Luo</surname><given-names>Y</given-names></string-name>. <year>2022</year>. <article-title>Statistical and machine learning methods for spatially resolved transcriptomics data analysis</article-title>. <source>Genome Biol</source><volume>23</volume>: <fpage>83</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-022-02653-7</pub-id><pub-id pub-id-type="pmid">35337374</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC65">
      <mixed-citation publication-type="other"><string-name><surname>Zhang</surname><given-names>J</given-names></string-name>, <string-name><surname>Meng</surname><given-names>L</given-names></string-name>. <year>2019</year>. <article-title>GResNet: graph residual network for reviving deep GNNs from suspended animation</article-title>. <italic>arXiv</italic>:<comment>1909.05729 [cs.LG]</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC66">
      <mixed-citation publication-type="journal"><string-name><surname>Zhao</surname><given-names>E</given-names></string-name>, <string-name><surname>Stone</surname><given-names>MR</given-names></string-name>, <string-name><surname>Ren</surname><given-names>X</given-names></string-name>, <string-name><surname>Guenthoer</surname><given-names>J</given-names></string-name>, <string-name><surname>Smythe</surname><given-names>KS</given-names></string-name>, <string-name><surname>Pulliam</surname><given-names>T</given-names></string-name>, <string-name><surname>Williams</surname><given-names>SR</given-names></string-name>, <string-name><surname>Uytingco</surname><given-names>CR</given-names></string-name>, <string-name><surname>Taylor</surname><given-names>SE</given-names></string-name>, <string-name><surname>Nghiem</surname><given-names>P</given-names></string-name>, <etal/><year>2021</year>. <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>1375</fpage>–<lpage>1384</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-021-00935-2</pub-id><pub-id pub-id-type="pmid">34083791</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC67">
      <mixed-citation publication-type="journal"><string-name><surname>Zhuang</surname><given-names>X</given-names></string-name>. <year>2021</year>. <article-title>Spatially resolved single-cell genomics and transcriptomics by imaging</article-title>. <source>Nat Methods</source><volume>18</volume>: <fpage>18</fpage>–<lpage>22</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-020-01037-8</pub-id><pub-id pub-id-type="pmid">33408406</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.0 20120330//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Res</journal-id>
    <journal-id journal-id-type="hwp">genome</journal-id>
    <journal-id journal-id-type="publisher-id">GENOME</journal-id>
    <journal-title-group>
      <journal-title>Genome Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1088-9051</issn>
    <issn pub-type="epub">1549-5469</issn>
    <publisher>
      <publisher-name>Cold Spring Harbor Laboratory Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10691543</article-id>
    <article-id pub-id-type="pmid">37903634</article-id>
    <article-id pub-id-type="medline">9509184</article-id>
    <article-id pub-id-type="doi">10.1101/gr.277891.123</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methods</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Latent feature extraction with a prior-based self-attention framework for spatial transcriptomics</article-title>
      <alt-title alt-title-type="left-running">Li et al.</alt-title>
      <alt-title alt-title-type="right-running">Embedding method for spatial transcriptomics</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Zhen</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chen</surname>
          <given-names>Xiaoyang</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9684-5643</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Xuegong</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jiang</surname>
          <given-names>Rui</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Chen</surname>
          <given-names>Shengquan</given-names>
        </name>
        <xref rid="af2" ref-type="aff">2</xref>
      </contrib>
    </contrib-group>
    <aff id="af1"><label>1</label>Ministry of Education Key Laboratory of Bioinformatics, Bioinformatics Division at the Beijing National Research Center for Information Science and Technology, Center for Synthetic and Systems Biology, Department of Automation, Tsinghua University, Beijing 100084, China;</aff>
    <aff id="af2"><label>2</label>School of Mathematical Sciences and LPMC, Nankai University, Tianjin 300071, China</aff>
    <author-notes>
      <corresp>Corresponding author: <email>chenshengquan@nankai.edu.cn</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>10</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <month>10</month>
      <year>2023</year>
    </pub-date>
    <volume>33</volume>
    <issue>10</issue>
    <fpage>1757</fpage>
    <lpage>1773</lpage>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>3</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>19</day>
        <month>9</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>
        <ext-link xlink:href="http://genome.cshlp.org/site/misc/terms.xhtml" ext-link-type="uri">© 2023 Li et al.; Published by Cold Spring Harbor Laboratory Press</ext-link>
      </copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This article, published in <italic>Genome Research</italic>, is available under a Creative Commons License (Attribution-NonCommercial 4.0 International), as described at <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="1757.pdf"/>
    <abstract>
      <p>Rapid advances in spatial transcriptomics (ST) have revolutionized the interrogation of spatial heterogeneity and increase the demand for comprehensive methods to effectively characterize spatial domains. As a prerequisite for ST data analysis, spatial domain characterization is a crucial step for downstream analyses and biological implications. Here we propose a prior-based self-attention framework for spatial transcriptomics (PAST), a variational graph convolutional autoencoder for ST, which effectively integrates prior information via a Bayesian neural network, captures spatial patterns via a self-attention mechanism, and enables scalable application via a ripple walk sampler strategy. Through comprehensive experiments on data sets generated by different technologies, we show that PAST can effectively characterize spatial domains and facilitate various downstream analyses, including ST visualization, spatial trajectory inference and pseudotime analysis. Also, we highlight the advantages of PAST for multislice joint embedding and automatic annotation of spatial domains in newly sequenced ST data. Compared with existing methods, PAST is the first ST method that integrates reference data to analyze ST data. We anticipate that PAST will open up new avenues for researchers to decipher ST data with customized reference data, which expands the applicability of ST technology.</p>
    </abstract>
    <funding-group>
      <award-group id="funding-1">
        <funding-source>National Key Research and Development Program of China</funding-source>
        <award-id>2021YFF1200902</award-id>
      </award-group>
      <award-group id="funding-2">
        <funding-source>
          <institution-wrap>
            <institution>National Natural Science Foundation of China </institution>
            <institution-id institution-id-type="doi">10.13039/501100001809</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>62203236</award-id>
        <award-id>62273194</award-id>
        <award-id>61721003</award-id>
      </award-group>
      <award-group id="funding-3">
        <funding-source>
          <institution-wrap>
            <institution>Central Universities, Nankai University </institution>
            <institution-id institution-id-type="doi">10.13039/501100004945</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>63231137</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="17"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>Recent innovations in spatially resolved transcriptomics grant us a novel perspective on the cellular transcriptome, and hence have stimulated efforts to unravel cell transcriptomes in the context of cellular organizations and catalyze new discoveries in different areas of biological research (<xref rid="GR277891LIC14" ref-type="bibr">Crosetto et al. 2015</xref>; <xref rid="GR277891LIC17" ref-type="bibr">Dries et al. 2021</xref>; <xref rid="GR277891LIC33" ref-type="bibr">Larsson et al. 2021</xref>; <xref rid="GR277891LIC67" ref-type="bibr">Zhuang 2021</xref>; <xref rid="GR277891LIC42" ref-type="bibr">Moses and Pachter 2022</xref>). Advanced spatial transcriptomic (ST) techniques, including Visium (10x Genomics), Slide-seq (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>), and Stereo-seq (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>), could print spatially barcoded and oligo(dT) probes as microarrays of spots on the surface of glass slides, measuring genome-wide expression levels in captured locations, referred to as spots. When performing exploratory analysis of ST data, one of the most critical steps is characterizing spatial domains, which display spatially organized and functionally distinct anatomical structures on tissues. Nevertheless, low capture efficiency is one of the key reasons for high dropouts in single-cell RNA sequencing, leading to sparse and noisy data (<xref rid="GR277891LIC26" ref-type="bibr">Haque et al. 2017</xref>; <xref rid="GR277891LIC45" ref-type="bibr">Qiu 2020</xref>), and the limitations are also inherited by spatial transcriptomics data, making characterizing ST data computationally challenging (<xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). Also, ST data usually represents substantial spatial correlation across tissues, requiring advanced approaches to take spatial localization information into account (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>; <xref rid="GR277891LIC29" ref-type="bibr">Jiang et al. 2023</xref>).</p>
  <p>Several computational methods have been proposed to analyze ST data (<xref rid="GR277891LIC17" ref-type="bibr">Dries et al. 2021</xref>; <xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). BayesSpace performs spatial clustering via modeling the spatial correlation of gene profiles between neighboring spots (<xref rid="GR277891LIC66" ref-type="bibr">Zhao et al. 2021</xref>). SpaGCN identifies spatial domains by integrating gene expression, spatial location and histology through the construction of an undirected weighted graph (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>). CCST is an unsupervised cell clustering method based on graph neural networks for ST data (<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>). STAGATE integrates spatial information and gene profiles with an adaptive graph attention autoencoder to learn low-dimensional embeddings (<xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>). DR-SC uses a hidden Markov random field to perform dimension reduction and spatial clustering within a unified framework (<xref rid="GR277891LIC38" ref-type="bibr">Liu et al. 2022b</xref>). Non-negative spatial factorization (NSF) is a spatially aware probabilistic dimension reduction method which assumes an exponentiated Gaussian process prior over the spatial locations (<xref rid="GR277891LIC54" ref-type="bibr">Townes and Engelhardt 2023</xref>). SpatialPCA integrates localization information with a kernel matrix and performs spatial-aware principle component analysis (PCA) for ST data (<xref rid="GR277891LIC49" ref-type="bibr">Shang and Zhou 2022</xref>). Also, SCANPY and Seurat, two widely-used single-cell analysis workflows in the Python and R communities, respectively, also provide vignettes tailored for ST data analysis (<xref rid="GR277891LIC59" ref-type="bibr">Wolf et al. 2018</xref>; <xref rid="GR277891LIC25" ref-type="bibr">Hao et al. 2021</xref>).</p>
  <p>However, effective approaches for characterizing spatial domains in ST data need to overcome several challenges. First, existing methods failed to incorporate prior information from reference data to facilitate ST data analysis. Incorporating prior information in analyzing single-cell genomic data can better tackle the high level of noise and technical variation, and has been successfully applied in the analysis of various single-cell genomic data (<xref rid="GR277891LIC34" ref-type="bibr">Li et al. 2017</xref>; <xref rid="GR277891LIC32" ref-type="bibr">Lareau et al. 2019</xref>; <xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>; <xref rid="GR277891LIC50" ref-type="bibr">Shengquan et al. 2021</xref>). With the advanced technologies, massive amounts of ST data have been generated by consortiums or individual research groups (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>; <xref rid="GR277891LIC56" ref-type="bibr">Vickovic et al. 2019</xref>; <xref rid="GR277891LIC52" ref-type="bibr">Stickels et al. 2021</xref>) and accumulated in repositories and databases (<xref rid="GR277891LIC18" ref-type="bibr">Fan et al. 2020</xref>; <xref rid="GR277891LIC42" ref-type="bibr">Moses and Pachter 2022</xref>; <xref rid="GR277891LIC61" ref-type="bibr">Xu et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>; <xref rid="GR277891LIC62" ref-type="bibr">Yuan et al. 2023</xref>), paving the way to taking full advantage of the existing data and leveraging the data as reference to characterize spatial domains. Second, local spatial patterns should be effectively captured. Although it has been observed that aggregating information from each spot's neighbors via a graph convolutional network (GCN) is a promising approach to identify localized gene expression patterns (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>; <xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>), tailored model design for better characterization of local spatial patterns is still demanded (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>). Third, global spatial patterns should be carefully preserved. With the exponential growth of profiled spots and genes, the graph-based approach becomes cumbersome and time-consuming, requiring strategies that perform memory and time-efficient minibatch training and prediction while preserving global spatial patterns. Fourth, there is an emerging need for the automatic annotation of spatial domains, because advanced protocols constantly increase sequencing throughput, and the typical approach, which performs unsupervised spatial clustering and then assigns the putative domain to each cluster subjectively, would be cumbersome and irreproducible for large-scale ST data.</p>
  <p>To this end, we propose PAST, a <underline>P</underline>rior-based self-<underline>A</underline>ttention framework for <underline>S</underline>patial <underline>T</underline>ranscriptomics, which incorporates the graph residual network (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>; <xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to effectively characterize spatial domains. PAST is a variational graph convolutional autoencoder, and uses a Bayesian neural network (BNN) (<xref rid="GR277891LIC7" ref-type="bibr">Blundell et al. 2015</xref>) to incorporate prior information from reference data, self-attention mechanism (<xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to capture spatial patterns, and a ripple walk sampler (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>) to enable scalable subgraph-based training and prediction. Featured as the first ST method which integrates reference data from various sources, PAST aims to extract latent embeddings of ST data in a self-supervised manner. The latent embeddings obtained from PAST contain valuable spatial correlation patterns and can be directly fed into existing scRNA-seq computational tools for effective and novel downstream analyses.</p>
  <sec sec-type="results" id="s1">
    <title>Results</title>
    <sec id="s1a">
      <title>Overview of PAST</title>
      <p>PAST is a self-supervised representation learning model based on a framework of variational graph convolutional autoencoder, taking transcriptomic profiles and spatial coordinates of the target ST data and transcriptomic profiles of the reference data as input. As shown in <xref rid="GR277891LIF1" ref-type="fig">Figure 1</xref>B, the first layer of the encoder decomposes the total variation in ST data into two components (<xref rid="GR277891LIC34" ref-type="bibr">Li et al. 2017</xref>; <xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>): the component that captures the shared biological variation from reference data based on the BNN module, and the component that captures the unique biological variation in target ST data based on an unconstrained fully connected network (FCN). The choice of the reference data is flexible and can be constructed from various sources (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>A; <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S1</xref>), including: (1) external ST data of the same tissue and from the same protocol with the target ST data, (2) external ST data of similar tissues and from other protocols, (3) scRNA-seq data of similar tissues, or (4) the target ST data itself. In practice, the reference data can be incomplete: novel domains of biological variation that are not captured in the reference data can be present in target ST data. The second component uses an unconstrained FCN to adaptively capture the unique variation in target ST data that is not present in reference data.</p>
      <fig position="float" id="GR277891LIF1">
        <label>Figure 1.</label>
        <caption>
          <p>The PAST framework. (<italic>A</italic>) Four approaches for PAST to construct reference data, including three for external reference data (PAST-E) and one from the target data itself (PAST-S). (<italic>B</italic>) PAST is built on a variational graph convolutional autoencoder. The encoder of PAST consists of three layers, including the concatenation of a BNN and a FCN as the first layer and two self-attention modules as the subsequent two layers. The reparameterization module acquires the mean and log-variance matrix based on two FCNs, in which the mean matrix is the latent embedding obtained of PAST. The decoder of PAST is also a three-layer network, including a FCN layer and two stacked self-attention modules. The loss function of PAST consists of four parts, including reconstruction loss <italic>L</italic><sub><italic>recons</italic></sub>, Kullback-Leibler divergence (KLD) loss <italic>L</italic><sub><italic>kld</italic></sub>, metric learning loss <italic>L</italic><sub><italic>metric</italic></sub> and loss of BNN module <italic>L</italic><sub><italic>bnn</italic></sub>. (<italic>C</italic>) Ripple walk sampler samples high-quality subgraphs based on the spatial neighborhood graph and outputs minibatch gene expression matrices. (<italic>D</italic>) BNN module integrates shared biological variation through restricting the KLD distance between prior Gaussian distribution parameterized by reference data and Gaussian distribution parameterized by parameters of BNN. (<italic>E</italic>) The self-attention mechanism captures spatial correlation between neighbor spots, where FCN is used to generate queries, keys, and values for the calculation of attention weights. (<italic>F</italic>) The latent embeddings, that is, mean matrix in the reparameterization module, obtained by PAST facilitate various tasks including domain identification, trajectory inference, pseudotime analysis, multislice integration, and automatic annotation.</p>
        </caption>
        <graphic xlink:href="1757f01" position="float"/>
      </fig>
      <p>To integrate information of transcriptomic profiles and spatial coordinates, PAST identifies <italic>k</italic>-nearest neighbors (<italic>k</italic>-NN) for each spot using spatial coordinates in a Euclidean space, and adopts the graph residual network (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>) with a self-attention mechanism (<xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to aggregate information from each spot's neighbors. Specifically, the self-attention mechanism, which fits the relationship between words well in machine translation tasks (<xref rid="GR277891LIC46" ref-type="bibr">Raffel et al. 2020</xref>), is used to model local spatial patterns between neighboring spots, whereas the ripple walk sampler (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>), which enables efficient subgraph-based training for large and deep GCNs, is used to achieve better scalability on large-scale ST data and preserve global spatial patterns simultaneously. PAST also restricts the distance of latent embeddings between neighbors through metric learning (<xref rid="GR277891LIC23" ref-type="bibr">Hadsell et al. 2006</xref>), the insight of which is that spatially close spots are more likely to be positive pairs to show similar latent patterns, illustrated in detail in the Loss function part of the Methods section. After model training and prediction, the latent embeddings, that is, the mean matrix of the reparameterization module (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>B), can be applied to spatial domain characterization, spatial visualization, trajectory inference, pseudotime analysis, multislice joint embedding, and automatic annotation (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>F).</p>
    </sec>
    <sec id="s1b">
      <title>PAST effectively leverages reference data from various sources for spatial domain characterization</title>
      <p>We first use an example as a proof of concept to show the capability of PAST in incorporating reference data from different sources for spatial domain characterization. We collected ST data from a STARmap data set of the mouse primary visual cortex (MPVC) (<xref rid="GR277891LIC57" ref-type="bibr">Wang et al. 2018</xref>). We also constructed the reference data from the target ST data itself, a 10x Visium ST data set of the mouse brain coronal region (<xref rid="GR277891LIC44" ref-type="bibr">Palla et al. 2022</xref>), and a scRNA-seq data set of the mouse cortex (<xref rid="GR277891LIC53" ref-type="bibr">Tasic et al. 2016</xref>), which were referred to as PAST-S, PAST-E-Visium, and PAST-E-scRNA, respectively. The three variants of PAST were benchmarked against eight baseline methods, including two widely-used single-cell analysis workflows in Python and R community (SCANPY [<xref rid="GR277891LIC59" ref-type="bibr">Wolf et al. 2018</xref>] and Seurat [<xref rid="GR277891LIC25" ref-type="bibr">Hao et al. 2021</xref>]), and six methods for ST data analysis (SpaGCN [<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>], CCST [<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>], DR-SC [<xref rid="GR277891LIC38" ref-type="bibr">Liu et al. 2022b</xref>], NSF [<xref rid="GR277891LIC54" ref-type="bibr">Townes and Engelhardt 2023</xref>], SpatialPCA [<xref rid="GR277891LIC49" ref-type="bibr">Shang and Zhou 2022</xref>], and STAGATE [<xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>]). We first show the advantages of PAST quantitatively from the following three perspectives. The detailed information about baseline methods and quantitative evaluation metrics are described in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S2</xref>.</p>
      <p>First, we quantitatively evaluated the performance of spatial domain characterization via supervised cross-validation (Cross-validation). The supervised cross-validation aims to assess the representation capabilities of the latent embeddings learned by various methods. Specifically, we treated the latent embeddings as the input and the labels of spatial domains as the output, adopted support vector machine (SVM) as the classifier as suggested by a benchmark study on supervised single-cell annotation (<xref rid="GR277891LIC1" ref-type="bibr">Abdelaal et al. 2019</xref>), and conducted fivefold cross-validation experiments. We evaluated the performance by the average score of accuracy (Acc), Cohen's kappa value (κ), mean F1 score (mF1), and weighted F1 score (wF1), respectively, in the fivefold experiments. A higher score of the metrics suggests that the latent embeddings can better predict the spatial domains and, consequently, have superior representation capabilities. As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S1A</xref>, except SpatialPCA, PAST-S and PAST-E-Visium outperform the remaining seven baseline methods for excellent embedding capabilities. Although PAST-E-scRNA performed worse than SpatialPCA and STAGATE, which may be caused by the inconsistency of tissues and protocols between ST data and the reference scRNA-seq data, it still outperforms the other six baseline methods. To qualitatively evaluate the representation capabilities of low-dimensional embeddings, we also visualized the spots using uniform manifold approximation and projection (UMAP) and t-distributed stochastic neighbor embedding (t-SNE) based on the latent embeddings learned by different methods (<xref rid="GR277891LIF2" ref-type="fig">Fig. 2</xref>B; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S2A</xref>). Except L2/3, L6, and CC, SCANPY and Seurat could hardly distinguish other domains. SpaGCN, DR-SC, NSF provide relatively better performance. STAGATE succeeded to detect most of the domains but still failed to decipher the heterogeneity of HPC. The three variants of PAST consistently achieve satisfactory visualization results compared with other methods and only SpatialPCA, PAST-S, and PAST-E-Visium successfully distinguished HPC from other domains.</p>
      <fig position="float" id="GR277891LIF2">
        <label>Figure 2.</label>
        <caption>
          <p>PAST effectively leverages reference data from various sources for spatial domain characterization. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on STARmap MPVC data set via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). (<italic>B</italic>) UMAP visualization results, (<italic>C</italic>) spatial visualization of clustering with a specified number of clusters and the manual annotation and (<italic>D</italic>) clustering evaluation of different methods under various dropout rates on MPVC data set.</p>
        </caption>
        <graphic xlink:href="1757f02" position="float"/>
      </fig>
      <p>Second, we compared the performance of spatial domain characterization through the unsupervised spatial clustering with a specified number of clusters (Ncluster), in which the specified number of clusters is set to the number of unique ground-truth spatial domains. We directly used the baseline spatial clustering methods, such as CCST (<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>) and SpaGCN (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>), or the accompanying spatial clustering strategy of each of the other baseline methods on the learned latent embeddings. Following STAGATE, PAST performed clustering with a specified number of clusters by the mclust algorithm. For SCANPY, Seurat and NSF which perform clustering by Louvain or Leiden, we implemented a binary search to tune the resolution parameter in clustering to make the number of clusters and the specified number as close as possible. We evaluated the clustering performance by six metrics: adjusted rand index (ARI), adjusted mutual information (AMI), normalized mutual information (NMI), Fowlkes-Mallows index (FMI), completeness (Comp), and homogeneity (Homo). As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S1A</xref>, PAST-S and PAST-E-Visium provide superior performance than all eight baseline methods on all six metrics. PAST-E-scRNA only performs slightly worse than SpatialPCA even when integrating incompatible scRNA-seq data as reference. SCANPY and Seurat, two widely-used single-cell analysis workflows, provided a relatively poor performance even using the vignettes tailored for ST data, indicating the importance of utilizing spatial information. Furthermore, visualization of the spatial domains characterized by clustering with a specified number of clusters and the ground-truth spatial domains on the spatial coordinates of ST data also show consistent results with the quantitative evaluation (<xref rid="GR277891LIF2" ref-type="fig">Fig. 2</xref>C). Note that for CCST, we only evaluated the clustering performance with a specified number of clusters because it is a spatial clustering method and does not provide latent embeddings.</p>
      <p>Third, we test the performance of PAST and other methods for the unsupervised spatial clustering with default resolution (Dlouvain), which is useful for the general situation in which the number of unique ground-truth spatial domains is unknown (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>). We performed Louvain clustering algorithm, one of the most widely-used community-based clustering methods in single-cell studies, with default resolution based on the latent embeddings learned by different methods. As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S1A</xref>, PAST-S again achieves overall the best performance whereas PAST-E-Visium and PAST-E-scRNA perform better than any other baseline methods except SpatialPCA. It is vital to emphasize that PAST-scRNA, which incorporates scRNA-seq data to analyze ST data, even achieved 28.2% and 32.0% improvement compared to a competitive ST method STAGATE in terms of ARI and AMI, respectively (31.6%, 18.3%, 29.1%, 34.1% for NMI, FMI, Comp, and Homo, respectively). The evaluation results are detailed in <xref rid="SD1" ref-type="supplementary-material">Supplemental Table S1</xref>.</p>
      <p>To mimic protocols that provide low coverage, we down sampled the reads in the target ST data by randomly dropping out the entries in the expression matrix to zero with a probability equal to the specified dropout rate, as suggested by a recent benchmark study (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>). As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>D, all methods including the three variants of PAST were affected by the increase in the dropout rate, however, PAST with external reference (i.e., PAST-E-Visium and PAST-E-scRNA) consistently outperform the remaining methods over all different dropout rates. Altogether, the results above suggest PAST effectively deciphers spatial patterns through integrating external reference data constructed from various sources and when target ST data has a higher degree of sparsity and noise, the benefit of utilizing external reference data increases. Furthermore, we also showed that PAST is robust to model hyperparameters including the number of neighbors and latent dimensions on the STARmap MPVC data set (<xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S3, S4</xref>).</p>
    </sec>
    <sec id="s1c">
      <title>PAST robustly obtains informative low-dimensional embeddings and facilitates diverse downstream analyses</title>
      <p>To test the capability of PAST in learning effective embeddings and accomplishing downstream tasks, we further collected 12 human dorsolateral prefrontal cortex (DLPFC) slices from a 10x Visium data set (<xref rid="GR277891LIC40" ref-type="bibr">Maynard et al. 2021</xref>). For each slice, we constructed the reference data from the ST data itself and from external ST data, namely the remaining 11 slices. The two variants of PAST have different application scenarios and are referred to as PAST-S and PAST-E, respectively. First, we benchmarked PAST from the three quantitative perspectives against nine baseline methods, including the eight methods tested on the STARmap MPVC data set and a clustering method specifically designed for spatial transcriptomics (<xref rid="GR277891LIC51" ref-type="bibr">Ståhl et al. 2016</xref>) and 10x Visium data, namely BayesSpace (<xref rid="GR277891LIC66" ref-type="bibr">Zhao et al. 2021</xref>). Similar to CCST, we only evaluated the clustering performance with a specified number of clusters. As shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S5A</xref>, for supervised cross-validation, PAST-S and PAST-E performs better than other five baseline methods except NSF and SpatialPCA. Furthermore, PAST-S and PAST-E outperforms all the baseline methods in terms of unsupervised spatial clustering with a specified number of clusters and unsupervised spatial clustering with default resolution on the 12 DLPFC slices (<xref rid="SD2" ref-type="supplementary-material">Supplemental Table S2</xref>). One-sided paired Wilcoxon signed-rank tests showed that PAST-E showed much more advantages than PAST-S in terms of various clustering metrics in the two different clustering scenarios, with <italic>P</italic>-values of 0.0105 and 0.0002 for ARI, respectively (0.0061 and 0.0002 for AMI, 0.0061 and 0.0002 for NMI, 0.0105 and 0.0005 for FMI, 0.0105 and 0.0002 for Comp, and 0.0134 and 0.0002 for Homo), highlighting the benefit of integrating high-quality external reference data. Similarly, we visualized the spatial domains characterized by clustering with a specified number of clusters and the ground-truth spatial domains on the spatial coordinates of ST data to qualitatively evaluate the performance of different methods (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S6</xref>). Taking Slice 151,673 as an example, the spatial domain assignment of the nonspatial approaches, namely SCANPY and Seurat, provide poor continuity and smoothness, which is consistent with the above quantitative results. SpaGCN, NSF, and BayesSpace fail to decipher the expected layer pattern in layer 4–layer 6 of this slice, which impairs the spatial clustering accuracy, whereas CCST, DR-SC, SpatialPCA, STAGATE, PAST-S, and PAST-E successfully characterized the expected cortical layer structures, indicating the effective spatial domain characterization.</p>
      <fig position="float" id="GR277891LIF3">
        <label>Figure 3.</label>
        <caption>
          <p>PAST robustly obtains informative low-dimensional embeddings and facilitates diverse downstream analyses. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on 12 DLPFC slices via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). The center line, box limits and whiskers in the boxplots are the median, upper and lower quartiles, and 1.5× interquartile range, respectively. (<italic>B</italic>) UMAP visualization, (<italic>C</italic>) PAGA trajectory inference results, and (<italic>D</italic>) DPT pseudotime analysis results of Slice 151,673. (<italic>E</italic>) The number of shared spatial domains in external reference data gradually deceased. (<italic>F</italic>) The spots in external reference data of PAST were down sampled with a stratified random sampling strategy to construct reference data with various scales. The horizontal dashed lines represent the corresponding median scores of STAGATE.</p>
        </caption>
        <graphic xlink:href="1757f03" position="float"/>
      </fig>
      <p>Second, taking Slice 151,673 as an example, we performed various downstream analyses based on the low-dimensional embeddings obtained by different methods. For low-dimensional visualization based on the UMAP and t-SNE algorithm (<xref rid="GR277891LIF3" ref-type="fig">Fig. 3</xref>B; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S7, S8</xref>), except the white matter (WM), SCANPY and Seurat could hardly distinguish the cortical layers. SpaGCN DR-SC, and NSF provided relatively better performance, whereas SpatialPCA, STAGATE, PAST-S, and PAST-E successfully identified all the spatial structures and reconstructed the manifold of them. Also, UMAP and t-SNE visualization for the other 11 DLPFC slices provided similar results (<xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S7, S8</xref>). For spatial trajectory inference, based on the latent embeddings learned by different methods, we performed trajectory inference using PAGA on Slice 151,673 (<xref rid="GR277891LIC60" ref-type="bibr">Wolf et al. 2019</xref>). As shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>C, PAST captured the well-known corticogenesis patterns (<xref rid="GR277891LIC22" ref-type="bibr">Gilmore and Herrup 1997</xref>; <xref rid="GR277891LIC2" ref-type="bibr">Agirman et al. 2017</xref>) and inferred a nearly linear development trajectory from inner to outer layers, indicating the utility of PAST in revealing development trajectory. For spatial pseudotime analysis using the DPT algorithm (<xref rid="GR277891LIC24" ref-type="bibr">Haghverdi et al. 2016</xref>), PAST successfully characterized all the continuous development stages, whereas the other baseline methods only captured the pseudotime variation between WM and other cortical layers (<xref rid="GR277891LIF3" ref-type="fig">Fig. 3</xref>D). Trajectory inference and pseudotime analysis for other slices also provided similar results (<xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S9, S10</xref>), highlighting the potential of PAST to extract informative features and facilitate downstream analyses and biological implications. The detailed implementation of visualization, clustering and other downstream analyses are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S3</xref>.</p>
      <p>The previous example on DLPFC slices used external reference data constructed from the other slices, which contains more than 40,000 spots and heterogeneous information of almost all the domains (PAST-E). However, the prior information in external reference data is generally incomplete for the target ST data and the scale of high-quality reference data is generally limited. Therefore, we further carefully examined the robustness of PAST-E to the number of shared domains and scale of reference data, using STAGATE, a competitive method on DLPFC data set, as the baseline. We gradually left out different number of spatial domains in external reference data, and obtained PAST-E-LO1, PAST-E-LO2, PAST-E-LO3, and PAST-E-LO4, which denote leaving out layer 1, layers 1 and layer 2, layers 1 through layer 3, and layers 1 through layer 4, respectively. The results shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>E and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S11A</xref> were in line with intuition because as the spatial domains are continuously left out, the effective prior information in the reference data is decreased. Except PAST-E-LO4, the overall clustering performance of PAST-E when integrating reference with different number of shared domains is superior to STAGATE (the horizontal dashed lines), and PAST-E performs well even based on the reference data containing only nearly half of shared domains. Furthermore, another two different schedules removing the same number of shared domains in external reference data obtained similar results (shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S12, S13</xref>), suggesting the robustness of PAST to the number of shared domains in reference data. Meanwhile, to test the influence of limited scale of reference data without reducing the number of shared domains, we randomly down sampled the spots in reference data based on a stratified random sampling strategy, that is, sampling spots from each domain with a given rate. We obtained PAST-E-DS50, PAST-E-DS40, PAST-E-DS30, PAST-E-DS20, PAST-E-DS10, PAST-E-DS5, and PAST-E-DS1, which denote remaining sampled 50%, 40%, 30%, 20%, 10%, 5%, and 1% of the spots, respectively. Compared with PAST-E which integrated prior information from more than 40,000 spots, the data scale of reference of PAST-E-DS50 through PAST-E-DS1 was only 21,949 through 425. As shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>F and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S11B</xref>, PAST-E with down sampled reference data consistently achieves satisfactory performance for supervised cross-validation and spatial clustering, until only 1% of the spots in reference data remained. We then performed two-sided Wilcoxon signed-rank tests on the quantitative results of different reference data scales. As shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S14</xref>, the scale of reference data, which may range from a few hundred to tens of thousands, has no significant impact on the performance of PAST-E, indicating that PAST-E is highly robust to the data scale of reference data when the number of shared domains in reference is sufficient.</p>
    </sec>
    <sec id="s1d">
      <title>PAST captures local spatial patterns with self-attention mechanism</title>
      <p>Next, we tested whether PAST could provide insights into local spatial patterns. We applied PAST to an osmFISH mouse somatosensory cortex data set (MSC) (<xref rid="GR277891LIC13" ref-type="bibr">Codeluppi et al. 2018</xref>), and used the target data itself as reference. As shown in <xref rid="GR277891LIF4" ref-type="fig">Figure 4</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S15</xref>, PAST-S effectively characterizes spatial domains, and achieves significant improvement compared to the baseline methods in terms of cross-validation, and spatial clustering with a specified number of clusters or with default resolution (<xref rid="SD3" ref-type="supplementary-material">Supplemental Table S3</xref>). Also, PAST with different numbers of neighbors also showed its consistent superiority (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S16</xref>). For spatial visualization, PAST-S successfully identifies the expected structures and delineated the layer borders clearly, and the identified domains are more consistent with the original annotation of the data set (<xref rid="GR277891LIF4" ref-type="fig">Fig. 4</xref>B,C).</p>
      <fig position="float" id="GR277891LIF4">
        <label>Figure 4.</label>
        <caption>
          <p>PAST capably captures local spatial patterns with self-attention mechanism. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on the osmFISH MSC data set via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). (<italic>B</italic>) Visualization of the results of spatial clustering with a specified number of clusters on MSC. (<italic>C</italic>) The manual annotation of MSC. (<italic>D</italic>) UMAP visualization of spots in MSC. The blue, orange, and brown circles denote Layer 2–3 lateral, Layer 2–3 medial, and ventricle, respectively. (<italic>E</italic>) The neighbor proportion and attention proportion for border spots of domains Layer 2–3 lateral, Layer 2–3 medial, and ventricle, respectively.</p>
        </caption>
        <graphic xlink:href="1757f04" position="float"/>
      </fig>
      <p>We then explored the capability of the self-attention module of PAST-S in capturing local spatial patterns. As shown in <xref rid="GR277891LIF4" ref-type="fig">Figure 4</xref>D and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S17</xref>, compared with baseline methods like SCANPY, Seurat, DR-S,C and SpaGCN, PAST could effectively identify domains like Layer 2–3 lateral, Layer 2–3 medial, and ventricle in UMAP and t-SNE visualization (blue, orange, and brown circles). For these three spatial domains, we selected the border spots whose spatial neighbors were originated from at least one other spatial domain, and calculated the neighbor proportion and attention proportion of each domain. More specifically, for each border spot of each domain, we recorded the proportion of different spatial domains in the six nearest neighboring spots, and calculated the average proportion for all the border spots of each domain, resulting in the neighbor proportion. In comparison with the neighbor proportion, the attention proportion recorded the attention-weighted proportion of different spatial domains in the six nearest neighboring spots. As shown in <xref rid="GR277891LIF4" ref-type="fig">Figure 4</xref>E, the self-attention mechanism successfully identifies the neighboring spots from the same domain and improves the corresponding weights, that is, from 70.15% to 72.14% for Layer 2–3 lateral, from 72.41% to 75.92% for Layer 2–3 medial, and from 72.77% to 80.45% for ventricle, indicating that self-attention mechanism enables border spots to aggregate more information from neighbor spots belonging to the same domain. Taken together, PAST could effectively capture the local spatial patterns with the self-attention mechanism and characterize the spatial correlation of the spots in ST data, especially the easily confused border spots.</p>
    </sec>
    <sec id="s1e">
      <title>PAST enables scalable training and prediction on large data while preserving global spatial patterns</title>
      <p>With the development of ST technologies, the number of profiled spots and genes increases exponentially, requiring the scalability of computational methods. Traditional minibatch training strategy for deep learning, which partition entire data set into minibatches based on random sampling, is not suitable for graph neural network (GNN) because of the destruction to the connectivity and structure of graph (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>), making GNN-based methods such as SpaGCN (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>) and CCST (<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>) not applicable to large-scale ST data. STAGATE partitioned the profiled slice and constructed a graph for each part to enable training on large data (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>D), which may lead to the loss of global spatial patterns (<xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>). We thus introduced a subgraph-based strategy for scalable training and prediction that considers both the randomness and connectivity of the graph and samples high-quality subgraphs based on a ripple walk sampler (RWS). RWS was originally proposed only for training, and was extended by us from training to prediction by sampling subgraphs covering all spots of the target data set and aggregating the latent embeddings of different subgraphs in an ensemble manner (Methods). Based on the RWS strategy, PAST preserves global spatial patterns and enables efficient application simultaneously.</p>
      <fig position="float" id="GR277891LIF5">
        <label>Figure 5.</label>
        <caption>
          <p>PAST enables scalable training and prediction on large data while preserving global spatial patterns. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on the Stereo-seq MOBS1 data set via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). (<italic>B</italic>) The manual annotation of MOBS1. (<italic>C</italic>) Visualization of the results of spatial clustering with a specified number of clusters on MOBS1. (<italic>D</italic>) Sampling strategy of STAGATE for minibatch training. (<italic>E</italic>) Ripple walk sampling strategy of PAST for scalable subgraph-based training and prediction. (<italic>F</italic>) Average time cost of different methods on MOBS1. (<italic>G</italic>) Peak memory usage of different methods on MOBS1.</p>
        </caption>
        <graphic xlink:href="1757f05" position="float"/>
      </fig>
      <p>We collected a Stereo-seq mouse olfactory bulb section (MOBS1) with 107,416 spots and 26,145 genes and analyzed the data set on a standard desktop with an AMD Ryzen 7 Eight-Core 3800X CPU, 64GB of RAM and an NVIDIA GeForce RTX 2080 Ti GPU. We collected another Stereo-seq mouse olfactory bulb section (MOBS2) with 104,931 spots and 23,815 genes to construct the external reference for PAST. Note that we encountered memory errors when performing Seurat, SpaGCN, CCST, NSF, and SpatialPCA on MOBS1. As shown in <xref rid="GR277891LIF5" ref-type="fig">Figure 5</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S18</xref>, PAST-S and PAST-E, which incorporated self-prior information from MOBS1 itself and external-prior information from MOBS2, respectively, achieve overall the best performance for spatial domain characterization. The quantitative results are listed in <xref rid="SD4" ref-type="supplementary-material">Supplemental Table S4</xref>. Furthermore, PAST-S and PAST-E also achieve satisfactory performance in UMAP and t-SNE visualization (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S19</xref>). Also, the spatial domains detected by PAST-S and PAST-E were spatially continuous and smooth, and the subependymal zone (SEZ) domain, denoted as Cluster 1, was only successfully characterized by these two variants of PAST (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>B,C). We performed differential expression gene (DEG) analysis for Cluster 1 of PAST-S and PAST-E, respectively. The results of both of these two variants showed that the top two DEGs were <italic>Mbp</italic> and <italic>Plp1</italic>, which are classical genes encoding myelin proteins (<xref rid="GR277891LIC6" ref-type="bibr">Bitar et al. 2022</xref>). Myelin proteins were usually used as markers for striatal contamination or staining to facilitate accurate dissection of the SEZ (<xref rid="GR277891LIC19" ref-type="bibr">Friess et al. 2021</xref>; <xref rid="GR277891LIC6" ref-type="bibr">Bitar et al. 2022</xref>). We further performed Gene Ontology (GO) analysis for the top 10 DEGs with the lowest adjusted <italic>P</italic>-values of Cluster 1, and identified the most significant molecular function, that is, structural constituent of myelin sheath, with false discovery rates (FDR) of 1.28 × 10<sup>−4</sup> and 9.33 × 10<sup>−5</sup> for PAST-S and PAST-E, respectively. The GO analysis results were well consistent with the molecular function of SEZ domain, that is, deriving oligodendrocytes to form mature myelin sheaths around axons (<xref rid="GR277891LIC41" ref-type="bibr">Menn et al. 2006</xref>; <xref rid="GR277891LIC30" ref-type="bibr">Kazanis 2009</xref>), suggesting the ability of PAST to facilitate functional implication.</p>
      <p>We also recorded the computational time and peak memory usage of different methods, especially the two GNN-based methods, that is, STAGATE and PAST, which used different sampling strategies (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>D,E). As shown in <xref rid="GR277891LIF5" ref-type="fig">Figure 5</xref>F, the average computational time of PAST-S and PAST-E (168 and 164 sec) in 10 replicated experiments were approximately 30× less than STAGATE (5304 sec). In terms of peak memory usage, PAST-S and PAST-E also consumed significantly less memory than STAGATE (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>G), indicating that the RWS of PAST has a significant advantage over the partition strategy of STAGATE. SCANPY adopts the straightforward representation learning methods, that is, principle component analysis, without incorporating spatial information of ST data, thus providing relatively inferior performance but consuming the lowest computation time (26 Sec). In summary, PAST enables scalable subgraph-based training and prediction while preserving global spatial patterns to better characterize spatial organizations.</p>
    </sec>
    <sec id="s1f">
      <title>PAST facilitates multislice joint embedding and automatic domain annotation</title>
      <p>Advanced ST sequencing technologies like 10x Visium, Slide-seq (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>), Slide-seq v2 (<xref rid="GR277891LIC52" ref-type="bibr">Stickels et al. 2021</xref>), and Stereo-seq (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) generate multiple sequencing slices for the same tissue at one time. However, because of the difference in the dissection of the tissue slices and their placement on array, the spatial coordinate system of multiple slices are different and cannot be easily compared across slices (<xref rid="GR277891LIC63" ref-type="bibr">Zeira et al. 2022</xref>), urgently requiring computational methods for multislice joint embedding and automatic domain annotation. We hence proposed two strategies, namely a transfer learning (TL) strategy and a three-dimensional (3D) stacking (3DStack) strategy, based on current representation learning framework to acquire joint embeddings of multiple slices (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S4</xref>). Specifically, given multiple slices with inconsistent coordinates and a deep representation learning model, TL strategy chooses one among these slices to train the deep representation learning model and then acquires the joint embeddings of all slices based on the trained model. In comparison, the 3D stacking strategy adds a third dimension to stack the multiple slices in a 3D space and only considers spatial relationship between spots from the same slice by setting the distance between different slices to a large value (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S20</xref>). Based on the 3D coordinates reconstructed by 3D stacking strategy, current representation learning methods can be easily applied to multiple slices for joint embedding. After obtaining joint embeddings of multiple slices, automatic domain annotation can be easily implemented with a specified classifier (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S4</xref>). Specifically, we first split the data into a reference set with domain labels and a target set without labels, then based on the joint embeddings, we trained a SVM on the reference set with its embeddings and labels, and predicted the labels of target set with the trained SVM. Note that the official implementation of DR-SC, SpaGCN, SpatialPCA, and STAGATE cannot use 3D coordinates, whereas SCANPYand Seurat cannot integrate spatial information, thus not applicable to 3D stacking strategy. Nondeep learning models like SCANPY, Seurat, NSF, DR-SC and SpatialPCA are not applicable to TL strategy designed for deep methods, and acquire the latent embeddings of each slice separately in the subsequent experiments.</p>
      <p>We first adopted the 12 DLPFC slices to quantitatively show the integration and annotation performance of different methods based on the two strategies, denoting methods using the TL and 3DStack strategies as *-TL and *-3DStack, respectively. We split the DLPFC data set into a reference set, that is, Slice 151,673 with domain labels, and a target set, that is, remaining slices without labels. Naturally, PAST constructed reference data of the BNN module using Slice 151,673 with domain labels. As the UMAP and t-SNE visualization shown in <xref rid="GR277891LIF6" ref-type="fig">Figure 6</xref>A,B and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S21A–C</xref>, methods like SCANPY, Seurat, NSF, DR-SC, and SpatialPCA, which were directly applied to multiple slices and acquired the latent embeddings separately, obtain relatively poor performance, whereas STAGATE-TL, PAST-TL, and PAST-3DStack succeed in batch correction and domain identification, based on the joint embeddings of all the 12 slices obtained by TL and 3DStack strategy. We next used the embeddings and domain labels of Slice 151,673 to train a SVM classifier and annotated the spatial domains in other slices. For quantitative comparison of annotation results, PAST-TL consistently outperforms the baseline methods (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>C), and achieved significantly higher scores of Acc, κ, mF1, and wF1 than STAGATE-TL, the second-best method, with <italic>P</italic>-values of 0.0034, 0.0024, 0.0005, and 0.0005, respectively, in one-sided paired Wilcoxon signed-rank tests. PAST based on the 3D stacking strategy, namely PAST-3DStack, provides even better performance than PAST-TL and naturally outperforms any other baseline methods. Furthermore, clustering evaluation of the joint embeddings showed similar results (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S21D</xref>), highlighting the superiority of the TL and 3DStack strategies and PAST in multislice integration and automatic annotation.</p>
      <fig position="float" id="GR277891LIF6">
        <label>Figure 6.</label>
        <caption>
          <p>PAST facilitates multislice joint embedding and automatic domain annotation. UMAP visualization of spots based on the joint embeddings of all the 12 DLPFC slices colored by (<italic>A</italic>) slices and (<italic>B</italic>) spatial domains. (<italic>C</italic>) Performance of supervised annotation evaluated by accuracy (Acc), Cohen's kappa value (κ), mean F1 score (mF1), and weighted F1 score (wF1), where Slice 151,673 was taken as the training set and other 11 slices were taken as test sets. The center line, box limits, and whiskers in the boxplots are the median, upper and lower quartiles, and 1.5× interquartile range, respectively. (<italic>D</italic>) The manual annotation of BCS1, in which the IDC_3 tumor region was black circled. UMAP visualization of the joint embeddings of spots in BCS1/2 sections colored by (<italic>E</italic>) sections and (<italic>F</italic>) spatial domains. (<italic>G</italic>) The supervised annotation results on BCS2 by different methods. The black circle denotes the supervised annotated IDC_3 and Tumor_edge_3, whereas the blue and orange circles denote the supervised annotated DCIS/LCIS_1 and DCIS/LCIS_2, respectively. (<italic>H</italic>) The annotation results of Tumor_edge_3 and DCIS/LCIS_2 by PAST-TL and PAST-3DStack and the spatial expression patterns of BCS1-marker genes on BCS2.</p>
        </caption>
        <graphic xlink:href="1757f06" position="float"/>
      </fig>
      <p>We further collected another two 10x Visium human breast cancer sections (BCSs) for integration and annotation, where the first section (BCS1) of the data set is precisely annotated by (<xref rid="GR277891LIC20" ref-type="bibr">Fu et al. 2021</xref>) and the second section (BCS2) is not annotated. Naturally, we treated BCS1 (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>D) as reference set with domain labels and treated BCS2 as target set for annotation. PAST-TL and PAST-3DStack again successfully correct the batch effect between the sections and separate spots from different domains (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>E,F; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S22A,B,D</xref>). Based on joint embeddings acquired by different methods, we next trained a SVM classifier with embeddings and labels of BCS1, and annotated BCS2 (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>G; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S22C</xref>). For the evaluation of annotation results, we identified marker genes for each domain based on the ground-truth labels on BCS1 (referred to as BCS1-marker genes), and found that BCS1-marker genes of each domain were also differentially expressed in most of the corresponding PAST-TL and PAST-3DStack annotated tumor areas on BCS2 (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S23</xref>), indicating the ability of PAST-TL and PAST-3DStack to reveal biological variation among tumor areas. In addition, PAST successfully captured BCS2-specific spatial domains by separating the IDC_3 region on BCS1 into IDC_3 and Tumor_edge_3 on BCS2 (black circles in <xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>D,G). The BCS1-marker genes of Tumor_edge_3 also showed the unique spatial pattern of the newly annotated Tumor_edge_3 on BCS2, which further suggests the accuracy of annotation results on BCS2 (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>H). We also performed DEG analysis for Tumor_edge_3 region based on the annotation results of PAST-TL and PAST-3DStack on BCS2, and identified the same five most significant DEGs including <italic>IGHG3, IGKC, IGLC2, IGHG4</italic>, and <italic>IGHG1</italic> with adjusted <italic>P</italic>-values of 1.11 × 10<sup>−83</sup>, 1.86 × 10<sup>−78</sup>, 9.18 × 10<sup>−74</sup>, 9.18 × 10<sup>−74</sup>, 1.66 × 10<sup>−69</sup> for PAST-TL and 4.52 × 10<sup>−74</sup>, 2.60 × 10<sup>−69</sup>, 8.11 × 10<sup>−66</sup>, 1.75 × 10<sup>−62</sup>, 3.21 × 10<sup>−60</sup> for PAST-3DStack, respectively. Based on previous literature, the linkage of <italic>IGHG1/3/4</italic> provides information for prognosis of diseases like autoimmunity and malignancy (<xref rid="GR277891LIC43" ref-type="bibr">Oxelius and Pandey 2013</xref>), <italic>IGKC</italic>, serving as a robust immune marker, could predict metastasis-free survival and response to chemotherapy (<xref rid="GR277891LIC48" ref-type="bibr">Schmidt et al. 2012</xref>), and <italic>IGLC2</italic> was proven to be a significant prognostic biomarker for triple-negative breast cancer patients (<xref rid="GR277891LIC8" ref-type="bibr">Chang et al. 2021</xref>). The Gene Ontology enrichment for the top 10 DEGs of Tumor_edge_3 also significantly revealed lots of biological immune processes for both PAST-TL (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S24</xref>) and PAST-3DStack model (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S25</xref>).</p>
      <p>PAST-TL and PAST-3DStack also successfully captured the biological difference between DCIS/LCIS_1 and DCIS/LCIS_2 (blue and orange circles in <xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>G) and accurately annotated DCIS/LCIS_2 on BCS2, which was missed by other methods. The spatial expression visualization of BCS1-marker genes of DCIS/LCIS_2 on BCS2 illustrated the accurate annotation of DCIS/LCIS_2 by PAST and the two strategies (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>H). To summarize, based on the two strategies, PAST cannot only effectively facilitate multislice joint embedding and automatic domain annotation, but also identify test set-specific spatial patterns and reveal the corresponding biological implications.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s2">
    <title>Discussion</title>
    <p>In this article, we introduce PAST, a comprehensive and scalable framework that effectively integrates prior information via Bayesian neural networks, deciphers global and local spatial correlations based on graph residual network integrated with self-attention mechanism, and enables scalable training and prediction on large data sets with RWS strategy. With comprehensive experiments on multiple data sets generated by various technologies, we have shown that PAST capably incorporates prior information from various sources to better tackle the high-level technical variation and effectively integrates spatial information to characterize spatial domains, highlighting the superior information fusion capabilities of PAST. We have also showed the successful applications of PAST in downstream tasks including spatial domain characterization, ST visualization, spatial trajectory inference, and pseudotime analysis. Experiments on large-scale data sets also proved the scalability and effectiveness of PAST. Furthermore, PAST not only enables multislice joint embedding and automatic annotation of spatial domains for multiple ST data, but also provides biological insights into the annotated domains.</p>
    <p>PAST stands out as a representation learning method tailored for ST data by incorporating reference data, which can be constructed from four different approaches (Methods). This inherent property of PAST showcases remarkable potential in deciphering ST data, especially in light of the ever-growing reservoir of both ST data and scRNA-seq data, while it simultaneously poses challenges in selecting top-notch reference data for better performance. To offer practical suggestions and recommendations for users, we diligently constructed reference data encompassing all the four approaches for the data sets in the aforementioned experiments and reported their performance outcomes (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S5</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S26</xref>), which highlights the superiority of PAST even when integrating reference from completely different technologies. Nevertheless, owing to the potential uncertainty stemming from incongruity of external reference, it is advisable to prioritize reference data from the same technique, of the same tissue type, containing more shared domains, and of a larger scale. Furthermore, we also proposed three recommendation scores, that is, maxMAP, maxSC, and maxCHS, to guide users to select high-quality reference data in an adaptive way (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S5</xref>). The three recommendation scores assess the latent embeddings acquired by PAST with different external reference data, signifying stronger recommendation levels through higher values. Finally, the scores have been proven to effectively steer users towards selecting the optimal approach for reference construction across all data sets, while maintaining satisfactory computational time (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S26</xref>; <xref rid="SD5" ref-type="supplementary-material">Supplemental Tables S5</xref>, <xref rid="SD6" ref-type="supplementary-material">S6</xref>), which provides an adaptive, accurate, and scalable approach for users to select optimal reference data in ST data analysis.</p>
    <p>The self-attention mechanism of PAST is implemented to adaptively learn attention weights and proven to capably aggregates more information from neighbor spots belonging to the same domain. This capability can be translated into several practical benefits for researchers to analyze ST data, including interpretable visualization, effective clustering, and accurate annotation, which has been systematically showed in the aforementioned experiments. In addition, we further envision an extension of the self-attention mechanism, which models the relationship between spatially close spots based on the transcriptional information, to unravel intricate cell-cell interactions (CCI), because recent research has underscored the reliability of deciphering CCI from transcriptomic data (<xref rid="GR277891LIC3" ref-type="bibr">Armingol et al. 2021</xref>) and the strong relationship between spatial structures and CCI in the microenvironment (<xref rid="GR277891LIC4" ref-type="bibr">Asp et al. 2020</xref>; <xref rid="GR277891LIC39" ref-type="bibr">Liu et al. 2022c</xref>). Massively parallel sequencing-based technologies like 10x Visium, Slide-seq (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>), Slide-seq v2 (<xref rid="GR277891LIC52" ref-type="bibr">Stickels et al. 2021</xref>), and Stereo-seq (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) generates multiple sequencing slices for the same tissue with inconsistent coordinates. We propose a 3D stacking strategy to stack the slices into a 3D coordinate system and only consider the attention weights between spots from the same slice (PAST-3DStack). A recent method, called PASTE (<xref rid="GR277891LIC63" ref-type="bibr">Zeira et al. 2022</xref>), has been proposed to align multiple adjacent tissue slices into a consistent spatial coordinate system. Based on the coordinates obtained by PASTE, PAST capably implements cross-slice attention weights and obtain joint embeddings of multiple slices, denoted as PASTE-PAST. We compared PAST-3DStack with PASTE-PAST and other baseline methods for joint embedding on three donors of the human DLPFC data set, highlighting the superiority of PAST-3DStack (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S6</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S27, S28</xref>). Nevertheless, compared with PAST-3DStack, the combination of PASTE and PAST enables the characterization of cross-slice attention and inspires us to explore the extension of self-attention mechanism to model cross-data-set attention for multislice integration.</p>
    <p>Generalizability of computational methods across technologies, species, and tissue types holds immense significance. To test the consistency of PAST across various biological systems, we further extend our model to another two data sets of different species and tissue types, namely a Stereo-seq axolotl brain data set (<xref rid="GR277891LIC58" ref-type="bibr">Wei et al. 2022</xref>) and a Stereo-seq zebrafish embryo data set (<xref rid="GR277891LIC37" ref-type="bibr">Liu et al. 2022a</xref>) (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S7</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S29, S30</xref>). The experimental results showed the superiority of PAST in term of spatial clustering, UMAP, t-SNE, and spatial visualization. We also implemented PAST-3DStack to the Stereo-seq zebrafish embryo data set, which is composed of 12 slices, for joint embedding, illustrating the superiority of PAST and the 3D stacking strategy in multislice integration across different species (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S8</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S31</xref>). In summary, we have showcased the superior performance of PAST across four sequencing technologies, encompassing four species and spanning seven tissue types, which underscores the broad applicability and unwavering consistency of PAST across various biological systems.</p>
    <p>Certainly, there are several avenues for improving PAST. First, given that Chen et al. achieved satisfactory annotation and simulation performance in scATAC-seq data through assuming the latent embeddings follow a Gaussian mixture distribution (<xref rid="GR277891LIC11" ref-type="bibr">Chen et al. 2022b</xref>), we can explore the application of PAST in ST data simulation by adding more complex assumptions on latent distribution. Second, with the rapid development of ST sequencing technologies, many massively parallel sequencing-based methods are often complemented by high-resolution hematoxylin and eosin (H&amp;E) histology images, demanding methods like PAST to incorporate cross-modality information which contains valuable heterogeneity and pathological information (<xref rid="GR277891LIC28" ref-type="bibr">Hu et al. 2021b</xref>). Third, the rapid development of graph neural network and large language model field provide advanced methodology to model the relationship between connected nodes in graph or related words in sentence, which also opens new horizons for better characterization of relationship between neighboring spots. Finally, Chen et al. have already proven the effectiveness of leveraging reference data in the analysis of scATAC-seq data (<xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>), so we anticipate the extended application of PAST in other spatial omics data like spatial-ATAC-seq data (<xref rid="GR277891LIC15" ref-type="bibr">Deng et al. 2022</xref>; <xref rid="GR277891LIC21" ref-type="bibr">Gao et al. 2023</xref>).</p>
  </sec>
  <sec sec-type="methods" id="s3">
    <title>Methods</title>
    <sec id="s3a">
      <title>The model of PAST</title>
      <p>PAST is a self-supervised representation learning framework built upon variational graph convolutional autoencoder (<xref rid="GR277891LIC31" ref-type="bibr">Kingma and Welling 2014</xref>) and integrates a graph residual network (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>; <xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to model the node dependency in spatial graph. It takes three kinds of data as input, including preprocessed target gene expression matrix, target spatial coordinate matrix and reference gene expression matrix (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>B). The details about data preprocessing are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S9</xref>.</p>
      <sec id="s3a1">
        <title>Encoder</title>
        <p>The encoder of PAST is a three-layer neural network. The first layer consists of a BNN module and a parallel FCN, and the output of the first layer is the concatenation of the two modules. It decomposes the total variation in ST data into two components (<xref rid="GR277891LIC34" ref-type="bibr">Li et al. 2017</xref>; <xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>): the component that captures the shared biological variation from reference data with a BNN module, and the component that captures the unique biological variation in target ST data with an unconstrained FCN. This property has been validated through ablation study of BNN module and the FCN module, shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S10</xref> and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figures S32, S1B, S5B, and S15B</xref>. The second and third layers are two stacked self-attention modules. The input of self-attention module includes a feature matrix from the last layer and the <italic>k</italic>-NN graph constructed with spatial coordinates of the target data.</p>
      </sec>
      <sec id="s3a2">
        <title>Reparameterization module</title>
        <p>As suggested by variational autoencoder (VAE), we assume the prior of latent embeddings is centered isotropic multivariate Gaussian distribution, use two FCNs to obtain the mean and logarithmic variance matrices of latent space based on the output of encoder, and obtain normally distributed samples through the reparameterization trick. We emphasize that the mean matrix of this module is the final output of PAST, that is, latent embeddings.</p>
      </sec>
      <sec id="s3a3">
        <title>Decoder</title>
        <p>The decoder of PAST is also a three-layer network, in which the first and second layers are stacked self-attention modules and the third layer is a FCN. The decoder takes multivariate normally distributed samples from the reparameterization module as input and then outputs the reconstructed gene expression matrix of the target data.</p>
      </sec>
      <sec id="s3a4">
        <title>Training and prediction workflow</title>
        <p>In the forward propagation phase of training workflow, a <italic>k</italic>-NN graph is first constructed based on the target spatial coordinate matrix. Second, PAST samples high-quality subgraphs using the ripple walk training strategy based on the <italic>k</italic>-NN graph, providing subgraphs and minibatch gene expression matrices for encoder. The encoder of PAST takes the subgraphs and the target and reference gene expression matrices as input, in which the subgraphs serve as the spatial neighborhood graph for the self-attention module and the reference gene expression matrix provides prior parameters for BNN module. Third, reparameterization module uses the output feature matrix of encoder to acquire the parameters of latent Gaussian distribution based on two FCNs, implements the reparameterization trick (<xref rid="GR277891LIC31" ref-type="bibr">Kingma and Welling 2014</xref>) to sample multivariate normally distributed vectors, and then feeds the vectors and the subgraphs obtained from ripple walk sampler into the decoder to get a target reconstructed gene expression matrix. In the backward propagation phase, the gradient of each parameter in the model is calculated according to the loss function of PAST and is updated based on the Adam optimizer with default initial learning rate <italic>lr</italic> = 0.001. The detailed model structure and hyperparameter settings of PAST are summarized in <xref rid="SD7" ref-type="supplementary-material">Supplemental Table S7</xref>. The prediction workflow only contains the forward propagation of the encoder to acquire the mean matrix of the reparameterization module, that is, the latent embeddings. Furthermore, PAST implements ripple walk prediction strategy instead of the ripple walk training strategy in the prediction workflow.</p>
      </sec>
    </sec>
    <sec id="s3b">
      <title>Ripple walk sampler</title>
      <p>To extend our model to large-scale application scenarios, we adopt a subgraph-based sampling strategy called ripple walk sampler (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>C), which samples high-quality subgraphs to enable minibatch training (ripple walk training) under the premise of satisfying randomness and connectivity (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>). Furthermore, we extend the ripple walk sampler for scalable prediction, called ripple walk prediction. The detailed explanations of ripple walk sampler, training, and prediction are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S11</xref> and <xref rid="SD10" ref-type="supplementary-material">Supplemental Algorithms S1, S2, S3</xref>.</p>
    </sec>
    <sec id="s3c">
      <title>Bayesian neural network</title>
      <p>BNN introduces uncertainty into weights of the neural network to improve generalization in nonlinear regression problems (<xref rid="GR277891LIC7" ref-type="bibr">Blundell et al. 2015</xref>). Here we use BNN to integrate shared biological information from reference data (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>D).</p>
      <p>Parameters of the BNN module could be represented by <bold><italic>P</italic></bold> ∈ <italic>d</italic><sub><italic>in</italic></sub> × <italic>d</italic><sub><italic>out</italic></sub>, and each element in <bold><italic>P</italic></bold> is subject to a Gaussian distribution,<disp-formula id="GR277891LIUM1"><mml:math id="UM1" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>∼</mml:mo><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <inline-formula id="il1"><mml:math id="IL1" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> and <inline-formula id="il2"><mml:math id="IL2" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> are elements in the <italic>i</italic>th row and <italic>j</italic>th column of the mean matrix <bold><italic>μ</italic></bold><sub><italic>b</italic></sub> and variance matrix <inline-formula id="il3"><mml:math id="IL3" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula>, respectively. We get normally distributed parameters <bold><italic>P</italic></bold><sub><italic>ij</italic></sub> through reparameterization trick in each forward propagation process. Given an input matrix <bold><italic>M</italic></bold> ∈ <italic>B</italic> × <italic>d</italic><sub><italic>in</italic></sub> in a minibatch, the output matrix of shape <italic>B</italic> × <italic>d</italic><sub><italic>out</italic></sub> of BNN module is<disp-formula id="GR277891LIUM2"><mml:math id="UM2" display="block" overflow="scroll"><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">δ</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>⊙</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>f</italic><sub><italic>bnn</italic></sub>( · ) denotes the function of BNN module, <bold>δ</bold> is the standard gaussian noise matrix and <inline-formula id="il4"><mml:math id="IL4" display="inline" overflow="scroll"><mml:mo>⊙</mml:mo></mml:math></inline-formula> denotes element-wise product.</p>
      <p>To integrate shared biological variation information in reference data, we assume elements in <bold><italic>P</italic></bold> are subject to a prior Gaussian distribution parameterized by <bold><italic>μ</italic></bold><sub><italic>p</italic></sub> and <inline-formula id="il5"><mml:math id="IL5" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula>, where <bold><italic>μ</italic></bold><sub><italic>p</italic></sub> is the PCA projection weight matrix of the reference gene expression matrix and <bold><italic>σ</italic></bold><sub><italic>p</italic></sub> contains elements equal to one-tenth standard deviation of <bold><italic>μ</italic></bold><sub><italic>p</italic></sub>. The step-by-step construction of reference gene expression matrix from various sources is illustrated in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S1</xref> and <xref rid="SD10" ref-type="supplementary-material">Supplemental Algorithm S4</xref>. KLD is used to restrict the distance between the Gaussian distribution parameterized by the parameters of BNN module and the prior Gaussian distribution parameterized by reference data:<disp-formula id="GR277891LIUM3"><mml:math id="UM3" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:math></disp-formula>
<disp-formula id="GR277891LIUM4"><mml:math id="UM4" display="block" overflow="scroll"><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>−</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
</p>
    </sec>
    <sec id="s3d">
      <title>Self-attention mechanism</title>
      <p>Self-attention mechanism is the key mechanism of transformer for capturing the relationship between words in a given sentence in machine translation tasks, showing superior performance compared with other recurrent neural network-based models (<xref rid="GR277891LIC55" ref-type="bibr">Vaswani et al. 2017</xref>; <xref rid="GR277891LIC46" ref-type="bibr">Raffel et al. 2020</xref>). Recent advances have revealed that gene expression levels of neighboring spots in a tissue microenvironment tend to be correlated (<xref rid="GR277891LIC17" ref-type="bibr">Dries et al. 2021</xref>; <xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). Inspired by the above understanding, PAST adopts a self-attention mechanism to model the relationship between neighboring spots (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>E).</p>
      <p>The input of the self-attention module is a feature matrix <bold><italic>M</italic></bold> and the corresponding <italic>k</italic>-NN graph <inline-formula id="il6"><mml:math id="IL6" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>. <inline-formula id="il7"><mml:math id="IL7" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> is constructed using spatial coordinates with <italic>k</italic> = 6. The input matrix <bold><italic>M</italic></bold> is mapped to obtain query <bold><italic>Q</italic></bold>, key <bold><italic>K</italic></bold>, and value <bold><italic>V</italic></bold> through three FCNs, and the adjacent matrix <inline-formula id="il8"><mml:math id="IL8" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> can then be calculated as follows:<disp-formula id="GR277891LIUM5"><mml:math id="UM5" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">Q</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">K</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>d</italic><sub><italic>k</italic></sub> is the feature dimension of query <bold><italic>Q</italic></bold> and key <bold><italic>K</italic></bold>. The attention weight matrix <bold><italic>A</italic></bold> can be obtained by normalizing the adjacent matrix <inline-formula id="il9"><mml:math id="IL9" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>,<disp-formula id="GR277891LIUM6"><mml:math id="UM6" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">A</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold><italic>A</italic></bold><sub><italic>ij</italic></sub> is the attention weight from spot <italic>j</italic> to spot <italic>i</italic>, and <italic>S</italic><sub><italic>i</italic></sub> denotes the set of neighbors of spot <italic>i</italic> in <inline-formula id="il10"><mml:math id="IL10" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>. To avoid excessive spatial smoothing of hidden features, we add a shortcut in the self-attention module (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>; <xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) and the output of self-attention module can be written as the subsequent form:<disp-formula id="GR277891LIUM7"><mml:math id="UM7" display="block" overflow="scroll"><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>t</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">V</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">A</mml:mi><mml:mi>V</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where <italic>f</italic><sub><italic>attn</italic></sub>( · ) denotes the function of self-attention module.</p>
    </sec>
    <sec id="s3e">
      <title>Loss function</title>
      <p>Analysis of omics data is susceptible to sequencing noise such as dropout, and recent studies have proven that it is beneficial to consider data sparsity and dropout in spatial transcriptomic data (<xref rid="GR277891LIC50" ref-type="bibr">Shengquan et al. 2021</xref>). Here we design sparsity adaptive reconstruction loss based on the insight that the higher the data sparsity, the more serious the dropout phenomenon is, and the higher probability the zero gene expression observations are false negative. Given a minibatch containing <italic>B</italic> spots and <italic>M</italic> genes, the sparsity adaptive reconstruction loss is shown as<disp-formula id="GR277891LIUM8"><mml:math id="UM8" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>B</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold><italic>x</italic></bold><sub><italic>ij</italic></sub> denotes the profiled expression level of gene <italic>j</italic> in spot <italic>i</italic>, <inline-formula id="il11"><mml:math id="IL11" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the reconstructed expression level of gene <italic>j</italic> in spot <italic>i</italic>, and the function <italic>I</italic>( · ) is (<italic>s</italic><sub><italic>i</italic></sub> represents the sparsity of spot <italic>i</italic>)<disp-formula id="GR277891LIUM9"><mml:math id="UM9" display="block" overflow="scroll"><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mspace width="0.4em"/><mml:mo>=</mml:mo><mml:mspace width="0.4em"/><mml:mn>0</mml:mn></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula>
We assume the low-dimensional embeddings follow multivariate Gaussian distribution and the prior is the centered isotropic multivariate Gaussian distribution. The distance between the latent distribution and the prior distribution is restricted by KLD (<xref rid="GR277891LIC31" ref-type="bibr">Kingma and Welling 2014</xref>):<disp-formula id="GR277891LIUM10"><mml:math id="UM10" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">I</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:math></disp-formula>
<disp-formula id="GR277891LIUM11"><mml:math id="UM11" display="block" overflow="scroll"><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>B</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold>μ</bold> and <bold>σ</bold> are the mean vectors and standard deviation vectors of latent space, respectively, whereas <italic>d</italic><sub><italic>lat</italic></sub> denotes the dimension of latent space.</p>
      <p>Metric learning has been proposed to model the distance between samples, making the distance between positive sample pairs closer and the distance between negative sample pairs farther (<xref rid="GR277891LIC23" ref-type="bibr">Hadsell et al. 2006</xref>). Samples in spatial transcriptomics are of strong spatial autocorrelation, which means that spatial neighboring spots may have similar gene expression patterns and tend to belong to the same functional structure (<xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). Here we design a metric learning loss function to restrict the distance of low-dimensional representations between neighbor samples:<disp-formula id="GR277891LIUM12"><mml:math id="UM12" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:msub><mml:mo fence="false">|</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <bold><italic>G</italic></bold> is the weighted spatial neighbor graph and the connection weights between samples are calculated using the Student's <italic>t</italic>-distribution kernel, <bold>μ</bold><sub><italic>i</italic></sub> and <bold>μ</bold><sub><italic>j</italic></sub> denote the latent embeddings of spot <italic>i</italic> and spot <italic>j</italic>, respectively. The calculation of <bold><italic>G</italic></bold> can be denoted as<disp-formula id="GR277891LIUM13"><mml:math id="UM13" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:msup><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:msup><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold><italic>c</italic></bold><sub><italic>i</italic></sub> denotes the spatial coordinate of spot <italic>i</italic>, <italic>S</italic><sub><italic>i</italic></sub> denotes the set of neighbors of spot <italic>i</italic>, α is a scale factor that is set to 1 by default. We also tried to build the graph <bold><italic>G</italic></bold> with gene expression information of spots, that is, denoting the above <bold><italic>c</italic></bold><sub><italic>i</italic></sub> as gene expression vector of spot <italic>i</italic>, and compared the two different approaches (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S12</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S33</xref>), illustrating the effectiveness of building graph <bold><italic>G</italic></bold> with spatial information.</p>
      <p>As described in the above section, we integrate prior information through the BNN (<xref rid="GR277891LIC7" ref-type="bibr">Blundell et al. 2015</xref>) module and restrict the distance between parameter of the BNN module and prior distribution through <italic>L</italic><sub><italic>bnn</italic></sub> loss function. The objective function of PAST is the combination of the aforementioned four parts:<disp-formula id="GR277891LIUM14"><mml:math id="UM14" display="block" overflow="scroll"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>3</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>4</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>β</italic><sub>1</sub>, <italic>β</italic><sub>2</sub>, <italic>β</italic><sub>3</sub>, <italic>β</italic><sub>4</sub> are coefficients served as a trade-off between the four parts and we set <italic>β</italic><sub>1</sub> = 1, <italic>β</italic><sub>2</sub> = 1, <italic>β</italic><sub>3</sub> = 1, <italic>β</italic><sub>4</sub> = 1 by default. We have evaluated the impact of the four coefficients and the contribution of the four loss function parts through experimental analysis, which finally illustrates the robustness of PAST to different hyperparameter settings and the significance of each part of the loss function (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S13</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S34, S35</xref>).</p>
    </sec>
    <sec id="s3f">
      <title>Multislice joint embedding and automatic annotation</title>
      <p>We propose two strategies, namely a transfer learning strategy and a 3D stacking strategy, to apply representation learning methods designed for single slice to multiple slices for joint embedding. Furthermore, we annotate the domain labels of multiple slices in ST data based on the joint embeddings obtained by the aforementioned strategies. The detailed explanations of the joint embedding and automatic annotation strategies are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S4</xref>.</p>
    </sec>
    <sec id="s3g">
      <title>Baseline methods, downstream analyses, and evaluation metrics</title>
      <p>Downstream applications including visualization, clustering, trajectory inference, and pseudotime analysis are detailed in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S3</xref>. To evaluate the performance of our model, we benchmarked PAST with nine baseline methods in term of 16 quantitative metrics and various downstream analyses. We describe the baseline methods, parameter settings, and the evaluation metrics in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S2</xref>. The details about data collection and preprocessing are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S9</xref>. The information about all the target data sets and reference data sets is summarized in <xref rid="SD8" ref-type="supplementary-material">Supplemental Table S8</xref>.</p>
    </sec>
    <sec id="s3h">
      <title>Data sets</title>
      <p>The STARmap mouse primary visual cortex (MPVC) data set (<xref rid="GR277891LIC57" ref-type="bibr">Wang et al. 2018</xref>) is available at <uri xlink:href="https://kangaroo-goby.squarespace.com/data">https://kangaroo-goby.squarespace.com/data</uri>. The 10x Visium dorsolateral prefrontal cortex (DLPFC) data set (<xref rid="GR277891LIC40" ref-type="bibr">Maynard et al. 2021</xref>) includes 12 slices from 3 neurotypical adult donors and is accessible through <uri xlink:href="http://spatial.libd.org/spatialLIBD">http://spatial.libd.org/spatialLIBD</uri>. The osmFISH mouse somatosensory cortex (MSC) data set (<xref rid="GR277891LIC13" ref-type="bibr">Codeluppi et al. 2018</xref>) is available at website <uri xlink:href="http://linnarssonlab.org/osmFISH/availability/">http://linnarssonlab.org/osmFISH/availability/</uri>. The Stereo-seq mouse olfactory bulb (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) Sections 1 (MOBS1) and Section 2 (MOBS2) are accessible at <uri xlink:href="https://db.cngb.org/stomics/mosta/download/">https://db.cngb.org/stomics/mosta/download/</uri>, where MOBS2 was taken as the reference data for MOBS1. The 10x Visium human breast cancer Section 1 (BCS1) was precisely annotated by <xref rid="GR277891LIC20" ref-type="bibr">Fu et al. (2021)</xref>, whereas Section 2 (BCS2) is not manually annotated, available at the 10x Genomics website <uri xlink:href="https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-1-1-standard-1-1-0">https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-1-1-standard-1-1-0</uri> and <uri xlink:href="https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-2-1-standard-1-1-0">https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-2-1-standard-1-1-0</uri>, respectively. The three Stereo-seq axolotl brain data sets (<xref rid="GR277891LIC58" ref-type="bibr">Wei et al. 2022</xref>) identified by 2DPI are available through the website <uri xlink:href="https://db.cngb.org/stomics/artista/download/">https://db.cngb.org/stomics/artista/download/</uri>. The Stereo-seq zebrafish embryo data set (<xref rid="GR277891LIC37" ref-type="bibr">Liu et al. 2022a</xref>) contains 12 slices of 12 h post-fertilization zebrafish embryo and can be downloaded from <uri xlink:href="https://db.cngb.org/stomics/zesta/download/">https://db.cngb.org/stomics/zesta/download/</uri>. The 10x Visium mouse brain coronal data set is accessible through <uri xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets/1.1.0/V1_Adult_Mouse_Brain">https://support.10xgenomics.com/spatial-gene-expression/datasets/1.1.0/V1_Adult_Mouse_Brain</uri>. The Stereo-seq mouse brain data set (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) can be downloaded from <uri xlink:href="https://db.cngb.org/stomics/mosta/download">https://db.cngb.org/stomics/mosta/download</uri>. The scRNA-seq mouse primary visual cortex data set was obtained from the NCBI Gene Expression Omnibus (GEO; <uri xlink:href="https://www.ncbi.nlm.nih.gov/geo/">https://www.ncbi.nlm.nih.gov/geo/</uri>) under accession number GSE71585.</p>
    </sec>
    <sec id="s3i">
      <title>Software availability</title>
      <p>The PAST algorithm is implemented in Python and the source code for reproduction is available at GitHub (<uri xlink:href="https://github.com/lizhen18THU/PAST">https://github.com/lizhen18THU/PAST</uri>) and <xref rid="SD9" ref-type="supplementary-material">Supplemental Code</xref>. We also provided detailed documentation and step-by-step tutorials for applying PAST to ST data generated by different technologies at Read the Docs website (<uri xlink:href="https://past.readthedocs.io/en/latest">https://past.readthedocs.io/en/latest</uri>).</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM1">
    <title>Supplementary Material</title>
    <supplementary-material id="SD1" position="float" content-type="local-data">
      <label>Supplement 1</label>
      <media xlink:href="Supplemental_Table_S1.xlsx" id="d64e3065" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD2" position="float" content-type="local-data">
      <label>Supplement 2</label>
      <media xlink:href="Supplemental_Table_S2.xlsx" id="d64e3068" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD3" position="float" content-type="local-data">
      <label>Supplement 3</label>
      <media xlink:href="Supplemental_Table_S3.xlsx" id="d64e3071" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD4" position="float" content-type="local-data">
      <label>Supplement 4</label>
      <media xlink:href="Supplemental_Table_S4.xlsx" id="d64e3074" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD5" position="float" content-type="local-data">
      <label>Supplement 5</label>
      <media xlink:href="Supplemental_Table_S5.xlsx" id="d64e3077" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD6" position="float" content-type="local-data">
      <label>Supplement 6</label>
      <media xlink:href="Supplemental_Table_S6.xlsx" id="d64e3080" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD7" position="float" content-type="local-data">
      <label>Supplement 7</label>
      <media xlink:href="Supplemental_Table_S7.xlsx" id="d64e3083" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD8" position="float" content-type="local-data">
      <label>Supplement 8</label>
      <media xlink:href="Supplemental_Table_S8.xlsx" id="d64e3086" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD9" position="float" content-type="local-data">
      <label>Supplement 9</label>
      <media xlink:href="Supplemental_Code.zip" id="d64e3089" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD10" position="float" content-type="local-data">
      <label>Supplement 10</label>
      <media xlink:href="Supplemental_Materials.pdf" id="d64e3092" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>This work was supported by the National Key Research and Development Program of China Grant No. 2021YFF1200902 (R.J.), the National Natural Science Foundation of China Grants No. 62203236 (S.C.), No. 62273194 (R.J.), No. 61721003 (X.Z.), and the Fundamental Research Funds for the Central Universities, Nankai University, Grant No. 63231137 (S.C.).</p>
    <p><italic>Author contributions:</italic> S.C. conceived the study and supervised the project. Z.L. and S.C. designed, implemented, and validated PAST. X.C. and X.Z. helped with analyzing the results. S.C., Z.L., X.Z., and R.J. wrote the manuscript, with input from all the authors.</p>
  </ack>
  <fn-group>
    <fn fn-type="supplementary-material">
      <p>[Supplemental material is available for this article.]</p>
    </fn>
    <fn>
      <p>Article published online before print. Article, supplemental material, and publication date are at <ext-link xlink:href="https://www.genome.org/cgi/doi/10.1101/gr.277891.123" ext-link-type="uri">https://www.genome.org/cgi/doi/10.1101/gr.277891.123</ext-link>.</p>
    </fn>
    <fn>
      <p>Freely available online through the <italic>Genome Research</italic> Open Access option.</p>
    </fn>
  </fn-group>
  <sec id="s5">
    <title>Competing interest statement</title>
    <p>The authors declare no competing interests.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="GR277891LIC1">
      <mixed-citation publication-type="journal"><string-name><surname>Abdelaal</surname><given-names>T</given-names></string-name>, <string-name><surname>Michielsen</surname><given-names>L</given-names></string-name>, <string-name><surname>Cats</surname><given-names>D</given-names></string-name>, <string-name><surname>Hoogduin</surname><given-names>D</given-names></string-name>, <string-name><surname>Mei</surname><given-names>H</given-names></string-name>, <string-name><surname>Reinders</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Mahfouz</surname><given-names>A</given-names></string-name>. <year>2019</year>. <article-title>A comparison of automatic cell identification methods for single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><volume>20</volume>: <fpage>194</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-019-1795-z</pub-id><pub-id pub-id-type="pmid">31500660</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC2">
      <mixed-citation publication-type="journal"><string-name><surname>Agirman</surname><given-names>G</given-names></string-name>, <string-name><surname>Broix</surname><given-names>L</given-names></string-name>, <string-name><surname>Nguyen</surname><given-names>L</given-names></string-name>. <year>2017</year>. <article-title>Cerebral cortex development: An outside-in perspective</article-title>. <source>FEBS Lett</source><volume>591</volume>: <fpage>3978</fpage>–<lpage>3992</lpage>. <pub-id pub-id-type="doi">10.1002/1873-3468.12924</pub-id><pub-id pub-id-type="pmid">29194577</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC3">
      <mixed-citation publication-type="journal"><string-name><surname>Armingol</surname><given-names>E</given-names></string-name>, <string-name><surname>Officer</surname><given-names>A</given-names></string-name>, <string-name><surname>Harismendy</surname><given-names>O</given-names></string-name>, <string-name><surname>Lewis</surname><given-names>NE</given-names></string-name>. <year>2021</year>. <article-title>Deciphering cell–cell interactions and communication from gene expression</article-title>. <source>Nat Rev Genet</source><volume>22</volume>: <fpage>71</fpage>–<lpage>88</lpage>. <pub-id pub-id-type="doi">10.1038/s41576-020-00292-x</pub-id><pub-id pub-id-type="pmid">33168968</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC4">
      <mixed-citation publication-type="journal"><string-name><surname>Asp</surname><given-names>M</given-names></string-name>, <string-name><surname>Bergenstråhle</surname><given-names>J</given-names></string-name>, <string-name><surname>Lundeberg</surname><given-names>J</given-names></string-name>. <year>2020</year>. <article-title>Spatially resolved transcriptomes—next generation tools for tissue exploration</article-title>. <source>Bioessays</source><volume>42</volume>: <fpage>1900221</fpage>. <pub-id pub-id-type="doi">10.1002/bies.201900221</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC5">
      <mixed-citation publication-type="confproc"><string-name><surname>Bai</surname><given-names>J</given-names></string-name>, <string-name><surname>Ren</surname><given-names>Y</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>Ripple walk training: a subgraph-based training framework for large and deep graph neural network</article-title>. In <conf-name>International Joint Conference on Neural Networks</conf-name>. <comment>IEEE, Shenzhen</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC6">
      <mixed-citation publication-type="journal"><string-name><surname>Bitar</surname><given-names>M</given-names></string-name>, <string-name><surname>Weissleder</surname><given-names>C</given-names></string-name>, <string-name><surname>North</surname><given-names>HF</given-names></string-name>, <string-name><surname>Clearwater</surname><given-names>MS</given-names></string-name>, <string-name><surname>Zalucki</surname><given-names>O</given-names></string-name>, <string-name><surname>Halliday</surname><given-names>GM</given-names></string-name>, <string-name><surname>Webster</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Piper</surname><given-names>M</given-names></string-name>, <string-name><surname>Weickert</surname><given-names>CS</given-names></string-name>, <string-name><surname>Barry</surname><given-names>G</given-names></string-name>. <year>2022</year>. <article-title>Identifying gene expression profiles associated with neurogenesis and inflammation in the human subependymal zone from development through aging</article-title>. <source>Sci Rep</source><volume>12</volume>: <fpage>40</fpage>. <pub-id pub-id-type="doi">10.1038/s41598-021-03976-4</pub-id><pub-id pub-id-type="pmid">34997023</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC7">
      <mixed-citation publication-type="confproc"><string-name><surname>Blundell</surname><given-names>C</given-names></string-name>, <string-name><surname>Cornebise</surname><given-names>J</given-names></string-name>, <string-name><surname>Kavukcuoglu</surname><given-names>K</given-names></string-name>, <string-name><surname>Wierstra</surname><given-names>D</given-names></string-name>. <year>2015</year>. <article-title>Weight</article-title><article-title>uncertainty in neural network</article-title>. In <conf-name>International Conference on Machine Learning</conf-name>. <comment>PMLR, Lille</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC8">
      <mixed-citation publication-type="journal"><string-name><surname>Chang</surname><given-names>Y-T</given-names></string-name>, <string-name><surname>Tsai</surname><given-names>W-C</given-names></string-name>, <string-name><surname>Lin</surname><given-names>W-Z</given-names></string-name>, <string-name><surname>Wu</surname><given-names>C-C</given-names></string-name>, <string-name><surname>Yu</surname><given-names>J-C</given-names></string-name>, <string-name><surname>Tseng</surname><given-names>VS</given-names></string-name>, <string-name><surname>Liao</surname><given-names>G-S</given-names></string-name>, <string-name><surname>Hu</surname><given-names>J-M</given-names></string-name>, <string-name><surname>Hsu</surname><given-names>H-M</given-names></string-name>, <string-name><surname>Chang</surname><given-names>Y-J</given-names></string-name>. <year>2021</year>. <article-title>A novel IGLC2 gene linked with prognosis of triple-negative breast cancer</article-title>. <source>Front Oncol</source><volume>11</volume>: <fpage>759952</fpage>. <pub-id pub-id-type="doi">10.3389/fonc.2021.759952</pub-id><pub-id pub-id-type="pmid">35155184</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC9">
      <mixed-citation publication-type="journal"><string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Yan</surname><given-names>G</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>W</given-names></string-name>, <string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>R</given-names></string-name>, <string-name><surname>Lin</surname><given-names>Z</given-names></string-name>. <year>2021</year>. <article-title>RA3 is a reference-guided approach for epigenetic characterization of single cells</article-title>. <source>Nat Commun</source><volume>12</volume>: <fpage>2177</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-021-22495-4</pub-id><pub-id pub-id-type="pmid">33846355</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC10">
      <mixed-citation publication-type="journal"><string-name><surname>Chen</surname><given-names>A</given-names></string-name>, <string-name><surname>Liao</surname><given-names>S</given-names></string-name>, <string-name><surname>Cheng</surname><given-names>M</given-names></string-name>, <string-name><surname>Ma</surname><given-names>K</given-names></string-name>, <string-name><surname>Wu</surname><given-names>L</given-names></string-name>, <string-name><surname>Lai</surname><given-names>Y</given-names></string-name>, <string-name><surname>Qiu</surname><given-names>X</given-names></string-name>, <string-name><surname>Yang</surname><given-names>J</given-names></string-name>, <string-name><surname>Xu</surname><given-names>J</given-names></string-name>, <string-name><surname>Hao</surname><given-names>S</given-names></string-name>, <etal/><year>2022a</year>. <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>. <source>Cell</source><volume>185</volume>: <fpage>1777</fpage>–<lpage>1792.e21</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2022.04.003</pub-id><pub-id pub-id-type="pmid">35512705</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC11">
      <mixed-citation publication-type="journal"><string-name><surname>Chen</surname><given-names>X</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Song</surname><given-names>S</given-names></string-name>, <string-name><surname>Gao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Hou</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>X</given-names></string-name>, <string-name><surname>Lv</surname><given-names>H</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>R</given-names></string-name>. <year>2022b</year>. <article-title>Cell type annotation of single-cell chromatin accessibility data via supervised Bayesian embedding</article-title>. <source>Nat Mach Intell</source><volume>4</volume>: <fpage>116</fpage>–<lpage>126</lpage>. <pub-id pub-id-type="doi">10.1038/s42256-021-00432-w</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC12">
      <mixed-citation publication-type="journal"><string-name><surname>Cheng</surname><given-names>A</given-names></string-name>, <string-name><surname>Hu</surname><given-names>G</given-names></string-name>, <string-name><surname>Li</surname><given-names>WV</given-names></string-name>. <year>2022</year>. <article-title>Benchmarking cell-type clustering methods for spatially resolved transcriptomics data</article-title>. <source>Brief Bioinform</source><volume>24</volume>: <fpage>bbac475</fpage>. <pub-id pub-id-type="doi">10.1093/bib/bbac475</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC13">
      <mixed-citation publication-type="journal"><string-name><surname>Codeluppi</surname><given-names>S</given-names></string-name>, <string-name><surname>Borm</surname><given-names>LE</given-names></string-name>, <string-name><surname>Zeisel</surname><given-names>A</given-names></string-name>, <string-name><surname>La Manno</surname><given-names>G</given-names></string-name>, <string-name><surname>van Lunteren</surname><given-names>JA</given-names></string-name>, <string-name><surname>Svensson</surname><given-names>CI</given-names></string-name>, <string-name><surname>Linnarsson</surname><given-names>S</given-names></string-name>. <year>2018</year>. <article-title>Spatial organization of the somatosensory cortex revealed by osmFISH</article-title>. <source>Nat Methods</source><volume>15</volume>: <fpage>932</fpage>–<lpage>935</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-018-0175-z</pub-id><pub-id pub-id-type="pmid">30377364</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC14">
      <mixed-citation publication-type="journal"><string-name><surname>Crosetto</surname><given-names>N</given-names></string-name>, <string-name><surname>Bienko</surname><given-names>M</given-names></string-name>, <string-name><surname>Van Oudenaarden</surname><given-names>A</given-names></string-name>. <year>2015</year>. <article-title>Spatially resolved transcriptomics and beyond</article-title>. <source>Nat Rev Genet</source><volume>16</volume>: <fpage>57</fpage>–<lpage>66</lpage>. <pub-id pub-id-type="doi">10.1038/nrg3832</pub-id><pub-id pub-id-type="pmid">25446315</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC15">
      <mixed-citation publication-type="journal"><string-name><surname>Deng</surname><given-names>Y</given-names></string-name>, <string-name><surname>Bartosovic</surname><given-names>M</given-names></string-name>, <string-name><surname>Ma</surname><given-names>S</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>D</given-names></string-name>, <string-name><surname>Kukanja</surname><given-names>P</given-names></string-name>, <string-name><surname>Xiao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Su</surname><given-names>G</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Qin</surname><given-names>X</given-names></string-name>, <string-name><surname>Rosoklija</surname><given-names>GB</given-names></string-name>, <etal/><year>2022</year>. <article-title>Spatial profiling of chromatin accessibility in mouse and human tissues</article-title>. <source>Nature</source><volume>609</volume>: <fpage>375</fpage>–<lpage>383</lpage>. <pub-id pub-id-type="doi">10.1038/s41586-022-05094-1</pub-id><pub-id pub-id-type="pmid">35978191</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC16">
      <mixed-citation publication-type="journal"><string-name><surname>Dong</surname><given-names>K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>S</given-names></string-name>. <year>2022</year>. <article-title>Deciphering spatial domains from spatially resolved transcriptomics with an adaptive graph attention autoencoder</article-title>. <source>Nat Commun</source><volume>13</volume>: <fpage>1739</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-022-29439-6</pub-id><pub-id pub-id-type="pmid">35365632</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC17">
      <mixed-citation publication-type="journal"><string-name><surname>Dries</surname><given-names>R</given-names></string-name>, <string-name><surname>Chen</surname><given-names>J</given-names></string-name>, <string-name><surname>Del Rossi</surname><given-names>N</given-names></string-name>, <string-name><surname>Khan</surname><given-names>MM</given-names></string-name>, <string-name><surname>Sistig</surname><given-names>A</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>G-C</given-names></string-name>. <year>2021</year>. <article-title>Advances in spatial transcriptomic data analysis</article-title>. <source>Genome Res</source><volume>31</volume>: <fpage>1706</fpage>–<lpage>1718</lpage>. <pub-id pub-id-type="doi">10.1101/gr.275224.121</pub-id><pub-id pub-id-type="pmid">34599004</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC18">
      <mixed-citation publication-type="journal"><string-name><surname>Fan</surname><given-names>Z</given-names></string-name>, <string-name><surname>Chen</surname><given-names>R</given-names></string-name>, <string-name><surname>Chen</surname><given-names>X</given-names></string-name>. <year>2020</year>. <article-title>SpatialDB: a database for spatially resolved transcriptomes</article-title>. <source>Nucleic Acids Res</source><volume>48</volume>: <fpage>D233</fpage>–<lpage>D237</lpage>. <pub-id pub-id-type="doi">10.1093/nar/gkz934</pub-id><pub-id pub-id-type="pmid">31713629</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC19">
      <mixed-citation publication-type="journal"><string-name><surname>Friess</surname><given-names>C</given-names></string-name>, <string-name><surname>Gotz</surname><given-names>M</given-names></string-name>, <string-name><surname>Kjell</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>Cryo-section dissection of the adult subependymal zone for accurate and deep quantitative proteome analysis</article-title>. <source>J Vis Exp</source><comment><bold>176:</bold> e63047</comment>. <pub-id pub-id-type="doi">10.3791/63047</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC20">
      <mixed-citation publication-type="other"><string-name><surname>Fu</surname><given-names>H</given-names></string-name>, <string-name><surname>Xu</surname><given-names>H</given-names></string-name>, <string-name><surname>Chong</surname><given-names>K</given-names></string-name>, <string-name><surname>Li</surname><given-names>M</given-names></string-name>, <string-name><surname>Ang</surname><given-names>KS</given-names></string-name>, <string-name><surname>Lee</surname><given-names>HK</given-names></string-name>, <string-name><surname>Ling</surname><given-names>J</given-names></string-name>, <string-name><surname>Chen</surname><given-names>A</given-names></string-name>, <string-name><surname>Shao</surname><given-names>L</given-names></string-name>, <string-name><surname>Liu</surname><given-names>L</given-names></string-name>. <year>2021</year>. <article-title>Unsupervised spatially embedded deep representation of spatial transcriptomics</article-title>. <source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2021.06.15.448542</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC21">
      <mixed-citation publication-type="other"><string-name><surname>Gao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Chen</surname><given-names>X</given-names></string-name>, <string-name><surname>Li</surname><given-names>Z</given-names></string-name>, <string-name><surname>Cui</surname><given-names>X</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>Q</given-names></string-name>, <string-name><surname>Li</surname><given-names>K</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>R</given-names></string-name>. <year>2023</year>. <article-title>scEpiTools: a database to comprehensively interrogate analytic tools for single-cell epigenomic data</article-title>. <source>J Genet Genomics</source><pub-id pub-id-type="doi">10.1016/j.jgg.2023.09.011</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC22">
      <mixed-citation publication-type="journal"><string-name><surname>Gilmore</surname><given-names>EC</given-names></string-name>, <string-name><surname>Herrup</surname><given-names>K</given-names></string-name>. <year>1997</year>. <article-title>Cortical development: Layers of complexity</article-title>. <source>Curr Biol</source><volume>7</volume>: <fpage>R231</fpage>–<lpage>R234</lpage>. <pub-id pub-id-type="doi">10.1016/S0960-9822(06)00108-4</pub-id><pub-id pub-id-type="pmid">9162498</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC23">
      <mixed-citation publication-type="confproc"><string-name><surname>Hadsell</surname><given-names>R</given-names></string-name>, <string-name><surname>Chopra</surname><given-names>S</given-names></string-name>, <string-name><surname>LeCun</surname><given-names>Y</given-names></string-name>. <year>2006</year>. <article-title>Dimensionality reduction by learning an invariant mapping</article-title>. In <conf-name>IEEE Computer Society Conference on Computer Vision and Pattern Recognition</conf-name>. <publisher-name>IEEE</publisher-name>, <publisher-loc>New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC24">
      <mixed-citation publication-type="journal"><string-name><surname>Haghverdi</surname><given-names>L</given-names></string-name>, <string-name><surname>Büttner</surname><given-names>M</given-names></string-name>, <string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Buettner</surname><given-names>F</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2016</year>. <article-title>Diffusion pseudotime robustly reconstructs lineage branching</article-title>. <source>Nat Methods</source><volume>13</volume>: <fpage>845</fpage>–<lpage>848</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.3971</pub-id><pub-id pub-id-type="pmid">27571553</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC25">
      <mixed-citation publication-type="journal"><string-name><surname>Hao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Hao</surname><given-names>S</given-names></string-name>, <string-name><surname>Andersen-Nissen</surname><given-names>E</given-names></string-name>, <string-name><surname>Mauck</surname><given-names>WM</given-names><suffix>III</suffix></string-name>, <string-name><surname>Zheng</surname><given-names>S</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Lee</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Wilk</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Darby</surname><given-names>C</given-names></string-name>, <string-name><surname>Zager</surname><given-names>M</given-names></string-name>, <etal/><year>2021</year>. <article-title>Integrated analysis of multimodal single-cell data</article-title>. <source>Cell</source><volume>184</volume>: <fpage>3573</fpage>–<lpage>3587.e29</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id><pub-id pub-id-type="pmid">34062119</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC26">
      <mixed-citation publication-type="journal"><string-name><surname>Haque</surname><given-names>A</given-names></string-name>, <string-name><surname>Engel</surname><given-names>J</given-names></string-name>, <string-name><surname>Teichmann</surname><given-names>SA</given-names></string-name>, <string-name><surname>Lönnberg</surname><given-names>T</given-names></string-name>. <year>2017</year>. <article-title>A practical guide to single-cell RNA-sequencing for biomedical research and clinical applications</article-title>. <source>Genome Med</source><volume>9</volume>: <fpage>75</fpage>. <pub-id pub-id-type="doi">10.1186/s13073-017-0467-4</pub-id><pub-id pub-id-type="pmid">28821273</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC27">
      <mixed-citation publication-type="journal"><string-name><surname>Hu</surname><given-names>J</given-names></string-name>, <string-name><surname>Li</surname><given-names>X</given-names></string-name>, <string-name><surname>Coleman</surname><given-names>K</given-names></string-name>, <string-name><surname>Schroeder</surname><given-names>A</given-names></string-name>, <string-name><surname>Ma</surname><given-names>N</given-names></string-name>, <string-name><surname>Irwin</surname><given-names>DJ</given-names></string-name>, <string-name><surname>Lee</surname><given-names>EB</given-names></string-name>, <string-name><surname>Shinohara</surname><given-names>RT</given-names></string-name>, <string-name><surname>Li</surname><given-names>M</given-names></string-name>. <year>2021a</year>. <article-title>SpaGCN: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>. <source>Nat Methods</source><volume>18</volume>: <fpage>1342</fpage>–<lpage>1351</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-021-01255-8</pub-id><pub-id pub-id-type="pmid">34711970</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC28">
      <mixed-citation publication-type="journal"><string-name><surname>Hu</surname><given-names>J</given-names></string-name>, <string-name><surname>Schroeder</surname><given-names>A</given-names></string-name>, <string-name><surname>Coleman</surname><given-names>K</given-names></string-name>, <string-name><surname>Chen</surname><given-names>C</given-names></string-name>, <string-name><surname>Auerbach</surname><given-names>BJ</given-names></string-name>, <string-name><surname>Li</surname><given-names>M</given-names></string-name>. <year>2021b</year>. <article-title>Statistical and machine learning methods for spatially resolved transcriptomics with histology</article-title>. <source>Comput Struct Biotechnol J</source><volume>19</volume>: <fpage>3829</fpage>–<lpage>3841</lpage>. <pub-id pub-id-type="doi">10.1016/j.csbj.2021.06.052</pub-id><pub-id pub-id-type="pmid">34285782</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC29">
      <mixed-citation publication-type="journal"><string-name><surname>Jiang</surname><given-names>R</given-names></string-name>, <string-name><surname>Li</surname><given-names>Z</given-names></string-name>, <string-name><surname>Jia</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>S</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>. <year>2023</year>. <article-title>SINFONIA: Scalable identification of spatially variable genes for deciphering spatial domains</article-title>. <source>Cells</source><volume>12</volume>: <fpage>604</fpage>. <pub-id pub-id-type="doi">10.3390/cells12040604</pub-id><pub-id pub-id-type="pmid">36831270</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC30">
      <mixed-citation publication-type="journal"><string-name><surname>Kazanis</surname><given-names>I</given-names></string-name>. <year>2009</year>. <article-title>The subependymal zone neurogenic niche: a beating heart in the centre of the brain: How plastic is adult neurogenesis? Opportunities for therapy and questions to be addressed</article-title>. <source>Brain</source><volume>132</volume>: <fpage>2909</fpage>–<lpage>2921</lpage>. <pub-id pub-id-type="doi">10.1093/brain/awp237</pub-id><pub-id pub-id-type="pmid">19773354</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC31">
      <mixed-citation publication-type="book"><string-name><surname>Kingma</surname><given-names>DP</given-names></string-name>, <string-name><surname>Welling</surname><given-names>M</given-names></string-name>. <year>2014</year>. <article-title>Auto-encoding variational Bayes</article-title>. In <source>International Conference on Learning Representations</source>, <publisher-name>ICLR</publisher-name>, <publisher-loc>Banff, Canada</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC32">
      <mixed-citation publication-type="journal"><string-name><surname>Lareau</surname><given-names>CA</given-names></string-name>, <string-name><surname>Duarte</surname><given-names>FM</given-names></string-name>, <string-name><surname>Chew</surname><given-names>JG</given-names></string-name>, <string-name><surname>Kartha</surname><given-names>VK</given-names></string-name>, <string-name><surname>Burkett</surname><given-names>ZD</given-names></string-name>, <string-name><surname>Kohlway</surname><given-names>AS</given-names></string-name>, <string-name><surname>Pokholok</surname><given-names>D</given-names></string-name>, <string-name><surname>Aryee</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Steemers</surname><given-names>FJ</given-names></string-name>, <string-name><surname>Lebofsky</surname><given-names>R</given-names></string-name>, <etal/><year>2019</year>. <article-title>Droplet-based combinatorial indexing for massive-scale single-cell chromatin accessibility</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>916</fpage>–<lpage>924</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0147-6</pub-id><pub-id pub-id-type="pmid">31235917</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC33">
      <mixed-citation publication-type="journal"><string-name><surname>Larsson</surname><given-names>L</given-names></string-name>, <string-name><surname>Frisén</surname><given-names>J</given-names></string-name>, <string-name><surname>Lundeberg</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>Spatially resolved transcriptomics adds a new dimension to genomics</article-title>. <source>Nat Methods</source><volume>18</volume>: <fpage>15</fpage>–<lpage>18</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-020-01038-7</pub-id><pub-id pub-id-type="pmid">33408402</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC34">
      <mixed-citation publication-type="journal"><string-name><surname>Li</surname><given-names>H</given-names></string-name>, <string-name><surname>Courtois</surname><given-names>ET</given-names></string-name>, <string-name><surname>Sengupta</surname><given-names>D</given-names></string-name>, <string-name><surname>Tan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Chen</surname><given-names>KH</given-names></string-name>, <string-name><surname>Goh</surname><given-names>JJL</given-names></string-name>, <string-name><surname>Kong</surname><given-names>SL</given-names></string-name>, <string-name><surname>Chua</surname><given-names>C</given-names></string-name>, <string-name><surname>Hon</surname><given-names>LK</given-names></string-name>, <string-name><surname>Tan</surname><given-names>WS</given-names></string-name>, <etal/><year>2017</year>. <article-title>Reference component analysis of single-cell transcriptomes elucidates cellular heterogeneity in human colorectal tumors</article-title>. <source>Nat Genet</source><volume>49</volume>: <fpage>708</fpage>–<lpage>718</lpage>. <pub-id pub-id-type="doi">10.1038/ng.3818</pub-id><pub-id pub-id-type="pmid">28319088</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC35">
      <mixed-citation publication-type="journal"><string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Pan</surname><given-names>X</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Shen</surname><given-names>H-B</given-names></string-name>. <year>2022</year>. <article-title>Cell clustering for spatial transcriptomics data with graph neural networks</article-title>. <source>Nat Comput Sci</source><volume>2</volume>: <fpage>399</fpage>–<lpage>408</lpage>. <pub-id pub-id-type="doi">10.1038/s43588-022-00266-5</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC36">
      <mixed-citation publication-type="book"><string-name><surname>Liu</surname><given-names>A</given-names></string-name>, <string-name><surname>Xu</surname><given-names>N</given-names></string-name>, <string-name><surname>Liu</surname><given-names>H</given-names></string-name>. <year>2021</year>. <article-title>Self-attention graph residual convolutional networks for event detection with dependency relations</article-title>. In <source>Findings of the Association for Computational Linguistics</source>. <publisher-name>Association for Computational Linguistics</publisher-name>, <publisher-loc>Punta Cana, Dominican Republic</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC37">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>C</given-names></string-name>, <string-name><surname>Li</surname><given-names>R</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>, <string-name><surname>Lin</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>K</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Q</given-names></string-name>, <string-name><surname>Wang</surname><given-names>S</given-names></string-name>, <string-name><surname>Yang</surname><given-names>X</given-names></string-name>, <string-name><surname>Shi</surname><given-names>X</given-names></string-name>, <string-name><surname>Ma</surname><given-names>Y</given-names></string-name>, <etal/><year>2022a</year>. <article-title>Spatiotemporal mapping of gene expression landscapes and developmental trajectories during zebrafish embryogenesis</article-title>. <source>Dev Cell</source><volume>57</volume>: <fpage>1284</fpage>–<lpage>1298.e5</lpage>. <pub-id pub-id-type="doi">10.1016/j.devcel.2022.04.009</pub-id><pub-id pub-id-type="pmid">35512701</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC38">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>W</given-names></string-name>, <string-name><surname>Liao</surname><given-names>X</given-names></string-name>, <string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Lin</surname><given-names>H</given-names></string-name>, <string-name><surname>Yeong</surname><given-names>J</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>X</given-names></string-name>, <string-name><surname>Shi</surname><given-names>X</given-names></string-name>, <string-name><surname>Liu</surname><given-names>J</given-names></string-name>. <year>2022b</year>. <article-title>Joint dimension reduction and clustering analysis of single-cell RNA-seq and spatial transcriptomics data</article-title>. <source>Nucleic Acids Res</source><volume>50</volume>: <fpage>e72</fpage>. <pub-id pub-id-type="doi">10.1093/nar/gkac219</pub-id><pub-id pub-id-type="pmid">35349708</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC39">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Sun</surname><given-names>D</given-names></string-name>, <string-name><surname>Wang</surname><given-names>C</given-names></string-name>. <year>2022c</year>. <article-title>Evaluation of cell-cell interaction methods by integrating single-cell RNA sequencing data with spatial information</article-title>. <source>Genome Biol</source><volume>23</volume>: <fpage>218</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-021-02568-9</pub-id><pub-id pub-id-type="pmid">36253792</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC40">
      <mixed-citation publication-type="journal"><string-name><surname>Maynard</surname><given-names>KR</given-names></string-name>, <string-name><surname>Collado-Torres</surname><given-names>L</given-names></string-name>, <string-name><surname>Weber</surname><given-names>LM</given-names></string-name>, <string-name><surname>Uytingco</surname><given-names>C</given-names></string-name>, <string-name><surname>Barry</surname><given-names>BK</given-names></string-name>, <string-name><surname>Williams</surname><given-names>SR</given-names></string-name>, <string-name><surname>Catallini</surname><given-names>JL</given-names></string-name>, <string-name><surname>Tran</surname><given-names>MN</given-names></string-name>, <string-name><surname>Besich</surname><given-names>Z</given-names></string-name>, <string-name><surname>Tippani</surname><given-names>M</given-names></string-name>, <etal/><year>2021</year>. <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>. <source>Nat Neurosci</source><volume>24</volume>: <fpage>425</fpage>–<lpage>436</lpage>. <pub-id pub-id-type="doi">10.1038/s41593-020-00787-0</pub-id><pub-id pub-id-type="pmid">33558695</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC41">
      <mixed-citation publication-type="journal"><string-name><surname>Menn</surname><given-names>B</given-names></string-name>, <string-name><surname>Garcia-Verdugo</surname><given-names>JM</given-names></string-name>, <string-name><surname>Yaschine</surname><given-names>C</given-names></string-name>, <string-name><surname>Gonzalez-Perez</surname><given-names>O</given-names></string-name>, <string-name><surname>Rowitch</surname><given-names>D</given-names></string-name>, <string-name><surname>Alvarez-Buylla</surname><given-names>A</given-names></string-name>. <year>2006</year>. <article-title>Origin of oligodendrocytes in the subventricular zone of the adult brain</article-title>. <source>J Neurosci</source><volume>26</volume>: <fpage>7907</fpage>–<lpage>7918</lpage>. <pub-id pub-id-type="doi">10.1523/JNEUROSCI.1299-06.2006</pub-id><pub-id pub-id-type="pmid">16870736</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC42">
      <mixed-citation publication-type="journal"><string-name><surname>Moses</surname><given-names>L</given-names></string-name>, <string-name><surname>Pachter</surname><given-names>L</given-names></string-name>. <year>2022</year>. <article-title>Museum of spatial transcriptomics</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>534</fpage>–<lpage>546</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-022-01409-2</pub-id><pub-id pub-id-type="pmid">35273392</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC43">
      <mixed-citation publication-type="journal"><string-name><surname>Oxelius</surname><given-names>V-A</given-names></string-name>, <string-name><surname>Pandey</surname><given-names>JP</given-names></string-name>. <year>2013</year>. <article-title>Human immunoglobulin constant heavy G chain (IGHG) (Fcγ) (GM) genes, defining innate variants of IgG molecules and B cells, have impact on disease and therapy</article-title>. <source>Clin Immunol</source><volume>149</volume>: <fpage>475</fpage>–<lpage>486</lpage>. <pub-id pub-id-type="doi">10.1016/j.clim.2013.10.003</pub-id><pub-id pub-id-type="pmid">24239836</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC44">
      <mixed-citation publication-type="journal"><string-name><surname>Palla</surname><given-names>G</given-names></string-name>, <string-name><surname>Spitzer</surname><given-names>H</given-names></string-name>, <string-name><surname>Klein</surname><given-names>M</given-names></string-name>, <string-name><surname>Fischer</surname><given-names>D</given-names></string-name>, <string-name><surname>Schaar</surname><given-names>AC</given-names></string-name>, <string-name><surname>Kuemmerle</surname><given-names>LB</given-names></string-name>, <string-name><surname>Rybakov</surname><given-names>S</given-names></string-name>, <string-name><surname>Ibarra</surname><given-names>IL</given-names></string-name>, <string-name><surname>Holmberg</surname><given-names>O</given-names></string-name>, <string-name><surname>Virshup</surname><given-names>I</given-names></string-name>, <etal/><year>2022</year>. <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>171</fpage>–<lpage>178</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-021-01358-2</pub-id><pub-id pub-id-type="pmid">35102346</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC45">
      <mixed-citation publication-type="journal"><string-name><surname>Qiu</surname><given-names>P</given-names></string-name>. <year>2020</year>. <article-title>Embracing the dropouts in single-cell RNA-seq analysis</article-title>. <source>Nat Commun</source><volume>11</volume>: <fpage>1169</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-020-14976-9</pub-id><pub-id pub-id-type="pmid">32127540</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC46">
      <mixed-citation publication-type="journal"><string-name><surname>Raffel</surname><given-names>C</given-names></string-name>, <string-name><surname>Shazeer</surname><given-names>N</given-names></string-name>, <string-name><surname>Roberts</surname><given-names>A</given-names></string-name>, <string-name><surname>Lee</surname><given-names>K</given-names></string-name>, <string-name><surname>Narang</surname><given-names>S</given-names></string-name>, <string-name><surname>Matena</surname><given-names>M</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>W</given-names></string-name>, <string-name><surname>Liu</surname><given-names>PJ</given-names></string-name>. <year>2020</year>. <article-title>Exploring the limits of transfer learning with a unified text-to-text transformer</article-title>. <source>J Mach Learn Res</source><volume>21</volume>: <fpage>1</fpage>–<lpage>67</lpage>.<pub-id pub-id-type="pmid">34305477</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC47">
      <mixed-citation publication-type="journal"><string-name><surname>Rodriques</surname><given-names>SG</given-names></string-name>, <string-name><surname>Stickels</surname><given-names>RR</given-names></string-name>, <string-name><surname>Goeva</surname><given-names>A</given-names></string-name>, <string-name><surname>Martin</surname><given-names>CA</given-names></string-name>, <string-name><surname>Murray</surname><given-names>E</given-names></string-name>, <string-name><surname>Vanderburg</surname><given-names>CR</given-names></string-name>, <string-name><surname>Welch</surname><given-names>J</given-names></string-name>, <string-name><surname>Chen</surname><given-names>LM</given-names></string-name>, <string-name><surname>Chen</surname><given-names>F</given-names></string-name>, <string-name><surname>Macosko</surname><given-names>EZ</given-names></string-name>. <year>2019</year>. <article-title>Slide-seq: a scalable technology for measuring genome-wide expression at high spatial resolution</article-title>. <source>Science</source><volume>363</volume>: <fpage>1463</fpage>–<lpage>1467</lpage>. <pub-id pub-id-type="doi">10.1126/science.aaw1219</pub-id><pub-id pub-id-type="pmid">30923225</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC48">
      <mixed-citation publication-type="journal"><string-name><surname>Schmidt</surname><given-names>M</given-names></string-name>, <string-name><surname>Micke</surname><given-names>P</given-names></string-name>, <string-name><surname>Gehrmann</surname><given-names>M</given-names></string-name>, <string-name><surname>Hengstler</surname><given-names>JG</given-names></string-name>. <year>2012</year>. <article-title>Immunoglobulin kappa chain as an immunologic biomarker of prognosis and chemotherapy response in solid tumors</article-title>. <source>Oncoimmunology</source><volume>1</volume>: <fpage>1156</fpage>–<lpage>1158</lpage>. <pub-id pub-id-type="doi">10.4161/onci.21653</pub-id><pub-id pub-id-type="pmid">23170262</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC49">
      <mixed-citation publication-type="journal"><string-name><surname>Shang</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>X</given-names></string-name>. <year>2022</year>. <article-title>Spatially aware dimension reduction for spatial transcriptomics</article-title>. <source>Nat Commun</source><volume>13</volume>: <fpage>7203</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-022-34879-1</pub-id><pub-id pub-id-type="pmid">36418351</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC50">
      <mixed-citation publication-type="journal"><string-name><surname>Shengquan</surname><given-names>C</given-names></string-name>, <string-name><surname>Boheng</surname><given-names>Z</given-names></string-name>, <string-name><surname>Xiaoyang</surname><given-names>C</given-names></string-name>, <string-name><surname>Xuegong</surname><given-names>Z</given-names></string-name>, <string-name><surname>Rui</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>stPlus: a reference-based method for the accurate enhancement of spatial transcriptomics</article-title>. <source>Bioinformatics</source><volume>37</volume>: <fpage>i299</fpage>–<lpage>i307</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btab298</pub-id><pub-id pub-id-type="pmid">34252941</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC51">
      <mixed-citation publication-type="journal"><string-name><surname>Ståhl</surname><given-names>PL</given-names></string-name>, <string-name><surname>Salmén</surname><given-names>F</given-names></string-name>, <string-name><surname>Vickovic</surname><given-names>S</given-names></string-name>, <string-name><surname>Lundmark</surname><given-names>A</given-names></string-name>, <string-name><surname>Navarro</surname><given-names>JF</given-names></string-name>, <string-name><surname>Magnusson</surname><given-names>J</given-names></string-name>, <string-name><surname>Giacomello</surname><given-names>S</given-names></string-name>, <string-name><surname>Asp</surname><given-names>M</given-names></string-name>, <string-name><surname>Westholm</surname><given-names>JO</given-names></string-name>, <string-name><surname>Huss</surname><given-names>M</given-names></string-name>, <etal/><year>2016</year>. <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>. <source>Science</source><volume>353</volume>: <fpage>78</fpage>–<lpage>82</lpage>. <pub-id pub-id-type="doi">10.1126/science.aaf2403</pub-id><pub-id pub-id-type="pmid">27365449</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC52">
      <mixed-citation publication-type="journal"><string-name><surname>Stickels</surname><given-names>RR</given-names></string-name>, <string-name><surname>Murray</surname><given-names>E</given-names></string-name>, <string-name><surname>Kumar</surname><given-names>P</given-names></string-name>, <string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Marshall</surname><given-names>JL</given-names></string-name>, <string-name><surname>Di Bella</surname><given-names>DJ</given-names></string-name>, <string-name><surname>Arlotta</surname><given-names>P</given-names></string-name>, <string-name><surname>Macosko</surname><given-names>EZ</given-names></string-name>, <string-name><surname>Chen</surname><given-names>F</given-names></string-name>. <year>2021</year>. <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with slide-seqV2</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>313</fpage>–<lpage>319</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-020-0739-1</pub-id><pub-id pub-id-type="pmid">33288904</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC53">
      <mixed-citation publication-type="journal"><string-name><surname>Tasic</surname><given-names>B</given-names></string-name>, <string-name><surname>Menon</surname><given-names>V</given-names></string-name>, <string-name><surname>Nguyen</surname><given-names>TN</given-names></string-name>, <string-name><surname>Kim</surname><given-names>TK</given-names></string-name>, <string-name><surname>Jarsky</surname><given-names>T</given-names></string-name>, <string-name><surname>Yao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Levi</surname><given-names>B</given-names></string-name>, <string-name><surname>Gray</surname><given-names>LT</given-names></string-name>, <string-name><surname>Sorensen</surname><given-names>SA</given-names></string-name>, <string-name><surname>Dolbeare</surname><given-names>T</given-names></string-name>, <etal/><year>2016</year>. <article-title>Adult mouse cortical cell taxonomy revealed by single cell transcriptomics</article-title>. <source>Nat Neurosci</source><volume>19</volume>: <fpage>335</fpage>–<lpage>346</lpage>. <pub-id pub-id-type="doi">10.1038/nn.4216</pub-id><pub-id pub-id-type="pmid">26727548</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC54">
      <mixed-citation publication-type="journal"><string-name><surname>Townes</surname><given-names>FW</given-names></string-name>, <string-name><surname>Engelhardt</surname><given-names>BE</given-names></string-name>. <year>2023</year>. <article-title>Nonnegative spatial factorization applied to spatial genomics</article-title>. <source>Nat Methods</source><volume>20</volume>: <fpage>229</fpage>–<lpage>238</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-022-01687-w</pub-id><pub-id pub-id-type="pmid">36587187</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC55">
      <mixed-citation publication-type="confproc"><string-name><surname>Vaswani</surname><given-names>A</given-names></string-name>, <string-name><surname>Shazeer</surname><given-names>N</given-names></string-name>, <string-name><surname>Parmar</surname><given-names>N</given-names></string-name>, <string-name><surname>Uszkoreit</surname><given-names>J</given-names></string-name>, <string-name><surname>Jones</surname><given-names>L</given-names></string-name>, <string-name><surname>Gomez</surname><given-names>AN</given-names></string-name>, <string-name><surname>Kaiser</surname><given-names>Ł</given-names></string-name>, <string-name><surname>Polosukhin</surname><given-names>I</given-names></string-name>. <year>2017</year>. <article-title>Attention is all you need</article-title>. In <conf-name>Conference on Neural Information Processing Systems</conf-name>. <comment>Curran Associates, Long Beach, CA</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC56">
      <mixed-citation publication-type="journal"><string-name><surname>Vickovic</surname><given-names>S</given-names></string-name>, <string-name><surname>Eraslan</surname><given-names>G</given-names></string-name>, <string-name><surname>Salmén</surname><given-names>F</given-names></string-name>, <string-name><surname>Klughammer</surname><given-names>J</given-names></string-name>, <string-name><surname>Stenbeck</surname><given-names>L</given-names></string-name>, <string-name><surname>Schapiro</surname><given-names>D</given-names></string-name>, <string-name><surname>Äijö</surname><given-names>T</given-names></string-name>, <string-name><surname>Bonneau</surname><given-names>R</given-names></string-name>, <string-name><surname>Bergenstråhle</surname><given-names>L</given-names></string-name>, <string-name><surname>Navarro</surname><given-names>JF</given-names></string-name>, <etal/><year>2019</year>. <article-title>High-definition spatial transcriptomics for in situ tissue profiling</article-title>. <source>Nat Methods</source><volume>16</volume>: <fpage>987</fpage>–<lpage>990</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-019-0548-y</pub-id><pub-id pub-id-type="pmid">31501547</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC57">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>X</given-names></string-name>, <string-name><surname>Allen</surname><given-names>WE</given-names></string-name>, <string-name><surname>Wright</surname><given-names>MA</given-names></string-name>, <string-name><surname>Sylwestrak</surname><given-names>EL</given-names></string-name>, <string-name><surname>Samusik</surname><given-names>N</given-names></string-name>, <string-name><surname>Vesuna</surname><given-names>S</given-names></string-name>, <string-name><surname>Evans</surname><given-names>K</given-names></string-name>, <string-name><surname>Liu</surname><given-names>C</given-names></string-name>, <string-name><surname>Ramakrishnan</surname><given-names>C</given-names></string-name>, <string-name><surname>Liu</surname><given-names>J</given-names></string-name>, <etal/><year>2018</year>. <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>. <source>Science</source><volume>361</volume>: <fpage>eaat5691</fpage>. <pub-id pub-id-type="doi">10.1126/science.aat5691</pub-id><pub-id pub-id-type="pmid">29930089</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC58">
      <mixed-citation publication-type="journal"><string-name><surname>Wei</surname><given-names>X</given-names></string-name>, <string-name><surname>Fu</surname><given-names>S</given-names></string-name>, <string-name><surname>Li</surname><given-names>H</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Wang</surname><given-names>S</given-names></string-name>, <string-name><surname>Feng</surname><given-names>W</given-names></string-name>, <string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Liu</surname><given-names>X</given-names></string-name>, <string-name><surname>Zeng</surname><given-names>Y-Y</given-names></string-name>, <string-name><surname>Cheng</surname><given-names>M</given-names></string-name>, <etal/><year>2022</year>. <article-title>Single-cell stereo-seq reveals induced progenitor cells involved in axolotl brain regeneration</article-title>. <source>Science</source><volume>377</volume>: <fpage>eabp9444</fpage>. <pub-id pub-id-type="doi">10.1126/science.abp9444</pub-id><pub-id pub-id-type="pmid">36048929</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC59">
      <mixed-citation publication-type="journal"><string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Angerer</surname><given-names>P</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2018</year>. <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>. <source>Genome Biol</source><volume>19</volume>: <fpage>15</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id><pub-id pub-id-type="pmid">29409532</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC60">
      <mixed-citation publication-type="journal"><string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Hamey</surname><given-names>FK</given-names></string-name>, <string-name><surname>Plass</surname><given-names>M</given-names></string-name>, <string-name><surname>Solana</surname><given-names>J</given-names></string-name>, <string-name><surname>Dahlin</surname><given-names>JS</given-names></string-name>, <string-name><surname>Göttgens</surname><given-names>B</given-names></string-name>, <string-name><surname>Rajewsky</surname><given-names>N</given-names></string-name>, <string-name><surname>Simon</surname><given-names>L</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2019</year>. <article-title>PAGA: graph abstraction reconciles clustering with trajectory inference through a topology preserving map of single cells</article-title>. <source>Genome Biol</source><volume>20</volume>: <fpage>59</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-019-1663-x</pub-id><pub-id pub-id-type="pmid">30890159</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC61">
      <mixed-citation publication-type="other"><string-name><surname>Xu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Wang</surname><given-names>W</given-names></string-name>, <string-name><surname>Yang</surname><given-names>T</given-names></string-name>, <string-name><surname>Chen</surname><given-names>J</given-names></string-name>, <string-name><surname>Huang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Gould</surname><given-names>J</given-names></string-name>, <string-name><surname>Du</surname><given-names>W</given-names></string-name>, <string-name><surname>Yang</surname><given-names>F</given-names></string-name>, <string-name><surname>Li</surname><given-names>L</given-names></string-name>, <string-name><surname>Lai</surname><given-names>T</given-names></string-name>, <etal/><year>2022</year>. <article-title>STOmicsDB: a database of spatial transcriptomic data</article-title>. <source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2022.03.11.481421</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC62">
      <mixed-citation publication-type="journal"><string-name><surname>Yuan</surname><given-names>Z</given-names></string-name>, <string-name><surname>Pan</surname><given-names>W</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>F</given-names></string-name>, <string-name><surname>Xu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Li</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>MQ</given-names></string-name>, <string-name><surname>Yao</surname><given-names>J</given-names></string-name>. <year>2023</year>. <article-title>SODB facilitates comprehensive exploration of spatial omics data</article-title>. <source>Nat Methods</source><volume>20</volume>: <fpage>387</fpage>–<lpage>399</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-023-01773-7</pub-id><pub-id pub-id-type="pmid">36797409</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC63">
      <mixed-citation publication-type="journal"><string-name><surname>Zeira</surname><given-names>R</given-names></string-name>, <string-name><surname>Land</surname><given-names>M</given-names></string-name>, <string-name><surname>Strzalkowski</surname><given-names>A</given-names></string-name>, <string-name><surname>Raphael</surname><given-names>BJ</given-names></string-name>. <year>2022</year>. <article-title>Alignment and integration of spatial transcriptomics data</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>567</fpage>–<lpage>575</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-022-01459-6</pub-id><pub-id pub-id-type="pmid">35577957</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC64">
      <mixed-citation publication-type="journal"><string-name><surname>Zeng</surname><given-names>Z</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>, <string-name><surname>Luo</surname><given-names>Y</given-names></string-name>. <year>2022</year>. <article-title>Statistical and machine learning methods for spatially resolved transcriptomics data analysis</article-title>. <source>Genome Biol</source><volume>23</volume>: <fpage>83</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-022-02653-7</pub-id><pub-id pub-id-type="pmid">35337374</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC65">
      <mixed-citation publication-type="other"><string-name><surname>Zhang</surname><given-names>J</given-names></string-name>, <string-name><surname>Meng</surname><given-names>L</given-names></string-name>. <year>2019</year>. <article-title>GResNet: graph residual network for reviving deep GNNs from suspended animation</article-title>. <italic>arXiv</italic>:<comment>1909.05729 [cs.LG]</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC66">
      <mixed-citation publication-type="journal"><string-name><surname>Zhao</surname><given-names>E</given-names></string-name>, <string-name><surname>Stone</surname><given-names>MR</given-names></string-name>, <string-name><surname>Ren</surname><given-names>X</given-names></string-name>, <string-name><surname>Guenthoer</surname><given-names>J</given-names></string-name>, <string-name><surname>Smythe</surname><given-names>KS</given-names></string-name>, <string-name><surname>Pulliam</surname><given-names>T</given-names></string-name>, <string-name><surname>Williams</surname><given-names>SR</given-names></string-name>, <string-name><surname>Uytingco</surname><given-names>CR</given-names></string-name>, <string-name><surname>Taylor</surname><given-names>SE</given-names></string-name>, <string-name><surname>Nghiem</surname><given-names>P</given-names></string-name>, <etal/><year>2021</year>. <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>1375</fpage>–<lpage>1384</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-021-00935-2</pub-id><pub-id pub-id-type="pmid">34083791</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC67">
      <mixed-citation publication-type="journal"><string-name><surname>Zhuang</surname><given-names>X</given-names></string-name>. <year>2021</year>. <article-title>Spatially resolved single-cell genomics and transcriptomics by imaging</article-title>. <source>Nat Methods</source><volume>18</volume>: <fpage>18</fpage>–<lpage>22</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-020-01037-8</pub-id><pub-id pub-id-type="pmid">33408406</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.0 20120330//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Res</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Res</journal-id>
    <journal-id journal-id-type="hwp">genome</journal-id>
    <journal-id journal-id-type="publisher-id">GENOME</journal-id>
    <journal-title-group>
      <journal-title>Genome Research</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1088-9051</issn>
    <issn pub-type="epub">1549-5469</issn>
    <publisher>
      <publisher-name>Cold Spring Harbor Laboratory Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10691543</article-id>
    <article-id pub-id-type="pmid">37903634</article-id>
    <article-id pub-id-type="medline">9509184</article-id>
    <article-id pub-id-type="doi">10.1101/gr.277891.123</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Methods</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Latent feature extraction with a prior-based self-attention framework for spatial transcriptomics</article-title>
      <alt-title alt-title-type="left-running">Li et al.</alt-title>
      <alt-title alt-title-type="right-running">Embedding method for spatial transcriptomics</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Zhen</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Chen</surname>
          <given-names>Xiaoyang</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9684-5643</contrib-id>
        <name>
          <surname>Zhang</surname>
          <given-names>Xuegong</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jiang</surname>
          <given-names>Rui</given-names>
        </name>
        <xref rid="af1" ref-type="aff">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Chen</surname>
          <given-names>Shengquan</given-names>
        </name>
        <xref rid="af2" ref-type="aff">2</xref>
      </contrib>
    </contrib-group>
    <aff id="af1"><label>1</label>Ministry of Education Key Laboratory of Bioinformatics, Bioinformatics Division at the Beijing National Research Center for Information Science and Technology, Center for Synthetic and Systems Biology, Department of Automation, Tsinghua University, Beijing 100084, China;</aff>
    <aff id="af2"><label>2</label>School of Mathematical Sciences and LPMC, Nankai University, Tianjin 300071, China</aff>
    <author-notes>
      <corresp>Corresponding author: <email>chenshengquan@nankai.edu.cn</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>10</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <month>10</month>
      <year>2023</year>
    </pub-date>
    <volume>33</volume>
    <issue>10</issue>
    <fpage>1757</fpage>
    <lpage>1773</lpage>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>3</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>19</day>
        <month>9</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>
        <ext-link xlink:href="http://genome.cshlp.org/site/misc/terms.xhtml" ext-link-type="uri">© 2023 Li et al.; Published by Cold Spring Harbor Laboratory Press</ext-link>
      </copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbynclicense">https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref>
        <license-p>This article, published in <italic>Genome Research</italic>, is available under a Creative Commons License (Attribution-NonCommercial 4.0 International), as described at <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <self-uri content-type="pdf" xlink:href="1757.pdf"/>
    <abstract>
      <p>Rapid advances in spatial transcriptomics (ST) have revolutionized the interrogation of spatial heterogeneity and increase the demand for comprehensive methods to effectively characterize spatial domains. As a prerequisite for ST data analysis, spatial domain characterization is a crucial step for downstream analyses and biological implications. Here we propose a prior-based self-attention framework for spatial transcriptomics (PAST), a variational graph convolutional autoencoder for ST, which effectively integrates prior information via a Bayesian neural network, captures spatial patterns via a self-attention mechanism, and enables scalable application via a ripple walk sampler strategy. Through comprehensive experiments on data sets generated by different technologies, we show that PAST can effectively characterize spatial domains and facilitate various downstream analyses, including ST visualization, spatial trajectory inference and pseudotime analysis. Also, we highlight the advantages of PAST for multislice joint embedding and automatic annotation of spatial domains in newly sequenced ST data. Compared with existing methods, PAST is the first ST method that integrates reference data to analyze ST data. We anticipate that PAST will open up new avenues for researchers to decipher ST data with customized reference data, which expands the applicability of ST technology.</p>
    </abstract>
    <funding-group>
      <award-group id="funding-1">
        <funding-source>National Key Research and Development Program of China</funding-source>
        <award-id>2021YFF1200902</award-id>
      </award-group>
      <award-group id="funding-2">
        <funding-source>
          <institution-wrap>
            <institution>National Natural Science Foundation of China </institution>
            <institution-id institution-id-type="doi">10.13039/501100001809</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>62203236</award-id>
        <award-id>62273194</award-id>
        <award-id>61721003</award-id>
      </award-group>
      <award-group id="funding-3">
        <funding-source>
          <institution-wrap>
            <institution>Central Universities, Nankai University </institution>
            <institution-id institution-id-type="doi">10.13039/501100004945</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>63231137</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="17"/>
    </counts>
  </article-meta>
</front>
<body>
  <p>Recent innovations in spatially resolved transcriptomics grant us a novel perspective on the cellular transcriptome, and hence have stimulated efforts to unravel cell transcriptomes in the context of cellular organizations and catalyze new discoveries in different areas of biological research (<xref rid="GR277891LIC14" ref-type="bibr">Crosetto et al. 2015</xref>; <xref rid="GR277891LIC17" ref-type="bibr">Dries et al. 2021</xref>; <xref rid="GR277891LIC33" ref-type="bibr">Larsson et al. 2021</xref>; <xref rid="GR277891LIC67" ref-type="bibr">Zhuang 2021</xref>; <xref rid="GR277891LIC42" ref-type="bibr">Moses and Pachter 2022</xref>). Advanced spatial transcriptomic (ST) techniques, including Visium (10x Genomics), Slide-seq (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>), and Stereo-seq (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>), could print spatially barcoded and oligo(dT) probes as microarrays of spots on the surface of glass slides, measuring genome-wide expression levels in captured locations, referred to as spots. When performing exploratory analysis of ST data, one of the most critical steps is characterizing spatial domains, which display spatially organized and functionally distinct anatomical structures on tissues. Nevertheless, low capture efficiency is one of the key reasons for high dropouts in single-cell RNA sequencing, leading to sparse and noisy data (<xref rid="GR277891LIC26" ref-type="bibr">Haque et al. 2017</xref>; <xref rid="GR277891LIC45" ref-type="bibr">Qiu 2020</xref>), and the limitations are also inherited by spatial transcriptomics data, making characterizing ST data computationally challenging (<xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). Also, ST data usually represents substantial spatial correlation across tissues, requiring advanced approaches to take spatial localization information into account (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>; <xref rid="GR277891LIC29" ref-type="bibr">Jiang et al. 2023</xref>).</p>
  <p>Several computational methods have been proposed to analyze ST data (<xref rid="GR277891LIC17" ref-type="bibr">Dries et al. 2021</xref>; <xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). BayesSpace performs spatial clustering via modeling the spatial correlation of gene profiles between neighboring spots (<xref rid="GR277891LIC66" ref-type="bibr">Zhao et al. 2021</xref>). SpaGCN identifies spatial domains by integrating gene expression, spatial location and histology through the construction of an undirected weighted graph (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>). CCST is an unsupervised cell clustering method based on graph neural networks for ST data (<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>). STAGATE integrates spatial information and gene profiles with an adaptive graph attention autoencoder to learn low-dimensional embeddings (<xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>). DR-SC uses a hidden Markov random field to perform dimension reduction and spatial clustering within a unified framework (<xref rid="GR277891LIC38" ref-type="bibr">Liu et al. 2022b</xref>). Non-negative spatial factorization (NSF) is a spatially aware probabilistic dimension reduction method which assumes an exponentiated Gaussian process prior over the spatial locations (<xref rid="GR277891LIC54" ref-type="bibr">Townes and Engelhardt 2023</xref>). SpatialPCA integrates localization information with a kernel matrix and performs spatial-aware principle component analysis (PCA) for ST data (<xref rid="GR277891LIC49" ref-type="bibr">Shang and Zhou 2022</xref>). Also, SCANPY and Seurat, two widely-used single-cell analysis workflows in the Python and R communities, respectively, also provide vignettes tailored for ST data analysis (<xref rid="GR277891LIC59" ref-type="bibr">Wolf et al. 2018</xref>; <xref rid="GR277891LIC25" ref-type="bibr">Hao et al. 2021</xref>).</p>
  <p>However, effective approaches for characterizing spatial domains in ST data need to overcome several challenges. First, existing methods failed to incorporate prior information from reference data to facilitate ST data analysis. Incorporating prior information in analyzing single-cell genomic data can better tackle the high level of noise and technical variation, and has been successfully applied in the analysis of various single-cell genomic data (<xref rid="GR277891LIC34" ref-type="bibr">Li et al. 2017</xref>; <xref rid="GR277891LIC32" ref-type="bibr">Lareau et al. 2019</xref>; <xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>; <xref rid="GR277891LIC50" ref-type="bibr">Shengquan et al. 2021</xref>). With the advanced technologies, massive amounts of ST data have been generated by consortiums or individual research groups (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>; <xref rid="GR277891LIC56" ref-type="bibr">Vickovic et al. 2019</xref>; <xref rid="GR277891LIC52" ref-type="bibr">Stickels et al. 2021</xref>) and accumulated in repositories and databases (<xref rid="GR277891LIC18" ref-type="bibr">Fan et al. 2020</xref>; <xref rid="GR277891LIC42" ref-type="bibr">Moses and Pachter 2022</xref>; <xref rid="GR277891LIC61" ref-type="bibr">Xu et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>; <xref rid="GR277891LIC62" ref-type="bibr">Yuan et al. 2023</xref>), paving the way to taking full advantage of the existing data and leveraging the data as reference to characterize spatial domains. Second, local spatial patterns should be effectively captured. Although it has been observed that aggregating information from each spot's neighbors via a graph convolutional network (GCN) is a promising approach to identify localized gene expression patterns (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>; <xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>), tailored model design for better characterization of local spatial patterns is still demanded (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>). Third, global spatial patterns should be carefully preserved. With the exponential growth of profiled spots and genes, the graph-based approach becomes cumbersome and time-consuming, requiring strategies that perform memory and time-efficient minibatch training and prediction while preserving global spatial patterns. Fourth, there is an emerging need for the automatic annotation of spatial domains, because advanced protocols constantly increase sequencing throughput, and the typical approach, which performs unsupervised spatial clustering and then assigns the putative domain to each cluster subjectively, would be cumbersome and irreproducible for large-scale ST data.</p>
  <p>To this end, we propose PAST, a <underline>P</underline>rior-based self-<underline>A</underline>ttention framework for <underline>S</underline>patial <underline>T</underline>ranscriptomics, which incorporates the graph residual network (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>; <xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to effectively characterize spatial domains. PAST is a variational graph convolutional autoencoder, and uses a Bayesian neural network (BNN) (<xref rid="GR277891LIC7" ref-type="bibr">Blundell et al. 2015</xref>) to incorporate prior information from reference data, self-attention mechanism (<xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to capture spatial patterns, and a ripple walk sampler (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>) to enable scalable subgraph-based training and prediction. Featured as the first ST method which integrates reference data from various sources, PAST aims to extract latent embeddings of ST data in a self-supervised manner. The latent embeddings obtained from PAST contain valuable spatial correlation patterns and can be directly fed into existing scRNA-seq computational tools for effective and novel downstream analyses.</p>
  <sec sec-type="results" id="s1">
    <title>Results</title>
    <sec id="s1a">
      <title>Overview of PAST</title>
      <p>PAST is a self-supervised representation learning model based on a framework of variational graph convolutional autoencoder, taking transcriptomic profiles and spatial coordinates of the target ST data and transcriptomic profiles of the reference data as input. As shown in <xref rid="GR277891LIF1" ref-type="fig">Figure 1</xref>B, the first layer of the encoder decomposes the total variation in ST data into two components (<xref rid="GR277891LIC34" ref-type="bibr">Li et al. 2017</xref>; <xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>): the component that captures the shared biological variation from reference data based on the BNN module, and the component that captures the unique biological variation in target ST data based on an unconstrained fully connected network (FCN). The choice of the reference data is flexible and can be constructed from various sources (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>A; <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S1</xref>), including: (1) external ST data of the same tissue and from the same protocol with the target ST data, (2) external ST data of similar tissues and from other protocols, (3) scRNA-seq data of similar tissues, or (4) the target ST data itself. In practice, the reference data can be incomplete: novel domains of biological variation that are not captured in the reference data can be present in target ST data. The second component uses an unconstrained FCN to adaptively capture the unique variation in target ST data that is not present in reference data.</p>
      <fig position="float" id="GR277891LIF1">
        <label>Figure 1.</label>
        <caption>
          <p>The PAST framework. (<italic>A</italic>) Four approaches for PAST to construct reference data, including three for external reference data (PAST-E) and one from the target data itself (PAST-S). (<italic>B</italic>) PAST is built on a variational graph convolutional autoencoder. The encoder of PAST consists of three layers, including the concatenation of a BNN and a FCN as the first layer and two self-attention modules as the subsequent two layers. The reparameterization module acquires the mean and log-variance matrix based on two FCNs, in which the mean matrix is the latent embedding obtained of PAST. The decoder of PAST is also a three-layer network, including a FCN layer and two stacked self-attention modules. The loss function of PAST consists of four parts, including reconstruction loss <italic>L</italic><sub><italic>recons</italic></sub>, Kullback-Leibler divergence (KLD) loss <italic>L</italic><sub><italic>kld</italic></sub>, metric learning loss <italic>L</italic><sub><italic>metric</italic></sub> and loss of BNN module <italic>L</italic><sub><italic>bnn</italic></sub>. (<italic>C</italic>) Ripple walk sampler samples high-quality subgraphs based on the spatial neighborhood graph and outputs minibatch gene expression matrices. (<italic>D</italic>) BNN module integrates shared biological variation through restricting the KLD distance between prior Gaussian distribution parameterized by reference data and Gaussian distribution parameterized by parameters of BNN. (<italic>E</italic>) The self-attention mechanism captures spatial correlation between neighbor spots, where FCN is used to generate queries, keys, and values for the calculation of attention weights. (<italic>F</italic>) The latent embeddings, that is, mean matrix in the reparameterization module, obtained by PAST facilitate various tasks including domain identification, trajectory inference, pseudotime analysis, multislice integration, and automatic annotation.</p>
        </caption>
        <graphic xlink:href="1757f01" position="float"/>
      </fig>
      <p>To integrate information of transcriptomic profiles and spatial coordinates, PAST identifies <italic>k</italic>-nearest neighbors (<italic>k</italic>-NN) for each spot using spatial coordinates in a Euclidean space, and adopts the graph residual network (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>) with a self-attention mechanism (<xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to aggregate information from each spot's neighbors. Specifically, the self-attention mechanism, which fits the relationship between words well in machine translation tasks (<xref rid="GR277891LIC46" ref-type="bibr">Raffel et al. 2020</xref>), is used to model local spatial patterns between neighboring spots, whereas the ripple walk sampler (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>), which enables efficient subgraph-based training for large and deep GCNs, is used to achieve better scalability on large-scale ST data and preserve global spatial patterns simultaneously. PAST also restricts the distance of latent embeddings between neighbors through metric learning (<xref rid="GR277891LIC23" ref-type="bibr">Hadsell et al. 2006</xref>), the insight of which is that spatially close spots are more likely to be positive pairs to show similar latent patterns, illustrated in detail in the Loss function part of the Methods section. After model training and prediction, the latent embeddings, that is, the mean matrix of the reparameterization module (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>B), can be applied to spatial domain characterization, spatial visualization, trajectory inference, pseudotime analysis, multislice joint embedding, and automatic annotation (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>F).</p>
    </sec>
    <sec id="s1b">
      <title>PAST effectively leverages reference data from various sources for spatial domain characterization</title>
      <p>We first use an example as a proof of concept to show the capability of PAST in incorporating reference data from different sources for spatial domain characterization. We collected ST data from a STARmap data set of the mouse primary visual cortex (MPVC) (<xref rid="GR277891LIC57" ref-type="bibr">Wang et al. 2018</xref>). We also constructed the reference data from the target ST data itself, a 10x Visium ST data set of the mouse brain coronal region (<xref rid="GR277891LIC44" ref-type="bibr">Palla et al. 2022</xref>), and a scRNA-seq data set of the mouse cortex (<xref rid="GR277891LIC53" ref-type="bibr">Tasic et al. 2016</xref>), which were referred to as PAST-S, PAST-E-Visium, and PAST-E-scRNA, respectively. The three variants of PAST were benchmarked against eight baseline methods, including two widely-used single-cell analysis workflows in Python and R community (SCANPY [<xref rid="GR277891LIC59" ref-type="bibr">Wolf et al. 2018</xref>] and Seurat [<xref rid="GR277891LIC25" ref-type="bibr">Hao et al. 2021</xref>]), and six methods for ST data analysis (SpaGCN [<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>], CCST [<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>], DR-SC [<xref rid="GR277891LIC38" ref-type="bibr">Liu et al. 2022b</xref>], NSF [<xref rid="GR277891LIC54" ref-type="bibr">Townes and Engelhardt 2023</xref>], SpatialPCA [<xref rid="GR277891LIC49" ref-type="bibr">Shang and Zhou 2022</xref>], and STAGATE [<xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>]). We first show the advantages of PAST quantitatively from the following three perspectives. The detailed information about baseline methods and quantitative evaluation metrics are described in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S2</xref>.</p>
      <p>First, we quantitatively evaluated the performance of spatial domain characterization via supervised cross-validation (Cross-validation). The supervised cross-validation aims to assess the representation capabilities of the latent embeddings learned by various methods. Specifically, we treated the latent embeddings as the input and the labels of spatial domains as the output, adopted support vector machine (SVM) as the classifier as suggested by a benchmark study on supervised single-cell annotation (<xref rid="GR277891LIC1" ref-type="bibr">Abdelaal et al. 2019</xref>), and conducted fivefold cross-validation experiments. We evaluated the performance by the average score of accuracy (Acc), Cohen's kappa value (κ), mean F1 score (mF1), and weighted F1 score (wF1), respectively, in the fivefold experiments. A higher score of the metrics suggests that the latent embeddings can better predict the spatial domains and, consequently, have superior representation capabilities. As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S1A</xref>, except SpatialPCA, PAST-S and PAST-E-Visium outperform the remaining seven baseline methods for excellent embedding capabilities. Although PAST-E-scRNA performed worse than SpatialPCA and STAGATE, which may be caused by the inconsistency of tissues and protocols between ST data and the reference scRNA-seq data, it still outperforms the other six baseline methods. To qualitatively evaluate the representation capabilities of low-dimensional embeddings, we also visualized the spots using uniform manifold approximation and projection (UMAP) and t-distributed stochastic neighbor embedding (t-SNE) based on the latent embeddings learned by different methods (<xref rid="GR277891LIF2" ref-type="fig">Fig. 2</xref>B; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S2A</xref>). Except L2/3, L6, and CC, SCANPY and Seurat could hardly distinguish other domains. SpaGCN, DR-SC, NSF provide relatively better performance. STAGATE succeeded to detect most of the domains but still failed to decipher the heterogeneity of HPC. The three variants of PAST consistently achieve satisfactory visualization results compared with other methods and only SpatialPCA, PAST-S, and PAST-E-Visium successfully distinguished HPC from other domains.</p>
      <fig position="float" id="GR277891LIF2">
        <label>Figure 2.</label>
        <caption>
          <p>PAST effectively leverages reference data from various sources for spatial domain characterization. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on STARmap MPVC data set via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). (<italic>B</italic>) UMAP visualization results, (<italic>C</italic>) spatial visualization of clustering with a specified number of clusters and the manual annotation and (<italic>D</italic>) clustering evaluation of different methods under various dropout rates on MPVC data set.</p>
        </caption>
        <graphic xlink:href="1757f02" position="float"/>
      </fig>
      <p>Second, we compared the performance of spatial domain characterization through the unsupervised spatial clustering with a specified number of clusters (Ncluster), in which the specified number of clusters is set to the number of unique ground-truth spatial domains. We directly used the baseline spatial clustering methods, such as CCST (<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>) and SpaGCN (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>), or the accompanying spatial clustering strategy of each of the other baseline methods on the learned latent embeddings. Following STAGATE, PAST performed clustering with a specified number of clusters by the mclust algorithm. For SCANPY, Seurat and NSF which perform clustering by Louvain or Leiden, we implemented a binary search to tune the resolution parameter in clustering to make the number of clusters and the specified number as close as possible. We evaluated the clustering performance by six metrics: adjusted rand index (ARI), adjusted mutual information (AMI), normalized mutual information (NMI), Fowlkes-Mallows index (FMI), completeness (Comp), and homogeneity (Homo). As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S1A</xref>, PAST-S and PAST-E-Visium provide superior performance than all eight baseline methods on all six metrics. PAST-E-scRNA only performs slightly worse than SpatialPCA even when integrating incompatible scRNA-seq data as reference. SCANPY and Seurat, two widely-used single-cell analysis workflows, provided a relatively poor performance even using the vignettes tailored for ST data, indicating the importance of utilizing spatial information. Furthermore, visualization of the spatial domains characterized by clustering with a specified number of clusters and the ground-truth spatial domains on the spatial coordinates of ST data also show consistent results with the quantitative evaluation (<xref rid="GR277891LIF2" ref-type="fig">Fig. 2</xref>C). Note that for CCST, we only evaluated the clustering performance with a specified number of clusters because it is a spatial clustering method and does not provide latent embeddings.</p>
      <p>Third, we test the performance of PAST and other methods for the unsupervised spatial clustering with default resolution (Dlouvain), which is useful for the general situation in which the number of unique ground-truth spatial domains is unknown (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>). We performed Louvain clustering algorithm, one of the most widely-used community-based clustering methods in single-cell studies, with default resolution based on the latent embeddings learned by different methods. As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S1A</xref>, PAST-S again achieves overall the best performance whereas PAST-E-Visium and PAST-E-scRNA perform better than any other baseline methods except SpatialPCA. It is vital to emphasize that PAST-scRNA, which incorporates scRNA-seq data to analyze ST data, even achieved 28.2% and 32.0% improvement compared to a competitive ST method STAGATE in terms of ARI and AMI, respectively (31.6%, 18.3%, 29.1%, 34.1% for NMI, FMI, Comp, and Homo, respectively). The evaluation results are detailed in <xref rid="SD1" ref-type="supplementary-material">Supplemental Table S1</xref>.</p>
      <p>To mimic protocols that provide low coverage, we down sampled the reads in the target ST data by randomly dropping out the entries in the expression matrix to zero with a probability equal to the specified dropout rate, as suggested by a recent benchmark study (<xref rid="GR277891LIC12" ref-type="bibr">Cheng et al. 2022</xref>). As shown in <xref rid="GR277891LIF2" ref-type="fig">Figure 2</xref>D, all methods including the three variants of PAST were affected by the increase in the dropout rate, however, PAST with external reference (i.e., PAST-E-Visium and PAST-E-scRNA) consistently outperform the remaining methods over all different dropout rates. Altogether, the results above suggest PAST effectively deciphers spatial patterns through integrating external reference data constructed from various sources and when target ST data has a higher degree of sparsity and noise, the benefit of utilizing external reference data increases. Furthermore, we also showed that PAST is robust to model hyperparameters including the number of neighbors and latent dimensions on the STARmap MPVC data set (<xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S3, S4</xref>).</p>
    </sec>
    <sec id="s1c">
      <title>PAST robustly obtains informative low-dimensional embeddings and facilitates diverse downstream analyses</title>
      <p>To test the capability of PAST in learning effective embeddings and accomplishing downstream tasks, we further collected 12 human dorsolateral prefrontal cortex (DLPFC) slices from a 10x Visium data set (<xref rid="GR277891LIC40" ref-type="bibr">Maynard et al. 2021</xref>). For each slice, we constructed the reference data from the ST data itself and from external ST data, namely the remaining 11 slices. The two variants of PAST have different application scenarios and are referred to as PAST-S and PAST-E, respectively. First, we benchmarked PAST from the three quantitative perspectives against nine baseline methods, including the eight methods tested on the STARmap MPVC data set and a clustering method specifically designed for spatial transcriptomics (<xref rid="GR277891LIC51" ref-type="bibr">Ståhl et al. 2016</xref>) and 10x Visium data, namely BayesSpace (<xref rid="GR277891LIC66" ref-type="bibr">Zhao et al. 2021</xref>). Similar to CCST, we only evaluated the clustering performance with a specified number of clusters. As shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S5A</xref>, for supervised cross-validation, PAST-S and PAST-E performs better than other five baseline methods except NSF and SpatialPCA. Furthermore, PAST-S and PAST-E outperforms all the baseline methods in terms of unsupervised spatial clustering with a specified number of clusters and unsupervised spatial clustering with default resolution on the 12 DLPFC slices (<xref rid="SD2" ref-type="supplementary-material">Supplemental Table S2</xref>). One-sided paired Wilcoxon signed-rank tests showed that PAST-E showed much more advantages than PAST-S in terms of various clustering metrics in the two different clustering scenarios, with <italic>P</italic>-values of 0.0105 and 0.0002 for ARI, respectively (0.0061 and 0.0002 for AMI, 0.0061 and 0.0002 for NMI, 0.0105 and 0.0005 for FMI, 0.0105 and 0.0002 for Comp, and 0.0134 and 0.0002 for Homo), highlighting the benefit of integrating high-quality external reference data. Similarly, we visualized the spatial domains characterized by clustering with a specified number of clusters and the ground-truth spatial domains on the spatial coordinates of ST data to qualitatively evaluate the performance of different methods (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S6</xref>). Taking Slice 151,673 as an example, the spatial domain assignment of the nonspatial approaches, namely SCANPY and Seurat, provide poor continuity and smoothness, which is consistent with the above quantitative results. SpaGCN, NSF, and BayesSpace fail to decipher the expected layer pattern in layer 4–layer 6 of this slice, which impairs the spatial clustering accuracy, whereas CCST, DR-SC, SpatialPCA, STAGATE, PAST-S, and PAST-E successfully characterized the expected cortical layer structures, indicating the effective spatial domain characterization.</p>
      <fig position="float" id="GR277891LIF3">
        <label>Figure 3.</label>
        <caption>
          <p>PAST robustly obtains informative low-dimensional embeddings and facilitates diverse downstream analyses. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on 12 DLPFC slices via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). The center line, box limits and whiskers in the boxplots are the median, upper and lower quartiles, and 1.5× interquartile range, respectively. (<italic>B</italic>) UMAP visualization, (<italic>C</italic>) PAGA trajectory inference results, and (<italic>D</italic>) DPT pseudotime analysis results of Slice 151,673. (<italic>E</italic>) The number of shared spatial domains in external reference data gradually deceased. (<italic>F</italic>) The spots in external reference data of PAST were down sampled with a stratified random sampling strategy to construct reference data with various scales. The horizontal dashed lines represent the corresponding median scores of STAGATE.</p>
        </caption>
        <graphic xlink:href="1757f03" position="float"/>
      </fig>
      <p>Second, taking Slice 151,673 as an example, we performed various downstream analyses based on the low-dimensional embeddings obtained by different methods. For low-dimensional visualization based on the UMAP and t-SNE algorithm (<xref rid="GR277891LIF3" ref-type="fig">Fig. 3</xref>B; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S7, S8</xref>), except the white matter (WM), SCANPY and Seurat could hardly distinguish the cortical layers. SpaGCN DR-SC, and NSF provided relatively better performance, whereas SpatialPCA, STAGATE, PAST-S, and PAST-E successfully identified all the spatial structures and reconstructed the manifold of them. Also, UMAP and t-SNE visualization for the other 11 DLPFC slices provided similar results (<xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S7, S8</xref>). For spatial trajectory inference, based on the latent embeddings learned by different methods, we performed trajectory inference using PAGA on Slice 151,673 (<xref rid="GR277891LIC60" ref-type="bibr">Wolf et al. 2019</xref>). As shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>C, PAST captured the well-known corticogenesis patterns (<xref rid="GR277891LIC22" ref-type="bibr">Gilmore and Herrup 1997</xref>; <xref rid="GR277891LIC2" ref-type="bibr">Agirman et al. 2017</xref>) and inferred a nearly linear development trajectory from inner to outer layers, indicating the utility of PAST in revealing development trajectory. For spatial pseudotime analysis using the DPT algorithm (<xref rid="GR277891LIC24" ref-type="bibr">Haghverdi et al. 2016</xref>), PAST successfully characterized all the continuous development stages, whereas the other baseline methods only captured the pseudotime variation between WM and other cortical layers (<xref rid="GR277891LIF3" ref-type="fig">Fig. 3</xref>D). Trajectory inference and pseudotime analysis for other slices also provided similar results (<xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S9, S10</xref>), highlighting the potential of PAST to extract informative features and facilitate downstream analyses and biological implications. The detailed implementation of visualization, clustering and other downstream analyses are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S3</xref>.</p>
      <p>The previous example on DLPFC slices used external reference data constructed from the other slices, which contains more than 40,000 spots and heterogeneous information of almost all the domains (PAST-E). However, the prior information in external reference data is generally incomplete for the target ST data and the scale of high-quality reference data is generally limited. Therefore, we further carefully examined the robustness of PAST-E to the number of shared domains and scale of reference data, using STAGATE, a competitive method on DLPFC data set, as the baseline. We gradually left out different number of spatial domains in external reference data, and obtained PAST-E-LO1, PAST-E-LO2, PAST-E-LO3, and PAST-E-LO4, which denote leaving out layer 1, layers 1 and layer 2, layers 1 through layer 3, and layers 1 through layer 4, respectively. The results shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>E and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S11A</xref> were in line with intuition because as the spatial domains are continuously left out, the effective prior information in the reference data is decreased. Except PAST-E-LO4, the overall clustering performance of PAST-E when integrating reference with different number of shared domains is superior to STAGATE (the horizontal dashed lines), and PAST-E performs well even based on the reference data containing only nearly half of shared domains. Furthermore, another two different schedules removing the same number of shared domains in external reference data obtained similar results (shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S12, S13</xref>), suggesting the robustness of PAST to the number of shared domains in reference data. Meanwhile, to test the influence of limited scale of reference data without reducing the number of shared domains, we randomly down sampled the spots in reference data based on a stratified random sampling strategy, that is, sampling spots from each domain with a given rate. We obtained PAST-E-DS50, PAST-E-DS40, PAST-E-DS30, PAST-E-DS20, PAST-E-DS10, PAST-E-DS5, and PAST-E-DS1, which denote remaining sampled 50%, 40%, 30%, 20%, 10%, 5%, and 1% of the spots, respectively. Compared with PAST-E which integrated prior information from more than 40,000 spots, the data scale of reference of PAST-E-DS50 through PAST-E-DS1 was only 21,949 through 425. As shown in <xref rid="GR277891LIF3" ref-type="fig">Figure 3</xref>F and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S11B</xref>, PAST-E with down sampled reference data consistently achieves satisfactory performance for supervised cross-validation and spatial clustering, until only 1% of the spots in reference data remained. We then performed two-sided Wilcoxon signed-rank tests on the quantitative results of different reference data scales. As shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S14</xref>, the scale of reference data, which may range from a few hundred to tens of thousands, has no significant impact on the performance of PAST-E, indicating that PAST-E is highly robust to the data scale of reference data when the number of shared domains in reference is sufficient.</p>
    </sec>
    <sec id="s1d">
      <title>PAST captures local spatial patterns with self-attention mechanism</title>
      <p>Next, we tested whether PAST could provide insights into local spatial patterns. We applied PAST to an osmFISH mouse somatosensory cortex data set (MSC) (<xref rid="GR277891LIC13" ref-type="bibr">Codeluppi et al. 2018</xref>), and used the target data itself as reference. As shown in <xref rid="GR277891LIF4" ref-type="fig">Figure 4</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S15</xref>, PAST-S effectively characterizes spatial domains, and achieves significant improvement compared to the baseline methods in terms of cross-validation, and spatial clustering with a specified number of clusters or with default resolution (<xref rid="SD3" ref-type="supplementary-material">Supplemental Table S3</xref>). Also, PAST with different numbers of neighbors also showed its consistent superiority (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S16</xref>). For spatial visualization, PAST-S successfully identifies the expected structures and delineated the layer borders clearly, and the identified domains are more consistent with the original annotation of the data set (<xref rid="GR277891LIF4" ref-type="fig">Fig. 4</xref>B,C).</p>
      <fig position="float" id="GR277891LIF4">
        <label>Figure 4.</label>
        <caption>
          <p>PAST capably captures local spatial patterns with self-attention mechanism. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on the osmFISH MSC data set via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). (<italic>B</italic>) Visualization of the results of spatial clustering with a specified number of clusters on MSC. (<italic>C</italic>) The manual annotation of MSC. (<italic>D</italic>) UMAP visualization of spots in MSC. The blue, orange, and brown circles denote Layer 2–3 lateral, Layer 2–3 medial, and ventricle, respectively. (<italic>E</italic>) The neighbor proportion and attention proportion for border spots of domains Layer 2–3 lateral, Layer 2–3 medial, and ventricle, respectively.</p>
        </caption>
        <graphic xlink:href="1757f04" position="float"/>
      </fig>
      <p>We then explored the capability of the self-attention module of PAST-S in capturing local spatial patterns. As shown in <xref rid="GR277891LIF4" ref-type="fig">Figure 4</xref>D and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S17</xref>, compared with baseline methods like SCANPY, Seurat, DR-S,C and SpaGCN, PAST could effectively identify domains like Layer 2–3 lateral, Layer 2–3 medial, and ventricle in UMAP and t-SNE visualization (blue, orange, and brown circles). For these three spatial domains, we selected the border spots whose spatial neighbors were originated from at least one other spatial domain, and calculated the neighbor proportion and attention proportion of each domain. More specifically, for each border spot of each domain, we recorded the proportion of different spatial domains in the six nearest neighboring spots, and calculated the average proportion for all the border spots of each domain, resulting in the neighbor proportion. In comparison with the neighbor proportion, the attention proportion recorded the attention-weighted proportion of different spatial domains in the six nearest neighboring spots. As shown in <xref rid="GR277891LIF4" ref-type="fig">Figure 4</xref>E, the self-attention mechanism successfully identifies the neighboring spots from the same domain and improves the corresponding weights, that is, from 70.15% to 72.14% for Layer 2–3 lateral, from 72.41% to 75.92% for Layer 2–3 medial, and from 72.77% to 80.45% for ventricle, indicating that self-attention mechanism enables border spots to aggregate more information from neighbor spots belonging to the same domain. Taken together, PAST could effectively capture the local spatial patterns with the self-attention mechanism and characterize the spatial correlation of the spots in ST data, especially the easily confused border spots.</p>
    </sec>
    <sec id="s1e">
      <title>PAST enables scalable training and prediction on large data while preserving global spatial patterns</title>
      <p>With the development of ST technologies, the number of profiled spots and genes increases exponentially, requiring the scalability of computational methods. Traditional minibatch training strategy for deep learning, which partition entire data set into minibatches based on random sampling, is not suitable for graph neural network (GNN) because of the destruction to the connectivity and structure of graph (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>), making GNN-based methods such as SpaGCN (<xref rid="GR277891LIC27" ref-type="bibr">Hu et al. 2021a</xref>) and CCST (<xref rid="GR277891LIC35" ref-type="bibr">Li et al. 2022</xref>) not applicable to large-scale ST data. STAGATE partitioned the profiled slice and constructed a graph for each part to enable training on large data (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>D), which may lead to the loss of global spatial patterns (<xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>). We thus introduced a subgraph-based strategy for scalable training and prediction that considers both the randomness and connectivity of the graph and samples high-quality subgraphs based on a ripple walk sampler (RWS). RWS was originally proposed only for training, and was extended by us from training to prediction by sampling subgraphs covering all spots of the target data set and aggregating the latent embeddings of different subgraphs in an ensemble manner (Methods). Based on the RWS strategy, PAST preserves global spatial patterns and enables efficient application simultaneously.</p>
      <fig position="float" id="GR277891LIF5">
        <label>Figure 5.</label>
        <caption>
          <p>PAST enables scalable training and prediction on large data while preserving global spatial patterns. (<italic>A</italic>) Quantitative performance evaluation of spatial domain characterization on the Stereo-seq MOBS1 data set via supervised cross-validation and unsupervised spatial clustering with a specified number of clusters (Ncluster) and with default resolution (Dlouvain). The cross-validation performance was evaluated by the average score of Cohen's kappa value (κ) and mean F1 score (mF1), respectively, in the fivefold experiments. The spatial clustering performance was evaluated by adjusted rand index (ARI) and adjusted mutual information (AMI). (<italic>B</italic>) The manual annotation of MOBS1. (<italic>C</italic>) Visualization of the results of spatial clustering with a specified number of clusters on MOBS1. (<italic>D</italic>) Sampling strategy of STAGATE for minibatch training. (<italic>E</italic>) Ripple walk sampling strategy of PAST for scalable subgraph-based training and prediction. (<italic>F</italic>) Average time cost of different methods on MOBS1. (<italic>G</italic>) Peak memory usage of different methods on MOBS1.</p>
        </caption>
        <graphic xlink:href="1757f05" position="float"/>
      </fig>
      <p>We collected a Stereo-seq mouse olfactory bulb section (MOBS1) with 107,416 spots and 26,145 genes and analyzed the data set on a standard desktop with an AMD Ryzen 7 Eight-Core 3800X CPU, 64GB of RAM and an NVIDIA GeForce RTX 2080 Ti GPU. We collected another Stereo-seq mouse olfactory bulb section (MOBS2) with 104,931 spots and 23,815 genes to construct the external reference for PAST. Note that we encountered memory errors when performing Seurat, SpaGCN, CCST, NSF, and SpatialPCA on MOBS1. As shown in <xref rid="GR277891LIF5" ref-type="fig">Figure 5</xref>A and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S18</xref>, PAST-S and PAST-E, which incorporated self-prior information from MOBS1 itself and external-prior information from MOBS2, respectively, achieve overall the best performance for spatial domain characterization. The quantitative results are listed in <xref rid="SD4" ref-type="supplementary-material">Supplemental Table S4</xref>. Furthermore, PAST-S and PAST-E also achieve satisfactory performance in UMAP and t-SNE visualization (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S19</xref>). Also, the spatial domains detected by PAST-S and PAST-E were spatially continuous and smooth, and the subependymal zone (SEZ) domain, denoted as Cluster 1, was only successfully characterized by these two variants of PAST (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>B,C). We performed differential expression gene (DEG) analysis for Cluster 1 of PAST-S and PAST-E, respectively. The results of both of these two variants showed that the top two DEGs were <italic>Mbp</italic> and <italic>Plp1</italic>, which are classical genes encoding myelin proteins (<xref rid="GR277891LIC6" ref-type="bibr">Bitar et al. 2022</xref>). Myelin proteins were usually used as markers for striatal contamination or staining to facilitate accurate dissection of the SEZ (<xref rid="GR277891LIC19" ref-type="bibr">Friess et al. 2021</xref>; <xref rid="GR277891LIC6" ref-type="bibr">Bitar et al. 2022</xref>). We further performed Gene Ontology (GO) analysis for the top 10 DEGs with the lowest adjusted <italic>P</italic>-values of Cluster 1, and identified the most significant molecular function, that is, structural constituent of myelin sheath, with false discovery rates (FDR) of 1.28 × 10<sup>−4</sup> and 9.33 × 10<sup>−5</sup> for PAST-S and PAST-E, respectively. The GO analysis results were well consistent with the molecular function of SEZ domain, that is, deriving oligodendrocytes to form mature myelin sheaths around axons (<xref rid="GR277891LIC41" ref-type="bibr">Menn et al. 2006</xref>; <xref rid="GR277891LIC30" ref-type="bibr">Kazanis 2009</xref>), suggesting the ability of PAST to facilitate functional implication.</p>
      <p>We also recorded the computational time and peak memory usage of different methods, especially the two GNN-based methods, that is, STAGATE and PAST, which used different sampling strategies (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>D,E). As shown in <xref rid="GR277891LIF5" ref-type="fig">Figure 5</xref>F, the average computational time of PAST-S and PAST-E (168 and 164 sec) in 10 replicated experiments were approximately 30× less than STAGATE (5304 sec). In terms of peak memory usage, PAST-S and PAST-E also consumed significantly less memory than STAGATE (<xref rid="GR277891LIF5" ref-type="fig">Fig. 5</xref>G), indicating that the RWS of PAST has a significant advantage over the partition strategy of STAGATE. SCANPY adopts the straightforward representation learning methods, that is, principle component analysis, without incorporating spatial information of ST data, thus providing relatively inferior performance but consuming the lowest computation time (26 Sec). In summary, PAST enables scalable subgraph-based training and prediction while preserving global spatial patterns to better characterize spatial organizations.</p>
    </sec>
    <sec id="s1f">
      <title>PAST facilitates multislice joint embedding and automatic domain annotation</title>
      <p>Advanced ST sequencing technologies like 10x Visium, Slide-seq (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>), Slide-seq v2 (<xref rid="GR277891LIC52" ref-type="bibr">Stickels et al. 2021</xref>), and Stereo-seq (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) generate multiple sequencing slices for the same tissue at one time. However, because of the difference in the dissection of the tissue slices and their placement on array, the spatial coordinate system of multiple slices are different and cannot be easily compared across slices (<xref rid="GR277891LIC63" ref-type="bibr">Zeira et al. 2022</xref>), urgently requiring computational methods for multislice joint embedding and automatic domain annotation. We hence proposed two strategies, namely a transfer learning (TL) strategy and a three-dimensional (3D) stacking (3DStack) strategy, based on current representation learning framework to acquire joint embeddings of multiple slices (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S4</xref>). Specifically, given multiple slices with inconsistent coordinates and a deep representation learning model, TL strategy chooses one among these slices to train the deep representation learning model and then acquires the joint embeddings of all slices based on the trained model. In comparison, the 3D stacking strategy adds a third dimension to stack the multiple slices in a 3D space and only considers spatial relationship between spots from the same slice by setting the distance between different slices to a large value (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S20</xref>). Based on the 3D coordinates reconstructed by 3D stacking strategy, current representation learning methods can be easily applied to multiple slices for joint embedding. After obtaining joint embeddings of multiple slices, automatic domain annotation can be easily implemented with a specified classifier (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S4</xref>). Specifically, we first split the data into a reference set with domain labels and a target set without labels, then based on the joint embeddings, we trained a SVM on the reference set with its embeddings and labels, and predicted the labels of target set with the trained SVM. Note that the official implementation of DR-SC, SpaGCN, SpatialPCA, and STAGATE cannot use 3D coordinates, whereas SCANPYand Seurat cannot integrate spatial information, thus not applicable to 3D stacking strategy. Nondeep learning models like SCANPY, Seurat, NSF, DR-SC and SpatialPCA are not applicable to TL strategy designed for deep methods, and acquire the latent embeddings of each slice separately in the subsequent experiments.</p>
      <p>We first adopted the 12 DLPFC slices to quantitatively show the integration and annotation performance of different methods based on the two strategies, denoting methods using the TL and 3DStack strategies as *-TL and *-3DStack, respectively. We split the DLPFC data set into a reference set, that is, Slice 151,673 with domain labels, and a target set, that is, remaining slices without labels. Naturally, PAST constructed reference data of the BNN module using Slice 151,673 with domain labels. As the UMAP and t-SNE visualization shown in <xref rid="GR277891LIF6" ref-type="fig">Figure 6</xref>A,B and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figure S21A–C</xref>, methods like SCANPY, Seurat, NSF, DR-SC, and SpatialPCA, which were directly applied to multiple slices and acquired the latent embeddings separately, obtain relatively poor performance, whereas STAGATE-TL, PAST-TL, and PAST-3DStack succeed in batch correction and domain identification, based on the joint embeddings of all the 12 slices obtained by TL and 3DStack strategy. We next used the embeddings and domain labels of Slice 151,673 to train a SVM classifier and annotated the spatial domains in other slices. For quantitative comparison of annotation results, PAST-TL consistently outperforms the baseline methods (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>C), and achieved significantly higher scores of Acc, κ, mF1, and wF1 than STAGATE-TL, the second-best method, with <italic>P</italic>-values of 0.0034, 0.0024, 0.0005, and 0.0005, respectively, in one-sided paired Wilcoxon signed-rank tests. PAST based on the 3D stacking strategy, namely PAST-3DStack, provides even better performance than PAST-TL and naturally outperforms any other baseline methods. Furthermore, clustering evaluation of the joint embeddings showed similar results (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S21D</xref>), highlighting the superiority of the TL and 3DStack strategies and PAST in multislice integration and automatic annotation.</p>
      <fig position="float" id="GR277891LIF6">
        <label>Figure 6.</label>
        <caption>
          <p>PAST facilitates multislice joint embedding and automatic domain annotation. UMAP visualization of spots based on the joint embeddings of all the 12 DLPFC slices colored by (<italic>A</italic>) slices and (<italic>B</italic>) spatial domains. (<italic>C</italic>) Performance of supervised annotation evaluated by accuracy (Acc), Cohen's kappa value (κ), mean F1 score (mF1), and weighted F1 score (wF1), where Slice 151,673 was taken as the training set and other 11 slices were taken as test sets. The center line, box limits, and whiskers in the boxplots are the median, upper and lower quartiles, and 1.5× interquartile range, respectively. (<italic>D</italic>) The manual annotation of BCS1, in which the IDC_3 tumor region was black circled. UMAP visualization of the joint embeddings of spots in BCS1/2 sections colored by (<italic>E</italic>) sections and (<italic>F</italic>) spatial domains. (<italic>G</italic>) The supervised annotation results on BCS2 by different methods. The black circle denotes the supervised annotated IDC_3 and Tumor_edge_3, whereas the blue and orange circles denote the supervised annotated DCIS/LCIS_1 and DCIS/LCIS_2, respectively. (<italic>H</italic>) The annotation results of Tumor_edge_3 and DCIS/LCIS_2 by PAST-TL and PAST-3DStack and the spatial expression patterns of BCS1-marker genes on BCS2.</p>
        </caption>
        <graphic xlink:href="1757f06" position="float"/>
      </fig>
      <p>We further collected another two 10x Visium human breast cancer sections (BCSs) for integration and annotation, where the first section (BCS1) of the data set is precisely annotated by (<xref rid="GR277891LIC20" ref-type="bibr">Fu et al. 2021</xref>) and the second section (BCS2) is not annotated. Naturally, we treated BCS1 (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>D) as reference set with domain labels and treated BCS2 as target set for annotation. PAST-TL and PAST-3DStack again successfully correct the batch effect between the sections and separate spots from different domains (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>E,F; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S22A,B,D</xref>). Based on joint embeddings acquired by different methods, we next trained a SVM classifier with embeddings and labels of BCS1, and annotated BCS2 (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>G; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S22C</xref>). For the evaluation of annotation results, we identified marker genes for each domain based on the ground-truth labels on BCS1 (referred to as BCS1-marker genes), and found that BCS1-marker genes of each domain were also differentially expressed in most of the corresponding PAST-TL and PAST-3DStack annotated tumor areas on BCS2 (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S23</xref>), indicating the ability of PAST-TL and PAST-3DStack to reveal biological variation among tumor areas. In addition, PAST successfully captured BCS2-specific spatial domains by separating the IDC_3 region on BCS1 into IDC_3 and Tumor_edge_3 on BCS2 (black circles in <xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>D,G). The BCS1-marker genes of Tumor_edge_3 also showed the unique spatial pattern of the newly annotated Tumor_edge_3 on BCS2, which further suggests the accuracy of annotation results on BCS2 (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>H). We also performed DEG analysis for Tumor_edge_3 region based on the annotation results of PAST-TL and PAST-3DStack on BCS2, and identified the same five most significant DEGs including <italic>IGHG3, IGKC, IGLC2, IGHG4</italic>, and <italic>IGHG1</italic> with adjusted <italic>P</italic>-values of 1.11 × 10<sup>−83</sup>, 1.86 × 10<sup>−78</sup>, 9.18 × 10<sup>−74</sup>, 9.18 × 10<sup>−74</sup>, 1.66 × 10<sup>−69</sup> for PAST-TL and 4.52 × 10<sup>−74</sup>, 2.60 × 10<sup>−69</sup>, 8.11 × 10<sup>−66</sup>, 1.75 × 10<sup>−62</sup>, 3.21 × 10<sup>−60</sup> for PAST-3DStack, respectively. Based on previous literature, the linkage of <italic>IGHG1/3/4</italic> provides information for prognosis of diseases like autoimmunity and malignancy (<xref rid="GR277891LIC43" ref-type="bibr">Oxelius and Pandey 2013</xref>), <italic>IGKC</italic>, serving as a robust immune marker, could predict metastasis-free survival and response to chemotherapy (<xref rid="GR277891LIC48" ref-type="bibr">Schmidt et al. 2012</xref>), and <italic>IGLC2</italic> was proven to be a significant prognostic biomarker for triple-negative breast cancer patients (<xref rid="GR277891LIC8" ref-type="bibr">Chang et al. 2021</xref>). The Gene Ontology enrichment for the top 10 DEGs of Tumor_edge_3 also significantly revealed lots of biological immune processes for both PAST-TL (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S24</xref>) and PAST-3DStack model (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S25</xref>).</p>
      <p>PAST-TL and PAST-3DStack also successfully captured the biological difference between DCIS/LCIS_1 and DCIS/LCIS_2 (blue and orange circles in <xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>G) and accurately annotated DCIS/LCIS_2 on BCS2, which was missed by other methods. The spatial expression visualization of BCS1-marker genes of DCIS/LCIS_2 on BCS2 illustrated the accurate annotation of DCIS/LCIS_2 by PAST and the two strategies (<xref rid="GR277891LIF6" ref-type="fig">Fig. 6</xref>H). To summarize, based on the two strategies, PAST cannot only effectively facilitate multislice joint embedding and automatic domain annotation, but also identify test set-specific spatial patterns and reveal the corresponding biological implications.</p>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s2">
    <title>Discussion</title>
    <p>In this article, we introduce PAST, a comprehensive and scalable framework that effectively integrates prior information via Bayesian neural networks, deciphers global and local spatial correlations based on graph residual network integrated with self-attention mechanism, and enables scalable training and prediction on large data sets with RWS strategy. With comprehensive experiments on multiple data sets generated by various technologies, we have shown that PAST capably incorporates prior information from various sources to better tackle the high-level technical variation and effectively integrates spatial information to characterize spatial domains, highlighting the superior information fusion capabilities of PAST. We have also showed the successful applications of PAST in downstream tasks including spatial domain characterization, ST visualization, spatial trajectory inference, and pseudotime analysis. Experiments on large-scale data sets also proved the scalability and effectiveness of PAST. Furthermore, PAST not only enables multislice joint embedding and automatic annotation of spatial domains for multiple ST data, but also provides biological insights into the annotated domains.</p>
    <p>PAST stands out as a representation learning method tailored for ST data by incorporating reference data, which can be constructed from four different approaches (Methods). This inherent property of PAST showcases remarkable potential in deciphering ST data, especially in light of the ever-growing reservoir of both ST data and scRNA-seq data, while it simultaneously poses challenges in selecting top-notch reference data for better performance. To offer practical suggestions and recommendations for users, we diligently constructed reference data encompassing all the four approaches for the data sets in the aforementioned experiments and reported their performance outcomes (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S5</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S26</xref>), which highlights the superiority of PAST even when integrating reference from completely different technologies. Nevertheless, owing to the potential uncertainty stemming from incongruity of external reference, it is advisable to prioritize reference data from the same technique, of the same tissue type, containing more shared domains, and of a larger scale. Furthermore, we also proposed three recommendation scores, that is, maxMAP, maxSC, and maxCHS, to guide users to select high-quality reference data in an adaptive way (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S5</xref>). The three recommendation scores assess the latent embeddings acquired by PAST with different external reference data, signifying stronger recommendation levels through higher values. Finally, the scores have been proven to effectively steer users towards selecting the optimal approach for reference construction across all data sets, while maintaining satisfactory computational time (<xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S26</xref>; <xref rid="SD5" ref-type="supplementary-material">Supplemental Tables S5</xref>, <xref rid="SD6" ref-type="supplementary-material">S6</xref>), which provides an adaptive, accurate, and scalable approach for users to select optimal reference data in ST data analysis.</p>
    <p>The self-attention mechanism of PAST is implemented to adaptively learn attention weights and proven to capably aggregates more information from neighbor spots belonging to the same domain. This capability can be translated into several practical benefits for researchers to analyze ST data, including interpretable visualization, effective clustering, and accurate annotation, which has been systematically showed in the aforementioned experiments. In addition, we further envision an extension of the self-attention mechanism, which models the relationship between spatially close spots based on the transcriptional information, to unravel intricate cell-cell interactions (CCI), because recent research has underscored the reliability of deciphering CCI from transcriptomic data (<xref rid="GR277891LIC3" ref-type="bibr">Armingol et al. 2021</xref>) and the strong relationship between spatial structures and CCI in the microenvironment (<xref rid="GR277891LIC4" ref-type="bibr">Asp et al. 2020</xref>; <xref rid="GR277891LIC39" ref-type="bibr">Liu et al. 2022c</xref>). Massively parallel sequencing-based technologies like 10x Visium, Slide-seq (<xref rid="GR277891LIC47" ref-type="bibr">Rodriques et al. 2019</xref>), Slide-seq v2 (<xref rid="GR277891LIC52" ref-type="bibr">Stickels et al. 2021</xref>), and Stereo-seq (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) generates multiple sequencing slices for the same tissue with inconsistent coordinates. We propose a 3D stacking strategy to stack the slices into a 3D coordinate system and only consider the attention weights between spots from the same slice (PAST-3DStack). A recent method, called PASTE (<xref rid="GR277891LIC63" ref-type="bibr">Zeira et al. 2022</xref>), has been proposed to align multiple adjacent tissue slices into a consistent spatial coordinate system. Based on the coordinates obtained by PASTE, PAST capably implements cross-slice attention weights and obtain joint embeddings of multiple slices, denoted as PASTE-PAST. We compared PAST-3DStack with PASTE-PAST and other baseline methods for joint embedding on three donors of the human DLPFC data set, highlighting the superiority of PAST-3DStack (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S6</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S27, S28</xref>). Nevertheless, compared with PAST-3DStack, the combination of PASTE and PAST enables the characterization of cross-slice attention and inspires us to explore the extension of self-attention mechanism to model cross-data-set attention for multislice integration.</p>
    <p>Generalizability of computational methods across technologies, species, and tissue types holds immense significance. To test the consistency of PAST across various biological systems, we further extend our model to another two data sets of different species and tissue types, namely a Stereo-seq axolotl brain data set (<xref rid="GR277891LIC58" ref-type="bibr">Wei et al. 2022</xref>) and a Stereo-seq zebrafish embryo data set (<xref rid="GR277891LIC37" ref-type="bibr">Liu et al. 2022a</xref>) (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S7</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S29, S30</xref>). The experimental results showed the superiority of PAST in term of spatial clustering, UMAP, t-SNE, and spatial visualization. We also implemented PAST-3DStack to the Stereo-seq zebrafish embryo data set, which is composed of 12 slices, for joint embedding, illustrating the superiority of PAST and the 3D stacking strategy in multislice integration across different species (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S8</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S31</xref>). In summary, we have showcased the superior performance of PAST across four sequencing technologies, encompassing four species and spanning seven tissue types, which underscores the broad applicability and unwavering consistency of PAST across various biological systems.</p>
    <p>Certainly, there are several avenues for improving PAST. First, given that Chen et al. achieved satisfactory annotation and simulation performance in scATAC-seq data through assuming the latent embeddings follow a Gaussian mixture distribution (<xref rid="GR277891LIC11" ref-type="bibr">Chen et al. 2022b</xref>), we can explore the application of PAST in ST data simulation by adding more complex assumptions on latent distribution. Second, with the rapid development of ST sequencing technologies, many massively parallel sequencing-based methods are often complemented by high-resolution hematoxylin and eosin (H&amp;E) histology images, demanding methods like PAST to incorporate cross-modality information which contains valuable heterogeneity and pathological information (<xref rid="GR277891LIC28" ref-type="bibr">Hu et al. 2021b</xref>). Third, the rapid development of graph neural network and large language model field provide advanced methodology to model the relationship between connected nodes in graph or related words in sentence, which also opens new horizons for better characterization of relationship between neighboring spots. Finally, Chen et al. have already proven the effectiveness of leveraging reference data in the analysis of scATAC-seq data (<xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>), so we anticipate the extended application of PAST in other spatial omics data like spatial-ATAC-seq data (<xref rid="GR277891LIC15" ref-type="bibr">Deng et al. 2022</xref>; <xref rid="GR277891LIC21" ref-type="bibr">Gao et al. 2023</xref>).</p>
  </sec>
  <sec sec-type="methods" id="s3">
    <title>Methods</title>
    <sec id="s3a">
      <title>The model of PAST</title>
      <p>PAST is a self-supervised representation learning framework built upon variational graph convolutional autoencoder (<xref rid="GR277891LIC31" ref-type="bibr">Kingma and Welling 2014</xref>) and integrates a graph residual network (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>; <xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) to model the node dependency in spatial graph. It takes three kinds of data as input, including preprocessed target gene expression matrix, target spatial coordinate matrix and reference gene expression matrix (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>B). The details about data preprocessing are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S9</xref>.</p>
      <sec id="s3a1">
        <title>Encoder</title>
        <p>The encoder of PAST is a three-layer neural network. The first layer consists of a BNN module and a parallel FCN, and the output of the first layer is the concatenation of the two modules. It decomposes the total variation in ST data into two components (<xref rid="GR277891LIC34" ref-type="bibr">Li et al. 2017</xref>; <xref rid="GR277891LIC9" ref-type="bibr">Chen et al. 2021</xref>): the component that captures the shared biological variation from reference data with a BNN module, and the component that captures the unique biological variation in target ST data with an unconstrained FCN. This property has been validated through ablation study of BNN module and the FCN module, shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S10</xref> and <xref rid="SD10" ref-type="supplementary-material">Supplemental Figures S32, S1B, S5B, and S15B</xref>. The second and third layers are two stacked self-attention modules. The input of self-attention module includes a feature matrix from the last layer and the <italic>k</italic>-NN graph constructed with spatial coordinates of the target data.</p>
      </sec>
      <sec id="s3a2">
        <title>Reparameterization module</title>
        <p>As suggested by variational autoencoder (VAE), we assume the prior of latent embeddings is centered isotropic multivariate Gaussian distribution, use two FCNs to obtain the mean and logarithmic variance matrices of latent space based on the output of encoder, and obtain normally distributed samples through the reparameterization trick. We emphasize that the mean matrix of this module is the final output of PAST, that is, latent embeddings.</p>
      </sec>
      <sec id="s3a3">
        <title>Decoder</title>
        <p>The decoder of PAST is also a three-layer network, in which the first and second layers are stacked self-attention modules and the third layer is a FCN. The decoder takes multivariate normally distributed samples from the reparameterization module as input and then outputs the reconstructed gene expression matrix of the target data.</p>
      </sec>
      <sec id="s3a4">
        <title>Training and prediction workflow</title>
        <p>In the forward propagation phase of training workflow, a <italic>k</italic>-NN graph is first constructed based on the target spatial coordinate matrix. Second, PAST samples high-quality subgraphs using the ripple walk training strategy based on the <italic>k</italic>-NN graph, providing subgraphs and minibatch gene expression matrices for encoder. The encoder of PAST takes the subgraphs and the target and reference gene expression matrices as input, in which the subgraphs serve as the spatial neighborhood graph for the self-attention module and the reference gene expression matrix provides prior parameters for BNN module. Third, reparameterization module uses the output feature matrix of encoder to acquire the parameters of latent Gaussian distribution based on two FCNs, implements the reparameterization trick (<xref rid="GR277891LIC31" ref-type="bibr">Kingma and Welling 2014</xref>) to sample multivariate normally distributed vectors, and then feeds the vectors and the subgraphs obtained from ripple walk sampler into the decoder to get a target reconstructed gene expression matrix. In the backward propagation phase, the gradient of each parameter in the model is calculated according to the loss function of PAST and is updated based on the Adam optimizer with default initial learning rate <italic>lr</italic> = 0.001. The detailed model structure and hyperparameter settings of PAST are summarized in <xref rid="SD7" ref-type="supplementary-material">Supplemental Table S7</xref>. The prediction workflow only contains the forward propagation of the encoder to acquire the mean matrix of the reparameterization module, that is, the latent embeddings. Furthermore, PAST implements ripple walk prediction strategy instead of the ripple walk training strategy in the prediction workflow.</p>
      </sec>
    </sec>
    <sec id="s3b">
      <title>Ripple walk sampler</title>
      <p>To extend our model to large-scale application scenarios, we adopt a subgraph-based sampling strategy called ripple walk sampler (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>C), which samples high-quality subgraphs to enable minibatch training (ripple walk training) under the premise of satisfying randomness and connectivity (<xref rid="GR277891LIC5" ref-type="bibr">Bai et al. 2021</xref>). Furthermore, we extend the ripple walk sampler for scalable prediction, called ripple walk prediction. The detailed explanations of ripple walk sampler, training, and prediction are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S11</xref> and <xref rid="SD10" ref-type="supplementary-material">Supplemental Algorithms S1, S2, S3</xref>.</p>
    </sec>
    <sec id="s3c">
      <title>Bayesian neural network</title>
      <p>BNN introduces uncertainty into weights of the neural network to improve generalization in nonlinear regression problems (<xref rid="GR277891LIC7" ref-type="bibr">Blundell et al. 2015</xref>). Here we use BNN to integrate shared biological information from reference data (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>D).</p>
      <p>Parameters of the BNN module could be represented by <bold><italic>P</italic></bold> ∈ <italic>d</italic><sub><italic>in</italic></sub> × <italic>d</italic><sub><italic>out</italic></sub>, and each element in <bold><italic>P</italic></bold> is subject to a Gaussian distribution,<disp-formula id="GR277891LIUM1"><mml:math id="UM1" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>∼</mml:mo><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <inline-formula id="il1"><mml:math id="IL1" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> and <inline-formula id="il2"><mml:math id="IL2" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> are elements in the <italic>i</italic>th row and <italic>j</italic>th column of the mean matrix <bold><italic>μ</italic></bold><sub><italic>b</italic></sub> and variance matrix <inline-formula id="il3"><mml:math id="IL3" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula>, respectively. We get normally distributed parameters <bold><italic>P</italic></bold><sub><italic>ij</italic></sub> through reparameterization trick in each forward propagation process. Given an input matrix <bold><italic>M</italic></bold> ∈ <italic>B</italic> × <italic>d</italic><sub><italic>in</italic></sub> in a minibatch, the output matrix of shape <italic>B</italic> × <italic>d</italic><sub><italic>out</italic></sub> of BNN module is<disp-formula id="GR277891LIUM2"><mml:math id="UM2" display="block" overflow="scroll"><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">δ</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>⊙</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>f</italic><sub><italic>bnn</italic></sub>( · ) denotes the function of BNN module, <bold>δ</bold> is the standard gaussian noise matrix and <inline-formula id="il4"><mml:math id="IL4" display="inline" overflow="scroll"><mml:mo>⊙</mml:mo></mml:math></inline-formula> denotes element-wise product.</p>
      <p>To integrate shared biological variation information in reference data, we assume elements in <bold><italic>P</italic></bold> are subject to a prior Gaussian distribution parameterized by <bold><italic>μ</italic></bold><sub><italic>p</italic></sub> and <inline-formula id="il5"><mml:math id="IL5" display="inline" overflow="scroll"><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula>, where <bold><italic>μ</italic></bold><sub><italic>p</italic></sub> is the PCA projection weight matrix of the reference gene expression matrix and <bold><italic>σ</italic></bold><sub><italic>p</italic></sub> contains elements equal to one-tenth standard deviation of <bold><italic>μ</italic></bold><sub><italic>p</italic></sub>. The step-by-step construction of reference gene expression matrix from various sources is illustrated in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S1</xref> and <xref rid="SD10" ref-type="supplementary-material">Supplemental Algorithm S4</xref>. KLD is used to restrict the distance between the Gaussian distribution parameterized by the parameters of BNN module and the prior Gaussian distribution parameterized by reference data:<disp-formula id="GR277891LIUM3"><mml:math id="UM3" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:math></disp-formula>
<disp-formula id="GR277891LIUM4"><mml:math id="UM4" display="block" overflow="scroll"><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>b</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>−</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula>
</p>
    </sec>
    <sec id="s3d">
      <title>Self-attention mechanism</title>
      <p>Self-attention mechanism is the key mechanism of transformer for capturing the relationship between words in a given sentence in machine translation tasks, showing superior performance compared with other recurrent neural network-based models (<xref rid="GR277891LIC55" ref-type="bibr">Vaswani et al. 2017</xref>; <xref rid="GR277891LIC46" ref-type="bibr">Raffel et al. 2020</xref>). Recent advances have revealed that gene expression levels of neighboring spots in a tissue microenvironment tend to be correlated (<xref rid="GR277891LIC17" ref-type="bibr">Dries et al. 2021</xref>; <xref rid="GR277891LIC16" ref-type="bibr">Dong and Zhang 2022</xref>; <xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). Inspired by the above understanding, PAST adopts a self-attention mechanism to model the relationship between neighboring spots (<xref rid="GR277891LIF1" ref-type="fig">Fig. 1</xref>E).</p>
      <p>The input of the self-attention module is a feature matrix <bold><italic>M</italic></bold> and the corresponding <italic>k</italic>-NN graph <inline-formula id="il6"><mml:math id="IL6" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>. <inline-formula id="il7"><mml:math id="IL7" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> is constructed using spatial coordinates with <italic>k</italic> = 6. The input matrix <bold><italic>M</italic></bold> is mapped to obtain query <bold><italic>Q</italic></bold>, key <bold><italic>K</italic></bold>, and value <bold><italic>V</italic></bold> through three FCNs, and the adjacent matrix <inline-formula id="il8"><mml:math id="IL8" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> can then be calculated as follows:<disp-formula id="GR277891LIUM5"><mml:math id="UM5" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">Q</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">K</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <italic>d</italic><sub><italic>k</italic></sub> is the feature dimension of query <bold><italic>Q</italic></bold> and key <bold><italic>K</italic></bold>. The attention weight matrix <bold><italic>A</italic></bold> can be obtained by normalizing the adjacent matrix <inline-formula id="il9"><mml:math id="IL9" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>,<disp-formula id="GR277891LIUM6"><mml:math id="UM6" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">A</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mi mathvariant="script">A</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold><italic>A</italic></bold><sub><italic>ij</italic></sub> is the attention weight from spot <italic>j</italic> to spot <italic>i</italic>, and <italic>S</italic><sub><italic>i</italic></sub> denotes the set of neighbors of spot <italic>i</italic> in <inline-formula id="il10"><mml:math id="IL10" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="script">G</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>. To avoid excessive spatial smoothing of hidden features, we add a shortcut in the self-attention module (<xref rid="GR277891LIC65" ref-type="bibr">Zhang and Meng 2019</xref>; <xref rid="GR277891LIC36" ref-type="bibr">Liu et al. 2021</xref>) and the output of self-attention module can be written as the subsequent form:<disp-formula id="GR277891LIUM7"><mml:math id="UM7" display="block" overflow="scroll"><mml:mrow><mml:mspace width="0.4em"/><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>t</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">M</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">V</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">A</mml:mi><mml:mi>V</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where <italic>f</italic><sub><italic>attn</italic></sub>( · ) denotes the function of self-attention module.</p>
    </sec>
    <sec id="s3e">
      <title>Loss function</title>
      <p>Analysis of omics data is susceptible to sequencing noise such as dropout, and recent studies have proven that it is beneficial to consider data sparsity and dropout in spatial transcriptomic data (<xref rid="GR277891LIC50" ref-type="bibr">Shengquan et al. 2021</xref>). Here we design sparsity adaptive reconstruction loss based on the insight that the higher the data sparsity, the more serious the dropout phenomenon is, and the higher probability the zero gene expression observations are false negative. Given a minibatch containing <italic>B</italic> spots and <italic>M</italic> genes, the sparsity adaptive reconstruction loss is shown as<disp-formula id="GR277891LIUM8"><mml:math id="UM8" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>B</mml:mi><mml:mi>M</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold><italic>x</italic></bold><sub><italic>ij</italic></sub> denotes the profiled expression level of gene <italic>j</italic> in spot <italic>i</italic>, <inline-formula id="il11"><mml:math id="IL11" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mover><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the reconstructed expression level of gene <italic>j</italic> in spot <italic>i</italic>, and the function <italic>I</italic>( · ) is (<italic>s</italic><sub><italic>i</italic></sub> represents the sparsity of spot <italic>i</italic>)<disp-formula id="GR277891LIUM9"><mml:math id="UM9" display="block" overflow="scroll"><mml:mi>I</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mn>1</mml:mn><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mspace width="0.4em"/><mml:mo>=</mml:mo><mml:mspace width="0.4em"/><mml:mn>0</mml:mn></mml:mrow><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula>
We assume the low-dimensional embeddings follow multivariate Gaussian distribution and the prior is the centered isotropic multivariate Gaussian distribution. The distance between the latent distribution and the prior distribution is restricted by KLD (<xref rid="GR277891LIC31" ref-type="bibr">Kingma and Welling 2014</xref>):<disp-formula id="GR277891LIUM10"><mml:math id="UM10" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:mi>L</mml:mi><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.4em"/><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">I</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:math></disp-formula>
<disp-formula id="GR277891LIUM11"><mml:math id="UM11" display="block" overflow="scroll"><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>B</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:munderover><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi mathvariant="bold-italic">σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold>μ</bold> and <bold>σ</bold> are the mean vectors and standard deviation vectors of latent space, respectively, whereas <italic>d</italic><sub><italic>lat</italic></sub> denotes the dimension of latent space.</p>
      <p>Metric learning has been proposed to model the distance between samples, making the distance between positive sample pairs closer and the distance between negative sample pairs farther (<xref rid="GR277891LIC23" ref-type="bibr">Hadsell et al. 2006</xref>). Samples in spatial transcriptomics are of strong spatial autocorrelation, which means that spatial neighboring spots may have similar gene expression patterns and tend to belong to the same functional structure (<xref rid="GR277891LIC64" ref-type="bibr">Zeng et al. 2022</xref>). Here we design a metric learning loss function to restrict the distance of low-dimensional representations between neighbor samples:<disp-formula id="GR277891LIUM12"><mml:math id="UM12" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:munderover><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mo>⁡</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">μ</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:msub><mml:mo fence="false">|</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <bold><italic>G</italic></bold> is the weighted spatial neighbor graph and the connection weights between samples are calculated using the Student's <italic>t</italic>-distribution kernel, <bold>μ</bold><sub><italic>i</italic></sub> and <bold>μ</bold><sub><italic>j</italic></sub> denote the latent embeddings of spot <italic>i</italic> and spot <italic>j</italic>, respectively. The calculation of <bold><italic>G</italic></bold> can be denoted as<disp-formula id="GR277891LIUM13"><mml:math id="UM13" display="block" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mspace width="0.4em"/></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo movablelimits="false">∑</mml:mo></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:msup><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mo fence="false">|</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.4em"/><mml:msup><mml:mi>j</mml:mi><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mo fence="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula>
where <bold><italic>c</italic></bold><sub><italic>i</italic></sub> denotes the spatial coordinate of spot <italic>i</italic>, <italic>S</italic><sub><italic>i</italic></sub> denotes the set of neighbors of spot <italic>i</italic>, α is a scale factor that is set to 1 by default. We also tried to build the graph <bold><italic>G</italic></bold> with gene expression information of spots, that is, denoting the above <bold><italic>c</italic></bold><sub><italic>i</italic></sub> as gene expression vector of spot <italic>i</italic>, and compared the two different approaches (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S12</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Fig. S33</xref>), illustrating the effectiveness of building graph <bold><italic>G</italic></bold> with spatial information.</p>
      <p>As described in the above section, we integrate prior information through the BNN (<xref rid="GR277891LIC7" ref-type="bibr">Blundell et al. 2015</xref>) module and restrict the distance between parameter of the BNN module and prior distribution through <italic>L</italic><sub><italic>bnn</italic></sub> loss function. The objective function of PAST is the combination of the aforementioned four parts:<disp-formula id="GR277891LIUM14"><mml:math id="UM14" display="block" overflow="scroll"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>3</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msub><mml:mtext>β</mml:mtext><mml:mn>4</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
where <italic>β</italic><sub>1</sub>, <italic>β</italic><sub>2</sub>, <italic>β</italic><sub>3</sub>, <italic>β</italic><sub>4</sub> are coefficients served as a trade-off between the four parts and we set <italic>β</italic><sub>1</sub> = 1, <italic>β</italic><sub>2</sub> = 1, <italic>β</italic><sub>3</sub> = 1, <italic>β</italic><sub>4</sub> = 1 by default. We have evaluated the impact of the four coefficients and the contribution of the four loss function parts through experimental analysis, which finally illustrates the robustness of PAST to different hyperparameter settings and the significance of each part of the loss function (<xref rid="SD10" ref-type="supplementary-material">Supplemental Text S13</xref>; <xref rid="SD10" ref-type="supplementary-material">Supplemental Figs. S34, S35</xref>).</p>
    </sec>
    <sec id="s3f">
      <title>Multislice joint embedding and automatic annotation</title>
      <p>We propose two strategies, namely a transfer learning strategy and a 3D stacking strategy, to apply representation learning methods designed for single slice to multiple slices for joint embedding. Furthermore, we annotate the domain labels of multiple slices in ST data based on the joint embeddings obtained by the aforementioned strategies. The detailed explanations of the joint embedding and automatic annotation strategies are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S4</xref>.</p>
    </sec>
    <sec id="s3g">
      <title>Baseline methods, downstream analyses, and evaluation metrics</title>
      <p>Downstream applications including visualization, clustering, trajectory inference, and pseudotime analysis are detailed in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S3</xref>. To evaluate the performance of our model, we benchmarked PAST with nine baseline methods in term of 16 quantitative metrics and various downstream analyses. We describe the baseline methods, parameter settings, and the evaluation metrics in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S2</xref>. The details about data collection and preprocessing are shown in <xref rid="SD10" ref-type="supplementary-material">Supplemental Text S9</xref>. The information about all the target data sets and reference data sets is summarized in <xref rid="SD8" ref-type="supplementary-material">Supplemental Table S8</xref>.</p>
    </sec>
    <sec id="s3h">
      <title>Data sets</title>
      <p>The STARmap mouse primary visual cortex (MPVC) data set (<xref rid="GR277891LIC57" ref-type="bibr">Wang et al. 2018</xref>) is available at <uri xlink:href="https://kangaroo-goby.squarespace.com/data">https://kangaroo-goby.squarespace.com/data</uri>. The 10x Visium dorsolateral prefrontal cortex (DLPFC) data set (<xref rid="GR277891LIC40" ref-type="bibr">Maynard et al. 2021</xref>) includes 12 slices from 3 neurotypical adult donors and is accessible through <uri xlink:href="http://spatial.libd.org/spatialLIBD">http://spatial.libd.org/spatialLIBD</uri>. The osmFISH mouse somatosensory cortex (MSC) data set (<xref rid="GR277891LIC13" ref-type="bibr">Codeluppi et al. 2018</xref>) is available at website <uri xlink:href="http://linnarssonlab.org/osmFISH/availability/">http://linnarssonlab.org/osmFISH/availability/</uri>. The Stereo-seq mouse olfactory bulb (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) Sections 1 (MOBS1) and Section 2 (MOBS2) are accessible at <uri xlink:href="https://db.cngb.org/stomics/mosta/download/">https://db.cngb.org/stomics/mosta/download/</uri>, where MOBS2 was taken as the reference data for MOBS1. The 10x Visium human breast cancer Section 1 (BCS1) was precisely annotated by <xref rid="GR277891LIC20" ref-type="bibr">Fu et al. (2021)</xref>, whereas Section 2 (BCS2) is not manually annotated, available at the 10x Genomics website <uri xlink:href="https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-1-1-standard-1-1-0">https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-1-1-standard-1-1-0</uri> and <uri xlink:href="https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-2-1-standard-1-1-0">https://www.10xgenomics.com/resources/datasets/human-breast-cancer-block-a-section-2-1-standard-1-1-0</uri>, respectively. The three Stereo-seq axolotl brain data sets (<xref rid="GR277891LIC58" ref-type="bibr">Wei et al. 2022</xref>) identified by 2DPI are available through the website <uri xlink:href="https://db.cngb.org/stomics/artista/download/">https://db.cngb.org/stomics/artista/download/</uri>. The Stereo-seq zebrafish embryo data set (<xref rid="GR277891LIC37" ref-type="bibr">Liu et al. 2022a</xref>) contains 12 slices of 12 h post-fertilization zebrafish embryo and can be downloaded from <uri xlink:href="https://db.cngb.org/stomics/zesta/download/">https://db.cngb.org/stomics/zesta/download/</uri>. The 10x Visium mouse brain coronal data set is accessible through <uri xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets/1.1.0/V1_Adult_Mouse_Brain">https://support.10xgenomics.com/spatial-gene-expression/datasets/1.1.0/V1_Adult_Mouse_Brain</uri>. The Stereo-seq mouse brain data set (<xref rid="GR277891LIC10" ref-type="bibr">Chen et al. 2022a</xref>) can be downloaded from <uri xlink:href="https://db.cngb.org/stomics/mosta/download">https://db.cngb.org/stomics/mosta/download</uri>. The scRNA-seq mouse primary visual cortex data set was obtained from the NCBI Gene Expression Omnibus (GEO; <uri xlink:href="https://www.ncbi.nlm.nih.gov/geo/">https://www.ncbi.nlm.nih.gov/geo/</uri>) under accession number GSE71585.</p>
    </sec>
    <sec id="s3i">
      <title>Software availability</title>
      <p>The PAST algorithm is implemented in Python and the source code for reproduction is available at GitHub (<uri xlink:href="https://github.com/lizhen18THU/PAST">https://github.com/lizhen18THU/PAST</uri>) and <xref rid="SD9" ref-type="supplementary-material">Supplemental Code</xref>. We also provided detailed documentation and step-by-step tutorials for applying PAST to ST data generated by different technologies at Read the Docs website (<uri xlink:href="https://past.readthedocs.io/en/latest">https://past.readthedocs.io/en/latest</uri>).</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="SM1">
    <title>Supplementary Material</title>
    <supplementary-material id="SD1" position="float" content-type="local-data">
      <label>Supplement 1</label>
      <media xlink:href="Supplemental_Table_S1.xlsx" id="d64e3065" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD2" position="float" content-type="local-data">
      <label>Supplement 2</label>
      <media xlink:href="Supplemental_Table_S2.xlsx" id="d64e3068" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD3" position="float" content-type="local-data">
      <label>Supplement 3</label>
      <media xlink:href="Supplemental_Table_S3.xlsx" id="d64e3071" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD4" position="float" content-type="local-data">
      <label>Supplement 4</label>
      <media xlink:href="Supplemental_Table_S4.xlsx" id="d64e3074" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD5" position="float" content-type="local-data">
      <label>Supplement 5</label>
      <media xlink:href="Supplemental_Table_S5.xlsx" id="d64e3077" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD6" position="float" content-type="local-data">
      <label>Supplement 6</label>
      <media xlink:href="Supplemental_Table_S6.xlsx" id="d64e3080" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD7" position="float" content-type="local-data">
      <label>Supplement 7</label>
      <media xlink:href="Supplemental_Table_S7.xlsx" id="d64e3083" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD8" position="float" content-type="local-data">
      <label>Supplement 8</label>
      <media xlink:href="Supplemental_Table_S8.xlsx" id="d64e3086" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD9" position="float" content-type="local-data">
      <label>Supplement 9</label>
      <media xlink:href="Supplemental_Code.zip" id="d64e3089" position="anchor"/>
    </supplementary-material>
    <supplementary-material id="SD10" position="float" content-type="local-data">
      <label>Supplement 10</label>
      <media xlink:href="Supplemental_Materials.pdf" id="d64e3092" position="anchor"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgments</title>
    <p>This work was supported by the National Key Research and Development Program of China Grant No. 2021YFF1200902 (R.J.), the National Natural Science Foundation of China Grants No. 62203236 (S.C.), No. 62273194 (R.J.), No. 61721003 (X.Z.), and the Fundamental Research Funds for the Central Universities, Nankai University, Grant No. 63231137 (S.C.).</p>
    <p><italic>Author contributions:</italic> S.C. conceived the study and supervised the project. Z.L. and S.C. designed, implemented, and validated PAST. X.C. and X.Z. helped with analyzing the results. S.C., Z.L., X.Z., and R.J. wrote the manuscript, with input from all the authors.</p>
  </ack>
  <fn-group>
    <fn fn-type="supplementary-material">
      <p>[Supplemental material is available for this article.]</p>
    </fn>
    <fn>
      <p>Article published online before print. Article, supplemental material, and publication date are at <ext-link xlink:href="https://www.genome.org/cgi/doi/10.1101/gr.277891.123" ext-link-type="uri">https://www.genome.org/cgi/doi/10.1101/gr.277891.123</ext-link>.</p>
    </fn>
    <fn>
      <p>Freely available online through the <italic>Genome Research</italic> Open Access option.</p>
    </fn>
  </fn-group>
  <sec id="s5">
    <title>Competing interest statement</title>
    <p>The authors declare no competing interests.</p>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="GR277891LIC1">
      <mixed-citation publication-type="journal"><string-name><surname>Abdelaal</surname><given-names>T</given-names></string-name>, <string-name><surname>Michielsen</surname><given-names>L</given-names></string-name>, <string-name><surname>Cats</surname><given-names>D</given-names></string-name>, <string-name><surname>Hoogduin</surname><given-names>D</given-names></string-name>, <string-name><surname>Mei</surname><given-names>H</given-names></string-name>, <string-name><surname>Reinders</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Mahfouz</surname><given-names>A</given-names></string-name>. <year>2019</year>. <article-title>A comparison of automatic cell identification methods for single-cell RNA sequencing data</article-title>. <source>Genome Biol</source><volume>20</volume>: <fpage>194</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-019-1795-z</pub-id><pub-id pub-id-type="pmid">31500660</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC2">
      <mixed-citation publication-type="journal"><string-name><surname>Agirman</surname><given-names>G</given-names></string-name>, <string-name><surname>Broix</surname><given-names>L</given-names></string-name>, <string-name><surname>Nguyen</surname><given-names>L</given-names></string-name>. <year>2017</year>. <article-title>Cerebral cortex development: An outside-in perspective</article-title>. <source>FEBS Lett</source><volume>591</volume>: <fpage>3978</fpage>–<lpage>3992</lpage>. <pub-id pub-id-type="doi">10.1002/1873-3468.12924</pub-id><pub-id pub-id-type="pmid">29194577</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC3">
      <mixed-citation publication-type="journal"><string-name><surname>Armingol</surname><given-names>E</given-names></string-name>, <string-name><surname>Officer</surname><given-names>A</given-names></string-name>, <string-name><surname>Harismendy</surname><given-names>O</given-names></string-name>, <string-name><surname>Lewis</surname><given-names>NE</given-names></string-name>. <year>2021</year>. <article-title>Deciphering cell–cell interactions and communication from gene expression</article-title>. <source>Nat Rev Genet</source><volume>22</volume>: <fpage>71</fpage>–<lpage>88</lpage>. <pub-id pub-id-type="doi">10.1038/s41576-020-00292-x</pub-id><pub-id pub-id-type="pmid">33168968</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC4">
      <mixed-citation publication-type="journal"><string-name><surname>Asp</surname><given-names>M</given-names></string-name>, <string-name><surname>Bergenstråhle</surname><given-names>J</given-names></string-name>, <string-name><surname>Lundeberg</surname><given-names>J</given-names></string-name>. <year>2020</year>. <article-title>Spatially resolved transcriptomes—next generation tools for tissue exploration</article-title>. <source>Bioessays</source><volume>42</volume>: <fpage>1900221</fpage>. <pub-id pub-id-type="doi">10.1002/bies.201900221</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC5">
      <mixed-citation publication-type="confproc"><string-name><surname>Bai</surname><given-names>J</given-names></string-name>, <string-name><surname>Ren</surname><given-names>Y</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>Ripple walk training: a subgraph-based training framework for large and deep graph neural network</article-title>. In <conf-name>International Joint Conference on Neural Networks</conf-name>. <comment>IEEE, Shenzhen</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC6">
      <mixed-citation publication-type="journal"><string-name><surname>Bitar</surname><given-names>M</given-names></string-name>, <string-name><surname>Weissleder</surname><given-names>C</given-names></string-name>, <string-name><surname>North</surname><given-names>HF</given-names></string-name>, <string-name><surname>Clearwater</surname><given-names>MS</given-names></string-name>, <string-name><surname>Zalucki</surname><given-names>O</given-names></string-name>, <string-name><surname>Halliday</surname><given-names>GM</given-names></string-name>, <string-name><surname>Webster</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Piper</surname><given-names>M</given-names></string-name>, <string-name><surname>Weickert</surname><given-names>CS</given-names></string-name>, <string-name><surname>Barry</surname><given-names>G</given-names></string-name>. <year>2022</year>. <article-title>Identifying gene expression profiles associated with neurogenesis and inflammation in the human subependymal zone from development through aging</article-title>. <source>Sci Rep</source><volume>12</volume>: <fpage>40</fpage>. <pub-id pub-id-type="doi">10.1038/s41598-021-03976-4</pub-id><pub-id pub-id-type="pmid">34997023</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC7">
      <mixed-citation publication-type="confproc"><string-name><surname>Blundell</surname><given-names>C</given-names></string-name>, <string-name><surname>Cornebise</surname><given-names>J</given-names></string-name>, <string-name><surname>Kavukcuoglu</surname><given-names>K</given-names></string-name>, <string-name><surname>Wierstra</surname><given-names>D</given-names></string-name>. <year>2015</year>. <article-title>Weight</article-title><article-title>uncertainty in neural network</article-title>. In <conf-name>International Conference on Machine Learning</conf-name>. <comment>PMLR, Lille</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC8">
      <mixed-citation publication-type="journal"><string-name><surname>Chang</surname><given-names>Y-T</given-names></string-name>, <string-name><surname>Tsai</surname><given-names>W-C</given-names></string-name>, <string-name><surname>Lin</surname><given-names>W-Z</given-names></string-name>, <string-name><surname>Wu</surname><given-names>C-C</given-names></string-name>, <string-name><surname>Yu</surname><given-names>J-C</given-names></string-name>, <string-name><surname>Tseng</surname><given-names>VS</given-names></string-name>, <string-name><surname>Liao</surname><given-names>G-S</given-names></string-name>, <string-name><surname>Hu</surname><given-names>J-M</given-names></string-name>, <string-name><surname>Hsu</surname><given-names>H-M</given-names></string-name>, <string-name><surname>Chang</surname><given-names>Y-J</given-names></string-name>. <year>2021</year>. <article-title>A novel IGLC2 gene linked with prognosis of triple-negative breast cancer</article-title>. <source>Front Oncol</source><volume>11</volume>: <fpage>759952</fpage>. <pub-id pub-id-type="doi">10.3389/fonc.2021.759952</pub-id><pub-id pub-id-type="pmid">35155184</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC9">
      <mixed-citation publication-type="journal"><string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Yan</surname><given-names>G</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>W</given-names></string-name>, <string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>R</given-names></string-name>, <string-name><surname>Lin</surname><given-names>Z</given-names></string-name>. <year>2021</year>. <article-title>RA3 is a reference-guided approach for epigenetic characterization of single cells</article-title>. <source>Nat Commun</source><volume>12</volume>: <fpage>2177</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-021-22495-4</pub-id><pub-id pub-id-type="pmid">33846355</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC10">
      <mixed-citation publication-type="journal"><string-name><surname>Chen</surname><given-names>A</given-names></string-name>, <string-name><surname>Liao</surname><given-names>S</given-names></string-name>, <string-name><surname>Cheng</surname><given-names>M</given-names></string-name>, <string-name><surname>Ma</surname><given-names>K</given-names></string-name>, <string-name><surname>Wu</surname><given-names>L</given-names></string-name>, <string-name><surname>Lai</surname><given-names>Y</given-names></string-name>, <string-name><surname>Qiu</surname><given-names>X</given-names></string-name>, <string-name><surname>Yang</surname><given-names>J</given-names></string-name>, <string-name><surname>Xu</surname><given-names>J</given-names></string-name>, <string-name><surname>Hao</surname><given-names>S</given-names></string-name>, <etal/><year>2022a</year>. <article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>. <source>Cell</source><volume>185</volume>: <fpage>1777</fpage>–<lpage>1792.e21</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2022.04.003</pub-id><pub-id pub-id-type="pmid">35512705</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC11">
      <mixed-citation publication-type="journal"><string-name><surname>Chen</surname><given-names>X</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Song</surname><given-names>S</given-names></string-name>, <string-name><surname>Gao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Hou</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>X</given-names></string-name>, <string-name><surname>Lv</surname><given-names>H</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>R</given-names></string-name>. <year>2022b</year>. <article-title>Cell type annotation of single-cell chromatin accessibility data via supervised Bayesian embedding</article-title>. <source>Nat Mach Intell</source><volume>4</volume>: <fpage>116</fpage>–<lpage>126</lpage>. <pub-id pub-id-type="doi">10.1038/s42256-021-00432-w</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC12">
      <mixed-citation publication-type="journal"><string-name><surname>Cheng</surname><given-names>A</given-names></string-name>, <string-name><surname>Hu</surname><given-names>G</given-names></string-name>, <string-name><surname>Li</surname><given-names>WV</given-names></string-name>. <year>2022</year>. <article-title>Benchmarking cell-type clustering methods for spatially resolved transcriptomics data</article-title>. <source>Brief Bioinform</source><volume>24</volume>: <fpage>bbac475</fpage>. <pub-id pub-id-type="doi">10.1093/bib/bbac475</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC13">
      <mixed-citation publication-type="journal"><string-name><surname>Codeluppi</surname><given-names>S</given-names></string-name>, <string-name><surname>Borm</surname><given-names>LE</given-names></string-name>, <string-name><surname>Zeisel</surname><given-names>A</given-names></string-name>, <string-name><surname>La Manno</surname><given-names>G</given-names></string-name>, <string-name><surname>van Lunteren</surname><given-names>JA</given-names></string-name>, <string-name><surname>Svensson</surname><given-names>CI</given-names></string-name>, <string-name><surname>Linnarsson</surname><given-names>S</given-names></string-name>. <year>2018</year>. <article-title>Spatial organization of the somatosensory cortex revealed by osmFISH</article-title>. <source>Nat Methods</source><volume>15</volume>: <fpage>932</fpage>–<lpage>935</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-018-0175-z</pub-id><pub-id pub-id-type="pmid">30377364</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC14">
      <mixed-citation publication-type="journal"><string-name><surname>Crosetto</surname><given-names>N</given-names></string-name>, <string-name><surname>Bienko</surname><given-names>M</given-names></string-name>, <string-name><surname>Van Oudenaarden</surname><given-names>A</given-names></string-name>. <year>2015</year>. <article-title>Spatially resolved transcriptomics and beyond</article-title>. <source>Nat Rev Genet</source><volume>16</volume>: <fpage>57</fpage>–<lpage>66</lpage>. <pub-id pub-id-type="doi">10.1038/nrg3832</pub-id><pub-id pub-id-type="pmid">25446315</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC15">
      <mixed-citation publication-type="journal"><string-name><surname>Deng</surname><given-names>Y</given-names></string-name>, <string-name><surname>Bartosovic</surname><given-names>M</given-names></string-name>, <string-name><surname>Ma</surname><given-names>S</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>D</given-names></string-name>, <string-name><surname>Kukanja</surname><given-names>P</given-names></string-name>, <string-name><surname>Xiao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Su</surname><given-names>G</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Qin</surname><given-names>X</given-names></string-name>, <string-name><surname>Rosoklija</surname><given-names>GB</given-names></string-name>, <etal/><year>2022</year>. <article-title>Spatial profiling of chromatin accessibility in mouse and human tissues</article-title>. <source>Nature</source><volume>609</volume>: <fpage>375</fpage>–<lpage>383</lpage>. <pub-id pub-id-type="doi">10.1038/s41586-022-05094-1</pub-id><pub-id pub-id-type="pmid">35978191</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC16">
      <mixed-citation publication-type="journal"><string-name><surname>Dong</surname><given-names>K</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>S</given-names></string-name>. <year>2022</year>. <article-title>Deciphering spatial domains from spatially resolved transcriptomics with an adaptive graph attention autoencoder</article-title>. <source>Nat Commun</source><volume>13</volume>: <fpage>1739</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-022-29439-6</pub-id><pub-id pub-id-type="pmid">35365632</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC17">
      <mixed-citation publication-type="journal"><string-name><surname>Dries</surname><given-names>R</given-names></string-name>, <string-name><surname>Chen</surname><given-names>J</given-names></string-name>, <string-name><surname>Del Rossi</surname><given-names>N</given-names></string-name>, <string-name><surname>Khan</surname><given-names>MM</given-names></string-name>, <string-name><surname>Sistig</surname><given-names>A</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>G-C</given-names></string-name>. <year>2021</year>. <article-title>Advances in spatial transcriptomic data analysis</article-title>. <source>Genome Res</source><volume>31</volume>: <fpage>1706</fpage>–<lpage>1718</lpage>. <pub-id pub-id-type="doi">10.1101/gr.275224.121</pub-id><pub-id pub-id-type="pmid">34599004</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC18">
      <mixed-citation publication-type="journal"><string-name><surname>Fan</surname><given-names>Z</given-names></string-name>, <string-name><surname>Chen</surname><given-names>R</given-names></string-name>, <string-name><surname>Chen</surname><given-names>X</given-names></string-name>. <year>2020</year>. <article-title>SpatialDB: a database for spatially resolved transcriptomes</article-title>. <source>Nucleic Acids Res</source><volume>48</volume>: <fpage>D233</fpage>–<lpage>D237</lpage>. <pub-id pub-id-type="doi">10.1093/nar/gkz934</pub-id><pub-id pub-id-type="pmid">31713629</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC19">
      <mixed-citation publication-type="journal"><string-name><surname>Friess</surname><given-names>C</given-names></string-name>, <string-name><surname>Gotz</surname><given-names>M</given-names></string-name>, <string-name><surname>Kjell</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>Cryo-section dissection of the adult subependymal zone for accurate and deep quantitative proteome analysis</article-title>. <source>J Vis Exp</source><comment><bold>176:</bold> e63047</comment>. <pub-id pub-id-type="doi">10.3791/63047</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC20">
      <mixed-citation publication-type="other"><string-name><surname>Fu</surname><given-names>H</given-names></string-name>, <string-name><surname>Xu</surname><given-names>H</given-names></string-name>, <string-name><surname>Chong</surname><given-names>K</given-names></string-name>, <string-name><surname>Li</surname><given-names>M</given-names></string-name>, <string-name><surname>Ang</surname><given-names>KS</given-names></string-name>, <string-name><surname>Lee</surname><given-names>HK</given-names></string-name>, <string-name><surname>Ling</surname><given-names>J</given-names></string-name>, <string-name><surname>Chen</surname><given-names>A</given-names></string-name>, <string-name><surname>Shao</surname><given-names>L</given-names></string-name>, <string-name><surname>Liu</surname><given-names>L</given-names></string-name>. <year>2021</year>. <article-title>Unsupervised spatially embedded deep representation of spatial transcriptomics</article-title>. <source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2021.06.15.448542</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC21">
      <mixed-citation publication-type="other"><string-name><surname>Gao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Chen</surname><given-names>X</given-names></string-name>, <string-name><surname>Li</surname><given-names>Z</given-names></string-name>, <string-name><surname>Cui</surname><given-names>X</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>Q</given-names></string-name>, <string-name><surname>Li</surname><given-names>K</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Jiang</surname><given-names>R</given-names></string-name>. <year>2023</year>. <article-title>scEpiTools: a database to comprehensively interrogate analytic tools for single-cell epigenomic data</article-title>. <source>J Genet Genomics</source><pub-id pub-id-type="doi">10.1016/j.jgg.2023.09.011</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC22">
      <mixed-citation publication-type="journal"><string-name><surname>Gilmore</surname><given-names>EC</given-names></string-name>, <string-name><surname>Herrup</surname><given-names>K</given-names></string-name>. <year>1997</year>. <article-title>Cortical development: Layers of complexity</article-title>. <source>Curr Biol</source><volume>7</volume>: <fpage>R231</fpage>–<lpage>R234</lpage>. <pub-id pub-id-type="doi">10.1016/S0960-9822(06)00108-4</pub-id><pub-id pub-id-type="pmid">9162498</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC23">
      <mixed-citation publication-type="confproc"><string-name><surname>Hadsell</surname><given-names>R</given-names></string-name>, <string-name><surname>Chopra</surname><given-names>S</given-names></string-name>, <string-name><surname>LeCun</surname><given-names>Y</given-names></string-name>. <year>2006</year>. <article-title>Dimensionality reduction by learning an invariant mapping</article-title>. In <conf-name>IEEE Computer Society Conference on Computer Vision and Pattern Recognition</conf-name>. <publisher-name>IEEE</publisher-name>, <publisher-loc>New York</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC24">
      <mixed-citation publication-type="journal"><string-name><surname>Haghverdi</surname><given-names>L</given-names></string-name>, <string-name><surname>Büttner</surname><given-names>M</given-names></string-name>, <string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Buettner</surname><given-names>F</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2016</year>. <article-title>Diffusion pseudotime robustly reconstructs lineage branching</article-title>. <source>Nat Methods</source><volume>13</volume>: <fpage>845</fpage>–<lpage>848</lpage>. <pub-id pub-id-type="doi">10.1038/nmeth.3971</pub-id><pub-id pub-id-type="pmid">27571553</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC25">
      <mixed-citation publication-type="journal"><string-name><surname>Hao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Hao</surname><given-names>S</given-names></string-name>, <string-name><surname>Andersen-Nissen</surname><given-names>E</given-names></string-name>, <string-name><surname>Mauck</surname><given-names>WM</given-names><suffix>III</suffix></string-name>, <string-name><surname>Zheng</surname><given-names>S</given-names></string-name>, <string-name><surname>Butler</surname><given-names>A</given-names></string-name>, <string-name><surname>Lee</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Wilk</surname><given-names>AJ</given-names></string-name>, <string-name><surname>Darby</surname><given-names>C</given-names></string-name>, <string-name><surname>Zager</surname><given-names>M</given-names></string-name>, <etal/><year>2021</year>. <article-title>Integrated analysis of multimodal single-cell data</article-title>. <source>Cell</source><volume>184</volume>: <fpage>3573</fpage>–<lpage>3587.e29</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id><pub-id pub-id-type="pmid">34062119</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC26">
      <mixed-citation publication-type="journal"><string-name><surname>Haque</surname><given-names>A</given-names></string-name>, <string-name><surname>Engel</surname><given-names>J</given-names></string-name>, <string-name><surname>Teichmann</surname><given-names>SA</given-names></string-name>, <string-name><surname>Lönnberg</surname><given-names>T</given-names></string-name>. <year>2017</year>. <article-title>A practical guide to single-cell RNA-sequencing for biomedical research and clinical applications</article-title>. <source>Genome Med</source><volume>9</volume>: <fpage>75</fpage>. <pub-id pub-id-type="doi">10.1186/s13073-017-0467-4</pub-id><pub-id pub-id-type="pmid">28821273</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC27">
      <mixed-citation publication-type="journal"><string-name><surname>Hu</surname><given-names>J</given-names></string-name>, <string-name><surname>Li</surname><given-names>X</given-names></string-name>, <string-name><surname>Coleman</surname><given-names>K</given-names></string-name>, <string-name><surname>Schroeder</surname><given-names>A</given-names></string-name>, <string-name><surname>Ma</surname><given-names>N</given-names></string-name>, <string-name><surname>Irwin</surname><given-names>DJ</given-names></string-name>, <string-name><surname>Lee</surname><given-names>EB</given-names></string-name>, <string-name><surname>Shinohara</surname><given-names>RT</given-names></string-name>, <string-name><surname>Li</surname><given-names>M</given-names></string-name>. <year>2021a</year>. <article-title>SpaGCN: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title>. <source>Nat Methods</source><volume>18</volume>: <fpage>1342</fpage>–<lpage>1351</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-021-01255-8</pub-id><pub-id pub-id-type="pmid">34711970</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC28">
      <mixed-citation publication-type="journal"><string-name><surname>Hu</surname><given-names>J</given-names></string-name>, <string-name><surname>Schroeder</surname><given-names>A</given-names></string-name>, <string-name><surname>Coleman</surname><given-names>K</given-names></string-name>, <string-name><surname>Chen</surname><given-names>C</given-names></string-name>, <string-name><surname>Auerbach</surname><given-names>BJ</given-names></string-name>, <string-name><surname>Li</surname><given-names>M</given-names></string-name>. <year>2021b</year>. <article-title>Statistical and machine learning methods for spatially resolved transcriptomics with histology</article-title>. <source>Comput Struct Biotechnol J</source><volume>19</volume>: <fpage>3829</fpage>–<lpage>3841</lpage>. <pub-id pub-id-type="doi">10.1016/j.csbj.2021.06.052</pub-id><pub-id pub-id-type="pmid">34285782</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC29">
      <mixed-citation publication-type="journal"><string-name><surname>Jiang</surname><given-names>R</given-names></string-name>, <string-name><surname>Li</surname><given-names>Z</given-names></string-name>, <string-name><surname>Jia</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>S</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>. <year>2023</year>. <article-title>SINFONIA: Scalable identification of spatially variable genes for deciphering spatial domains</article-title>. <source>Cells</source><volume>12</volume>: <fpage>604</fpage>. <pub-id pub-id-type="doi">10.3390/cells12040604</pub-id><pub-id pub-id-type="pmid">36831270</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC30">
      <mixed-citation publication-type="journal"><string-name><surname>Kazanis</surname><given-names>I</given-names></string-name>. <year>2009</year>. <article-title>The subependymal zone neurogenic niche: a beating heart in the centre of the brain: How plastic is adult neurogenesis? Opportunities for therapy and questions to be addressed</article-title>. <source>Brain</source><volume>132</volume>: <fpage>2909</fpage>–<lpage>2921</lpage>. <pub-id pub-id-type="doi">10.1093/brain/awp237</pub-id><pub-id pub-id-type="pmid">19773354</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC31">
      <mixed-citation publication-type="book"><string-name><surname>Kingma</surname><given-names>DP</given-names></string-name>, <string-name><surname>Welling</surname><given-names>M</given-names></string-name>. <year>2014</year>. <article-title>Auto-encoding variational Bayes</article-title>. In <source>International Conference on Learning Representations</source>, <publisher-name>ICLR</publisher-name>, <publisher-loc>Banff, Canada</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC32">
      <mixed-citation publication-type="journal"><string-name><surname>Lareau</surname><given-names>CA</given-names></string-name>, <string-name><surname>Duarte</surname><given-names>FM</given-names></string-name>, <string-name><surname>Chew</surname><given-names>JG</given-names></string-name>, <string-name><surname>Kartha</surname><given-names>VK</given-names></string-name>, <string-name><surname>Burkett</surname><given-names>ZD</given-names></string-name>, <string-name><surname>Kohlway</surname><given-names>AS</given-names></string-name>, <string-name><surname>Pokholok</surname><given-names>D</given-names></string-name>, <string-name><surname>Aryee</surname><given-names>MJ</given-names></string-name>, <string-name><surname>Steemers</surname><given-names>FJ</given-names></string-name>, <string-name><surname>Lebofsky</surname><given-names>R</given-names></string-name>, <etal/><year>2019</year>. <article-title>Droplet-based combinatorial indexing for massive-scale single-cell chromatin accessibility</article-title>. <source>Nat Biotechnol</source><volume>37</volume>: <fpage>916</fpage>–<lpage>924</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-019-0147-6</pub-id><pub-id pub-id-type="pmid">31235917</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC33">
      <mixed-citation publication-type="journal"><string-name><surname>Larsson</surname><given-names>L</given-names></string-name>, <string-name><surname>Frisén</surname><given-names>J</given-names></string-name>, <string-name><surname>Lundeberg</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>Spatially resolved transcriptomics adds a new dimension to genomics</article-title>. <source>Nat Methods</source><volume>18</volume>: <fpage>15</fpage>–<lpage>18</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-020-01038-7</pub-id><pub-id pub-id-type="pmid">33408402</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC34">
      <mixed-citation publication-type="journal"><string-name><surname>Li</surname><given-names>H</given-names></string-name>, <string-name><surname>Courtois</surname><given-names>ET</given-names></string-name>, <string-name><surname>Sengupta</surname><given-names>D</given-names></string-name>, <string-name><surname>Tan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Chen</surname><given-names>KH</given-names></string-name>, <string-name><surname>Goh</surname><given-names>JJL</given-names></string-name>, <string-name><surname>Kong</surname><given-names>SL</given-names></string-name>, <string-name><surname>Chua</surname><given-names>C</given-names></string-name>, <string-name><surname>Hon</surname><given-names>LK</given-names></string-name>, <string-name><surname>Tan</surname><given-names>WS</given-names></string-name>, <etal/><year>2017</year>. <article-title>Reference component analysis of single-cell transcriptomes elucidates cellular heterogeneity in human colorectal tumors</article-title>. <source>Nat Genet</source><volume>49</volume>: <fpage>708</fpage>–<lpage>718</lpage>. <pub-id pub-id-type="doi">10.1038/ng.3818</pub-id><pub-id pub-id-type="pmid">28319088</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC35">
      <mixed-citation publication-type="journal"><string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Chen</surname><given-names>S</given-names></string-name>, <string-name><surname>Pan</surname><given-names>X</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>Y</given-names></string-name>, <string-name><surname>Shen</surname><given-names>H-B</given-names></string-name>. <year>2022</year>. <article-title>Cell clustering for spatial transcriptomics data with graph neural networks</article-title>. <source>Nat Comput Sci</source><volume>2</volume>: <fpage>399</fpage>–<lpage>408</lpage>. <pub-id pub-id-type="doi">10.1038/s43588-022-00266-5</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC36">
      <mixed-citation publication-type="book"><string-name><surname>Liu</surname><given-names>A</given-names></string-name>, <string-name><surname>Xu</surname><given-names>N</given-names></string-name>, <string-name><surname>Liu</surname><given-names>H</given-names></string-name>. <year>2021</year>. <article-title>Self-attention graph residual convolutional networks for event detection with dependency relations</article-title>. In <source>Findings of the Association for Computational Linguistics</source>. <publisher-name>Association for Computational Linguistics</publisher-name>, <publisher-loc>Punta Cana, Dominican Republic</publisher-loc>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC37">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>C</given-names></string-name>, <string-name><surname>Li</surname><given-names>R</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>, <string-name><surname>Lin</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>K</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Q</given-names></string-name>, <string-name><surname>Wang</surname><given-names>S</given-names></string-name>, <string-name><surname>Yang</surname><given-names>X</given-names></string-name>, <string-name><surname>Shi</surname><given-names>X</given-names></string-name>, <string-name><surname>Ma</surname><given-names>Y</given-names></string-name>, <etal/><year>2022a</year>. <article-title>Spatiotemporal mapping of gene expression landscapes and developmental trajectories during zebrafish embryogenesis</article-title>. <source>Dev Cell</source><volume>57</volume>: <fpage>1284</fpage>–<lpage>1298.e5</lpage>. <pub-id pub-id-type="doi">10.1016/j.devcel.2022.04.009</pub-id><pub-id pub-id-type="pmid">35512701</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC38">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>W</given-names></string-name>, <string-name><surname>Liao</surname><given-names>X</given-names></string-name>, <string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Lin</surname><given-names>H</given-names></string-name>, <string-name><surname>Yeong</surname><given-names>J</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>X</given-names></string-name>, <string-name><surname>Shi</surname><given-names>X</given-names></string-name>, <string-name><surname>Liu</surname><given-names>J</given-names></string-name>. <year>2022b</year>. <article-title>Joint dimension reduction and clustering analysis of single-cell RNA-seq and spatial transcriptomics data</article-title>. <source>Nucleic Acids Res</source><volume>50</volume>: <fpage>e72</fpage>. <pub-id pub-id-type="doi">10.1093/nar/gkac219</pub-id><pub-id pub-id-type="pmid">35349708</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC39">
      <mixed-citation publication-type="journal"><string-name><surname>Liu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Sun</surname><given-names>D</given-names></string-name>, <string-name><surname>Wang</surname><given-names>C</given-names></string-name>. <year>2022c</year>. <article-title>Evaluation of cell-cell interaction methods by integrating single-cell RNA sequencing data with spatial information</article-title>. <source>Genome Biol</source><volume>23</volume>: <fpage>218</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-021-02568-9</pub-id><pub-id pub-id-type="pmid">36253792</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC40">
      <mixed-citation publication-type="journal"><string-name><surname>Maynard</surname><given-names>KR</given-names></string-name>, <string-name><surname>Collado-Torres</surname><given-names>L</given-names></string-name>, <string-name><surname>Weber</surname><given-names>LM</given-names></string-name>, <string-name><surname>Uytingco</surname><given-names>C</given-names></string-name>, <string-name><surname>Barry</surname><given-names>BK</given-names></string-name>, <string-name><surname>Williams</surname><given-names>SR</given-names></string-name>, <string-name><surname>Catallini</surname><given-names>JL</given-names></string-name>, <string-name><surname>Tran</surname><given-names>MN</given-names></string-name>, <string-name><surname>Besich</surname><given-names>Z</given-names></string-name>, <string-name><surname>Tippani</surname><given-names>M</given-names></string-name>, <etal/><year>2021</year>. <article-title>Transcriptome-scale spatial gene expression in the human dorsolateral prefrontal cortex</article-title>. <source>Nat Neurosci</source><volume>24</volume>: <fpage>425</fpage>–<lpage>436</lpage>. <pub-id pub-id-type="doi">10.1038/s41593-020-00787-0</pub-id><pub-id pub-id-type="pmid">33558695</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC41">
      <mixed-citation publication-type="journal"><string-name><surname>Menn</surname><given-names>B</given-names></string-name>, <string-name><surname>Garcia-Verdugo</surname><given-names>JM</given-names></string-name>, <string-name><surname>Yaschine</surname><given-names>C</given-names></string-name>, <string-name><surname>Gonzalez-Perez</surname><given-names>O</given-names></string-name>, <string-name><surname>Rowitch</surname><given-names>D</given-names></string-name>, <string-name><surname>Alvarez-Buylla</surname><given-names>A</given-names></string-name>. <year>2006</year>. <article-title>Origin of oligodendrocytes in the subventricular zone of the adult brain</article-title>. <source>J Neurosci</source><volume>26</volume>: <fpage>7907</fpage>–<lpage>7918</lpage>. <pub-id pub-id-type="doi">10.1523/JNEUROSCI.1299-06.2006</pub-id><pub-id pub-id-type="pmid">16870736</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC42">
      <mixed-citation publication-type="journal"><string-name><surname>Moses</surname><given-names>L</given-names></string-name>, <string-name><surname>Pachter</surname><given-names>L</given-names></string-name>. <year>2022</year>. <article-title>Museum of spatial transcriptomics</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>534</fpage>–<lpage>546</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-022-01409-2</pub-id><pub-id pub-id-type="pmid">35273392</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC43">
      <mixed-citation publication-type="journal"><string-name><surname>Oxelius</surname><given-names>V-A</given-names></string-name>, <string-name><surname>Pandey</surname><given-names>JP</given-names></string-name>. <year>2013</year>. <article-title>Human immunoglobulin constant heavy G chain (IGHG) (Fcγ) (GM) genes, defining innate variants of IgG molecules and B cells, have impact on disease and therapy</article-title>. <source>Clin Immunol</source><volume>149</volume>: <fpage>475</fpage>–<lpage>486</lpage>. <pub-id pub-id-type="doi">10.1016/j.clim.2013.10.003</pub-id><pub-id pub-id-type="pmid">24239836</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC44">
      <mixed-citation publication-type="journal"><string-name><surname>Palla</surname><given-names>G</given-names></string-name>, <string-name><surname>Spitzer</surname><given-names>H</given-names></string-name>, <string-name><surname>Klein</surname><given-names>M</given-names></string-name>, <string-name><surname>Fischer</surname><given-names>D</given-names></string-name>, <string-name><surname>Schaar</surname><given-names>AC</given-names></string-name>, <string-name><surname>Kuemmerle</surname><given-names>LB</given-names></string-name>, <string-name><surname>Rybakov</surname><given-names>S</given-names></string-name>, <string-name><surname>Ibarra</surname><given-names>IL</given-names></string-name>, <string-name><surname>Holmberg</surname><given-names>O</given-names></string-name>, <string-name><surname>Virshup</surname><given-names>I</given-names></string-name>, <etal/><year>2022</year>. <article-title>Squidpy: a scalable framework for spatial omics analysis</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>171</fpage>–<lpage>178</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-021-01358-2</pub-id><pub-id pub-id-type="pmid">35102346</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC45">
      <mixed-citation publication-type="journal"><string-name><surname>Qiu</surname><given-names>P</given-names></string-name>. <year>2020</year>. <article-title>Embracing the dropouts in single-cell RNA-seq analysis</article-title>. <source>Nat Commun</source><volume>11</volume>: <fpage>1169</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-020-14976-9</pub-id><pub-id pub-id-type="pmid">32127540</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC46">
      <mixed-citation publication-type="journal"><string-name><surname>Raffel</surname><given-names>C</given-names></string-name>, <string-name><surname>Shazeer</surname><given-names>N</given-names></string-name>, <string-name><surname>Roberts</surname><given-names>A</given-names></string-name>, <string-name><surname>Lee</surname><given-names>K</given-names></string-name>, <string-name><surname>Narang</surname><given-names>S</given-names></string-name>, <string-name><surname>Matena</surname><given-names>M</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>W</given-names></string-name>, <string-name><surname>Liu</surname><given-names>PJ</given-names></string-name>. <year>2020</year>. <article-title>Exploring the limits of transfer learning with a unified text-to-text transformer</article-title>. <source>J Mach Learn Res</source><volume>21</volume>: <fpage>1</fpage>–<lpage>67</lpage>.<pub-id pub-id-type="pmid">34305477</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC47">
      <mixed-citation publication-type="journal"><string-name><surname>Rodriques</surname><given-names>SG</given-names></string-name>, <string-name><surname>Stickels</surname><given-names>RR</given-names></string-name>, <string-name><surname>Goeva</surname><given-names>A</given-names></string-name>, <string-name><surname>Martin</surname><given-names>CA</given-names></string-name>, <string-name><surname>Murray</surname><given-names>E</given-names></string-name>, <string-name><surname>Vanderburg</surname><given-names>CR</given-names></string-name>, <string-name><surname>Welch</surname><given-names>J</given-names></string-name>, <string-name><surname>Chen</surname><given-names>LM</given-names></string-name>, <string-name><surname>Chen</surname><given-names>F</given-names></string-name>, <string-name><surname>Macosko</surname><given-names>EZ</given-names></string-name>. <year>2019</year>. <article-title>Slide-seq: a scalable technology for measuring genome-wide expression at high spatial resolution</article-title>. <source>Science</source><volume>363</volume>: <fpage>1463</fpage>–<lpage>1467</lpage>. <pub-id pub-id-type="doi">10.1126/science.aaw1219</pub-id><pub-id pub-id-type="pmid">30923225</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC48">
      <mixed-citation publication-type="journal"><string-name><surname>Schmidt</surname><given-names>M</given-names></string-name>, <string-name><surname>Micke</surname><given-names>P</given-names></string-name>, <string-name><surname>Gehrmann</surname><given-names>M</given-names></string-name>, <string-name><surname>Hengstler</surname><given-names>JG</given-names></string-name>. <year>2012</year>. <article-title>Immunoglobulin kappa chain as an immunologic biomarker of prognosis and chemotherapy response in solid tumors</article-title>. <source>Oncoimmunology</source><volume>1</volume>: <fpage>1156</fpage>–<lpage>1158</lpage>. <pub-id pub-id-type="doi">10.4161/onci.21653</pub-id><pub-id pub-id-type="pmid">23170262</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC49">
      <mixed-citation publication-type="journal"><string-name><surname>Shang</surname><given-names>L</given-names></string-name>, <string-name><surname>Zhou</surname><given-names>X</given-names></string-name>. <year>2022</year>. <article-title>Spatially aware dimension reduction for spatial transcriptomics</article-title>. <source>Nat Commun</source><volume>13</volume>: <fpage>7203</fpage>. <pub-id pub-id-type="doi">10.1038/s41467-022-34879-1</pub-id><pub-id pub-id-type="pmid">36418351</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC50">
      <mixed-citation publication-type="journal"><string-name><surname>Shengquan</surname><given-names>C</given-names></string-name>, <string-name><surname>Boheng</surname><given-names>Z</given-names></string-name>, <string-name><surname>Xiaoyang</surname><given-names>C</given-names></string-name>, <string-name><surname>Xuegong</surname><given-names>Z</given-names></string-name>, <string-name><surname>Rui</surname><given-names>J</given-names></string-name>. <year>2021</year>. <article-title>stPlus: a reference-based method for the accurate enhancement of spatial transcriptomics</article-title>. <source>Bioinformatics</source><volume>37</volume>: <fpage>i299</fpage>–<lpage>i307</lpage>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btab298</pub-id><pub-id pub-id-type="pmid">34252941</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC51">
      <mixed-citation publication-type="journal"><string-name><surname>Ståhl</surname><given-names>PL</given-names></string-name>, <string-name><surname>Salmén</surname><given-names>F</given-names></string-name>, <string-name><surname>Vickovic</surname><given-names>S</given-names></string-name>, <string-name><surname>Lundmark</surname><given-names>A</given-names></string-name>, <string-name><surname>Navarro</surname><given-names>JF</given-names></string-name>, <string-name><surname>Magnusson</surname><given-names>J</given-names></string-name>, <string-name><surname>Giacomello</surname><given-names>S</given-names></string-name>, <string-name><surname>Asp</surname><given-names>M</given-names></string-name>, <string-name><surname>Westholm</surname><given-names>JO</given-names></string-name>, <string-name><surname>Huss</surname><given-names>M</given-names></string-name>, <etal/><year>2016</year>. <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>. <source>Science</source><volume>353</volume>: <fpage>78</fpage>–<lpage>82</lpage>. <pub-id pub-id-type="doi">10.1126/science.aaf2403</pub-id><pub-id pub-id-type="pmid">27365449</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC52">
      <mixed-citation publication-type="journal"><string-name><surname>Stickels</surname><given-names>RR</given-names></string-name>, <string-name><surname>Murray</surname><given-names>E</given-names></string-name>, <string-name><surname>Kumar</surname><given-names>P</given-names></string-name>, <string-name><surname>Li</surname><given-names>J</given-names></string-name>, <string-name><surname>Marshall</surname><given-names>JL</given-names></string-name>, <string-name><surname>Di Bella</surname><given-names>DJ</given-names></string-name>, <string-name><surname>Arlotta</surname><given-names>P</given-names></string-name>, <string-name><surname>Macosko</surname><given-names>EZ</given-names></string-name>, <string-name><surname>Chen</surname><given-names>F</given-names></string-name>. <year>2021</year>. <article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with slide-seqV2</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>313</fpage>–<lpage>319</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-020-0739-1</pub-id><pub-id pub-id-type="pmid">33288904</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC53">
      <mixed-citation publication-type="journal"><string-name><surname>Tasic</surname><given-names>B</given-names></string-name>, <string-name><surname>Menon</surname><given-names>V</given-names></string-name>, <string-name><surname>Nguyen</surname><given-names>TN</given-names></string-name>, <string-name><surname>Kim</surname><given-names>TK</given-names></string-name>, <string-name><surname>Jarsky</surname><given-names>T</given-names></string-name>, <string-name><surname>Yao</surname><given-names>Z</given-names></string-name>, <string-name><surname>Levi</surname><given-names>B</given-names></string-name>, <string-name><surname>Gray</surname><given-names>LT</given-names></string-name>, <string-name><surname>Sorensen</surname><given-names>SA</given-names></string-name>, <string-name><surname>Dolbeare</surname><given-names>T</given-names></string-name>, <etal/><year>2016</year>. <article-title>Adult mouse cortical cell taxonomy revealed by single cell transcriptomics</article-title>. <source>Nat Neurosci</source><volume>19</volume>: <fpage>335</fpage>–<lpage>346</lpage>. <pub-id pub-id-type="doi">10.1038/nn.4216</pub-id><pub-id pub-id-type="pmid">26727548</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC54">
      <mixed-citation publication-type="journal"><string-name><surname>Townes</surname><given-names>FW</given-names></string-name>, <string-name><surname>Engelhardt</surname><given-names>BE</given-names></string-name>. <year>2023</year>. <article-title>Nonnegative spatial factorization applied to spatial genomics</article-title>. <source>Nat Methods</source><volume>20</volume>: <fpage>229</fpage>–<lpage>238</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-022-01687-w</pub-id><pub-id pub-id-type="pmid">36587187</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC55">
      <mixed-citation publication-type="confproc"><string-name><surname>Vaswani</surname><given-names>A</given-names></string-name>, <string-name><surname>Shazeer</surname><given-names>N</given-names></string-name>, <string-name><surname>Parmar</surname><given-names>N</given-names></string-name>, <string-name><surname>Uszkoreit</surname><given-names>J</given-names></string-name>, <string-name><surname>Jones</surname><given-names>L</given-names></string-name>, <string-name><surname>Gomez</surname><given-names>AN</given-names></string-name>, <string-name><surname>Kaiser</surname><given-names>Ł</given-names></string-name>, <string-name><surname>Polosukhin</surname><given-names>I</given-names></string-name>. <year>2017</year>. <article-title>Attention is all you need</article-title>. In <conf-name>Conference on Neural Information Processing Systems</conf-name>. <comment>Curran Associates, Long Beach, CA</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC56">
      <mixed-citation publication-type="journal"><string-name><surname>Vickovic</surname><given-names>S</given-names></string-name>, <string-name><surname>Eraslan</surname><given-names>G</given-names></string-name>, <string-name><surname>Salmén</surname><given-names>F</given-names></string-name>, <string-name><surname>Klughammer</surname><given-names>J</given-names></string-name>, <string-name><surname>Stenbeck</surname><given-names>L</given-names></string-name>, <string-name><surname>Schapiro</surname><given-names>D</given-names></string-name>, <string-name><surname>Äijö</surname><given-names>T</given-names></string-name>, <string-name><surname>Bonneau</surname><given-names>R</given-names></string-name>, <string-name><surname>Bergenstråhle</surname><given-names>L</given-names></string-name>, <string-name><surname>Navarro</surname><given-names>JF</given-names></string-name>, <etal/><year>2019</year>. <article-title>High-definition spatial transcriptomics for in situ tissue profiling</article-title>. <source>Nat Methods</source><volume>16</volume>: <fpage>987</fpage>–<lpage>990</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-019-0548-y</pub-id><pub-id pub-id-type="pmid">31501547</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC57">
      <mixed-citation publication-type="journal"><string-name><surname>Wang</surname><given-names>X</given-names></string-name>, <string-name><surname>Allen</surname><given-names>WE</given-names></string-name>, <string-name><surname>Wright</surname><given-names>MA</given-names></string-name>, <string-name><surname>Sylwestrak</surname><given-names>EL</given-names></string-name>, <string-name><surname>Samusik</surname><given-names>N</given-names></string-name>, <string-name><surname>Vesuna</surname><given-names>S</given-names></string-name>, <string-name><surname>Evans</surname><given-names>K</given-names></string-name>, <string-name><surname>Liu</surname><given-names>C</given-names></string-name>, <string-name><surname>Ramakrishnan</surname><given-names>C</given-names></string-name>, <string-name><surname>Liu</surname><given-names>J</given-names></string-name>, <etal/><year>2018</year>. <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>. <source>Science</source><volume>361</volume>: <fpage>eaat5691</fpage>. <pub-id pub-id-type="doi">10.1126/science.aat5691</pub-id><pub-id pub-id-type="pmid">29930089</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC58">
      <mixed-citation publication-type="journal"><string-name><surname>Wei</surname><given-names>X</given-names></string-name>, <string-name><surname>Fu</surname><given-names>S</given-names></string-name>, <string-name><surname>Li</surname><given-names>H</given-names></string-name>, <string-name><surname>Liu</surname><given-names>Y</given-names></string-name>, <string-name><surname>Wang</surname><given-names>S</given-names></string-name>, <string-name><surname>Feng</surname><given-names>W</given-names></string-name>, <string-name><surname>Yang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Liu</surname><given-names>X</given-names></string-name>, <string-name><surname>Zeng</surname><given-names>Y-Y</given-names></string-name>, <string-name><surname>Cheng</surname><given-names>M</given-names></string-name>, <etal/><year>2022</year>. <article-title>Single-cell stereo-seq reveals induced progenitor cells involved in axolotl brain regeneration</article-title>. <source>Science</source><volume>377</volume>: <fpage>eabp9444</fpage>. <pub-id pub-id-type="doi">10.1126/science.abp9444</pub-id><pub-id pub-id-type="pmid">36048929</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC59">
      <mixed-citation publication-type="journal"><string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Angerer</surname><given-names>P</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2018</year>. <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>. <source>Genome Biol</source><volume>19</volume>: <fpage>15</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id><pub-id pub-id-type="pmid">29409532</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC60">
      <mixed-citation publication-type="journal"><string-name><surname>Wolf</surname><given-names>FA</given-names></string-name>, <string-name><surname>Hamey</surname><given-names>FK</given-names></string-name>, <string-name><surname>Plass</surname><given-names>M</given-names></string-name>, <string-name><surname>Solana</surname><given-names>J</given-names></string-name>, <string-name><surname>Dahlin</surname><given-names>JS</given-names></string-name>, <string-name><surname>Göttgens</surname><given-names>B</given-names></string-name>, <string-name><surname>Rajewsky</surname><given-names>N</given-names></string-name>, <string-name><surname>Simon</surname><given-names>L</given-names></string-name>, <string-name><surname>Theis</surname><given-names>FJ</given-names></string-name>. <year>2019</year>. <article-title>PAGA: graph abstraction reconciles clustering with trajectory inference through a topology preserving map of single cells</article-title>. <source>Genome Biol</source><volume>20</volume>: <fpage>59</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-019-1663-x</pub-id><pub-id pub-id-type="pmid">30890159</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC61">
      <mixed-citation publication-type="other"><string-name><surname>Xu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Wang</surname><given-names>W</given-names></string-name>, <string-name><surname>Yang</surname><given-names>T</given-names></string-name>, <string-name><surname>Chen</surname><given-names>J</given-names></string-name>, <string-name><surname>Huang</surname><given-names>Y</given-names></string-name>, <string-name><surname>Gould</surname><given-names>J</given-names></string-name>, <string-name><surname>Du</surname><given-names>W</given-names></string-name>, <string-name><surname>Yang</surname><given-names>F</given-names></string-name>, <string-name><surname>Li</surname><given-names>L</given-names></string-name>, <string-name><surname>Lai</surname><given-names>T</given-names></string-name>, <etal/><year>2022</year>. <article-title>STOmicsDB: a database of spatial transcriptomic data</article-title>. <source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2022.03.11.481421</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC62">
      <mixed-citation publication-type="journal"><string-name><surname>Yuan</surname><given-names>Z</given-names></string-name>, <string-name><surname>Pan</surname><given-names>W</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>F</given-names></string-name>, <string-name><surname>Xu</surname><given-names>Z</given-names></string-name>, <string-name><surname>Li</surname><given-names>X</given-names></string-name>, <string-name><surname>Zhao</surname><given-names>Y</given-names></string-name>, <string-name><surname>Zhang</surname><given-names>MQ</given-names></string-name>, <string-name><surname>Yao</surname><given-names>J</given-names></string-name>. <year>2023</year>. <article-title>SODB facilitates comprehensive exploration of spatial omics data</article-title>. <source>Nat Methods</source><volume>20</volume>: <fpage>387</fpage>–<lpage>399</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-023-01773-7</pub-id><pub-id pub-id-type="pmid">36797409</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC63">
      <mixed-citation publication-type="journal"><string-name><surname>Zeira</surname><given-names>R</given-names></string-name>, <string-name><surname>Land</surname><given-names>M</given-names></string-name>, <string-name><surname>Strzalkowski</surname><given-names>A</given-names></string-name>, <string-name><surname>Raphael</surname><given-names>BJ</given-names></string-name>. <year>2022</year>. <article-title>Alignment and integration of spatial transcriptomics data</article-title>. <source>Nat Methods</source><volume>19</volume>: <fpage>567</fpage>–<lpage>575</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-022-01459-6</pub-id><pub-id pub-id-type="pmid">35577957</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC64">
      <mixed-citation publication-type="journal"><string-name><surname>Zeng</surname><given-names>Z</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>, <string-name><surname>Li</surname><given-names>Y</given-names></string-name>, <string-name><surname>Luo</surname><given-names>Y</given-names></string-name>. <year>2022</year>. <article-title>Statistical and machine learning methods for spatially resolved transcriptomics data analysis</article-title>. <source>Genome Biol</source><volume>23</volume>: <fpage>83</fpage>. <pub-id pub-id-type="doi">10.1186/s13059-022-02653-7</pub-id><pub-id pub-id-type="pmid">35337374</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC65">
      <mixed-citation publication-type="other"><string-name><surname>Zhang</surname><given-names>J</given-names></string-name>, <string-name><surname>Meng</surname><given-names>L</given-names></string-name>. <year>2019</year>. <article-title>GResNet: graph residual network for reviving deep GNNs from suspended animation</article-title>. <italic>arXiv</italic>:<comment>1909.05729 [cs.LG]</comment>.</mixed-citation>
    </ref>
    <ref id="GR277891LIC66">
      <mixed-citation publication-type="journal"><string-name><surname>Zhao</surname><given-names>E</given-names></string-name>, <string-name><surname>Stone</surname><given-names>MR</given-names></string-name>, <string-name><surname>Ren</surname><given-names>X</given-names></string-name>, <string-name><surname>Guenthoer</surname><given-names>J</given-names></string-name>, <string-name><surname>Smythe</surname><given-names>KS</given-names></string-name>, <string-name><surname>Pulliam</surname><given-names>T</given-names></string-name>, <string-name><surname>Williams</surname><given-names>SR</given-names></string-name>, <string-name><surname>Uytingco</surname><given-names>CR</given-names></string-name>, <string-name><surname>Taylor</surname><given-names>SE</given-names></string-name>, <string-name><surname>Nghiem</surname><given-names>P</given-names></string-name>, <etal/><year>2021</year>. <article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title>. <source>Nat Biotechnol</source><volume>39</volume>: <fpage>1375</fpage>–<lpage>1384</lpage>. <pub-id pub-id-type="doi">10.1038/s41587-021-00935-2</pub-id><pub-id pub-id-type="pmid">34083791</pub-id></mixed-citation>
    </ref>
    <ref id="GR277891LIC67">
      <mixed-citation publication-type="journal"><string-name><surname>Zhuang</surname><given-names>X</given-names></string-name>. <year>2021</year>. <article-title>Spatially resolved single-cell genomics and transcriptomics by imaging</article-title>. <source>Nat Methods</source><volume>18</volume>: <fpage>18</fpage>–<lpage>22</lpage>. <pub-id pub-id-type="doi">10.1038/s41592-020-01037-8</pub-id><pub-id pub-id-type="pmid">33408406</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
