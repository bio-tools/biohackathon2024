<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9502161</article-id>
    <article-id pub-id-type="pmid">34146085</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btab450</article-id>
    <article-id pub-id-type="publisher-id">btab450</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Gene Expression</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Normalization by distributional resampling of high throughput single-cell RNA-sequencing data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-9151-4386</contrib-id>
        <name>
          <surname>Brown</surname>
          <given-names>Jared</given-names>
        </name>
        <xref rid="btab450-cor1" ref-type="corresp"/>
        <aff><institution>Department of Statistics, University of Wisconsin Madison</institution>, Madison, WI 53706, <country country="US">USA</country></aff>
        <!--brownj@biostat.wisc.edu-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ni</surname>
          <given-names>Zijian</given-names>
        </name>
        <aff><institution>Department of Statistics, University of Wisconsin Madison</institution>, Madison, WI 53706, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Mohanty</surname>
          <given-names>Chitrasen</given-names>
        </name>
        <aff><institution>Department of Biostatistics and Medical Informatics, University of Wisconsin Madison</institution>, Madison, WI 53792, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bacher</surname>
          <given-names>Rhonda</given-names>
        </name>
        <aff><institution>Department of Biostatistics, University of Florida Gainesville</institution>, Gainesville, FL 32603, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Kendziorski</surname>
          <given-names>Christina</given-names>
        </name>
        <xref rid="btab450-cor1" ref-type="corresp"/>
        <aff><institution>Department of Biostatistics and Medical Informatics, University of Wisconsin Madison</institution>, Madison, WI 53792, <country country="US">USA</country></aff>
        <!--kendzior@biostat.wisc.edu-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Mathelier</surname>
          <given-names>Anthony</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btab450-cor1">To whom correspondence should be addressed. <email>brownj@biostat.wisc.edu</email> or <email>kendzior@biostat.wisc.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>15</day>
      <month>11</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2021-06-19">
      <day>19</day>
      <month>6</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>19</day>
      <month>6</month>
      <year>2021</year>
    </pub-date>
    <volume>37</volume>
    <issue>22</issue>
    <fpage>4123</fpage>
    <lpage>4128</lpage>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>10</month>
        <year>2020</year>
      </date>
      <date date-type="rev-recd">
        <day>11</day>
        <month>6</month>
        <year>2021</year>
      </date>
      <date date-type="editorial-decision">
        <day>14</day>
        <month>6</month>
        <year>2021</year>
      </date>
      <date date-type="accepted">
        <day>15</day>
        <month>6</month>
        <year>2021</year>
      </date>
      <date date-type="corrected-typeset">
        <day>03</day>
        <month>7</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2021</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btab450.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Normalization to remove technical or experimental artifacts is critical in the analysis of single-cell RNA-sequencing experiments, even those for which unique molecular identifiers are available. The majority of methods for normalizing single-cell RNA-sequencing data adjust average expression for library size (LS), allowing the variance and other properties of the gene-specific expression distribution to be non-constant in LS. This often results in reduced power and increased false discoveries in downstream analyses, a problem which is exacerbated by the high proportion of zeros present in most datasets.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>To address this, we present Dino, a normalization method based on a flexible negative-binomial mixture model of gene expression. As demonstrated in both simulated and case study datasets, by normalizing the entire gene expression distribution, Dino is robust to shallow sequencing, sample heterogeneity and varying zero proportions, leading to improved performance in downstream analyses in a number of settings.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>The R package, Dino, is available on GitHub at <ext-link xlink:href="https://github.com/JBrownBiostat/Dino" ext-link-type="uri">https://github.com/JBrownBiostat/Dino</ext-link>. The Dino package is further archived and freely available on Zenodo at <ext-link xlink:href="https://doi.org/10.5281/zenodo.4897558" ext-link-type="uri">https://doi.org/10.5281/zenodo.4897558</ext-link>.</p>
      </sec>
      <sec id="s5">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Library of Medicine Bio-Data Science Training program</institution>
          </institution-wrap>
        </funding-source>
        <award-id>T32LM012413</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Institutes of Health</institution>
            <institution-id institution-id-type="DOI">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>NIHGM102756</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="6"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Over the past decade, advances in single-cell RNA-sequencing (scRNA-seq) technologies have significantly increased the sensitivity and specificity with which cellular transcriptional dynamics can be analyzed (<xref rid="btab450-B3" ref-type="bibr">Bacher and Kendziorski, 2016</xref>; <xref rid="btab450-B12" ref-type="bibr">Haque <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btab450-B14" ref-type="bibr">Hwang <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="btab450-B18" ref-type="bibr">Kolodziejczyk <italic toggle="yes">et al.</italic>, 2015</xref>; <xref rid="btab450-B37" ref-type="bibr">Wu <italic toggle="yes">et al.</italic>, 2017</xref>). Further, parallel increases in the number cells which can be simultaneously sequenced have allowed for novel analysis pipelines including the description of transcriptional trajectories (<xref rid="btab450-B29" ref-type="bibr">Qiu <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btab450-B34" ref-type="bibr">Trapnell <italic toggle="yes">et al.</italic>, 2014</xref>) and the discovery of rare sub-populations of cells (<xref rid="btab450-B14" ref-type="bibr">Hwang <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="btab450-B31" ref-type="bibr">Satija <italic toggle="yes">et al.</italic>, 2015</xref>; <xref rid="btab450-B35" ref-type="bibr">Tsoucas and Yuan, 2018</xref>). The development of droplet-based, unique-molecular-identifier (UMI) protocols such as Drop-seq, inDrop and the 10x Genomics Chromium platform (<xref rid="btab450-B17" ref-type="bibr">Klein <italic toggle="yes">et al.</italic>, 2015</xref>; <xref rid="btab450-B25" ref-type="bibr">Macosko <italic toggle="yes">et al.</italic>, 2015</xref>; <xref rid="btab450-B38" ref-type="bibr">Zheng <italic toggle="yes">et al.</italic>, 2017</xref>) have significantly contributed to these advances. In particular, the commercially available 10x Genomics platform has allowed the rapid and cost-effective gene expression profiling of hundreds to tens of thousands of cells across many studies to date.</p>
    <p>The use of UMIs in the 10x Genomics and related platforms has augmented these developments in sequencing technology by tagging individual mRNA transcripts with unique cell and transcript specific identifiers. In this way, biases due to transcript length and PCR amplification have been significantly reduced (<xref rid="btab450-B10" ref-type="bibr">Grün <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btab450-B15" ref-type="bibr">Islam <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btab450-B36" ref-type="bibr">Tung <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btab450-B38" ref-type="bibr">Zheng <italic toggle="yes">et al.</italic>, 2017</xref>). However, technical variability in library size (LS), defined as the sum of sequenced UMIs for a given cell, remains. Consequently, normalization to remove excess variation due to LS is required to ensure accurate downstream analyses(<xref rid="btab450-F1" ref-type="fig">Fig. 1</xref>). As a result, a number of normalization methods have been developed to remove the effects of LS prior to downstream analysis.</p>
    <fig position="float" id="btab450-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Evaluation of gene-specific expression distributions following normalization. Expression data in the PBMC68K_Pure dataset were normalized by Scran, scTransform and Dino. (<bold>a</bold>) and (<bold>b</bold>) Normalized expression is shown here for a homogeneous set of cells (CD4+/CD45RO+ memory cells) to minimize the effects of cell subpopulation heterogeneity. (a) Normalized expression from a typical gene (NME1) under Scran, scTransform and Dino plotted against LS. Fitted regression lines (solid black) show generally constant means across methods. Low-LS (5–25% of LS) and high-LS (75–95% of LS) subsets of cells are indicated by dashed lines and are used in the following panels. (b) Density plots of normalized expression from low-LS and high-LS cells show that the constant mean is maintained by balancing the changing proportions of zeros, or near zeros in the case of scTransform, with expression shifts in normalized non-zeros. (<bold>c</bold>) Quantile-quantile heatmaps compare normalized expression quantiles in the high-LS (x-coordinate) and low-LS cells (y-coordinate) across genes and cell-type annotations (<xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref>.3). As in panel b, there are systematic shifts in the distributions.</p>
      </caption>
      <graphic xlink:href="btab450f1" position="float"/>
    </fig>
    <p>The simplest influence of LS on gene expression, the UMI counts across cells for a given gene, is the (typically) linear increase observed in expression with LS. As such, common methods for normalization are based on global scale factors which scale all reads in a cell uniformly with the goal of removing the effect of LS on average expression. In counts per ten-thousand (CPT), implemented in the popular Seurat pipeline (<xref rid="btab450-B6" ref-type="bibr">Butler <italic toggle="yes">et al.</italic>, 2018</xref>), each transcript within a cell is scaled such that the sum of expression across transcripts within the cell equals ten thousand; counts per million (CPM) is similar, but with the target per-cell sum equal to one million. Another widely used method, Scran (<xref rid="btab450-B22" ref-type="bibr">Lun <italic toggle="yes">et al.</italic>, 2016</xref>), pools counts across groups of cells to calculate scale factors which are more robust to low LS.</p>
    <p><xref rid="btab450-B2" ref-type="bibr">Bacher et al. (2017)</xref> showed that different groups of genes require different scale factors, which compromises the performance of global scale factor-based approaches. To address this, they proposed scNorm which estimates scale factors via quantile regression separately for groups of genes having similar relationships between expression and LS. While useful, their approach was developed for scRNA-seq data obtained via Fluidigm and similar protocols, and does not apply directly to UMI count data. Specifically, in addition to the distributional changes due to the deduplication of UMI data, the authors note (scNorm GitHub page and Bioconductor vignette) that for datasets with more than approximately 80% zeros, components of the model may not converge. Typical UMI datasets can have greater than 90% zeros (<xref rid="btab450-B33" ref-type="bibr">Townes <italic toggle="yes">et al.</italic>, 2019</xref>).</p>
    <p>Hafemeister and Satija recently demonstrated that analysis of UMI data also requires different distributional parameters, if not different scale factors, for different groups of genes. They approach normalization as a parametric regression problem and introduce scTransform (<xref rid="btab450-B11" ref-type="bibr">Hafemeister and Satija, 2019</xref>) which models counts using a negative-binomial generalized linear model (glm). In scTransform, parameter estimates are smoothed across genes such that genes with similar average expression also have similar model parameters. Normalized data is then given by Pearson residuals from the regression and, as a result, the normalized expression of a typical gene has mean zero and unit variance. This approach attenuates the dependence of both the mean and variance on LS.</p>
    <p>However, variation due to LS remains in datasets normalized by these techniques. In particular, there are shifts in the distributions of normalized expression as a function of LS (<xref rid="btab450-F1" ref-type="fig">Fig. 1</xref>) which then impact downstream analyses (<xref rid="btab450-F2" ref-type="fig">Fig. 2</xref>). A large contributor to this observed effect is the reduction in the proportion of unnormalized zeros for a given gene as LS increases.</p>
    <fig position="float" id="btab450-F2">
      <label>Fig. 2.</label>
      <caption>
        <p>The effects of normalization on downstream DE and enrichment analysis. (<bold>a</bold>) Expression data from the PBMC68K_Pure dataset were normalized and genes were tested for DE using a Wilcoxon rank-sum test between low-LS and high-LS cells (5–25% and 75–95% of LS respectively) within cell-type annotations. Box plots show numbers of significant genes. Given that cells only differ in LS, significant results are considered false positives. (<bold>b</bold>) Expression data from the EMT dataset were analyzed using Monocle2 to identify genes with significantly variable expression over pseudo-time. Total numbers of significant genes are shown in a bar plot. (<bold>c</bold>) Significance values of Hallmark terms enriched for DE genes from the EMT dataset, colored for each normalization method, are plotted for the subset of terms previously identified as defining expression shifts during epithelial to mesenchymal transition.</p>
      </caption>
      <graphic xlink:href="btab450f2" position="float"/>
    </fig>
    <p>To address this, we present Dino, an approach that utilizes a flexible mixture of Negative Binomials model of gene expression to reconstruct full gene-specific expression distributions which are independent of LS. By giving exact zeros positive probability, the Negative Binomial components are applicable to shallow sequencing (high proportions of zeros). Additionally, the mixture component is robust to cell heterogeneity as it accommodates multiple centers of gene expression in the distribution. By directly modeling possibly heterogenous, gene-specific expression distributions, Dino outperforms competing approaches, especially for datasets in which the proportion of zeros is high, as is typical for modern, UMI-based protocols.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>Our proposed method for <underline>di</underline>stributional <underline>no</underline>rmalization, Dino, reconstructs gene-specific expression distributions and provides normalized estimates of expression by constrained sampling from those distributions. Specifically, Dino assumes a hierarchical Poisson model on observed UMI counts with the distribution of Poisson means modeled as a mixture of Gammas, scaled by LS. This Gamma-Poisson model is equivalent to modeling counts as a mixture of Negative Binomials. Normalized expression is then generated by sampling from cell-specific posterior distributions of Poisson means conditioned on observed LS and UMI counts. The estimated distributions are constructed by sharing information across cells while the use of a large number of mixture components approximates the flexibility of a non-parametric approach in order to accommodate varying degrees of heterogeneity in the cell populations under study.</p>
    <sec>
      <title>2.1 Statistical model</title>
      <p>The count data produced by UMI sequencing protocols lend themselves naturally to a glm parameterized by LS (<xref rid="btab450-B1" ref-type="bibr">Anders and Huber, 2010</xref>; <xref rid="btab450-B11" ref-type="bibr">Hafemeister and Satija, 2019</xref>) and the random sampling of barcoded molecules from a large pool for sequencing is theoretically well modeled by independent Poisson distributions on each gene (<xref rid="btab450-B33" ref-type="bibr">Townes <italic toggle="yes">et al.</italic>, 2019</xref>). Furthermore, Poisson means are expected to scale proportionally with LS (<xref rid="btab450-B1" ref-type="bibr">Anders and Huber, 2010</xref>; <xref rid="btab450-B11" ref-type="bibr">Hafemeister and Satija, 2019</xref>; <xref rid="btab450-B22" ref-type="bibr">Lun <italic toggle="yes">et al.</italic>, 2016</xref>; <xref rid="btab450-B33" ref-type="bibr">Townes <italic toggle="yes">et al.</italic>, 2019</xref>), giving counts <italic toggle="yes">y<sub>gj</sub></italic> from gene <italic toggle="yes">g</italic> in cell <italic toggle="yes">j</italic> the distribution <italic toggle="yes">y<sub>gj</sub>∼f<sup>P</sup>(λ<sub>gj</sub>δ<sub>j</sub>)</italic> where <italic toggle="yes">f<sup>P</sup></italic> denotes a Poisson distribution with mean <italic toggle="yes">λ<sub>gj</sub>δ<sub>j</sub></italic>. Defining <italic toggle="yes">δ<sub>j</sub></italic> to be the cell-specific LS, <italic toggle="yes">λ<sub>gj</sub></italic> then represents the latent level of expression for gene <italic toggle="yes">g</italic> in cell <italic toggle="yes">j</italic>, corrected for LS. Note that <italic toggle="yes">λ<sub>gj</sub></italic> is cell dependent since latent levels of expression for a gene may vary across cells due to population heterogeneity and other factors. For convenience of interpretation on the <italic toggle="yes">λ<sub>gj</sub></italic>, calculated LS values are scaled prior to use in the Dino model such that <italic toggle="yes">δ<sub>jMed</sub>=1</italic> where <italic toggle="yes">jMed</italic> is the index of the cell with the median LS across cells.</p>
      <p>The Dino algorithm defines the distribution of <italic toggle="yes">λ<sub>gj</sub></italic> across cells to be the gene-specific expression distribution of interest. If one assumes a Gamma distribution on the <italic toggle="yes">λ<sub>gj</sub></italic>, then the marginal distribution of the <italic toggle="yes">y<sub>gj</sub></italic> is Negative Binomial, the model assumption made by scTransform (<xref rid="btab450-B11" ref-type="bibr">Hafemeister and Satija, 2019</xref>), DESeq2 (<xref rid="btab450-B20" ref-type="bibr">Love <italic toggle="yes">et al.</italic>, 2014</xref>), ZINB-WaVE (<xref rid="btab450-B30" ref-type="bibr">Risso <italic toggle="yes">et al.</italic>, 2018</xref>) and SAVER (<xref rid="btab450-B13" ref-type="bibr">Huang <italic toggle="yes">et al.</italic>, 2018</xref>). However, we observe that unimodal distributions on the means, as implied by a single Gamma distribution on the <italic toggle="yes">λ<sub>gj</sub></italic>, are often insufficient to capture the full heterogeneity present in genes of interest (Supplementary Fig. S1). Thus, to increase the accuracy with which the full gene-specific expression distribution may be estimated for all genes, Dino further assumes the <italic toggle="yes">λ<sub>gj</sub></italic> arise from a mixture of Gamma distributions, and defines normalized expression as samples from the posterior distribution of the <italic toggle="yes">λ<sub>gj</sub></italic>.</p>
      <p>As distribution estimation and normalization are both performed at the gene level, the gene subscript, <italic toggle="yes">g</italic>, is hereafter dropped, and it is noted that computations are repeated across genes. This defines the Dino model as:
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:msup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:msup><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>δ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></disp-formula>
 <disp-formula id="E2"><mml:math id="M2" display="block" overflow="scroll"><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:msup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msup><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>θ</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mo>θ</mml:mo></mml:mrow></mml:mfenced></mml:math></disp-formula></p>
      <p>Here, <italic toggle="yes">f<sup>P</sup></italic> is parameterized by mean <italic toggle="yes">λ<sub>j</sub>δ<sub>j</sub></italic> and <italic toggle="yes">f<sup>G</sup></italic> denotes a Gamma distribution with shape and scale parameters of <italic toggle="yes">μ<sub>k</sub>/θ</italic> and <italic toggle="yes">θ</italic> respectively. The mixture component probabilities, <italic toggle="yes">π<sub>k</sub></italic>, are such that <italic toggle="yes">Σ<sub>K</sub>π<sub>k</sub>=1</italic>. This parameterization is chosen to define the Gamma distribution in terms of its mean, <italic toggle="yes">μ<sub>k</sub>. K</italic> is chosen to be sufficiently large to accommodate both cellular heterogeneity and within-cell-type over-dispersion of the <italic toggle="yes">λ<sub>j</sub></italic> with respect to a single Gamma mixture component.</p>
      <p>This approach, using a large number of components <italic toggle="yes">K</italic>, was inspired by the ash model for control of false discovery rates in statistical tests (<xref rid="btab450-B32" ref-type="bibr">Stephens, 2017</xref>); there, large mixtures of Normal and Uniform distributions were used to approximate arbitrary unimodal distributions with the infinite component model described as ‘a non-parametric limit’. Similar results are demonstrated by Cordy and Thomas in the context of distribution deconvolution (<xref rid="btab450-B8" ref-type="bibr">Cordy and Thomas, 1997</xref>). For Dino, simulated gene expression similarly demonstrates that larger estimates of <italic toggle="yes">K</italic> allow more accurate parametric estimates of the underlying distribution of UMI counts (Supplementary Figs S2 and S3). Dino sets the gene-specific value of <italic toggle="yes">K</italic> as the minimum of 100 (default) and the square root of the number of <italic toggle="yes">y<sub>j</sub></italic> which are greater than zero. Testing on alternate values of <italic toggle="yes">K</italic> shows low sensitivity in downstream analysis to the choice of this parameter, assuming <italic toggle="yes">K</italic> remains sufficiently large (Supplementary Figs S4–S6). Since the negative binomial distribution can be alternately defined as the Gamma-Poisson distribution as previously discussed, this formulation has the reassuring additional interpretation of defining <italic toggle="yes">y<sub>j</sub></italic> as a mixture of Negative Binomials.</p>
    </sec>
    <sec>
      <title>2.2 Sampling normalized values from the posterior</title>
      <p>The posterior distribution on <italic toggle="yes">λ<sub>j</sub></italic> is straightforward to compute:
<disp-formula id="E3"><mml:math id="M3" display="block" overflow="scroll"><mml:mi mathvariant="double-struck">P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>δ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>∝</mml:mo><mml:msup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:msup><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>δ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msup><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>θ</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mo>θ</mml:mo></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:math></disp-formula>which reduces to
<disp-formula id="E4"><mml:math id="M4" display="block" overflow="scroll"><mml:mi mathvariant="double-struck">P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>δ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>K</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mo>τ</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi></mml:mrow></mml:msup><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>θ</mml:mo></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mo>γ</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>θ</mml:mo></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mo>γ</mml:mo><mml:mo>δ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:math></disp-formula>where <italic toggle="yes">τ<sub>kj</sub></italic> is the conditional likelihood that <italic toggle="yes">λ<sub>j</sub></italic> belongs to component <italic toggle="yes">k</italic> given <italic toggle="yes">y<sub>j</sub></italic> and <italic toggle="yes">δ<sub>j</sub></italic>, and <italic toggle="yes">γ</italic> is a concentration parameter. Our testing (Supplementary Figs S7–S9) has demonstrated that resampling from the strict posterior distribution can lead to excessive variance in the normalized expression which can obscure biological features of interest. Therefore, <italic toggle="yes">γ</italic> is included to both reduce the normalized variance and center normalized values around their corresponding scale-factor values.</p>
      <p>Default values of <italic toggle="yes">γ = 15</italic> have proven successful. This adjustment can be seen as a bias in the normalized values toward a scale-factor version of normalization, since, in the limit of <italic toggle="yes">γ</italic>, the normalized expression for cell <italic toggle="yes">j</italic> converges to y<italic toggle="yes"><sub>j</sub>/δ<sub>j</sub></italic>. A modified expectation-maximation (EM) algorithm (<xref rid="btab450-B16" ref-type="bibr">Jamshidian and Jennrich, 1997</xref>) is used to estimate <italic toggle="yes">μ<sub>k</sub></italic> and <italic toggle="yes">τ<sub>kj</sub></italic> (Supplementary Section S1.1). Separate values of <italic toggle="yes">θ</italic> are estimated for each gene based on gamma kernel density estimation (<xref rid="btab450-B7" ref-type="bibr">Chen, 2000</xref>) (Supplementary Section S1.2). To accommodate slight deviation from strict expression scaling with LS, adjustments to <italic toggle="yes">δ<sub>j</sub></italic> are made prior to model parameter estimation (Supplementary Section S1.3). Finally, parameter initialization relies on a modified application of quantile regression (<xref rid="btab450-B5" ref-type="bibr">Branham, 1982</xref>; <xref rid="btab450-B28" ref-type="bibr">Powell, 1984</xref>, <xref rid="btab450-B27" ref-type="bibr">1986</xref>) (Supplementary Section S1.4). An alternate (non-default) sampling method designed to preserve expression ranks is also available to the user (Supplementary Section S1.5).</p>
    </sec>
    <sec>
      <title>2.3 Datasets</title>
      <p>Results from six publicly available datasets are evaluated: PBMC68K_Pure, PBMC5K_Prot, MaltTumor10K, MouseBrain, PBMC68K and EMT. Where applicable, analyzed expression was derived from unfiltered gene-barcode matrices, with empty droplets removed by the tools in the R package DropletUtils (<xref rid="btab450-B4874545" ref-type="bibr">Lun et al., 2019</xref>).</p>
      <p>PBMC68K_Pure is a partner dataset to PBMC68K (<xref rid="btab450-B38" ref-type="bibr">Zheng <italic toggle="yes">et al.</italic>, 2017</xref>) produced by purifying peripheral blood mononuclear cells (PBMCs) into 10 cell types through the use of cell-type specific isolation kits and separately sequencing each group. These cell-type annotations are considered here as ground truth when evaluating the effects of normalization on downstream clustering. For increased accuracy, the six cell-types for which tSNE plots do not separate into sub-groups (<xref rid="btab450-B23" ref-type="bibr">Van Der Maaten, 2014</xref>; <xref rid="btab450-B24" ref-type="bibr">van der Maaten and Hinton, 2008</xref>) were subset, denoting low-heterogeneity references: CD4+ T Helper, CD4+/CD25 T Reg, CD4+/CD45RA+/CD25- Naive T, CD4+/CD45RO+ Memory, CD56+ NK and CD8+/CD45RA+ Naive Cytotoxic. Zheng <italic toggle="yes">et al.</italic> identify these particular six cell-types as demonstrating little sub-structure (<xref rid="btab450-B38" ref-type="bibr">Zheng <italic toggle="yes">et al.</italic>, 2017</xref>).</p>
      <p>EMT is a dataset of 5004 MCF10A mammary epithelial cells induced to undergo spontaneous epithelial to mesenchymal transitions through the cellular detection of neighboring unoccupied space (<xref rid="btab450-B26" ref-type="bibr">McFaline-Figueroa <italic toggle="yes">et al.</italic>, 2019</xref>). This spatial effect allowed the authors to dissect an inner region <italic toggle="yes">a priori</italic> expected to be primarily epithelial cells and an outer region <italic toggle="yes">a priori</italic> expected to be primarily mesenchymal cells. Cells from each region were then sequenced separately. From all the data published by the authors, the EMT dataset we consider is denoted ‘Mock’ in the barcode metadata. Included in the initial publication, the authors describe eight gene sets from the Hallmark collection (<xref rid="btab450-B19" ref-type="bibr">Liberzon <italic toggle="yes">et al.</italic>, 2015</xref>) which they consider to be significantly enriched for activity during the epithelial to mesenchymal transition. We take this set of terms as a ground truth for assessing the power of analysis based on each normalization method.</p>
      <p>Results from the PBMC68K_Pure and EMT datasets are shown in the manuscript while results from other datasets are provided in the supplement. Details on each of the datasets as well as their pre-processing are provided in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S2</xref>.</p>
      <p>The case study datasets are also used to generate simulated datasets with expression profiles designed to closely mirror individual experimentally observed cells. In brief, for a given case study dataset, unsupervised clustering is used to define clusters. Two cells within the same cluster and with similar LS are sampled and UMI counts are summed across the two cells to make a pseudo-cell. Expression from each gene of this pseudo-cell is then down-sampled using a binomial distribution to generate two new simulated cells which differ in LS due to different binomial probability parameters. Constant binomial probabilities across genes results in equivalent expressed (EE) between the two simulated cells, after accounting for LS, for all but 10 genes for which differential expression (DE) is induced by alteration of the binomial probability. Here EE is used to denote a gene whose average expression is equal across two cells (or two groups of cells) which have been properly normalized for LS. DE denotes a difference in means between two groups unless otherwise specified. This process of constructing and down-sampling pseudo-cells is repeated to generate a collection of cells with the same set of EE and DE genes, but varying in LS; the process is repeated again for other clusters to simulate subpopulation heterogeneity. These simulated datasets are then used to quantify power and false positive rates for DE testing following different normalization methods. Full simulation details are described in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S3</xref>. Different methods of pre-clustering cells yield similar results (Supplementary Figs S10–S12).</p>
    </sec>
    <sec>
      <title>2.4 Application of normalization methods</title>
      <p>For each dataset considered, normalized estimates of expression were obtained from Dino (v0.6.2), Scran (v1.16.0), scTransform (v0.2.1), CPM and CPT. We also consider un-normalized UMIs for reference. Further information on package defaults, annotation versions and other software is given in <xref rid="sup1" ref-type="supplementary-material">Supplementary Section S4</xref>. The implementation of scTransform provides both normalized expression in terms of regression residuals (recommended for most analysis applications by the authors) and normalized expression in terms of a corrected UMI counts matrix. We consider both in this manuscript and refer to the residuals matrix as scTrans and the corrected counts matrix as scTransCnt.</p>
      <p>Given its additional complexity, Dino is generally more computationally demanding than existing methods. However, it remains competitive even in the context of the large datasets currently being generated. We performed a test of computational intensity on a 2017 MacBook Pro with a 3.1 GHz quad-core CPU and 16 GB of RAM. Optimizations in the Dino package, including the estimation of model parameters on a default subset of 10 000 cells when input data exceeds that number, allow Dino to successfully normalized datasets which are too large for other applications to handle on this hardware (Supplementary Fig. S13).</p>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 LS-dependent patterns in normalized data</title>
      <p>To compare Dino, Scran and scTransform, we normalized the PBMC68K_Pure data using each method. Given the cell-type purification of this dataset, cells within a given annotation are expected to be largely homogeneous and, consequently, should exhibit little difference in expression among cells following normalization. Examination of the normalized expression between low-LS and high-LS CD4+/CD45RO+ memory cells shows that existing methods exhibit significant LS-dependent effects. As shown in <xref rid="btab450-F1" ref-type="fig">Figure 1a</xref>, for a normalized gene to maintain average expression that is relatively independent of LS, the higher proportion of zeros in the low-LS group is balanced by inflation of the non-zeros. This leads to shifts in the densities of the normalized non-zeros between low and high-LS cells, as shown in <xref rid="btab450-F1" ref-type="fig">Figure 1b</xref>. To evaluate this effect across all genes, we compare the quantiles in low-LS and high-LS cells for a random sample of genes across all cell-types in PBMC68K_Pure through a modified Q-Q plot. As with traditional Q-Q plots, high frequency off the diagonal in <xref rid="btab450-F1" ref-type="fig">Figure 1c</xref> indicates differences in the distribution of normalized expression between low-LS and high-LS cells (Supplementary Section S4.3). Scran and scTransform demonstrate systematic shifts in the distribution of normalized expression as a function of LS. Normalized expression from Dino, however, mitigates these effects, producing more equivalent expression distributions across low and high-LS cells. We observe similar results for other case study datasets (Supplementary Fig. S14).</p>
    </sec>
    <sec>
      <title>3.2 Effects of normalization on differential expression analysis</title>
      <p>To evaluate the extent to which LS-dependent differences in the expression distributions affect downstream differential expression (DE) analysis, we used the Wilcoxon rank-sum test, the default test in the Seurat pipeline as of writing, to identify significantly DE genes between low and high-LS cells. Tests were conducted within each of the six annotated cell-types in the PBMC68K_Pure dataset, resulting in six separate measures of significant genes. <xref rid="btab450-F2" ref-type="fig">Figure 2a</xref> demonstrates that many genes are identified as significant by most methods. As each cell-type is homogeneous by construction, differences in LS are not expected to indicate true biological variability and significant results are thus considered false positives. These results are consistent with the changes in normalized expression distributions observed in <xref rid="btab450-F1" ref-type="fig">Figure 1</xref> as the Wilcoxon test, as well as others widely used in scRNA-seq analysis such as MAST (<xref rid="btab450-B9" ref-type="bibr">Finak <italic toggle="yes">et al.</italic>, 2015</xref>), is susceptible to differences in distribution, not merely differences in means. Similar results are observed for the MaltTumor10K and PBMC5K_Prot datasets compared against pseudo-annotations of cell-type (Supplementary Fig. S15). A control comparison further indicates that observed high rates of significant genes are largely due to false positives. When comparisons are made between randomly selected cells as opposed to low-LS versus high-LS cells, exactly 0 genes are significant (<italic toggle="yes">P</italic>-adj ≤ 1e-2) following a test of DE.</p>
      <p>To evaluate DE analysis in the positive case where DE genes are expected to exist, we considered a case study dataset of cells undergoing spontaneous epithelial to mesenchymal transitions from the EMT dataset (<xref rid="btab450-B26" ref-type="bibr">McFaline-Figueroa <italic toggle="yes">et al.</italic>, 2019</xref>). Following the originally published analysis pipeline, we used Monocle2 (<xref rid="btab450-B29" ref-type="bibr">Qiu <italic toggle="yes">et al.</italic>, 2017</xref>; <xref rid="btab450-B34" ref-type="bibr">Trapnell <italic toggle="yes">et al.</italic>, 2014</xref>) to construct a pseudo-time model of the experimentally induced differentiation tree (Supplementary Section S4.4). Cells along the primary branch of the differentiation tree were tested for DE, here defined as having a significant change in expression over pseudo-time.</p>
      <p>As with the negative control examples of <xref rid="btab450-F2" ref-type="fig">Figure 2a</xref> and Supplementary Figure S15, Dino normalized data results in the fewest significant genes (<xref rid="btab450-F2" ref-type="fig">Fig. 2b</xref>). Results from an enrichment analysis (<xref rid="btab450-F2" ref-type="fig">Fig. 2c</xref>) suggest that the reduction in the number of significant genes found by Dino is likely due to a reduction in false positives, as with the negative control, rather than an undesirable reduction in power. Specifically, we performed gene set enrichment analysis (GSEA) on the Hallmark collection of gene sets (<xref rid="btab450-B19" ref-type="bibr">Liberzon <italic toggle="yes">et al.</italic>, 2015</xref>). Enrichment significance values are plotted in <xref rid="btab450-F2" ref-type="fig">Figure 2c</xref> for the eight terms identified by McFaline-Figueroa <italic toggle="yes">et al.</italic> as significant markers of EMT activity. Dino normalization results in competitive significance in four of the eight terms and shows the highest GSEA significance in the remaining four terms. Notably, Dino shows improved enrichment results for the term defining the epithelial to mesenchymal transition; the Dino adjusted <italic toggle="yes">P</italic>-value (<italic toggle="yes">P</italic>-adj = 3.3e-4) is close to an order of magnitude more significant than the nearest alternate method (CPT, <italic toggle="yes">P</italic>-adj = 1.9e-3).</p>
      <p>Simulated datasets provide further insights consistent with the case study results regarding DE analysis. To quantify the relationship between true positive rates (TPR) and false positive rates (FPR), we simulated heterogenous cell populations from experimentally observed expression with known DE and EE genes (Supplementary Section S3). Following normalization, DE analysis was conducted using a Wilcoxon rank-sum test. <xref rid="btab450-F3" ref-type="fig">Figure 3</xref> plots average ROC curves for each normalization method where the average is taken over 30 datasets simulated from the PBMC68K_Pure dataset. For most methods, it can be observed that high power is confounded by high FPRs. As with the negative control, however, Dino controls FPR to much lower levels. Repeated simulations and analysis across the other five datasets considered yield similar results, as does analysis based on MAST (Supplementary Figs S16 and S17). Performance is more similar across methods when DE tests are conducted via <italic toggle="yes">t</italic>-tests, since <italic toggle="yes">t</italic>-tests identify shifts in means and are not sensitive to other differences in distributions (Supplementary Fig. S18). Point estimation of TPR/FPR controlling adjusted <italic toggle="yes">P</italic>-values at 0.01 through the method of Benjamini and Hochberg (<xref rid="btab450-B4" ref-type="bibr">Benjamini and Hochberg, 1995</xref>) supports the ROC plots (<xref rid="sup1" ref-type="supplementary-material">Supplementary Tables S1–S3</xref>).</p>
      <fig position="float" id="btab450-F3">
        <label>Fig. 3.</label>
        <caption>
          <p>The effects of normalization on downstream DE analysis. Simulated data based on the PBMC68K_Pure dataset were normalized using each method. ROC curves colored by normalization method define the relationship between average TPR and average FPR for a Wilcoxon rank-sum test, where the average is calculated across 30 simulated datasets.</p>
        </caption>
        <graphic xlink:href="btab450f3" position="float"/>
      </fig>
    </sec>
    <sec>
      <title>3.3 Effects of normalization on clustering</title>
      <p>The effect of normalization on clustering was evaluated by comparing clusters derived from data normalized by each method with the annotations in the PBMC68K_Pure dataset using the adjusted Rand index (ARI). As shown in <xref rid="btab450-F4" ref-type="fig">Figure 4</xref>, for one sub-sample of cells, Dino, Scran and scTrans outperform other methods; Dino shows slightly although not significantly improved performance over scTrans and Scran (<xref rid="btab450-F4" ref-type="fig">Fig. 4a</xref>). To exacerbate the differences in sequenced LS and thereby highlight the effect of differences in LS on clustering, we randomly down-sampled half of the 25000 cells to 25% of their original LS. <xref rid="btab450-F4" ref-type="fig">Figure 4b</xref> shows the derived clusters with the down-sampled cells (bold) compared to the unmodified cells. Some effect of LS is observed in the clustering, and ARIs for all normalization methods decreased, as expected. However, Dino normalized data retains a more accurate differentiation between cells with an ARI of 0.491 compared to 0.375 and 0.352 for scTrans and Scran, respectively.</p>
      <fig position="float" id="btab450-F4">
        <label>Fig. 4.</label>
        <caption>
          <p>The effects of normalization on clustering. (<bold>a</bold>) tSNE plots of normalized PBMC68K_Pure data, colored by 6 cell-type annotations, show similarly high clustering accuracy across methods. (<bold>b</bold>) The same clustering plots as in (a), but with half the data down-sampled (down-sampled cells in bold) prior to normalization to produce greater differences in LS. (<bold>c</bold>) Boxplots of ARIs for multiple un-modified and down-sampled datasets across 24 samples of 25 thousand cells from the PBMC68K_Pure dataset.</p>
        </caption>
        <graphic xlink:href="btab450f4" position="float"/>
      </fig>
      <p><xref rid="btab450-F4" ref-type="fig">Figure 4c</xref> shows results from the analysis repeated across 24 samples of 25 000 cells. As with the sample shown in <xref rid="btab450-F4" ref-type="fig">Figure 4a</xref>, Dino and Scran perform comparably (medians of 0.601 and 0.608 respectively), and uniformly better than scTrans (median of 0.590). In the down-sampled case, Dino performs significantly better than competing methods (<italic toggle="yes">P</italic> &lt; 2.2e-16 under a <italic toggle="yes">t</italic>-test). Similar results are observed for the MaltTumor10K and PBMC5k_Prot datasets (Supplementary Figs S19 and S20).</p>
    </sec>
  </sec>
  <sec>
    <title>4 Discussion</title>
    <p>Droplet-based, UMI protocols provide unprecedented cellular resolution in expression profiling. However, the use of UMIs does not remove the need for effective normalization in the analysis of such data, and the extreme sparsity of these high-throughput experiments introduces new challenges for LS correction. Dino adapts to these challenges by correcting the full expression distribution of each gene for LS-dependent variation, rather than only correcting mean expression as with most existing methods. This approach increases both power and precision in down-stream analysis.</p>
    <p>As noted in methods, our approach assumes that latent counts for a given gene in a given cell are Poisson distributed, with latent means described by a Gamma mixture. The Gamma-Poisson framework is common in single-cell RNA-seq approaches (<xref rid="btab450-B11" ref-type="bibr">Hafemeister and Satija, 2019</xref>; <xref rid="btab450-B13" ref-type="bibr">Huang <italic toggle="yes">et al.</italic>, 2018</xref>; <xref rid="btab450-B20" ref-type="bibr">Love <italic toggle="yes">et al.</italic>, 2014</xref>; <xref rid="btab450-B30" ref-type="bibr">Risso <italic toggle="yes">et al.</italic>, 2018</xref>); however, the Gamma mixture component introduced here directly accommodates heterogeneity which leads to improved operating characteristics in a number of settings. Dino normalizes observations by resampling from the gene-specific posterior distribution to provide normalized estimates of expression. While the default approach presented here provides unconstrained sampling up to differences in sample-specific posteriors as detailed in methods, a user may choose to perform an alternate restricted quantile sampling that aims to preserve un-normalized expression ordering in the normalized data (Supplementary Section S1.5). Other measures from the posterior could potentially be obtained (e.g. the posterior mean or median). However, this is not recommended in practice—and not an available option in the distributed package—as doing so preserves the LS-dependent variation in distribution observed in existing methods, especially for low and moderately expressed genes (Supplementary Fig. S21).</p>
    <p>In some cases, such as when a cell type under study down/up-regulates a significant majority of DE genes compared to other cell types being sequenced, a researcher may find that LS is correlated with true biological variability. In these situations, normalization to remove the effects of LS would further remove biological variation of interest. To accommodate these situations, Dino allows the user to supply alternate, cell-specific size factors, such as those estimated by Scran, as the measure of technical nuisance variation. Implementation details are available in the package documentation and vignette.</p>
    <p>In contrast to existing methods, the resampling performed by Dino accommodates the varying proportions of zeros across LS, reducing or removing the effect of LS on the full expression distribution. In addition, by resampling from the full gene-specific distribution, Dino produces greater homogeneity of normalized expression across LS within cell type, and therefore leads to more accurate downstream analyses that are robust to heterogeneous cell populations.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btab450_Supplementary_Data</label>
      <media xlink:href="btab450_supplementary_data.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors thank Matt Bernstein for conversations that improved the manuscript.</p>
    <sec>
      <title>Funding</title>
      <p>JB was supported by a National Library of Medicine Bio-Data Science Training program (Grant no. T32LM012413). CK was supported by a National Institutes of Health grant (Grant no. NIHGM102756).</p>
      <p>
        <bold>Conflict of Interest</bold>
      </p>
      <p>The authors declare that they have no competing interests.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btab450-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Anders</surname><given-names>S.</given-names></string-name>, <string-name><surname>Huber</surname><given-names>W.</given-names></string-name></person-group> (<year>2010</year>) <article-title>Differential expression analysis for sequence count data</article-title>. <source>Genome Biol</source>., <volume>11</volume>, <fpage>R106</fpage>.<pub-id pub-id-type="pmid">20979621</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bacher</surname><given-names>R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>SCnorm: robust normalization of single-cell RNA-seq data</article-title>. <source>Nat. Methods</source>, <volume>14</volume>, <fpage>584</fpage>–<lpage>586</lpage>.<pub-id pub-id-type="pmid">28418000</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bacher</surname><given-names>R.</given-names></string-name>, <string-name><surname>Kendziorski</surname><given-names>C.</given-names></string-name></person-group> (<year>2016</year>) <article-title>Design and computational analysis of single-cell RNA-sequencing experiments</article-title>. <source>Genome Biol</source>., <volume>17</volume>, <fpage>1</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">26753840</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Benjamini</surname><given-names>Y.</given-names></string-name>, <string-name><surname>Hochberg</surname><given-names>Y.</given-names></string-name></person-group> (<year>1995</year>) <article-title>Controlling the false discovery rate: a practical and powerful approach to multiple testing</article-title>. <source>J. R. Stat. Soc. Ser. B</source>, <volume>57</volume>, <fpage>289</fpage>–<lpage>300</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Branham</surname><given-names>R.L.J.</given-names></string-name></person-group> (<year>1982</year>) <article-title>Alternatives to least squares</article-title>. <source>Astron. J</source>., <volume>87</volume>, <fpage>928</fpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Butler</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>. <source>Nat. Biotechnol</source>., <volume>36</volume>, <fpage>411</fpage>–<lpage>420</lpage>.<pub-id pub-id-type="pmid">29608179</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chen</surname><given-names>S.X.</given-names></string-name></person-group> (<year>2000</year>) <article-title>Probability density function estimation using gamma kernels</article-title>. <source>Ann. Inst. Stat. Math</source>., <volume>52</volume>, <fpage>471</fpage>–<lpage>480</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cordy</surname><given-names>C.B.</given-names></string-name>, <string-name><surname>Thomas</surname><given-names>D.R.</given-names></string-name></person-group> (<year>1997</year>) <article-title>Deconvolution of a distribution function</article-title>. <source>J. Am. Stat. Assoc</source>., <volume>92</volume>, <fpage>1459</fpage>–<lpage>1465</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Finak</surname><given-names>G.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title>. <source>Genome Biol</source>., <volume>16</volume>, <fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">25583448</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Grün</surname><given-names>D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>Validation of noise models for single-cell transcriptomics</article-title>. <source>Nat. Methods</source>, <volume>11</volume>, <fpage>637</fpage>–<lpage>640</lpage>.<pub-id pub-id-type="pmid">24747814</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hafemeister</surname><given-names>C.</given-names></string-name>, <string-name><surname>Satija</surname><given-names>R.</given-names></string-name></person-group> (<year>2019</year>) <article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title>. <source>Genome Biol</source>., <volume>20</volume>, <fpage>296</fpage>.<pub-id pub-id-type="pmid">31870423</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Haque</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>A practical guide to single-cell RNA-sequencing for biomedical research and clinical applications</article-title>. <source>Genome Med</source>., <volume>9</volume>, <fpage>1</fpage>–<lpage>12</lpage>.<pub-id pub-id-type="pmid">28081715</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huang</surname><given-names>M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>SAVER: gene expression recovery for single-cell RNA sequencing</article-title>. <source>Nat. Methods</source>, <volume>15</volume>, <fpage>539</fpage>–<lpage>542</lpage>.<pub-id pub-id-type="pmid">29941873</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hwang</surname><given-names>B.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>Single-cell RNA sequencing technologies and bioinformatics pipelines</article-title>. <source>Exp. Mol. Med</source>., <volume>50</volume>, <fpage>1</fpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Islam</surname><given-names>S.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>Quantitative single-cell RNA-seq with unique molecular identifiers</article-title>. <source>Nat. Methods</source>, <volume>11</volume>, <fpage>163</fpage>–<lpage>166</lpage>.<pub-id pub-id-type="pmid">24363023</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jamshidian</surname><given-names>M.</given-names></string-name>, <string-name><surname>Jennrich</surname><given-names>R.I.</given-names></string-name></person-group> (<year>1997</year>) <article-title>Acceleration of the EM Algorithm by using Quasi-Newton Methods</article-title>. <source>J. R. Stat. Soc. Ser. B (Stat. Methodol.)</source>, <volume>59</volume>, <fpage>569</fpage>–<lpage>587</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Klein</surname><given-names>A.M.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>Droplet barcoding for single-cell transcriptomics applied to embryonic stem cells</article-title>. <source>Cell</source>, <volume>161</volume>, <fpage>1187</fpage>–<lpage>1201</lpage>.<pub-id pub-id-type="pmid">26000487</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kolodziejczyk</surname><given-names>A.A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>The technology and biology of single-cell RNA sequencing</article-title>. <source>Mol. Cell</source>, <volume>58</volume>, <fpage>610</fpage>–<lpage>620</lpage>.<pub-id pub-id-type="pmid">26000846</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Liberzon</surname><given-names>A.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>The molecular signatures database hallmark gene set collection</article-title>. <source>Cell Syst</source>., <volume>1</volume>, <fpage>417</fpage>–<lpage>425</lpage>.<pub-id pub-id-type="pmid">26771021</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Love</surname><given-names>M.I.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</article-title>. <source>Genome Biol</source>., <volume>15</volume>, <fpage>1</fpage>–<lpage>21</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B4874545">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lun</surname>,<given-names>A.T.L.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>EmptyDrops: distinguishing cells from empty droplets in droplet-based single-cell RNA sequencing data</article-title>. <source><italic toggle="yes">Genome Biol.</italic></source>, <volume>20</volume>, <fpage>63</fpage>.<pub-id pub-id-type="pmid">30902100</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lun</surname><given-names>A.T.L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2016</year>) <article-title>Pooling across cells to normalize single-cell RNA sequencing data with many zero counts</article-title>. <source>Genome Biol</source>., <volume>17</volume>, <fpage>1</fpage>–<lpage>14</lpage>.<pub-id pub-id-type="pmid">26753840</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Van Der Maaten</surname><given-names>L.</given-names></string-name></person-group> (<year>2014</year>) <article-title>Accelerating t-SNE using tree-based algorithms</article-title>. <source>J. Mach. Learn. Res</source>., <volume>15</volume>, <fpage>3221</fpage>–<lpage>3245</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>van der Maaten</surname><given-names>L.</given-names></string-name>, <string-name><surname>Hinton</surname><given-names>G.</given-names></string-name></person-group> (<year>2008</year>) <article-title>Visualizing high-dimensional data using t-SNE</article-title>. <source>J. Mach. Learn. Res</source>., <volume>9</volume>, <fpage>2579</fpage>–<lpage>2605</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Macosko</surname><given-names>E.Z.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>Highly parallel genome-wide expression profiling of individual cells using nanoliter droplets</article-title>. <source>Cell</source>, <volume>161</volume>, <fpage>1202</fpage>–<lpage>1214</lpage>.<pub-id pub-id-type="pmid">26000488</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McFaline-Figueroa</surname><given-names>J.L.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>A pooled single-cell genetic screen identifies regulatory checkpoints in the continuum of the epithelial-to-mesenchymal transition</article-title>. <source>Nat. Genet</source>., <volume>51</volume>, <fpage>1389</fpage>–<lpage>1398</lpage>.<pub-id pub-id-type="pmid">31477929</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Powell</surname><given-names>J.L.</given-names></string-name></person-group> (<year>1986</year>) <article-title>Censored regression quantiles</article-title>. <source>J. Econom</source>., <volume>32</volume>, <fpage>143</fpage>–<lpage>155</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Powell</surname><given-names>J.L.</given-names></string-name></person-group> (<year>1984</year>) <article-title>Least absolute deviations estimation for the censored regression model</article-title>. <source>J. Econom</source>., <volume>25</volume>, <fpage>303</fpage>–<lpage>325</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Qiu</surname><given-names>X.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Reversed graph embedding resolves complex single-cell trajectories</article-title>. <source>Nat. Methods</source>, <volume>14</volume>, <fpage>979</fpage>–<lpage>982</lpage>.<pub-id pub-id-type="pmid">28825705</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Risso</surname><given-names>D.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2018</year>) <article-title>A general and flexible method for signal extraction from single-cell RNA-seq data</article-title>. <source>Nat. Commun</source>., <volume>9</volume>, <fpage>284</fpage>.<pub-id pub-id-type="pmid">29348443</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Satija</surname><given-names>R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2015</year>) <article-title>Spatial reconstruction of single-cell gene expression data</article-title>. <source>Nat. Biotechnol</source>., <volume>33</volume>, <fpage>495</fpage>–<lpage>502</lpage>.<pub-id pub-id-type="pmid">25867923</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stephens</surname><given-names>M.</given-names></string-name></person-group> (<year>2017</year>) <article-title>False discovery rates: a new deal</article-title>. <source>Biostatistics</source>, <volume>18</volume>, <fpage>275</fpage>–<lpage>294</lpage>.<pub-id pub-id-type="pmid">27756721</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Townes</surname><given-names>F.W.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2019</year>) <article-title>Feature selection and dimension reduction for single-cell RNA-Seq based on a multinomial model</article-title>. <source>Genome Biol</source>., <volume>20</volume>, <fpage>1</fpage>–<lpage>16</lpage>.<pub-id pub-id-type="pmid">30606230</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Trapnell</surname><given-names>C.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2014</year>) <article-title>The dynamics and regulators of cell fate decisions are revealed by pseudotemporal ordering of single cells</article-title>. <source>Nat. Biotechnol</source>., <volume>32</volume>, <fpage>381</fpage>–<lpage>386</lpage>.<pub-id pub-id-type="pmid">24658644</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tsoucas</surname><given-names>D.</given-names></string-name>, <string-name><surname>Yuan</surname><given-names>G.-C.</given-names></string-name></person-group> (<year>2018</year>) <article-title>GiniClust2: a cluster-aware, weighted ensemble clustering method for cell-type detection</article-title>. <source>Genome Biol</source>., <volume>19</volume>, <fpage>58</fpage>.<pub-id pub-id-type="pmid">29747686</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tung</surname><given-names>P.Y.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Batch effects and the effective design of single-cell gene expression studies</article-title>. <source>Sci. Rep</source>., <volume>7</volume>, <fpage>1</fpage>–<lpage>15</lpage>.<pub-id pub-id-type="pmid">28127051</pub-id></mixed-citation>
    </ref>
    <ref id="btab450-B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wu</surname><given-names>A.R.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Single-cell transcriptional analysis</article-title>. <source>Annu. Rev. Anal. Chem</source>., <volume>10</volume>, <fpage>439</fpage>–<lpage>462</lpage>.</mixed-citation>
    </ref>
    <ref id="btab450-B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zheng</surname><given-names>G.X.Y.</given-names></string-name></person-group>  <etal>et al</etal> (<year>2017</year>) <article-title>Massively parallel digital transcriptional profiling of single cells</article-title>. <source>Nat. Commun</source>., <volume>8</volume>, <fpage>1</fpage>–<lpage>12</lpage>.<pub-id pub-id-type="pmid">28232747</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
