<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5447237</article-id>
    <article-id pub-id-type="pmid">28158442</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btx054</article-id>
    <article-id pub-id-type="publisher-id">btx054</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Original Papers</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Systems Biology</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Automated cell type discovery and classification through knowledge transfer</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Lee</surname>
          <given-names>Hao-Chih</given-names>
        </name>
        <xref ref-type="aff" rid="btx054-aff1">1</xref>
        <xref ref-type="aff" rid="btx054-aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kosoy</surname>
          <given-names>Roman</given-names>
        </name>
        <xref ref-type="aff" rid="btx054-aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Becker</surname>
          <given-names>Christine E</given-names>
        </name>
        <xref ref-type="aff" rid="btx054-aff1">1</xref>
        <xref ref-type="aff" rid="btx054-aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dudley</surname>
          <given-names>Joel T</given-names>
        </name>
        <xref ref-type="aff" rid="btx054-aff1">1</xref>
        <xref ref-type="aff" rid="btx054-aff2">2</xref>
        <xref ref-type="corresp" rid="btx054-cor1"/>
        <!--<email>joel.dudley@mssm.edu</email>-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kidd</surname>
          <given-names>Brian A</given-names>
        </name>
        <xref ref-type="aff" rid="btx054-aff1">1</xref>
        <xref ref-type="aff" rid="btx054-aff2">2</xref>
        <xref ref-type="corresp" rid="btx054-cor1"/>
        <!--<email>brian.kidd@mssm.edu</email>-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Wren</surname>
          <given-names>Jonathan</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <aff id="btx054-aff1"><label>1</label>Department of Genetics and Genomic Sciences, Icahn School of Medicine at Mt. Sinai, New York, NY, USA</aff>
    <aff id="btx054-aff2"><label>2</label>Icahn School of Medicine at Mt. Sinai, Institute for Next Generation Healthcare, New York, NY, USA</aff>
    <author-notes>
      <corresp id="btx054-cor1">To whom correspondence should be addressed. Email: <email>brian.kidd@mssm.edu</email> or <email>joel.dudley@mssm.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>01</day>
      <month>6</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2017-01-31">
      <day>31</day>
      <month>1</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>31</day>
      <month>1</month>
      <year>2017</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>33</volume>
    <issue>11</issue>
    <fpage>1689</fpage>
    <lpage>1695</lpage>
    <history>
      <date date-type="received">
        <day>25</day>
        <month>10</month>
        <year>2016</year>
      </date>
      <date date-type="rev-recd">
        <day>17</day>
        <month>1</month>
        <year>2017</year>
      </date>
      <date date-type="accepted">
        <day>24</day>
        <month>1</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author 2017. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2017</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/" license-type="cc-by">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btx054.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="SA1">
        <title>Motivation</title>
        <p>Recent advances in mass cytometry allow simultaneous measurements of up to 50 markers at single-cell resolution. However, the high dimensionality of mass cytometry data introduces computational challenges for automated data analysis and hinders translation of new biological understanding into clinical applications. Previous studies have applied machine learning to facilitate processing of mass cytometry data. However, manual inspection is still inevitable and becoming the barrier to reliable large-scale analysis.</p>
      </sec>
      <sec id="SA2">
        <title>Results</title>
        <p>We present a new algorithm called <bold>A</bold>utomated <bold>C</bold>ell-type <bold>D</bold>iscovery and <bold>C</bold>lassification (ACDC) that fully automates the classification of canonical cell populations and highlights novel cell types in mass cytometry data. Evaluations on real-world data show ACDC provides accurate and reliable estimations compared to manual gating results. Additionally, ACDC automatically classifies previously ambiguous cell types to facilitate discovery. Our findings suggest that ACDC substantially improves both reliability and interpretability of results obtained from high-dimensional mass cytometry profiling data.</p>
      </sec>
      <sec id="SA3">
        <title>Availability and Implementation</title>
        <p>A Python package (Python 3) and analysis scripts for reproducing the results are availability on <ext-link ext-link-type="uri" xlink:href="https://bitbucket.org/dudleylab/acdc">https://bitbucket.org/dudleylab/acdc</ext-link>.</p>
      </sec>
      <sec id="SA4">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">National Institutes of Health</named-content>
          <named-content content-type="funder-identifier">10.13039/100000002</named-content>
        </funding-source>
        <award-id>R01DK098242</award-id>
        <award-id>U54CA189201</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="7"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>High-throughput, high-dimensional cytometry is one of the most valuable tools for basic and clinical immunology. Advances in this technology over the last decade now provide simultaneous measurements of dozens of proteins at single-cell resolution (<xref rid="btx054-B4" ref-type="bibr">Bandura <italic>et al.</italic>, 2009</xref>; <xref rid="btx054-B27" ref-type="bibr">Spitzer and Nolan, 2016</xref>). Mass cytometry by time-of-flight (CyTOF) provides a powerful new tool for studying cellular diversity and dynamics by measuring up to 50 markers per cell. Many recent studies highlight the utility of CyTOF for enabling novel discovery and understanding in multiple domains of immunology, including mapping cell subset heterogeneity and specificity in response to various pathogens (<xref rid="btx054-B18" ref-type="bibr">Newell <italic>et al.</italic>, 2012</xref>, <xref rid="btx054-B17" ref-type="bibr">2013</xref>), precise elucidation of cellular networks and biochemical pathway activation following drug perturbation (<xref rid="btx054-B5" ref-type="bibr">Bendall <italic>et al.</italic>, 2011</xref>; <xref rid="btx054-B6" ref-type="bibr">Bodenmiller <italic>et al.</italic>, 2012</xref>), as well as new understanding of cellular trafficking and tissue localization (Wong <italic>et al.</italic>, <xref rid="btx054-B28" ref-type="bibr">2016a</xref>, <xref rid="btx054-B29" ref-type="bibr">b</xref>). However, the high number of measures and complexity of the resulting data restrict manual exploration and present challenges for both the analysis and biological interpretation of CyTOF data (<xref rid="btx054-B19" ref-type="bibr">Newell and Cheng, 2016</xref>). New tools that automate the data analysis are needed to realize the full potential of CyTOF for biological discovery and translational applications.</p>
    <p>A number of studies have focused on applying or developing algorithms to address the data analysis and interpretation challenges arising from CyTOF data. One early approach applied machine learning techniques to detect clusters of similar immune cell types in high dimensional space (<xref rid="btx054-B1" ref-type="bibr">Aghaeepour <italic>et al.</italic>, 2013</xref>; <xref rid="btx054-B21" ref-type="bibr">Qiu <italic>et al.</italic>, 2011</xref>). More recently, researchers have used network analysis techniques to assist the identification of known and novel cell populations (<xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>; <xref rid="btx054-B24" ref-type="bibr">Samusik <italic>et al.</italic>, 2016</xref>; <xref rid="btx054-B25" ref-type="bibr">Shekhar <italic>et al.</italic>, 2014</xref>). In concert with these analytical advances, a number of studies have developed software tools to organize and visualize the high-dimensional cytometry data (<xref rid="btx054-B3" ref-type="bibr">Amir <italic>et al.</italic>, 2013</xref>; <xref rid="btx054-B25" ref-type="bibr">Shekhar <italic>et al.</italic>, 2014</xref>; <xref rid="btx054-B16" ref-type="bibr">Van der Maaten and Hinton, 2008</xref>). Yet, to date, the available computational tools still require substantial manual manipulation to extract biological findings and interpret the data. These manual steps create a major limitation for exploring the full dataset and taking advantage of the large number of markers in CyTOF.</p>
    <p>One of the biggest challenges for interpreting mass cytometry data is how best to annotate individual cells with canonical cell types. This difficulty arises from (i) uncertainty in defining cell types based on more than a handful of markers and (ii) the absence of biological information as an input for machine learning techniques. Current approaches require substantial manual inspection that impedes the analysis workflow, underutilizes the full value of the high-dimensional data, and ultimately reduces the scientific insights that can be gained from each study. Here we address the cell annotation challenge through a novel computational method that greatly facilitates the organization and interpretation of mass cytometry data through automated transfer of biological knowledge.</p>
    <p>Our method automates cell annotation by using biological knowledge as an input parameter to a novel machine learning approach: <bold>A</bold>utomated <bold>C</bold>ell-type <bold>D</bold>iscovery and <bold>C</bold>lassification (ACDC). ACDC provides enhanced visualization and automated classification of canonical cell populations, as well as augments the discovery of novel populations from mass cytometry data. ACDC represents a new framework that seamlessly integrates all the pieces to automate the process for estimating occurrences of canonical cell populations. We evaluated ACDC using three benchmark datasets (AML (<xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>), BMMC (<xref rid="btx054-B5" ref-type="bibr">Bendall <italic>et al.</italic>, 2011</xref>; <xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>) and PANORAMA (<xref rid="btx054-B24" ref-type="bibr">Samusik <italic>et al.</italic>, 2016</xref>), for which manual gating information was available to provide a ‘ground truth’ reference.</p>
  </sec>
  <sec>
    <title>2 Methods</title>
    <p>Annotating individual cells requires reconciling the vast amounts of single cell information collected through high-throughput cytometry with our prior knowledge. To illustrate this point, it is well established that a CD4+ T-cell is identified based on high levels of CD3 and CD4 and simultaneously having low expression level of CD8. We designed ACDC to take advantage of the biological knowledge that humans have accumulated and integrate this information with machine learning algorithms to automate the annotation of mass cytometry data.</p>
    <p>To combine our prior biological frameworks with new data, the ACDC approach involves two steps (<xref ref-type="fig" rid="btx054-F1">Fig. 1A</xref> and <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S1</xref><bold>).</bold> First, ACDC converts a user-specified table of markers and cell labels into landmark points that represent fingerprints for specific cell types in the high-dimensional space. Second, ACDC implements semi-supervised classification via random walks (<xref rid="btx054-B13" ref-type="bibr">Grady, 2006</xref>) to collect information from all the landmark points and classify events at the single-cell resolution. With ACDC, prior knowledge of canonical cell types is explicitly encoded in the user-specified table, transformed into landmark points and eventually fed into a semi-supervised learning algorithm. We summarize the workflow of ACDC in the following:</p>
    <fig id="btx054-F1" orientation="portrait" position="float">
      <label>Fig. 1</label>
      <caption>
        <p>ACDC algorithm design and validation. (<bold>A</bold>) Schematic diagram showing the work flow of ACDC. (<bold>B</bold>) Heat maps showing the average marker intensity of landmark points and manually gated populations from the AML dataset. (<bold>C</bold>) tSNE visualization of landmark points (large circles) and manually gated populations (dots)</p>
      </caption>
      <graphic xlink:href="btx054f1"/>
    </fig>
    <list list-type="order">
      <list-item>
        <p><italic>Inputs</italic>: measured mass cytometry events and a user-specified table of markers to cell types.</p>
      </list-item>
      <list-item>
        <p><bold>Generate</bold> landmark points by score matching and un-supervised clustering. (Section 2.1)</p>
      </list-item>
      <list-item>
        <p><bold>Classify</bold> single-cell events by semi-supervised learning. (Section 2.2)</p>
      </list-item>
    </list>
    <p>Study design and evaluations are presented in Section 2.3.</p>
    <sec>
      <title>2.1 Generate landmark points</title>
      <sec>
        <title>2.1.1 Design of cell type-marker table</title>
        <p>A cell type-marker table is a data matrix <inline-formula id="IE1"><mml:math id="MM1"><mml:mi>s</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math></inline-formula> whose value is either 1 (present, +), -1 (absent, -) or 0 (do not consider), where <inline-formula id="IE2"><mml:math id="MM2"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the <italic>j</italic>th cell type and <inline-formula id="IE3"><mml:math id="MM3"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the <italic>k</italic>th marker (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S1</xref>–S3). The cell type-marker table allows users to customize cell types to be detected by linking these canonical cell types to their marker profiles. For example, CD4+ T-cells are known to have high expression level of the surface markers CD3 and CD4 and low expression level of CD8. Therefore, CD4+ T-cells are described as CD3+/CD4+/CD8- cells. As another example, B-cells can be referred to as CD19+/CD3-cells. ACDC converts the user specified cell type-marker table into landmark points in the high-dimensional space.</p>
      </sec>
      <sec>
        <title>2.1.2 Design of the score function</title>
        <p>We designed the score function to match a mass cytometry event with a single cell type. Intuitively, the chance a measured event belongs to a canonical cell type is determined by the extent that the intensity profile of a cluster matches one of the pre-specified profiles. We formulated the degree of matching as the posterior probability that a marker is in the activated/inactivated state. To be precise, we first fit a two-mode Gaussian mixture model <inline-formula id="IE4"><mml:math id="MM4"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo> </mml:mo></mml:math></inline-formula>to the <italic>k</italic>th marker’s intensity distribution. While the marker intensity is one dimensional, we identified the mode of high/low intensity as the activated/inactivated state of this marker. The score of assigning an event <inline-formula id="IE5"><mml:math id="MM5"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi mathvariant="normal"> </mml:mi></mml:math></inline-formula>to a cell type <inline-formula id="IE6"><mml:math id="MM6"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is then defined by
<disp-formula id="E1"><mml:math id="MM7"><mml:mi>f</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mi>s</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi>s</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></disp-formula>
where <inline-formula id="IE7"><mml:math id="MM8"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi>s</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula> is the posterior probability of the <italic>k</italic>th marker is in state <inline-formula id="IE8"><mml:math id="MM9"><mml:mi>s</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi mathvariant="normal"> </mml:mi></mml:math></inline-formula>and <inline-formula id="IE9"><mml:math id="MM10"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the intensity of the <italic>k</italic>th marker in an event <inline-formula id="IE10"><mml:math id="MM11"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. The minimum is taken over all specified markers to ensure that all requirements are satisfied. In practice, cell types specified by a user might not be exhaustive. To detect those unspecified cells, we added an ‘unknown’ type whose score is defined by
<disp-formula id="E2"><mml:math id="MM12"><mml:mi>f</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal">u</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">k</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">w</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="italic">max</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi mathvariant="normal"> </mml:mi><mml:mi>s</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi>s</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
This quantity represents the level of uncertainty in our current knowledge since its high value indicates the low probability of assigning any specified cell types to the event <inline-formula id="IE11"><mml:math id="MM13"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>.</p>
        <p>Though <inline-formula id="IE12"><mml:math id="MM14"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> can be directly evaluated by the Gaussian mixture model, such posterior probability might not be monotonic if the Gaussian mixture model has modes of unequal variances. We instead used an approximated function
<disp-formula id="E3"><mml:math id="MM15"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>∼</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mi>w</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal"> </mml:mi><mml:mo> </mml:mo><mml:mtext>exp</mml:mtext><mml:mo> </mml:mo><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mi>w</mml:mi><mml:mo>-</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:mo> </mml:mo><mml:mtext>exp</mml:mtext><mml:mo> </mml:mo><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mi>w</mml:mi><mml:mo>-</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfrac></mml:math></disp-formula>
where <inline-formula id="IE13"><mml:math id="MM16"><mml:mi>a</mml:mi></mml:math></inline-formula> is the critical point that <inline-formula id="IE14"><mml:math id="MM17"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula> and <inline-formula id="IE15"><mml:math id="MM18"><mml:mi>b</mml:mi></mml:math></inline-formula> is the slope of the posterior probability at this critical point. Both <inline-formula id="IE16"><mml:math id="MM19"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula id="IE17"><mml:math id="MM20"><mml:mi>b</mml:mi></mml:math></inline-formula> can be computed from the means and variances of the two-mode Gaussian mixture model.</p>
      </sec>
      <sec>
        <title>2.1.3 Unsupervised clustering</title>
        <p>Community detection (<xref rid="btx054-B12" ref-type="bibr">Girvan and Newman, 2002</xref>) was used due to its superior performance in clustering mass cytometry data (<xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>). The community detection aims to find a set of assignments <inline-formula id="IE18"><mml:math id="MM21"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo> </mml:mo></mml:math></inline-formula>that maximize the modularity <italic>Q</italic> defined by
<disp-formula id="E4"><mml:math id="MM22"><mml:mi>Q</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>m</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>m</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow></mml:mrow><mml:mo>δ</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math></disp-formula>
where <inline-formula id="IE19"><mml:math id="MM23"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the weights between <italic>i</italic>th node and <italic>j</italic>th node, <inline-formula id="IE20"><mml:math id="MM24"><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE21"><mml:math id="MM25"><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>. <inline-formula id="IE22"><mml:math id="MM26"><mml:mo>δ</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> is the Krnoecker delta function that takes values of 1 when <inline-formula id="IE23"><mml:math id="MM27"><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:mo> </mml:mo><mml:mi>v</mml:mi></mml:math></inline-formula> and 0 otherwise. <inline-formula id="IE24"><mml:math id="MM28"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the community assignment of <italic>i</italic>th node. We used the recommended setting to generate the weight matrix <inline-formula id="IE25"><mml:math id="MM29"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> based on 30-nearest neighbor graph and Jaccard similarity (<xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>).</p>
      </sec>
      <sec>
        <title>2.1.4 Landmark point generation</title>
        <p>To generate landmark points, we partitioned the whole dataset into subsets <inline-formula id="IE26"><mml:math id="MM30"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo> </mml:mo><mml:mo>|</mml:mo><mml:mo> </mml:mo><mml:mi>f</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>&gt;</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>}</mml:mo></mml:math></inline-formula>. Landmark points were defined as the centers of clusters identified by community detection in each subset.</p>
      </sec>
    </sec>
    <sec>
      <title>2.2 Single-cell classification by semi-supervised learning</title>
      <sec>
        <title>2.2.1 Classification by random walkers</title>
        <p>We implemented semi-supervised classification via random walks (<xref rid="btx054-B13" ref-type="bibr">Grady, 2006</xref>) for classifying events at the single-cell resolution. Briefly, semi-supervised classification via random walks evaluates the probability that a data point <inline-formula id="IE27"><mml:math id="MM31"><mml:mi>x</mml:mi></mml:math></inline-formula> belongs to class <inline-formula id="IE28"><mml:math id="MM32"><mml:mi>c</mml:mi></mml:math></inline-formula> as the chance of a random walker, starting from the data point <inline-formula id="IE29"><mml:math id="MM33"><mml:mi>x</mml:mi></mml:math></inline-formula>, first reaches a landmark point <inline-formula id="IE30"><mml:math id="MM34"><mml:mi>l</mml:mi></mml:math></inline-formula> of class <inline-formula id="IE31"><mml:math id="MM35"><mml:mi>c</mml:mi></mml:math></inline-formula> when navigating the network. Theoretical derivation shows this probability satisfies the Laplace equation, i.e.
<disp-formula id="E5"><mml:math id="MM36"><mml:mo>∇</mml:mo><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>|</mml:mo><mml:mi>c</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo></mml:math></disp-formula>
with the boundary conditions <inline-formula id="IE32"><mml:math id="MM37"><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>|</mml:mo><mml:mi>c</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> if a landmark point <inline-formula id="IE33"><mml:math id="MM38"><mml:mi>l</mml:mi></mml:math></inline-formula> of class <inline-formula id="IE34"><mml:math id="MM39"><mml:mi>c</mml:mi></mml:math></inline-formula> and <inline-formula id="IE35"><mml:math id="MM40"><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mi>l</mml:mi><mml:mo>|</mml:mo><mml:mi>c</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula> if a landmark point <inline-formula id="IE36"><mml:math id="MM41"><mml:mi>l</mml:mi></mml:math></inline-formula> of other classes. The numeric value of <inline-formula id="IE37"><mml:math id="MM42"><mml:mi>P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>x</mml:mi><mml:mo>|</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> at every data point can be solved as a boundary value problem. In our implementation, we used 10-nearest neighbors to construct such a data network.</p>
      </sec>
      <sec>
        <title>2.2.2 Processing experiments with multiple replicates</title>
        <p>A common experimental design with mass cytometry data is to measure multiple biological examples of a particular type (e.g. organism, tissue, treatment condition) in one experiment. To classify data from these replicate samples on a common basis, we computed a common set of landmark points using pooled data of all replications and then classify each replication independently with the same landmark points. Cell frequencies were then estimated by counting the classification results.</p>
      </sec>
    </sec>
    <sec>
      <title>2.3 Study design and benchmarking</title>
      <sec>
        <title>2.3.1 Validation datasets</title>
        <p>We used three public benchmark datasets. BMMC dataset is a mass cytometry dataset collected from healthy human bone marrow (<xref rid="btx054-B5" ref-type="bibr">Bendall <italic>et al.</italic>, 2011</xref>). While 34 parameters were originally measured, the publically available dataset reduced to only 13 markers, and the resulting dataset included 24 populations gated based on these markers (<xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>). AML dataset is also collected from healthy human bone marrow (<xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>), and consists of 32 markers and 14 manually gated classes. PANORAMA dataset is a recently published dataset that provides replicative measurements of mass cytometry data from mice, where 24 cellular populations were gated based on 38 surface markers (<xref rid="btx054-B24" ref-type="bibr">Samusik <italic>et al.</italic>, 2016</xref>). Three experts independently gated the cellular populations in the PANORAMA dataset and only the consensus part of the gating was retained. All event measurements were transformed by <inline-formula id="IE38"><mml:math id="MM43"><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>sinh</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo><mml:mo>/</mml:mo><mml:mn>5</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo> </mml:mo></mml:math></inline-formula>before further processing (<xref rid="btx054-B24" ref-type="bibr">Samusik <italic>et al.</italic>, 2016</xref>).</p>
        <p>Cell type-marker tables were generated according to previous studies (<xref rid="btx054-B5" ref-type="bibr">Bendall <italic>et al.</italic>, 2011</xref>; <xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>; <xref rid="btx054-B24" ref-type="bibr">Samusik <italic>et al.</italic>, 2016</xref>). The cell type–marker tables of the BMMC and AML dataset were generated based on their gating hierarchy provided on Cytobank (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S1 and S2</xref>). In BMMC dataset, erythroblast, megakaryocyte platelet and myelocyte were merged as an unknown population since negative markers exclusively define these cells. For the PANORAMA dataset, the cell type-marker table was generated based on the divisive marker tree with minor changes (<xref rid="btx054-B24" ref-type="bibr">Samusik <italic>et al.</italic>, 2016</xref>) (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S3</xref>). We excluded HSC cells and pro B cells as unknown types since their defining markers cannot be determined from the reported divisive marker tree.</p>
      </sec>
      <sec>
        <title>2.3.2 Baseline methods</title>
        <p>We implemented (i) score-based classification; and (ii) phenograph clustering (<xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>) for performance benchmarking. The score-based classification assigns event <inline-formula id="IE39"><mml:math id="MM44"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> to the class <inline-formula id="IE40"><mml:math id="MM45"><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> that maximizes the score, i.e.
<disp-formula id="E6"><mml:math id="MM46"><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">*</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mi>f</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo></mml:math></disp-formula>
where <inline-formula id="IE41"><mml:math id="MM47"><mml:mi>f</mml:mi></mml:math></inline-formula> is the designed score function. For the phenograph clustering, data was first clustered by community detection and then all events within a cluster were assigned to a manually gated cell type of highest frequency in this cluster. This method was implemented as a counterpart of estimating population frequencies by unsupervised clustering.</p>
      </sec>
      <sec>
        <title>2.3.3 Evaluation metrics</title>
        <p>We applied three metrics to evaluate the performance on estimating cellular population frequencies. Given two normalized histograms <inline-formula id="IE42"><mml:math id="MM48"><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE43"><mml:math id="MM49"><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, generated by counting the number of each cellular category classified either manually or automatically, the maximum error is computed by taking maximum of absolute errors on all components. To be precise, the maximum error is defined by
<disp-formula id="E7"><mml:math id="MM50"><mml:mi>d</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>|</mml:mo><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
where <inline-formula id="IE44"><mml:math id="MM51"><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE45"><mml:math id="MM52"><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are <italic>i</italic>th elements of histograms <inline-formula id="IE46"><mml:math id="MM53"><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE47"><mml:math id="MM54"><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, respectively. The Canberra distance is defined by
<disp-formula id="E8"><mml:math id="MM55"><mml:mi>d</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mrow><mml:mrow><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>
This distance is chosen to estimate the capability of capturing rare populations since it gives higher penalty on the low-frequency populations. Lastly, the intersection distance, defined by 
<disp-formula id="IE48"><mml:math id="MM56"><mml:mi>d</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="italic">sum</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="italic">min</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula>
measures the difference between the common area underlying two histograms and 1, which is the largest possible common area. The intersection distance reflects the accumulative errors in all populations.</p>
        <p>The accuracy of classifying single-cell events is measured by the F1-score, which reflects the harmonic mean of precision (purity) and recall (yield),
<disp-formula id="E9"><mml:math id="MM57"><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></disp-formula><disp-formula id="E10"><mml:math id="MM58"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi mathvariant="normal">k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi mathvariant="normal">k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="normal">C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">k</mml:mi><mml:mi mathvariant="normal">j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></disp-formula>
where <inline-formula id="IE49"><mml:math id="MM59"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the number of events classified as population <italic>i</italic> that belongs to the manually gated population <italic>j</italic>.</p>
      </sec>
      <sec>
        <title>2.3.4 Confidence estimation</title>
        <p>For validation on AML and BMMC datasets, the confidence level was estimated using 5-fold cross validation while keeping the percentage of samples for each class unchanged. For the PANORAMA dataset, confidence level was estimated as the standard deviation over samples.</p>
      </sec>
      <sec>
        <title>2.3.5 Measuring tightness of clusters</title>
        <p>We used the silhouette coefficient to measure the tightness of a given cluster (<xref rid="btx054-B23" ref-type="bibr">Rousseeuw, 1987</xref>). The silhouette coefficient measures how similar a datum is to its own cluster compared to the other clusters. For the <italic>i</italic>th datum, silhouette coefficient of this datum is defined as
<disp-formula id="E11"><mml:math id="MM60"><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal"> </mml:mi><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></disp-formula>
where <inline-formula id="IE50"><mml:math id="MM61"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the average Euclidean distance from this datum to other members of the same cluster, and <inline-formula id="IE51"><mml:math id="MM62"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the lowest average distance from this datum to members of other clusters. The silhouette coefficient ranges from -1 to 1 while a negative silhouette coefficient indicates a datum is closer to other clusters than its own cluster.</p>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>3 Results</title>
    <sec>
      <title>3.1 ACDC helps visualization of mass cytometry data</title>
      <p>To test whether the detected landmark points represent the corresponding cellular populations, we first applied ACDC to the AML and BMMC datasets. In the AML dataset, ACDC identified every population highlighted in the study and showed virtually no difference with manual gating (<xref ref-type="fig" rid="btx054-F1">Fig. 1B</xref>). The one exception was a population of CD34 + CD38 + CD123+ HSPCs that showed a lower average intensity of CD123 in ACDC than with manually gating. To examine how landmark points depicted cellular populations, we used tSNE (<xref rid="btx054-B16" ref-type="bibr">Van der Maaten and Hinton, 2008</xref>) to map cellular measurements sampled from the manually gated populations onto a two-dimensional space and displayed the detected landmark points in their respective coordinates (<xref ref-type="fig" rid="btx054-F1">Fig. 1C</xref>). The tSNE projection also supports the observation that landmark points detected by ACDC fall within their corresponding cluster of cells. We found similar results in the BMMC dataset (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S2</xref>). These results confirm that landmark points can locate cellular populations as accurate as manual gating.</p>
    </sec>
    <sec>
      <title>3.2 ACDC classifies canonical cell populations as accurate as human experts</title>
      <p>Although landmark points aid the exploratory analysis of mass cytometry data, the focus of this study was to evaluate whether landmark points classify events accurately at single-cell resolution. For comparison, we implemented two alternative classification methods: (i) a score-based classification that assigns an event to the class of the highest score and (ii) phenograph (<xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>) clustering combined with manual gating to annotate each cluster. Overall, ACDC achieved comparable accuracy (92.9 ± 0.5% for BMMC and 98.3 ± 0.04% for AML) on classifying single-cell events with phenograph clustering (93.6 ± 0.7% for BMMC and 96.5 ± 0.7% for AML) and significantly improved the score-based classification method (78.1 ± 0.03% for BMMC and 68.4 ± 0.1% for AML). We also analyzed the classification performance for each cell type (<xref ref-type="fig" rid="btx054-F2">Fig. 2A and E</xref>). In the AML dataset, ACDC achieved a median F1-score of 0.93, compared with 0.84 for the score-based classification and 0.83 for the phenograph clustering. We observed a lower performance of ACDC in the BMMC dataset (median F1-score of 0.60, compared with 0.63 for the score-based classification, and 0.55 for the phenograph clustering) due to the difficulty in detecting rare populations with frequencies less than 0.5%, such as GMP, HSC, MEP and MPP. However, low silhouette coefficients suggest that these rare populations may not form well-defined clusters (<xref ref-type="fig" rid="btx054-F2">Fig. 2B and F</xref> and <xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S3</xref>). Both the score-based and phenograph clustering methods also failed to identify these rare populations due to a lack of representative data for these cell types.</p>
      <fig id="btx054-F2" orientation="portrait" position="float">
        <label>Fig. 2</label>
        <caption>
          <p>Validation on AML and BMMC datasets. (<bold>A, E</bold>) Classification accuracy of ACDC (yellow bars), score-based classification (purple bars), and phenograph clustering (gray bars) evaluated by F1-score. (<bold>B, F</bold>) Silhouette coefficients of manually gated populations show cluster tightness. (<bold>C, G</bold>) Comparison of population frequencies estimated by the 3 methods versus manual gating (green bars). (<bold>D, H</bold>) Errors in estimating population frequencies. Error bars reflect the standard deviations of the accuracy estimates from the cross-validation trials described in Section 2.3.4</p>
        </caption>
        <graphic xlink:href="btx054f2"/>
      </fig>
    </sec>
    <sec>
      <title>3.3 ACDC estimates frequencies of canonical cell populations as accurate as human experts</title>
      <p>We next addressed the practical issue of estimating the frequency of a cell population. When applied to the AML and BMMC datasets, ACDC and the phenograph clustering gave estimates comparable to the manually gated ones while the score-based classification method overestimated the frequency of the unknown population (<xref ref-type="fig" rid="btx054-F2">Fig. 2C and G</xref>). To quantify discrepancies between the estimated and manually gated frequencies in all populations, we examined three common metrics: maximum error, Canberra distance, and intersection distance, which measure maximum deviations, the capability of capturing rare populations and accumulative errors respectively. In general, both ACDC and the phenograph clustering estimated the population frequency up to 2% maximum error of manual gating reports and 2–5% error accumulatively on these two datasets (<xref ref-type="fig" rid="btx054-F2">Fig. 2D and H</xref>). However, ACDC showed a lower Canberra distance to manual gating, highlighting lower discrepancy for rare populations.</p>
    </sec>
    <sec>
      <title>3.4 ACDC captures sample variations in population frequencies</title>
      <p>In addition to evaluating the classification accuracy using data collected from one set of samples, we wondered if ACDC captured variations accurately over biological replicates in the PANORAMA dataset (<xref ref-type="fig" rid="btx054-F3">Fig. 3A</xref>). We computed correlations between estimated and manually gated frequencies per cell type (<xref ref-type="fig" rid="btx054-F3">Fig. 3B</xref>). ACDC achieved an average per-cell type correlation of 0.79, compared to the correlation of 0.71 for the score-based classification and 0.38 for phenograph clustering. Regarding classifying single-cell events, ACDC achieved a median F1-score of 0.88 (<xref ref-type="fig" rid="btx054-F3">Fig. 3C</xref>) compared to 0.79 obtained in the original study (<xref rid="btx054-B24" ref-type="bibr">Samusik <italic>et al.</italic>, 2016</xref>), though two cell types were omitted due to the lack of defining markers when curating the input table for ACDC (see <bold>Methods</bold> for full details). These results confirm that ACDC more accurately captures sample variations reflected in the manually gated results.</p>
      <fig id="btx054-F3" orientation="portrait" position="float">
        <label>Fig. 3</label>
        <caption>
          <p>Validation on PANORAMA dataset. (<bold>A</bold>) Frequencies of cellular populations estimated by manual gating (green bars), ACDC (yellow bars), scored-based classification (purple bars) and phenograph clustering (gray bars). All events excluded by manual gating were labeled ‘unknown.’ (<bold>B</bold>) Per-cell type Pearson correlations over 10 replications. (<bold>C</bold>) Average F1-scores over 10 replications. Error bars represent standard deviations</p>
        </caption>
        <graphic xlink:href="btx054f3"/>
      </fig>
    </sec>
    <sec>
      <title>3.5 ACDC discovers ambiguous populations from mass cytometry data</title>
      <p>One challenge for supervised learning approaches is the limited ability to discover categories not present in the training data. Here we demonstrate that ACDC provides insight on clusters of cells that do not fit into any of the pre-defined cell types. Specifically, 24 clusters of unknown cell types detected from the PANORAMA dataset (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S4</xref>). We found that one of the unknown clusters showed marker patterns similar to both IgD + IgM+ B-cells and CD8+ T cells (<xref ref-type="fig" rid="btx054-F4">Fig. 4A</xref>). This profile suggests the unknown cluster represents some form of lymphoid cells sharing characteristics of B cells and CD8 T cells. We also found a cluster of unknown cell types that shared features of IgD + IgM+ B cells and CD4+ T cells, and cannot be easily categorized into conventional types (<xref ref-type="fig" rid="btx054-F4">Fig. 4B</xref>). Though we cannot exclude the possibility these events are doublets that slipped though the pre-gating quality control carried out in (<xref rid="btx054-B24" ref-type="bibr">Samusik <italic>et al.</italic>, 2016</xref>) (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S5</xref>), these results demonstrated that ACDC can highlight ambiguous events that escaped the automated classification for further investigation. However, resolving the biological identity of these events may require utilization of collaborative evidence.</p>
      <fig id="btx054-F4" orientation="portrait" position="float">
        <label>Fig. 4</label>
        <caption>
          <p>Illustration of selected unknown clusters. (<bold>A</bold>) Two-dimensional heatmap shows the profile of an unknown cluster sharing features of CD8+ T cells, IgD + IgM+ B cells and gamma-delta T cells (rows shown below). Colors reflect the marker intensity. (<bold>B</bold>) Heatmap indicates the profile of an unknown cluster sharing features of CD4+ T cells and IgD + IgM+ B cells (rows shown below). The top-3 similar canonical populations are shown right below the unknown cluster</p>
        </caption>
        <graphic xlink:href="btx054f4"/>
      </fig>
    </sec>
    <sec>
      <title>3.6 Robustness and computational complexity</title>
      <p>We evaluated whether ACDC is robust to changes in the parameter tuning. ACDC uses one parameter <italic>k</italic> to construct nearest neighbor networks for semi-supervised classification. <xref rid="btx054-T1" ref-type="table">Table 1</xref> shows the classification accuracy evaluated on the BMMC and AML benchmark datasets when setting <italic>k</italic> to 10, 20 and 30. The results are not sensitive to the parameter <italic>k</italic> over a 3-fold range.
<table-wrap id="btx054-T1" orientation="portrait" position="float"><label>Table 1</label><caption><p>Computational performance of ACDC</p></caption><table frame="hsides" rules="groups"><colgroup span="1"><col valign="top" align="left" span="1"/><col valign="top" align="char" char="." span="1"/><col valign="top" align="char" char="." span="1"/><col valign="top" align="char" char="." span="1"/><col valign="top" align="char" char="." span="1"/><col valign="top" align="char" char="." span="1"/><col valign="top" align="char" char="." span="1"/><col valign="top" align="char" char="." span="1"/></colgroup><thead><tr><th rowspan="1" colspan="1"/><th colspan="3" align="center" rowspan="1">Accuracy (%)</th><th colspan="3" align="center" rowspan="1">Time (s)</th><th rowspan="1" colspan="1">Events</th></tr></thead><tbody><tr><td rowspan="1" colspan="1">k-nn</td><td rowspan="1" colspan="1">10</td><td rowspan="1" colspan="1">20</td><td rowspan="1" colspan="1">30</td><td rowspan="1" colspan="1">10</td><td rowspan="1" colspan="1">20</td><td rowspan="1" colspan="1">30</td><td rowspan="1" colspan="1"/></tr><tr><td rowspan="1" colspan="1">BMMC</td><td rowspan="1" colspan="1">92.02</td><td rowspan="1" colspan="1">92.24</td><td rowspan="1" colspan="1">92.49</td><td rowspan="1" colspan="1">245</td><td rowspan="1" colspan="1">309</td><td rowspan="1" colspan="1">376</td><td rowspan="1" colspan="1">81747</td></tr><tr><td rowspan="1" colspan="1">AML</td><td rowspan="1" colspan="1">98.36</td><td rowspan="1" colspan="1">98.30</td><td rowspan="1" colspan="1">98.25</td><td rowspan="1" colspan="1">884</td><td rowspan="1" colspan="1">992</td><td rowspan="1" colspan="1">1077</td><td rowspan="1" colspan="1">103184</td></tr></tbody></table></table-wrap></p>
      <p>We also examined the computational complexity of ACDC. The most expensive computational step in ACDC is the semi-supervised classification, which involves constructing and inverting a large matrix. In our current implementation, ACDC takes ∼250 and ∼900 seconds to process BMMC and AML benchmarks (<xref rid="btx054-T1" ref-type="table"><bold>Table 1</bold></xref>). This computation was done on a machine with an Intel<sup>®</sup> Core™ i7-6700K Processor 3.40 GHz and 16 GB RAM. By comparison, it takes ∼125 and ∼550 s to cluster the BMMC and AML datasets using Phenograph on the same machine.</p>
    </sec>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>Here we have introduced a new method called ACDC that combines profile matching and semi-supervised learning to automate the analysis and interpretation of mass cytometry data. ACDC takes advantage of biological knowledge to guide learning algorithms and creates a new framework for interpreting data from high-dimensional cytometry. By using biological knowledge as an input for the analysis, we turned the unsupervised problem of data interpretation into a semi-supervised problem of network propagation. Our results suggest ACDC reliably classifies single-cell events and aids discovery of novel cell types.</p>
    <p>One limitation of ACDC is that each marker label is binary (present or absent). In practice, cell populations of interests are defined by intermediate markers (<xref rid="btx054-B14" ref-type="bibr">Guilliams <italic>et al.</italic>, 2014</xref>; <xref rid="btx054-B15" ref-type="bibr">Levine <italic>et al.</italic>, 2015</xref>; <xref rid="btx054-B20" ref-type="bibr">Ohradanova-Repic <italic>et al.</italic>, 2016</xref>; <xref rid="btx054-B22" ref-type="bibr">Rosenblum <italic>et al.</italic>, 2016</xref>). One possible improvement is to extend the Gaussian mixture model and consider multiple states (<xref rid="btx054-B7" ref-type="bibr">Chan <italic>et al.</italic>, 2008</xref>; <xref rid="btx054-B9" ref-type="bibr">Cron <italic>et al.</italic>, 2013</xref>), and we anticipate this development in a future study.</p>
    <p>Given the active development of many algorithms to facilitate the processing and analysis of high-throughput cytometry data, recent efforts have also been focused on developing reproducible pipelines and frameworks (<xref rid="btx054-B1" ref-type="bibr">Aghaeepour <italic>et al.</italic>, 2013</xref>, <xref rid="btx054-B2" ref-type="bibr">2016</xref>; <xref rid="btx054-B10" ref-type="bibr">Finak <italic>et al.</italic>, 2014</xref>). The introduction of a study-specific table with markers and cell labels offers a new direction toward automatic and reproducible analysis of mass cytometry data. With this easy-to-customize design, the annotation step feeds into cytometry data analysis upfront. This feature allows the cellular determinations to be reproduced or modified easily with a given cell type–marker table. Additionally, flagging ambiguous events help sift through the massive data to guide researchers for follow up on areas of quality control and process improvement, as well as the discovery of biologically relevant cell populations.</p>
    <p>Currently, our design requires a table specified by the analyst. However, there’s no limit to what information goes into this table. Thus, it’s possible to infer a comprehensive table automatically from the complete biomedical literature mining (<xref rid="btx054-B8" ref-type="bibr">Courtot <italic>et al.</italic>, 2015</xref>; <xref rid="btx054-B26" ref-type="bibr">Shen-Orr <italic>et al.</italic>, 2009</xref>) or through a targeted query of an immunological database (<xref rid="btx054-B8" ref-type="bibr">Courtot <italic>et al.</italic>, 2015</xref>). The community has long recognized the importance of reliable immunophenotyping analysis in flow cytometry (<xref rid="btx054-B1" ref-type="bibr">Aghaeepour <italic>et al.</italic>, 2013</xref>; <xref rid="btx054-B11" ref-type="bibr">Finak <italic>et al.</italic>, 2016</xref>). Additional efforts to integrate existing tools into shared computational pipelines for better CyTOF processing and cell type enumeration are needed. With the removal of the manual processing steps that currently limit large-scale CyTOF analysis, we envision ACDC as a step toward a new paradigm of reproducible, systematic and objective immunophenotyping that fully embraces high-dimensional datasets for discovery and translation to actionable insights.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>Supplementary Data</label>
      <media xlink:href="btx054_supp.docx">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgements</title>
    <p>We thank B. Readhead, A. Rahman, V. Leshchenko and S. Parekh for helpful discussions of this manuscript. The authors declare no competing financial interests.</p>
    <sec>
      <title>Funding</title>
      <p>This work was supported by a Postdoctoral Fellowship from GlaxoSmithKline (to HCL), a generous gift from The Steven and Alexandra Cohen Foundation (to BAK &amp; JTD), as well as grants from the National Institutes of Health (R01DK098242, U54CA189201 to JTD).</p>
      <p><italic>Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="btx054-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Aghaeepour</surname><given-names>N.</given-names></name></person-group><etal>et al</etal> (<year>2013</year>) 
<article-title>Critical assessment of automated flow cytometry data analysis techniques</article-title>. <source>Nat. Methods</source>, <volume>10</volume>, <fpage>228</fpage>–<lpage>238</lpage>.<pub-id pub-id-type="pmid">23396282</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Aghaeepour</surname><given-names>N.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>A benchmark for evaluation of algorithms for identification of cellular correlates of clinical outcomes</article-title>. <source>Cytom. Part A</source>, <volume>89</volume>, <fpage>16</fpage>–<lpage>21</lpage>.</mixed-citation>
    </ref>
    <ref id="btx054-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Amir</surname><given-names>E.D.</given-names></name></person-group><etal>et al</etal> (<year>2013</year>) 
<article-title>viSNE enables visualization of high dimensional single-cell data and reveals phenotypic heterogeneity of leukemia</article-title>. <source>Nat. Biotechnol</source>., <volume>31</volume>, <fpage>545</fpage>–<lpage>552</lpage>.<pub-id pub-id-type="pmid">23685480</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bandura</surname><given-names>D.R.</given-names></name></person-group><etal>et al</etal> (<year>2009</year>) 
<article-title>Mass cytometry: technique for real time single cell multitarget immunoassay based on inductively coupled plasma time-of-flight mass spectrometry</article-title>. <source>Anal. Chem</source>., <volume>81</volume>, <fpage>6813</fpage>–<lpage>6822</lpage>.<pub-id pub-id-type="pmid">19601617</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bendall</surname><given-names>S.C.</given-names></name></person-group><etal>et al</etal> (<year>2011</year>) 
<article-title>Single-cell mass cytometry of differential immune and drug responses across a human hematopoietic continuum</article-title>. <source>Science</source>, <volume>332</volume>, <fpage>687</fpage>–<lpage>696</lpage>.<pub-id pub-id-type="pmid">21551058</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bodenmiller</surname><given-names>B.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>Multiplexed mass cytometry profiling of cellular states perturbed by small-molecule regulators</article-title>. <source>Nat. Biotechnol</source>., <volume>30</volume>, <fpage>858</fpage>–<lpage>867</lpage>.<pub-id pub-id-type="pmid">22902532</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Chan</surname><given-names>C.</given-names></name></person-group><etal>et al</etal> (<year>2008</year>) 
<article-title>Statistical mixture modeling for cell subtype identification in flow cytometry</article-title>. <source>Cytometry A</source>, <volume>73</volume>, <fpage>693</fpage>–<lpage>701</lpage>.<pub-id pub-id-type="pmid">18496851</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Courtot</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>flowCL: ontology-based cell population labelling in flow cytometry</article-title>. <source>Bioinformatics</source>, <volume>31</volume>, <fpage>1337</fpage>–<lpage>1339</lpage>.<pub-id pub-id-type="pmid">25481008</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cron</surname><given-names>A.</given-names></name></person-group><etal>et al</etal> (<year>2013</year>) 
<article-title>Hierarchical modeling for rare event detection and cell subset alignment across flow cytometry samples</article-title>. <source>PLoS Comput. Biol</source>., <volume>9</volume>, <fpage>e1003130.</fpage><pub-id pub-id-type="pmid">23874174</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Finak</surname><given-names>G.</given-names></name></person-group><etal>et al</etal> (<year>2014</year>) 
<article-title>OpenCyto: An open source infrastructure for scalable, robust, reproducible, and automated, end-to-end flow cytometry data analysis</article-title>. <source>PLoS Comput. Biol</source>., <volume>10</volume>, <fpage>e1003806</fpage>.<pub-id pub-id-type="pmid">25167361</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Finak</surname><given-names>G.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Standardizing Flow Cytometry Immunophenotyping Analysis from the Human ImmunoPhenotyping Consortium</article-title>. <source>Sci. Rep</source>., <volume>6</volume>., 20686</mixed-citation>
    </ref>
    <ref id="btx054-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Girvan</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Newman</surname><given-names>M.E.J.</given-names></name></person-group> (<year>2002</year>) 
<article-title>Community structure in social and biological networks</article-title>. <source>Proc. Natl. Acad. Sci. U. S. A</source>., <volume>99</volume>, <fpage>7821</fpage>–<lpage>7826</lpage>.<pub-id pub-id-type="pmid">12060727</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Grady</surname><given-names>L.</given-names></name></person-group> (<year>2006</year>) 
<article-title>Random walks for image segmentation</article-title>. <source>Pattern Anal. Mach. Intell. IEEE Trans</source>., <volume>28</volume>, <fpage>1768</fpage>–<lpage>1783</lpage>.</mixed-citation>
    </ref>
    <ref id="btx054-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Guilliams</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2014</year>) 
<article-title>Dendritic cells, monocytes and macrophages: a unified nomenclature based on ontogeny</article-title>. <source>Nat. Rev. Immunol</source>., <volume>14</volume>, <fpage>571</fpage>–<lpage>578</lpage>.<pub-id pub-id-type="pmid">25033907</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Levine</surname><given-names>J.H.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>Data-driven phenotypic dissection of AML reveals progenitor-like cells that correlate with prognosis</article-title>. <source>Cell</source>, <volume>162</volume>, <fpage>184</fpage>–<lpage>197</lpage>.<pub-id pub-id-type="pmid">26095251</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Van der Maaten</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Hinton</surname><given-names>G.</given-names></name></person-group> (<year>2008</year>) 
<article-title>Visualizing data using t-SNE</article-title>. <source>J. Mach. Learn. Res</source>., <volume>9</volume>, <fpage>85.</fpage></mixed-citation>
    </ref>
    <ref id="btx054-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Newell</surname><given-names>E.W.</given-names></name></person-group><etal>et al</etal> (<year>2013</year>) 
<article-title>Combinatorial tetramer staining and mass cytometry analysis facilitate T-cell epitope mapping and characterization</article-title>. <source>Nat. Biotechnol</source>., <volume>31</volume>, <fpage>623</fpage>–<lpage>629</lpage>.<pub-id pub-id-type="pmid">23748502</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Newell</surname><given-names>E.W.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>Cytometry by time-of-flight shows combinatorial cytokine expression and virus-specific cell niches within a continuum of CD8+ T cell phenotypes</article-title>. <source>Immunity</source>, <volume>36</volume>, <fpage>142</fpage>–<lpage>152</lpage>.<pub-id pub-id-type="pmid">22265676</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Newell</surname><given-names>E.W.</given-names></name>, <name name-style="western"><surname>Cheng</surname><given-names>Y.</given-names></name></person-group> (<year>2016</year>) 
<article-title>Mass cytometry: blessed with the curse of dimensionality</article-title>. <source>Nat. Immunol</source>., <volume>17</volume>, <fpage>890</fpage>–<lpage>895</lpage>.<pub-id pub-id-type="pmid">27434000</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ohradanova-Repic</surname><given-names>A.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Differentiation of human monocytes and derived subsets of macrophages and dendritic cells by the HLDA10 monoclonal antibody panel</article-title>. <source>Clin. Transl. Immunol</source>., <volume>5</volume>, <fpage>e55.</fpage></mixed-citation>
    </ref>
    <ref id="btx054-B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Qiu</surname><given-names>P.</given-names></name></person-group><etal>et al</etal> (<year>2011</year>) 
<article-title>Extracting a cellular hierarchy from high-dimensional cytometry data with SPADE</article-title>. <source>Nat. Biotechnol</source>., <volume>29</volume>, <fpage>886</fpage>–<lpage>891</lpage>.<pub-id pub-id-type="pmid">21964415</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Rosenblum</surname><given-names>M.D.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Regulatory T cell memory</article-title>. <source>Nat. Rev. Immunol</source>., <volume>16</volume>, <fpage>90</fpage>–<lpage>101</lpage>.<pub-id pub-id-type="pmid">26688349</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Rousseeuw</surname><given-names>P.J.</given-names></name></person-group> (<year>1987</year>) 
<article-title>Silhouettes: A graphical aid to the interpretation and validation of cluster analysis</article-title>. <source>J. Comput. Appl. Math</source>., <volume>20</volume>, <fpage>53</fpage>–<lpage>65</lpage>.</mixed-citation>
    </ref>
    <ref id="btx054-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Samusik</surname><given-names>N.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Automated mapping of phenotype space with single-cell data</article-title>. <source>Nat. Methods</source>, <volume>13</volume>, <fpage>493</fpage>–<lpage>496</lpage>.<pub-id pub-id-type="pmid">27183440</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Shekhar</surname><given-names>K.</given-names></name></person-group><etal>et al</etal> (<year>2014</year>) 
<article-title>Automatic classification of cellular expression by nonlinear stochastic embedding (ACCENSE)</article-title>. <source>Proc. Natl. Acad. Sci. U. S. A</source>., <volume>111</volume>, <fpage>202</fpage>–<lpage>207</lpage>.<pub-id pub-id-type="pmid">24344260</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Shen-Orr</surname><given-names>S.S.</given-names></name></person-group><etal>et al</etal> (<year>2009</year>) 
<article-title>Towards a cytokine-cell interaction knowledgebase of the adaptive immune system</article-title>. <source>Pac. Symp. Biocomput</source>., <fpage>439</fpage>–<lpage>450</lpage>.<pub-id pub-id-type="pmid">19209721</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Spitzer</surname><given-names>M.H.</given-names></name>, <name name-style="western"><surname>Nolan</surname><given-names>G.P.</given-names></name></person-group> (<year>2016</year>) 
<article-title>Mass cytometry: single cells, many features</article-title>. <source>Cell</source>, <volume>165</volume>, <fpage>780</fpage>–<lpage>791</lpage>.<pub-id pub-id-type="pmid">27153492</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wong</surname><given-names>M.T.</given-names></name></person-group><etal>et al</etal> (<year>2016a</year>) 
<article-title>A high-dimensional atlas of human T cell diversity reveals tissue-specific trafficking and cytokine signatures</article-title>. <source>Immunity</source>, <volume>45</volume>, <fpage>442</fpage>–<lpage>456</lpage>.<pub-id pub-id-type="pmid">27521270</pub-id></mixed-citation>
    </ref>
    <ref id="btx054-B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wong</surname><given-names>M.T.</given-names></name></person-group><etal>et al</etal> (<year>2016b</year>) 
<article-title>Mapping the diversity of follicular helper T cells in human blood and tonsils using high-dimensional mass cytometry analysis</article-title>. <source>Cell Rep</source>., <volume>11</volume>, <fpage>1822</fpage>–<lpage>1833</lpage>.</mixed-citation>
    </ref>
  </ref-list>
</back>
