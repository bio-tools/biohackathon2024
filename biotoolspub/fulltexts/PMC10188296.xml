<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10188296</article-id>
    <article-id pub-id-type="pmid">37154701</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btad302</article-id>
    <article-id pub-id-type="publisher-id">btad302</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Sequence Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>STEMSIM: a simulator of within-strain short-term evolutionary mutations for longitudinal metagenomic data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0001-7067-4578</contrib-id>
        <name>
          <surname>Zhou</surname>
          <given-names>Boyan</given-names>
        </name>
        <aff><institution>Division of Biostatistics, Department of Population Health, New York University School of Medicine</institution>, New York, NY 10016, <country country="US">USA</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-8288-7068</contrib-id>
        <name>
          <surname>Li</surname>
          <given-names>Huilin</given-names>
        </name>
        <aff><institution>Division of Biostatistics, Department of Population Health, New York University School of Medicine</institution>, New York, NY 10016, <country country="US">USA</country></aff>
        <xref rid="btad302-cor1" ref-type="corresp"/>
        <!--huilin.li@nyulangone.org-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Alkan</surname>
          <given-names>Can</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btad302-cor1">Corresponding author. Division of Biostatistics, Department of Population Health, New York University School of Medicine, New York, NY 10016, USA. E-mail: <email>huilin.li@nyulangone.org</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2023-05-08">
      <day>08</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>08</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <volume>39</volume>
    <issue>5</issue>
    <elocation-id>btad302</elocation-id>
    <history>
      <date date-type="received">
        <day>21</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>29</day>
        <month>3</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>29</day>
        <month>4</month>
        <year>2023</year>
      </date>
      <date date-type="corrected-typeset">
        <day>16</day>
        <month>5</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btad302.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>As the resolution of metagenomic analysis increases, the evolution of microbial genomes in longitudinal metagenomic data has become a research focus. Some software has been developed for the simulation of complex microbial communities at the strain level. However, the tool for simulating within-strain evolutionary signals in longitudinal samples is still lacking.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>In this study, we introduce STEMSIM, a user-friendly command-line simulator of short-term evolutionary mutations for longitudinal metagenomic data. The input is simulated longitudinal raw sequencing reads of microbial communities or single species. The output is the modified reads with within-strain evolutionary mutations and the relevant information of these mutations. STEMSIM will be of great use for the evaluation of analytic tools that detect short-term evolutionary mutations in metagenomic data.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>STEMSIM and its tutorial are freely available online at <ext-link xlink:href="https://github.com/BoyanZhou/STEMSim" ext-link-type="uri">https://github.com/BoyanZhou/STEMSim</ext-link>.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Cancer Institute</institution>
            <institution-id institution-id-type="DOI">10.13039/100000054</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>P20CA252728</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Library of Medicine</institution>
            <institution-id institution-id-type="DOI">10.13039/100000092</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>1R01LM014085</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>It has been increasingly important to study within-species diversity in complex microbial communities (<xref rid="btad302-B8" ref-type="bibr">Van Rossum et al. 2020</xref>). To deepen our understanding of genotypic and phenotypic varieties at strain level, many tools have been developed for strain tracking and variants identification in metagenomic data (<xref rid="btad302-B1" ref-type="bibr">Anyansi et al. 2020</xref>). In the meantime, CAMISIM, a versatile microbial community and metagenome simulator, was designed to generate benchmark datasets (<xref rid="btad302-B3" ref-type="bibr">Fritz et al. 2019</xref>). It can simulate a wide range of highly diverse longitudinal metagenomic data with great flexibility and provide the gold standard for method evaluation.</p>
    <p>As the resolution of metagenomic analysis increases, recent studies have begun to tackle the problem of tracking microbial evolution (e.g. positive and purifying selection) in longitudinal samples (<xref rid="btad302-B10" ref-type="bibr">Yilmaz et al. 2021</xref>; <xref rid="btad302-B7" ref-type="bibr">Maddamsetti and Grant 2022</xref>). Specifically, they focus on the identification of short-term mutations or monitoring the dynamic change of allele frequencies in microbial genomes. Studying the evolution of microbial genomes will facilitate to reveal the genetic mechanism of microbial response to environment factors, such as antibiotic persistence (<xref rid="btad302-B5" ref-type="bibr">Huo et al. 2022</xref>). While metagenomics simulator (e.g. CAMISIM) has been widely used in benchmarking studies for taxonomic classifications, the tool for simulating within-strain evolutionary signals in metagenomic data is still lacking. Here, we introduce STEMSIM (short-term evolutionary mutations simulator), which can generate mutations including single nucleotide variant (SNV), insertion, and deletion (InDel) with various frequency distributions within strains in raw metagenomic sequencing data under a specified nucleotide substitution model. Thus, it provides a command-line software to generate simulated dataset to assess methods for detecting short-term evolutionary mutations in metagenomic data.</p>
  </sec>
  <sec>
    <title>2 Methods and software implementation</title>
    <p>For the existing sequencing reads simulators (<xref rid="btad302-B4" ref-type="bibr">Huang et al. 2012</xref>; <xref rid="btad302-B3" ref-type="bibr">Fritz et al. 2019</xref>), the basic idea of simulating metagenomic data is to generate raw sequencing reads from a set of microbial genomes based on the given scenarios. For example, users need to provide the genomes of multiple strains to generate within-species diversity, or provide strain genomes with the specified genetic distances to simulate long-term mutations which are fixed in the evolutionary history between strains. CAMISIM can easily perform such tasks and automatically produce varying evolutionary genome divergence. However, in this study, we focus on the within-strain mutations and de novo mutations in longitudinal metagenomes, which we refer as potential short-term evolutionary mutations (SNVs and InDels). For instance, the mutations under positive selection may have increasing allele frequencies (e.g. 0.2, 0.5, 0.8, 1) in the longitudinal samples, while the mutations under purifying selection may have decreasing allele frequencies (e.g. 0.8, 0.5, 0.3, 0) (<xref rid="btad302-B2" ref-type="bibr">Biswas and Akey 2006</xref>). In contrast to the fixed mutations, those distinct allele frequency trajectories of short-term evolutionary mutations can hardly be incorporated by the existing simulators including CAMISIM, because these simulators usually can only specify one sequencing depth for one genome, i.e. the same allele frequency trajectory for all mutations on the same genome.</p>
    <p>One possible solution is to divide the complete genome of a target strain into hundreds or thousands of fragments according to the required mutation number. Then, one can simulate different patterns of allele frequency by setting the depths of fragments to different values. However, this approach breaks the continuity of genome and is too tedious to be incorporated in the current pipelines. To deal with this problem, we develop STEMSIM which can generate potential short-term mutations in the simulated longitudinal metagenomic data. STEMSIM mainly consists of three steps: (i) align the simulated reads to their original reference genomes, (ii) determine which reads and which bases on the reads should be mutated according to the given parameters in the alignment files (sam/bam), and (iii) record the detailed information of mutations and modify the simulated reads accordingly.</p>
    <p>The workflow of STEMSIM is illustrated in <xref rid="btad302-F1" ref-type="fig">Fig. 1</xref>. STEMSIM is designed with flexible compatibility. It can handle the raw reads (fastq or unaligned bam) generated by other software (<xref rid="btad302-B4" ref-type="bibr">Huang et al. 2012</xref>) as long as their original reference genomes are provided. Since CAMISIM is a well-established and widely used pipeline which can meet the needs of most situations, in the default setting, STEMSIM directly takes the output of CAMISIM as input data. Next, the raw sequencing reads are mapped to the original reference genomes to obtain the alignment files (sam/bam) by Bowtie2 (<xref rid="btad302-B6" ref-type="bibr">Langmead and Salzberg 2012</xref>). Then, the details of mutations are generated according to the specified parameters, such as the number of nucleotide substitutions, and the distribution and trajectory of allele frequency. Particularly, for generating SNVs, the nucleotide substitution model can be chosen from some standard models of nucleotide evolution, including JC69, K80, HKY85, TN93, and REV (<xref rid="btad302-B9" ref-type="bibr">Whelan et al. 2001</xref>). The distribution of allele frequency can be manually inputted or generated from beta distribution. Given the allele frequency of each mutation in the longitudinal samples, the reads carrying mutations are randomly selected by Bernoulli process. All mutations are randomly distributed across genome unless specified by user. In this step, the positions of mutation in the genomes and the corresponding reads covering these positions are extracted from the alignment files and recorded. In the last step, the corresponding reads in the original simulated data are modified to carry mutations and other reads remain unchanged. The output of STEMSIM includes raw metagenomics data with mutations, as well as the detailed information of these mutations in the Variant Call Format (VCF).</p>
    <fig position="float" id="btad302-F1">
      <label>Figure 1.</label>
      <caption>
        <p>The workflow of STEMSIM. Step 1: Simulate longitudinal samples (fastq) of microbial communities by CAMISIM (recommended) according to the given reference genomes (fasta). Step 2: Align the raw sequencing reads to the genomes where they were simulated from by Bowtie2 to obtain the alignment files (sam/bam). Step 3: Generate and record the locations of the mutations on reads according to the parameter setting. Step 4: Modify the original simulated reads according to the read IDs and mutation positions recorded in Step 3. The final output are the simulated reads (fastq) with mutations and the information of mutations (e.g. position in the genome and base type).</p>
      </caption>
      <graphic xlink:href="btad302f1" position="float"/>
    </fig>
  </sec>
  <sec>
    <title>3 Results and discussion</title>
    <p>STEMSIM is a command-line software written in Python3 and is designed to work on Linux operating systems. With a 2.40 GHz CPU, STEMSIM can process one million reads in three minutes on a server. It can be used in combination with CAMISIM to generate within-strain mutations in longitudinal microbial communities or works solely on simulated or real raw metagenomic data. The parameters of the generated mutations are highly customizable and can be easily changed via the configure file (a detailed tutorial is available on the STEMSIM GitHub Wiki). By providing a user-friendly mutations simulator in metagenomic data, we believe that STEMSIM will be widely used and facilitate the evaluation of analytic tools at the strain level.</p>
  </sec>
</body>
<back>
  <sec sec-type="COI-statement">
    <title>Conflict of interest</title>
    <p>None declared.</p>
  </sec>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the National Cancer Institute [P20CA252728] and U.S. National Library of Medicine [1R01LM014085].</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btad302-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Anyansi</surname><given-names>C</given-names></string-name>, <string-name><surname>Straub</surname><given-names>TJ</given-names></string-name>, <string-name><surname>Manson</surname><given-names>AL</given-names></string-name></person-group><etal>et al</etal><article-title>Computational methods for strain-level microbial detection in colony and metagenome sequencing data</article-title>. <source>Front Microbiol</source><year>2020</year>;<volume>11</volume>:<fpage>1925</fpage>.<pub-id pub-id-type="pmid">33013732</pub-id></mixed-citation>
    </ref>
    <ref id="btad302-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Biswas</surname><given-names>S</given-names></string-name>, <string-name><surname>Akey</surname><given-names>JM.</given-names></string-name></person-group><article-title>Genomic insights into positive selection</article-title>. <source>Trends Genet</source><year>2006</year>;<volume>22</volume>:<fpage>437</fpage>–<lpage>46</lpage>.<pub-id pub-id-type="pmid">16808986</pub-id></mixed-citation>
    </ref>
    <ref id="btad302-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fritz</surname><given-names>A</given-names></string-name>, <string-name><surname>Hofmann</surname><given-names>P</given-names></string-name>, <string-name><surname>Majda</surname><given-names>S</given-names></string-name></person-group><etal>et al</etal><article-title>CAMISIM: simulating metagenomes and microbial communities</article-title>. <source>Microbiome</source><year>2019</year>;<volume>7</volume>:<fpage>1</fpage>–<lpage>12</lpage>.<pub-id pub-id-type="pmid">30606251</pub-id></mixed-citation>
    </ref>
    <ref id="btad302-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huang</surname><given-names>W</given-names></string-name>, <string-name><surname>Li</surname><given-names>L</given-names></string-name>, <string-name><surname>Myers</surname><given-names>JR</given-names></string-name></person-group><etal>et al</etal><article-title>ART: a next-generation sequencing read simulator</article-title>. <source>Bioinformatics</source><year>2012</year>;<volume>28</volume>:<fpage>593</fpage>–<lpage>4</lpage>.<pub-id pub-id-type="pmid">22199392</pub-id></mixed-citation>
    </ref>
    <ref id="btad302-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Huo</surname><given-names>W</given-names></string-name>, <string-name><surname>Busch</surname><given-names>LM</given-names></string-name>, <string-name><surname>Hernandez-Bird</surname><given-names>J</given-names></string-name></person-group><etal>et al</etal><article-title>Immunosuppression broadens evolutionary pathways to drug resistance and treatment failure during <italic toggle="yes">Acinetobacter baumannii</italic> pneumonia in mice</article-title>. <source>Nat Microbiol</source><year>2022</year>;<volume>7</volume>:<fpage>796</fpage>–<lpage>809</lpage>.<pub-id pub-id-type="pmid">35618774</pub-id></mixed-citation>
    </ref>
    <ref id="btad302-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Langmead</surname><given-names>B</given-names></string-name>, <string-name><surname>Salzberg</surname><given-names>SL.</given-names></string-name></person-group><article-title>Fast gapped-read alignment with bowtie 2</article-title>. <source>Nat Methods</source><year>2012</year>;<volume>9</volume>:<fpage>357</fpage>–<lpage>9</lpage>.<pub-id pub-id-type="pmid">22388286</pub-id></mixed-citation>
    </ref>
    <ref id="btad302-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Maddamsetti</surname><given-names>R</given-names></string-name>, <string-name><surname>Grant</surname><given-names>NA.</given-names></string-name></person-group><article-title>Discovery of positive and purifying selection in metagenomic time series of hypermutator microbial populations</article-title>. <source>PLoS Genet</source><year>2022</year>;<volume>18</volume>:<fpage>e1010324</fpage>.<pub-id pub-id-type="pmid">35981004</pub-id></mixed-citation>
    </ref>
    <ref id="btad302-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Van Rossum</surname><given-names>T</given-names></string-name>, <string-name><surname>Ferretti</surname><given-names>P</given-names></string-name>, <string-name><surname>Maistrenko</surname><given-names>OM</given-names></string-name></person-group><etal>et al</etal><article-title>Diversity within species: interpreting strains in microbiomes</article-title>. <source>Nat Rev Microbiol</source><year>2020</year>;<volume>18</volume>:<fpage>491</fpage>–<lpage>506</lpage>.<pub-id pub-id-type="pmid">32499497</pub-id></mixed-citation>
    </ref>
    <ref id="btad302-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Whelan</surname><given-names>S</given-names></string-name>, <string-name><surname>Liò</surname><given-names>P</given-names></string-name>, <string-name><surname>Goldman</surname><given-names>N.</given-names></string-name></person-group><article-title>Molecular phylogenetics: state-of-the-art methods for looking into the past</article-title>. <source>Trends Genet</source><year>2001</year>;<volume>17</volume>:<fpage>262</fpage>–<lpage>72</lpage>.<pub-id pub-id-type="pmid">11335036</pub-id></mixed-citation>
    </ref>
    <ref id="btad302-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yilmaz</surname><given-names>B</given-names></string-name>, <string-name><surname>Mooser</surname><given-names>C</given-names></string-name>, <string-name><surname>Keller</surname><given-names>I</given-names></string-name></person-group><etal>et al</etal><article-title>Long-term evolution and short-term adaptation of microbiota strains and Sub-strains in mice</article-title>. <source>Cell Host Microbe</source><year>2021</year>;<volume>29</volume>:<fpage>650</fpage>–<lpage>63.e9</lpage>.<pub-id pub-id-type="pmid">33662276</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
