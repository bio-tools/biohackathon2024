<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6289128</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/bty539</article-id>
    <article-id pub-id-type="publisher-id">bty539</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Notes</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genetics and Population Analysis</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>pyseer: a comprehensive tool for microbial pangenome-wide association studies</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0001-5360-1254</contrib-id>
        <name>
          <surname>Lees</surname>
          <given-names>John A</given-names>
        </name>
        <xref ref-type="aff" rid="bty539-aff1">1</xref>
        <xref ref-type="corresp" rid="bty539-cor1"/>
        <xref ref-type="author-notes" rid="bty539-FM1"/>
        <!--<email>john.lees@nyumc.org</email>-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Galardini</surname>
          <given-names>Marco</given-names>
        </name>
        <xref ref-type="aff" rid="bty539-aff2">2</xref>
        <xref ref-type="corresp" rid="bty539-cor1"/>
        <xref ref-type="author-notes" rid="bty539-FM1"/>
        <!--<email>marco@ebi.ac.uk</email>-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bentley</surname>
          <given-names>Stephen D</given-names>
        </name>
        <xref ref-type="aff" rid="bty539-aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0001-7168-8090</contrib-id>
        <name>
          <surname>Weiser</surname>
          <given-names>Jeffrey N</given-names>
        </name>
        <xref ref-type="aff" rid="bty539-aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Corander</surname>
          <given-names>Jukka</given-names>
        </name>
        <xref ref-type="aff" rid="bty539-aff3">3</xref>
        <xref ref-type="aff" rid="bty539-aff4">4</xref>
        <xref ref-type="aff" rid="bty539-aff5">5</xref>
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Stegle</surname>
          <given-names>Oliver</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <aff id="bty539-aff1"><label>1</label>Department of Microbiology, New York University School of Medicine, New York, NY, USA</aff>
    <aff id="bty539-aff2"><label>2</label>European Bioinformatics Institute (EMBL-EBI), Hinxton, UK</aff>
    <aff id="bty539-aff3"><label>3</label>Department of Parasites and Microbes, Wellcome Sanger Institute, Hinxton, UK</aff>
    <aff id="bty539-aff4"><label>4</label>Department of Biostatistics, University of Oslo, Oslo, Norway</aff>
    <aff id="bty539-aff5"><label>5</label>Helsinki Institute of Information Technology (HIIT), Department of Mathematics and Statistics, University of Helsinki, Helsinki, Finland</aff>
    <author-notes>
      <fn id="bty539-FM1">
        <p>The authors wish it to be known that, in their opinion, the John A. Lees and Marco Galardini authors should be regarded as Joint First Authors.</p>
      </fn>
      <corresp id="bty539-cor1">To whom correspondence should be addressed. E-mail: <email>john.lees@nyumc.org</email> or <email>marco@ebi.ac.uk</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <day>15</day>
      <month>12</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2018-07-02">
      <day>02</day>
      <month>7</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>02</day>
      <month>7</month>
      <year>2018</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>34</volume>
    <issue>24</issue>
    <fpage>4310</fpage>
    <lpage>4312</lpage>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>2</month>
        <year>2018</year>
      </date>
      <date date-type="rev-recd">
        <day>27</day>
        <month>5</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>27</day>
        <month>6</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2018. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2018</copyright-year>
      <license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="bty539.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>Genome-wide association studies (GWAS) in microbes have different challenges to GWAS in eukaryotes. These have been addressed by a number of different methods. <italic>pyseer</italic> brings these techniques together in one package tailored to microbial GWAS, allows greater flexibility of the input data used, and adds new methods to interpret the association results.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p><italic>pyseer</italic> is written in python and is freely available at <ext-link ext-link-type="uri" xlink:href="https://github.com/mgalardini/pyseer">https://github.com/mgalardini/pyseer</ext-link>, or can be installed through <italic>pip</italic>. Documentation and a tutorial are available at <ext-link ext-link-type="uri" xlink:href="http://pyseer.readthedocs.io">http://pyseer.readthedocs.io</ext-link>.</p>
      </sec>
      <sec id="s3">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">United States Public Health Service</named-content>
          <named-content content-type="funder-identifier">10.13039/100007197</named-content>
        </funding-source>
        <award-id>AI038446</award-id>
        <award-id>AI105168</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">ERC</named-content>
          <named-content content-type="funder-identifier">10.13039/100010663</named-content>
        </funding-source>
        <award-id>742158</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">SDB</named-content>
          <named-content content-type="funder-identifier">10.13039/100009988</named-content>
        </funding-source>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Wellcome</named-content>
          <named-content content-type="funder-identifier">10.13039/100004440</named-content>
        </funding-source>
        <award-id>098051</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Finding genetic variation associated with bacterial phenotypes such as antibiotic resistance, virulence and host specificity has great potential for a better understanding of the evolution of these traits, and may be able to inform new clinical interventions. Genome-wide association studies (GWAS) address this in a hypothesis-free manner. The recent availability of thousands of whole-genome sequences from bacterial populations has made this approach possible, though issues of strong clonal population structure and a variable pangenome (sequence variation of both core regions present in every isolate, and in variably present accessory regions) must be accounted for in any successful analysis (<xref rid="bty539-B10" ref-type="bibr">Power <italic>et al.</italic>, 2017</xref>).</p>
    <p>One method that addresses these issues in a scalable manner is <italic>SEER</italic> (<xref rid="bty539-B6" ref-type="bibr">Lees <italic>et al.</italic>, 2016</xref>), which uses non-redundant variable length k-mers between 9-100 bases as a generalized variant to represent variation across the pangenome. Linear models with a control for population structure are then used to perform the association. Other methods include: <italic>bugwas</italic>, which uses a linear mixed model (LMM) and also checks for lineage effects (<xref rid="bty539-B2" ref-type="bibr">Earle <italic>et al.</italic>, 2016</xref>); <italic>scoary</italic>, which tests clusters of orthologous genes (COGs) with and without accounting for population structure (<xref rid="bty539-B1" ref-type="bibr">Brynildsrud <italic>et al.</italic>, 2016</xref>); and phylogenetic regression, which uses a known phylogeny to adjust for the covariance between samples (<xref rid="bty539-B3" ref-type="bibr">Garland and Ives, 2000</xref>).</p>
    <p>Each of these methods has its own set of advantages and limitations, so recent GWAS analyses have used a combination of these techniques along with methods designed for human genetics, often in a somewhat ad-hoc manner that requires tedious file format conversion and familiarity with a wide range of methods and software packages (<xref rid="bty539-B7" ref-type="bibr">Lees <italic>et al.</italic>, 2017</xref>).</p>
    <p>As the number of large bacterial population datasets increases, we recognize the need to make these methods more accessible to the field. We have therefore re-implemented <italic>SEER</italic> in an easy-to-use and install <italic>python</italic> package, <italic>pyseer</italic>. <italic>pyseer</italic> also includes many additional features covering new association models, input sources and output processing. This brings together all the methods mentioned above into a single piece of software, and further enables new combinations of analysis. Our method is equally applicable to viral GWAS, and indeed any species with structured populations and/or genomes with significant variation in gene content.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>The foundation of <italic>pyseer</italic> is a direct <italic>python</italic> re-implementation of <italic>SEER</italic> (originally written in C++). K-mers of variable length counted from draft assemblies are used as the input, and their association with a phenotype of interest is assessed by fitting a generalized linear model to each k-mer. To control for population structure, multi-dimensional scaling of a pairwise distance matrix is performed and these components are included as fixed effects in each regression. In the case of a binary phenotype with a highly penetrant variant (those with high effect sizes), Firth regression is performed to maintain power. This adds a penalty to the logistic regression likelihood when there is a large error on the slope, which alleviates underestimation of p-values in cases with nearly separable data (<xref rid="bty539-B5" ref-type="bibr">Heinze and Schemper, 2002</xref>). Significant k-mers, after adjusting for multiple testing, can then be mapped to a reference annotation to find regions of the genome associated with the phenotype.</p>
    <p>After re-implementation, results were the same as <italic>SEER</italic> (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S1</xref>) and <italic>pyseer</italic> is of comparable speed (<xref ref-type="supplementary-material" rid="sup1">Supplementary Table S1</xref>). We then expanded the features in <italic>pyseer</italic> to bring together the different methods mentioned above.</p>
    <sec>
      <title>2.1 Input sources</title>
      <p>In addition to k-mers, the original focus of <italic>SEER</italic>, it can be convenient to test for association of SNPs and INDELs called against a reference genome. These can be used to test for association of close or adjacent SNPs, which would be split into many low frequency k-mers. The consequence of these variants can be directly predicted (e.g. synonymous, frameshifting) which would require more downstream processing for k-mers. Presence or absence of COGs and aligned intergenic regions can also be useful, as shown by <italic>scoary</italic> (<xref rid="bty539-B1" ref-type="bibr">Brynildsrud <italic>et al.</italic>, 2016</xref>).</p>
      <p><italic>pyseer</italic> can natively read all these types of variant from VCF or Rtab files, which also allows for any user defined input type (for example copy number variants). We also enable grouping of variants by genomic region to perform burden testing, now allowing users to perform analysis of rare variation while still accounting for population structure.</p>
      <p>An important technical difficulty of using <italic>SEER</italic>, and most common linear mixed model implementations, is making sure that the membership and order of samples between the variant calls, phenotype file and population structure all match up correctly. Many methods do not check for this, and can run an incorrect analysis without producing a warning. In <italic>pyseer</italic> this label matching is done automatically, and the intersection of samples used is reported to the user.</p>
    </sec>
    <sec>
      <title>2.2 Association models</title>
      <p><italic>pyseer</italic> implements the same fixed effect generalized linear regression model as <italic>SEER</italic>, including Firth regression. In <italic>pyseer</italic> we have added two new multidimensional scaling algorithms and a more streamlined interface with <italic>mash</italic> (<xref rid="bty539-B9" ref-type="bibr">Ondov <italic>et al.</italic>, 2016</xref>) to compute population structure. Alternatively, when a high quality phylogeny is available, <italic>pyseer</italic> can use this to adjust for population structure in a manner analogous to phylogenetic regression.</p>
      <p>As a major alternative we have included an LMM, which uses random effects to control for population structure, and has been shown to work across a range of scenarios. We have used the FaST-LMM implementation, which allows association in linear time (<xref rid="bty539-B8" ref-type="bibr">Lippert <italic>et al.</italic>, 2011</xref>), using a kinship matrix estimated from a subset of variants or from a phylogeny. This now allows association of all k-mers under the mixed model in a few hours, which was previously computationally and bioinformatically challenging.</p>
      <p>We have also included a method to estimate possible lineage effects, based on the procedure used in <italic>bugwas</italic>. Those variants which are associated with both the phenotype and with a lineage (which can be determined by <italic>pyseer</italic> or defined by the user) associated with the phenotype can be prioritized for further analysis outside of GWAS.</p>
    </sec>
    <sec>
      <title>2.3 Output processing</title>
      <p>It has been suggested that the number of unique variant patterns is a sensible way to set the multiple testing threshold, however these can be difficult to count due to the size of k-mer data. <italic>pyseer</italic> uses hashing to efficiently calculate this. We have also added tools to make interpretation of significant k-mers more streamlined. The user can map their results against any number of reference genomes for interactive display in <italic>phandango</italic> (<xref rid="bty539-B4" ref-type="bibr">Hadfield <italic>et al.</italic>, 2018</xref>) (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S2</xref>). We have added the ability to summarize k-mer results at the gene level by iteratively mapping to reference and draft annotations, which can be used to show complementary information about effect size, coverage and minor allele frequency (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S3</xref>).</p>
    </sec>
  </sec>
  <sec>
    <title>3 Discussion</title>
    <p>Starting with a re-implementation of <italic>SEER</italic>, we have added the models and input types used by other microbial and human GWAS approaches into a single package. Analyses which were previously challenging to perform, such as association of all variable length k-mers with a LMM, can be performed in an efficient and user-friendly manner. We have also enabled new types of analysis, such as population structure corrected burden testing, and gene level summaries of k-mers. Our package includes comprehensive documentation and a tutorial which shows how to perform GWAS using the new input sources and both association models, as well as how to interpret significant k-mers. We have implemented unit tests in our code to ensure consistency of output as features are added.</p>
    <p>With <italic>pyseer</italic> we have therefore reconciled many of the existing methods for regression-based microbial GWAS into a single package. Our focus on documentation and ease-of-use of <italic>pyseer</italic> will make GWAS more accessible to the microbial genomics community.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>Supplementary Material</label>
      <media xlink:href="bty539_supplementary_material.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <title>Acknowledgements</title>
    <p>We wish to thank Leonor Sanchez-Buso for an early version of the k-mer annotation script. We would also like to thank Pedro Beltrao and Chrispin Chaguza for constructive comments.</p>
    <sec>
      <title>Funding</title>
      <p>JNW was funded by grants from the United States Public Health Service (AI038446 and AI105168). JC was funded by the ERC (grant no. 742158). SDB is funded by Wellcome (grant 098051).</p>
      <p><italic>Conflict of Interest</italic>: none declared.</p>
    </sec>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="bty539-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Brynildsrud</surname><given-names>O.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Rapid scoring of genes in microbial pan-genome-wide association studies with scoary</article-title>. <source>Genome Biol</source>., <volume>17</volume>, <fpage>238.</fpage><pub-id pub-id-type="pmid">27887642</pub-id></mixed-citation>
    </ref>
    <ref id="bty539-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Earle</surname><given-names>S.G.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Identifying lineage effects when controlling for population structure improves power in bacterial association studies</article-title>. <source>Nat. Microbiol</source>., <volume>1</volume>, <fpage>16041.</fpage><pub-id pub-id-type="pmid">27572646</pub-id></mixed-citation>
    </ref>
    <ref id="bty539-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Garland</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Ives</surname><given-names>A.R.</given-names></name></person-group> (<year>2000</year>) 
<article-title>Using the past to predict the present: confidence intervals for regression equations in phylogenetic comparative methods</article-title>. <source>Am. Nat</source>., <volume>155</volume>, <fpage>346</fpage>–<lpage>364</lpage>.<pub-id pub-id-type="pmid">10718731</pub-id></mixed-citation>
    </ref>
    <ref id="bty539-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Hadfield</surname><given-names>J.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>Phandango: an interactive viewer for bacterial population genomics</article-title>. <source>Bioinformatics</source>, <volume>34</volume>, <fpage>292</fpage>–<lpage>293</lpage>.</mixed-citation>
    </ref>
    <ref id="bty539-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Heinze</surname><given-names>G.</given-names></name>, <name name-style="western"><surname>Schemper</surname><given-names>M.</given-names></name></person-group> (<year>2002</year>) 
<article-title>A solution to the problem of separation in logistic regression</article-title>. <source>Stat. Med</source>., <volume>21</volume>, <fpage>2409</fpage>–<lpage>2419</lpage>.<pub-id pub-id-type="pmid">12210625</pub-id></mixed-citation>
    </ref>
    <ref id="bty539-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lees</surname><given-names>J.A.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Sequence element enrichment analysis to determine the genetic basis of bacterial phenotypes</article-title>. <source>Nat. Commun</source>., <volume>7</volume>, <fpage>12797.</fpage><pub-id pub-id-type="pmid">27633831</pub-id></mixed-citation>
    </ref>
    <ref id="bty539-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lees</surname><given-names>J.A.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>Genome-wide identification of lineage and locus specific variation associated with pneumococcal carriage duration</article-title>. <source>Elife</source>, <volume>6</volume>, e26255.</mixed-citation>
    </ref>
    <ref id="bty539-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lippert</surname><given-names>C.</given-names></name></person-group><etal>et al</etal> (<year>2011</year>) 
<article-title>FaST linear mixed models for genome-wide association studies</article-title>. <source>Nat. Methods</source>, <volume>8</volume>, <fpage>833</fpage>–<lpage>835</lpage>.<pub-id pub-id-type="pmid">21892150</pub-id></mixed-citation>
    </ref>
    <ref id="bty539-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ondov</surname><given-names>B.D.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>Mash: fast genome and metagenome distance estimation using MinHash</article-title>. <source>Genome Biol</source>., <volume>17</volume>, <fpage>1</fpage>–<lpage>14</lpage>.</mixed-citation>
    </ref>
    <ref id="bty539-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Power</surname><given-names>R.A.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>Microbial genome-wide association studies: lessons from human GWAS</article-title>. <source>Nat. Rev. Genet</source>., <volume>18</volume>, <fpage>41</fpage>–<lpage>50</lpage>.<pub-id pub-id-type="pmid">27840430</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
