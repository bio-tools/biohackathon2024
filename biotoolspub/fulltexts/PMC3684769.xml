<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Front Neurosci</journal-id>
    <journal-id journal-id-type="iso-abbrev">Front Neurosci</journal-id>
    <journal-id journal-id-type="publisher-id">Front. Neurosci.</journal-id>
    <journal-title-group>
      <journal-title>Frontiers in Neuroscience</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1662-4548</issn>
    <issn pub-type="epub">1662-453X</issn>
    <publisher>
      <publisher-name>Frontiers Media S.A.</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3684769</article-id>
    <article-id pub-id-type="doi">10.3389/fnins.2013.00106</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Neuroscience</subject>
        <subj-group>
          <subject>Original Research Article</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Improved blood velocity measurements with a hybrid image filtering and iterative Radon transform algorithm</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Chhatbar</surname>
          <given-names>Pratik Y.</given-names>
        </name>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kara</surname>
          <given-names>Prakash</given-names>
        </name>
        <xref ref-type="author-notes" rid="fn001">
          <sup>*</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff>
      <institution>Department of Neurosciences, Medical University of South Carolina</institution>
      <country>Charleston, SC, USA</country>
    </aff>
    <author-notes>
      <fn fn-type="edited-by">
        <p>Edited by: Srikantan S. Nagarajan, University of California, San Francisco, USA</p>
      </fn>
      <fn fn-type="edited-by">
        <p>Reviewed by: Bruno Weber, University of Zurich, Switzerland; Patrick J. Drew, The Pennsylvania State University, USA</p>
      </fn>
      <corresp id="fn001">*Correspondence: Prakash Kara, Department of Neurosciences, Medical University of South Carolina, 173 Ashley Avenue, BSB403, Charleston, SC 29425, USA e-mail: <email xlink:type="simple">kara@musc.edu</email></corresp>
      <fn fn-type="other" id="fn002">
        <p>This article was submitted to Frontiers in Brain Imaging Methods, a specialty of Frontiers in Neuroscience.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>6</month>
      <year>2013</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2013</year>
    </pub-date>
    <volume>7</volume>
    <elocation-id>106</elocation-id>
    <history>
      <date date-type="received">
        <day>01</day>
        <month>4</month>
        <year>2013</year>
      </date>
      <date date-type="accepted">
        <day>24</day>
        <month>5</month>
        <year>2013</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2013 Chhatbar and Kara.</copyright-statement>
      <copyright-year>2013</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/3.0/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits use, distribution and reproduction in other forums, provided the original authors and source are credited and subject to any copyright notices concerning any third-party graphics etc.</license-p>
      </license>
    </permissions>
    <abstract>
      <p>Neural activity leads to hemodynamic changes which can be detected by functional magnetic resonance imaging (fMRI). The determination of blood flow changes in individual vessels is an important aspect of understanding these hemodynamic signals. Blood flow can be calculated from the measurements of vessel diameter and blood velocity. When using line-scan imaging, the movement of blood in the vessel leads to streaks in space-time images, where streak angle is a function of the blood velocity. A variety of methods have been proposed to determine blood velocity from such space-time image sequences. Of these, the Radon transform is relatively easy to implement and has fast data processing. However, the precision of the velocity measurements is dependent on the number of Radon transforms performed, which creates a trade-off between the processing speed and measurement precision. In addition, factors like image contrast, imaging depth, image acquisition speed, and movement artifacts especially in large mammals, can potentially lead to data acquisition that results in erroneous velocity measurements. Here we show that pre-processing the data with a Sobel filter and iterative application of Radon transforms address these issues and provide more accurate blood velocity measurements. Improved signal quality of the image as a result of Sobel filtering increases the accuracy and the iterative Radon transform offers both increased precision and an order of magnitude faster implementation of velocity measurements. This algorithm does not use <italic>a priori</italic> knowledge of angle information and therefore is sensitive to sudden changes in blood flow. It can be applied on any set of space-time images with red blood cell (RBC) streaks, commonly acquired through line-scan imaging or reconstructed from full-frame, time-lapse images of the vasculature.</p>
    </abstract>
    <kwd-group>
      <kwd>blood flow</kwd>
      <kwd>two-photon imaging</kwd>
      <kwd>space-time images</kwd>
      <kwd>line-scan</kwd>
      <kwd>velocity</kwd>
      <kwd>Sobel filtering</kwd>
    </kwd-group>
    <counts>
      <fig-count count="11"/>
      <table-count count="0"/>
      <equation-count count="24"/>
      <ref-count count="23"/>
      <page-count count="12"/>
      <word-count count="7827"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="s1">
    <title>Introduction</title>
    <p>The need to understand the relationship between neuronal and vascular activity has become crucial with the rise in the use of functional magnetic resonance imaging (fMRI) in research (Smith, <xref ref-type="bibr" rid="B18">2012</xref>). Two-photon and other imaging techniques like bright field microscopy have provided us with the means to follow changes in neuronal and vascular activity at high spatial and temporal resolution. Neuronal activity can be determined by imaging calcium signals as a surrogate for spiking activity (Tsien, <xref ref-type="bibr" rid="B22">1988</xref>; Stosiek et al., <xref ref-type="bibr" rid="B20">2003</xref>; Ohki et al., <xref ref-type="bibr" rid="B15">2005</xref>; Tian et al., <xref ref-type="bibr" rid="B21">2009</xref>; Akerboom et al., <xref ref-type="bibr" rid="B1">2013</xref>), while blood flow can be calculated from the vessel diameter and blood velocity.</p>
    <p>Vessel diameter can be measured by labeling the vessel wall, for instance with an artery-specific dye (Shen et al., <xref ref-type="bibr" rid="B17">2012</xref>), or by labeling the vessel lumen with circulating fluorescein-dextran (Schaffer et al., <xref ref-type="bibr" rid="B16">2006</xref>; Drew et al., <xref ref-type="bibr" rid="B8">2011</xref>). Blood velocity can be measured from the speed of red blood cells (RBCs) inside the vessel by labeling either the plasma or RBCs. Intravascular injection of large dextran-conjugated fluorescent dyes lead to labeling of the plasma. Alternatively, RBC-labeling with smaller lipophilic fluorescent dyes can also be used for studying vascular blood flow (Kamoun et al., <xref ref-type="bibr" rid="B10">2010</xref>). These selective plasma or RBC-labeling methods lead to high contrast between RBCs and plasma, resulting in streaks of RBCs in the space-time images of vessels (Figures <xref ref-type="fig" rid="F1">1A</xref>,<xref ref-type="fig" rid="F1">B</xref>). A given streak angle depends on the distance traveled by the RBC per unit time. Therefore, blood velocity can be determined from the slope of such streaks.</p>
    <fig id="F1" position="float">
      <label>Figure 1</label>
      <caption>
        <p><bold>Schematic of using a line-scan protocol to create space-time images under ideal recording conditions and when artifacts are present. (A)</bold> Full-frame image showing an RBC traveling inside a vessel. The line-scan path is represented as a red line (in top panels) and a stack of sequential line-scans shows the RBC at four different locations in the vessel (bottom panels). <bold>(B)</bold> Repeated line-scans through the identical location in the vessel (top panel) results in a space-time image that has a diagonal RBC streak (bottom panel). <bold>(C)</bold> A line-scan path that goes outside the vessel (top panel) results in a time-invariant artifact, represented as a black vertical band in the line-scan image (bottom panel). <bold>(D)</bold> Movement of the vessel relative to the line-scan path (top panel) results in a time-varying artifact, represented by the variable width of the black band in the line-scan image (bottom panel).</p>
      </caption>
      <graphic xlink:href="fnins-07-00106-g0001"/>
    </fig>
    <p>Calculation of the slope of the RBC streaks has been proposed using many different algorithms including line fitting (Zhang et al., <xref ref-type="bibr" rid="B23">2005</xref>), singular value decomposition (SVD) (Kleinfeld et al., <xref ref-type="bibr" rid="B12">1998</xref>), Radon transform (Drew et al., <xref ref-type="bibr" rid="B7">2010</xref>), and Fourier transform (Autio et al., <xref ref-type="bibr" rid="B2">2011</xref>; Kim et al., <xref ref-type="bibr" rid="B11">2012</xref>). Calculation of velocity using global energy minimization has also been proposed (Deneux et al., <xref ref-type="bibr" rid="B5">2011</xref>). The Radon transform is one of the most powerful blood velocity measurement algorithms because of its easy implementation, accuracy, speed, and robustness. Radon transform calculates the slope from the angle that provides the maximum variance in the projections of the line-scan image at a specified angle space. However, it can still produce erroneous results when the line-scan images have low contrast and/or include artifacts (Figures <xref ref-type="fig" rid="F1">1C</xref>,<xref ref-type="fig" rid="F1">D</xref>). Also, the precision of the velocity measurements is based on the angle step-size used for the Radon transform. Thus, selecting the number of angle steps to process with the Radon transform involves a trade-off between computation time and the precision of the measured streak angle.</p>
    <p>Here we propose an enhanced algorithm that increases the accuracy and speed of velocity measurements: Sobel filtering of the image is followed by iterative application of multiple Radon transforms with increasing angle precision. Contrary to vertical (temporal) or whole-image demeaning, Sobel filtering (Sobel, <xref ref-type="bibr" rid="B19">1978</xref>) efficiently removes the baseline or slow trends from the line-scan image. This translates into more accurate angle (and therefore velocity) measurements from line-scan images. Our development of an iterative Radon transform is built on the idea of adaptive application of Radon transforms with finer angle steps (see Drew et al., <xref ref-type="bibr" rid="B7">2010</xref> and our Materials and Methods). The first iteration of Radon transforms uses large angle steps across the full range of angles with progressively smaller steps in the subsequent iterations, allowing very precise angle calculations without the trade-off of exceedingly long computation times.</p>
  </sec>
  <sec sec-type="materials|methods" id="s2">
    <title>Materials and methods</title>
    <sec>
      <title>Experimental methods</title>
      <p>Long Evans rats (postnatal days 29–48) and cats (postnatal day 28—adult) of both sexes were used to collect images from the primary visual cortex. The Institutional Animal Care and Use Committee of the Medical University of South Carolina approved all animal experiments. Detailed experimental setup, anesthesia, surgical procedures, and drifting grating visual stimulation protocols are described elsewhere (O'Herron et al., <xref ref-type="bibr" rid="B14">2012</xref>; Shen et al., <xref ref-type="bibr" rid="B17">2012</xref>). Briefly, rats were anesthetized with intraperitoneal injection of a fentanyl cocktail (0.04–0.06 mg kg<sup>−1</sup> fentanyl citrate, 3.75–6.25 mg kg<sup>−1</sup> midazolam, and 0.19–0.31 mg kg<sup>−1</sup> dexmedetomidine). Cats were anesthetized with 1–2% isoflurane. After making a 2–3 mm craniotomy and removal of dura, the vasculature was visualized with circulating 2000 kDa Fluorescein Dextran (FD2000S, Sigma), 75 kDa Texas Red Dextran (Life Technologies), or Alexa Fluor 633 Hydrazide (Life Technologies). Imaging was performed with a custom-designed two-photon microscope and a water-immersion objective (Olympus XLUMPLFLN 20×, 1.0 NA or Olympus LUMPlanFI/IR 40×, 0.8 NA). Circulating RBCs were visualized as dark disks against the fluorescent-labeled plasma. These RBCs appear as dark bands or streaks in space-time images. In both rats and cats, movements of the brain were minimized by sealing the craniotomy with agarose and a coverglass (Levy et al., <xref ref-type="bibr" rid="B13">2012</xref>; O'Herron et al., <xref ref-type="bibr" rid="B14">2012</xref>). In cats, a lumbar suspension and pneumothorax were needed to further reduce the brain movements of cardiac and respiratory origin. Typically, brain movement was limited to 1–2 μm in rats and kittens. But in some adult cats, movements of up to 5 μm were present.</p>
    </sec>
    <sec>
      <title>Data collection parameters</title>
      <p>Fractional change in blood velocity is best detected when the RBC streak-angle is ~45° (see Equations 16, 17). However, it is not always possible to acquire line-scan images with RBC streaks at this angle because of fast flow and/or relatively slow imaging, e.g., when using galvanometers. In such cases, the line-scan acquisition rate can be increased by imaging a smaller portion of the vessel, and/or by reducing the spatial resolution and pixel dwell-time of the scan, as long as the RBC-plasma contrast is sufficiently high. Additionally, the end-to-start flyback time during scanning can be reduced by combining a low-magnification objective with a compensatory zoom, e.g., 20× objective at zoom 4 instead of 40× objective at zoom 2. We observed that this slight advantage in speed gave superior line-scan acquisitions with a steeper slope of the RBC streaks and more reliable velocity measurements, e.g., in 30–50 μm diameter arterioles that have high blood speeds. Additionally, flyback speeds can be improved by driving the beam steering hardware to the fastest possible speeds.</p>
      <p>For a vessel with blood velocity of <italic>v</italic> mm/s captured with line-scan parameters of Δ<italic>x</italic> μm/pixel spatial resolution and Δ<italic>t</italic> ms/line temporal resolution (line-scan time), the angle of the streak θ is,
<disp-formula id="E1"><label>(1)</label><mml:math id="M1"><mml:mrow><mml:mi>θ</mml:mi><mml:mo>=</mml:mo><mml:mtext>arctan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>v</mml:mi><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
The value of θ depends on blood velocity as well as spatial and temporal resolution of the line-scan image. If changing the imaging parameters offers a new angle θ<sub>new</sub> as a result of new spatial resolution of Δ<italic>x</italic><sub>new</sub> μm/pixel and temporal resolution of Δ<italic>t</italic><sub>new</sub> ms/line, the relationship between the new and old angles can be shown as,
<disp-formula id="E2"><label>(2)</label><mml:math id="M2"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>new</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>arctan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>Δ</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mtext>new</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mfrac><mml:mrow><mml:mi>Δ</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mtext>new</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mtext>tan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext>arctan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>k</mml:mi></mml:mfrac><mml:mtext>tan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
Where <italic>k</italic> is defined as,
<disp-formula id="E3"><label>(3)</label><mml:math id="M3"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>Δ</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mtext>new</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mfrac><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>Δ</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mtext>new</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>
With the current streak angle θ and the desired streak angle θ<sub>new</sub>, the imaging speed factor <italic>k</italic> can be calculated as,
<disp-formula id="E4"><label>(4)</label><mml:math id="M4"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext>tan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mtext>tan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>new</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>
In order to achieve the preferred angle of ~45°, the image acquisition speed should be changed by a factor of <italic>k</italic> = tan(θ). If the line-scan imaging parameters that give 60° streak angle can be changed to improve the acquisition speeds by 30%, i.e., <italic>k</italic> = 1.3, the resultant streaks will have an angle of 53.11° (Equation 2). A streak angle of 45°can be achieved if the same imaging can be made faster by ~73% (<italic>k</italic> = 1.73, Equation 4). The simplest way to change the image acquisition speeds (or Δ<italic>t</italic>, line-scan time) is by changing the spatial resolution, pixel dwell time, and/or decreasing the pixel length of an imaged vessel segment. The caveat here is that the RBC streaks must maintain sufficient contrast to provide a signal-to-noise ratio (SNR) that enables further data processing and velocity measurements on the image (Figure <xref ref-type="fig" rid="F2">2</xref>).</p>
      <fig id="F2" position="float">
        <label>Figure 2</label>
        <caption>
          <p><bold>Change in the pixel resolution leads to change in the RBC streak angle. (A)</bold> Full-frame image of an 8 μm diameter microvessel segment in the rat visual cortex with the line-scan trajectory shown as a red line. <bold>(B)</bold> Space-time image collected from the vessel shown in <bold>(A)</bold>. Line-scan imaging with spatial resolution (Δ<italic>x</italic>) of 0.23 μm/pixel and period (Δ<italic>t</italic>) of 1.37 ms/line was used. Pixel dwell time was 4 μs. The RBC streaks have angle of 59.5° (dashed yellow lines) and blood velocity of 0.29 mm/s. <bold>(C)</bold> Full-frame image of the same microvessel segment as shown in <bold>(A)</bold> but with coarser spatial resolution. <bold>(D)</bold> Space-time image collected with the same line-scan path but with bigger pixel size (Δ<italic>x</italic> = 0.47 μm/pixel) leading to shorter line-scan time (Δ<italic>t</italic> = 0.9 ms/line). This resulted in the RBC streak angle of 29.1° (dashed yellow lines) and blood velocity of 0.29 mm/s. The mean ± SD velocity from the acquired 20 line-scan images was 0.28 ± 0.02 mm/s in <bold>(A)</bold> and 0.29 ± 0.02 mm/s in <bold>(C)</bold> (<italic>p</italic> = 0.54, two-sample <italic>t</italic>-test).</p>
        </caption>
        <graphic xlink:href="fnins-07-00106-g0002"/>
      </fig>
    </sec>
    <sec>
      <title>Sobel filtering of the line-scan images</title>
      <p>Line-scan images often need to be filtered to remove artifacts that create luminance variations unrelated to the flow of RBCs. Artifacts may be static or slowly changing with time (relative to the line-scan duration) such as the artifacts caused by breathing or heartbeats in larger animals. Filtering is commonly performed by temporal demeaning of these space-time images, which is achieved by subtracting the mean value of all the pixels on the time axis at a given point in space. However, temporal demeaning can only address the time-invariant artifacts. Sobel filtering of the line-scan images efficiently removes both types of artifacts.</p>
      <p>We used Sobel filtering in the time-dimension of the line-scan images (vertical Sobel filter, since our images have line-scans stacked vertically). The Sobel filter used here is 3 × 3 pixels and is applied by the convolution of the line-scan image <italic>I</italic> (<italic>x</italic>, <italic>t</italic>) with the vertical Sobel operator (<italic>S</italic>) as,
<disp-formula id="E5"><label>(5)</label><mml:math id="M5"><mml:mrow><mml:mi>F</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>I</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>t</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⊗</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:math></disp-formula>
<disp-formula id="E6"><label>(6)</label><mml:math id="M6"><mml:mrow><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mn>2</mml:mn></mml:mtd><mml:mtd><mml:mn>1</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
Such filtering efficiently enhances horizontal edges and reduces vertical edges (Figure <xref ref-type="fig" rid="F3">3</xref>). This minimizes slow time-varying components of the line-scan images while sparing the RBC streak edges. We did not find it necessary to use a Sobel operator with a larger kernel size, e.g., 5 × 5 or 7 × 7. Two-photon resolution produces sharp RBC streak edges, the thickness of which does not span more than a pixel or two. Moreover, line-to-line differences in the contrast of streak edges are best enhanced when the kernel height is 3.</p>
      <fig id="F3" position="float">
        <label>Figure 3</label>
        <caption>
          <p><bold>Effect of Sobel filtering on the image. (A)</bold> An image containing the text “Sobel Filter” is displayed. <bold>(B)</bold> Same image after two-dimensional convolution with a 3 × 3 vertical Sobel operator (Equation 6). Note the enhancement of edge features with horizontal components and disappearance of edge features with vertical components.</p>
        </caption>
        <graphic xlink:href="fnins-07-00106-g0003"/>
      </fig>
    </sec>
    <sec>
      <title>Iterative radon transforms</title>
      <sec>
        <title>Radon transform</title>
        <p>The Radon transform of line-scan images has been described in detail earlier (Drew et al., <xref ref-type="bibr" rid="B7">2010</xref>). Briefly, the Radon transform <inline-formula><mml:math id="M23"><mml:mrow><mml:mover accent="true"><mml:mi>F</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> of the image <italic>F</italic> (<italic>x</italic>, <italic>t</italic>) at a given angle θ can be defined as,
<disp-formula id="E7"><label>(7)</label><mml:math id="M7"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mover accent="true"><mml:mi>F</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mrow><mml:msubsup><mml:mo>∫</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>∞</mml:mi></mml:mrow><mml:mi>∞</mml:mi></mml:msubsup><mml:mrow><mml:mi>F</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>t</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>             </mml:mtext><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mrow><mml:msubsup><mml:mo>∫</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>∞</mml:mi></mml:mrow><mml:mi>∞</mml:mi></mml:msubsup><mml:mrow><mml:mi>F</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>τ</mml:mi><mml:mi>sin</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>r</mml:mi><mml:mi>cos</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo>−</mml:mo><mml:mi>τ</mml:mi><mml:mi>cos</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>r</mml:mi><mml:mi>sin</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
The angle of the RBC streaks in the line-scan image is determined by the angle θ<sub>max</sub> at which the maximum variance is found,
<disp-formula id="E8"><label>(8)</label><mml:math id="M8"><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>max</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mtext>max</mml:mtext></mml:mrow><mml:mrow><mml:mi>θ</mml:mi><mml:mo>∈</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mi>π</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mfrac><mml:mi>π</mml:mi><mml:mn>2</mml:mn></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mtext>Var</mml:mtext><mml:msub><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>F</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula>
Blood velocity (<italic>v</italic>) is then calculated by scaling the tangent of this angle by the temporal (Δ<italic>t</italic>) and spatial (Δ<italic>x</italic>) resolution of the image.</p>
        <p><disp-formula id="E9"><label>(9)</label><mml:math id="M9"><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mtext>tan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>max</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
One such Radon transform (angles spaced at 1°) is shown in Figure <xref ref-type="fig" rid="F4">4</xref>.</p>
        <fig id="F4" position="float">
          <label>Figure 4</label>
          <caption>
            <p><bold>Radon transform of a striped image <italic>F</italic>(<italic>x,t</italic>) using 1° step-size. (A)</bold> Sample Radon transforms at 5 example angles. <bold>(B)</bold> Radon transform space <inline-formula><mml:math id="M24"><mml:mrow><mml:mover accent="true"><mml:mi>F</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>θ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <bold>(C)</bold> variance at each angle spaced at 1°. Radon transforms at 5 selected angles in <bold>(A)</bold> are indicated by the red arrowheads on the Radon transform space in <bold>(B)</bold> and as red open circles on the variance plot in <bold>(C)</bold>. Peak in the variance at +45° signify the stripe angle of +45°.</p>
          </caption>
          <graphic xlink:href="fnins-07-00106-g0004"/>
        </fig>
      </sec>
      <sec>
        <title>Effect of pixel resolution of the image on the precision of velocity detection</title>
        <p>The Radon transform algorithm determines velocity from space-time images by detecting an angle with maximum variance in the Radon transform space of the sampled angle values. While the Radon transform space can be sampled at any set of angles, the angle steps finer than the precision offered by the image only add to the computational load. The angle detection also depends on the size of the space-time image, and on the spatial (Δ<italic>x</italic>) and temporal (Δ<italic>t</italic>) resolution. Therefore, it is important to consider the limitations imposed by these factors on the precision of the angle detection.</p>
        <p>A space-time image of width <italic>w</italic> pixels and height <italic>h</italic> pixels (representing the space and time dimensions of the image respectively) would cover the distance <italic>x</italic> and time <italic>t</italic> as follows,
<disp-formula id="E10"><label>(10)</label><mml:math id="M10"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mi>w</mml:mi><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:mi>Δ</mml:mi><mml:mi>x</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext> </mml:mtext><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mi>h</mml:mi><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
The finest detectable change in the angle using the Radon transform for such an image is dependent on the number of streaks (<italic>n</italic><sub><italic>s</italic></sub>) in the image and the finest detectable change in the angle from a single streak (δ<sub><italic>s</italic>1</sub>). Offsetting a single RBC streak trajectory by one pixel in the longer dimension of the streak can determine δ<sub><italic>s</italic>1</sub> (Figure <xref ref-type="fig" rid="F5">5</xref>). Assuming that only one streak in an image has changed the angle that is detectable with the Radon transform while other streaks maintained the same angle, the theoretically achievable finest detectable change in the angle (δ<sub><italic>n</italic></sub>) would be,
<disp-formula id="E11"><label>(11)</label><mml:math id="M11"><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p>
        <fig id="F5" position="float">
          <label>Figure 5</label>
          <caption>
            <p><bold>Detection of the change in the RBC streak angle is constrained by the pixel resolution of the image. (A,B)</bold> Black and red stripes originating from the same pixel but terminating with 2-pixel offset vertically <bold>(A)</bold> or horizontally <bold>(B)</bold>. Noticeable separation of the stripes starts at the mid-point where the stripes are offset by 1 pixel. <bold>(C,D)</bold> Schematic diagram of a space-time image with stripes representing RBC streaks with relatively vertical (|θ<sub>0</sub>| ≤ 45°, <bold>(C)</bold> or horizontal (|θ<sub>0</sub>|&gt; 45°, <bold>(D)</bold> streak angles. Red lines represent change in the RBC streak angle when the end of the streak is offset by 1 pixel in the longer dimension. Also see Materials and Methods for additional details on the detection sensitivity of the streak angle for an image.</p>
          </caption>
          <graphic xlink:href="fnins-07-00106-g0005"/>
        </fig>
        <p>In other words, the finest detectable change in the angle improves with an increase in the number of streaks in a given image. For a given RBC streak spanning <italic>w</italic><sub><italic>s</italic></sub> pixels in the space-dimension and <italic>h</italic><sub><italic>s</italic></sub> pixels in the time-dimension, δ<sub><italic>s</italic>1</sub> and <italic>n</italic><sub><italic>s</italic></sub> can be calculated as,
<disp-formula id="E12"><label>(12)</label><mml:math id="M12"><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtext> </mml:mtext><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mtext>arctan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mtext>arctan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mtext> </mml:mtext><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mtext>arctan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mtext>arctan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mtext> </mml:mtext><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>
<disp-formula id="E13"><label>(13)</label><mml:math id="M13"><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mrow><mml:mo>⌊</mml:mo><mml:mrow><mml:mfrac><mml:mi>x</mml:mi><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>⌋</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌊</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>w</mml:mi><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:mi>Δ</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>⌋</mml:mo></mml:mrow><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mtext> </mml:mtext><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>h</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>⌊</mml:mo><mml:mrow><mml:mfrac><mml:mi>t</mml:mi><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>⌋</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌊</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>h</mml:mi><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>⌋</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌊</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>h</mml:mi><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:mi>Δ</mml:mi><mml:mi>x</mml:mi><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>⌋</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>       </mml:mtext><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌊</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>t</mml:mi><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:mi>Δ</mml:mi><mml:mi>x</mml:mi><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>d</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mtext> </mml:mtext><mml:mo>·</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>⌋</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mtext> </mml:mtext><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>w</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula>
where <italic>n</italic><sub><italic>s</italic></sub> is the maximum number of streaks that can fit in the image. <italic>d</italic><sub><italic>s</italic></sub> and <italic>d</italic><sub><italic>t</italic></sub> are the minimum possible distance between two streaks in the space (in microns) and time (in seconds) dimensions, respectively. The streak angle (θ<sub>0</sub>) can be calculated by application of the Radon transform on the image. With a known θ<sub>0</sub>, estimation of <italic>w</italic><sub><italic>s</italic></sub> and <italic>h</italic><sub><italic>s</italic></sub> for an image of width <italic>w</italic> pixels and height <italic>h</italic> pixels can be made using,
<disp-formula id="E14"><label>(14)</label><mml:math id="M14"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mi>w</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mtext>min</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mrow><mml:mo>⌈</mml:mo><mml:mrow><mml:mi>h</mml:mi><mml:mtext> tan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>⌉</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext> </mml:mtext><mml:msub><mml:mi>h</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mtext>min</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mrow><mml:mo>⌈</mml:mo><mml:mrow><mml:mi>w</mml:mi><mml:mtext> cot</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>⌉</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
The precision of angle detection is dependent on image dimensions (<italic>w</italic> and <italic>h</italic>), the detected RBC streak angle from the image (θ<sub>0</sub>) and the number of RBC streaks that can fit in a recorded line-scan (<italic>n</italic><sub><italic>s</italic></sub>, which is in turn dependent on Δ<italic>x</italic>, <italic>w</italic>, and <italic>d</italic><sub><italic>s</italic></sub>). The actual distance between RBC streaks can be greater than <italic>d</italic><sub><italic>s</italic></sub>, making the actual number of streaks less than <italic>n</italic><sub><italic>s</italic></sub>. Therefore, the realistic angle precision from a given image can be lower than δ<sub><italic>n</italic></sub> but higher than δ<sub><italic>s</italic>1</sub>.</p>
      </sec>
      <sec>
        <title>Detection of change in the velocity is dependent on streak angle</title>
        <p>Change in the blood velocity in a given vessel depends on a number of factors such as vessel size, vessel type (artery, capillary, vein), anatomical location, and stimulus type and can range from 0 to 80% of the baseline blood velocity (Drew et al., <xref ref-type="bibr" rid="B8">2011</xref>; Shen et al., <xref ref-type="bibr" rid="B17">2012</xref>). Therefore, the sensitivity of the algorithm needs to accommodate the expected change in the blood velocity without being computationally expensive. This can be achieved by optimizing the angle step-size used for the Radon transform in order to detect the desirable change in velocity.</p>
        <p>The fractional change in velocity (Δ<italic>v</italic>/<italic>v</italic>) can be defined as,
<disp-formula id="E15"><label>(15)</label><mml:math id="M15"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>v</mml:mi></mml:mrow><mml:mi>v</mml:mi></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></disp-formula>
Where <italic>v</italic><sub>1</sub> is new velocity and <italic>v</italic><sub>0</sub> is initial velocity. The corresponding change in RBC streak angle, δ = |θ<sub>1</sub> − θ<sub>0</sub>|, can be computed by combining Equations 9 and 15 and rearranging the terms,
<disp-formula id="E16"><label>(16)</label><mml:math id="M16"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>v</mml:mi></mml:mrow><mml:mi>v</mml:mi></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext>tan</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mtext>1</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mtext>tan</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mtext>0</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext>tan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>±</mml:mo><mml:mi>δ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mtext>tan</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mtext>0</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></disp-formula>
<disp-formula id="E17"><label>(17)</label><mml:math id="M17"><mml:mrow><mml:mi>δ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mtext>arctan</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>v</mml:mi></mml:mrow><mml:mi>v</mml:mi></mml:mfrac><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>tan</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mtext>0</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
Thus, for the given RBC streak angle (θ<sub>0</sub>), δ can be determined instantaneously because it is dependent on the desired Δ<italic>v</italic>/<italic>v</italic>. Likewise, the precision of Δ<italic>v</italic>/<italic>v</italic> can be calculated from the value of δ used in the Radon transform and θ<sub>0</sub>. Note that the value of δ that can provide a given Δ<italic>v</italic>/<italic>v</italic> is the highest for θ<sub>0</sub> = 45°. Therefore, it is advantageous to perform line-scan imaging that yields ~45° streak angles. The smallest detectable δ, and therefore Δ<italic>v</italic>/<italic>v</italic>, is dependent on the pixel dimensions of the image and θ<sub>0</sub>. δ smaller than the theoretically achievable finest detectable change in the angle (δ<sub><italic>n</italic></sub>) cannot be resolved (see Equations 11–14 and Figure <xref ref-type="fig" rid="F6">6</xref>).</p>
        <fig id="F6" position="float">
          <label>Figure 6</label>
          <caption>
            <p><bold>Detection of fractional change in the velocity is dependent on the RBC streak angle and image dimensions. (A)</bold> Range of angle step-sizes (δ) that can be used in order to detect fractional change in the velocity (Δ<italic>v</italic>/<italic>v</italic>) of 0.1% on a 300 × 100 pixel image. Upper limit of δ that can be used is delineated by the blue dashed line. The solid orange line demarcates the detection sensitivities of -change in the angle (δ<sub><italic>n</italic></sub>) that can be resolved on image dimensions of 300 × 100 pixels for given streak angles. δ-values between these two curved lines should be used in order detect Δ<italic>v</italic>/<italic>v</italic> of 0.1%. <bold>(B)</bold> Limits imposed on δ by the required Δ<italic>v</italic>/<italic>v</italic> (dashed lines) and δ<sub><italic>n</italic></sub> for different image sizes (solid lines). Green shaded area corresponds to the δ values as shown in <bold>(A)</bold>. In order to achieve a given Δ<italic>v</italic>/<italic>v</italic> sensitivity, δ values should be below the respective Δ<italic>v</italic>/<italic>v</italic> curve, but above the δ<sub><italic>n</italic></sub> curve as determined by the image pixel dimensions. Note that the tolerance in the angle step-size values is highest at 45° streak angle. For a given image size an angle step-size value below the solid line is not resolvable. δ<sub><italic>n</italic></sub> calculations are based on a space-time image with 1.19 μm/pixel spatial resolution and inter-streak distance of 4 μm (~3.3 pixels).</p>
          </caption>
          <graphic xlink:href="fnins-07-00106-g0006"/>
        </fig>
      </sec>
      <sec>
        <title>Application of the iterative radon transform algorithm</title>
        <p>The size of angle steps used in the calculation of Radon transforms determines the precision of angle measurements. This creates a trade-off between the achieved precision of angle measurements and the computational load. In the first implementation of the Radon transform to calculate streak angle (Drew et al., <xref ref-type="bibr" rid="B7">2010</xref>), this trade-off was addressed by a two-step adaptive algorithm. First, relatively coarse angle steps of 1° were used to achieve the approximate angle. Second, finer angle steps of 0.25° around the measured angle were used. We refine the application of Radon transforms in a multi-step iterative manner to further optimize the balance between computational speed and precision of angle measurements.</p>
        <p>The iterative Radon transform is started by first applying Radon transforms in sparse angle space and then finding the angle that gives the maximum variance in the image. In subsequent iterations, sets of angles are used that are less sparse than the preceding iteration and centered on the angle that yielded the maximum variance in the previous iterations (Figure <xref ref-type="fig" rid="F7">7</xref>). The smallest angle step-size (δ) to be used for a given image depends on the δ<sub><italic>n</italic></sub>, θ<sub>0</sub>, and the desired Δ<italic>v</italic>/<italic>v</italic> (Equations 11, 17). Since the variance at 0° (vertical) is 0 when using a vertical Sobel filter, an angle selection of 0° should be avoided.</p>
        <fig id="F7" position="float">
          <label>Figure 7</label>
          <caption>
            <p><bold>Iterative Radon transform with progressively finer angle steps on subsequent iterations leads to precise angle measurements. (A)</bold> An image with 45° stripes after Sobel filtering. Color-matched lines represent angles of the first five Radon transform iterations. Additional iterations continue with step-size and angular span values that are half of the preceding iteration. <bold>(B)</bold> Radon variance plot, showing the variance of the Radon transform at 40 different angles corresponding to 10 iterations. The final angle step-size (δ) was approximately 0.0879° (Equation 19), sufficient to detect ~0.3% fractional change in the velocity (Δ<italic>v</italic>/<italic>v</italic>) for this particular streak angle (45°, Equation 16). The variance values are represented with open circles and the first five iterations are color-matched with the lines shown in <bold>(A)</bold>. Filled arrowheads of the corresponding colors in <bold>(A)</bold> and <bold>(B)</bold> represent the angle values for given iterations that were carried forward to the next iteration. Open arrowheads represent the angle values with the maximum variance for given iterations, but smaller than the one from the previous iterations, and therefore were not carried forward to the next iteration. <bold>(C)</bold> Algorithm outputs for the first five iterations showing the angle range, angle step-size, and final angle output at the end of the iteration. The angles with the maximum variance for a given iteration are marked in bold. Angle value 47.5° was found to have maximum variance in iteration 2, and was carried forward in proceeding iterations 3 and 4. This was because the maximum variances for the angle values in those iterations were smaller than that for 47.5° (Compare variances represented by open and filled arrowheads in <bold>(B)</bold>. In this example, the iterative Radon transform offered a 12-fold increase in the angle precision and was still 4.5-times faster than 180 successive Radon transforms with angles spaced by 1° (see Materials and Methods).</p>
          </caption>
          <graphic xlink:href="fnins-07-00106-g0007"/>
        </fig>
        <p>The first iteration of the algorithm uses four Radon transforms with a 45° angle step-size in order to span the full range of 180°. In the second iteration, again four Radon transforms with a 45° angle step-size are used with the center on the angle that yielded the maximum variance in the first iteration. Thus, the first two iterations give an angle resolution of 22.5°. In the subsequent iterations, four Radon transforms with an angle step-size half that of the previous iteration are used. i.e., 22.5° in the third iteration, 11.25° in the fourth iteration, and so on. The number of iterations, <italic>i</italic><sub>irt</sub>, required for achieving a given angle precision can be described as,
<disp-formula id="E18"><label>(18)</label><mml:math id="M18"><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mrow><mml:mtext>irt</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mtext>log</mml:mtext></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>45</mml:mn></mml:mrow><mml:mi>δ</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>⌉</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></disp-formula>
Conversely, the precision achieved by a given number of iterations would be,
<disp-formula id="E19"><label>(19)</label><mml:math id="M19"><mml:mrow><mml:mi>δ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>45</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mn>2</mml:mn><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mrow><mml:mtext>irt</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula>
Since each iteration performs four Radon transforms, the total number of Radon transforms (<italic>n</italic><sub>irt</sub>) used in the iterative Radon transform algorithm is,
<disp-formula id="E20"><label>(20)</label><mml:math id="M20"><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mtext>irt</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>4</mml:mn><mml:msub><mml:mi>i</mml:mi><mml:mrow><mml:mtext>irt</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="results" id="s3">
    <title>Results</title>
    <sec>
      <title>Effects of sobel filtering on measured streak angle accuracy</title>
      <p>Since for blood velocity the feature of interest in a given line-scan image is the streaks resulting from plasma-RBC “junctions,” it is important to ignore all the other elements of the image by minimizing them and/or enhancing the plasma-RBC junction. The vertical Sobel filter achieves this by removing low frequency changes in pixel luminance in the time dimension of the image. Removing the aggregate mean of the image by subtracting it from each pixel of the image (whole-image demeaning) and removing the mean value across time at each spatial point of the line (temporal demeaning, vertical in our case) has been proposed previously for pre-processing of the image before performing Radon transforms (Drew et al., <xref ref-type="bibr" rid="B7">2010</xref>). However, these methods do not effectively minimize the column-to-column variations in the luminance. Such differences are more pronounced when the image segments used for the Radon transform are small and/or the widths of the RBC streaks are wide for the given dimensions of the image segments (Figure <xref ref-type="fig" rid="F8">8A</xref>). Although subtle, these column-to-column variations in luminance (Figure <xref ref-type="fig" rid="F8">8B</xref>) lead to sub-optimal detection of streak angles. Application of Sobel filtering minimizes these variations and detected angles become more accurate (Figure <xref ref-type="fig" rid="F8">8C</xref>). For instance, the Radon transform of an image with 45° streak angle gives an angle of 44.88° after vertical demeaning while the same image after Sobel filtering gives an angle of 44.98°. This error of 0.1° at a 45° streak angle can lead to an error of ~0.35% in detected Δ<italic>v</italic>/<italic>v</italic> (Equation 16). To further confirm the accuracy offered by Sobel filtering, we compared the differences in the measured angles from the actual angles on simulated line-scan images that were Sobel filtered versus vertically demeaned. A range of angles was tested with each angle having a sample size of <italic>n</italic> = 36 images (112 × 215 pixels, <italic>w</italic> × <italic>h</italic>), differing slightly in the spatial position of the streak. We found that angles measured on Sobel filtered images are more accurate when compared with the same image sequences that were vertically demeaned (Figure <xref ref-type="fig" rid="F8">8D</xref>). For much longer time-dimension images (200 × 1000 pixels, <italic>w</italic> × <italic>h</italic>), the improved accuracy on Sobel filtered images was retained, even though overall error rates were reduced with both types of filtering (data not shown).</p>
      <fig id="F8" position="float">
        <label>Figure 8</label>
        <caption>
          <p><bold>Effect of Sobel filtering on the accuracy of angle measurements when using the Radon transform. (A)</bold> Radon transforms on a simulated image of 45° orderly streaks after subtracting the mean luminance from the image. Resulting angle of 44.88° (dashed green lines) represents a 0.12° deviation from the actual angle. <bold>(B)</bold> Vertical demeaning leads to the same angle measurement as shown in <bold>(A)</bold>. The orderly vertical bands (highlighted by white arrows) are the result of different mean luminance across columns of the original image. <bold>(C)</bold> Vertical Sobel filtering of the image shown in <bold>(A)</bold> gives 44.98° (dashed black lines) on the Radon transform, an error of 0.02°. Thirteen iterations of the Radon transforms (52 Radon transforms) resulted in an angle step-size of ~0.002° (see Equation 19). <bold>(D)</bold> Sobel filtered images offer more accurate angle measurements when compared with vertically demeaned images. Mean ± SD of absolute difference in measured angles on simulated images are shown. Each angle value consists of results from <italic>n</italic> = 36 images with streaks at different spatial locations. Statistically significant differences are represented by a red asterisk for a given angle (<italic>p</italic> &lt; 0.05, two-sample <italic>t</italic>-test).</p>
        </caption>
        <graphic xlink:href="fnins-07-00106-g0008"/>
      </fig>
      <p>In line-scan images acquired for blood velocity measurements, the Sobel filter acts as a high-pass filter by enhancing RBC streak margins while suppressing small line-to-line changes in pixel luminance. As a result, only the angle of RBC streak margins (plasma-RBC junctions) provides high variance in the Radon transform space. This improves the accuracy and precision of measuring the angle, and in turn velocity. Sobel filtering can be applied to line-scan images which have both thick (Figure <xref ref-type="fig" rid="F9">9</xref>) and thin (Figure <xref ref-type="fig" rid="F10">10</xref>) RBC streaks. In line-scan images contaminated by brain movements that are due to transmitted pulsations from heartbeats (Figure <xref ref-type="fig" rid="F9">9B</xref>), vertical demeaning fails to suppress time-varying artifacts (Figure <xref ref-type="fig" rid="F9">9C</xref>) and leads to incorrect RBC streak angle detection (Figure <xref ref-type="fig" rid="F9">9E</xref>). Apart from suppressing artifacts, Sobel filtering also enhances the RBC streak edges (Figure <xref ref-type="fig" rid="F9">9D</xref>) leading to an angle measurement with the iterative Radon transform algorithm that matches the actual RBC streak angle and therefore velocity (Figure <xref ref-type="fig" rid="F9">9F</xref>). We also compared the angles measured after Sobel filtering vs. vertical demeaning over a long sequence of 35,000 contiguous line-scans (see Figure <xref ref-type="fig" rid="F9">9G</xref>). We found that ~37% (<italic>n</italic> = 515) of image segments after vertical demeaning failed to accurately measure RBC streak angles, but no such errors were obtained when using Sobel filtered image segments (Figure <xref ref-type="fig" rid="F9">9G</xref>).</p>
      <fig id="F9" position="float">
        <label>Figure 9</label>
        <caption>
          <p><bold>Improvement in the angle measurement using Sobel filtering on an image with motion artifacts. (A)</bold> Reference full-frame image of a 5 μm diameter microvessel in the cat visual cortex. The line-scan trajectory is shown as a red line. <bold>(B)</bold> Line-scan image from the microvessel. Continuous dark vertical bands are due to line-scan path going out of the vessel and the intermittent horizontal dark bands are related to brain motion due to transmitted heartbeat movements. <bold>(C)</bold> Vertically (temporally) demeaned image of <bold>(B)</bold> leads to incorrect angle and velocity estimation at some image segments (see horizontal dashed yellow lines). Note the suppression of time-invariant vertical bands, but virtually unchanged time-varying horizontal bands. <bold>(D)</bold> Sobel filtered image of <bold>(B)</bold> leads to suppression of both types of artifacts and enhancement of RBC streak edges. Dashed yellow lines represent measured angles over image segments of 100 lines. <bold>(E,F)</bold> Angle <bold>(E)</bold> and velocity <bold>(F)</bold> measurements obtained after vertical demeaning (green traces) and Sobel filtering (black traces). Circles represent the dashed lines shown in <bold>(C)</bold> and <bold>(D)</bold>. Incorrectly measured angle/velocity values are connected with dashed lines and correspond to horizontal dashed lines in <bold>(C)</bold>. <bold>(G)</bold> Distribution of measured angles after Vertical demeaning (green) or Sobel filtering (black). A total of 35,000 contiguous line-scans were collected from the microvessel shown in <bold>(A)</bold> to create 1396 overlapping 100-line image segments. Incorrectly measured angles are clustered at ±90° and evident only after vertical demeaning. δ of ~0.011° was used in order to achieve Δ<italic>v</italic>/<italic>v</italic> of &lt;0.1% (see Equation 17) on the overlapping image segments of 100 lines which offered δ<sub><italic>n</italic></sub> of ~0.003° (see Equations 11–14).</p>
        </caption>
        <graphic xlink:href="fnins-07-00106-g0009"/>
      </fig>
      <fig id="F10" position="float">
        <label>Figure 10</label>
        <caption>
          <p><bold>Application of Sobel filtering on an image with thin RBC streaks. (A)</bold> Reference full-frame image of a 14 μm diameter venule in the cat visual cortex. The line-scan trajectory is shown as a red line. <bold>(B)</bold> Line-scan image from the microvessel showing thin, near-horizontal RBC streaks. <bold>(C)</bold> Vertically demeaned image of <bold>(B)</bold> showing measured RBC streak angle and velocity (dashed yellow lines). <bold>(D)</bold> Sobel filtered image of <bold>(B)</bold> shows RBC streak enhancement, measured RBC streak angle and velocity. Dashed yellow lines represent measured angles over image segments of 100 lines. <bold>(E,F)</bold> Angle <bold>(E)</bold> and velocity <bold>(F)</bold> traces after vertical demeaning (green traces) and Sobel filtering (black traces). Circles represent the dashed lines shown in <bold>(C)</bold> and <bold>(D)</bold>. Subtle difference in the values is the result of different filtering (also see Figure <xref ref-type="fig" rid="F8">8</xref>). δ of ~0.0055° was used in order to achieve Δ<italic>v</italic>/<italic>v</italic> of &lt;0.1% (see Equation 17) on the overlapping image segments of 100 lines which offered δ<sub><italic>n</italic></sub> of &lt;0.001° (see Equations 11–14).</p>
        </caption>
        <graphic xlink:href="fnins-07-00106-g0010"/>
      </fig>
      <p>Sobel filtering preserves the streak angle information in the images with thin, relatively horizontal RBC streaks (Figure <xref ref-type="fig" rid="F10">10</xref>). In line-scan images with very thin RBC streaks (Figure <xref ref-type="fig" rid="F10">10B</xref>), the Sobel filter enhances the RBC streak edges (Figure <xref ref-type="fig" rid="F10">10D</xref>) when compared with vertical demeaning (Figure <xref ref-type="fig" rid="F10">10C</xref>), leading to detected angle values that are different from the vertically demeaned image (Figure <xref ref-type="fig" rid="F10">10E</xref>). The ~0.6° difference in the computed angle between the two filtering methods at ~0.45 s in Figure <xref ref-type="fig" rid="F10">10E</xref> at the RBC streak angle of ~83° translates into a Δ<italic>v</italic>/<italic>v</italic> of ~8% (Equation 16), or ~0.16 mm/s in this case (Figure <xref ref-type="fig" rid="F10">10F</xref>). As the streaks become more horizontal, the difference between true and measured angle becomes similar after both vertical demeaning and Sobel filtering (see Figure <xref ref-type="fig" rid="F8">8D</xref>). Therefore, in the absence of time-varying artifacts, Sobel filtering provides little enhancement for images with very horizontal streaks.</p>
    </sec>
    <sec>
      <title>Improved speed and precision of velocity measurements with iterative radon transforms</title>
      <p>Blood velocity measurements can only be as precise as the angle step-size used in the Radon transform. But decreasing the step-size to improve precision results in additional Radon transforms and increased computation time. The iterative Radon transform method helps overcome this trade-off. The total number of Radon transforms required by the traditional non-iterative method (<italic>n</italic><sub>trt</sub>) spanning the full range of 180° for the step-size (δ) would be,
<disp-formula id="E21"><label>(21)</label><mml:math id="M21"><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mtext>trt</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>⌈</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>180</mml:mn></mml:mrow><mml:mi>δ</mml:mi></mml:mfrac></mml:mrow><mml:mo>⌉</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
Compared to the traditional non-iterative method, the method described here requires an order of magnitude fewer Radon transforms. Based on Equations 18, 20, and 21, the relationship between the total number of Radon transforms required by the traditional non-iterative method (<italic>n</italic><sub>trt</sub>) and the iterative method (<italic>n</italic><sub>irt</sub>) is,
<disp-formula id="E22"><label>(22)</label><mml:math id="M22"><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mtext>irt</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>4</mml:mn><mml:mrow><mml:mo>⌈</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mtext>log</mml:mtext></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mtext>trt</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>⌉</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula>
The angle precision (δ) of 1° requires 180 Radon transforms with the non-iterative method but only 28 using the iterative method. Similarly, an angle precision of 0.01° would require 18,000 Radon transforms if performed non-iteratively, but can be resolved with only 56 Radon transforms using the iterative method (Figure <xref ref-type="fig" rid="F11">11</xref>). The iterative Radon transform method overcomes the speed-precision trade-off by starting with sparse sampling of the angles and then sampling progressively finer angles in the subsequent iterations centered around the angle with the highest variance (see Materials and Methods).</p>
      <fig id="F11" position="float">
        <label>Figure 11</label>
        <caption>
          <p><bold>Iterative Radon transform method markedly reduces the required number of Radon transforms (<italic>n</italic><sub>irt</sub>) to achieve a given angle precision (δ) when compared with non-iterative method (<italic>n</italic><sub>trt</sub>).</bold> The number of Radon transforms in the iterative algorithm increases logarithmically as δ becomes finer, compared to a linear increase for the traditional, non-iterative counterpart. As a result, there is an exponential increase in the computation speed for the iterative algorithm compared to the traditional non-iterative Radon transform methods. Results are based on Equations 18–22.</p>
        </caption>
        <graphic xlink:href="fnins-07-00106-g0011"/>
      </fig>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s4">
    <title>Discussion</title>
    <p>The hybrid algorithm presented here performs pre-processing of the image followed by iterative application of Radon transforms. Pre-processing of the images with Sobel filtering has an advantage over vertical demeaning in that it removes the slow time-varying artifacts in addition to time-invariant artifacts. This is especially useful in large animal preparations where brain movement artifacts due to respiration and heartbeats are sometimes difficult to eliminate. Such artifacts lead to line-scan images with discontinuous RBC streaks and/or uneven or varying background luminance. Additionally, Sobel filtering also enhances the RBC streak margins. Other types of filtering using operators similar to Sobel, e.g., Prewitt or Scharr operators can also be used with equivalent results.</p>
    <p>Sobel filtering results in an increased contrast at the plasma-RBC junctions. Because the Sobel operator we use is oriented vertically, the margins of relatively horizontal streaks are enhanced more than vertical streaks. Completely vertical RBC streaks appear in cases of stagnant blood flow (Kleinfeld et al., <xref ref-type="bibr" rid="B12">1998</xref>). In these situations, any vertical operator (including Sobel, vertical demeaning) will suppress the streaks and therefore should be avoided. The detection of the correct angle using the iterative Radon transform is dependent on the SNR of the Sobel filtered image. We found in our simulations that almost vertical stripes (angle &lt; 1°) can be efficiently detected using the iterative Radon transform algorithm after Sobel filtering. However, the detection is less robust to noise than in the case of stripes with higher angle values. More generally, velocity measurements using the algorithm described here will produce the best results provided that the angles of the RBC streaks are close to 45° (see Materials and Methods).</p>
    <p>Changes in velocity due to heart rate pulsations can be substantial (see Figures <xref ref-type="fig" rid="F9">9</xref>, <xref ref-type="fig" rid="F10">10</xref>) and may exceed the changes due to sensory stimulus-evoked responses. However, the Δ<italic>v</italic>/<italic>v</italic> induced by heart rate pulsations has the frequency range of 3–8 Hz which is much higher than a typical &lt;1 Hz Δ<italic>v</italic>/<italic>v</italic> evoked by a given sensory stimulus (Kleinfeld et al., <xref ref-type="bibr" rid="B12">1998</xref>; Chaigneau et al., <xref ref-type="bibr" rid="B4">2003</xref>; Berwick et al., <xref ref-type="bibr" rid="B3">2008</xref>; Drew et al., <xref ref-type="bibr" rid="B8">2011</xref>; Shen et al., <xref ref-type="bibr" rid="B17">2012</xref>). Therefore, such physiological Δ<italic>v</italic>/<italic>v</italic> can be band-pass filtered using Fourier transform methods to generate more accurate measurements of stimulus-evoked Δ<italic>v</italic>/<italic>v</italic>. A low-pass filtering can also be achieved by averaging the velocities over time-windows that span multiple cardiac cycles. Alternatively, the collected line-scan data can be consistently phase-locked to the cardiac cycle by triggering line-scan imaging at a particular phase of the cardiac cycle, e.g., using QRS complex as a trigger. The angle step-size (δ) we used for Figures <xref ref-type="fig" rid="F9">9</xref>, <xref ref-type="fig" rid="F10">10</xref> were ~0.01° and ~0.005°, respectively, in order to achieve the desired detection sensitivities of 0.1% Δ<italic>v</italic>/<italic>v</italic> (see Equation 17). However, if the experimental paradigm does not demand detection of minute changes and/or wider range in the velocities, the user may choose a bigger δ and/or narrow starting angle range for even faster computation speeds.</p>
    <p>Iterative application of the Radon transform resulted in an order of magnitude faster determination of blood velocity when compared with other algorithms of blood velocity measurements. When testing simulated line-scan data with RBC streak shifts ranging from 10 to 80 pixels per line and using ~0.1° angle precisions on a 200 × 15,000 image, our algorithm was ~6.5× faster than the correlation-based method (Kim et al., <xref ref-type="bibr" rid="B11">2012</xref>). However, the correlation-based method offers superior velocity measurements in some instances of near-horizontal RBC streaks. A spatial frequency-based analysis claims 1.25× faster performance over Radon transform when using 1° angle step-size spanning 180° (Autio et al., <xref ref-type="bibr" rid="B2">2011</xref>). Our algorithm achieves this precision in only 28 Radon transforms (Equation 22), making it 6.4× faster than the Radon transform when applied in a non-iterative manner. Thus, the advantage offered by the iterative implementation makes our algorithm 5.14× faster compared with a spatial frequency-based analysis. The “fasttrack” algorithm that uses global energy minimization technique claims superior velocity measurements than Radon transform in near-horizontal RBC streaks, but is generally 5× slower than traditional Radon transform (Deneux et al., <xref ref-type="bibr" rid="B5">2011</xref>, <xref ref-type="bibr" rid="B6">2012</xref>). Conservatively estimating a 6.4× speed improvement offered by the iterative implementation of Radon transforms over its non-iterative counterpart makes our algorithm 32× faster than the “fasttrack” algorithm. Furthermore, Sobel filtering followed by very fine angle measurements in an iterative manner eliminates the likelihood of detecting false angles that can otherwise occur when line-to-line discontinuities of RBCs are present in space-time images. The global energy minimization technique appears to have a comparable accuracy to the standard Radon transform method when RBC streaks are not near horizontal (Deneux et al., <xref ref-type="bibr" rid="B5">2011</xref>). The apparently poor performance of the Radon transform algorithm on detecting near-horizontal RBC streaks (high velocities) in the study by Deneux and colleagues may be due the use of relatively coarse angle steps and incomplete removal of slow time-varying luminance variations in the images that are unrelated to the flow of RBCs.</p>
    <p>In summary, we present a method of accurately and precisely measuring blood velocities from line-scan images in a computationally efficient manner. First, Sobel filtering is used to remove slow time-varying artifacts and enhance the edges of RBC streaks. This leads to accurate estimation of RBC streak angles and thus blood velocity measurements. Second, the iterative Radon transform minimizes the required number of Radon transforms needed to precisely estimate the RBC streak angle. This leads to fast RBC streak angle measurements. The near-ideal precision attained with the iterative Radon method together with the high accuracy provided by Sobel filtering ensures that relatively small differences in baseline vs. stimulus-evoked RBC streak angles can be measured. This is a non-trivial advance because data collected from <italic>in vivo</italic> experiments include movement artifacts. Such data may otherwise be discarded, or if used would lead to erroneous measurements. More generally, the individual components of our algorithm can be used independently for a broad range of particle velocity applications. For example, Sobel filtering of noisy space-time images collected for tracking the movement of any particle can lead to improvement in the SNR by enhancing the particle streak edges. The concept of iterative image analysis can be used to speed-up other algorithms that have been used to calculate the slope of RBC streaks (Drew et al., <xref ref-type="bibr" rid="B7">2010</xref>; Duncan et al., <xref ref-type="bibr" rid="B9">2010</xref>, Autio et al., <xref ref-type="bibr" rid="B2">2011</xref>). Our hybrid algorithm (in its entirety or as individual components) can also be used for real-time implementation of velocity calculations in high-speed imaging applications that use resonant or acousto-optic deflector scanners.</p>
    <sec>
      <title>Conflict of interest statement</title>
      <p>The authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest.</p>
    </sec>
  </sec>
</body>
<back>
  <ack>
    <p>We thank S. Yurgenson for analytical discussions; P. O'Herron, M. Levy, and A. Schramm for comments on the manuscript. This work was supported by grants from the US National Eye Institute (R01EY017925) and the Dana Foundation to Prakash Kara.</p>
  </ack>
  <sec sec-type="supplementary material" id="s5">
    <title>Supplementary material</title>
    <p>The source code to run the hybrid algorithm is available online at: <ext-link ext-link-type="uri" xlink:href="http://www.frontiersin.org/Brain_Imaging_Methods/10.3389/fnins.2013.00106/abstract">http://www.frontiersin.org/Brain_Imaging_Methods/10.3389/fnins.2013.00106/abstract</ext-link> and Matlab Central File Exchange at: <ext-link ext-link-type="uri" xlink:href="http://www.mathworks.com/matlabcentral/fileexchange/42019-hybridvel">http://www.mathworks.com/matlabcentral/fileexchange/42019-hybridvel</ext-link></p>
    <supplementary-material content-type="local-data">
      <media xlink:href="DataSheet1.ZIP" mimetype="application" mime-subtype="x-zip-compressed">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Akerboom</surname><given-names>J.</given-names></name><name><surname>Carreras Calderon</surname><given-names>N.</given-names></name><name><surname>Tian</surname><given-names>L.</given-names></name><name><surname>Wabnig</surname><given-names>S.</given-names></name><name><surname>Prigge</surname><given-names>M.</given-names></name><name><surname>Tolo</surname><given-names>J.</given-names></name><etal/></person-group> (<year>2013</year>). <article-title>Genetically encoded calcium indicators for multi-color neural activity imaging and combination with optogenetics</article-title>. <source>Front. Mol. Neurosci</source>. <volume>6</volume>:<issue>2</issue>
<pub-id pub-id-type="doi">10.3389/fnmol.2013.00002</pub-id><?supplied-pmid 23459413?><pub-id pub-id-type="pmid">23459413</pub-id></mixed-citation>
    </ref>
    <ref id="B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Autio</surname><given-names>J.</given-names></name><name><surname>Kawaguchi</surname><given-names>H.</given-names></name><name><surname>Saito</surname><given-names>S.</given-names></name><name><surname>Aoki</surname><given-names>I.</given-names></name><name><surname>Obata</surname><given-names>T.</given-names></name><name><surname>Masamoto</surname><given-names>K.</given-names></name><etal/></person-group> (<year>2011</year>). <article-title>Spatial frequency-based analysis of mean red blood cell speed in single microvessels: investigation of microvascular perfusion in rat cerebral cortex</article-title>. <source>PLoS ONE</source>
<volume>6</volume>:<fpage>e24056</fpage>
<pub-id pub-id-type="doi">10.1371/journal.pone.0024056</pub-id><?supplied-pmid 21887370?><pub-id pub-id-type="pmid">21887370</pub-id></mixed-citation>
    </ref>
    <ref id="B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berwick</surname><given-names>J.</given-names></name><name><surname>Johnston</surname><given-names>D.</given-names></name><name><surname>Jones</surname><given-names>M.</given-names></name><name><surname>Martindale</surname><given-names>J.</given-names></name><name><surname>Martin</surname><given-names>C.</given-names></name><name><surname>Kennerley</surname><given-names>A. J.</given-names></name></person-group> (<year>2008</year>). <article-title>Fine detail of neurovascular coupling revealed by spatiotemporal analysis of the hemodynamic response to single whisker stimulation in rat barrel cortex</article-title>. <source>J. Neurophysiol</source>. <volume>99</volume>, <fpage>787</fpage>–<lpage>798</lpage>
<pub-id pub-id-type="doi">10.1152/jn.00658.2007</pub-id><?supplied-pmid 18046008?><pub-id pub-id-type="pmid">18046008</pub-id></mixed-citation>
    </ref>
    <ref id="B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chaigneau</surname><given-names>E.</given-names></name><name><surname>Oheim</surname><given-names>M.</given-names></name><name><surname>Audinat</surname><given-names>E.</given-names></name><name><surname>Charpak</surname><given-names>S.</given-names></name></person-group> (<year>2003</year>). <article-title>Two-photon imaging of capillary blood flow in olfactory bulb glomeruli</article-title>. <source>Proc. Natl. Acad. Sci. U.S.A</source>. <volume>100</volume>, <fpage>13081</fpage>–<lpage>13086</lpage>
<pub-id pub-id-type="doi">10.1073/pnas.2133652100</pub-id><?supplied-pmid 14569029?><pub-id pub-id-type="pmid">14569029</pub-id></mixed-citation>
    </ref>
    <ref id="B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Deneux</surname><given-names>T.</given-names></name><name><surname>Faugeras</surname><given-names>O.</given-names></name><name><surname>Takerkart</surname><given-names>S.</given-names></name><name><surname>Masson</surname><given-names>G. S.</given-names></name><name><surname>Vanzetta</surname><given-names>I.</given-names></name></person-group> (<year>2011</year>). <article-title>A new variational method for erythrocyte velocity estimation in wide-field imaging <italic>in vivo</italic></article-title>. <source>IEEE Trans. Med. Imaging</source>
<volume>30</volume>, <fpage>1527</fpage>–<lpage>1545</lpage>
<pub-id pub-id-type="doi">10.1109/TMI.2011.2131151</pub-id><?supplied-pmid 21427018?><pub-id pub-id-type="pmid">21427018</pub-id></mixed-citation>
    </ref>
    <ref id="B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Deneux</surname><given-names>T.</given-names></name><name><surname>Takerkart</surname><given-names>S.</given-names></name><name><surname>Grinvald</surname><given-names>A.</given-names></name><name><surname>Masson</surname><given-names>G. S.</given-names></name><name><surname>Vanzetta</surname><given-names>I.</given-names></name></person-group> (<year>2012</year>). <article-title>A processing work-flow for measuring erythrocytes velocity in extended vascular networks from wide field high-resolution optical imaging data</article-title>. <source>Neuroimage</source>
<volume>59</volume>, <fpage>2569</fpage>–<lpage>2588</lpage>
<pub-id pub-id-type="doi">10.1016/j.neuroimage.2011.08.081</pub-id><?supplied-pmid 21925275?><pub-id pub-id-type="pmid">21925275</pub-id></mixed-citation>
    </ref>
    <ref id="B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Drew</surname><given-names>P. J.</given-names></name><name><surname>Blinder</surname><given-names>P.</given-names></name><name><surname>Cauwenberghs</surname><given-names>G.</given-names></name><name><surname>Shih</surname><given-names>A. Y.</given-names></name><name><surname>Kleinfeld</surname><given-names>D.</given-names></name></person-group> (<year>2010</year>). <article-title>Rapid determination of particle velocity from space-time images using the Radon transform</article-title>. <source>J. Comput. Neurosci</source>. <volume>29</volume>, <fpage>5</fpage>–<lpage>11</lpage>
<pub-id pub-id-type="doi">10.1007/s10827-009-0159-1</pub-id><?supplied-pmid 19459038?><pub-id pub-id-type="pmid">19459038</pub-id></mixed-citation>
    </ref>
    <ref id="B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Drew</surname><given-names>P. J.</given-names></name><name><surname>Shih</surname><given-names>A. Y.</given-names></name><name><surname>Kleinfeld</surname><given-names>D.</given-names></name></person-group> (<year>2011</year>). <article-title>Fluctuating and sensory-induced vasodynamics in rodent cortex extend arteriole capacity</article-title>. <source>Proc. Natl. Acad. Sci. U.S.A</source>. <volume>108</volume>, <fpage>8473</fpage>–<lpage>8478</lpage>
<pub-id pub-id-type="doi">10.1073/pnas.1100428108</pub-id><?supplied-pmid 21536897?><pub-id pub-id-type="pmid">21536897</pub-id></mixed-citation>
    </ref>
    <ref id="B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Duncan</surname><given-names>D. D.</given-names></name><name><surname>Lemaillet</surname><given-names>P.</given-names></name><name><surname>Ibrahim</surname><given-names>M.</given-names></name><name><surname>Nguyen</surname><given-names>Q. D.</given-names></name><name><surname>Hiller</surname><given-names>M.</given-names></name><name><surname>Ramella-Roman</surname><given-names>J.</given-names></name></person-group> (<year>2010</year>). <article-title>Absolute blood velocity measured with a modified fundus camera</article-title>. <source>J. Biomed. Opt</source>. <volume>15</volume>:<fpage>056014</fpage>
<pub-id pub-id-type="doi">10.1117/1.3494565</pub-id><?supplied-pmid 21054108?><pub-id pub-id-type="pmid">21054108</pub-id></mixed-citation>
    </ref>
    <ref id="B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kamoun</surname><given-names>W. S.</given-names></name><name><surname>Chae</surname><given-names>S. S.</given-names></name><name><surname>Lacorre</surname><given-names>D. A.</given-names></name><name><surname>Tyrrell</surname><given-names>J. A.</given-names></name><name><surname>Mitre</surname><given-names>M.</given-names></name><name><surname>Gillissen</surname><given-names>M. A.</given-names></name><etal/></person-group> (<year>2010</year>). <article-title>Simultaneous measurement of RBC velocity, flux, hematocrit and shear rate in vascular networks</article-title>. <source>Nat. Methods</source>
<volume>7</volume>, <fpage>655</fpage>–<lpage>660</lpage>
<pub-id pub-id-type="doi">10.1038/nmeth.1475</pub-id><?supplied-pmid 20581828?><pub-id pub-id-type="pmid">20581828</pub-id></mixed-citation>
    </ref>
    <ref id="B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>T. N.</given-names></name><name><surname>Goodwill</surname><given-names>P. W.</given-names></name><name><surname>Chen</surname><given-names>Y.</given-names></name><name><surname>Conolly</surname><given-names>S. M.</given-names></name><name><surname>Schaffer</surname><given-names>C. B.</given-names></name><name><surname>Liepmann</surname><given-names>D.</given-names></name><etal/></person-group> (<year>2012</year>). <article-title>Line-scanning particle image velocimetry: an optical approach for quantifying a wide range of blood flow speeds in live animals</article-title>. <source>PLoS ONE</source>
<volume>7</volume>:<fpage>e38590</fpage>
<pub-id pub-id-type="doi">10.1371/journal.pone.0038590</pub-id><?supplied-pmid 22761686?><pub-id pub-id-type="pmid">22761686</pub-id></mixed-citation>
    </ref>
    <ref id="B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kleinfeld</surname><given-names>D.</given-names></name><name><surname>Mitra</surname><given-names>P. P.</given-names></name><name><surname>Helmchen</surname><given-names>F.</given-names></name><name><surname>Denk</surname><given-names>W.</given-names></name></person-group> (<year>1998</year>). <article-title>Fluctuations and stimulus-induced changes in blood flow observed in individual capillaries in layers 2 through 4 of rat neocortex</article-title>. <source>Proc. Natl. Acad. Sci. U.S.A</source>. <volume>95</volume>, <fpage>15741</fpage>–<lpage>15746</lpage>
<pub-id pub-id-type="doi">10.1073/pnas.95.26.15741</pub-id><?supplied-pmid 9861040?><pub-id pub-id-type="pmid">9861040</pub-id></mixed-citation>
    </ref>
    <ref id="B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Levy</surname><given-names>M.</given-names></name><name><surname>Schramm</surname><given-names>A. E.</given-names></name><name><surname>Kara</surname><given-names>P.</given-names></name></person-group> (<year>2012</year>). <article-title>Strategies for mapping synaptic inputs on dendrites <italic>in vivo</italic> by combining two-photon microscopy, sharp intracellular recording, and pharmacology</article-title>. <source>Front. Neural Circuits</source>
<volume>6</volume>:<issue>101</issue>
<pub-id pub-id-type="doi">10.3389/fncir.2012.00101</pub-id><?supplied-pmid 23248588?><pub-id pub-id-type="pmid">23248588</pub-id></mixed-citation>
    </ref>
    <ref id="B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>O'Herron</surname><given-names>P.</given-names></name><name><surname>Shen</surname><given-names>Z.</given-names></name><name><surname>Lu</surname><given-names>Z.</given-names></name><name><surname>Schramm</surname><given-names>A. E.</given-names></name><name><surname>Levy</surname><given-names>M.</given-names></name><name><surname>Kara</surname><given-names>P.</given-names></name></person-group> (<year>2012</year>). <article-title>Targeted labeling of neurons in a specific functional micro-domain of the neocortex by combining intrinsic signal and two-photon imaging</article-title>. <source>J. Vis. Exp</source>. <volume>70</volume>:<fpage>e50025</fpage>
<pub-id pub-id-type="doi">10.3791/50025</pub-id><?supplied-pmid 23271035?><pub-id pub-id-type="pmid">23271035</pub-id></mixed-citation>
    </ref>
    <ref id="B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ohki</surname><given-names>K.</given-names></name><name><surname>Chung</surname><given-names>S.</given-names></name><name><surname>Ch'ng</surname><given-names>Y. H.</given-names></name><name><surname>Kara</surname><given-names>P.</given-names></name><name><surname>Reid</surname><given-names>R. C.</given-names></name></person-group> (<year>2005</year>). <article-title>Functional imaging with cellular resolution reveals precise micro-architecture in visual cortex</article-title>. <source>Nature</source>
<volume>433</volume>, <fpage>597</fpage>–<lpage>603</lpage>
<pub-id pub-id-type="doi">10.1038/nature03274</pub-id><?supplied-pmid 15660108?><pub-id pub-id-type="pmid">15660108</pub-id></mixed-citation>
    </ref>
    <ref id="B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schaffer</surname><given-names>C. B.</given-names></name><name><surname>Friedman</surname><given-names>B.</given-names></name><name><surname>Nishimura</surname><given-names>N.</given-names></name><name><surname>Schroeder</surname><given-names>L. F.</given-names></name><name><surname>Tsai</surname><given-names>P. S.</given-names></name><name><surname>Ebner</surname><given-names>F. F.</given-names></name><etal/></person-group> (<year>2006</year>). <article-title>Two-photon imaging of cortical surface microvessels reveals a robust redistribution in blood flow after vascular occlusion</article-title>. <source>PLoS Biol</source>. <volume>4</volume>:<fpage>e22</fpage>
<pub-id pub-id-type="doi">10.1371/journal.pbio.0040022</pub-id><?supplied-pmid 16379497?><pub-id pub-id-type="pmid">16379497</pub-id></mixed-citation>
    </ref>
    <ref id="B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shen</surname><given-names>Z.</given-names></name><name><surname>Lu</surname><given-names>Z.</given-names></name><name><surname>Chhatbar</surname><given-names>P. Y.</given-names></name><name><surname>O'Herron</surname><given-names>P.</given-names></name><name><surname>Kara</surname><given-names>P.</given-names></name></person-group> (<year>2012</year>). <article-title>An artery-specific fluorescent dye for studying neurovascular coupling</article-title>. <source>Nat. Methods</source>
<volume>9</volume>, <fpage>273</fpage>–<lpage>276</lpage>
<pub-id pub-id-type="doi">10.1038/nmeth.1857</pub-id><?supplied-pmid 22266543?><pub-id pub-id-type="pmid">22266543</pub-id></mixed-citation>
    </ref>
    <ref id="B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smith</surname><given-names>K.</given-names></name></person-group> (<year>2012</year>). <article-title>Brain imaging: fMRI 2.0</article-title>. <source>Nature</source>
<volume>484</volume>, <fpage>24</fpage>–<lpage>26</lpage>
<pub-id pub-id-type="doi">10.1038/484024a</pub-id><?supplied-pmid 22481337?><pub-id pub-id-type="pmid">22481337</pub-id></mixed-citation>
    </ref>
    <ref id="B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sobel</surname><given-names>I.</given-names></name></person-group> (<year>1978</year>). <article-title>Neighborhood coding of binary images for fast contour following and general binary array processing</article-title>. <source>Comput. Graph. Image Process</source>. <volume>8</volume>, <fpage>127</fpage>–<lpage>135</lpage>
<pub-id pub-id-type="doi">10.1016/S0146-664X(78)80020-3</pub-id></mixed-citation>
    </ref>
    <ref id="B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stosiek</surname><given-names>C.</given-names></name><name><surname>Garaschuk</surname><given-names>O.</given-names></name><name><surname>Holthoff</surname><given-names>K.</given-names></name><name><surname>Konnerth</surname><given-names>A.</given-names></name></person-group> (<year>2003</year>). <article-title><italic>In vivo</italic> two-photon calcium imaging of neuronal networks</article-title>. <source>Proc. Natl. Acad. Sci. U.S.A</source>. <volume>100</volume>, <fpage>7319</fpage>–<lpage>7324</lpage>
<pub-id pub-id-type="doi">10.1073/pnas.1232232100</pub-id><?supplied-pmid 12777621?><pub-id pub-id-type="pmid">12777621</pub-id></mixed-citation>
    </ref>
    <ref id="B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tian</surname><given-names>L.</given-names></name><name><surname>Hires</surname><given-names>S. A.</given-names></name><name><surname>Mao</surname><given-names>T.</given-names></name><name><surname>Huber</surname><given-names>D.</given-names></name><name><surname>Chiappe</surname><given-names>M. E.</given-names></name><name><surname>Chalasani</surname><given-names>S. H.</given-names></name><etal/></person-group> (<year>2009</year>). <article-title>Imaging neural activity in worms, flies and mice with improved GCaMP calcium indicators</article-title>. <source>Nat. Methods</source>
<volume>6</volume>, <fpage>875</fpage>–<lpage>881</lpage>
<pub-id pub-id-type="doi">10.1038/nmeth.1398</pub-id><?supplied-pmid 19898485?><pub-id pub-id-type="pmid">19898485</pub-id></mixed-citation>
    </ref>
    <ref id="B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tsien</surname><given-names>R. Y.</given-names></name></person-group> (<year>1988</year>). <article-title>Fluorescence measurement and photochemical manipulation of cytosolic free calcium</article-title>. <source>Trends Neurosci</source>. <volume>11</volume>, <fpage>419</fpage>–<lpage>424</lpage>
<pub-id pub-id-type="doi">10.1016/0166-2236(88)90192-0</pub-id><?supplied-pmid 2469158?><pub-id pub-id-type="pmid">2469158</pub-id></mixed-citation>
    </ref>
    <ref id="B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>S.</given-names></name><name><surname>Boyd</surname><given-names>J.</given-names></name><name><surname>Delaney</surname><given-names>K.</given-names></name><name><surname>Murphy</surname><given-names>T. H.</given-names></name></person-group> (<year>2005</year>). <article-title>Rapid reversible changes in dendritic spine structure <italic>in vivo</italic> gated by the degree of ischemia</article-title>. <source>J. Neurosci</source>. <volume>25</volume>, <fpage>5333</fpage>–<lpage>5338</lpage>
<pub-id pub-id-type="doi">10.1523/JNEUROSCI.1085-05.2005</pub-id><?supplied-pmid 15930381?><pub-id pub-id-type="pmid">15930381</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
