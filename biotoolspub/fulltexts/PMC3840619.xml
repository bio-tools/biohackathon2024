<?DTDIdentifier.IdentifierValue http://www.biomedcentral.com/xml/article.dtd?>
<?DTDIdentifier.IdentifierType system?>
<?SourceDTD.DTDName article.dtd?>
<?SourceDTD.Version 1.0?>
<?ConverterInfo.XSLTName bmc2nlmx2.xsl?>
<?ConverterInfo.Version 2?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">BMC Genomics</journal-id>
    <journal-id journal-id-type="iso-abbrev">BMC Genomics</journal-id>
    <journal-title-group>
      <journal-title>BMC Genomics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1471-2164</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3840619</article-id>
    <article-id pub-id-type="publisher-id">1471-2164-14-774</article-id>
    <article-id pub-id-type="pmid">24206606</article-id>
    <article-id pub-id-type="doi">10.1186/1471-2164-14-774</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Software</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>BS-Seeker2: a versatile aligning pipeline for bisulfite sequencing data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" id="A1">
        <name>
          <surname>Guo</surname>
          <given-names>Weilong</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <xref ref-type="aff" rid="I2">2</xref>
        <email>gwl09@mails.tsinghua.edu.cn</email>
      </contrib>
      <contrib contrib-type="author" id="A2">
        <name>
          <surname>Fiziev</surname>
          <given-names>Petko</given-names>
        </name>
        <xref ref-type="aff" rid="I3">3</xref>
        <email>pfiziev@mednet.ucla.edu</email>
      </contrib>
      <contrib contrib-type="author" id="A3">
        <name>
          <surname>Yan</surname>
          <given-names>Weihong</given-names>
        </name>
        <xref ref-type="aff" rid="I4">4</xref>
        <email>wyan@chem.ucla.edu</email>
      </contrib>
      <contrib contrib-type="author" id="A4">
        <name>
          <surname>Cokus</surname>
          <given-names>Shawn</given-names>
        </name>
        <xref ref-type="aff" rid="I2">2</xref>
        <email>cokus@ucla.edu</email>
      </contrib>
      <contrib contrib-type="author" id="A5">
        <name>
          <surname>Sun</surname>
          <given-names>Xueguang</given-names>
        </name>
        <xref ref-type="aff" rid="I5">5</xref>
        <email>xsun@zymoresearch.com</email>
      </contrib>
      <contrib contrib-type="author" id="A6">
        <name>
          <surname>Zhang</surname>
          <given-names>Michael Q</given-names>
        </name>
        <xref ref-type="aff" rid="I1">1</xref>
        <xref ref-type="aff" rid="I6">6</xref>
        <email>michael.zhang@utdallas.edu</email>
      </contrib>
      <contrib contrib-type="author" corresp="yes" id="A7">
        <name>
          <surname>Chen</surname>
          <given-names>Pao-Yang</given-names>
        </name>
        <xref ref-type="aff" rid="I7">7</xref>
        <email>paoyang@gate.sinica.edu.tw</email>
      </contrib>
      <contrib contrib-type="author" corresp="yes" id="A8">
        <name>
          <surname>Pellegrini</surname>
          <given-names>Matteo</given-names>
        </name>
        <xref ref-type="aff" rid="I2">2</xref>
        <xref ref-type="aff" rid="I8">8</xref>
        <email>matteop@mcdb.ucla.edu</email>
      </contrib>
    </contrib-group>
    <aff id="I1"><label>1</label>Center for Synthetic &amp; Systems Biology, TNLIST, Tsinghua University, Beijing 100084, China</aff>
    <aff id="I2"><label>2</label>Department of Molecular, Cell and Developmental Biology, University of California, Los Angeles, CA 90095, USA</aff>
    <aff id="I3"><label>3</label>Department of Biological Chemistry, University of California, Los Angeles, CA 90095, USA</aff>
    <aff id="I4"><label>4</label>Department of Chemistry and Biochemistry, University of California, Los Angeles, CA 90095, USA</aff>
    <aff id="I5"><label>5</label>Zymo Research Corp, 17062 Murphy Ave, Irvine, CA 92614, USA</aff>
    <aff id="I6"><label>6</label>Department of Molecular and Cell Biology, Center for Systems Biology, The University of Texas at Dallas, Richardson, TX 75080, USA</aff>
    <aff id="I7"><label>7</label>Institute of Plant and Microbial Biology, Academia Sinica, Taipei 11529, Taiwan</aff>
    <aff id="I8"><label>8</label>Institute for Genomics and Proteomics, University of California, Los Angeles, CA 90095, USA</aff>
    <pub-date pub-type="collection">
      <year>2013</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>10</day>
      <month>11</month>
      <year>2013</year>
    </pub-date>
    <volume>14</volume>
    <fpage>774</fpage>
    <lpage>774</lpage>
    <history>
      <date date-type="received">
        <day>30</day>
        <month>7</month>
        <year>2013</year>
      </date>
      <date date-type="accepted">
        <day>5</day>
        <month>11</month>
        <year>2013</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2013 Guo et al.; licensee BioMed Central Ltd.</copyright-statement>
      <copyright-year>2013</copyright-year>
      <copyright-holder>Guo et al.; licensee BioMed Central Ltd.</copyright-holder>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0">
        <license-p>This is an open access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/2.0">http://creativecommons.org/licenses/by/2.0</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="http://www.biomedcentral.com/1471-2164/14/774"/>
    <abstract>
      <sec>
        <title>Background</title>
        <p>DNA methylation is an important epigenetic modification involved in many biological processes. Bisulfite treatment coupled with high-throughput sequencing provides an effective approach for studying genome-wide DNA methylation at base resolution. Libraries such as whole genome bisulfite sequencing (WGBS) and reduced represented bisulfite sequencing (RRBS) are widely used for generating DNA methylomes, demanding efficient and versatile tools for aligning bisulfite sequencing data.</p>
      </sec>
      <sec>
        <title>Results</title>
        <p>We have developed BS-Seeker2, an updated version of BS Seeker, as a full pipeline for mapping bisulfite sequencing data and generating DNA methylomes. BS-Seeker2 improves mappability over existing aligners by using local alignment. It can also map reads from RRBS library by building special indexes with improved efficiency and accuracy. Moreover, BS-Seeker2 provides additional function for filtering out reads with incomplete bisulfite conversion, which is useful in minimizing the overestimation of DNA methylation levels. We also defined CGmap and ATCGmap file formats for full representations of DNA methylomes, as part of the outputs of BS-Seeker2 pipeline together with BAM and WIG files.</p>
      </sec>
      <sec>
        <title>Conclusions</title>
        <p>Our evaluations on the performance show that BS-Seeker2 works efficiently and accurately for both WGBS data and RRBS data. BS-Seeker2 is freely available at <ext-link ext-link-type="uri" xlink:href="http://pellegrini.mcdb.ucla.edu/BS_Seeker2/">http://pellegrini.mcdb.ucla.edu/BS_Seeker2/</ext-link> and the Galaxy server.</p>
      </sec>
    </abstract>
    <kwd-group>
      <kwd>DNA methylation</kwd>
      <kwd>Bisulfite sequencing aligner</kwd>
      <kwd>WGBS</kwd>
      <kwd>RRBS</kwd>
      <kwd>BS Seeker</kwd>
      <kwd>Bisulfite conversion failure</kwd>
      <kwd>Galaxy toolshed</kwd>
    </kwd-group>
  </article-meta>
</front>
<body>
  <sec>
    <title>Background</title>
    <p>DNA methylation is an important epigenetic mark that is involved in gene regulation, X-chromosome inactivation, imprinting and development. Next-generation sequencing of bisulfite converted DNA makes it possible to detect genome wide DNA methylation at base-pair resolution [<xref ref-type="bibr" rid="B1">1</xref>]. WGBS generates high quality DNA methylomes covering more than 90% of cytosines in the human genome, at a single base-pair resolution [<xref ref-type="bibr" rid="B2">2</xref>]. An alternative to WGBS is RRBS [<xref ref-type="bibr" rid="B3">3</xref>], which is becoming popular for studies with multiple samples. In RRBS, genomic DNA is first fragmented by enzymatic digestion (e.g. MspI) and followed by a size selection step to enrich the fragments for CpG islands. Additionally, double restriction-enzyme digestion methods may improve the coverage and accuracy of RRBS [<xref ref-type="bibr" rid="B4">4</xref>].</p>
    <p>To date, several bisulfite-sequencing (BS) aligners have been developed. BS Seeker [<xref ref-type="bibr" rid="B5">5</xref>] was the first BS aligner based on a three-letter approach using a general purpose short read mapper, Bowtie [<xref ref-type="bibr" rid="B6">6</xref>]. Subsequently, similar tools were developed including Bismark [<xref ref-type="bibr" rid="B7">7</xref>], BRAT-BW [<xref ref-type="bibr" rid="B8">8</xref>] and MethylCoder [<xref ref-type="bibr" rid="B9">9</xref>]. BS aligners employing three-letter approaches perform <italic>in silico</italic> C-to-T conversion for both reads and reference sequences prior to mapping. Other BS aligners, such as BSMAP [<xref ref-type="bibr" rid="B10">10</xref>], RMAPBS [<xref ref-type="bibr" rid="B11">11</xref>] and GSNAP [<xref ref-type="bibr" rid="B12">12</xref>], employ wild-card approaches.</p>
    <p>Most of these alignment tools are designed for WGBS, and only RRBSMAP [<xref ref-type="bibr" rid="B13">13</xref>] is tailored for RRBS by mapping adapter-trimmed reads around the restriction enzyme cutting sites. Tools such as Bismark can also map RRBS reads against the reference genome with the assistance of external tool for trimming adapters. However, these tools also attempt to map the reads to whole genome including regions where the reads would not be oriented from, leading to inefficient use of computational resources and increased mapping errors. Moreover, most of these aligners do not allow gapped alignment (e.g., RMAPBS, BRAT-BW). Bismark performs gapped mapping when using Bowtie2, but it only enables the ‘end-to-end’ mode. BSMAP can handle one continuous gap with up to three nucleotides.</p>
    <p>Here we present BS-Seeker2, an updated version of BS Seeker. BS-Seeker2 is a bisulfite sequencing alignment tool that performs genome indexing, read alignment and DNA methylation levels calling for each cytosine. It supports both local and gapped alignment by integrating Bowtie2 [<xref ref-type="bibr" rid="B14">14</xref>], Bowtie [<xref ref-type="bibr" rid="B6">6</xref>], SOAP [<xref ref-type="bibr" rid="B15">15</xref>] and RMAP [<xref ref-type="bibr" rid="B16">16</xref>]. Various types of libraries are supported, including WGBS/RRBS, directional/non-directional library, single-end/paired-end sequencing, and user-defined enzyme cutting sites for variant versions of RRBS. BS-Seeker2 maps RRBS data efficiently and accurately by only indexing the reduced representation genome regions. BS-Seeker2 works with raw sequences and generates outputs for read alignments and methylation levels at single-base resolution. BS-Seeker2 also provides an option to remove reads with incomplete bisulfite conversion, reducing the overestimation of DNA methylation levels. Lastly, BS-Seeker2 is available through Galaxy [<xref ref-type="bibr" rid="B17">17</xref>] via the Toolshed (<ext-link ext-link-type="uri" xlink:href="http://toolshed.g2.bx.psu.edu">http://toolshed.g2.bx.psu.edu</ext-link>).</p>
    <p>We compared the performance of BS-Seeker2 with Bismark and BSMAP on both real data and simulated data on mappability, mapping accuracy and computational CPU and RAM costs. Our results show that BS-Seeker2 is able to accurately and efficiently map reads from both WGBS and RRBS protocols. On real data, BS-Seeker2 in the local alignment mode maps more reads than the other aligners. By mapping to the reduced representation genome, BS-Seeker2 is more efficient and accurate than mapping to the whole genome.</p>
  </sec>
  <sec>
    <title>Implementation</title>
    <sec>
      <title>BS-Seeker2 as a pipeline for aligning bisulfite sequencing data</title>
      <p>BS-Seeker2 is implemented in Python, integrating steps of building indexes from reference genomes, mapping reads from various formats (qseq, fastq, fasta and pure sequence), and generating alignment results (BAM, SAM or BS-Seeker format) and methylation calls (wiggle format), which can be directly loaded into a genome browser, such as IGV [<xref ref-type="bibr" rid="B18">18</xref>] (Figure <xref ref-type="fig" rid="F1">1</xref>). Detailed mapping summaries for each cytosine (CGmap) and all covered positions (ATCGmap) are also reported for downstream analysis (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Supplementary Methods). BS-Seeker2 can be coupled with a variety of short read aligners with a three-letter approach. BS-Seeker2 is also highly customizable, as the user can choose alignment modes, and control almost all the parameters of utilized aligners.</p>
      <fig id="F1" position="float">
        <label>Figure 1</label>
        <caption>
          <p><bold>The three main steps in the workflow of BS-Seeker2. (1)</bold> Index-building. Indexes for RRBS and WGBS are built separately from a three-letter converted genome. Four index instances are built to account for the asymmetric bisulfite-conversion of the two strands and properties of non-directional libraries. <bold>(2)</bold> Aligning reads to the indexes. Both WGBS and RRBS reads are converted to three-letters prior to mapping. For RRBS, adapters should be removed first. Converted reads are mapped onto four index instances for non-directional libraries (two instances for directional libraries), and mapping to each index instance will report two best hits. Multiple hits and mismatch numbers are checked before being reported as alignment results. The C-to-T match is regarded as a mismatch in this step, and is checked by the mismatch criteria. <bold>(3)</bold> Calling methylation level for each site. The user can decide whether to filter the un-converted reads in this step. BS-Seeker2 provides detailed outputs (BAM/SAM, wiggle, CGmap and ATCGmap files). Both the wiggle file and the BAM file can be directly imported in a genome browser, such as IGV. BS-Seeker2 is also integrated into the Galaxy web interface platform.</p>
        </caption>
        <graphic xlink:href="1471-2164-14-774-1"/>
      </fig>
    </sec>
    <sec>
      <title>Gapped mapping and local alignment</title>
      <p>BS-Seeker2 takes advantage of Bowtie2’s gapped-mapping, and supports both ‘local’ and ‘end-to-end’ alignment modes. By using local alignment, BS-Seeker2 can effectively map reads with 3’ contamination of adapters (Figure <xref ref-type="fig" rid="F2">2</xref>A). In Illumina sequencing, reads sometimes contain continuous sequencing errors or missing base calls, probably caused by bubble in flow cell (22). BS-Seeker2 circumvents these problems by using local alignments to remove the mismatched nucleotides from the end of the reads to maximize the mappability. In order to quantify mappability improvements attributable to gapped-mapping and local alignments, we compared mapping results of BS-Seeker2 on real sequencing data by utilizing Bowtie and Bowtie2-local. The results showed that in the real testing data set for WGBS, compared to Bowtie, an extra 11% of total reads could be mapped by using the local alignment model of Bowtie2. Specifically, 3.3% of the total reads could be mapped by allowing indels (the gapped alignment) and 9.4% could be salvaged using the local alignment feature (Figure <xref ref-type="fig" rid="F2">2</xref>B).</p>
      <fig id="F2" position="float">
        <label>Figure 2</label>
        <caption>
          <p><bold>Gapped alignment and local alignment. (A)</bold> An example shows how gapped alignment and local alignment work and occurrence condition. <bold>(B)</bold> Venn chart shows the percentages of the total reads from real WGBS testing data set that could be mapped by gapped alignment or local alignment utilizing Bowtie2-local but not by Bowtie.</p>
        </caption>
        <graphic xlink:href="1471-2164-14-774-2"/>
      </fig>
    </sec>
    <sec>
      <title>Masked genome for RRBS mapping</title>
      <p>BS-Seeker2 builds special index for RRBS libraries, which results in improvements of mapping speed, mappability and mapping accuracy and less memory usage (Figure <xref ref-type="fig" rid="F3">3</xref>). RRBS libraries are generated by restriction enzyme (i.e. MspI) digestion and the subsequent selection of fragment sizes typically ranging from 40 bp to 220 bp, corresponding to less than 5% of the entire genome. To model this we mask the reference genome in silico based on restriction sites (e.g., C’CGG for MspI). Genomic regions not falling within the size-selected RRBS fragments are masked and only unmasked regions are indexed (RR genome). There are four main advantages for mapping against the RR genome instead of the whole genome. First, it reduces the size of the pre-built index. Taking the reference genome mouse mm9 as an example, the *.ebwt files built by Bowite are over ~12G bytes for the whole genome, but only ~0.3G bytes for the masked genome. Second, it accelerates the alignment step. Mapping to RR genome is about 3 times faster than mapping to the whole genome (Table <xref ref-type="table" rid="T1">1</xref>), as the masked genome represents a much smaller search space. Third, it increases the mapping accuracy. Masked genomes help reduce spurious mapping when the reads contain sequencing errors (Figure <xref ref-type="fig" rid="F3">3</xref>). Based on our simulated error-containing data, accuracy for mapping to the RR genome (99.33%) is higher compared to mapping to the whole genome (97.92%) (Table <xref ref-type="table" rid="T1">1</xref>). Lastly, it keeps reads that would have pseudo-multiple hits when mapping to whole genome. A pseudo-multiple hit occurs when a read coming from the RR genome has another best match in the masked regions. In the simulated error-free data, pseudo-multiple hits are avoided when the reads are mapped to the RR genome, resulting in higher mappability (74.04%) than mapped to the whole genome (72.52%) (Table <xref ref-type="table" rid="T1">1</xref>).</p>
      <fig id="F3" position="float">
        <label>Figure 3</label>
        <caption>
          <p><bold>A diagram illustrating how specific indexes are built for RRBS.</bold> The original genome is cut by restriction enzyme(s) into fragments. Fragments with lengths in a specific range (e.g. from 50 bp to 300 bp) are selected, whereas unselected regions are masked. The unmasked genome is used for building the index.</p>
        </caption>
        <graphic xlink:href="1471-2164-14-774-3"/>
      </fig>
      <table-wrap position="float" id="T1">
        <label>Table 1</label>
        <caption>
          <p>Performance comparisons for mapping simulated RRBS reads to RR and WG indexes</p>
        </caption>
        <table frame="hsides" rules="groups" border="1">
          <colgroup>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
          </colgroup>
          <thead valign="top">
            <tr>
              <th rowspan="2" align="center"> </th>
              <th colspan="3" align="center" valign="bottom">
                <bold>Error-free</bold>
                <hr/>
              </th>
              <th colspan="3" align="center" valign="bottom">
                <bold>Error-containing</bold>
                <hr/>
              </th>
            </tr>
            <tr>
              <th align="center">
                <bold>To RR</bold>
              </th>
              <th align="center"> </th>
              <th align="center">
                <bold>To WG</bold>
              </th>
              <th align="center">
                <bold>To RR</bold>
              </th>
              <th align="center"> </th>
              <th align="center">
                <bold>To WG</bold>
              </th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td align="center" valign="bottom">Mappability<hr/></td>
              <td align="center" valign="bottom">74.04%<hr/></td>
              <td align="center" valign="bottom">←<hr/></td>
              <td align="center" valign="bottom">72.52%<hr/></td>
              <td align="center" valign="bottom">74.41%<hr/></td>
              <td align="center" valign="bottom">←<hr/></td>
              <td align="center" valign="bottom">72.95%<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">User time<hr/></td>
              <td align="center" valign="bottom">1m23s<hr/></td>
              <td align="center" valign="bottom">←<hr/></td>
              <td align="center" valign="bottom">4m18s<hr/></td>
              <td align="center" valign="bottom">1m20s<hr/></td>
              <td align="center" valign="bottom">←<hr/></td>
              <td align="center" valign="bottom">4m37s<hr/></td>
            </tr>
            <tr>
              <td align="center">Accuracy</td>
              <td align="center">100.00%</td>
              <td align="center"> </td>
              <td align="center">100.00%</td>
              <td align="center">99.33%</td>
              <td align="center">←</td>
              <td align="center">97.92%</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <p>100 k reads of length 50 bp are simulated from the RR genome. Mapping is done using BS-Seeker2 (Bowtie). Mapping to the reduced represented (RR) index is much faster than mapping to the whole genome (WG) index. For error-free samples, the mappability to RR is higher than WG by avoiding pseudo-multiple hits. For error-containing samples, mapping to the RR index will result in higher accuracy than mapping to the WG index. Arrows indicate the improvement directions.</p>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec>
      <title>Filtering reads with incomplete bisulfite conversion</title>
      <p>High bisulfite conversion rate is a critical factor for accurately estimating the methylation levels. Incomplete bisulfite conversion may lead to an overestimation of the methylation level. BS-Seeker2 provides a computational solution to remove reads with incomplete bisulfite conversion (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Supplementary Methods). Unmethylated phage DNA is often spiked into the samples as a control, to measure bisulfite conversion rates. We analysed the methylation pattern of the phage reads and observed two groups of reads from the distribution of unconverted cytosine sites: sporadically distributed and densely distributed (Figure <xref ref-type="fig" rid="F4">4</xref>A). The sporadic group could be due to random un-conversion failure, or from T-to-C sequencing errors. The dense group is a set of reads that are almost entirely un-converted, potentially caused by the formation of secondary structure. We found that 82% of un-converted non-CpG sites were in the dense group, and only 18% were in the sporadic group. The same pattern was also observed on the mouse DNA data (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Figure S1). BS-Seeker2 provides an optional function to remove reads with densely un-converted non-CpG sites. To validate the feasibility, we mapped RRBS reads of two technical replicates (from the same mouse sample but different libraries), denoted as data sets A and B. The calculated methylation levels of non-CpG contexts show about 5-fold difference between the two replicates (Figure <xref ref-type="fig" rid="F4">4</xref>C). After removing the potentially un-converted reads, the methylation level gaps of non-CpG contexts were narrowed (to about 2-fold). However, this option is not suggested for samples with highly methylated non-CpG context, as it might reject bona fide methylated reads.</p>
      <fig id="F4" position="float">
        <label>Figure 4</label>
        <caption>
          <p><bold>Filtering reads with incomplete bisulfite conversion. (A)</bold> Distribution of the unconverted ratio of CH sites (H = A, C, T) in phage DNA reads which has at least one CH site unconverted. Phage DNA is free of DNA methylation and used as a control. The distribution chart indicates two different categories: sporadic (red) and dense (blue) methylation. BS-Seeker2 provides an option for removing reads with dense non-CpG methylation. <bold>(B)</bold> Filtering un-converted reads makes the methylation levels of two technical replicates more similar. Error bar, SD.</p>
        </caption>
        <graphic xlink:href="1471-2164-14-774-4"/>
      </fig>
    </sec>
    <sec>
      <title>CGmap and ATCGmap files</title>
      <p>We defined new file formats for the representation of DNA methylomes, CGmap and ATCGmap (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Supplementary Methods). The DNA methylation levels and read counts for both CpG and CpH sites are shown in CGmap file. ATCGmap file includes read counts for all mapped sites and both strands. Both CGmap and ATCGmap files provide detailed mapping results, and are convenient for downstream analysis.</p>
    </sec>
    <sec>
      <title>Integration with galaxy</title>
      <p>We have integrated BS-Seeker2 into Galaxy to generate a user-friendly bisulfite sequencing read aligner. Users may can use our Galaxy server (<ext-link ext-link-type="uri" xlink:href="http://galaxy.mcdb.ucla.edu">http://galaxy.mcdb.ucla.edu</ext-link>) (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Figure S2), or install BS-Seeker2 in their local Galaxy server via Galaxy Toolshed (<ext-link ext-link-type="uri" xlink:href="http://toolshed.g2.bx.psu.edu">http://toolshed.g2.bx.psu.edu</ext-link>).</p>
    </sec>
  </sec>
  <sec sec-type="results">
    <title>Results</title>
    <sec>
      <title>Evaluations of different BS aligners</title>
      <p>We evaluated BS-Seeker2 against two other popular BS aligners, Bismark and BSMAP. Both BS-Seeker2 and Bismark are implemented based on the three-letter approach, whereas BSMAP is based on the wild-card approach. We compared them on both WGBS and RRBS data. To estimate the mapping accuracy, we test the three tools on two simulated data sets that are error-free and error-containing, respectively. Three models of BS-Seeker2 were used: BS-Seeker2-local (local alignment mode of Bowtie2), BS-Seeker2-e2e (end-to-end alignment mode of Bowite2) and BS-Seeker2-Bowtie (utilizing Bowtie). Since Bismark supports Bowtie2 only with the ‘end-to-end’ alignment model, we tested it in two modes: Bowite2-e2e and Bowtie.</p>
      <p>Parameters. For all the evaluations of BS aligners (BS-Seeker2, Bismark v0.7.7, BSMAP v2.73), 100 k reads (1x100 bp/ 2x60 bp) were used. Up to 5 mismatches were allowed for mapping, except for Bismark-Bowtie2-e2e (end-to-end model of Bowtie2), which does not provide such parameters. Both BS-Seeker2 and Bismark utilize Bowtie/Bowtie2 for mapping, and the main parameters passed to the short read aligners are identical. The exact commands used in testing are listed in Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Supplementary Methods. The mapping runs were performed on a Linux server with 12 cores (Intel(R) Xeon(R) CPU, X5650, 2.67GHz) and with 48 Gb RAM running 64bit Red Hat 4.4.7-3.</p>
      <p>RRBS related issues. In the comparisons of mapping RRBS reads, BS-Seeker2 mapped the reads against the index of the reduced represented (RR) genome. Both Bismark and BSMAP map reads against the whole genome regardless of the RRBS fragment lengths. BS-Seeker2 and BSMAP have built-in functions to remove adapters, while Bismark does not. As a result we performed an additional step for adapter trimming (by running trim_galore) for Bismark.</p>
      <p>Evaluation criteria. We evaluated the performance of the BS aligners on four criteria: 1) mappability, the percentage of reads that are uniquely mapped against all reads; 2) mapping accuracy, the percentage of the correctly mapped reads against all the uniquely mapped reads (only for simulated data); 3) time, the CPU time used for alignment, which is calculated as the total CPU seconds cost by the whole process in user mode; 4) RAM usage, the maximum cost of random-access memory for a whole task.</p>
    </sec>
    <sec>
      <title>Bisulfite sequencing data–real and simulated data</title>
      <p>The real data sets are single-end reads generated from mouse/human bisulfite libraries. The WGBS data is downloaded from published data sets, SRR299053 (single-end, mouse) (21) and SRR306438 (paired-end, human) [<xref ref-type="bibr" rid="B19">19</xref>]. The RRBS data is from our unpublished mouse RRBS library. In order to measure the mapping accuracy, we also generated simulated reads (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Supplementary Methods). All the simulated reads are randomly generated from the reference genome (mm9/hg18) assuming directional libraries with read lengths same with those of the real data sets. RRBS reads are generated from fragments with lengths ranging between 40 bp and 250 bp. For reads shorter than 100 bp, the adapter sequence “AGATCGGAAGAGCACACGTCTGAACTCCAGTCA” was added to the 3’ end. Two kinds of simulated sequences were generated: error-free and error-containing reads. The error-free simulated reads are faithfully converted and have no sequencing error. The simulated error-containing reads are converted with 1% failure, and sequencing errors by cycles are also added. The error rate per cycle follows the distribution of sequencing error rates in the real data (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Supplementary Methods). All the datasets used for testing aligners are available on the website of BS-Seeker2.</p>
    </sec>
    <sec>
      <title>Performance on WGBS mapping</title>
      <p>Generally, for single-end data of WGBS library, the performance of BS-Seeker2 is comparable with both Bismark and BSMAP (Table <xref ref-type="table" rid="T2">2</xref>). BS-Seeker2 has the similar mappability and mapping accuracy with Bismark and BSMAP on simulation data. In real data, BS-Seeker2 with local alignment mode has the highest mappability (83.80%), which is about 10% higher than any alignment mode used in Bismark (73.15% for Bowtie) and BSMAP (72.84%). This suggests that local alignments are more suitable for real data, which could have more sequencing errors (such as continuous errors, indels, adapters etc.) than simulated data. Indels, continuous errors and adapters were not considered in the simulated data sets. Results also showed that BS-Seeker2-Bowtie requires the less memory than Bismark and BSMAP (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Figure S3), and the speed is improved over Bismark (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Figure S4). Both BS-Seeker2 and Bismark integrating with Bowtie2 require more time and more memory than they were with Bowtie, as Bowtie2 would require more resources for multiple-seed strategy and searching indels.</p>
      <table-wrap position="float" id="T2">
        <label>Table 2</label>
        <caption>
          <p>Performance comparison of BS aligners on WGBS data</p>
        </caption>
        <table frame="hsides" rules="groups" border="1">
          <colgroup>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
          </colgroup>
          <thead valign="top">
            <tr>
              <th align="center" valign="bottom"> <hr/></th>
              <th colspan="3" align="center" valign="bottom">
                <bold>BS-Seeker2</bold>
                <hr/>
              </th>
              <th colspan="2" align="center" valign="bottom">
                <bold>Bismark</bold>
                <hr/>
              </th>
              <th rowspan="3" align="center">
                <bold>BSMAP</bold>
              </th>
            </tr>
            <tr>
              <th align="center" valign="bottom">
                <bold>WGBS</bold>
                <hr/>
              </th>
              <th colspan="2" align="center" valign="bottom">
                <bold>Bowtie2</bold>
                <hr/>
              </th>
              <th rowspan="2" align="center">
                <bold>Bowtie</bold>
              </th>
              <th align="center" valign="bottom">
                <bold>Bowtie2</bold>
                <hr/>
              </th>
              <th rowspan="2" align="center">
                <bold>Bowtie</bold>
              </th>
            </tr>
            <tr>
              <th align="center"> </th>
              <th align="center">
                <bold>local</bold>
              </th>
              <th align="center">
                <bold>e2e</bold>
              </th>
              <th align="center">
                <bold>(e2e)</bold>
              </th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td colspan="7" align="center" valign="bottom">Simulation: error-free<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">map<hr/></td>
              <td align="center" valign="bottom">91.65%<hr/></td>
              <td align="center" valign="bottom">91.50%<hr/></td>
              <td align="center" valign="bottom">91.65%<hr/></td>
              <td align="center" valign="bottom">87.78%<hr/></td>
              <td align="center" valign="bottom">91.65%<hr/></td>
              <td align="center" valign="bottom">91.81%<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">acc<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
            </tr>
            <tr>
              <td colspan="7" align="center" valign="bottom">Simulation: error-containing<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">map<hr/></td>
              <td align="center" valign="bottom">91.62%<hr/></td>
              <td align="center" valign="bottom">90.51%<hr/></td>
              <td align="center" valign="bottom">91.69%<hr/></td>
              <td align="center" valign="bottom">86.90%<hr/></td>
              <td align="center" valign="bottom">91.64%<hr/></td>
              <td align="center" valign="bottom">91.90%<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">acc<hr/></td>
              <td align="center" valign="bottom">99.22%<hr/></td>
              <td align="center" valign="bottom">99.73%<hr/></td>
              <td align="center" valign="bottom">99.82%<hr/></td>
              <td align="center" valign="bottom">99.86%<hr/></td>
              <td align="center" valign="bottom">99.80%<hr/></td>
              <td align="center" valign="bottom">99.82%<hr/></td>
            </tr>
            <tr>
              <td colspan="7" align="center" valign="bottom">Real data<hr/></td>
            </tr>
            <tr>
              <td align="center">map</td>
              <td align="center">83.80%</td>
              <td align="center">72.94%</td>
              <td align="center">71.89%</td>
              <td align="center">70.31%</td>
              <td align="center">73.15%</td>
              <td align="center">72.84%</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <p>In this table, BS-Seeker2 maps the reads to whole genome. map = mappability, acc = accuracy, local = local alignment model of Bowtie2, e2e = end-to-end alignment model of Bowtie2.</p>
        </table-wrap-foot>
      </table-wrap>
      <p>Similarly, for the paired-end data of WGBS library, both BS-Seeker2 and Bismark map more reads than BSMAP on simulation data, also with relatively higher accuracy (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Table S1). Among the three aligners, BS-Seeker2 requires the least memory (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Figure S3). The local alignment mode of BS-Seeker2 has the highest mappability. Different from that of single-end data, our comparisons showed that none of the three aligners achieve 100% accuracy when mapping the error-free simulated paired-end reads. As the searching space when aligning the mate pairs is quite large, it is possible that only suboptimal hits are reported in order to improve efficiency.</p>
    </sec>
    <sec>
      <title>Performance on RRBS mapping</title>
      <p>BS-Seeker2 outperform the other aligners on RRBS data (Table <xref ref-type="table" rid="T3">3</xref>). For the error-free data, BS-Seeker2 has the highest mappability and 100% accuracy. Bismark mapped reads to the whole genome with lower mappability than BS-Seeker2, as a result of the pseudo-multiple hits issue. BSMAP is the only aligner whose mapping accuracy doesn’t reach 100% when mapping simulated error-free reads. For error-containing simulated data, BS-Seeker2-Bowtie shows improved mappability and accuracy compared to Bismark-Bowtie and higher accuracy than BSMAP. As the 3’ end of reads tends to have l more sequencing errors, it’s not easy to remove all the adapters, since this portion tends to be of lower quality in real data, making reads with 3’ un-trimmed adapters difficult to align. BS-Seeker2 using the local alignment mode of Bowtie2 provides an effective way to map these reads. An appropriately broad range for fragment lengths of RR genome is suggested for BS-Seeker2 to optimize the mappability (Additional file <xref ref-type="supplementary-material" rid="S1">1</xref>: Supplementary Method and Figure S5).</p>
      <table-wrap position="float" id="T3">
        <label>Table 3</label>
        <caption>
          <p>Performance comparison of BS aligners on RRBS data</p>
        </caption>
        <table frame="hsides" rules="groups" border="1">
          <colgroup>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
          </colgroup>
          <thead valign="top">
            <tr>
              <th align="center" valign="bottom"> <hr/></th>
              <th colspan="3" align="center" valign="bottom">
                <bold>BS-Seeker2</bold>
                <hr/>
              </th>
              <th colspan="2" align="center" valign="bottom">
                <bold>Bismark</bold>
                <hr/>
              </th>
              <th align="center" valign="bottom">
                <bold>BSMAP</bold>
                <hr/>
              </th>
            </tr>
            <tr>
              <th align="center" valign="bottom">
                <bold>RRBS</bold>
                <hr/>
              </th>
              <th colspan="2" align="center" valign="bottom">
                <bold>Bowtie2</bold>
                <hr/>
              </th>
              <th rowspan="2" align="center">
                <bold>Bowtie</bold>
              </th>
              <th align="center" valign="bottom">
                <bold>Bowtie2</bold>
                <hr/>
              </th>
              <th rowspan="2" align="center">
                <bold>Bowtie</bold>
              </th>
              <th rowspan="2" align="center">
                <bold>(RRBSMAP)</bold>
              </th>
            </tr>
            <tr>
              <th align="center"> </th>
              <th align="center">
                <bold>local</bold>
              </th>
              <th align="center">
                <bold>e2e</bold>
              </th>
              <th align="center">
                <bold>(e2e)</bold>
              </th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td colspan="7" align="center" valign="bottom">Simulation: error-free<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">map<hr/></td>
              <td align="center" valign="bottom">78.29%<hr/></td>
              <td align="center" valign="bottom">78.02%<hr/></td>
              <td align="center" valign="bottom">78.29%<hr/></td>
              <td align="center" valign="bottom">72.51%<hr/></td>
              <td align="center" valign="bottom">78.08%<hr/></td>
              <td align="center" valign="bottom">78.63%<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">acc<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">100.00%<hr/></td>
              <td align="center" valign="bottom">99.82%<hr/></td>
            </tr>
            <tr>
              <td colspan="7" align="center" valign="bottom">Simulation: error-containing<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">map<hr/></td>
              <td align="center" valign="bottom">79.18%<hr/></td>
              <td align="center" valign="bottom">78.42%<hr/></td>
              <td align="center" valign="bottom">78.72%<hr/></td>
              <td align="center" valign="bottom">71.36%<hr/></td>
              <td align="center" valign="bottom">78.17%<hr/></td>
              <td align="center" valign="bottom">79.10%<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">acc<hr/></td>
              <td align="center" valign="bottom">98.11%<hr/></td>
              <td align="center" valign="bottom">98.59%<hr/></td>
              <td align="center" valign="bottom">99.02%<hr/></td>
              <td align="center" valign="bottom">99.61%<hr/></td>
              <td align="center" valign="bottom">98.82%<hr/></td>
              <td align="center" valign="bottom">98.81%<hr/></td>
            </tr>
            <tr>
              <td colspan="7" align="center" valign="bottom">Real data<hr/></td>
            </tr>
            <tr>
              <td align="center">map</td>
              <td align="center">64.45%</td>
              <td align="center">48.78%</td>
              <td align="center">47.29%</td>
              <td align="center">44.24%</td>
              <td align="center">46.89%</td>
              <td align="center">45.64%</td>
            </tr>
          </tbody>
        </table>
        <table-wrap-foot>
          <p>map = mappability, acc = accuracy, local = local alignment mode, e2e = end-to-end alignment mode. In this table, BS-Seeker2 maps the reads to RR genome (fragment lengths ranging 20 bp ~ 400 bp).</p>
        </table-wrap-foot>
      </table-wrap>
    </sec>
    <sec>
      <title>Feature comparisons</title>
      <p>BS-Seeker2 has been improved from BS-Seeker, by integrating variable aligners, supporting both WGBS and RRBS, and allowing mapping both single-end and paired-end reads, supporting all major input formats and output formats. For a clear view on the improvements of BS-Seeker2, a comparison table on the supported features is presented (Table <xref ref-type="table" rid="T4">4</xref>) in comparison with other BS aligners.</p>
      <table-wrap position="float" id="T4">
        <label>Table 4</label>
        <caption>
          <p>Features supported by BS-Seeker2, Bismark and BSMAP</p>
        </caption>
        <table frame="hsides" rules="groups" border="1">
          <colgroup>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
            <col align="center"/>
          </colgroup>
          <thead valign="top">
            <tr>
              <th align="center"> </th>
              <th align="center">
                <bold>BS-Seeker2</bold>
              </th>
              <th align="center">
                <bold>Bismark</bold>
              </th>
              <th align="center">
                <bold>BSMAP</bold>
              </th>
            </tr>
          </thead>
          <tbody valign="top">
            <tr>
              <td align="center" valign="bottom">Support local alignment<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Tailored for one restriction enzyme RRBS<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Map to reduced representation genome for RRBS<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Option for removing un-converted reads<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Tailored for double-restriction enzyme RRBS<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom"># of supported input formats<hr/></td>
              <td align="center" valign="bottom">4<hr/></td>
              <td align="center" valign="bottom">2<hr/></td>
              <td align="center" valign="bottom">3<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom"># of supported output formats<hr/></td>
              <td align="center" valign="bottom">3<hr/></td>
              <td align="center" valign="bottom">1<hr/></td>
              <td align="center" valign="bottom">3<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Build-in adapter removing function<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Generate wiggle file for methylation levels<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Report reads coverage for AT<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Able to manipulate all the parameters of Bowtie(2)<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">No<hr/></td>
              <td align="center" valign="bottom">-<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Programming language<hr/></td>
              <td align="center" valign="bottom">Python<hr/></td>
              <td align="center" valign="bottom">Perl<hr/></td>
              <td align="center" valign="bottom">C++<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Mapping strategy<hr/></td>
              <td align="center" valign="bottom">3-letter<hr/></td>
              <td align="center" valign="bottom">3-letter<hr/></td>
              <td align="center" valign="bottom">wild-card<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Available in Galaxy Toolshed<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Gapped alignment<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Call methylation for CG<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
              <td align="center" valign="bottom">Yes<hr/></td>
            </tr>
            <tr>
              <td align="center" valign="bottom">Support directional/non-directional sequencing<hr/></td>
              <td align="center" valign="bottom">Yes/Yes<hr/></td>
              <td align="center" valign="bottom">Yes/Yes<hr/></td>
              <td align="center" valign="bottom">Yes/Yes<hr/></td>
            </tr>
            <tr>
              <td align="center">Support Single-end/Paired-end sequencing</td>
              <td align="center">Yes/Yes</td>
              <td align="center">Yes/Yes</td>
              <td align="center">Yes/Yes</td>
            </tr>
          </tbody>
        </table>
      </table-wrap>
    </sec>
  </sec>
  <sec sec-type="discussion">
    <title>Discussion</title>
    <p>With local alignment, BS-Seeker2 is more capable of mapping “damaged” reads from a bad library with continuous sequencing errors or 3’ end contaminations. Although both BS-Seeker2 and BSMAP consider restriction site information for mapping RRBS-generated reads, BS-Seeker2 is able to process any combination of enzymes, such as double-enzyme digestion protocols (4), facilitating the experiment design on various enzymes. In the real data, a small portion of RRBS-generated reads could originate from regions outside the RR genome, so that they could only be mapped when using the whole genome index. However, these reads are usually not of interest for RRBS data and are best left out.</p>
    <p>RRBS libraries tend to have short reads contaminated with adapters in the sequenced reads, and the current <italic>in silico</italic> adapter trimming approach is not always effective to remove them. As a result of evaluation, BS-Seeker2 with local alignments is able to map the most reads than other tools in the comparison.</p>
    <p>Both Bowtie and the ‘end-to-end’ mode of Bowtie2 require reads to be fully mapped on the genome. Bowtie utilizes a single-seed method and evaluates the number of mismatches, while Bowtie2 utilizes a multiple-seed method and reports the best hit according to the score calculated by dynamic programming. Generally Bowtie is faster than Bowtie2 but less sensitive for long reads. The ‘local alignment’ mode of Bowtie2 allows reads to be partially mapped by trimming 5’ or 3’ ends during mapping, and BS-Seeker2 in ‘local alignment’ mode will report the hit with the unique best scores, which should exceed the minimum score (defined by the parameter “--score-min” of Bowtie2). The ‘local alignment’ mode requires more computing time due to the dynamic programming, and is effective for aligning reads sequenced with adapters or continuous errors. The ‘local alignment’ mode assumed the true originations of the reads are included in the reference genome, thus it could be possible to introduce false positive if reads are not from the reference genome.</p>
    <p>Lastly, we provide some suggestions for the optimal use of BS-Seeker2. For short reads, which usually are of high quality, choosing BS-Seeker2 coupled with Bowtie is enough to achieve a high mappability and is also time efficient. For gapped alignments, BS-Seeker2 with Bowtie2 is the best choice. For long reads with lower quality at the 3’ end, or data where some tiles have low sequence quality in several cycles, Bowtie2 in local alignment mode will achieve higher mappability but requires slightly longer CPU times. The ‘end-to-end’ mode of Bowtie2 could work best for some specific libraries. For example, the ‘multiple seed’ strategy could map more reads in a data set with low sequencing quality at the 5’ ends as it will have more chances to generate a unique hit by searching more seeds.</p>
  </sec>
  <sec sec-type="conclusions">
    <title>Conclusions</title>
    <p>We provide a BS alignment pipeline, BS-Seeker2, for fast and accurate mapping of BS reads from various types of library. We improved BS-Seeker2 by utilizing multiple short-read mapping aligners, supporting gapped mapping and local alignment and building special indexes for handling RRBS data. Our comparisons with respect to two other popular BS aligners showed that BS-Seeker2 has a comparable performance on WGBS data and outperforms on RRBS data with the others.</p>
  </sec>
  <sec>
    <title>Availability and requirements</title>
    <p>Project name: BS Seeker 2.</p>
    <p>Project home page: <ext-link ext-link-type="uri" xlink:href="http://pellegrini.mcdb.ucla.edu/BS_Seeker2/">http://pellegrini.mcdb.ucla.edu/BS_Seeker2/</ext-link>.</p>
    <p>Operating system(s): Linux/Mac OS.</p>
    <p>Programming language: Python 2.6 + .</p>
    <p>Other requirements: pysam package, Bowtie/Bowtie2.</p>
    <p>License: MIT License.</p>
    <p>Any restrictions to use by non-academics: No.</p>
  </sec>
  <sec>
    <title>Abbreviations</title>
    <p>WGBS: Whole genome bisulfite sequencing; RRBS: Reduced represented bisulfite sequencing; BS aligner: Bisulfite sequencing aligner.</p>
  </sec>
  <sec>
    <title>Competing interests</title>
    <p>The authors declare that they have no competing interests.</p>
  </sec>
  <sec>
    <title>Authors’ contributions</title>
    <p>WG, PF, SC, XS, MQZ, PYC and MP are responsible for design of BS-Seeker2. WG, PYC and MP are responsible for the conception and writing of the manuscript. WG, PF and PYC are responsible for the implementations of BS-Seeker2. WG, WY, PF and PYC are responsible for the configurations of tools on Galaxy toolshed. WY is responsible of maintaining the UCLA Galaxy server of BS-Seeker2. All authors read and approved the final manuscript.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="S1">
      <caption>
        <title>Additional file 1</title>
        <p>Pdf file contains Supplementary Methods, Figure S1-S5, Table S1 and descriptions of Supplementary Datasets.</p>
      </caption>
      <media xlink:href="1471-2164-14-774-S1.pdf">
        <caption>
          <p>Click here for file</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Acknowledgements</title>
    <p>We thank Marco Morselli, Luz Orozco and Larry Lam for helpful discussion. This work was supported by the Institute of Genomics and Proteomics at UCLA to MP, NSFC (91019016) and NBRPC (2012CB316503) to MQZ. WG received support from the China Scholarship Council.</p>
  </sec>
  <ref-list>
    <ref id="B1">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Cokus</surname>
          <given-names>SJ</given-names>
        </name>
        <name>
          <surname>Feng</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>X</given-names>
        </name>
        <name>
          <surname>Chen</surname>
          <given-names>Z</given-names>
        </name>
        <name>
          <surname>Merriman</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Haudenschild</surname>
          <given-names>CD</given-names>
        </name>
        <name>
          <surname>Pradhan</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Nelson</surname>
          <given-names>SF</given-names>
        </name>
        <name>
          <surname>Pellegrini</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Jacobsen</surname>
          <given-names>SE</given-names>
        </name>
        <article-title>Shotgun bisulphite sequencing of the Arabidopsis genome reveals DNA methylation patterning</article-title>
        <source>Nature</source>
        <year>2008</year>
        <volume>452</volume>
        <fpage>215</fpage>
        <lpage>219</lpage>
        <pub-id pub-id-type="doi">10.1038/nature06745</pub-id>
        <?supplied-pmid 18278030?>
        <pub-id pub-id-type="pmid">18278030</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B2">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Lister</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Pelizzola</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Dowen</surname>
          <given-names>RH</given-names>
        </name>
        <name>
          <surname>Hawkins</surname>
          <given-names>RD</given-names>
        </name>
        <name>
          <surname>Hon</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Tonti-Filippini</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Nery</surname>
          <given-names>JR</given-names>
        </name>
        <name>
          <surname>Lee</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Ye</surname>
          <given-names>Z</given-names>
        </name>
        <name>
          <surname>Ngo</surname>
          <given-names>Q-M</given-names>
        </name>
        <name>
          <surname>Edsall</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Antosiewicz-Bourget</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Stewart</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Ruotti</surname>
          <given-names>V</given-names>
        </name>
        <name>
          <surname>Millar</surname>
          <given-names>AH</given-names>
        </name>
        <name>
          <surname>Thomson</surname>
          <given-names>JA</given-names>
        </name>
        <name>
          <surname>Ren</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Ecker</surname>
          <given-names>JR</given-names>
        </name>
        <article-title>Human DNA methylomes at base resolution show widespread epigenomic differences</article-title>
        <source>Nature</source>
        <year>2009</year>
        <volume>462</volume>
        <fpage>315</fpage>
        <lpage>322</lpage>
        <pub-id pub-id-type="doi">10.1038/nature08514</pub-id>
        <?supplied-pmid 19829295?>
        <pub-id pub-id-type="pmid">19829295</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B3">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Meissner</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Mikkelsen</surname>
          <given-names>TS</given-names>
        </name>
        <name>
          <surname>Gu</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Wernig</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Hanna</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Sivachenko</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>X</given-names>
        </name>
        <name>
          <surname>Bernstein</surname>
          <given-names>BE</given-names>
        </name>
        <name>
          <surname>Nusbaum</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Jaffe</surname>
          <given-names>DB</given-names>
        </name>
        <name>
          <surname>Gnirke</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Jaenisch</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Lander</surname>
          <given-names>ES</given-names>
        </name>
        <article-title>Genome-scale DNA methylation maps of pluripotent and differentiated cells</article-title>
        <source>Nature</source>
        <year>2008</year>
        <volume>454</volume>
        <fpage>766</fpage>
        <lpage>770</lpage>
        <?supplied-pmid 18600261?>
        <pub-id pub-id-type="pmid">18600261</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B4">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Wang</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Xia</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Gong</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Yao</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Luo</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Lu</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Yi</surname>
          <given-names>N</given-names>
        </name>
        <name>
          <surname>Wu</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>X</given-names>
        </name>
        <name>
          <surname>Tao</surname>
          <given-names>Q</given-names>
        </name>
        <name>
          <surname>Gao</surname>
          <given-names>F</given-names>
        </name>
        <article-title>Double restriction-enzyme digestion improves the coverage and accuracy of genome-wide CpG methylation profiling by reduced representation bisulfite sequencing</article-title>
        <source>BMC Genomics</source>
        <year>2013</year>
        <volume>14</volume>
        <fpage>11</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2164-14-11</pub-id>
        <?supplied-pmid 23324053?>
        <pub-id pub-id-type="pmid">23324053</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B5">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Chen</surname>
          <given-names>P</given-names>
        </name>
        <name>
          <surname>Cokus</surname>
          <given-names>S</given-names>
        </name>
        <name>
          <surname>Pellegrini</surname>
          <given-names>M</given-names>
        </name>
        <article-title>BS Seeker: precise mapping for bisulfite sequencing</article-title>
        <source>BMC Bioinforma</source>
        <year>2010</year>
        <volume>11</volume>
        <fpage>203</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-11-203</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B6">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Langmead</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Trapnell</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Pop</surname>
          <given-names>M</given-names>
        </name>
        <name>
          <surname>Salzberg</surname>
          <given-names>SL</given-names>
        </name>
        <article-title>Ultrafast and memory-efficient alignment of short DNA sequences to the human genome</article-title>
        <source>Genome Biol</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>R25</fpage>
        <pub-id pub-id-type="doi">10.1186/gb-2009-10-3-r25</pub-id>
        <?supplied-pmid 19261174?>
        <pub-id pub-id-type="pmid">19261174</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B7">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Krueger</surname>
          <given-names>F</given-names>
        </name>
        <name>
          <surname>Andrews</surname>
          <given-names>SR</given-names>
        </name>
        <article-title>Bismark: a flexible aligner and methylation caller for Bisulfite-Seq applications</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>1571</fpage>
        <lpage>1572</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr167</pub-id>
        <?supplied-pmid 21493656?>
        <pub-id pub-id-type="pmid">21493656</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B8">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Harris</surname>
          <given-names>EY</given-names>
        </name>
        <name>
          <surname>Ponts</surname>
          <given-names>N</given-names>
        </name>
        <name>
          <surname>Le Roch</surname>
          <given-names>KG</given-names>
        </name>
        <name>
          <surname>Lonardi</surname>
          <given-names>S</given-names>
        </name>
        <article-title>BRAT-BW: efficient and accurate mapping of bisulfite-treated reads</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>1795</fpage>
        <lpage>1796</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bts264</pub-id>
        <?supplied-pmid 22563065?>
        <pub-id pub-id-type="pmid">22563065</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B9">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Pedersen</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Hsieh</surname>
          <given-names>T-F</given-names>
        </name>
        <name>
          <surname>Ibarra</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Fischer</surname>
          <given-names>RL</given-names>
        </name>
        <article-title>MethylCoder: software pipeline for bisulfite-treated sequences</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>2435</fpage>
        <lpage>2436</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr394</pub-id>
        <?supplied-pmid 21724594?>
        <pub-id pub-id-type="pmid">21724594</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B10">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Xi</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>W</given-names>
        </name>
        <article-title>BSMAP: whole genome bisulfite sequence MAPping program</article-title>
        <source>BMC Bioinforma</source>
        <year>2009</year>
        <volume>10</volume>
        <fpage>232</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-10-232</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B11">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Smith</surname>
          <given-names>AD</given-names>
        </name>
        <name>
          <surname>Chung</surname>
          <given-names>W-Y</given-names>
        </name>
        <name>
          <surname>Hodges</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Kendall</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Hannon</surname>
          <given-names>G</given-names>
        </name>
        <name>
          <surname>Hicks</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Xuan</surname>
          <given-names>Z</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>MQ</given-names>
        </name>
        <article-title>Updates to the RMAP short-read mapping software</article-title>
        <source>Bioinformatics</source>
        <year>2009</year>
        <volume>25</volume>
        <fpage>2841</fpage>
        <lpage>2842</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btp533</pub-id>
        <?supplied-pmid 19736251?>
        <pub-id pub-id-type="pmid">19736251</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B12">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Wu</surname>
          <given-names>TD</given-names>
        </name>
        <name>
          <surname>Nacu</surname>
          <given-names>S</given-names>
        </name>
        <article-title>Fast and SNP-tolerant detection of complex variants and splicing in short reads</article-title>
        <source>Bioinformatics</source>
        <year>2010</year>
        <volume>26</volume>
        <fpage>873</fpage>
        <lpage>881</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btq057</pub-id>
        <?supplied-pmid 20147302?>
        <pub-id pub-id-type="pmid">20147302</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B13">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Xi</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Bock</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Müller</surname>
          <given-names>F</given-names>
        </name>
        <name>
          <surname>Sun</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Meissner</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>W</given-names>
        </name>
        <article-title>RRBSMAP: a fast, accurate and user-friendly alignment tool for reduced representation bisulfite sequencing</article-title>
        <source>Bioinformatics</source>
        <year>2012</year>
        <volume>28</volume>
        <fpage>430</fpage>
        <lpage>432</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr668</pub-id>
        <?supplied-pmid 22155871?>
        <pub-id pub-id-type="pmid">22155871</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B14">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Langmead</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Salzberg</surname>
          <given-names>SL</given-names>
        </name>
        <article-title>Fast gapped-read alignment with Bowtie 2</article-title>
        <source>Nat Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>357</fpage>
        <lpage>359</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.1923</pub-id>
        <?supplied-pmid 22388286?>
        <pub-id pub-id-type="pmid">22388286</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B15">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Li</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Li</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Kristiansen</surname>
          <given-names>K</given-names>
        </name>
        <name>
          <surname>Wang</surname>
          <given-names>J</given-names>
        </name>
        <article-title>SOAP: short oligonucleotide alignment program</article-title>
        <source>Bioinformatics</source>
        <year>2008</year>
        <volume>24</volume>
        <fpage>713</fpage>
        <lpage>714</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btn025</pub-id>
        <?supplied-pmid 18227114?>
        <pub-id pub-id-type="pmid">18227114</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B16">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Smith</surname>
          <given-names>AD</given-names>
        </name>
        <name>
          <surname>Xuan</surname>
          <given-names>Z</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>MQ</given-names>
        </name>
        <article-title>Using quality scores and longer reads improves accuracy of Solexa read mapping</article-title>
        <source>BMC Bioinforma</source>
        <year>2008</year>
        <volume>9</volume>
        <fpage>128</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-9-128</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B17">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Giardine</surname>
          <given-names>B</given-names>
        </name>
        <name>
          <surname>Riemer</surname>
          <given-names>C</given-names>
        </name>
        <name>
          <surname>Hardison</surname>
          <given-names>RC</given-names>
        </name>
        <name>
          <surname>Burhans</surname>
          <given-names>R</given-names>
        </name>
        <name>
          <surname>Elnitski</surname>
          <given-names>L</given-names>
        </name>
        <name>
          <surname>Shah</surname>
          <given-names>P</given-names>
        </name>
        <name>
          <surname>Zhang</surname>
          <given-names>Y</given-names>
        </name>
        <name>
          <surname>Blankenberg</surname>
          <given-names>D</given-names>
        </name>
        <name>
          <surname>Albert</surname>
          <given-names>I</given-names>
        </name>
        <name>
          <surname>Taylor</surname>
          <given-names>J</given-names>
        </name>
        <name>
          <surname>Miller</surname>
          <given-names>W</given-names>
        </name>
        <name>
          <surname>Kent</surname>
          <given-names>WJ</given-names>
        </name>
        <name>
          <surname>Nekrutenko</surname>
          <given-names>A</given-names>
        </name>
        <article-title>Galaxy: a platform for interactive large-scale genome analysis</article-title>
        <source>Genome Res</source>
        <year>2005</year>
        <volume>15</volume>
        <fpage>1451</fpage>
        <lpage>1455</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.4086505</pub-id>
        <?supplied-pmid 16169926?>
        <pub-id pub-id-type="pmid">16169926</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B18">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Thorvaldsdóttir</surname>
          <given-names>H</given-names>
        </name>
        <name>
          <surname>Robinson</surname>
          <given-names>JT</given-names>
        </name>
        <name>
          <surname>Mesirov</surname>
          <given-names>JP</given-names>
        </name>
        <article-title>Integrative Genomics Viewer (IGV): high-performance genomics data visualization and exploration</article-title>
        <source>Brief Bioinform</source>
        <year>2012</year>
        <volume>14</volume>
        <fpage>178</fpage>
        <lpage>192</lpage>
        <?supplied-pmid 22517427?>
        <pub-id pub-id-type="pmid">22517427</pub-id>
      </mixed-citation>
    </ref>
    <ref id="B19">
      <mixed-citation publication-type="journal">
        <name>
          <surname>Molaro</surname>
          <given-names>A</given-names>
        </name>
        <name>
          <surname>Hodges</surname>
          <given-names>E</given-names>
        </name>
        <name>
          <surname>Fang</surname>
          <given-names>F</given-names>
        </name>
        <name>
          <surname>Song</surname>
          <given-names>Q</given-names>
        </name>
        <name>
          <surname>McCombie</surname>
          <given-names>WR</given-names>
        </name>
        <name>
          <surname>Hannon</surname>
          <given-names>GJ</given-names>
        </name>
        <name>
          <surname>Smith</surname>
          <given-names>AD</given-names>
        </name>
        <article-title>Sperm methylation profiles reveal features of epigenetic inheritance and evolution in primates</article-title>
        <source>Cell</source>
        <year>2011</year>
        <volume>146</volume>
        <fpage>1029</fpage>
        <lpage>1041</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2011.08.016</pub-id>
        <?supplied-pmid 21925323?>
        <pub-id pub-id-type="pmid">21925323</pub-id>
      </mixed-citation>
    </ref>
  </ref-list>
</back>
