<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">JAMIA Open</journal-id>
    <journal-id journal-id-type="iso-abbrev">JAMIA Open</journal-id>
    <journal-id journal-id-type="publisher-id">jamiaoa</journal-id>
    <journal-title-group>
      <journal-title>JAMIA Open</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2574-2531</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6800657</article-id>
    <article-id pub-id-type="pmid">31633087</article-id>
    <article-id pub-id-type="doi">10.1093/jamiaopen/ooy059</article-id>
    <article-id pub-id-type="publisher-id">ooy059</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Application Notes</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ROMOP: a light-weight R package for interfacing with OMOP-formatted electronic health record data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0003-4515-8090</contrib-id>
        <name>
          <surname>Glicksberg</surname>
          <given-names>Benjamin S</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Oskotsky</surname>
          <given-names>Boris</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Giangreco</surname>
          <given-names>Nicholas</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff2">2</xref>
        <xref ref-type="author-notes" rid="ooy059-FM1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Thangaraj</surname>
          <given-names>Phyllis M</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff2">2</xref>
        <xref ref-type="author-notes" rid="ooy059-FM1"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rudrapatna</surname>
          <given-names>Vivek</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Datta</surname>
          <given-names>Debajyoti</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Frazier</surname>
          <given-names>Remi</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Lee</surname>
          <given-names>Nelson</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Larsen</surname>
          <given-names>Rick</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Tatonetti</surname>
          <given-names>Nicholas P</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Butte</surname>
          <given-names>Atul J</given-names>
        </name>
        <xref ref-type="aff" rid="ooy059-aff1">1</xref>
        <xref ref-type="corresp" rid="ooy059-cor1"/>
        <!--<email>Atul.Butte@ucsf.edu</email>-->
      </contrib>
    </contrib-group>
    <aff id="ooy059-aff1"><label>1</label>Department of Pediatrics Bakar Computational Health Sciences Institute, University of California San Francisco, San Francisco, California, USA</aff>
    <aff id="ooy059-aff2"><label>2</label>Departments of Biomedical Informatics, Systems Biology, and Medicine, Columbia University, New York, New York, USA</aff>
    <aff id="ooy059-aff3"><label>3</label>Academic Research Systems, Department of Enterprise Data Warehouse University of California San Francisco, San Francisco, California, USA</aff>
    <author-notes>
      <fn id="ooy059-FM1">
        <p>These two authors contributed equally to the study.</p>
      </fn>
      <corresp id="ooy059-cor1">Corresponding Author: Atul J. Butte, MD, PhD, Bakar Computational Health Sciences Institute, University of California San Francisco, San Francisco, CA 94158, USA (<email>Atul.Butte@ucsf.edu</email>)</corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>4</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2019-01-04">
      <day>04</day>
      <month>1</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>04</day>
      <month>1</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>2</volume>
    <issue>1</issue>
    <fpage>10</fpage>
    <lpage>14</lpage>
    <history>
      <date date-type="received">
        <day>03</day>
        <month>7</month>
        <year>2018</year>
      </date>
      <date date-type="rev-recd">
        <day>26</day>
        <month>10</month>
        <year>2018</year>
      </date>
      <date date-type="accepted">
        <day>02</day>
        <month>12</month>
        <year>2018</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2019. Published by Oxford University Press on behalf of the American Medical Informatics Association.</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/" license-type="cc-by">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="ooy059.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Objectives</title>
        <p>Electronic health record (EHR) data are increasingly used for biomedical discoveries. The nature of the data, however, requires expertise in both data science and EHR structure. The Observational Medical Outcomes Partnership (OMOP) common data model (CDM) standardizes the language and structure of EHR data to promote interoperability of EHR data for research. While the OMOP CDM is valuable and more attuned to research purposes, it still requires extensive domain knowledge to utilize effectively, potentially limiting more widespread adoption of EHR data for research and quality improvement.</p>
      </sec>
      <sec id="s2">
        <title>Materials and methods</title>
        <p>We have created ROMOP: an R package for direct interfacing with EHR data in the OMOP CDM format.</p>
      </sec>
      <sec id="s3">
        <title>Results</title>
        <p>ROMOP streamlines typical EHR-related data processes. Its functions include exploration of data types, extraction and summarization of patient clinical and demographic data, and patient searches using any CDM vocabulary concept.</p>
      </sec>
      <sec id="s4">
        <title>Conclusion</title>
        <p>ROMOP is freely available under the Massachusetts Institute of Technology (MIT) license and can be obtained from GitHub (<ext-link ext-link-type="uri" xlink:href="http://github.com/BenGlicksberg/ROMOP">http://github.com/BenGlicksberg/ROMOP</ext-link>). We detail instructions for setup and use in the <xref ref-type="supplementary-material" rid="sup1">Supplementary Materials</xref>. Additionally, we provide a public sandbox server containing synthesized clinical data for users to explore OMOP data and ROMOP (<ext-link ext-link-type="uri" xlink:href="http://romop.ucsf.edu">http://romop.ucsf.edu</ext-link>).</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">National Center for Advancing Translational Sciences, National Institutes of Health</named-content>
        </funding-source>
        <award-id>UL1 TR001872</award-id>
      </award-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">Bakar Computational Health Sciences Institute</named-content>
        </funding-source>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="5"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>BACKGROUND AND SIGNIFICANCE</title>
    <p>Widespread adoption of electronic health records (EHRs) into health systems is ushering clinical data into the digital age.<xref rid="ooy059-B1" ref-type="bibr"><sup>1</sup></xref> Large-scale analytics of EHR data have produced impactful discoveries that have, in turn, enabled the practice of precision medicine.<xref rid="ooy059-B2" ref-type="bibr"><sup>2</sup></xref> It is clear that biomedical researchers in all areas including practicing clinicians, data scientists, and wet lab biologists, could enhance their work by integrating findings taken from this “real world evidence.” There exist many barriers that limit usability of EHR data, however, revolving primarily around available expertise. As EHR data are large scale and typically stored in relational databases, some knowledge of structured query language (SQL) programing is required, which many clinicians and scientists do not have experience with nor the time to sufficiently gain. Furthermore, the structure and data components of EHR systems are complicated and necessitate strong familiarity in order to utilize most effectively. While many get around this issue by setting up effective cross-disciplinary collaborations (eg, physicians working with data science teams), it would be invaluable for enable more researchers themselves to be able work with the data directly.</p>
    <p>Further complicating the issue is the fact that different health systems often have different EHR frameworks (eg, Epic or Cerner) and with them, different vocabularies to represent the clinical data. To address issues surrounding interoperability, initiatives like the Observational Health Data Sciences and Informatics (OHDSI; <ext-link ext-link-type="uri" xlink:href="https://www.ohdsi.org/">https://www.ohdsi.org/</ext-link>) and Health Level Seven (HL7) have developed common data models (CDMs), such as OHDSI’s Observational Medical Outcomes Partnership (OMOP) CDM or the Fast Healthcare Interoperability Resources (FHIR; <ext-link ext-link-type="uri" xlink:href="https://www.hl7.org/fhir/">https://www.hl7.org/fhir/</ext-link>), to standardize both the language and structure of EHR data. These data models are often built around standardized meta-thesauruses like the Unified Medical Language System (UMLS)<xref rid="ooy059-B3" ref-type="bibr"><sup>3</sup></xref> that integrate many different ontologies. One major advantage out of the many to this approach is the ability for researchers across institutions to share code and workflows that will integrate seamlessly.<xref rid="ooy059-B4" ref-type="bibr"><sup>4</sup></xref> A substantial amount of research has already leveraged the power of the CDM to perform large-scale observational studies.<xref rid="ooy059-B5" ref-type="bibr"><sup>5–9</sup></xref></p>
    <p>While the OMOP CDM was built in a framework that is more conducive for research purposes (and is arguably one of the simplest systems of its kind), it still requires a fundamental understanding of EHR data and ontological structures for effective use. Functional and convenient applications, including web tools and software packages that can help visualize data or even perform analyses, can lessen the burden of requiring programing and domain-specific EHR expertise. As of the writing of this manuscript, the OHDSI group has produced an impressive number of packages and resources (over 100 public repositories) on their GitHub page (<ext-link ext-link-type="uri" xlink:href="https://github.com/OHDSI">https://github.com/OHDSI</ext-link>) written in a variety of languages including R, JavaScript, Java, C++, and HTML. These packages cover a range of useful tools beyond just the CDM (eg, CommonDataModel), including back-end engines (eg, ArachneExecutionEngine), connectors (eg, DatabaseConnector), user-interfaces (eg, ArachneUI and AthenaUI), web resources (eg, ATLAS, Achilles, and Athena), tools for data processing and extraction (eg, OhdsiRTools and FeatureExtraction), as well as those that automatically perform analyses (eg, PatientLevelPrection, CohortMethod<italic>,</italic> Cyclops, CaseCrossover, and CaseControl). These packages have been invaluable to the development and dissemination of the OMOP CDM by enabling and encouraging scripts that can automate complex analyses.</p>
    <p>These tools effectively work together as a system to enable the entire spectrum of processes starting from OMOP CDM set-up to running experiments. While these tools are immensely useful and powerful, they are not necessarily geared toward new users, which may restrict further adoption of the OMOP CDM. For instance, in order to extract clinical data for a list of patients using FeatureExtraction, a cohort must first be defined using specific outcome IDs in a separate source (eg, ATLAS).</p>
  </sec>
  <sec>
    <title>OBJECTIVES</title>
    <p>The goal of ROMOP is to provide a simple and straightforward method to automatically extract relevant clinical and demographic data from an OMOP EHR database into an R object. In this way, ROMOP brings an abstraction layer for EHR data potentially to the millions of R users. Additionally, ROMOP provides a flexible way to search for patients that takes advantage of the power of the unified vocabularies underlying the CDM (ie, finding all patients that are prescribed a pharmaceutical class of medications). In essence, ROMOP combines much of the functionality of current OHDSI packages into a single resource, streamlined for effective EHR research purposes (<xref ref-type="fig" rid="ooy059-F1">Figure 1</xref>).
</p>
    <fig id="ooy059-F1" orientation="portrait" position="float">
      <label>Figure 1.</label>
      <caption>
        <p>Schematic and structure of ROMOP. (A) ROMOP interfaces with OMOP-formatted EHR data in a relational database structure. Users can retrieve all relevant clinical, demographic, and encounter data for a list of patients directly into an R object as well as search for patients using any vocabulary contained within the OMOP CDM. (B) When searching for patients using clinical vocabularies, ROMOP offers the option to automatically map (“map” option) to the standardized ontology (eg, SNOMED) and query all concepts lower in the hierarchy (ie, descendants). Alternatively users can search for terms directly (“direct” option). ROMOP identifies the relevant clinical tables and fields to query and can produce a set of outputs detailing the query and outcomes. CDM: common data model; EHR: electronic health record; OMOP: Observational Medical Outcomes Partnership.</p>
      </caption>
      <graphic xlink:href="ooy059f1"/>
    </fig>
    <p>In light of interoperability goals, we verified that this package works seamlessly in 2 independent tertiary-care institutions: University of California, San Francisco and Columbia University. This package will ideally supplement other current tools to facilitate more widespread utility of the OMOP data model.</p>
  </sec>
  <sec sec-type="methods">
    <title>METHODS</title>
    <p>One of the main goals of ROMOP is to facilitate utility of OMOP-formatted EHR data for R users without the need for extensive domain knowledge underlying the CDM. Users of this package need only fundamental expertise of R, general understanding of EHR data (ie, types of vocabularies used to encode data), and minimal exposure to the OMOP CDM. The specific tables from which data can be extracted are relatively straightforward (eg, condition_occurrence for the majority of disease-related data, drug_exposure for medication-related data, etc.). We highly recommend the OHDSI resources and tools mentioned in the <xref ref-type="supplementary-material" rid="sup1">Supplementary Materials</xref> and sandbox server for users to gain more familiarity with the CDM structure. Further details about the data that are returned and how ROMOP interacts with the CDM can be found in the <xref ref-type="supplementary-material" rid="sup1">Supplementary Materials</xref> in the <italic>Code Breakdown</italic> section.</p>
    <sec>
      <title>Package details and installation instructions</title>
      <p>ROMOP is written in R (version 3.4.1), organized using roxygen2,<xref rid="ooy059-B10" ref-type="bibr"><sup>10</sup></xref> and utilizes the following packages for processing: data.table,<xref rid="ooy059-B11" ref-type="bibr"><sup>11</sup></xref>, DBI,<xref rid="ooy059-B12" ref-type="bibr"><sup>12</sup></xref> and dplyr.<xref rid="ooy059-B13" ref-type="bibr"><sup>13</sup></xref> ROMOP can connect to an OMOP-formatted EHR database in either MySQL format using odbc<xref rid="ooy059-B14" ref-type="bibr"><sup>14</sup></xref> and RMySQL<xref rid="ooy059-B15" ref-type="bibr"><sup>15</sup></xref> or a variety of others including, Oracle, PostgreSQL, Microsoft SQL Server, Amazon Redshift, Google BigQuery, and Microsoft Parallel Data Warehouse, made possible through the OHDSI group’s DatabaseConnector<xref rid="ooy059-B16" ref-type="bibr"><sup>16</sup></xref> and DatabaseConnectorJars<xref rid="ooy059-B17" ref-type="bibr"><sup>17</sup></xref> packages. All queries are automatically translated into the appropriate database syntax using the OHDSI group’s SqlRender<xref rid="ooy059-B18" ref-type="bibr"><sup>18</sup></xref> package.</p>
      <p>For full details, instructions, and examples please refer to the Readme, which can be obtained from the package GitHub page and is provided in the <xref ref-type="supplementary-material" rid="sup1">Supplementary Materials</xref>. ROMOP can be retrieved and downloaded from the GitHub page directly or using the following devtools<xref rid="ooy059-B19" ref-type="bibr"><sup>19</sup></xref> function: “install_github(“BenGlicksberg/ROMOP”).” In consideration for securely storing connection credential information, these data are entered after installation within the R environment file (“.Renviron”) for retrieval by the package. ROMOP will perform a series of checks to determine whether the server can be connected to and if the required tables are accessible.</p>
    </sec>
    <sec>
      <title>Synthesized clinical EHR data and sandbox server</title>
      <p>The Centers for Medicare and Medicaid Services (CMS) have publicly released a synthetic clinical dataset (DE-SynPUF; <ext-link ext-link-type="uri" xlink:href="https://www.cms.gov/Research-Statistics-Data-and-Systems/Downloadable-Public-Use-Files/SynPUFs/DE_Syn_PUF.html">https://www.cms.gov/Research-Statistics-Data-and-Systems/Downloadable-Public-Use-Files/SynPUFs/DE_Syn_PUF.html</ext-link>) with the aim of being reflective of the patient population, while containing no protected health information (PHI). The OHDSI group previously undertook the task of converting these data into the OMOP CDM format (<ext-link ext-link-type="uri" xlink:href="https://github.com/OHDSI/ETL-CMS">https://github.com/OHDSI/ETL-CMS</ext-link>). As readers may not have access to EHR data in OMOP format, we provide a sandbox server that has these data in a database where users can explore the CDM as well as the ROMOP package (although users can set up this configuration on their own system following the instructions on the GitHub page). We obtained all data files from <ext-link ext-link-type="uri" xlink:href="http://ftp://ftp.ohdsi.org/synpuf">ftp://ftp.ohdsi.org/synpuf</ext-link> (accessed June 17, 2018) and created the CDM (DDL and indexes) according to <ext-link ext-link-type="uri" xlink:href="https://github.com/OHDSI/CommonDataModel/tree/master/PostgreSQL">https://github.com/OHDSI/CommonDataModel/tree/master/PostgreSQL</ext-link>, but modified for MySQL. For space considerations, we only uploaded 1 million rows of each of the data files. The sandbox server is a R/shiny<xref rid="ooy059-B20" ref-type="bibr"><sup>20</sup></xref> server running as an Elastic Compute Cloud (EC2) instance on Amazon Web Services (AWS) querying a MySQL database server (AWS Aurora MySQL). The interactive tutorial was created using the learnr<xref rid="ooy059-B21" ref-type="bibr"><sup>21</sup></xref> package. The sandbox server is available to the public at <ext-link ext-link-type="uri" xlink:href="http://romop.ucsf.edu">http://romop.ucsf.edu</ext-link> and contains no PHI.</p>
    </sec>
  </sec>
  <sec sec-type="results">
    <title>RESULTS</title>
    <p>While the functionality afforded by this package pales in comparison to the advanced and multifaceted tools provided by the OHDSI group, it will hopefully facilitate EHR data mining for users unfamiliar with the OMOP structure. All package functionality revolves around a data dictionary of all concepts, which prioritizes the tables to query as well as allows for flexible search options (<xref ref-type="fig" rid="ooy059-F1">Figure 1A</xref>). We provide detailed instructions and example use cases (ie, how to identify all patients prescribed any drug of a certain class) in the package tutorial (see <xref ref-type="supplementary-material" rid="sup1">Supplementary Materials</xref>) as well interactive examples on the sandbox server.</p>
    <sec>
      <title>Data exploration</title>
      <p>ROMOP allows for basic exploration of data types contained in the ontological hierarchy. To understand which vocabularies can be prioritized for queries of interest, the <italic>showDataTypes</italic> function breaks down all available vocabularies per domain (eg, LOINC for Observation and Measurement). The <italic>exploreConcepts</italic> function can be used to identify all mapped terms for a seed concept that are descendants in the hierarchy (see Section 4.3 for more details on what this entails). Additionally, for a provided patient list, ROMOP provides a function to generate a basic demographic breakdown of the cohort.</p>
    </sec>
    <sec>
      <title>Retrieving all data for a set of patients</title>
      <p>Researchers who have a preselected patient cohort, or even a single patient of interest, can easily retrieve all relevant clinical, demographic, and encounter information. Relevant demographic (eg, birthdate, gender, and ethnicity) and encounter (eg, visit datetime and type) information can each be retrieved and formatted as an R data.table using a single command. Clinical data are retrieved and mapped to their respective terms from the “condition_occurrence,” “device_exposure,” “drug_exposure,” “measurement,” “procedure_occurrence,” and “observation” tables. All data concepts are first mapped through the data dictionary to return terms instead of identifiers.</p>
    </sec>
    <sec>
      <title>Searching for patient cohort using flexible inclusion (and exclusion) criteria</title>
      <p>In the OMOP data structure, there is a distinction between how concepts are recorded and what can be directly searched for. For instance, if the user is interested in the medication idelalisib, it is not possible to directly identify records by searching for the general concept (eg, RxNorm code 1544460) as the data are recorded by the bottom-most (ie, most specific) concepts of the hierarchy (eg, idelalisib 150 MG Delayed Release Oral Tablet). The hierarchical structure of these concepts in the OMOP CDM backend, however, facilitates more powerful searches. In most extracted EHR systems, the user has to define all medications to search, for instance through a prepopulated list or by wildcard string matching (eg, all drug names LIKE “%statin%”). This strategy is ultimately not ideal as it is not extensible to other systems (eg, one system might prescribe a version or formulation of a drug that is not in another) and requires extensive manual quality-control (eg, removing “nystatin” drugs from the string matching results).</p>
      <p>As such, we provide straightforward yet flexible ways to search for patients (<italic>findPatients</italic> function) that takes advantage of the underlying OMOP CDM structure (<xref ref-type="fig" rid="ooy059-F1">Figure 1B</xref>). If the “mapped” option is selected, searching for a broad code like ATC level 3 code A05A (bile therapies), or even a specific term code like RxNorm code 1544460 for idelalisib, will automatically identify and query for all bottom-level (eg, idelalisib 150 MG Delayed Release Oral Tablet) codes contained underneath that seed concept. This works by ROMOP first mapping the initial search criteria to a standard concept (SNOMED or RxNorm) and finding all descendants underneath it through making use of the OMOP concept tables (for more details on this procedure please refer to <xref ref-type="supplementary-material" rid="sup1">Supplementary Materials</xref><italic>Code Breakdown</italic> section). Another benefit to this “mapped” option is that terms are not reliant on how the data were originally entered. For instance, if a health system switches from ICD-9CM to ICD-10CM coding, there might be discrepancies in prevalence of codes over time. Mapping to a common concept, however, often alleviates this issue as codes from both vocabularies are typically linked to a common code in the standard vocabulary. The user can also search for the concepts using the “direct” option (ie, search for ICD-9CM code 230.0 only).</p>
      <p>This function allows for simultaneous incorporation of multiple vocabulary types (eg, ATC and LOINC codes) and codes, as well as supporting both inclusion and exclusion criteria. The user can also set the strategy of dealing with criteria, namely either union (ie, or) or intersection (ie, and) requirements. Lastly, there is an option to save all output from the search function beyond the patient list, including: the query criteria used; the outcome of the query; and all mapped concepts used for the search along with unique patient counts per term. Please refer to the Readme or <xref ref-type="supplementary-material" rid="sup1">Supplementary Materials</xref> for more information on the functionality of the package as well as sample more use cases.</p>
    </sec>
  </sec>
  <sec>
    <title>CONCLUSION</title>
    <p>In this package, we offer a new straightforward method to interface the popular data science language R with OMOP-formatted EHR data stored in a relational database that is not possible in existing related packages. ROMOP can be used to easily retrieve relevant clinical and demographic data for a patient list of interest. Furthermore, it allows for patient searches using flexible delineations of inclusion and exclusion criteria (ie, multiple and various vocabularies and concept terms) that can take advantage of the power of the CDM.</p>
    <p>There are, of course, many limitations to this package. While this package can be run on a server with PHI, these servers are often managed in a restrictive manner and R itself might not always be available. Along these lines, the package will not expand the use of EHR data in and of itself. Users would still be required to have IRB-approved access to EHR data, deidentified or otherwise, structured in the OMOP CDM format in order to use ROMOP. We believe, however, that many research institutions will continue to maintain versions of their EHR data in the OMOP CDM (especially given the relationship between OMOP, the All of Us Research Program, and PCORnet). We are predicting many new data scientists entering the field of clinical data informatics who might appreciate the availability of more straightforward tools for initial exposure to the OMOP CDM. Lastly, we acknowledge the functionality of ROMOP is basic in comparison to the existing powerful tools and packages that can perform complex analyses on OMOP-formatted data. Geared toward new or less experienced users, ROMOP will hopefully supplement many such tools. For individuals without access to OMOP-formatted EHR data, we provide a sandbox server (<ext-link ext-link-type="uri" xlink:href="http://romop.ucsf.edu">http://romop.ucsf.edu</ext-link>) to test ROMOP on synthesized clinical EHR data with a step-by-step tutorial. The package and all supporting materials are freely available on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/BenGlicksberg/ROMOP">https://github.com/BenGlicksberg/ROMOP</ext-link>).</p>
  </sec>
  <sec>
    <title>SUPPLEMENTARY MATERIAL</title>
    <p><xref ref-type="supplementary-material" rid="sup1">Supplementary material</xref> is available at <italic>Journal of the American Medical Informatics Association</italic> online.</p>
  </sec>
  <sec>
    <title>CONTRIBUTORS</title>
    <p>B.S.G. designed the study, authored the software package and sandbox system tutorial, and wrote the manuscript. B.O. provided system administration infrastructural support and guidance for implementing the package on UCSF’s EHR as well as setting up and configuring the public sandbox server. V.R. and D.D. provided clinical expertise in design and utilization of the package as well as framing the manuscript. R.F., N.L., and R.L. were responsible for enabling utility of UCSF EHR data in OMOP format. N.G., P.T., and N.P.T. deployed and tested the package using Columbia University’s EHR and provided software and manuscript edits and revisions. A.J.B. conceived of the study, provided overall guidance and support, and made critical manuscript revisions. All authors reviewed and approved of the manuscript.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>Supplementary Data</label>
      <media xlink:href="ooy059_supp.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="AK1">
    <title>ACKNOWLEDGMENTS</title>
    <p>We thank Marcus A. Badgeley, Kipp W. Johnson, and Zicheng Hu for helpful conversations regarding package development. We thank Dana Ludwig and the UCSF Information Technology Services Academic Research System team for EHR data infrastructure setup and support. We would also like to acknowledge the OHDSI group, developers, and community for providing extensive documentation of the CDM as well as formatting and releasing the OMOP-formatted CMS data.</p>
    <sec>
      <title>FUNDING</title>
      <p>This publication was supported partially by the National Center for Advancing Translational Sciences, National Institutes of Health, through UCSF-CTSI Grant Number UL1 TR001872. Its contents are solely the responsibility of the authors and do not necessarily represent the official views of the NIH. Partial support was also obtained from the Bakar Computational Health Sciences Institute.</p>
      <p><italic>Conflict of interest statement.</italic> None declared.</p>
    </sec>
  </ack>
  <ref-list id="RL1">
    <title>REFERENCES</title>
    <ref id="ooy059-B1">
      <label>1</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Blumenthal</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Tavenner</surname><given-names>M.</given-names></name></person-group><article-title>The “meaningful use” regulation for electronic health records</article-title>. <source>N Engl J Med</source><year>2010</year>; <volume>363</volume><issue>6</issue>: <fpage>501</fpage>–<lpage>4</lpage>.<pub-id pub-id-type="pmid">20647183</pub-id></mixed-citation>
    </ref>
    <ref id="ooy059-B2">
      <label>2</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Jensen</surname><given-names>PB</given-names></name>, <name name-style="western"><surname>Jensen</surname><given-names>LJ</given-names></name>, <name name-style="western"><surname>Brunak</surname><given-names>S.</given-names></name></person-group><article-title>Mining electronic health records: towards better research applications and clinical care</article-title>. <source>Nat Rev Genet</source><year>2012</year>; <volume>13</volume><issue>6</issue>: <fpage>395</fpage>–<lpage>405</lpage>.<pub-id pub-id-type="pmid">22549152</pub-id></mixed-citation>
    </ref>
    <ref id="ooy059-B3">
      <label>3</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bodenreider</surname><given-names>O.</given-names></name></person-group><article-title>The Unified Medical Language System (UMLS): integrating biomedical terminology</article-title>. <source>Nucleic Acids Res</source><year>2004</year>; <volume>32</volume>: <fpage>D267</fpage>–<lpage>70</lpage>.<pub-id pub-id-type="pmid">14681409</pub-id></mixed-citation>
    </ref>
    <ref id="ooy059-B4">
      <label>4</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Huser</surname><given-names>V</given-names></name>, <name name-style="western"><surname>DeFalco</surname><given-names>FJ</given-names></name>, <name name-style="western"><surname>Schuemie</surname><given-names>M</given-names></name></person-group>,
<etal>et al</etal><article-title>Multisite evaluation of a data quality tool for patient-level clinical data sets</article-title>. <source>EGEMS (Wash DC)</source><year>2016</year>; <volume>4</volume><issue>1</issue>: <fpage>1239</fpage>.<pub-id pub-id-type="pmid">28154833</pub-id></mixed-citation>
    </ref>
    <ref id="ooy059-B5">
      <label>5</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Shaddox</surname><given-names>TR</given-names></name>, <name name-style="western"><surname>Ryan</surname><given-names>PB</given-names></name>, <name name-style="western"><surname>Schuemie</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Madigan</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA.</given-names></name></person-group><article-title>Hierarchical models for multiple, rare outcomes using massive observational healthcare databases</article-title>. <source>Stat Anal Data Min</source><year>2016</year>; <volume>9</volume><issue>4</issue>: <fpage>260</fpage>–<lpage>8</lpage>.<pub-id pub-id-type="pmid">28503249</pub-id></mixed-citation>
    </ref>
    <ref id="ooy059-B6">
      <label>6</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Duke</surname><given-names>JD</given-names></name>, <name name-style="western"><surname>Ryan</surname><given-names>PB</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name></person-group>,
<etal>et al</etal><article-title>Risk of angioedema associated with levetiracetam compared with phenytoin: findings of the observational health data sciences and informatics research network</article-title>. <source>Epilepsia</source><year>2017</year>; <volume>58</volume><issue>8</issue>: <fpage>e101</fpage>–<lpage>6</lpage>.<pub-id pub-id-type="pmid">28681416</pub-id></mixed-citation>
    </ref>
    <ref id="ooy059-B7">
      <label>7</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Garza</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Del Fiol</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Tenenbaum</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Walden</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Zozus</surname><given-names>MN.</given-names></name></person-group><article-title>Evaluating common data models for use with a longitudinal community registry</article-title>. <source>J Biomed Inform</source><year>2016</year>; <volume>64</volume>: <fpage>333</fpage>–<lpage>41</lpage>.<pub-id pub-id-type="pmid">27989817</pub-id></mixed-citation>
    </ref>
    <ref id="ooy059-B8">
      <label>8</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Rajkomar</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Oren</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Chen</surname><given-names>K</given-names></name></person-group>,
<etal>et al</etal><article-title>Scalable and accurate deep learning with electronic health records</article-title>. <source>NPJ Digit Med</source><year>2018</year>; <volume>1</volume><issue>1</issue>: <fpage>18</fpage>.<pub-id pub-id-type="pmid">31304302</pub-id></mixed-citation>
    </ref>
    <ref id="ooy059-B9">
      <label>9</label>
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Vashisht</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Jung</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Shah</surname><given-names>N.</given-names></name></person-group><article-title>Learning effective treatment pathways for type-2 diabetes from a clinical data warehouse</article-title>. <source>AMIA Annu Symp Proc</source><year>2016</year>; <volume>2016</volume>: <fpage>2036</fpage>–<lpage>42</lpage>.<pub-id pub-id-type="pmid">28269963</pub-id></mixed-citation>
    </ref>
    <ref id="ooy059-B10">
      <label>10</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Wickham</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Danenberg</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Eugster</surname><given-names>M.</given-names></name></person-group><italic>roxygen2: in-source documentation for R</italic><ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/package=roxygen2(version6.0.1)">https://cran.r-project.org/package=roxygen2 (version 6.0.1)</ext-link><year>2013</year>; 3(0).</mixed-citation>
    </ref>
    <ref id="ooy059-B11">
      <label>11</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Dowle</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Srinivasan</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Gorecki</surname><given-names>J</given-names></name></person-group>,
<etal>et al</etal><italic>Package ‘data.table’</italic><year>2018</year><ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/data.table/data.table.pdf(version1.11.8)">https://cran.r-project.org/web/packages/data.table/data.table.pdf (version 1.11.8)</ext-link></mixed-citation>
    </ref>
    <ref id="ooy059-B12">
      <label>12</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>James</surname><given-names>D.</given-names></name></person-group><italic>DBI: R database interface (2009)</italic>; <year>2012</year><ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/DBI/index.html(version1.0.0)">https://cran.r-project.org/web/packages/DBI/index.html (version 1.0.0)</ext-link>.</mixed-citation>
    </ref>
    <ref id="ooy059-B13">
      <label>13</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Wickham</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Francois</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Henry</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Müller</surname><given-names>K.</given-names></name></person-group><italic>dplyr: A Grammar of Data Manipulation. R package version 0.5.0.</italic> Vienna: R Core Development Team; <year>2016</year>
<ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/dplyr/dplyr.pdf(version0.7.8)">https://cran.r-project.org/web/packages/dplyr/dplyr.pdf (version 0.7.8)</ext-link></mixed-citation>
    </ref>
    <ref id="ooy059-B14">
      <label>14</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Hester</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Wickham</surname><given-names>H.</given-names></name></person-group> odbc: connect to ODBC compatible databases (using the DBI interface). CRAN; <year>2018</year>
<ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/odbc/odbc.pdf(version1.1.5)">https://cran.r-project.org/web/packages/odbc/odbc.pdf (version 1.1.5)</ext-link></mixed-citation>
    </ref>
    <ref id="ooy059-B15">
      <label>15</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Ooms</surname><given-names>J</given-names></name>, <name name-style="western"><surname>James</surname><given-names>D</given-names></name>, <name name-style="western"><surname>DebRoy</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Wickham</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Horner</surname><given-names>J.</given-names></name></person-group><italic>RMySQL: Database Interface and MySQL Driver for R.</italic><ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/RMySQL/index.html(version0.10.15)">https://cran.r-project.org/web/packages/RMySQL/index.html (version 0.10.15)</ext-link>; 3.</mixed-citation>
    </ref>
    <ref id="ooy059-B16">
      <label>16</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Scheumie</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>M.</given-names></name></person-group><italic>DatabaseConnector: Connecting to Various Database Platforms</italic><ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/DatabaseConnector/index.html(version2.2.0)">https://cran.r-project.org/web/packages/DatabaseConnector/index.html (version 2.2.0)</ext-link>. <year>2018</year>.</mixed-citation>
    </ref>
    <ref id="ooy059-B17">
      <label>17</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Scheumie</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>M.</given-names></name></person-group><italic>DatabaseConnectorJars: JAR Dependencies for the ‘DatabaseConnector’ Package</italic><ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/DatabaseConnectorJars/index.html(version1.0.0)">https://cran.r-project.org/web/packages/DatabaseConnectorJars/index.html (version 1.0.0)</ext-link>. <year>2018</year>.</mixed-citation>
    </ref>
    <ref id="ooy059-B18">
      <label>18</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Scheumie</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>M.</given-names></name></person-group><italic>SqlRender: Rendering Parameterized SQL and Translation to Dialects</italic><ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/SqlRender/index.html(version1.5.2)">https://cran.r-project.org/web/packages/SqlRender/index.html (version 1.5.2)</ext-link>. <year>2018</year>.</mixed-citation>
    </ref>
    <ref id="ooy059-B19">
      <label>19</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Wickham</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Chang</surname><given-names>W.</given-names></name></person-group><italic>devtools: Tools to Make Developing R Packages Easier</italic><ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/devtools/index.html(version1.13.6)">https://cran.r-project.org/web/packages/devtools/index.html (version 1.13.6)</ext-link>. <year>2016</year>.</mixed-citation>
    </ref>
    <ref id="ooy059-B20">
      <label>20</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Chang</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Cheng</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Allaire</surname><given-names>JJ</given-names></name>, <name name-style="western"><surname>Xie</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>McPherson</surname><given-names>J.</given-names></name></person-group><italic>Shiny: Web Application Framework for R.</italic><ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/packages/shiny/index.html(version1.1.0)">https://cran.r-project.org/web/packages/shiny/index.html (version 1.1.0)</ext-link>; 1 (4): 106.</mixed-citation>
    </ref>
    <ref id="ooy059-B21">
      <label>21</label>
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Schloerke</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Allaire</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Borges</surname><given-names>B.</given-names></name></person-group><italic>learnr: Interactive Tutorials for R.</italic><ext-link ext-link-type="uri" xlink:href="https://cran.rstudio.com/web/packages/learnr/index.html(version0.9.2.1)">https://cran.rstudio.com/web/packages/learnr/index.html (version 0.9.2.1)</ext-link><year>2018</year>.</mixed-citation>
    </ref>
  </ref-list>
</back>
