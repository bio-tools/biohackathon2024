<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Acta Crystallogr D Struct Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Acta Crystallogr D Struct Biol</journal-id>
    <journal-id journal-id-type="publisher-id">Acta Cryst. D</journal-id>
    <journal-title-group>
      <journal-title>Acta Crystallographica. Section D, Structural Biology</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2059-7983</issn>
    <publisher>
      <publisher-name>International Union of Crystallography</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5947772</article-id>
    <article-id pub-id-type="pmid">29533234</article-id>
    <article-id pub-id-type="publisher-id">di5011</article-id>
    <article-id pub-id-type="doi">10.1107/S2059798317017235</article-id>
    <article-id pub-id-type="coden">ACSDAD</article-id>
    <article-id pub-id-type="pii">S2059798317017235</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Papers</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title><italic>DIALS</italic>: implementation and evaluation of a new integration package</article-title>
      <alt-title>
        <italic>DIALS</italic>
      </alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Winter</surname>
          <given-names>Graeme</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="corresp" rid="cor">*</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0002-2134-182X</contrib-id>
        <name>
          <surname>Waterman</surname>
          <given-names>David G.</given-names>
        </name>
        <xref ref-type="aff" rid="c">c</xref>
        <xref ref-type="aff" rid="d">d</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Parkhurst</surname>
          <given-names>James M.</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="aff" rid="e">e</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Brewster</surname>
          <given-names>Aaron S.</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Gildea</surname>
          <given-names>Richard J.</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0002-4522-3326</contrib-id>
        <name>
          <surname>Gerstel</surname>
          <given-names>Markus</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fuentes-Montero</surname>
          <given-names>Luis</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Vollmar</surname>
          <given-names>Melanie</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Michels-Clark</surname>
          <given-names>Tara</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Young</surname>
          <given-names>Iris D.</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Sauter</surname>
          <given-names>Nicholas K.</given-names>
        </name>
        <xref ref-type="aff" rid="b">b</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid" authenticated="true">https://orcid.org/0000-0002-6079-2201</contrib-id>
        <name>
          <surname>Evans</surname>
          <given-names>Gwyndaf</given-names>
        </name>
        <xref ref-type="aff" rid="a">a</xref>
        <xref ref-type="corresp" rid="cor">*</xref>
      </contrib>
      <aff id="a"><label>a</label><institution>Diamond Light Source Ltd</institution>, Harwell Science and Innovation Campus, Didcot OX11 0DE, <country>England</country></aff>
      <aff id="b"><label>b</label><institution>Lawrence Berkeley National Laboratory</institution>, 1 Cyclotron Road, Berkeley, CA 94720, <country>USA</country></aff>
      <aff id="c"><label>c</label><institution>STFC Rutherford Appleton Laboratory</institution>, Didcot OX11 0FA, <country>England</country></aff>
      <aff id="d"><label>d</label>CCP4, <institution>Research Complex at Harwell</institution>, Rutherford Appleton Laboratory, Didcot OX11 0FA, <country>England</country></aff>
      <aff id="e"><label>e</label><institution>Laboratory of Molecular Biology</institution>, Francis Crick Avenue, Cambridge CB2 0QH, <country>England</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="cor">Correspondence e-mail: <email>graeme.winter@diamond.ac.uk</email>, <email>gwyndaf.evans@diamond.ac.uk</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <day>01</day>
      <month>2</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>01</day>
      <month>2</month>
      <year>2018</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>01</day>
      <month>2</month>
      <year>2018</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>74</volume>
    <issue>Pt 2</issue>
    <issue-id pub-id-type="publisher-id">d180200</issue-id>
    <fpage>85</fpage>
    <lpage>97</lpage>
    <history>
      <date date-type="received">
        <day>14</day>
        <month>6</month>
        <year>2017</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>11</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© Winter et al. 2018</copyright-statement>
      <copyright-year>2018</copyright-year>
      <license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0/uk/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution (CC-BY) Licence, which permits unrestricted
use, distribution, and reproduction in any medium, provided the original authors and source are cited.</license-p>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/">http://creativecommons.org/licenses/by/2.0/uk/</ali:license_ref>
      </license>
    </permissions>
    <self-uri xlink:href="https://doi.org/10.1107/S2059798317017235">A full version of this article is available from Crystallography Journals Online.</self-uri>
    <abstract abstract-type="toc">
      <p>A new X-ray diffraction data-analysis package is presented with a description of the algorithms and examples of its application to biological and chemical crystallography.</p>
    </abstract>
    <abstract>
      <p>The <italic>DIALS</italic> project is a collaboration between Diamond Light Source, Lawrence Berkeley National Laboratory and CCP4 to develop a new software suite for the analysis of crystallographic X-ray diffraction data, initially encompassing spot finding, indexing, refinement and integration. The design, core algorithms and structure of the software are introduced, alongside results from the analysis of data from biological and chemical crystallography experiments.</p>
    </abstract>
    <kwd-group>
      <kwd>X-ray diffraction</kwd>
      <kwd>data processing</kwd>
      <kwd>methods development</kwd>
      <kwd>
        <italic>DIALS</italic>
      </kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>Seventh Framework Programme, FP7 Research Infrastructures</funding-source>
        <award-id>283570</award-id>
      </award-group>
      <award-group>
        <funding-source>Wellcome Trust</funding-source>
        <award-id>202933/Z/16/Z</award-id>
      </award-group>
      <award-group>
        <funding-source>National Institutes of Health, National Institute of General Medical Sciences</funding-source>
        <award-id>GM095887</award-id>
        <award-id>GM117126</award-id>
      </award-group>
      <award-group>
        <funding-source>Science and Technology Facilities Council</funding-source>
      </award-group>
      <award-group>
        <funding-source>Diamond Light Source</funding-source>
      </award-group>
      <funding-statement>This work was funded by <funding-source>Seventh Framework Programme, FP7 Research Infrastructures</funding-source> grant <award-id>283570</award-id>. <funding-source>Wellcome Trust</funding-source> grant <award-id>202933/Z/16/Z</award-id>. <funding-source>National Institutes of Health, National Institute of General Medical Sciences</funding-source> grants <award-id>GM095887</award-id> and <award-id>GM117126</award-id>. <funding-source>Science and Technology Facilities Council</funding-source> grant . <funding-source>Diamond Light Source</funding-source> grant . </funding-statement>
    </funding-group>
    <conference>
      <conf-date/>
      <conf-name>From crystal to structure with CCP4 (Part 1)</conf-name>
      <conf-loc/>
    </conference>
    <counts>
      <page-count count="13"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="sec1">
    <label>1.</label>
    <title>Introduction   </title>
    <p>X-ray crystallography is the dominant method for the determination of the atomic structure of biological macromolecules. Macromolecular crystallography (MX) has evolved over decades into an essentially routine method for the majority of structures being investigated. Incremental improvements in detector technology, X-ray sources, beamline instrumentation (both in optics and endstation) and automation of sample handling have contributed to the success of the method. The overwhelming majority of diffraction data resulting in PDB depositions over the last 2–3 decades have been analysed using just four programs: <italic>XDS</italic> (Kabsch, 2010<italic>b</italic>
<xref ref-type="bibr" rid="bb29"> ▸</xref>), <italic>MOSFLM</italic> (Leslie, 2006<xref ref-type="bibr" rid="bb32"> ▸</xref>), <italic>HKL</italic>-2000/<italic>DENZO</italic> (Otwinowski &amp; Minor, 1997<xref ref-type="bibr" rid="bb36"> ▸</xref>) and <italic>d</italic>*<italic>TREK</italic> (Pflugrath, 1999<xref ref-type="bibr" rid="bb40"> ▸</xref>). For chemical crystallo­graphy, <italic>SAINT</italic> (Bruker AXS Inc., Madison, Wisconsin, USA) and <italic>EVAL</italic> (Duisenberg <italic>et al.</italic>, 2003<xref ref-type="bibr" rid="bb12"> ▸</xref>; Schreurs <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb47"> ▸</xref>) as well as <italic>d</italic>*<italic>TREK</italic> are in common use. Significant effort by a relatively small number of developers over this time has been critical to producing the diffraction-intensity data sets that are the raw material of structure determination.</p>
    <p>In more recent years there has been a step change in MX throughput, driven principally by the availability of new X-ray sources and data-collection methodologies (Emma <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb13"> ▸</xref>; Ishikawa <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb25"> ▸</xref>; White <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb57"> ▸</xref>; Gati <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb18"> ▸</xref>; Stellato <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb51"> ▸</xref>; Sierra <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb50"> ▸</xref>; Fuller <italic>et al.</italic>, 2017<xref ref-type="bibr" rid="bb17"> ▸</xref>), high-frame-rate pixel-array detectors (Henrich <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb22"> ▸</xref>), fast sample exchange (Russi <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb43"> ▸</xref>) and automated data analysis (Winter, 2010<xref ref-type="bibr" rid="bb60"> ▸</xref>; Winter &amp; McAuley, 2011<xref ref-type="bibr" rid="bb61"> ▸</xref>; Vonrhein <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb54"> ▸</xref>). This allows larger numbers of smaller samples to be used, with correspondingly more challenging data. New algorithms and approaches to data analysis are therefore required to address the novel approaches to the measurement of diffraction data sets. The initial focus of the development of <italic>DIALS</italic> (<italic>Diffraction Integration for Advanced Light Sources</italic>) has been on the processing of data from pixel-array detectors, although other technologies such as CCDs are also supported.</p>
    <p>To develop new algorithms, it is necessary to have the infrastructure of an existing software package to support them. A suitably extensible open-source package did not exist, and the <italic>DIALS</italic> project was initiated to provide this platform. The project aims to deliver (i) a framework for the implementation of novel algorithms for the analysis of X-ray diffraction data; (ii) a toolbox of algorithms within this framework; and (iii) a collection of user-friendly tools to present the structural biologist with an interface to the analysis of rotation data sets collected at synchrotron sources, as well as still-shot diffraction data collected at both synchrotron and X-ray free-electron laser sources.</p>
    <p><italic>DIALS</italic> is built upon the <italic>cctbx</italic> library (<italic>Computational Crystallography Toolbox</italic>; Grosse-Kunstleve <italic>et al.</italic>, 2002<xref ref-type="bibr" rid="bb21"> ▸</xref>) and benefits from a substantial foundation of crystallographic and mathematical code, a robust build mechanism and a development platform using hybrid Python/C++ (Abrahams &amp; Grosse-Kunstleve, 2003<xref ref-type="bibr" rid="bb1"> ▸</xref>).</p>
    <p>Finally, while the main focus of <italic>DIALS</italic> to date has been the analysis of MX data, the aforementioned developments in instrumentation also apply to chemical crystallography (CX). Since the analysis is mathematically identical, <italic>DIALS</italic> has also targeted data from this field, bringing a new set of challenges. This has the benefit of ensuring mathematical rigour and flexibility in the future, since assumptions which may be appropriate for MX may be challenged by CX and <italic>vice versa</italic>.</p>
  </sec>
  <sec id="sec2">
    <label>2.</label>
    <title>Design overview   </title>
    <p>The core aim of <italic>DIALS</italic> is to allow the development of a wide range of algorithms within a single framework. The workflow of <italic>DIALS</italic> was decomposed into a number of discrete tasks exchanging information <italic>via</italic> data files, in a similar manner to <italic>XDS</italic> and <italic>d</italic>*<italic>TREK</italic>. During the early stages of development, this allowed the implementation of standalone algorithms based on the results of other software such as <italic>MOSFLM</italic> (Leslie, 2006<xref ref-type="bibr" rid="bb32"> ▸</xref>) and <italic>XDS</italic> (Kabsch, 2010<italic>a</italic>
<xref ref-type="bibr" rid="bb28"> ▸</xref>). This decomposition also makes testing of the <italic>DIALS</italic> software more straightforward and facilitates its inclusion within automated data-analysis systems.</p>
    <p>The workflow of <italic>DIALS</italic>, as expressed in Fig. 1<xref ref-type="fig" rid="fig1"> ▸</xref>, emphasizes the abstract procedure for processing X-ray diffraction data and reflects the division of tasks as described previously (Bricogne, 1986<italic>b</italic>
<xref ref-type="bibr" rid="bb5"> ▸</xref>; Pflugrath, 1999<xref ref-type="bibr" rid="bb40"> ▸</xref>; Winter, 2010<xref ref-type="bibr" rid="bb60"> ▸</xref>). Beginning with the handling of the X-ray diffraction data in the Diffraction Experiment Toolbox <italic>dxtbx</italic> (Parkhurst <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb38"> ▸</xref>), abstract interfaces have been used at key points to ensure that future algorithms may be implemented within <italic>DIALS</italic> with minimum disruption.</p>
    <sec id="sec2.1">
      <label>2.1.</label>
      <title>Data handling   </title>
      <p>The <italic>dxtbx</italic> offers a general, user-extensible interface for the reading of X-ray diffraction data and provides abstract models in C++ and Python to describe the derived experimental geometry. For example, within the <italic>dxtbx</italic> the geometry of a detector is expressed as a collection of abstract planes, each of which has a per-pixel mapping from the position on the surface to the pixel coordinates in the image. This mapping may be used to correct for static effects such as module position or CCD taper corrections, or for dynamic effects such as parallax correction in direct-conversion detectors (described in more detail in <italic>Appendix A</italic>
<xref ref-type="app" rid="appa"/>). The interface exposed to the rest of the <italic>DIALS</italic> software is consistent, regardless of the underlying detector implementation, and has been used to treat data from new and complex detectors such as the CSPAD (Hart <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb63"> ▸</xref>) used for XFEL data collection at the Linac Coherent Light Source (Herrmann <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb23"> ▸</xref>; Brewster <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb3"> ▸</xref>), the DECTRIS PILATUS 12M used for long-wavelength data collection (Wagner <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb55"> ▸</xref>) at Diamond Light Source beamline I23, and HDF5-format (<ext-link ext-link-type="uri" xlink:href="https://www.hdfgroup.org/HDF5">https://www.hdfgroup.org/HDF5</ext-link>) DECTRIS EIGER data sets (Casanas <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb8"> ▸</xref>).</p>
    </sec>
    <sec id="sec2.2">
      <label>2.2.</label>
      <title>Data structures   </title>
      <p>The <italic>DIALS</italic> framework defines two major data structures for data persistence and transfer between algorithms and applications. The reflection table is a column-centric database of reflection properties with methods specialized for performing data-processing operations on a set of reflections. The experiment list encodes the experimental geometry and crystal properties. Each experiment has exactly one beam, detector and crystal model, with an optional goniometer and scan model; an experiment list is a collection of these. Models may be shared between experiments; for example, for data collected from multiple crystals, the beam, detector and goniometer models can be shared between all of the experiments, with the crystal and scan models differing for each. The relationships between different data collections can be used to provide additional information in, for example, joint refinement against multiple data sets whose sets of experimental models intersect. This has been detailed in Waterman <italic>et al.</italic> (2016<xref ref-type="bibr" rid="bb56"> ▸</xref>).</p>
      <p>In the command-line <italic>DIALS</italic> programs the input and output are defined as reflection tables and experiment lists, and in most cases the input and output are one of each, with additional parameters being passed as <monospace>keyword=value</monospace> pairs.</p>
    </sec>
  </sec>
  <sec id="sec3">
    <label>3.</label>
    <title>Implementation   </title>
    <p>The initial effort within the <italic>DIALS</italic> project has focused on delivering the key components of a complete integration package; namely, spot finding, indexing, refinement and integration, <italic>i.e.</italic> to take as input X-ray diffraction data from an area detector and output background-subtracted integrated intensities and associated error estimates. <italic>DIALS</italic> applications are implemented using the hybrid programming model of <italic>cctbx</italic>. Computationally demanding algorithms are implemented in C++, with Python wrappers to allow flexible high-level application development. This facilitates the construction of multiple user interfaces to the core algorithms of <italic>DIALS</italic>. For steps such as integration, where alternative algorithms are envisaged, a plugin system has been developed to allow run-time extension of the <italic>DIALS</italic> software, providing a convenient means for the development of new algorithms.</p>
    <sec id="sec3.1">
      <label>3.1.</label>
      <title>Algorithms: spot finding   </title>
      <p>The default spot-finding algorithm in <italic>DIALS</italic> performs a pixel thresholding process followed by the determination of connected regions (in two dimensions for still shots or three dimensions for rotation data) and size, centre of mass and total intensity estimation. The resulting spot list is then filtered based on user criteria, <italic>e.g.</italic> the minimum and maximum number of pixels in a spot.</p>
      <p>The default method for identifying strong pixels is based on the method used by <italic>XDS</italic>: the local mean, μ, and variance, σ<sup>2</sup>, are calculated for each pixel (over the region around the pixel defined by the kernel size) in each image and subsequently the local index of dispersion<disp-formula id="fd1"><graphic xlink:href="d-74-00085-efd1.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>For a detector with insignificant point-spread and gain <italic>G</italic>, a value of <italic>D</italic> ≃ <italic>G</italic> is expected for the background, with <italic>G</italic> being unity for a photon-counting detector. The appropriate gain for integrating detectors is normally set by the relevant <italic>dxtbx</italic> format class, but if required the value can be modified for spot finding. Strong pixels are then identified through three sequential thresholding operations. Firstly, pixels with a value less than a global threshold value (by default set to zero) are discarded. Next, a gain-dependent threshold is applied using the index of dispersion map to identify regions of the image that contain strong pixels. This operation essentially tests for regions of the image whose pixels are not drawn from a single Poisson distribution, <italic>i.e.</italic> not a local flat field. For Poisson-distributed data, the quantity <italic>D</italic>(<italic>N</italic> − 1) is approximately χ<sup>2</sup> distributed with <italic>N</italic> − 1 degrees of freedom, where <italic>N</italic> is the number of pixels in the region (Frome, 1982<xref ref-type="bibr" rid="bb16"> ▸</xref>). Therefore, the expected variance in <italic>D</italic>(<italic>N</italic> − 1) is 2(<italic>N</italic> − 1). Pixels are marked as potentially strong if the index of dispersion in a local region around the pixel is greater than a certain number of standard deviations, given by the parameter σ<sub><italic>b</italic></sub>, above the expected value,<disp-formula id="fd2"><graphic xlink:href="d-74-00085-efd2.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>Finally, pixels in these regions are selected as strong if their values <italic>c<sub>i</sub></italic> are greater than a certain number of standard deviations, given by the parameter σ<sub><italic>s</italic></sub> (assuming a Poisson distribution), above the local mean,<disp-formula id="fd3"><graphic xlink:href="d-74-00085-efd3.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>This method will find features on the image, for example Bragg reflections, powder rings and zingers.</p>
      <p>For photon-counting detectors the default settings for the global threshold (0) and gain (1) are usually appropriate. For other detectors where these defaults are not correct, appropriate values can be set in the <italic>dxtbx</italic> library as part of the detector model, or manually adjusted during spot finding. Determining appropriate parameters is easily accomplished interactively <italic>via</italic> the image viewer, as described in §<xref ref-type="sec" rid="sec5.1"/>5.1.</p>
      <p>With some integration packages the initial spot finding is often limited to a subset of the data for the initial characterization, <italic>i.e.</italic> indexing from a small number of images. Within <italic>DIALS</italic>, the decision was made to globally model the experiment. This decision has a significant effect on spot finding: the recommended usage (although this is not mandatory) is to find spots throughout the entire data set and perform subsequent indexing and refinement using this list of spots or a random subset. The spot list is also used to designate which reflections are used in the construction of reference profiles during integration.</p>
    </sec>
    <sec id="sec3.2">
      <label>3.2.</label>
      <title>Algorithms: indexing   </title>
      <p>Given a list of centroids from a spot-finding routine and a description of the experimental geometry, the primary goal of indexing is to identify a suitable combination of reciprocal-space basis vectors, represented by the <bold>UB</bold> matrix (Busing &amp; Levy, 1967<xref ref-type="bibr" rid="bb6"> ▸</xref>), that best explains the input list of spot centroids. This task is often complicated by the presence of outliers, either in the form of spuriously identified spot centroids or genuine diffraction spots that do not belong to the principal lattice (for example, ice or salt diffraction or the presence of one or more additional crystal lattices).</p>
      <p>Indexing may be algorithmically decomposed into several steps, which are common to most indexing packages, as follows. Given a description of the experimental geometry and a list of spot centroids as described above, the centroids are first mapped to reciprocal space to give a list of reciprocal-lattice positions. This list of positions is then analysed by one of several algorithms to determine a basis set. Once a suitable choice of basis vectors has been made, the resulting orientation matrix is used to assign Miller indices to reciprocal-lattice points, and refinement of the initial crystal parameters and experimental geometry is then performed (see §<xref ref-type="sec" rid="sec3.3"/>3.3).</p>
      <p>Analysis of the set of reciprocal-lattice positions to determine the basis may use a variety of algorithms. In <italic>XDS</italic> (Kabsch, 1988<italic>a</italic>
<xref ref-type="bibr" rid="bb26"> ▸</xref>) the set of short reciprocal-space difference vectors is calculated to build up a histogram of low-order multiples of lattice vectors, which is analysed to determine a unique basis. Other methods rely on the long-range periodicity of the reciprocal-lattice positions, analysed <italic>via</italic> the Fourier transform, to provide a route for simultaneously determining both the unit-cell and crystal-orientation parameters from a set of observed spot centroids. <italic>DIALS</italic> provides a choice of a one-dimensional (Steller <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb52"> ▸</xref>; Sauter <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb44"> ▸</xref>) or three-dimensional (Bricogne, 1986<italic>a</italic>
<xref ref-type="bibr" rid="bb4"> ▸</xref>; Otwinowski &amp; Minor, 1997<xref ref-type="bibr" rid="bb36"> ▸</xref>; Campbell, 1998<xref ref-type="bibr" rid="bb7"> ▸</xref>; Otwinowski <italic>et al.</italic>, 2012<xref ref-type="bibr" rid="bb37"> ▸</xref>) fast Fourier transform (FFT)-based algorithms, or a real-space grid-search method (Gildea <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb19"> ▸</xref>), although the latter requires prior knowledge of the unit-cell parameters.</p>
      <p>After successful identification and refinement of a single lattice, if a significant number of unindexed reflections remain then identification of further lattices may be attempted on the remaining unindexed reflections, as described by Gildea <italic>et al.</italic> (2014<xref ref-type="bibr" rid="bb19"> ▸</xref>).</p>
      <p>Unless otherwise specified, the above algorithms find the primitive minimum reduced unit cell (Grosse-Kunstleve <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb20"> ▸</xref>), making no attempt to derive the metric symmetry of the lattice at this point. Once refinement of the crystal parameters and experimental geometry in a triclinic cell has been completed, the Bravais lattice may be determined by applying appropriate constraints on the unit-cell parameters according to each compatible Bravais setting (Sauter <italic>et al.</italic>, 2006<xref ref-type="bibr" rid="bb45"> ▸</xref>) and repeating the refinement with these constraints. In addition, the symmetry observed in the intensity of the found spots may be assessed by computing the correlation coefficient in the spot intensity across the symmetry operations: if the minimum and maximum correlation coefficients are substantially different it may indicate that the lattice is pseudo-symmetric. While the analysis gives a suggestion of the ‘correct’ solution, the final decision is left to the user.</p>
      <p>If diffraction from a single crystal has been recorded on multiple sweeps (for example multiple orientations with a multi-axis goniometer) it is straightforward to index all sweeps simultaneously by passing the geometry and strong reflections from each. This was found to be particularly valuable for indexing data from chemical crystallography experiments, ensuring a consistent definition of <bold>UB</bold> for all data.</p>
    </sec>
    <sec id="sec3.3">
      <label>3.3.</label>
      <title>Algorithms: refinement   </title>
      <p>To date, the majority of packages for the integration of X-ray diffraction data have refined the model (unit cell, crystal orientation, detector distance and orientation, and beam direction) within small blocks during the integration process, just prior to integration of that block, to ensure that reflections in that block are well predicted. This process may take the form of positional refinement (Kabsch, 2010<italic>b</italic>
<xref ref-type="bibr" rid="bb29"> ▸</xref>) or post-refinement (Rossmann <italic>et al.</italic>, 1979<xref ref-type="bibr" rid="bb42"> ▸</xref>; Winkler <italic>et al.</italic>, 1979<xref ref-type="bibr" rid="bb58"> ▸</xref>; Leslie, 2006<xref ref-type="bibr" rid="bb32"> ▸</xref>). At the end of integration a further global refinement may be performed to give an accurate unit cell for downstream analysis. Within <italic>DIALS</italic> an alternative approach has been taken in which global refinement is performed prior to integration: this can refine a single static model for the sample (a single <bold>UB</bold> matrix representing the crystal unit cell and orientation) or a model that is allowed to vary smoothly throughout the scan. The latter allows systematic changes in orientation, for example owing to goniometer errors and radiation-induced unit-cell changes, whilst still using a global model. The emphasis on a global model stems from two key goals. The first is to determine the best model to fit the data set as a whole. This avoids instabilities, such as those inherent in refining unit-cell parameters for a low-symmetry crystal from a narrow wedge of data (especially cell axes aligned with the incident beam), and reduces correlations between parameters in refinement. The second goal is to allow maximum parallelism in the integration: as the entire experimental model is known <italic>a priori</italic>, in principle every reflection in the data set may then be integrated simultaneously.</p>
      <p>In common with other data-processing packages, refinement is performed by minimizing a least-squares target function. In <italic>DIALS</italic>, the residuals of this target function consist of the differences in position between the observed and predicted spot centroids in the <italic>x</italic> and <italic>y</italic> directions on the detector plane and the rotation angle φ. The squared residuals are weighted by the inverse of the estimated variances in centroid positions such that the resulting target function is dimensionless. As it is assumed that reliable profile information will be available only during the integration stage of data processing, no attempt at traditional post-refinement is made at this stage. Therefore, the refinement is limited to the central impacts (Duisenberg <italic>et al.</italic>, 2003<xref ref-type="bibr" rid="bb12"> ▸</xref>). Nevertheless, the constraint of either a static or a smoothly changing crystal model for the whole scan reduces correlations between crystal and detector parameters, resulting in more reliable refined unit-cell parameters (Waterman <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb56"> ▸</xref>). Refinement based solely on the spot centroids is a simple but effective way to improve the geometric model of the experiment, particularly when the data are fine-sliced (<italic>i.e.</italic> the image width is less than the mosaic spread; Pflugrath, 1999<xref ref-type="bibr" rid="bb40"> ▸</xref>). A comprehensive discussion of <italic>DIALS</italic> refinement is given by Waterman <italic>et al.</italic> (2016<xref ref-type="bibr" rid="bb56"> ▸</xref>).</p>
    </sec>
    <sec id="sec3.4">
      <label>3.4.</label>
      <title>Algorithms: integration   </title>
      <p>Integration within <italic>DIALS</italic> is separated into three steps. The first is the determination of the reflection profile, consisting of pixels that are part of the reflection peak (foreground) and those in the background. The second step estimates the background values <italic>under</italic> the peak. Finally, the peak intensity is evaluated <italic>via</italic> summation integration or profile fitting.</p>
      <sec id="sec3.4.1">
        <label>3.4.1.</label>
        <title>Profile parameters   </title>
        <p>The process of integrating the individual reflections within <italic>DIALS</italic> begins with the determination of profile model parameters, enabling the classification of pixels into foreground and background for each reflection. At the time of writing, a single model has been implemented based on the method described by Kabsch (2010<italic>a</italic>
<xref ref-type="bibr" rid="bb28"> ▸</xref>) that uses a three-dimensional Gaussian description of the reflection in a local reciprocal-space coordinate system defined by two parameters that determine the extent of the reflection on the face of the detector, σ<sub>D</sub>, and over a range of images, σ<sub>M</sub>. These parameters are estimated from the list of indexed strong spots identified previously during spot finding, as described in Kabsch (2010<italic>a</italic>
<xref ref-type="bibr" rid="bb28"> ▸</xref>).</p>
      </sec>
      <sec id="sec3.4.2">
        <label>3.4.2.</label>
        <title>Background estimation   </title>
        <p>Using the calculated model parameters, image pixel data are read into reflection ‘shoeboxes’ that contain the peak pixels and a substantial border of background pixels surrounding the peak. Before estimating the reflection intensity, the background in the peak region of the reflection needs to be modelled. This is accomplished by using information from nonpeak pixels in the local area of each spot. An important step in the background modelling is to ensure that the estimated background is not contaminated by outlier pixels such as zingers, unmodelled intensity from adjacent reflections, Bragg diffraction from ice, or reflections from a different lattice.</p>
        <p><italic>DIALS</italic> provides a range of outlier-handling methods which can be used with simple constant and linear background models and are particularly appropriate for CCD data where a pedestal has been subtracted. However, since these traditional methods assume that the pixel values are approximately normally distributed, the background estimates that they produce may be biased for low background levels with modern photon-counting detectors, where the counts are Poisson-distributed. Therefore, the default background-modelling algorithm in <italic>DIALS</italic> uses a robust generalized linear model approach, which explicitly assumes that the pixel values are Poisson-distributed. This method is appropriate across the full range of observed background levels, has been shown to be effective even when the average background is below one count per pixel (Parkhurst <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb39"> ▸</xref>), and is particularly suitable for photon-counting detectors.</p>
      </sec>
      <sec id="sec3.4.3">
        <label>3.4.3.</label>
        <title>Intensity evaluation   </title>
        <p>Given an estimate for the background under the peak, the simplest integration algorithm is direct summation, where the integrated intensity is obtained as the sum of all background-subtracted pixel values in the peak region. <italic>DIALS</italic> can output the summation intensities of each reflection as either individual partial reflection intensities or as a single value summed across all of the frames on which the reflection is recorded. Error estimates are derived from Poisson statistics as described by Leslie (1999<xref ref-type="bibr" rid="bb31"> ▸</xref>).</p>
        <p>For weak data, fitting the pixel intensities against an empirical reflection profile has been shown to give better estimates of weak reflection intensities than summation integration (Diamond, 1969<xref ref-type="bibr" rid="bb10"> ▸</xref>). In <italic>DIALS</italic>, profile fitting is performed as described by Kabsch (2010<italic>a</italic>
<xref ref-type="bibr" rid="bb28"> ▸</xref>). The image/rotation-space shoebox for each reflection is first transformed into its local reciprocal-space coordinate system, in which the reflection profiles take on a more uniform appearance, allowing their shapes to be modelled more effectively (Kabsch, 1988<italic>b</italic>
<xref ref-type="bibr" rid="bb27"> ▸</xref>). In contrast to <italic>XDS</italic>, the reflection data are transformed onto the reciprocal-space grid by computing the overlap of each detector pixel with the transformed grid point using a polygon-clipping algorithm (Sutherland &amp; Hodgman, 1974<xref ref-type="bibr" rid="bb53"> ▸</xref>). The fractional overlap is then used to determine the number of counts in each pixel that is distributed to each grid point in the transformed grid.</p>
        <p>In order to aid parallel execution, blocks of images are integrated independently. The blocks of images are overlapped so that the start of a block is aligned with the centre of the preceding block. This ensures that the majority of reflections are fully recorded within a single block, with a better profile-fitting intensity estimate than reflections split at block boundaries and reassembled after integration. Reference profiles are created from the strong spots at several points across the detector surface for each block of images being integrated. Each strong reflection contributes to its nearest reference profiles using a Gaussian weight derived from its distance to the reference profile, such that reflections halfway between two reference profiles contribute half of their intensity to each reference profile. Once the reference profiles have been created, the intensity is calculated by fitting the transformed profile of each reflection to the nearest reference profile. The profile-fitted intensity and error are calculated as described by Kabsch (2010<italic>a</italic>
<xref ref-type="bibr" rid="bb28"> ▸</xref>).</p>
      </sec>
    </sec>
    <sec id="sec3.5">
      <label>3.5.</label>
      <title>Algorithms: data correction   </title>
      <p>The intensities measured on the X-ray diffraction images are modulated by a range of variable effects including the incident beam intensity, the illuminated volume and the absorption within the sample. The intensities of measured reflections are also affected by known, sample-independent factors, including beam polarization, the velocity of the reciprocal-lattice point through the reflecting position (Lorentz correction) and the detector sensitivity.</p>
      <p>The variable effects are normally corrected by scaling procedures such as those implemented in <italic>AIMLESS</italic> (Evans &amp; Murshudov, 2013<xref ref-type="bibr" rid="bb15"> ▸</xref>) and <italic>XDS</italic> (Kabsch, 1988<italic>b</italic>
<xref ref-type="bibr" rid="bb27"> ▸</xref>). The known effects may be corrected for in scaling, as in <italic>XDS</italic>, or could be corrected after integration but prior to scaling, as in <italic>MOSFLM</italic> and <italic>AIMLESS</italic>. The Lorentz and polarization corrections are well defined and have been described in detail elsewhere (Kabsch, 1988<italic>b</italic>
<xref ref-type="bibr" rid="bb27"> ▸</xref>). Correction for detector-sensitivity variation is an instrument-specific procedure, the details of which vary for different detector types. For pixel-array detectors (Henrich <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb22"> ▸</xref>), one relevant factor is the probability of recording an individual scattered photon. In particular, the sensor has a fixed thickness of, for example, crystalline silicon (typically between 320 µm and 1 mm), giving rise to a specific probability of a photon being absorbed by the sensor, dependent on the wavelength of the photon and the incident angle,<disp-formula id="fd4"><graphic xlink:href="d-74-00085-efd4.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>where θ is the angle between the incoming ray and the detector normal, λ is the wavelength of the photon, μ(λ) is the corresponding attenuation coefficient and <italic>t</italic> is the thickness of the sensor (Hülsen <italic>et al.</italic>, 2005<xref ref-type="bibr" rid="bb24"> ▸</xref>). The intensities should be corrected by a factor of 1/<italic>p</italic> (the oblique incidence correction). For the wavelengths routinely used in MX this correction is modest, typically in the range 1.1–1.25. For the higher energies typically used in CX it may be more substantial (2.0–2.5), as the interaction cross-sections between the photons and the Si atoms are much smaller. The effects are particularly profound when more complex experimental geometries are used, since the correction may not vary uniformly with resolution if the detector is not perpendicular to the beam.</p>
    </sec>
    <sec id="sec3.6">
      <label>3.6.</label>
      <title>Algorithms: post-integration unit-cell refinement   </title>
      <p>The goal of the refinement described earlier (§<xref ref-type="sec" rid="sec3.3"/>3.3) is the accurate prediction of the X-ray diffraction pattern; for downstream analysis, however, a reliable best estimate of the unit cell is critical. After integration, the 2θ angles for individual reflections are very well known and may be used to re-refine the unit-cell parameters directly and also to provide error estimates on the unit-cell parameters. A separate tool is provided for this unit-cell refinement, which shares its underlying framework and models with the general refinement.</p>
    </sec>
  </sec>
  <sec id="sec4">
    <label>4.</label>
    <title>Examples   </title>
    <p>The most relevant criteria for judging the integration of X-ray diffraction data are structure solution and refinement using the reduced intensities. Two protein examples follow to illustrate this: (i) structure solution of the leucine-rich repeat protein from <italic>Leptospira interrogans</italic>
<italic>via</italic> SAD phasing using a standard SAD strategy for data collection and (ii) a molecular-replacement example (thermolysin) using very weak and high-multiplicity data. A third example, of structure solution and refinement of a small-molecule structure, is also shown.</p>
    <sec id="sec4.1">
      <label>4.1.</label>
      <title>SAD phasing of leucine-rich repeat protein   </title>
      <sec id="sec4.1.1">
        <label>4.1.1.</label>
        <title>Sample description and data collection   </title>
        <p>Crystals of the leucine-rich repeat (LRR) protein from <italic>L. interrogans</italic> containing residues 30–377 were kindly provided by Ahmed Haouz (Institut Pasteur) and William Shepard (Synchrotron SOLEIL). Details of the crystal preparation have been published elsewhere (Miras <italic>et al.</italic>, 2015<xref ref-type="bibr" rid="bb35"> ▸</xref>).</p>
        <p>Data collection from crystals of LRR was carried out on beamline I04 at Diamond Light Source, UK using 1% transmission and an exposure time of 0.04 s per image. A total of 1027 images, comprising a 154° scan, with a rotation per image of 0.15°, were measured using an X-ray wavelength of 1.2 Å, which is just shorter than the Zn <italic>K</italic> absorption edge. The data are available at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.1048928">https://doi.org/10.5281/zenodo.1048928</ext-link>.</p>
      </sec>
      <sec id="sec4.1.2">
        <label>4.1.2.</label>
        <title>Data processing   </title>
        <p>The data were processed with <italic>xia</italic>2 (Winter, 2010<xref ref-type="bibr" rid="bb60"> ▸</xref>) using <italic>DIALS</italic> for indexing, refinement and integration using <italic>POINTLESS</italic> (Evans, 2006<xref ref-type="bibr" rid="bb14"> ▸</xref>) and <italic>AIMLESS</italic> (Evans &amp; Murshudov, 2013<xref ref-type="bibr" rid="bb15"> ▸</xref>) for scaling. Anomalous pairs were separated in scaling and merging, with the resolution limit estimated automatically by <italic>xia</italic>2 as 1.45 Å (based on CC<sub>1/2</sub> &gt; 0.5 after the first cycle of scaling); the overall merging statistics are shown in Table 1<xref ref-type="table" rid="table1"> ▸</xref>. While the <italic>R</italic>
<sub>meas</sub> value in the outer shell may appear excessive (in excess of 100%), the half sets of data are still significantly correlated, with CC<sub>1/2</sub> = 0.669 (Karplus &amp; Diederichs, 2012<xref ref-type="bibr" rid="bb30"> ▸</xref>), and thus contribute usefully to the data set.</p>
      </sec>
      <sec id="sec4.1.3">
        <label>4.1.3.</label>
        <title>Phasing   </title>
        <p>Structure solution was carried out using the anomalous signal from native Zn<sup>2+</sup> ions, estimated to have d<italic>I</italic>/σ(d<italic>I</italic>) ≃ 1.29, with the <italic>SHELXC</italic>/<italic>D</italic>/<italic>E</italic> pipeline (Sheldrick, 2010<xref ref-type="bibr" rid="bb48"> ▸</xref>). The resolution cutoff for substructure determination was 2.5 Å. <italic>SHELXD</italic> found eight heavy-atom sites with occupancy greater than 25%, with CC<sub>all</sub> of 40.38% and CC<sub>weak</sub> of 21.39%. <italic>SHELXE</italic> was able to trace the backbone of the protein successfully in the original hand, with a CC of 44.73% (<italic>versus</italic> 8.83% for the inverse), clearly identifying the true solution. Density-modified phases were used for automated model building with <italic>Buccaneer</italic> (Cowtan, 2006<xref ref-type="bibr" rid="bb9"> ▸</xref>) and a single molecule per asymmetric unit was built, resulting in an initial <italic>R</italic>
<sub>work</sub> of 26.36% and <italic>R</italic>
<sub>free</sub> of 28.37% before further refinement.</p>
      </sec>
      <sec id="sec4.1.4">
        <label>4.1.4.</label>
        <title>Refinement and model completion   </title>
        <p>Statistics for the refinement are shown in Table 1<xref ref-type="table" rid="table1"> ▸</xref>. All residues from the expression construct were built, as well as several ligands from the crystallization condition and 402 water molecules. Statistics of the final refinement run are presented in Fig. 2<xref ref-type="fig" rid="fig2"> ▸</xref>, with the figure of merit (FOM), the correlation coefficient of the difference map (CC<italic>F</italic>
<sub>o</sub>
<italic>F</italic>
<sub>c</sub>), <italic>R</italic>
<sub>work</sub> and <italic>R</italic>
<sub>free</sub> plotted against resolution.</p>
      </sec>
    </sec>
    <sec id="sec4.2">
      <label>4.2.</label>
      <title>Molecular replacement of thermolysin with weak data   </title>
      <sec id="sec4.2.1">
        <label>4.2.1.</label>
        <title>Sample description and data collection   </title>
        <p>Crystals of thermolysin were produced from commercially sourced thermolysin from <italic>Bacillus thermoproteolyticus</italic> (Calbiochem). The protein was dissolved in 100 m<italic>M</italic> MES pH 6.0, 45%(<italic>v</italic>/<italic>v</italic>) DMSO to a final concentration of 100 mg ml<sup>−1</sup> by gently shaking the mixture at room temperature for 1 h. To remove aggregates and other particles, the mixture was centrifuged for 10 min at 15 000<italic>g</italic> and 4°C. Equal amounts of protein solution and a well solution consisting of 50 m<italic>M</italic> MES pH 6.0, 1 <italic>M</italic> sodium chloride and 45%(<italic>v</italic>/<italic>v</italic>) DMSO were mixed as a sitting drop and equilibrated over a reservoir solution consisting of 35%(<italic>v</italic>/<italic>v</italic>) saturated ammonium sulfate at a temperature of 20°C. Crystals with space group <italic>P</italic>6<sub>1</sub>22 and unit-cell parameters <italic>a</italic> = <italic>b</italic> = 92.35, <italic>c</italic> = 127.71 Å formed within a few days.</p>
        <p>Data were collected on beamline I03 at Diamond Light Source following a low-dose, high-multiplicity strategy: 0.05% X-ray beam transmission and 0.1 s per 0.1°, generating a total of 7200 images, <italic>i.e.</italic> two full rotations, using an X-ray wavelength of 1.2 Å. This resulted in data with around 200 000 total counts per image, or an average number of counts per pixel of 0.03. The data are available at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.49559">https://doi.org/10.5281/zenodo.49559</ext-link>.</p>
      </sec>
      <sec id="sec4.2.2">
        <label>4.2.2.</label>
        <title>Data processing   </title>
        <p>Data were processed with <italic>xia</italic>2 as for the previous example in §<xref ref-type="sec" rid="sec4.1.2"/>4.1.2, although a resolution limit of 1.5 Å was explicitly set to test the behaviour of the software in the asymptotic limit, <italic>i.e.</italic> where 〈<italic>I</italic>/σ(<italic>I</italic>)〉 tends to 0. Statistics are reported in Table 1<xref ref-type="table" rid="table1"> ▸</xref>. The data have an overall 〈<italic>I</italic>/σ(<italic>I</italic>)〉 of 13.3, whereas in the high-resolution shell it drops to near 0. The <italic>R</italic>
<sub>meas</sub> values of 22.6% for the data overall and 26.20% in the outer shell reflect the very low photon counts; however, the data half sets (<italic>i.e.</italic> CC<sub>1/2</sub>) are still significantly correlated (25.8%) in the outer shell as the overall multiplicity of the data exceeds 70.</p>
      </sec>
      <sec id="sec4.2.3">
        <label>4.2.3.</label>
        <title>Phasing   </title>
        <p>Phases were determined by molecular replacement with <italic>Phaser</italic> (McCoy <italic>et al.</italic>, 2007<xref ref-type="bibr" rid="bb34"> ▸</xref>) using PDB entry <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=2tlx">2tlx</ext-link> (English <italic>et al.</italic>, 1999<xref ref-type="bibr" rid="bb70"> ▸</xref>) as the search model with all water molecules and ligands removed. The phasing was straightforward, with a TFZ score of &gt;8, an LLG of &gt;160, a refined LLG of 8684 and one molecule in the asymmetric unit.</p>
      </sec>
      <sec id="sec4.2.4">
        <label>4.2.4.</label>
        <title>Refinement   </title>
        <p>For refinement a free set of 2500 reflections (5% of the total) was used. Final <italic>R</italic>-value statistics of <italic>R</italic>
<sub>work</sub> = 15.7% and <italic>R</italic>
<sub>free</sub> = 20.5% were obtained, with the values for the highest resolution shell being 35.2% and 36.8%, respectively. 302 water molecules and additional ligands from the crystallization condition, as well as a short peptide in the active site, were built.</p>
      </sec>
      <sec id="sec4.2.5">
        <label>4.2.5.</label>
        <title>Paired refinement   </title>
        <p>Following the protocol of Karplus &amp; Diederichs (2012<xref ref-type="bibr" rid="bb30"> ▸</xref>), the thermolysin structure was refined with data from 1.8 to 1.5 Å resolution in steps of 0.01 Å, <italic>i.e.</italic> 31 refinement runs. The atomic positions were first perturbed by an average of 0.25 Å with <italic>phenix.pdbtools</italic> (Adams <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb2"> ▸</xref>), after which the refinement was performed with data to the defined resolution limit. <italic>R</italic>
<sub>work</sub> and <italic>R</italic>
<sub>free</sub> were then computed using data to 1.8 Å resolution.</p>
        <p>Perturbation of the atoms was sufficient to increase the <italic>R</italic> factor from around 14 to 18% overall for the 1.6 Å resolution data, after which the residuals settled to their previous values. As may be seen in Fig. 3<xref ref-type="fig" rid="fig3"> ▸</xref>, there is a measurable improvement in the gap between <italic>R</italic> and <italic>R</italic>
<sub>free</sub> calculated to 1.8 Å resolution using data to around 1.56 Å resolution. Beyond this point (<italic>i.e.</italic> from 1.50 to 1.56 Å) both the <italic>R</italic>
<sub>work</sub> and <italic>R</italic>
<sub>free</sub> to 1.8 Å resolution do not change substantially, suggesting that this is the true resolution limit of the data. It is, however, helpful to note that the additional measurements beyond this limit did no apparent harm to the structure refinement.</p>
      </sec>
    </sec>
    <sec id="sec4.3">
      <label>4.3.</label>
      <title>Chemical crystallography   </title>
      <p>Whilst MX is the dominant application of crystallography at third-generation synchrotron sources, Diamond Light Source has a dedicated facility for chemical crystallography at beamline I19. Mathematically, the analysis process is identical to MX; however, there are a few practical differences. Firstly, the geometry of the experiment tends to be more complex, with 2θ offsets routinely applied to the detector and multi-axis goniometers in use for the majority of experiments. Secondly, the volume of the unit cell is typically smaller, resulting in fewer observed reflections despite diffraction to higher resolution. To address these challenges in <italic>xia</italic>2 the default behaviour for small-molecule data is to simultaneously index reflection data from all sweeps, relying on the accurate mapping to reciprocal space shown in Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>(<italic>d</italic>). Finally, the normal operating energy of the beamline is around 19 keV, compared with MX beamlines which typically operate around 8–13 keV. This last factor substantially affects the operating efficiency of the PILATUS 2M, as the probability of recording a photon at 19 keV with a 320 µm thick sensor can be as low as 36%.</p>
      <p>The data set used as an example here was collected from <sc>l</sc>-cysteine, and the data are available online at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.51405">https://doi.org/10.5281/zenodo.51405</ext-link>. The data consist of four sweeps: a 180° φ scan at 2θ = 0° followed by three 170° ω scans at φ = 0, 120 and 240°, with 2θ = 30° on a fixed-χ (χ = 57.74°) goniometer. The data processed with <italic>xia</italic>2 gave the merging statistics in Table 2<xref ref-type="table" rid="table2"> ▸</xref>. Structure solution with <italic>SHELXT</italic> (Sheldrick, 2015<xref ref-type="bibr" rid="bb49"> ▸</xref>) was straightforward and refinement with <italic>OLEX</italic>2 (Dolomanov <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb11"> ▸</xref>) gave a final <italic>R</italic>
<sub>1</sub> of 3.04% (details are given in Table 2<xref ref-type="table" rid="table2"> ▸</xref>).</p>
      <p>A particular concern for chemical crystallography is the greater dynamic range in intensities, particularly for centric space groups that give rise to more extreme intensity distributions. The use of photon-counting detectors, however, means that good results have been achieved with data recorded in a single sweep, where the reflection intensities span 3–4 orders of magnitude. Since <italic>DIALS</italic> uses both summation and profile-fitting integration methods, the option in <italic>AIMLESS</italic> to use an intensity-weighted combination of these was used, such that the stronger reflections are dominated by summation-integrated values and the weaker reflections by the results of profile fitting.</p>
    </sec>
  </sec>
  <sec id="sec5">
    <label>5.</label>
    <title>Diagnostic tools   </title>
    <p>While the main focus of <italic>DIALS</italic> is the implementation of new software the integration of X-ray diffraction data, diagnostic tools have also been developed, which help the user to understand the behaviour of the <italic>DIALS</italic> algorithms in more detail. In addition, at each stage of the analysis presented previously, reports are available to assess the quality of the results.</p>
    <sec id="sec5.1">
      <label>5.1.</label>
      <title>Image viewer   </title>
      <p><italic>DIALS</italic> provides an image viewer based on previous work (Sauter <italic>et al.</italic>, 2013<xref ref-type="bibr" rid="bb46"> ▸</xref>) that can be used to inspect diffraction images and diagnose issues with data processing. The viewer can also display the location of reflections from spot finding or integration, including the shoebox regions, and has the option to sum a number of consecutive images together for display; this can be especially useful for viewing weak, sparse or fine-sliced data in order to provide an interpretable diffraction pattern. <italic>Appendix B</italic>
<xref ref-type="app" rid="appb"/> includes example usage of the <italic>DIALS</italic> image viewer command line and other diagnostic tools described below.</p>
      <p>Additionally, the image viewer can be used to optimize the parameters affecting spot finding: the effect of changing the spot-finding parameters can be observed by displaying the threshold view of the image. This may be useful when commissioning a new type of detector or experiment.</p>
    </sec>
    <sec id="sec5.2">
      <label>5.2.</label>
      <title>Reciprocal lattice viewer   </title>
      <p>In many cases the failure point in processing a diffraction data set is in indexing. While the algorithms used in <italic>DIALS</italic> (Steller <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb52"> ▸</xref>; Sauter <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb44"> ▸</xref>; Bricogne, 1986<italic>a</italic>
<xref ref-type="bibr" rid="bb4"> ▸</xref>; Gildea <italic>et al.</italic>, 2014<xref ref-type="bibr" rid="bb19"> ▸</xref>) are generally robust, if they fail to index the reflections the program may offer little insight into the underlying cause, for example an incorrect description of the experimental geometry. In some cases, overlaying the found spot positions over the images may provide an indication of the cause of indexing failure, but a particularly powerful diagnostic tool is to view their positions in reciprocal space using the <italic>DIALS</italic> reciprocal lattice viewer. In common with other tools such as <italic>RLATT</italic> (Bruker AXS Inc., Madison, Wisconsin, USA) and <italic>EwaldPro</italic> (Rigaku Oxford Diffraction, Oxford, England), the ability to visualize the results of spot finding in reciprocal space allows the immediate diagnosis of many indexing problems. Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref> demonstrates some of the most common phenomena that are observed. In case of incorrectly defined geometry the parameters may be adjusted within the GUI, allowing common causes of failure to be easily corrected. This is valuable when commissioning a new beamline, where an accurate description of the geometry may not be available.</p>
    </sec>
    <sec id="sec5.3">
      <label>5.3.</label>
      <title>Crystal health   </title>
      <p>Prior to the arrival of pixel-array detectors it was possible to inspect every image as it was collected. When data sets consist of many thousands of finely sliced images recorded at a rate greater than ten per second, manual inspection becomes impractical, leading to a loss of insight into the evolution of the sample, and issues such as radiation damage or sample misalignment may be overlooked. Within <italic>DIALS</italic>, spot-finding results can be used to overcome this loss of insight through a summary of the number of spots found on every image: if there is no substantial radiation damage and the diffraction is approximately isotropic this may be expected to be approximately constant, as shown in Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref>(<italic>a</italic>), or to vary sinusoidally with a period of 180°. If a crystal has suffered severe radiation damage (Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref>
<italic>b</italic>) then the number of spots will typically decrease systematically, while sample-centring issues (Fig. 5<xref ref-type="fig" rid="fig5"> ▸</xref>
<italic>c</italic>) may result in clearly visible ‘blank’ regions. In many cases, ‘problem’ data sets may be identified at this stage prior to any thorough analysis of the data. This is used at Diamond Light Source to provide rapid feedback to users (Winter &amp; McAuley, 2011<xref ref-type="bibr" rid="bb61"> ▸</xref>).</p>
    </sec>
    <sec id="sec5.4">
      <label>5.4.</label>
      <title><italic>DIALS</italic> report   </title>
      <p>The output of each analysis step is typically a list of reflections and a description of the current state of the experimental model. The <italic>dials.report</italic> tool takes the information contained in these files and generates HTML reports containing critical diagnostic results such as histograms of the deviation between observed and predicted reflections (Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>
<italic>a</italic>) and correlations between the model and observed reflection profiles (Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>
<italic>b</italic>).</p>
    </sec>
  </sec>
  <sec id="sec6">
    <label>6.</label>
    <title>Conclusions   </title>
    <p>The <italic>DIALS</italic> project, comprising the framework and some key algorithms, is presented together with results of its application to good-quality data measured at Diamond Light Source. The <italic>DIALS</italic> project set out to develop (i) a framework for the implementation of novel algorithms for data integration, (ii) a toolbox of algorithms and (iii) user-facing tools for the processing of X-ray diffraction data. As illustrated here, these goals have been met and <italic>DIALS</italic> has now been released. In writing the <italic>DIALS</italic> software, the authors have aimed to provide the community with an open-source platform for further algorithm development as well as a suite of tools to enable data processing. To date (17 September 2017) the software has been cited in 92 PDB depositions.</p>
    <p><italic>DIALS</italic> has already been used to process data at X-ray free-electron laser sources (Brewster <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb3"> ▸</xref>; Lyubimov <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb33"> ▸</xref>; Young <italic>et al.</italic>, 2016<xref ref-type="bibr" rid="bb62"> ▸</xref>). Future developments in <italic>DIALS</italic> will include its extension for use with other sources and methods, including electron diffraction.</p>
    <p><italic>DIALS</italic> is available for download from <ext-link ext-link-type="uri" xlink:href="https://dials.github.io">https://dials.github.io</ext-link> and is distributed with the <italic>CCP</italic>4 (Winn <italic>et al.</italic>, 2011<xref ref-type="bibr" rid="bb59"> ▸</xref>) and <italic>PHENIX</italic> (Adams <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb2"> ▸</xref>) software packages.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data">
      <p>Data from crystal of Leucine-Rich Repeat Protein from Leptospira interrogans recorded during routine commissioning on Diamond Light Source beamline I04 URL: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.1048928">https://doi.org/10.5281/zenodo.1048928</ext-link>
</p>
    </supplementary-material>
    <supplementary-material content-type="local-data">
      <p>Low dose, high multiplicity thermolysin X-ray diffraction data from Diamond Light Source beamline I03 URL: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.49559">https://doi.org/10.5281/zenodo.49559</ext-link>
</p>
    </supplementary-material>
    <supplementary-material content-type="local-data">
      <p>L Cysteine Data collected 05/03/2016 at Diamond Light Source I19-1 URL: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.51405">https://doi.org/10.5281/zenodo.51405</ext-link>
</p>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>The authors would like to thank Nathaniel Echols for help in implementing the <italic>DIALS</italic> build system. The authors would like to thank Katherine McAuley for the in-house time on Diamond beamline I03 used to record the thermolysin data and Dave Hall for in-house time for LRR on I04. The authors would also like to thank Andrew Leslie, Phil Evans, Garib Murshudov and Gleb Bourenkov for their formative input to the project. The authors would also like to thank the reviewers for their extensive and helpful comments on the manuscript.</p>
  </ack>
  <app-group>
    <app id="appa">
      <label>Appendix A </label>
      <title>Parallax correction</title>
      <p>The physics of direct-conversion pixel-array detectors, particularly those with a silicon sensor, gives rise to a small distortion of the diffraction image: the diffraction spots are elongated owing to the passage of the photons through the sensor. This gives rise to a predictable effect on the central impact (Duisenberg <italic>et al.</italic>, 2003<xref ref-type="bibr" rid="bb12"> ▸</xref>) of the reflection, which may be corrected by the ‘pixel-to-millimetres’ mapping.</p>
      <p>The absorption of photons in a material is given by the Beer–Lambert law. Specifically, the fraction of photons transmitted a distance <italic>x</italic> into a material with linear attenuation coefficient μ is given by<disp-formula id="fd5"><graphic xlink:href="d-74-00085-efd5.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
</p>
      <p>From this, it can be shown that for a sample of thickness <italic>t</italic>, the attenuation length <italic>L</italic>
<sub>a</sub>, the distance into the sample at which the mean absorption occurs, is<disp-formula id="fd6"><graphic xlink:href="d-74-00085-efd6.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
</p>
      <p>For a diffracted beam vector <bold>s</bold>
<sub>1</sub> striking a detector with normal vector <inline-formula><inline-graphic xlink:href="d-74-00085-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> and thickness <italic>t</italic>
<sub>0</sub>, the effective distance <italic>t</italic> = <italic>t</italic>
<sub>0</sub>/(<bold>s</bold>
<sub>1</sub> · <inline-formula><inline-graphic xlink:href="d-74-00085-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>). Therefore,<disp-formula id="fd7"><graphic xlink:href="d-74-00085-efd7.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
</p>
      <p>The offset for a predicted ray impinging on the detector with fast axis <bold>e</bold>
<italic><sub>x</sub></italic> and slow axis <bold>e</bold>
<italic><sub>y</sub></italic> is then<disp-formula id="fd8"><graphic xlink:href="d-74-00085-efd8.jpg" mimetype="image" mime-subtype="gif" position="float" orientation="portrait"/></disp-formula>
</p>
    </app>
    <app id="appb">
      <label>Appendix B </label>
      <title>Command lines</title>
      <p>The <italic>DIALS</italic> distribution includes a number of tools which were first implemented for debugging but were later found to be more generally useful: examples of the output of these have been included in the main text. In general, the tools take an experiment model file and optionally a spot list.</p>
      <p>
        <chem-struct id="scheme1">
          <graphic xlink:href="d-74-00085-scheme1.jpg" position="float" orientation="portrait"/>
        </chem-struct>
      </p>
      <p>View diffraction images optionally with overlay of strong spot positions, optionally summing images for viewing very finely sliced data.</p>
      <p>
        <chem-struct id="scheme2">
          <graphic xlink:href="d-74-00085-scheme2.jpg" position="float" orientation="portrait"/>
        </chem-struct>
      </p>
      <p>View a projection of the reciprocal lattice either from ‘raw’ diffraction centroids or indexed reflections (Fig. 4<xref ref-type="fig" rid="fig4"> ▸</xref>). Both the experimental geometry and reflection data are needed.</p>
      <p>
        <chem-struct id="scheme3">
          <graphic xlink:href="d-74-00085-scheme3.jpg" position="float" orientation="portrait"/>
        </chem-struct>
      </p>
      <p>Generate a report from the <italic>DIALS</italic> analysis, the contents of which will depend on the stage in the analysis. This generates an HTML report <monospace>dials-report.html</monospace> (Fig. 6<xref ref-type="fig" rid="fig6"> ▸</xref>).</p>
    </app>
  </app-group>
  <ref-list>
    <title>References</title>
    <ref id="bb1">
      <mixed-citation publication-type="other">Abrahams, D. &amp; Grosse-Kunstleve, R. W. (2003). <italic>C/C++ Users J.</italic>
<bold>21</bold>, 29–36.</mixed-citation>
    </ref>
    <ref id="bb2">
      <mixed-citation publication-type="other">Adams, P. D. <italic>et al.</italic> (2010). <italic>Acta Cryst.</italic> D<bold>66</bold>, 213–221.</mixed-citation>
    </ref>
    <ref id="bb3">
      <mixed-citation publication-type="other">Brewster, A. S., Waterman, D. G., Parkhurst, J. M., Gildea, R. J., Michels-Clark, T., Young, I. D., Bernstein, H. J., Winter, G., Evans, G. &amp; Sauter, N. K. (2016). <italic>Comput. Crystallogr. Newsl.</italic>
<bold>7</bold>, 32–53. https://www.phenix-online.org/newsletter/CCN_2016_07.pdf.</mixed-citation>
    </ref>
    <ref id="bb5">
      <mixed-citation publication-type="other">Bricogne, G. (1986<italic>a</italic>). <italic>Proceedings of the EEC Cooperative Workshop on Position-Sensitive Detector Software (Phases I and II).</italic> Paris: LURE.</mixed-citation>
    </ref>
    <ref id="bb4">
      <mixed-citation publication-type="other">Bricogne, G. (1986<italic>b</italic>). <italic>Proceedings of the EEC Cooperative Workshop on Position-Sensitive Detector Software (Phase III).</italic> Paris: LURE.</mixed-citation>
    </ref>
    <ref id="bb6">
      <mixed-citation publication-type="other">Busing, W. R. &amp; Levy, H. A. (1967). <italic>Acta Cryst.</italic>
<bold>22</bold>, 457–464.</mixed-citation>
    </ref>
    <ref id="bb7">
      <mixed-citation publication-type="other">Campbell, J. W. (1998). <italic>J. Appl. Cryst.</italic>
<bold>31</bold>, 407–413.</mixed-citation>
    </ref>
    <ref id="bb8">
      <mixed-citation publication-type="other">Casanas, A., Warshamanage, R., Finke, A. D., Panepucci, E., Olieric, V., Nöll, A., Tampé, R., Brandstetter, S., Förster, A., Mueller, M., Schulze-Briese, C., Bunk, O. &amp; Wang, M. (2016). <italic>Acta Cryst.</italic> D<bold>72</bold>, 1036–1048.</mixed-citation>
    </ref>
    <ref id="bb9">
      <mixed-citation publication-type="other">Cowtan, K. (2006). <italic>Acta Cryst.</italic> D<bold>62</bold>, 1002–1011.</mixed-citation>
    </ref>
    <ref id="bb10">
      <mixed-citation publication-type="other">Diamond, R. (1969). <italic>Acta Cryst.</italic> A<bold>25</bold>, 43–55.</mixed-citation>
    </ref>
    <ref id="bb11">
      <mixed-citation publication-type="other">Dolomanov, O. V., Bourhis, L. J., Gildea, R. J., Howard, J. A. K. &amp; Puschmann, H. (2009). <italic>J. Appl. Cryst.</italic>
<bold>42</bold>, 339–341.</mixed-citation>
    </ref>
    <ref id="bb12">
      <mixed-citation publication-type="other">Duisenberg, A. J. M., Kroon-Batenburg, L. M. J. &amp; Schreurs, A. M. M. (2003). <italic>J. Appl. Cryst.</italic>
<bold>36</bold>, 220–229.</mixed-citation>
    </ref>
    <ref id="bb13">
      <mixed-citation publication-type="other">Emma, P., <italic>et al.</italic> (2010). <italic>Nature Photonics</italic>, <bold>4</bold>, 641–647.</mixed-citation>
    </ref>
    <ref id="bb70">
      <mixed-citation publication-type="other">English, A. C., Done, S. H., Caves, L. S., Groom, C. R. &amp; Hubbard, R. E. (1999). <italic>Proteins</italic>, <bold>37</bold>, 628–640.</mixed-citation>
    </ref>
    <ref id="bb14">
      <mixed-citation publication-type="other">Evans, P. (2006). <italic>Acta Cryst.</italic> D<bold>62</bold>, 72–82.</mixed-citation>
    </ref>
    <ref id="bb15">
      <mixed-citation publication-type="other">Evans, P. R. &amp; Murshudov, G. N. (2013). <italic>Acta Cryst.</italic> D<bold>69</bold>, 1204–1214.</mixed-citation>
    </ref>
    <ref id="bb16">
      <mixed-citation publication-type="other">Frome, E. L. (1982). <italic>J. R. Stat. Soc. Ser. C Appl. Stat.</italic>
<bold>31</bold>, 67–71.</mixed-citation>
    </ref>
    <ref id="bb17">
      <mixed-citation publication-type="other">Fuller, F. D. <italic>et al.</italic> (2017). <italic>Nature Methods</italic>, <bold>14</bold>, 443–449.</mixed-citation>
    </ref>
    <ref id="bb18">
      <mixed-citation publication-type="other">Gati, C., Bourenkov, G., Klinge, M., Rehders, D., Stellato, F., Oberthür, D., Yefanov, O., Sommer, B. P., Mogk, S., Duszenko, M., Betzel, C., Schneider, T. R., Chapman, H. N. &amp; Redecke, L. (2014). <italic>IUCrJ</italic>, <bold>1</bold>, 87–94.</mixed-citation>
    </ref>
    <ref id="bb19">
      <mixed-citation publication-type="other">Gildea, R. J., Waterman, D. G., Parkhurst, J. M., Axford, D., Sutton, G., Stuart, D. I., Sauter, N. K., Evans, G. &amp; Winter, G. (2014). <italic>Acta Cryst.</italic> D<bold>70</bold>, 2652–2666.</mixed-citation>
    </ref>
    <ref id="bb20">
      <mixed-citation publication-type="other">Grosse-Kunstleve, R. W., Sauter, N. K. &amp; Adams, P. D. (2004). <italic>Acta Cryst.</italic> A<bold>60</bold>, 1–6.</mixed-citation>
    </ref>
    <ref id="bb21">
      <mixed-citation publication-type="other">Grosse-Kunstleve, R. W., Sauter, N. K., Moriarty, N. W. &amp; Adams, P. D. (2002). <italic>J. Appl. Cryst.</italic>
<bold>35</bold>, 126–136.</mixed-citation>
    </ref>
    <ref id="bb63">
      <mixed-citation publication-type="other">Hart, P. <italic>et al.</italic> (2012). <italic>2012 IEEE Nuclear Science Symposium and Medical Imaging Conference Record (NSS/MIC)</italic>, pp. 538–541. Anaheim, CA, USA.</mixed-citation>
    </ref>
    <ref id="bb22">
      <mixed-citation publication-type="other">Henrich, B., Bergamaschi, A., Broennimann, C., Dinapoli, R., Eikenberry, E. F., Johnson, I., Kobas, M., Kraft, P., Mozzanica, A. &amp; Schmitt, B. (2009). <italic>Nucl. Instrum. Methods Phys. Res. A</italic>, <bold>607</bold>, 247–249.</mixed-citation>
    </ref>
    <ref id="bb23">
      <mixed-citation publication-type="other">Herrmann, S., Hart, P., Dragone, A., Freytag, D., Herbst, R., Pines, J., Weaver, M., Carini, G. A., Thayer, J. B., Shawn, O., Kenney, C. J. &amp; Haller, G. (2014). <italic>J. Phys. Conf. Ser.</italic>
<bold>493</bold>, 012013.</mixed-citation>
    </ref>
    <ref id="bb24">
      <mixed-citation publication-type="other">Hülsen, G., Brönnimann, C. &amp; Eikenberry, E. F. (2005). <italic>Nucl. Instrum. Methods Phys. Res. A</italic>, <bold>548</bold>, 540–554.</mixed-citation>
    </ref>
    <ref id="bb25">
      <mixed-citation publication-type="other">Ishikawa, T. <italic>et al.</italic> (2012). <italic>Nature Photonics</italic>, <bold>6</bold>, 540–544.</mixed-citation>
    </ref>
    <ref id="bb26">
      <mixed-citation publication-type="other">Kabsch, W. (1988<italic>a</italic>). <italic>J. Appl. Cryst.</italic>
<bold>21</bold>, 67–72.</mixed-citation>
    </ref>
    <ref id="bb27">
      <mixed-citation publication-type="other">Kabsch, W. (1988<italic>b</italic>). <italic>J. Appl. Cryst.</italic>
<bold>21</bold>, 916–924.</mixed-citation>
    </ref>
    <ref id="bb28">
      <mixed-citation publication-type="other">Kabsch, W. (2010<italic>a</italic>). <italic>Acta Cryst.</italic> D<bold>66</bold>, 133–144.</mixed-citation>
    </ref>
    <ref id="bb29">
      <mixed-citation publication-type="other">Kabsch, W. (2010<italic>b</italic>). <italic>Acta Cryst.</italic> D<bold>66</bold>, 125–132.</mixed-citation>
    </ref>
    <ref id="bb30">
      <mixed-citation publication-type="other">Karplus, P. A. &amp; Diederichs, K. (2012). <italic>Science</italic>, <bold>336</bold>, 1030–1033.</mixed-citation>
    </ref>
    <ref id="bb31">
      <mixed-citation publication-type="other">Leslie, A. G. W. (1999). <italic>Acta Cryst.</italic> D<bold>55</bold>, 1696–1702.</mixed-citation>
    </ref>
    <ref id="bb32">
      <mixed-citation publication-type="other">Leslie, A. G. W. (2006). <italic>Acta Cryst.</italic> D<bold>62</bold>, 48–57.</mixed-citation>
    </ref>
    <ref id="bb33">
      <mixed-citation publication-type="other">Lyubimov, A. Y., Uervirojnangkoorn, M., Zeldin, O. B., Zhou, Q., Zhao, M., Brewster, A. S., Michels-Clark, T., Holton, J. M., Sauter, N. K., Weis, W. I. &amp; Brunger, A. T. (2016). <italic>Elife</italic>, <bold>5</bold>, e18740.</mixed-citation>
    </ref>
    <ref id="bb34">
      <mixed-citation publication-type="other">McCoy, A. J., Grosse-Kunstleve, R. W., Adams, P. D., Winn, M. D., Storoni, L. C. &amp; Read, R. J. (2007). <italic>J. Appl. Cryst.</italic>
<bold>40</bold>, 658–674.</mixed-citation>
    </ref>
    <ref id="bb35">
      <mixed-citation publication-type="other">Miras, I., Saul, F., Nowakowski, M., Weber, P., Haouz, A., Shepard, W. &amp; Picardeau, M. (2015). <italic>Acta Cryst.</italic> D<bold>71</bold>, 1351–1359.</mixed-citation>
    </ref>
    <ref id="bb36">
      <mixed-citation publication-type="other">Otwinowski, Z. &amp; Minor, W. (1997). <italic>Methods Enzymol.</italic>
<bold>276</bold>, 307–326.</mixed-citation>
    </ref>
    <ref id="bb37">
      <mixed-citation publication-type="other">Otwinowski, Z., Minor, W., Borek, D. &amp; Cymborowski, M. (2012). <italic>International Tables for Crystallography</italic>, Vol. <italic>F</italic>, edited by E. Arnold, D. M. Himmel &amp; M. G. Rossmann, pp. 282–295. Chester: International Union of Crystallography.</mixed-citation>
    </ref>
    <ref id="bb38">
      <mixed-citation publication-type="other">Parkhurst, J. M., Brewster, A. S., Fuentes-Montero, L., Waterman, D. G., Hattne, J., Ashton, A. W., Echols, N., Evans, G., Sauter, N. K. &amp; Winter, G. (2014). <italic>J. Appl. Cryst.</italic>
<bold>47</bold>, 1459–1465.</mixed-citation>
    </ref>
    <ref id="bb39">
      <mixed-citation publication-type="other">Parkhurst, J. M., Winter, G., Waterman, D. G., Fuentes-Montero, L., Gildea, R. J., Murshudov, G. N. &amp; Evans, G. (2016). <italic>J. Appl. Cryst.</italic>
<bold>49</bold>, 1912–1921.</mixed-citation>
    </ref>
    <ref id="bb40">
      <mixed-citation publication-type="other">Pflugrath, J. W. (1999). <italic>Acta Cryst.</italic> D<bold>55</bold>, 1718–1725.</mixed-citation>
    </ref>
    <ref id="bb42">
      <mixed-citation publication-type="other">Rossmann, M. G., Leslie, A. G. W., Abdel-Meguid, S. S. &amp; Tsukihara, T. (1979). <italic>J. Appl. Cryst.</italic>
<bold>12</bold>, 570–581.</mixed-citation>
    </ref>
    <ref id="bb43">
      <mixed-citation publication-type="other">Russi, S., Song, J., McPhillips, S. E. &amp; Cohen, A. E. (2016). <italic>J. Appl. Cryst.</italic>
<bold>49</bold>, 622–626.</mixed-citation>
    </ref>
    <ref id="bb44">
      <mixed-citation publication-type="other">Sauter, N. K., Grosse-Kunstleve, R. W. &amp; Adams, P. D. (2004). <italic>J. Appl. Cryst.</italic>
<bold>37</bold>, 399–409.</mixed-citation>
    </ref>
    <ref id="bb45">
      <mixed-citation publication-type="other">Sauter, N. K., Grosse-Kunstleve, R. W. &amp; Adams, P. D. (2006). <italic>J. Appl. Cryst.</italic>
<bold>39</bold>, 158–168.</mixed-citation>
    </ref>
    <ref id="bb46">
      <mixed-citation publication-type="other">Sauter, N. K., Hattne, J., Grosse-Kunstleve, R. W. &amp; Echols, N. (2013). <italic>Acta Cryst.</italic> D<bold>69</bold>, 1274–1282.</mixed-citation>
    </ref>
    <ref id="bb47">
      <mixed-citation publication-type="other">Schreurs, A. M. M., Xian, X. &amp; Kroon-Batenburg, L. M. J. (2010). <italic>J. Appl. Cryst.</italic>
<bold>43</bold>, 70–82.</mixed-citation>
    </ref>
    <ref id="bb48">
      <mixed-citation publication-type="other">Sheldrick, G. M. (2010). <italic>Acta Cryst.</italic> D<bold>66</bold>, 479–485.</mixed-citation>
    </ref>
    <ref id="bb49">
      <mixed-citation publication-type="other">Sheldrick, G. M. (2015). <italic>Acta Cryst.</italic> A<bold>71</bold>, 3–8.</mixed-citation>
    </ref>
    <ref id="bb50">
      <mixed-citation publication-type="other">Sierra, R. G. <italic>et al.</italic> (2016). <italic>Nature Methods</italic>, <bold>13</bold>, 59–62.</mixed-citation>
    </ref>
    <ref id="bb51">
      <mixed-citation publication-type="other">Stellato, F. <italic>et al.</italic> (2014). <italic>IUCrJ</italic>, <bold>1</bold>, 204–212.</mixed-citation>
    </ref>
    <ref id="bb52">
      <mixed-citation publication-type="other">Steller, I., Bolotovsky, R. &amp; Rossmann, M. G. (1997). <italic>J. Appl. Cryst.</italic>
<bold>30</bold>, 1036–1040.</mixed-citation>
    </ref>
    <ref id="bb53">
      <mixed-citation publication-type="other">Sutherland, I. E. &amp; Hodgman, G. W. (1974). <italic>Commun. ACM</italic>, <bold>17</bold>, 32–42.</mixed-citation>
    </ref>
    <ref id="bb54">
      <mixed-citation publication-type="other">Vonrhein, C., Flensburg, C., Keller, P., Sharff, A., Smart, O., Paciorek, W., Womack, T. &amp; Bricogne, G. (2011). <italic>Acta Cryst.</italic> D<bold>67</bold>, 293–302.</mixed-citation>
    </ref>
    <ref id="bb55">
      <mixed-citation publication-type="other">Wagner, A., Duman, R., Henderson, K. &amp; Mykhaylyk, V. (2016). <italic>Acta Cryst.</italic> D<bold>72</bold>, 430–439.</mixed-citation>
    </ref>
    <ref id="bb56">
      <mixed-citation publication-type="other">Waterman, D. G., Winter, G., Gildea, R. J., Parkhurst, J. M., Brewster, A. S., Sauter, N. K. &amp; Evans, G. (2016). <italic>Acta Cryst.</italic> D<bold>72</bold>, 558–575.</mixed-citation>
    </ref>
    <ref id="bb57">
      <mixed-citation publication-type="other">White, T. A., Mariani, V., Brehm, W., Yefanov, O., Barty, A., Beyerlein, K. R., Chervinskii, F., Galli, L., Gati, C., Nakane, T., Tolstikova, A., Yamashita, K., Yoon, C. H., Diederichs, K. &amp; Chapman, H. N. (2016). <italic>J. Appl. Cryst.</italic>
<bold>49</bold>, 680–689.</mixed-citation>
    </ref>
    <ref id="bb58">
      <mixed-citation publication-type="other">Winkler, F. K., Schutt, C. E. &amp; Harrison, S. C. (1979). <italic>Acta Cryst.</italic> A<bold>35</bold>, 901–911.</mixed-citation>
    </ref>
    <ref id="bb59">
      <mixed-citation publication-type="other">Winn, M. D. <italic>et al.</italic> (2011). <italic>Acta Cryst.</italic> D<bold>67</bold>, 235–242.</mixed-citation>
    </ref>
    <ref id="bb60">
      <mixed-citation publication-type="other">Winter, G. (2010). <italic>J. Appl. Cryst.</italic>
<bold>43</bold>, 186–190.</mixed-citation>
    </ref>
    <ref id="bb61">
      <mixed-citation publication-type="other">Winter, G. &amp; McAuley, K. E. (2011). <italic>Methods</italic>, <bold>55</bold>, 81–93.</mixed-citation>
    </ref>
    <ref id="bb62">
      <mixed-citation publication-type="other">Young, I. D. <italic>et al.</italic> (2016). <italic>Nature (London)</italic>, <bold>540</bold>, 453–457.</mixed-citation>
    </ref>
  </ref-list>
</back>
<floats-group>
  <fig id="fig1" orientation="portrait" position="float">
    <label>Figure 1</label>
    <caption>
      <p>Flow diagram illustrating the scope and workflow of <italic>DIALS</italic>. The experiment is represented by a set of abstract models describing the parameters of the X-ray beam (B), goniometer (which incorporates the description of the goniometer hardware; G), imaging detector (D), scan (which includes goniometer settings for a given sequence of images and exposure times; S), crystal (C) and Bragg spot profile (P). The reflection data are passed from one step to the next as a list, with the properties of the reflections extended as processing proceeds.</p>
    </caption>
    <graphic xlink:href="d-74-00085-fig1"/>
  </fig>
  <fig id="fig2" orientation="portrait" position="float">
    <label>Figure 2</label>
    <caption>
      <p>Refinement statistics [mean of cosine of phase error (FOM), CC between <italic>F</italic>
<sub>o</sub> and <italic>F</italic>
<sub>c</sub>, and <italic>R</italic> factors] for LRR and thermolysin against data processed with <italic>xia</italic>2 and <italic>DIALS</italic>. While there are no surprises for LRR, for thermolysin it is important to note that the statistics remain well behaved as the <italic>I</italic>/σ(<italic>I</italic>) of the data tends towards zero.</p>
    </caption>
    <graphic xlink:href="d-74-00085-fig2"/>
  </fig>
  <fig id="fig3" orientation="portrait" position="float">
    <label>Figure 3</label>
    <caption>
      <p><italic>R</italic>-factor gap using data to 1.8 Å resolution as a function of the resolution of the data used for the paired refinement. There is a clear reduction in the difference between <italic>R</italic> and <italic>R</italic>
<sub>free</sub> using the weaker measurements to around 1.56 Å resolution.</p>
    </caption>
    <graphic xlink:href="d-74-00085-fig3"/>
  </fig>
  <fig id="fig4" orientation="portrait" position="float">
    <label>Figure 4</label>
    <caption>
      <p>Commonly encountered reciprocal-space pathologies using <italic>dials.reciprocal_lattice_viewer</italic>. (<italic>a</italic>) Problems with image headers, such as an incorrect beam centre or an inverted rotation axis, may lead to an apparent distortion in the lattice. Depending on the severity of the distortion, autoindexing may identify an incorrect lattice or result in an offset in the assigned Miller indices. (<italic>b</italic>) Visible features that are not part of the primary lattice, such as points arranged in a spherical shell, may indicate the presence of ice rings or low-quality powder samples. (<italic>c</italic>) Split crystals or multiple lattices are visible as a set of two or more intersecting lattices. Unindexed reflections and reflections identified as belonging to distinct lattices are coloured separately to aid visualization. (<italic>d</italic>) Multiple sweeps from a single crystal on a multi-axis goniometer can be combined for display, with each sweep uniquely coloured.</p>
    </caption>
    <graphic xlink:href="d-74-00085-fig4"/>
  </fig>
  <fig id="fig5" orientation="portrait" position="float">
    <label>Figure 5</label>
    <caption>
      <p>Spot count per image plots generated by the <italic>dials.report</italic> tool for three data sets. (<italic>a</italic>) shows what may be expected when there is no substantial radiation damage, (<italic>b</italic>) when there is substantial radiation damage and (<italic>c</italic>) when a poorly centred sample is rotated out of the beam for part of the scan. These indicators may very rapidly be used to diagnose issues with data sets without needing to individually inspect the images.</p>
    </caption>
    <graphic xlink:href="d-74-00085-fig5"/>
  </fig>
  <fig id="fig6" orientation="portrait" position="float">
    <label>Figure 6</label>
    <caption>
      <p>Images generated by <italic>dials.report</italic> showing (<italic>a</italic>) a histogram of <italic>x</italic>, <italic>y</italic> deviations between observed and calculated spot positions from refinement and (<italic>b</italic>) correlation between modelled and observed spot profiles in integration. The diagonal blank region corresponds to reflections close to the rotation axis in a φ scan (both taken from the small-molecule example in the main text).</p>
    </caption>
    <graphic xlink:href="d-74-00085-fig6"/>
  </fig>
  <table-wrap id="table1" orientation="portrait" position="float">
    <label>Table 1</label>
    <caption>
      <title>Crystallographic parameters, data, phasing and refinement statistics</title>
      <p>Values in parentheses are for the highest resolution shell.</p>
    </caption>
    <table frame="hsides" rules="groups">
      <thead valign="bottom">
        <tr>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="bottom"> </th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="bottom">LRR</th>
          <th style="border-bottom:1px solid black;" rowspan="1" colspan="1" align="left" valign="bottom">Thermolysin</th>
        </tr>
      </thead>
      <tbody valign="top">
        <tr>
          <td rowspan="1" colspan="3" align="left" valign="top">Crystal parameters</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Space group</td>
          <td rowspan="1" colspan="1" align="left" valign="top"><italic>P</italic>4<sub>2</sub>2<sub>1</sub>2</td>
          <td rowspan="1" colspan="1" align="left" valign="top"><italic>P</italic>6<sub>1</sub>22</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Unit-cell parameters (Å)</td>
          <td rowspan="1" colspan="1" align="left" valign="top"><italic>a</italic> = <italic>b</italic> = 121.49738 (10), <italic>c</italic> = 57.02179 (9)</td>
          <td rowspan="1" colspan="1" align="left" valign="top"><italic>a</italic> = <italic>b</italic> = 92.35414 (9), <italic>c</italic> = 127.7128 (2)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="3" align="left" valign="top">Data statistics</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Resolution range (Å)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">57.03–1.45 (1.48–1.45)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">79.97–1.50 (1.54–1.50)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> No. of unique reflections</td>
          <td rowspan="1" colspan="1" align="left" valign="top">75939 (3767)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">50728 (3264)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Multiplicity</td>
          <td rowspan="1" colspan="1" align="left" valign="top">10.6 (8.8)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">73.3 (52.5)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic>
<sub>merge</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.077 (1.114)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.222 (24.722)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic>
<sub>meas</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.081 (1.183)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.226 (26.202)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic>
<sub>p.i.m.</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.025 (0.391)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.026 (3.495)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Completeness (%)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">100.0 (100.0)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">97.8 (86.8)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 〈<italic>I</italic>/σ(<italic>I</italic>)〉</td>
          <td rowspan="1" colspan="1" align="left" valign="top">14.7 (1.7)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">13.3 (0.1)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> CC<sub>1/2</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.999 (0.669)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">1.000 (0.258)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Wilson plot <italic>B</italic> factor (Å<sup>2</sup>)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">14.13</td>
          <td rowspan="1" colspan="1" align="left" valign="top">16.09</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="3" align="left" valign="top">Phasing</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="3" align="left" valign="top"> 
<italic>SHELXD</italic>
</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  CC<sub>all</sub> (%)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">40.38</td>
          <td rowspan="1" colspan="1" align="left" valign="top"> </td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  CC<sub>weak</sub> (%)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">21.39</td>
          <td rowspan="1" colspan="1" align="left" valign="top"> </td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  No. of sites with occupancy &gt; 25%</td>
          <td rowspan="1" colspan="1" align="left" valign="top">8</td>
          <td rowspan="1" colspan="1" align="left" valign="top"> </td>
        </tr>
        <tr>
          <td rowspan="1" colspan="3" align="left" valign="top"> 
<italic>SHELXE</italic>
</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  CC, original hand (%)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">44.73</td>
          <td rowspan="1" colspan="1" align="left" valign="top"> </td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  CC, inverse hand (%)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">8.83</td>
          <td rowspan="1" colspan="1" align="left" valign="top"> </td>
        </tr>
        <tr>
          <td rowspan="1" colspan="3" align="left" valign="top">Refinement</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Resolution (Å)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">54.40–1.45 (1.48–1.45)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">79.97–1.50 (1.54–1.50)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> No. of reflections</td>
          <td rowspan="1" colspan="1"> </td>
          <td rowspan="1" colspan="1"> </td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Total</td>
          <td rowspan="1" colspan="1" align="left" valign="top">75880 (5255)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">50699 (3064)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Working set</td>
          <td rowspan="1" colspan="1" align="left" valign="top">72061 (4986)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">48191 (2932)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Free set</td>
          <td rowspan="1" colspan="1" align="left" valign="top">3722 (269)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">2500 (132)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic>
<sub>work</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.152 (0.335)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.157 (0.352)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic>
<sub>free</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.187 (0.367)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.205 (0.368)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="3" align="left" valign="top"> No. of non-H atoms </td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Protein</td>
          <td rowspan="1" colspan="1" align="left" valign="top">2899</td>
          <td rowspan="1" colspan="1" align="left" valign="top">2456</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Waters</td>
          <td rowspan="1" colspan="1" align="left" valign="top">402</td>
          <td rowspan="1" colspan="1" align="left" valign="top">302</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Zn<sup>2+</sup> ions</td>
          <td rowspan="1" colspan="1" align="left" valign="top">9</td>
          <td rowspan="1" colspan="1" align="left" valign="top">2</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Cl<sup>−</sup> ions</td>
          <td rowspan="1" colspan="1" align="left" valign="top">—</td>
          <td rowspan="1" colspan="1" align="left" valign="top">2</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Ca<sup>2+</sup> ions</td>
          <td rowspan="1" colspan="1" align="left" valign="top">—</td>
          <td rowspan="1" colspan="1" align="left" valign="top">4</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Peptide</td>
          <td rowspan="1" colspan="1" align="left" valign="top">—</td>
          <td rowspan="1" colspan="1" align="left" valign="top">18</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Acetate</td>
          <td rowspan="1" colspan="1" align="left" valign="top">16</td>
          <td rowspan="1" colspan="1" align="left" valign="top">8</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Tris</td>
          <td rowspan="1" colspan="1" align="left" valign="top">8</td>
          <td rowspan="1" colspan="1" align="left" valign="top">—</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  2-Propanol</td>
          <td rowspan="1" colspan="1" align="left" valign="top">8</td>
          <td rowspan="1" colspan="1" align="left" valign="top">—</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  DMSO</td>
          <td rowspan="1" colspan="1" align="left" valign="top">—</td>
          <td rowspan="1" colspan="1" align="left" valign="top">4</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Sulfate</td>
          <td rowspan="1" colspan="1" align="left" valign="top">—</td>
          <td rowspan="1" colspan="1" align="left" valign="top">5</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="3" align="left" valign="top"> R.m.s. deviations from ideal</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Bond lengths (Å)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.009</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.010</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Bond angles (°)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">1.376</td>
          <td rowspan="1" colspan="1" align="left" valign="top">1.332</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="3" align="left" valign="top"> Ramachandran plot (%)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Preferred regions</td>
          <td rowspan="1" colspan="1" align="left" valign="top">94.65</td>
          <td rowspan="1" colspan="1" align="left" valign="top">96.25</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Allowed regions</td>
          <td rowspan="1" colspan="1" align="left" valign="top">5.35</td>
          <td rowspan="1" colspan="1" align="left" valign="top">3.75</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top">  Outliers</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.0</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.0</td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
  <table-wrap id="table2" orientation="portrait" position="float">
    <label>Table 2</label>
    <caption>
      <title>Merging statistics for <sc>L</sc>-cysteine data obtained on Diamond Light Source beamline I19-1</title>
    </caption>
    <table frame="hsides" rules="groups">
      <tbody valign="top">
        <tr>
          <td rowspan="1" colspan="2" align="left" valign="top">Crystal parameters</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Space group</td>
          <td rowspan="1" colspan="1" align="left" valign="top"><italic>P</italic>2<sub>1</sub>2<sub>1</sub>2<sub>1</sub></td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Unit-cell parameters (Å)</td>
          <td rowspan="1" colspan="1" align="left" valign="top"><italic>a</italic> = 5.4278 (9), <italic>b</italic> = 8.1444 (13), <italic>c</italic> = 12.0391 (21)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>V</italic> (Å<sup>3</sup>)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">532.2007 (955)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Formula</td>
          <td rowspan="1" colspan="1" align="left" valign="top">C<sub>3</sub>H<sub>7</sub>NO<sub>2</sub>S</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="2" align="left" valign="top">Data statistics</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Resolution range (Å)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">6.74–0.58 (0.63–0.58)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> No. of unique reflections</td>
          <td rowspan="1" colspan="1" align="left" valign="top">1552 (263)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Multiplicity</td>
          <td rowspan="1" colspan="1" align="left" valign="top">7.6 (3.7)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic>
<sub>merge</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.033 (0.068)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic>
<sub>meas</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.035 (0.078)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic>
<sub>p.i.m.</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.011 (0.036)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Completeness (%)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">95.0 (83.3)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 〈<italic>I</italic>/σ(<italic>I</italic>)〉</td>
          <td rowspan="1" colspan="1" align="left" valign="top">28.5 (13.5)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> CC<sub>1/2</sub>
</td>
          <td rowspan="1" colspan="1" align="left" valign="top">1.000 (0.992)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="2" align="left" valign="top">Refinement</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic>[<italic>F</italic>
<sup>2</sup> &gt; 2σ(<italic>F</italic>
<sup>2</sup>)]</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.0304</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>R</italic> (all data)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.0312</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> 
<italic>wR</italic>(<italic>F</italic>
<sup>2</sup>) (all data)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.0887</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Goodness-of-fit (<italic>F</italic>
<sup>2</sup>)</td>
          <td rowspan="1" colspan="1" align="left" valign="top">1.103</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> Flack parameter</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0.05 (3)</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> No. of reflections</td>
          <td rowspan="1" colspan="1" align="left" valign="top">7388</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> No. of parameters</td>
          <td rowspan="1" colspan="1" align="left" valign="top">66</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1" align="left" valign="top"> No. of restraints</td>
          <td rowspan="1" colspan="1" align="left" valign="top">0</td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
</floats-group>
