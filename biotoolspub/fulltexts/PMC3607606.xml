<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-archivearticle1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">PLoS One</journal-id>
    <journal-id journal-id-type="iso-abbrev">PLoS ONE</journal-id>
    <journal-id journal-id-type="publisher-id">plos</journal-id>
    <journal-id journal-id-type="pmc">plosone</journal-id>
    <journal-title-group>
      <journal-title>PLoS ONE</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1932-6203</issn>
    <publisher>
      <publisher-name>Public Library of Science</publisher-name>
      <publisher-loc>San Francisco, USA</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">3607606</article-id>
    <article-id pub-id-type="pmid">23536903</article-id>
    <article-id pub-id-type="publisher-id">PONE-D-12-24748</article-id>
    <article-id pub-id-type="doi">10.1371/journal.pone.0060058</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Research Article</subject>
      </subj-group>
      <subj-group subj-group-type="Discipline-v2">
        <subject>Biology</subject>
        <subj-group>
          <subject>Biotechnology</subject>
          <subj-group>
            <subject>Plant Biotechnology</subject>
          </subj-group>
        </subj-group>
        <subj-group>
          <subject>Computational Biology</subject>
          <subj-group>
            <subject>Genomics</subject>
            <subj-group>
              <subject>Genome Analysis Tools</subject>
              <subj-group>
                <subject>Sequence Assembly Tools</subject>
              </subj-group>
            </subj-group>
            <subj-group>
              <subject>Genome Sequencing</subject>
            </subj-group>
          </subj-group>
        </subj-group>
        <subj-group>
          <subject>Genomics</subject>
          <subj-group>
            <subject>Genome Analysis Tools</subject>
            <subj-group>
              <subject>Linkage Maps</subject>
            </subj-group>
          </subj-group>
          <subj-group>
            <subject>Genome Sequencing</subject>
          </subj-group>
        </subj-group>
        <subj-group>
          <subject>Plant Science</subject>
          <subj-group>
            <subject>Agronomy</subject>
            <subject>Plant Pathology</subject>
          </subj-group>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Identifying and Classifying Trait Linked Polymorphisms in Non-Reference Species by Walking Coloured de Bruijn Graphs</article-title>
      <alt-title alt-title-type="running-head">Classifying Polymorphisms in Non-Reference Species</alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Leggett</surname>
          <given-names>Richard M.</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ramirez-Gonzalez</surname>
          <given-names>Ricardo H.</given-names>
        </name>
        <xref ref-type="aff" rid="aff2">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Verweij</surname>
          <given-names>Walter</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kawashima</surname>
          <given-names>Cintia G.</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Iqbal</surname>
          <given-names>Zamin</given-names>
        </name>
        <xref ref-type="aff" rid="aff3">
          <sup>3</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Jones</surname>
          <given-names>Jonathan D. G.</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Caccamo</surname>
          <given-names>Mario</given-names>
        </name>
        <xref ref-type="aff" rid="aff2">
          <sup>2</sup>
        </xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>MacLean</surname>
          <given-names>Daniel</given-names>
        </name>
        <xref ref-type="aff" rid="aff1">
          <sup>1</sup>
        </xref>
        <xref ref-type="corresp" rid="cor1">
          <sup>*</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff1">
      <label>1</label>
      <addr-line>The Sainsbury Laboratory, Norwich Research Park, Colney, Norwich, United Kingdom</addr-line>
    </aff>
    <aff id="aff2">
      <label>2</label>
      <addr-line>The Genome Analysis Centre, Norwich Research Park, Colney, Norwich, United Kingdom</addr-line>
    </aff>
    <aff id="aff3">
      <label>3</label>
      <addr-line>Wellcome Trust Centre for Human Genetics, University of Oxford, Oxford, United Kingdom</addr-line>
    </aff>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Hsu</surname>
          <given-names>Yi-Hsiang</given-names>
        </name>
        <role>Editor</role>
        <xref ref-type="aff" rid="edit1"/>
      </contrib>
    </contrib-group>
    <aff id="edit1">
      <addr-line>Harvard Medical School, United States of America</addr-line>
    </aff>
    <author-notes>
      <corresp id="cor1">* E-mail: <email>dan.maclean@tsl.ac.uk</email></corresp>
      <fn fn-type="COI-statement">
        <p><bold>Competing Interests: </bold>The authors have declared that no competing interests exist.</p>
      </fn>
      <fn fn-type="con">
        <p>Conceived and designed the experiments: DM MC RML JDGJ. Performed the experiments: RML WV CGK. Analyzed the data: RML DM RHRG MC WV CGK. Contributed reagents/materials/analysis tools: ZI MC. Wrote the paper: RML DM WV CGK.</p>
      </fn>
    </author-notes>
    <pub-date pub-type="collection">
      <year>2013</year>
    </pub-date>
    <pub-date pub-type="epub">
      <day>25</day>
      <month>3</month>
      <year>2013</year>
    </pub-date>
    <volume>8</volume>
    <issue>3</issue>
    <elocation-id>e60058</elocation-id>
    <history>
      <date date-type="received">
        <day>13</day>
        <month>8</month>
        <year>2012</year>
      </date>
      <date date-type="accepted">
        <day>21</day>
        <month>2</month>
        <year>2013</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© 2013 Leggett et al</copyright-statement>
      <copyright-year>2013</copyright-year>
      <copyright-holder>Leggett et al</copyright-holder>
      <license xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are properly credited.</license-p>
      </license>
    </permissions>
    <abstract>
      <p>Single Nucleotide Polymorphisms are invaluable markers for tracing the genetic basis of inheritable traits and the ability to create marker libraries quickly is vital for timely identification of target genes. Next-generation sequencing makes it possible to sample a genome rapidly, but polymorphism detection relies on having a reference genome to which reads can be aligned and variants detected. We present Bubbleparse, a method for detecting variants directly from next-generation reads without a reference sequence. Bubbleparse uses the de Bruijn graph implementation in the Cortex framework as a basis and allows the user to identify bubbles in these graphs that represent polymorphisms, quickly, easily and sensitively. We show that the Bubbleparse algorithm is sensitive and can detect many polymorphisms quickly and that it performs well when compared with polymorphism detection methods based on alignment to a reference in <italic>Arabidopsis thaliana</italic>. We show that the heuristic can be used to maximise the number of true polymorphisms returned, and with a proof-of-principle experiment show that Bubbleparse is very effective on data from unsequenced wild relatives of potato and enabled us to identify disease resistance linked genes quickly and easily.</p>
    </abstract>
    <funding-group>
      <funding-statement>Funding sources: The Two Blades Foundation - <ext-link ext-link-type="uri" xlink:href="http://2blades.org">http://2blades.org</ext-link>; The Gatsby Charitable Foundation - <ext-link ext-link-type="uri" xlink:href="http://www.gatsby.org.uk">http://www.gatsby.org.uk</ext-link>; BBSRC - <ext-link ext-link-type="uri" xlink:href="http://www.bbsrc.ac.uk">http://www.bbsrc.ac.uk</ext-link> and BBSRC grant BB/G02197X/1. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
    </funding-group>
    <counts>
      <page-count count="11"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec id="s1">
    <title>Introduction</title>
    <p>Genetic polymorphisms between genomes of individuals in a population, such as Single Nucleotide Polymorphisms (SNPs), are invaluable markers for tracing the genetic basis of inheritable traits or diseases. Rapid detection of polymorphisms and creation of large libraries of SNPs is vital for timely investigation and identification of genes associated with medically and agronomically important phenotypes. Next-generation sequencing (NGS) can sample genomes comprehensively in only hours, but making use of the typically short reads remains a challenge. Detection of SNPs and short Indels is typically achieved by aligning reads to a reference genome and identifying where the consensus from the aligned reads differs from the reference sequence. Factors such as the need for a reference sequence and the implicit assumption of a monomorphic sample mean that the consensus approach is limited in organisms for which we lack a reference genome, outbred diploid samples, bulked population data or analysis of metagenomes. The ability to identify genetic differences between two (or more) sequenced but not assembled, and genetically divergent genomes would be of great benefit to biotechnologists wishing to create libraries of genetic markers for breeding and disease programs in as short a time as possible. The major obstacles to identifying genetic differences directly from NGS reads are the volume of sequence data that must be assessed and the accurate detection of variants in reads that individually are often prone to error. But even with perfect reads the alignment-based methods will struggle with complex genomic regions or in the presence of indels.</p>
    <p>De Bruijn graphs are directed graphs of overlapping symbols that are directly suited to representing ordinal relationships between same length sub-sequences of reads (typically called <italic>k</italic>mers, being of arbitrary length <italic>k</italic>) (<xref ref-type="fig" rid="pone-0060058-g001">Figure 1A</xref>). They can be implemented in efficient data structures for large collections of kmers and have proven to be of great utility as the underlying data model over which numerous de novo assembly algorithms have been implemented <xref rid="pone.0060058-Pevzner1" ref-type="bibr">[1]</xref>, <xref rid="pone.0060058-Zerbino1" ref-type="bibr">[2]</xref>, <xref rid="pone.0060058-Simpson1" ref-type="bibr">[3]</xref>.</p>
    <fig id="pone-0060058-g001" orientation="portrait" position="float">
      <object-id pub-id-type="doi">10.1371/journal.pone.0060058.g001</object-id>
      <label>Figure 1</label>
      <caption>
        <title>Bubbles in the de Bruijn graph.</title>
        <p>(A) Representation of a simple 11 nt sequence as a de Bruijn graph (top) and then with a SNP (bottom). Nodes represent <italic>k</italic>mers – sequences of <italic>k</italic> nucleotides – and edges join together kmers that overlap by <italic>k</italic>−1 nucleotides. A SNP causes a bifurcation in the graph and the new path joins up with the original path after <italic>k</italic> nodes. (B) de Bruijn graph representations of a single heterozygous SNP (top) and a SNP followed by a second SNP within <italic>k</italic> nt (bottom). (C) Our bubble classification system assigns a type according to the number of colours present on each path through the bubble. Thus a bubble corresponding to a heterozygous SNP from an organism in which the resistant variant contains 2 alleles and the susceptible contains 1 allele would produce a bubble with 2 colours on one path and 1 colour on a second path and would be classified as a type “2,1”. Similarly, a bubble corresponding to a heterozygous SNP from an organism in which both the resistant and susceptible variants contain 2 alleles would be classified as a type “2,1”. Finally, a less common example where 2 alleles are present in one variant and 3 in another would appear as a type “2,2,1”.</p>
      </caption>
      <graphic xlink:href="pone.0060058.g001"/>
    </fig>
    <p>Methods based on the de Bruijn graph have been implemented recently that can efficiently identify differences in sequence read sets <xref rid="pone.0060058-Peterlongo1" ref-type="bibr">[4]</xref> but do not yet extend to allowing direct classifications based on genetic background. Some very specialised pipelines have also been developed for the tracking of genetic loci through populations on reduced representation Illumina data <xref rid="pone.0060058-Catchen1" ref-type="bibr">[5]</xref>. Iqbal <italic>et al.</italic>
<xref rid="pone.0060058-Iqbal1" ref-type="bibr">[6]</xref> produced the first model and de novo assembly algorithms for variant discovery and genotyping from sequence data without using a reference genome. By encoding different datasets in different colours in the graph (e.g. each colour representing a single sample, or a single pool/population), they introduced novel methods for detecting variants and distinguishing populations or individuals by finding alleles with differential colouring. They described how variants induce “bubble” structures in the graph, which could be confounded with sequencing errors or repeated kmers. Given a specific genome of interest, a variant-size and a kmer size, the power to detect variants was modelled. The authors noted that without a reference, it was difficult to distinguish read errors and repeats from genuine SNPs.</p>
    <p>We present here an extension of the method in Iqbal et al. <xref rid="pone.0060058-Iqbal1" ref-type="bibr">[6]</xref>, which has in principle greater power to discover SNPs. The method relies on implementing a minimal error-cleaning routine, followed by a depth-first search in the graph to find bubbles and has the explicit goal of reliably identifying real and useful homozygous and heterozygous SNPs from samples of varied genetic background. The method relies on differential coverage on the different branches of a bubble from two different samples. For example a homozygous SNP in a resistant individual or population would appear in the graph as a bubble with two different coloured branches, that is kmers from only one sample on each side of the bubble. Similarly a heterozygous allele in a disease resistant organism that is homozygous in a susceptible variant would manifest as a bubble with a dual coloured branch for the allele for susceptibility (<xref ref-type="fig" rid="pone-0060058-g001">Figure 1C</xref>). We control specificity by ranking called variants using differential coverage on the two alleles. We demonstrate the power of combining multicoloured graphs with an appropriate experimental design, by identifying SNPs linked to <italic>Phytophthora infestans</italic> resistance in crosses of resistant and susceptible accessions that are relatives of potato.</p>
  </sec>
  <sec id="s2">
    <title>Results and Discussion</title>
    <p>Our software for identifying SNPs, Bubbleparse, uses the efficient de Bruijn graph representation provided by Cortex <xref rid="pone.0060058-Iqbal1" ref-type="bibr">[6]</xref>, and implements a new algorithm for identifying bubbles. Though Cortex provides a method of variant calling, the algorithm is designed only to detect clean bubbles and more complicated structures require a reference for identification. Our algorithm identifies more complex bubbles without the use of a reference. Given sufficient coverage, the method can call all possible variants, but also errors, paralogs and misassemblies. Therefore we control specificity with a classification and ranking system that we benchmark below and show to be effective.</p>
    <sec id="s2a">
      <title>Bubble detection</title>
      <p>A de Bruijn graph is a labeled directed graph represented by a pair <inline-formula><inline-graphic xlink:href="pone.0060058.e001.jpg"/></inline-formula>, consisting of a set of vertices, <inline-formula><inline-graphic xlink:href="pone.0060058.e002.jpg"/></inline-formula>, and a set of edges, <inline-formula><inline-graphic xlink:href="pone.0060058.e003.jpg"/></inline-formula>. Each vertex (or node) of the graph represents a <italic>k</italic>mer, which is a nucleotide sequence of length <italic>k</italic> that differs from connected <italic>k</italic>mers by a single nucleotide.</p>
      <p>A path through the graph can be represented by <inline-formula><inline-graphic xlink:href="pone.0060058.e004.jpg"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="pone.0060058.e005.jpg"/></inline-formula> is a set of <inline-formula><inline-graphic xlink:href="pone.0060058.e006.jpg"/></inline-formula> vertices, <inline-formula><inline-graphic xlink:href="pone.0060058.e007.jpg"/></inline-formula> and <inline-formula><inline-graphic xlink:href="pone.0060058.e008.jpg"/></inline-formula> is a set of <inline-formula><inline-graphic xlink:href="pone.0060058.e009.jpg"/></inline-formula> edges, <inline-formula><inline-graphic xlink:href="pone.0060058.e010.jpg"/></inline-formula>, such that the target node of <inline-formula><inline-graphic xlink:href="pone.0060058.e011.jpg"/></inline-formula> is the source node for <inline-formula><inline-graphic xlink:href="pone.0060058.e012.jpg"/></inline-formula>.</p>
      <p>Two paths, <inline-formula><inline-graphic xlink:href="pone.0060058.e013.jpg"/></inline-formula> consisting of <inline-formula><inline-graphic xlink:href="pone.0060058.e014.jpg"/></inline-formula> vertices and <inline-formula><inline-graphic xlink:href="pone.0060058.e015.jpg"/></inline-formula> consisting of <inline-formula><inline-graphic xlink:href="pone.0060058.e016.jpg"/></inline-formula> vertices, form a bubble if<disp-formula id="pone.0060058.e017"><graphic xlink:href="pone.0060058.e017.jpg" position="anchor" orientation="portrait"/></disp-formula>
</p>
      <p>In the first step of bubble finding, we examine each node in the graph looking for one of two kinds of possible branch point.: ‘Y’ nodes feature one path in one direction and 2 (typically) or more (up to 4, one for each nucleotide) in the opposite direction; and ‘X’ nodes feature 2 or more paths in both directions. Branch points are places where the path through the graph diverges and if these paths later re-converge, a bubble is formed. Therefore, the next step is to explore each node flagged in the first step and see if the paths originating from it later converge on a common node. This is achieved by building a list of all paths from a given branch node, up to a maximum number of bifurcations traversed, which is a depth-first search. These paths are then compared step-by-step, looking for a common node of convergence. A parameter, <italic>d</italic>, determines the number of levels of bifurcation that will be allowed when exploring potential bubble paths. A value of 1 means that 1 level of bifurcation will be explored before the algorithm abandons further exploration of the path. Thus, the maximum number of paths that will be explored is equal to 4<sup>1+d</sup>.</p>
      <p>When a point of convergence is identified, we have the start and end nodes of a bubble and can easily produce a set of nucleotide sequences representing the paths through the bubble. For practical use, such as the design of primers, we need to find flanking sequences at either side of the bubble. These are obtained by walking the graph as far as possible from the start and end nodes, until we reach another branch node.</p>
      <p>This bubble detection algorithm has been implemented as a new module within Cortex, independent of and separate from the standard variant calling options. The primary advantage of our new algorithm is that it allows the reference-free detection of more complicated bubble structures than Cortex does (see below for experimental verification), but also that it allows us control over the information that is available to the Bubbleparse ranking algorithm. The output of this new module is a pair of files that can be read by the Bubbleparse ranking tool. Once the collection of bubbles is created, Bubbleparse gives each a type classification determined by the number of paths through the bubble and the number of colours that follow each path (<xref ref-type="fig" rid="pone-0060058-g001">Figure 1C</xref>). Bubbleparse creates these classifications and collates quantities such as node coverage per colour path, kmer quality score, coverage ratio and produces a ranked list of SNPs subdivided according to bubble type.</p>
    </sec>
    <sec id="s2b">
      <title>Bubble detection and classification is sensitive and fast but creates many false positive SNP calls at greater graph search depths</title>
      <p>The reference free exploration of the graph is expected to generate high numbers of false positives induced by repeats in the underlying genome and numerous artefacts in the sequence reads that can cause bubble structures that are not due to polymorphisms. In order to quantify this error level and to examine the efficiency with which we could detect true SNPs in bubble collections from experimentally generated reads, we compared our SNP calls with those from a commonly used SNP calling pipeline based on reference alignment, as well as with a curated high-quality set of SNPs from an external genetic variation project. We used reads from the Bur-0, Tsu-1 (31–40 nt) and Ler-1 (40–80 nt) ecotypes of <italic>Arabidopsis thaliana</italic> released by the 1001 Genomes Project and available from the Sequence Read Archive at EMBL (ENA SRA Experiments SRX000702 to SRX000704), against <italic>A. thaliana</italic> Col-0 reads. The Bur-0 reads provided approximately 50× coverage, the Tsu-1 reads 38× coverage, while for Ler-1 we present results for a range of coverage values from 40× to 340×.</p>
      <p>Alignment against the reference was performed using BWA <xref rid="pone.0060058-Li1" ref-type="bibr">[7]</xref> and SNPs called using SAMTools <xref rid="pone.0060058-Li2" ref-type="bibr">[8]</xref>. In order to have a high degree of confidence that a homozygous SNP was genuine, we required 95% of the reads covering a position to carry the same nucleotide and for that nucleotide to be different to the one in the same position in the Col-0 reference. For Bur-0, this resulted in SAMTools calling 351,493 and 182,419 SNPs at minimum alignment coverage of 10 and 20 respectively. For Tsu-1, the values were 261,970 and 88,597.</p>
      <p>In Bubbleparse, reads were assembled into the de Bruijn graph, removing paths of nodes with coverage 2 or below and tips less than 100 nucleotides in length. Bubble detection was run using depth from 0 to 3 and k from 15–31. The contigs representing bubbles were BLASTed <xref rid="pone.0060058-Altschul1" ref-type="bibr">[9]</xref> against the TAIR9 reference in order to find their locations and to build a list of predicted SNP locations.</p>
      <p>Bubbleparse identified many bubbles in each comparison (<xref ref-type="fig" rid="pone-0060058-g002">Figure 2</xref>), (maximum 893,627 for Col-0/Bur-0 at depth 3 and k = 19. The number of bubbles found increased with depth of search as expected and roughly mirrored the number of distinct kmers, which were maximal at k = 19 or k = 21 for all Bur-0 and Tsu-1 (<xref ref-type="supplementary-material" rid="pone.0060058.s005">Figure S1</xref>), but decreased sharply as k moved away from this.</p>
      <fig id="pone-0060058-g002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0060058.g002</object-id>
        <label>Figure 2</label>
        <caption>
          <title>Effect of depth of search on number of bubbles found by Bubbleparse.</title>
          <p>Graphs showing numbers of bubbles found for Bur-0 and Tsu-1 with search depth set to 0, 1, 2 and 3 at constant read coverage (top) and for Ler-1 at varied read coverage (bottom).</p>
        </caption>
        <graphic xlink:href="pone.0060058.g002"/>
      </fig>
      <p>Comparing the canonical SNP positions, obtained by pileup, with the Bubbleparse matches allowed us to estimate sensitivity and compare this with the proportion of real SNPs retained in our bubble collections. The number of real SNPs found in our bubble collections increased with depth of search to a maximum of 86.82% of SNPs identified in Tsu-1 (<xref ref-type="fig" rid="pone-0060058-g003">Figure 3</xref>) for depth 3 indicating that the search algorithm is effective at detecting bubbles representing real SNPs. <xref ref-type="fig" rid="pone-0060058-g003">Figure 3</xref> shows that this sensitivity comes at the cost of a significant amount of specificity at greater search depths, such that the proportion of real SNPs in the collection drops from 61.99% at its highest (for Bur-0 at k = 17 and bubble search depth of 0 with minimum coverage for calling a canonical SNP of 10) to 3.53% at its lowest (for Tsu-1 at a bubble search depth of 3 and minimum read depth coverage for calling a canonical SNP of 20 at k = 31). Together these results indicate that the graph traversal algorithm is effective at finding bubbles and that the simple bubbles discovered by low depth graph searches are more likely to represent a SNP than the complex structures discovered by a deeper graph search. We believe that the complex structures in the graph may more often represent underlying genomic characteristics such as k length repeats or read errors, rather than differences in sequence between ecotypes.</p>
      <fig id="pone-0060058-g003" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0060058.g003</object-id>
        <label>Figure 3</label>
        <caption>
          <title>Identification of <italic>Arabidopsis thaliana</italic> SNPs.</title>
          <p>Percentages of canonical SNPs found (solid lines) and percentage of Bubbleparse identified SNPs that were found in the canonical set (dotted lines) for Bur-0 and Tsu-1 with search depth set to 0, 1, 2 and 3 at constant read coverage (top) and for Ler-1 at varied read coverage (bottom).</p>
        </caption>
        <graphic xlink:href="pone.0060058.g003"/>
      </fig>
    </sec>
    <sec id="s2c">
      <title>Too much read depth can reduce rates of SNP detection and produce higher rates of false positives</title>
      <p>To test the effects of high read coverage and to compare our data with a heavily examined and well-curated canonical set of SNPs we carried out a similar analysis with the <italic>Arabidopsis</italic> ecotype Ler-1. For this, we used the 1001 Genomes projects own list of SNPs, generated as described by Schneeberger <italic>et al.</italic>
<xref rid="pone.0060058-Schneeberger1" ref-type="bibr">[10]</xref>. We considered these lists of SNP positions as a reference set against which to compare those discovered by our method. For Ler-1 we varied the average coverage of kmers in reads sent to Bubbleparse rather than varying the depth coverage limit for the reference set SNP calling as for Bur-0 and Tsu-1, up to the maximum available 340× (<xref ref-type="supplementary-material" rid="pone.0060058.s010">Methods S2</xref>). We observed a similar pattern to that with the previous ecotypes, many bubbles were found to a maximum 1,226,068 at depth 2 for k = 21, and sensitivity was of similar magnitude with a maximum of 52.66% of canonical SNPs found at optimum k for bubble counts as in the Bur-0 and Tsu-1 data (<xref ref-type="fig" rid="pone-0060058-g002">Figure 2B</xref>). The efficiency of the search for real SNPs is best close to the k value that maximises the kmer count. Also as before, increasing the depth of search into the graph increases the sensitivity at the cost of false positives. Increasing the depth of sequencing coverage did little to improve the sensitivity or number of false positives with modest gains from 40× to 50× and decreases after that (<xref ref-type="fig" rid="pone-0060058-g003">Figure 3B</xref>). While a basic level of coverage is required to give confidence that bubbles are the result of SNPs and indels in the target organism, increasing the number of reads also increases the amount of error in the data, causing the formation of false bubbles and increasing the complexity of bubbles formed by polymorphisms. The similarity in pattern of results between the ecotypes indicates that the algorithm is robust to differences in input data and behaves reproducibly between sets.</p>
    </sec>
    <sec id="s2d">
      <title>Bubble search and classification is fast</title>
      <p><xref ref-type="supplementary-material" rid="pone.0060058.s001">Table S1</xref> provides demonstrative execution times for assembly of de Bruijn graph, identification of potential SNPs and output of contigs for the Col-0 vs. Tsu-1 experiment. Assembly and classification were carried out on a range of individual machines within a workload managed cluster containing nodes with up to 128 Gb RAM available. The maximum sensitivity searches are complete with mean time 29 h.</p>
    </sec>
    <sec id="s2e">
      <title>Comparisons with existing tools</title>
      <p>Our bubble detection algorithm was designed to detect more complicated bubble structures than the more conservative approach adopted by the Cortex bubble caller. To confirm this was the case, we used the same Bur-0, Tsu-1 and Ler-1 (50×) <italic>Arabidopsis</italic> reads as input to the latest version of Cortex_var (1.0.5.13) and verified the bubbles it output using the same method as for Bubbleparse. At optimal kmer size for each tool, Cortex_var called a lower percentage of the canonical SNPs than Bubbleparse for all values of the Bubbleparse depth parameter (<xref ref-type="fig" rid="pone-0060058-g004">Figure 4</xref>). For Bur-0 and Tsu-1, Cortex_var called around 40% of the canonical SNPs and Bubbleparse was able to locate over 80% at higher search depths. For Ler-1, Cortex_var called 20% of the canonical SNP list, while Bubbleparse called 38% at depth 0 and 53% at depth 2. As previously, this increased ability to find SNPs does bring increased false positives. For Bur-0 and Tsu-1, the false positive rate is comparable for Cortex_var and Bubbleparse, while for Ler-1, Cortex_var produced slightly less false positives (<xref ref-type="supplementary-material" rid="pone.0060058.s007">Figure S3</xref>).</p>
      <fig id="pone-0060058-g004" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0060058.g004</object-id>
        <label>Figure 4</label>
        <caption>
          <title>SNP finding in Cortex_var and Bubbleparse.</title>
          <p>Percentages of canonical SNPs found by Cortex_var (dotted lines) and by Bubbleparse at various search depths (solid lines) for Bur-0, Tsu-1 and Ler-1.</p>
        </caption>
        <graphic xlink:href="pone.0060058.g004"/>
      </fig>
      <p>Because Bubbleparse has been designed for reference-free situations, where a BWA/SamTools approach cannot be applied, comparison with these kinds of reference-based tools is problematic. In the previous section, we used BWA/SamTools derived SNP lists as a canonical set in order to assess Bubbleparse performance. In a separate experiment, we created a simulated mutant of the <italic>E. coli</italic> genome containing 100,000 randomly positioned SNPs. Using SimSeq, a tool created for the Assemblathon project <xref rid="pone.0060058-Earl1" ref-type="bibr">[11]</xref>, we produced 76 nt simulated Illumina reads of the reference <italic>E. coli</italic> and the mutant at approximately 20× coverage and using SimSeq's supplied Illumina GAIIx error profile. Both sets of reads were used as input to Bubbleparse and for comparison, we used BWA/SamTools to call SNPs based on the mutant reads aligned to the original <italic>E. coli</italic> reference. The BWA/SamTools combination was able to locate 86,275 of the SNPs, with only 1 false positive. Bubbleparse located 93,446 of the SNPs, with 12,917 additional false positives (<xref ref-type="supplementary-material" rid="pone.0060058.s008">Figure S4</xref>). This result underlines the ability of Bubbleparse to achieve comprehensive reference-free SNP recall, but also the importance of effectively ranking the SNPs to mitigate the effect of false positives.</p>
    </sec>
    <sec id="s2f">
      <title>A ranking heuristic for the SNPs allows us to maximise the number of real SNPs detected</title>
      <p>The number of bubbles collected in the graph search in all our tests was very large, indicating that the search is effective, but ultimately the numbers are far too large to be useful to an experimenter seeking to make a catalogue of useful SNPs. To allow for the accurate detection of graph structures that represent real SNPs and therefore to make the Bubbleparse results as useful as possible we assessed methods of ranking the bubbles. We collected attributes of the raw input sequence, namely: average coverage of the kmers in the bubble and quality scores given to the polymorphism by the basecalling software (total Q score is obtained by summing the quality values of the first divergent nucleotide of each path through the bubble), and attributes of the structure of the bubbles: the length of the path through the bubble (a bubble with all paths the same length and a path length equal to kmer size indicates a clearer SNP) and total difference (the amount that the mean path coverage percentage differs from an expected coverage %. For example, in a heterozygous vs homozygous experiment, we expect 100% coverage on one path, 0% on the other for the homozygous allele and 50%, 50% for the heterozygous).</p>
      <p>We examined the bubble collections for the Ler-1 50× data at k = 21, search depth = 1, sorted the bubble table by each attribute in turn and calculated the proportion of real SNPs in sets of 100 bubbles, based on comparison with the 1001 genomes list. Arbitrary ranking of the table by the internal index of each bubble (bubble number) provided a baseline for detection of real SNPs throughout the bubble collection, the proportion of real SNPs in this ranking was constant through the bubble collection (<xref ref-type="fig" rid="pone-0060058-g005">Figure 5</xref>) indicating that the internal processing of bubbles prior to applying ranking does not output bubbles representing real or miscalled SNPs preferentially. The sequence based attributes were less useful than the arbitrary ranking at discriminating the real SNPs. When quality alone was used as a ranking metric the first 50,000 bubbles did not contain any real SNPs. From 50000 onwards, there was a steady increase in the accuracy up to a fairly consistent 60% thereafter (<xref ref-type="fig" rid="pone-0060058-g005">Figure 5</xref>). The poor initial accuracy may be an artefact of inflated total Q score due to higher than average kmer coverage such as that caused by sequence repeats. Ranking by coverage was also somewhat inefficient initially and as with the quality metric, there were no real SNPs in the first 50,000 bubbles; again this is likely caused by repeats. After the first 50,000 bubbles, there is erratic performance, with wildy varying highs and lows, which we believe are procedural artefacts due to repeats in the sampled genome and the SNP calling approach used (<xref ref-type="fig" rid="pone-0060058-g005">Figure 5B</xref>). The bubble structure based total difference score was much more effective than the sequence based measures and gave between 40–60% accuracy over the first 0–10,000 SNP calls, significantly higher than the baseline rate given by the match number. We reasoned that by specifying structural properties in our ranking before sequence properties we would preselect for more real SNPs and minimise the impact of repetitive regions, thus we developed a simple heuristic for ranking bubbles, the Bubbleparse ranking heuristic, which makes use of the following in order:</p>
      <fig id="pone-0060058-g005" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0060058.g005</object-id>
        <label>Figure 5</label>
        <caption>
          <title>Efficacy of five different methods for ranking bubbles.</title>
          <p>In the top graph, moving down the ranked tables, groups of 100 bubbles were taken and compared with the canonical set to calculate the percentage of ‘true’ bubbles. In the bottom graph, groups of 1000 bubbles were taken, allowing the majority of the bubbles to be included. Ranking by the Bubbleparse heuristic produces a much higher true positive rate than any of the alternative methods over the top 50,000 SNPs. From around the 100,000 mark, the Bubbleparse line exhibits a saw shape, the peaks of which are caused by the individual constituents of the ranking heuristic. Note, in the top graph, the blue trace (total coverage) is obscured by the green trace, as both are almost 0.</p>
        </caption>
        <graphic xlink:href="pone.0060058.g005"/>
      </fig>
      <list list-type="order">
        <list-item>
          <p><bold>The type classification of a bubble</bold> – determined by the number of colours on each path through the bubble (<xref ref-type="fig" rid="pone-0060058-g001">Figure 1C</xref>). There is a separate ranked list for each bubble type.</p>
        </list-item>
        <list-item>
          <p><bold>Contig length</bold> – a bubble with contig length greater than or equal to the minimum contig length will be ranked higher than one with a contig length lower than the minimum. A minimum contig length is required for effective biological application - for example design of primers.</p>
        </list-item>
        <list-item>
          <p><bold>Equality of path length</bold> - a bubble with all paths the same length will rank higher than one with different path lengths, that is SNPs rank higher than Indels.</p>
        </list-item>
        <list-item>
          <p><bold>Length of path through the bubble</bold> - a bubble with all path lengths equal to kmer size is ranked more highly than one with path lengths not equal to kmer size.</p>
        </list-item>
        <list-item>
          <p><bold>Mean coverage %</bold> - bubbles where the mean coverage through each path is within a specified tolerance of the expected coverage % are ranked more highly than those with coverage outside the tolerance.</p>
        </list-item>
        <list-item>
          <p><bold>Other incomplete paths</bold> - a complete path through the bubble in a given colour is required for that colour to count towards the type classification; however, a partial colour path suggests uncertainty and causes the bubble to be ranked lower than one without any additional partial paths.</p>
        </list-item>
        <list-item>
          <p><bold>Total Q score</bold> - bubbles are ranked on total Q score, obtained by summing the quality values of the first nucleotide (ie. the first divergent nucleotide) of each path through the bubble. If no quality scores are available, this step is omitted.</p>
        </list-item>
        <list-item>
          <p><bold>Combined coverage</bold> – the combined coverage is obtained by summing the mean coverage values of each path through the bubble.</p>
        </list-item>
      </list>
      <p>Accompanying pseudocode for this heuristic can be found in Supporting <xref ref-type="supplementary-material" rid="pone.0060058.s009">Methods S1</xref>. Based on comparison with the 1001 genomes SNP list, the Bubbleparse heuristic was successful at maintaining a very high accuracy of 80–90% SNP detection across the first 10,000 bubbles in our sample set (<xref ref-type="fig" rid="pone-0060058-g005">Figure 5</xref>). As expected, this accuracy rate declines with distance down the list, but a number of peaks can be observed, beginning just after the 100,000 ranked SNP. These are due to the individual components of the ranking heuristic and comprise predicted SNPs which, though having scored highly according to one measure, fail on another. For example, the first peak represents the most highly ranked of the SNPs which were dropped lower because they contained additional incomplete paths through the bubble; the peak illustrates that some of these were still good SNPs of the expected allele frequency, but the rapid drop-off indicates that it was still desirable for the algorithm to demote these bubbles. These discontinuities illustrate that there may still be scope for further optimisation of the ranking methodology in the future – perhaps through the use of machine learning techniques.</p>
      <p>It was not possible to plot a ROC curve for the performance of the heuristic, as we do not make a binary distinction between bubbles due to SNPs and those due to other artefacts - which means that calculating true and false negatives has no meaning. Instead, the top of the ranked list represents bubbles for which there is high confidence that they are SNPs and are linked to the expected heterozygosity, while those at the bottom of the list represent bubbles with a low likelihood of being a real linked SNP.</p>
      <p>To provide further confirmation of the tool's performance, we used Sanger sequencing to test the top 48 Bubbleparse ranked SNPs, as well as 3 sets of 16 SNPs that were placed at the 25%, 50% and 75% boundaries of all SNPs which were in contigs of 200 nt or greater (this length chosen for effective oligo design). We looked to see if the SNPs were in the 1001 genomes list by aligning contigs to the TAIR9 reference. Of the top 48, we were able to locate 39 SNPs in the 1001 genomes list; however, the sequencing successfully confirmed 46 of the SNPs, at the predicted position and with the predicted alleles (<xref ref-type="table" rid="pone-0060058-t001">Table 1</xref>). The remaining 2 results were inconclusive, due to problems with the sequencing or the primers used. 45 of the remaining 48 SNPs placed at 25%, 50% and 75% in the ranked list were also confirmed, with 3 failed sequencing attempts (<xref ref-type="table" rid="pone-0060058-t001">Table 1</xref>). Again there were SNPs confirmed by sequencing which we were unable to find in the curated list.</p>
      <table-wrap id="pone-0060058-t001" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0060058.t001</object-id>
        <label>Table 1</label>
        <caption>
          <title>Results of <italic>Arabidopsis thaliana</italic> Sanger sequencing.</title>
        </caption>
        <alternatives>
          <graphic id="pone-0060058-t001-1" xlink:href="pone.0060058.t001"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col align="left" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <td align="left" rowspan="1" colspan="1">Position in bubbleparse list</td>
                <td align="left" rowspan="1" colspan="1">SNPs sequenced</td>
                <td align="left" rowspan="1" colspan="1">Confirmed SNPs</td>
                <td align="left" rowspan="1" colspan="1">Unconfirmed SNPs</td>
                <td align="left" rowspan="1" colspan="1">Problems with sequencing</td>
                <td align="left" rowspan="1" colspan="1">Number in curated list</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">Top</td>
                <td align="left" rowspan="1" colspan="1">48</td>
                <td align="left" rowspan="1" colspan="1">46</td>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">2</td>
                <td align="left" rowspan="1" colspan="1">39</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">25%</td>
                <td align="left" rowspan="1" colspan="1">16</td>
                <td align="left" rowspan="1" colspan="1">15</td>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">13</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">50%</td>
                <td align="left" rowspan="1" colspan="1">16</td>
                <td align="left" rowspan="1" colspan="1">15</td>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">10</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">75%</td>
                <td align="left" rowspan="1" colspan="1">16</td>
                <td align="left" rowspan="1" colspan="1">15</td>
                <td align="left" rowspan="1" colspan="1">0</td>
                <td align="left" rowspan="1" colspan="1">1</td>
                <td align="left" rowspan="1" colspan="1">11</td>
              </tr>
            </tbody>
          </table>
        </alternatives>
        <table-wrap-foot>
          <fn id="nt101">
            <label/>
            <p>From the ranked list of all SNPs predicted by Bubbleparse in contigs of over 200 nt, the top 48, as well as 16 from 25%, 50% and 75% down the list were tested with Sanger sequencing. This confirmed all but 5 as being real SNPs between Col-0 and Ler-1. The remaining five all had sequencing problems – such as the sequence ending before the SNP was reached – so are not confirmed as false postives.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>We then examined the SNPs that were confirmed by sequencing but which we were not able to find in the curated list. Of these 23 SNPs, we were able to match 14 by relaxing the alignment criteria (Materials and Methods). This left 3 SNPs that we were unable to align to the reference and 6 of the 91 confirmed SNPs, which, though easily aligning to the reference, were not in the curated list. This result leads us to believe that Bubbleparse provides even higher accuracy than that indicated in <xref ref-type="fig" rid="pone-0060058-g005">Figure 5</xref>. Examining the locations of the 6 SNPs not found in the curated list, 4 turned out to be unknown proteins or non-coding genes (<xref ref-type="supplementary-material" rid="pone.0060058.s002">Table S2</xref>). There is insufficient data to draw firm conclusions, but these sorts of regions may contain repetitive elements that made detection of the SNPs harder.</p>
    </sec>
    <sec id="s2g">
      <title>Bubbleparse is a fast and effective tool for detection of resistance-linked SNPs in unsequenced genomes</title>
      <p>In proof-of-principle experiments, we tested the Bubbleparse method with bulked Illumina sequenced normalized cDNA from 30 resistant and 30 susceptible individuals of an F1 population from a cross between <italic>Phytophthora infestans</italic> resistant <italic>Solanum berthaultii</italic> and susceptible <italic>Solanum stenotomum</italic>. These plants were manually scored for resistance and found to have 50% resistance in the bulk resistant population, thus we expected the resistant genotype to be heterozygous and present at roughly 50%. We sequenced each normalized library at approximately 40× coverage (assuming 20,000 genes expressed with average size of 1500 bp and complete normalization). We ran Bubbleparse at a kmer size of 31 and with cleaning options set to remove tips of 100 nodes or less and any node of coverage of only 1. Bubbleparse identified 201,000 SNPs of different patterns of heterozygosity directly from reads (<xref ref-type="fig" rid="pone-0060058-g006">Figure 6</xref>). 68,000 linked SNPs (34 percent of all SNPs) at the expected heterozygosity pattern were found. The ranked result table was inspected and we selected 27 predicted SNPs, according to 4 different sets of criteria, for verification with Sanger sequencing. The first 10 of these SNPs were taken from the top of the Bubbleparse ranked list, representing SNPs with coverage ratios close to the expected heterozygosity and high absolute coverage; the remaining three groups were chosen from lower down the ranked list (within the top 22,000 out of the 68,000 linked SNPs at the expected heterozygosity) and were chosen because, while not presenting optimal results for all ranking parameters, they displayed either a close match to the expected ratio, high coverage, or high total quality score. Overall, 23 out of 27 (&gt;85%) were confirmed as SNPs with 14 out of 27 as heterozygous SNPs directly linked to the resistant trait (<xref ref-type="table" rid="pone-0060058-t002">Table 2</xref>), giving us a set of verified trait-linked SNPs in a straightforward analysis. Despite the small number of candidate SNPs we were resourced to analyse experimentally, validating more than 50% true positives across the different ranking priorities in this simple proof-of-principle experiment provides a strong indication that the method we present is effective. Interestingly, in our plant experiments we were unable to reliably identify short indels; theoretically indels should manifest as bubbles with branches of differing lengths, and although these could be found in the graph we were very rarely able to confirm them as real in subsequent sequencing experiments. This may indicate that the graph around indels is more difficult to search than that around SNPs.</p>
      <fig id="pone-0060058-g006" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0060058.g006</object-id>
        <label>Figure 6</label>
        <caption>
          <title>Types of <italic>Solanum</italic> SNPs discovered by Bubbleparse.</title>
          <p>Graph showing the types of SNPs discovered by Bubbleparse for the cross between <italic>Phytophthora infestans</italic> resistant <italic>Solanum berthaultii</italic> and susceptible <italic>Solanum stenotomum</italic>. Because of the nature of the cross, we expect to find heterozygous resistance-linked SNPs and Bubbleparse produced a list of 68,084 of these, from which we selected 27 for sequencing.</p>
        </caption>
        <graphic xlink:href="pone.0060058.g006"/>
      </fig>
      <table-wrap id="pone-0060058-t002" orientation="portrait" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pone.0060058.t002</object-id>
        <label>Table 2</label>
        <caption>
          <title>Results of <italic>Solanum</italic> Sanger sequencing.</title>
        </caption>
        <alternatives>
          <graphic id="pone-0060058-t002-2" xlink:href="pone.0060058.t002"/>
          <table frame="hsides" rules="groups">
            <colgroup span="1">
              <col align="left" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
              <col align="center" span="1"/>
            </colgroup>
            <thead>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td colspan="3" align="left" rowspan="1">Type of SNP confirmed</td>
                <td align="left" rowspan="1" colspan="1"/>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1"/>
                <td align="left" rowspan="1" colspan="1">Heterozygous linked SNP</td>
                <td align="left" rowspan="1" colspan="1">Heterozygous unlinked SNP</td>
                <td align="left" rowspan="1" colspan="1">Homozygous SNP</td>
                <td align="left" rowspan="1" colspan="1">Total</td>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <bold>Maximise ratio and coverage</bold>
                </td>
                <td align="left" rowspan="1" colspan="1"><sup>5</sup>/<sub>10</sub></td>
                <td align="left" rowspan="1" colspan="1"><sup>4</sup>/<sub>10</sub></td>
                <td align="left" rowspan="1" colspan="1"><sup>1</sup>/<sub>10</sub></td>
                <td align="left" rowspan="1" colspan="1"><sup>10</sup>/<sub>10</sub></td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <bold>Maximise ratio</bold>
                </td>
                <td align="left" rowspan="1" colspan="1"><sup>2</sup>/<sub>6</sub></td>
                <td align="left" rowspan="1" colspan="1"><sup>2</sup>/<sub>6</sub></td>
                <td align="left" rowspan="1" colspan="1">-</td>
                <td align="left" rowspan="1" colspan="1"><sup>4</sup>/<sub>6</sub></td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <bold>Maximise coverage</bold>
                </td>
                <td align="left" rowspan="1" colspan="1"><sup>5</sup>/<sub>6</sub></td>
                <td align="left" rowspan="1" colspan="1"><sup>1</sup>/<sub>6</sub></td>
                <td align="left" rowspan="1" colspan="1">-</td>
                <td align="left" rowspan="1" colspan="1"><sup>6</sup>/<sub>6</sub></td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <bold>High total quality score</bold>
                </td>
                <td align="left" rowspan="1" colspan="1"><sup>2</sup>/<sub>5</sub></td>
                <td align="left" rowspan="1" colspan="1"><sup>1</sup>/<sub>5</sub></td>
                <td align="left" rowspan="1" colspan="1">-</td>
                <td align="left" rowspan="1" colspan="1"><sup>3</sup>/<sub>5</sub></td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">
                  <bold>Total</bold>
                </td>
                <td align="left" rowspan="1" colspan="1"><sup>14</sup>/<sub>27</sub></td>
                <td align="left" rowspan="1" colspan="1"><sup>8</sup>/<sub>27</sub></td>
                <td align="left" rowspan="1" colspan="1"><sup>1</sup>/<sub>27</sub></td>
                <td align="left" rowspan="1" colspan="1"><sup>23</sup>/<sub>27</sub></td>
              </tr>
            </tbody>
          </table>
        </alternatives>
        <table-wrap-foot>
          <fn id="nt102">
            <label/>
            <p>We chose 27 predicted SNPs to test with Sanger sequencing. These were chosen from the Bubbleparse ranked list according to four sets of criteria, with all SNPs placed within the top 22,000 of the 68,000 linked SNPs at the expected heterozygosity. The largest number, 10, were chosen from the top of the list, which contains bubbles which are close to the expected allele ratio and also of high coverage. A second group were chosen which were very close to the expected allele ratio, but not such good coverage. A third group had very good coverage, but were not so close to the expect allele ratio. Finally, a fourth group was chosen which had high quality scores, but not necessarily as close a ratio or as good a coverage as previous groups. Overall, we found a high rate of true SNPs – with 23 out of 27 sequences containing a SNP in the position predicted by Bubbleparse, of which 14 displayed the predicted heterozygous alleles. The group chosen from the top of the ranked list showed high accuracy, with 9 out of 10 SNPs confirmed, but high rates were also shown for the other groups, though sample sizes were small.</p>
          </fn>
        </table-wrap-foot>
      </table-wrap>
      <p>Our benchmarking and real data analyses show that Bubbleparse is a very fast and sensitive tool for creating catalogues of SNPs in a simple analysis in very short time frames. The experiment ran quickly so that in around 24 hrs, we were able to go from brand new Illumina sequence read data to a high quality set of heterozygous SNPs linked to a trait of agronomic importance that could be used as markers in downstream analyses. The Bubbleparse ranking scheme gives the tool extra discriminative power enabling us to find SNPs with very high accuracy, at levels that are easily comparable and competitive with alignment based methods for the examined classes of SNPs. The ranking is prioritised here for finding SNPs in the bubble collection of expected homo-/heterozygosity patterns but the Bubbleparse output is verbose and bubbles can easily be re-ranked for other purposes. This would make it possible to investigate alternative algorithms for ranking, perhaps based upon machine learning techniques, and in so doing, seek to remove the discontinuities found in the <italic>Arabidopsis</italic> ranking graphs reported in <xref ref-type="fig" rid="pone-0060058-g005">Figure 5</xref>. The flexibility of Bubbleparse makes it useful for a wide range of genetic backgrounds and sample types including complex crosses, multi-population samples and environmental metagenomes.</p>
      <p>The Bubbleparse source code can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/richardmleggett/bubbleparse">https://github.com/richardmleggett/bubbleparse</ext-link>.</p>
    </sec>
  </sec>
  <sec sec-type="materials|methods" id="s3">
    <title>Materials and Methods</title>
    <sec id="s3a">
      <title>Validation of <italic>Arabidopsis thaliana</italic> predicted SNPs</title>
      <p>The validation of the Bubbleparse predicted SNPs was performed using PCR amplification and Sanger sequencing. We designed oligos (<xref ref-type="supplementary-material" rid="pone.0060058.s003">Table S3</xref>) to match locations where SNPs were predicted.. 40 ng of total genomic DNA of <italic>Arabidopsis thaliana</italic> strains Col-0 and Ler-1 were used in a PCR reaction (94°C 30 seconds, 53°C 35 seconds, 72°C 60 seconds, 35 cycles) with non-proofreading DNA polymerase. 2 µl of the clean PCR reaction (∼20 ng) was used in the Sanger sequencing with either a forward or reverse sequence oligo. The chromatograms were analysed using the program DNASTAR Lasergene version 8.</p>
      <p>To compare these SNPs with the curated list, we aligned the contigs to the TAIR9 reference genome using BLAST, looking for matches of 98% identity and 98% length. For the subsequent investigation into SNPs that were confirmed, but could not be found in the curated list, we relaxed the alignment criteria to 93% identity and 93% length in order to find the additional matches. Further relaxation of alignment criteria did not produce further matches.</p>
    </sec>
    <sec id="s3b">
      <title>Potato plant material</title>
      <p>We used 30 resistant and 30 susceptible plants from a cross between diploid parents, a resistant <italic>Solanum berthaulltii</italic> (PI1477731) <xref rid="pone.0060058-Rauscher1" ref-type="bibr">[12]</xref> (Rauscher <italic>et al.</italic>, 2006) and a susceptible <italic>Solanum stenotomum</italic> (CGN19035).</p>
    </sec>
    <sec id="s3c">
      <title>Potato sample preparation</title>
      <p>Total RNA was extracted from two young leaves of each resistant and each susceptible plant by using TRIzol reagent (Invitrogen) from which 2.5 µg total RNA of each individual was bulked up to generate a bulked resistant (BR) and a bulked susceptible (BS) sample. PolyA+ RNA was extracted (Invitrogen) and double stranded cDNA (ds cDNA) was generated by using a SMART cDNA library kit (Clonetech). Next, we normalized the cDNA (duplex-specific nuclease, Evrogen) and after <italic>Sfi</italic>I (New England Biolabs) digestion, we selected fragments (&gt;500 nt) with Chroma Spin 1000 columns. In order to prepare the samples for Illumina sequencing, we acoustically sheared the cDNA to fragments of average 200 bp (Covaris, settings: Duty cycle 20%, Intensity 5, cycles per burst 200, time 120 seconds) and ligated adapters to the fragments (Paired-End DNA Sample Prep Kit, Illumina). Subsequently, we size selected fragments (5% polyacrylamide gel) of 300 bp that were sequenced on the Illumina machine (76 nt read, paired-end). All methods were according the manufacturers protocols.</p>
    </sec>
    <sec id="s3d">
      <title>Validation of predicted potato SNPs</title>
      <p>To validate the outcome of the Bubbleparse SNP prediction, we designed oligos to match locations where a SNP was predicted (<xref ref-type="supplementary-material" rid="pone.0060058.s004">Table S4</xref>). 1 ng of ds cDNA, generated with the SMART cDNA library, was used in a PCR reaction (94°C for 30 seconds, 55°C for 30 seconds, 72°C 60 seconds, 35 cycles) with non-proofreading DNA polymerase and 1 µl of the reaction (5–10 ng) was used in Sanger sequencing with either a forward or reverse sequence oligo. The chromatograms were analyzed in VNTI ContigExpress (<xref ref-type="supplementary-material" rid="pone.0060058.s006">Figure S2</xref>).</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material" id="s4">
    <title>Supporting Information</title>
    <supplementary-material content-type="local-data" id="pone.0060058.s001">
      <label>Table S1</label>
      <caption>
        <p><bold>Speed of execution.</bold> The table provides typical execution times for assembly of de Bruijn graph, identification of potential SNPs and output of contigs for the Col-0 vs. Tsu-1 experiment. Times are for illustration only, as assemblies were carried out on a range of individual machines within a workload managed cluster. Increased numbers of kmers result in larger graphs, requiring more processing time to walk them. Increased levels of depth mean the bubble finding algorithm explores a much larger portion of the graph around a bubble, also resulting in increased execution time.</p>
        <p>(DOC)</p>
      </caption>
      <media xlink:href="pone.0060058.s001.doc">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0060058.s002">
      <label>Table S2</label>
      <caption>
        <p><bold>Sequenced SNPs not in the 1001 genomes list.</bold> For SNPs that were confirmed by Sanger sequencing, but not in the 1001 genomes list, the table shows the position of alignment to the TAIR9 reference, as well as loci from the TAIR browser at <ext-link ext-link-type="uri" xlink:href="http://www.arabidopsis.org">www.arabidopsis.org</ext-link>.</p>
        <p>(DOC)</p>
      </caption>
      <media xlink:href="pone.0060058.s002.doc">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0060058.s003">
      <label>Table S3</label>
      <caption>
        <p>
          <bold>
            <italic>Arabidopsis thaliana</italic>
          </bold>
          <bold> experiment oligos.</bold>
        </p>
        <p>(DOC)</p>
      </caption>
      <media xlink:href="pone.0060058.s003.doc">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0060058.s004">
      <label>Table S4</label>
      <caption>
        <p>
          <bold>
            <italic>Solanum berthaultii</italic>
          </bold>
          <bold> experiment oligos.</bold>
        </p>
        <p>(DOC)</p>
      </caption>
      <media xlink:href="pone.0060058.s004.doc">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0060058.s005">
      <label>Figure S1</label>
      <caption>
        <p>
          <bold>Kmer counts for different values of k in the Bur-0 and Tsu-1 datasets.</bold>
        </p>
        <p>(TIFF)</p>
      </caption>
      <media xlink:href="pone.0060058.s005.tif">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0060058.s006">
      <label>Figure S2</label>
      <caption>
        <p><bold>Chromatograms for </bold><bold><italic>Solanum berthaultii</italic></bold><bold> experiment.</bold> Typical chromatograms from Sanger sequencing confirmation of SNPs. In each case, the top graph represents the resistant bulk cDNA, the bottom graph the susceptible bulk cDNA and dotted lines indicate the predicted SNP location. (A) An example of a linked heterozygous SNP, with the resistant showing both a C and a G at the SNP position, while the susceptible shows only a G. (B) An example of an unlinked heterozygous SNP, where both resistant and susceptible show a C and a G at the SNP position. (C) An example homozygous SNP, with the resistant and susceptible each showing a single, different, nucleotide. (D) An example of an unconfirmed SNP, where there is no apparent nucleotide difference at the predicted SNP position.</p>
        <p>(TIFF)</p>
      </caption>
      <media xlink:href="pone.0060058.s006.tiff">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0060058.s007">
      <label>Figure S3</label>
      <caption>
        <p><bold>SNP finding compared in Cortex_var and Bubbleparse.</bold> Graphs showing percentage of canonical SNPs found and the percentage of predicted SNPs confirmed for Bubbleparse (BP, solid lines) at a range of search depths (d = 0,1,2,3) and Cortex_var (CV, dotted lines). (A) Bur-0 results for minimum BWA/SamTools pileup of 10 (left hand column) and 20 (right hand column). (B) Tsu-1 results for minimum pileup of 10 (left hand column) and 20 (right hand column). (C) For Ler-1, a curated SNP list was available, so only one column.</p>
        <p>(TIFF)</p>
      </caption>
      <media xlink:href="pone.0060058.s007.tiff">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0060058.s008">
      <label>Figure S4</label>
      <caption>
        <p><bold>Bubbleparse SNP recall for synthetic </bold><bold><italic>E. coli</italic></bold><bold>.</bold> Graph showing percentage of SNPs found by bubbleparse, percentage of true positive SNPs output by bubbleparse and percentage of false positive SNPs output for a simulated <italic>E.coli</italic> dataset. Input was a set of simulated reads from the <italic>E. coli</italic> genome and a second set of simulated reads from an <italic>E. coli</italic> genome containing 100,000 simulated SNPs. Both sets of reads were designed to mimic 76 nt Illumina reads of approximately 20× coverage. Bubbleparse was run with minimal cleaning (removing paths of coverage 1 or less and tips of 100 nodes or less) and search depth 1.</p>
        <p>(TIFF)</p>
      </caption>
      <media xlink:href="pone.0060058.s008.tiff">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0060058.s009">
      <label>Methods S1</label>
      <caption>
        <p>
          <bold>Implementation of bubbleparse heuristic.</bold>
        </p>
        <p>(DOC)</p>
      </caption>
      <media xlink:href="pone.0060058.s009.doc">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material content-type="local-data" id="pone.0060058.s010">
      <label>Methods S2</label>
      <caption>
        <p>
          <bold>Variation of coverage for Ler-1 experiments.</bold>
        </p>
        <p>(DOC)</p>
      </caption>
      <media xlink:href="pone.0060058.s010.doc">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>The authors are very grateful to the help of E.R Ward and B.H Wulff for their support.</p>
  </ack>
  <ref-list>
    <title>References</title>
    <ref id="pone.0060058-Pevzner1">
      <label>1</label>
      <mixed-citation publication-type="journal"><name><surname>Pevzner</surname><given-names>PA</given-names></name>, <name><surname>Tang</surname><given-names>H</given-names></name>, <name><surname>Waterman</surname><given-names>MS</given-names></name> (<year>2001</year>) <article-title>An Eulerian path approach to DNA fragment assembly</article-title>. <source>Proc Natl Acad Sci U S A</source>
<volume>98(17)</volume>: <fpage>9748</fpage>–<lpage>9753</lpage>.<pub-id pub-id-type="pmid">11504945</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Zerbino1">
      <label>2</label>
      <mixed-citation publication-type="journal"><name><surname>Zerbino</surname><given-names>DR</given-names></name>, <name><surname>Birney</surname><given-names>E</given-names></name> (<year>2008</year>) <article-title>Velvet: algorithms for <italic>de novo</italic> short read assembly using de Bruijn graphs</article-title>. <source>Genome Res</source>
<volume>18(5)</volume>: <fpage>821</fpage>–<lpage>829</lpage>.<pub-id pub-id-type="pmid">18349386</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Simpson1">
      <label>3</label>
      <mixed-citation publication-type="journal"><name><surname>Simpson</surname><given-names>JT</given-names></name>, <name><surname>Wong</surname><given-names>K</given-names></name>, <name><surname>Jackman</surname><given-names>SD</given-names></name>, <name><surname>Schein</surname><given-names>JE</given-names></name>, <name><surname>Jones</surname><given-names>SJM</given-names></name>, <name><surname>Birol</surname><given-names>I</given-names></name> (<year>2009</year>) <article-title>ABySS: a parallel assembler for short read sequence data</article-title>. <source>Genome Res</source>
<volume>19(6)</volume>: <fpage>1117</fpage>–<lpage>1123</lpage>.<pub-id pub-id-type="pmid">19251739</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Peterlongo1">
      <label>4</label>
      <mixed-citation publication-type="other">Peterlongo P, Schnel N, Pisanti N, Sagot MF, Lacroix V (2010) Identifying SNPs without a Reference Genome by Comparing Raw Reads. In Proceedings of the 17th international conference on String processing and information retrieval. pp. 147–158.</mixed-citation>
    </ref>
    <ref id="pone.0060058-Catchen1">
      <label>5</label>
      <mixed-citation publication-type="journal"><name><surname>Catchen</surname><given-names>J</given-names></name>, <name><surname>Amores</surname><given-names>A</given-names></name>, <name><surname>Hohenlohe</surname><given-names>P</given-names></name>, <name><surname>Cresko</surname><given-names>W</given-names></name>, <name><surname>Postlethwait</surname><given-names>J</given-names></name> (<year>2011</year>) <article-title>Stacks: building and genotyping loci <italic>de novo</italic> from short-read sequences</article-title>. <source>G3 (Bethesda)</source>
<volume>1</volume>: <fpage>171</fpage>–<lpage>182</lpage>.<pub-id pub-id-type="pmid">22384329</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Iqbal1">
      <label>6</label>
      <mixed-citation publication-type="journal"><name><surname>Iqbal</surname><given-names>Z</given-names></name>, <name><surname>Caccamo</surname><given-names>M</given-names></name>, <name><surname>Turner</surname><given-names>I</given-names></name>, <name><surname>Flicek</surname><given-names>P</given-names></name>, <name><surname>McVean</surname><given-names>G</given-names></name> (<year>2012</year>) <article-title><italic>De novo</italic> assembly and genotyping of variants using colored de Bruijn graphs</article-title>. <source>Nat Genet</source>
<volume>44(2)</volume>: <fpage>226</fpage>–<lpage>232</lpage>.<pub-id pub-id-type="pmid">22231483</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Li1">
      <label>7</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>H</given-names></name>, <name><surname>Durbin</surname><given-names>R</given-names></name> (<year>2009</year>) <article-title>Fast and accurate short read alignment with Burrows-Wheeler transform</article-title>. <source>Bioinformatics</source>
<volume>25</volume>: <fpage>1754</fpage>–<lpage>60</lpage>.<pub-id pub-id-type="pmid">19451168</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Li2">
      <label>8</label>
      <mixed-citation publication-type="journal"><name><surname>Li</surname><given-names>H</given-names></name>, <name><surname>Handsaker</surname><given-names>B</given-names></name>, <name><surname>Wysoker</surname><given-names>A</given-names></name>, <name><surname>Fennell</surname><given-names>T</given-names></name>, <name><surname>Ruan</surname><given-names>J</given-names></name>, <etal>et al</etal> (<year>2009</year>) <article-title>The Sequence Alignment/Map format and SAMtools</article-title>. <source>Bioinformatics</source>
<volume>25</volume>: <fpage>2078</fpage>–<lpage>2079</lpage>.<pub-id pub-id-type="pmid">19505943</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Altschul1">
      <label>9</label>
      <mixed-citation publication-type="journal"><name><surname>Altschul</surname><given-names>SF</given-names></name>, <name><surname>Gish</surname><given-names>W</given-names></name>, <name><surname>Miller</surname><given-names>W</given-names></name>, <name><surname>Myers</surname><given-names>EW</given-names></name>, <name><surname>Lipman</surname><given-names>DJ</given-names></name> (<year>1990</year>) <article-title>Basic local alignment search tool</article-title>. <source>J Mol Biol</source>
<volume>215(3)</volume>: <fpage>403</fpage>–<lpage>10</lpage>.<pub-id pub-id-type="pmid">2231712</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Schneeberger1">
      <label>10</label>
      <mixed-citation publication-type="journal"><name><surname>Schneeberger</surname><given-names>K</given-names></name>, <name><surname>Ossowski</surname><given-names>S</given-names></name>, <name><surname>Ott</surname><given-names>F</given-names></name>, <name><surname>Klein</surname><given-names>JD</given-names></name>, <name><surname>Wang</surname><given-names>X</given-names></name>, <etal>et al</etal> (<year>2011</year>) <article-title>Reference-guided assembly of four diverse <italic>Arabidopsis thaliana</italic> genomes</article-title>. <source>Proc Natl Acad Sci U S A</source>
<volume>108(25)</volume>: <fpage>10249</fpage>–<lpage>10254</lpage>.<pub-id pub-id-type="pmid">21646520</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Earl1">
      <label>11</label>
      <mixed-citation publication-type="journal"><name><surname>Earl</surname><given-names>D</given-names></name>, <name><surname>Bradnam</surname><given-names>K</given-names></name>, <name><surname>St John</surname><given-names>J</given-names></name>, <name><surname>Darling</surname><given-names>A</given-names></name>, <name><surname>Lin</surname><given-names>D</given-names></name>, <etal>et al</etal> (<year>2011</year>) <article-title>Assemblathon 1: A competitive assessment of de novo short read assembly methods</article-title>. <source>Genome Res</source>
<volume>21</volume>: <fpage>2224</fpage>–<lpage>2241</lpage>.<pub-id pub-id-type="pmid">21926179</pub-id></mixed-citation>
    </ref>
    <ref id="pone.0060058-Rauscher1">
      <label>12</label>
      <mixed-citation publication-type="journal"><name><surname>Rauscher</surname><given-names>GM</given-names></name>, <name><surname>Smart</surname><given-names>CD</given-names></name>, <name><surname>Simko</surname><given-names>I</given-names></name>, <name><surname>Bonierbale</surname><given-names>M</given-names></name>, <name><surname>Mayton</surname><given-names>H</given-names></name>, <etal>et al</etal><article-title>Characterization and mapping of Rpi-ber, a novel potato late blight resistance gene from <italic>Solanum berthaultii</italic>
</article-title>. <source>Theor Appl Genet</source><volume>112</volume>: <fpage>674</fpage>–<lpage>687</lpage>.<pub-id pub-id-type="pmid">16402191</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
