<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName nlm2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Front Genet</journal-id>
    <journal-id journal-id-type="iso-abbrev">Front Genet</journal-id>
    <journal-id journal-id-type="publisher-id">Front. Genet.</journal-id>
    <journal-title-group>
      <journal-title>Frontiers in Genetics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1664-8021</issn>
    <publisher>
      <publisher-name>Frontiers Media S.A.</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10232864</article-id>
    <article-id pub-id-type="publisher-id">1175603</article-id>
    <article-id pub-id-type="doi">10.3389/fgene.2023.1175603</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Genetics</subject>
        <subj-group>
          <subject>Original Research</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SPARTIN: a Bayesian method for the quantification and characterization of cell type interactions in spatial pathology data</article-title>
      <alt-title alt-title-type="left-running-head">Osher et al.</alt-title>
      <alt-title alt-title-type="right-running-head">
        <ext-link xlink:href="https://doi.org/10.3389/fgene.2023.1175603" ext-link-type="uri">10.3389/fgene.2023.1175603</ext-link>
      </alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Osher</surname>
          <given-names>Nathaniel</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="c001" ref-type="corresp">*</xref>
        <uri xlink:href="https://loop.frontiersin.org/people/2213637/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kang</surname>
          <given-names>Jian</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/148472/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Krishnan</surname>
          <given-names>Santhoshi</given-names>
        </name>
        <xref rid="aff2" ref-type="aff">
          <sup>2</sup>
        </xref>
        <xref rid="aff3" ref-type="aff">
          <sup>3</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/1470327/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rao</surname>
          <given-names>Arvind</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="aff2" ref-type="aff">
          <sup>2</sup>
        </xref>
        <xref rid="aff3" ref-type="aff">
          <sup>3</sup>
        </xref>
        <xref rid="aff4" ref-type="aff">
          <sup>4</sup>
        </xref>
        <xref rid="aff5" ref-type="aff">
          <sup>5</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/1177294/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Baladandayuthapani</surname>
          <given-names>Veerabhadran</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="aff2" ref-type="aff">
          <sup>2</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff1"><sup>1</sup><institution>Department of Biostatistics</institution>, <institution>University of Michigan</institution>, <addr-line>Ann Arbor</addr-line>, <addr-line>MI</addr-line>, <country>United States</country></aff>
    <aff id="aff2"><sup>2</sup><institution>Department of Computational Medicine and Bioinformatics</institution>, <institution>University of Michigan</institution>, <addr-line>Ann Arbor</addr-line>, <addr-line>MI</addr-line>, <country>United States</country></aff>
    <aff id="aff3"><sup>3</sup><institution>Department of Electrical and Computer Engineering</institution>, <institution>Rice University</institution>, <addr-line>Houston</addr-line>, <addr-line>TX</addr-line>, <country>United States</country></aff>
    <aff id="aff4"><sup>4</sup><institution>Department of Radiation Oncology</institution>, <institution>University of Michigan</institution>, <addr-line>Ann Arbor</addr-line>, <addr-line>MI</addr-line>, <country>United States</country></aff>
    <aff id="aff5"><sup>5</sup><institution>Department of Biomedical Engineering</institution>, <institution>University of Michigan</institution>, <addr-line>Ann Arbor</addr-line>, <addr-line>MI</addr-line>, <country>United States</country></aff>
    <author-notes>
      <fn fn-type="edited-by">
        <p><bold>Edited by:</bold><ext-link xlink:href="https://loop.frontiersin.org/people/258592/overview" ext-link-type="uri">Himel Mallick</ext-link>, Cornell University, United States</p>
      </fn>
      <fn fn-type="edited-by">
        <p><bold>Reviewed by:</bold><ext-link xlink:href="https://loop.frontiersin.org/people/2125109/overview" ext-link-type="uri">Boyu Ren</ext-link>, McLean Hospital, United States</p>
        <p><ext-link xlink:href="https://loop.frontiersin.org/people/2123252/overview" ext-link-type="uri">Federico Ferrari</ext-link>, Merck, United States</p>
        <p><ext-link xlink:href="https://loop.frontiersin.org/people/2200778/overview" ext-link-type="uri">Piyali Basak</ext-link>, Merck, United States</p>
      </fn>
      <corresp id="c001">*Correspondence: Nathaniel Osher, <email>oshern@umich.edu</email>
</corresp>
    </author-notes>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>1175603</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>2</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>25</day>
        <month>4</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2023 Osher, Kang, Krishnan, Rao and Baladandayuthapani.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <copyright-holder>Osher, Kang, Krishnan, Rao and Baladandayuthapani</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License (CC BY). The use, distribution or reproduction in other forums is permitted, provided the original author(s) and the copyright owner(s) are credited and that the original publication in this journal is cited, in accordance with accepted academic practice. No use, distribution or reproduction is permitted which does not comply with these terms.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Introduction:</bold> The acquisition of high-resolution digital pathology imaging data has sparked the development of methods to extract context-specific features from such complex data. In the context of cancer, this has led to increased exploration of the tumor microenvironment with respect to the presence and spatial composition of immune cells. Spatial statistical modeling of the immune microenvironment may yield insights into the role played by the immune system in the natural development of cancer as well as downstream therapeutic interventions.</p>
      <p><bold>Methods:</bold> In this paper, we present SPatial Analysis of paRtitioned Tumor-Immune imagiNg (SPARTIN), a Bayesian method for the spatial quantification of immune cell infiltration from pathology images. SPARTIN uses Bayesian point processes to characterize a novel measure of local tumor-immune cell interaction, Cell Type Interaction Probability (CTIP). CTIP allows rigorous incorporation of uncertainty and is highly interpretable, both within and across biopsies, and can be used to assess associations with genomic and clinical features.</p>
      <p><bold>Results:</bold> Through simulations, we show SPARTIN can accurately distinguish various patterns of cellular interactions as compared to existing methods. Using SPARTIN, we characterized the local spatial immune cell infiltration within and across 335 melanoma biopsies and evaluated their association with genomic, phenotypic, and clinical outcomes. We found that CTIP was significantly (negatively) associated with deconvolved immune cell prevalence scores including CD8+ T-Cells and Natural Killer cells. Furthermore, average CTIP scores differed significantly across previously established transcriptomic classes and significantly associated with survival outcomes.</p>
      <p><bold>Discussion:</bold> SPARTIN provides a general framework for investigating spatial cellular interactions in high-resolution digital histopathology imaging data and its associations with patient level characteristics. The results of our analysis have potential implications relevant to both treatment and prognosis in the context of Skin Cutaneous Melanoma. The R-package for SPARTIN is available at <ext-link xlink:href="https://github.com/bayesrx/SPARTIN" ext-link-type="uri">https://github.com/bayesrx/SPARTIN</ext-link> along with a visualization tool for the images and results at: <ext-link xlink:href="https://nateosher.github.io/SPARTIN" ext-link-type="uri">https://nateosher.github.io/SPARTIN</ext-link>.</p>
    </abstract>
    <kwd-group>
      <kwd>Bayesian modeling</kwd>
      <kwd>digital pathology</kwd>
      <kwd>hierarchical strauss models</kwd>
      <kwd>spatial point processes</kwd>
      <kwd>tumor-immune microenvironments</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source id="cn001">
          <institution-wrap>
            <institution>National Institutes of Health
</institution>
            <institution-id institution-id-type="doi">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn001">R01CA244845-01A1 R01DA048993 P30 CA46592 R01MH105561 R01GM124061</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn003">
          <institution-wrap>
            <institution>National Cancer Institute
</institution>
            <institution-id institution-id-type="doi">10.13039/100000054</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn003">5 P30 CA046592 R37-CA214955 5T32CA083654-18</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn005">
          <institution-wrap>
            <institution>American Cancer Society
</institution>
            <institution-id institution-id-type="doi">10.13039/100000048</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn005">RSG-16-005-01</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn008">
          <institution-wrap>
            <institution>Division of Mathematical Sciences
</institution>
            <institution-id institution-id-type="doi">10.13039/100000121</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn008">1463233</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn009">
          <institution-wrap>
            <institution>Division of Information and Intelligent Systems
</institution>
            <institution-id institution-id-type="doi">10.13039/100000145</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn009">2123777</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn002">
          <institution-wrap>
            <institution>Rogel Cancer Center, University of Michigan
</institution>
            <institution-id institution-id-type="doi">10.13039/100017065</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group>
        <funding-source id="cn004">
          <institution-wrap>
            <institution>Agilent Technologies
</institution>
            <institution-id institution-id-type="doi">10.13039/100004322</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group>
        <funding-source id="cn006">
          <institution-wrap>
            <institution>Michigan Institute for Data Science, University of Michigan
</institution>
            <institution-id institution-id-type="doi">10.13039/100015711</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group>
        <funding-source id="cn007">
          <institution-wrap>
            <institution>University of Michigan
</institution>
            <institution-id institution-id-type="doi">10.13039/100007270</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <funding-statement>VB was supported by NIH grants R01CA244845-01A1, and P30 CA46592 (Cancer Data Science Shared Resource), NSF grant 1463233, and start-up funds from the U-M Rogel Cancer Center and School of Public Health. JK was supported by NIH grants R01DA048993, R01MH105561 and R01GM124061 and NSF grant IIS2123777. AR and SK were supported by CCSG Bioinformatics Shared Resource 5 P30 CA046592, a gift from Agilent technologies, a Research Scholar Grant from the American Cancer Society (RSG-16-005-01), a Precision health Investigator award from U-M Precision Health to AR along with L. Rozek and M. Sartor, and a University of Michigan MIDAS PODS Grant. SK, VB, and AR were partially supported by the NCI Grant R37-CA214955. SK and AR were also partially supported by The University of Michigan (U-M) startup institutional research funds. NO was supported by the cancer biostatistical training grant #5T32CA083654-18.</funding-statement>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>section-at-acceptance</meta-name>
        <meta-value>Computational Genomics</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="s1">
    <title>1 Introduction</title>
    <p>While the staining and examination of tissue samples has been a ubiquitous medical practice for decades, it has only been relatively recently that high-resolution pathology images of such stainings have begun to be explored through the lens of formal quantitative models (<xref rid="B22" ref-type="bibr">Heindl et al., 2015</xref>). A considerable amount of work has thus far been put into building and training statistical and machine learning models capable of accurate classifications of overall tissue samples as well as subsections of tissue samples (<xref rid="B4" ref-type="bibr">Amgad et al., 2019</xref>; <xref rid="B33" ref-type="bibr">Lu et al., 2020</xref>; <xref rid="B13" ref-type="bibr">Bian et al., 2021</xref>; <xref rid="B36" ref-type="bibr">Negahbani et al., 2021</xref>). In the context of cancer this work, often referred to as <italic>Histopathological Image Analysis</italic> or <italic>Digital Pathology</italic>, encompasses a broad collection of methods and goals ranging from developing models to assist in the quantitative scoring and staging of cancer biopsies to the classification of cells in tumor biopsies (<xref rid="B30" ref-type="bibr">Komura and Ishikawa, 2018</xref>). The value of these methods have important implications for basic science and translational research. Given the precision with which such algorithms can assess biopsies at a cellular level, it is now possible to uncover structures and associations which might not immediately apparent to human pathologists. This degree of precision also allows for rigorous modeling and examination of intratumoral heterogeneity with respect to their genomic determinants and clinical characteristics (<xref rid="B25" ref-type="bibr">Saltz et al., 2018</xref>; <xref rid="B32" ref-type="bibr">Li et al., 2019a</xref>).</p>
    <p>Several research works in the past decade provide evidence regarding the importance of this line of investigation, especially for quantifying tumor-immune cellular interactions in cancer. <xref rid="B39" ref-type="bibr">Pagès et al. (2010)</xref> proposed immune reaction as the seventh hallmark of cancer, and laid out different associations between various types of immune cells and outcomes of interest. Among the different types of immune cells, the most well-studied are lymphocytes. Lymphocyte infiltration is both a meaningful prognostic indicator that can help inform treatment and predict survival across different types of cancer, including in colorectal cancer (<xref rid="B24" ref-type="bibr">Idos et al., 2020</xref>), breast cancer (<xref rid="B15" ref-type="bibr">Denkert et al., 2015</xref>; <xref rid="B16" ref-type="bibr">Dieci et al., 2018</xref>), and melanoma (<xref rid="B19" ref-type="bibr">Fu et al., 2019</xref>). This has led to increased interest in computational Tumor Infiltrating Lymphocyte (TIL) assessment, a sub-field of digital pathology devoted to developing computational methods to assess lymphocyte infiltration in biopsy images. Thus far, results that have emerged from this research have provided additional evidence regarding the importance of tumor infiltrating lymphocytes and their spatial features in the assessment of pathology images. <xref rid="B25" ref-type="bibr">Saltz et al. (2018)</xref> specifically examined the presence of lymphocytes across biopsies in several types of cancer, and found that certain summarization metrics of lymphocyte clusters were significantly associated with survival in certain types of cancer. <xref rid="B33" ref-type="bibr">Lu et al. (2020)</xref> also found that various spatial features of tumor infiltrating lymphocytes present in a sample of breast cancer biopsies were significantly associated with survival both marginally and after adjusting for other factors. Further, they found that these associations actually differed by tumor subtype. In addition to this, they found that certain spatial features of tumor infiltrating lymphocytes were also significantly associated with gene expression data.</p>
    <p>From an analytical perspective, digital pathology research can be broadly classified along two axes: the type of quantitative models, and the scale of the assessment. Quantitative models range from primarily machine-learning in nature to primarily statistical. The most obvious way this difference manifests is in the models and methods used. Machine learning approaches tend to use tools like deep learning and convolutional neural networks and focus on predictive accuracy (<xref rid="B28" ref-type="bibr">Khosravi et al., 2018</xref>), while statistical approaches tend to use specialized model-based spatial methods and focus more on the quantification of uncertainty (<xref rid="B44" ref-type="bibr">Seal et al., 2022</xref>). The scale of assessment, on the other hand, relates to how much of the biopsy is used. Some methods operate on sub-regions of the biopsy images while others operate at the level of the entire biopsy (<xref rid="B17" ref-type="bibr">Ertosun and Rubin, 2015</xref>; <xref rid="B31" ref-type="bibr">Li et al., 2019b</xref>).</p>
    <p>In theory, these two qualities-type of research and scale of assessment-are independent. In practice, methods that use machine learning approaches tend to operate on whole biopsy images or data, while statistical approaches tend to operate on sub-regions of images, or substantially smaller biopsies as with multiplex imaging data analysis (<xref rid="B43" ref-type="bibr">Seal and Ghosh, 2022</xref>). There has been limited work to build off of the cell classification abilities of modern machine learning methods at the level of full biopsy imaging. There are two probable reasons for this. First, many statistical methods designed for usage with spatial data rely on the definition of a window in which the analysis occurs. For biopsies, such a window is not readily defined, except in deliberately chosen sub-regions. While such issues can be avoided by using methods that do not rely on an explicit window, this tends to introduce additional computational challenges that may not scale to the biopsy level, especially as biopsy size and resolution increases. Second, even if one were to define a singular window for the entire biopsy, applying spatial methods across the entire space may prove problematic. In addition to being computationally intensive, it is not clear that measures of various local spatial characteristics summarized at the biopsy level are able to capture the heterogeneity across the biopsy, and thus may not be informative enough to be useful in practice. For these reasons, there has been limited work in development of spatial statistical models that use cell classification data from full biopsy images. To the author’s knowledge, the most notable attempts to do so have been <xref rid="B31" ref-type="bibr">Li et al. (2019b)</xref>’s work which utilized data classified by the ConvPath pipeline (<xref rid="B46" ref-type="bibr">Wang et al., 2019</xref>).</p>
    <p>In order to address these issues, we propose SPARTIN (SPatial Analysis of paRtitioned Tumor-Immune imagiNg) pipeline. SPARTIN is unique in the spatial pathological imaging analysis literature in that it uses spatial statistical models to assess the association between tumor cells and immune cells across an entire partitioned biopsy, rather than select sub-regions. This allows for rigorous quantification of uncertainty in the style of <xref rid="B31" ref-type="bibr">Li et al., 2019b</xref> while still allowing for the assessment of full images in the style of <xref rid="B25" ref-type="bibr">Saltz et al. (2018)</xref>. We accomplish this by partitioning the cell-level imaging data of each biopsy into non-overlapping sub-regions, which can then be modeled to capture the local infiltration patterns using techniques from spatial point process theory. Spatial point processes have long been used in the domain of ecology to rigorously investigate spatial relationships between various organisms (<xref rid="B23" ref-type="bibr">Högmander and Aila, 1999</xref>; <xref rid="B29" ref-type="bibr">King et al., 2012</xref>). More recently, methods from this field have been successfully applied within the biomedical domain to functional neuroimaging and magnetic resonance imaging data (<xref rid="B26" ref-type="bibr">Kang et al., 2011</xref>; <xref rid="B41" ref-type="bibr">Ray et al., 2015</xref>). Briefly SPARTIN uses whole slide images of biopsies that are partitioned into sub-regions using an iterative clustering algorithm and a Bayesian spatial marked point process model is then fit on each sub-region (see <xref rid="F1" ref-type="fig">Figure 1</xref>). We discuss the constructions and justifications behind the choice of models underlying SPARTIN in <xref rid="s2" ref-type="sec">Section 2</xref>. Using our model parameters, we construct a measure of local immune cell infiltration, termed <italic>Cell Type Interaction Probability</italic> (CTIP) that allows rigorous incorporation of uncertainty and is highly interpretable (on a probability scale) both within and across biopsies, and can be used to assess associations with genomic and clinical features. We evaluate the performance of SPARTIN on simulated data across multiple scenarios of cell interactions (<xref rid="s3-1" ref-type="sec">Section 3.1</xref>) and show that our models are able to reliably distinguish positive interaction from negative and null interaction under a variety of scenarios (minimum AUC 0.85, maximum 0.97).</p>
    <fig position="float" id="F1">
      <label>FIGURE 1</label>
      <caption>
        <p>Overview of SPARTIN pipeline for single biopy image. Raw biopsy images <bold>(A)</bold> are preprocessed into cell types (tumor cells or immune cells, colored black and red respectively) and locations. The points are intensity thresholded, removing excess white space from the image and producing a more closely fitted window <bold>(B)</bold>. Next, the biopsy is tessellated into “tiles” consisting of non-overlapping sub-regions containing comparable numbers of tumor cells <bold>(C)</bold>. Bayesian Spatial point process models are fit on each tile <bold>(D)</bold>, and tile-specific Cell Type Interaction Probability (CTIP) is calculated from the resulting posterior distributions <bold>(E)</bold>, allowing us to capture heterogeneity in infiltration across the biopsy in a manner that can be aggregated <bold>(F)</bold> and appropriately summarized <bold>(G)</bold>.</p>
      </caption>
      <graphic xlink:href="fgene-14-1175603-g001" position="float"/>
    </fig>
    <p>We demonstrate the utility of SPARTIN on a Skin Cutaneous Melanoma dataset consisting of 335 biopsies obtained from The Cancer Genome Atlas (TCGA) Genomic Data Commons Data Portal (<xref rid="s3-2" ref-type="sec">Section 3.2</xref>). Our scientific goals are to quantify and characterize local spatial immune cell infiltration within and across melanoma biopsies and evaluate their association with genomic, phenotypic, and clinical outcomes. Using local spatial infiltration patterns quantified using CTIP, we found that CTIP was significantly negatively associated deconvolved immune cell prevalence scores including <italic>CD</italic>8+ T-Cells and Natural Killer cells. Furthermore, average CTIP scores differed significantly across previously established transcriptomic classes in melanoma (<xref rid="B3" ref-type="bibr">Akbani et al., 2015</xref>). CTIP was also more significantly associated with increased hazard of death, as compared to existing measures of spatial interaction. Beyond the inverse association with survival we found that CTIP was significantly inversely associated with clinical assessment of TIL abundance. Finally, we discuss the implications of this pipeline as well as potential future directions for the work (<xref rid="s4" ref-type="sec">Section 4</xref>).</p>
  </sec>
  <sec sec-type="materials|methods" id="s2">
    <title>2 Materials and methods</title>
    <sec id="s2-1">
      <title>2.1 Overview of SPARTIN</title>
      <p>The overall schematic of the SPARTIN pipeline (for a single biopsy image) is shown in <xref rid="F1" ref-type="fig">Figure 1</xref>. Briefly, for each whole-slide image of a biopsy (Panel A), the smallest window that fit all cells (Tumor and Immune) in the entire biopsy is constructed by thresholding the image intensity (Panel B). This window is then divided into “tiles” via a tessellation process that fully partitions the image into contiguous sub-regions containing similar numbers of tumor cells (Panel C; zoomed in version in Panel D). A Bayesian spatial point process model is then fit on each of these tiles separately, yielding a posterior distribution of the local interaction parameter (Panel E). For each tile, this local distribution is compared to a tile-specific null distribution to compute the local CTIP value, which is then combined to summarize the overall level of interaction at the biopsy level (Panel G). Each of these steps in detailed in the ensuing sections.</p>
    </sec>
    <sec id="s2-2">
      <title>2.2 Intensity thresholding and partition</title>
      <sec id="s2-2-1">
        <title>2.2.1 Motivation for partition</title>
        <p>Each biopsy was partitioned into non-overlapping sub-regions, each of which was modeled separately as a point process. The primary motivation for structuring the analysis in this manner came from prior biological knowledge about tumor composition. Tumors are heterogeneous entities in many respects, and immune infiltration is no exception. Tumor biopsies can also be quite large relative to the scale on which interaction is defined. While we used a radius of interaction of 30 microns, some biopsies in our sample comprised tens if not hundreds of thousands of square microns of tissue. Additionally, setting aside practical computational issues with fitting a single model on an entire biopsy, such an approach would also both fail to capture spatial variability in immune infiltration and fail to allow for a more granular spatial investigation of the immune infiltration in a given biopsy. A natural way to improve over this method is to algorithmically partition the biopsy into non-overlapping sub-regions and fit models on each sub-region. Aside from better capturing the spatial variability of immune infiltration, an additional benefit of this method is that it allows for the parallelization of model fitting across the resulting sub-regions within a single biopsy. Much like selecting a quadrature when approximating an integral, calibrating the fineness of the partition entails a tradeoff between the precision with which one can assess the spatial heterogeneity within the biopsy and the computational load that a finer partition entails.</p>
      </sec>
      <sec id="s2-2-2">
        <title>2.2.2 Partition pipeline</title>
        <p>In order to partition a given biopsy into non-overlapping sub-regions, we began with the smallest bounding rectangular window that contained all cells. We then applied an intensity thresholding algorithm in order to find the smallest possible window that still contained all cells. This was accomplished by breaking the full image up into small (∼15 microns<sup>2</sup>) sub-windows, and computing a smoothed cell intensity on each sub-window. Sub-windows which had a sufficiently high intensity were combined to form the overall window on which the subsequent partition took place. The final window can thus be thought of as the union of many small square windows which, due to their size, are able to fit the contours of the differently shaped biopsies and exclude areas both outside and within the biopsies where no cells are present. The algorithm takes in three tuning parameters that determine the resulting partition. The same values for all three parameters were used across all biopsies, and the values themselves were selected through empirical tuning on a subset of the total dataset. For more details on the parameters themselves, see <xref rid="s10" ref-type="sec">Supplementary Section S3</xref>.</p>
        <p>Next, we applied a voronoi tessellation to the tumor cells within the intensity thresholded window, partitioning it into tumor cell specific sub-windows. We then applied a modified version of K-means to the tumor cells, such that each of the resulting clusters was constrained to be between a pre-defined range of cell counts. Finally, each tumor cell specific sub-window within a given cluster was combined into a tile, corresponding to each of the clusters from the K-means clustering; see <xref rid="F1" ref-type="fig">Figure 1</xref> for an illustration of the process. This results in a set of tiles that fully partition the intensity thresholded window. This partition uniquely defines the membership of each of the total cells (tumor or immune) into one of the resulting tiles. Because each resulting tile has a well-defined boundary and each cell in the biopsy belongs to exactly one tile, a hierarchical Strauss model can be fit on each tile to compute a tile specific value of each parameter in the model. Most notably, this allows for the estimation of a tile-specific CTIP value, which captures the local degree of tumor cell-immune cell interaction. By modeling this parameter locally to each tile, we are able to capture not only the overall level of infiltration in the biopsy, but also the potentially spatially heterogeneous nature of the infiltration.</p>
        <p>It is worth emphasizing at this point the modular nature of our pipeline. The clustering method does not depend on the details of the model used, and the model in turn does not depend on details of the clustering method. Either can be exchanged for a different algorithm or model without disrupting the rest of the pipeline, so long as the output of the clustering algorithm is a spatial partition of the biopsy. Further, while the value ultimately selected to summarize the local infiltration at the tile level will obviously be informed by the exact model selected, there is flexibility in the choice of this quantity as well.</p>
      </sec>
    </sec>
    <sec id="s2-3">
      <title>2.3 Spatial point process models</title>
      <sec id="s2-3-1">
        <title>2.3.1 Data structure</title>
        <p>Let <italic>N</italic> be the number of biopsies, each with <italic>N</italic>
<sub><italic>i</italic></sub> tiles. More formally, after the partition biopsy <italic>i</italic> can be represented by <inline-formula id="inf1"><mml:math id="m1" overflow="scroll"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∪</mml:mo><mml:mo>⋯</mml:mo><mml:mo>∪</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula>, where each <italic>T</italic>
<sub><italic>ij</italic></sub> closed subset of <inline-formula id="inf2"><mml:math id="m2" overflow="scroll"><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>. Further, let <bold><italic>x</italic></bold>
<sub><italic>ij</italic></sub> = <bold><italic>x</italic></bold>
<sub><italic>ij1</italic></sub> ∪ <bold><italic>x</italic></bold>
<sub><italic>ij2</italic></sub>, where each <bold><italic>x</italic></bold>
<sub><italic>ijk</italic></sub> is a set of points in <inline-formula id="inf3"><mml:math id="m3" overflow="scroll"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>⊂</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>, and <italic>k</italic> = 1 for tumor cells and 2 for immune cells. Then for each element of the partition of each biopsy, this data can be naturally viewed as the realization of a marked point process. Broadly speaking, marked point process models are a family of models that treat the number of points, their locations, and their discrete classification (often called their “mark”) as random. We specifically chose to model this data as a hierarchical Multitype Strauss Process. Hierarchical Strauss Processes are unique in that they allow for the modeling of both the tendency of points of different types to be generally close (positive interaction) as well as generally far apart (negative interaction).</p>
      </sec>
      <sec id="s2-3-2">
        <title>2.3.2 Model construction</title>
        <p>The usage of a Strauss model to study spatial interaction in a marked point process is natural in this setting, since Strauss models were originally conceived for this purpose (<xref rid="B45" ref-type="bibr">Strauss, 1975</xref>). There are two primary model variants to consider when modeling multi-type data using the Strauss model: the hierarchical variant and the symmetric variant. These models are superficially similar, but differ in important ways. Broadly speaking the symmetric variant models the interaction between the different types of points jointly, whereas the hierarchical variant models the locations of certain types of points <italic>conditional</italic> upon the locations of other types. Using the hierarchical Strauss model thus requires an important choice for each pair of types as to which type of point will be “dominating,” i.e., conditioned upon, and thus unaffected by the other type. This choice, which must be made with <italic>a priori</italic> information about the nature of the process, has important consequences for the resulting model fit. Aside from the differing interpretations depending on the choice, different choices of dominating vs. non-dominating types will also result in different conditional likelihoods and thus parameter values (<xref rid="B23" ref-type="bibr">Högmander and Aila, 1999</xref>). It is also worth noting here that the term “hierarchical” is used differently in this context than it is often used in more typical statistical modeling. Rather than referring to mechanisms to account for dependence in observations or induce shrinkage, here the term refers to the hierarchical relationship between the dominating and non-dominating types: the locations of the dominating type do not depend on the locations of the non-dominating type, but the locations of the non-dominating type <italic>do</italic> explicitly depend on those of the dominating type.</p>
        <p>We ultimately chose to use the hierarchical variant of the multi-type Strauss model over the symmetric variant for two key reasons. First, in our imaging application treating the locations of the immune cells as conditional upon the locations of the tumor cells is <italic>a priori</italic> biologically plausible. It has been established that there is an interplay between a tumor and the host’s immune system whereby the immune system responds to the tumor, thus shaping its development, and the tumor in turn “escapes” the immune system and influences its response (<xref rid="B27" ref-type="bibr">Khong and Restifo, 2002</xref>; <xref rid="B49" ref-type="bibr">Zhang and Zhang, 2020</xref>). While such dynamics are no doubt of interest, this natural evolution cannot be easily inferred from a “snapshot” in time that a biopsy presents. Despite this, conditioning on the locations of the tumor cells to model the immune response is a reasonable starting point: in order for the immune system to respond, there must at the very least be a tumor to respond to. The hierarchical Strauss Model thus serves as a first order approximation to this complex interplay. Second, the hierarchical Strauss model allows for the proper modeling of positive interaction between points of different types, while the symmetric model does not. <xref rid="F2" ref-type="fig">Figure 2</xref> depicts examples of different types of spatial interaction, ranging from negative to positive. The left and center panels depict the range of interactions that can be modeled by the traditional Strauss process: either the case where cells of both types actively avoid the other (left panel) or are spatially unaffected by the other’s presence (middle panel). Because we are interested in not just these cases but the case where points of both types tend to cluster around points of the other type (right panel), the hierarchical variant is the clear choice.</p>
        <fig position="float" id="F2">
          <label>FIGURE 2</label>
          <caption>
            <p>An illustration of spatial interaction between cells of different types. The leftmost panel depicts low/negative interaction; the middle panel depicts null interaction; the rightmost panel depicts high/positive interaction.</p>
          </caption>
          <graphic xlink:href="fgene-14-1175603-g002" position="float"/>
        </fig>
        <p>The density function of the hierarchical Multitype Strauss Model with two qualitative marks (tumor and immune cells in our setting) is defined by<disp-formula id="e1"><mml:math id="m4" overflow="scroll"><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>∝</mml:mo><mml:mi>exp</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>11</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>11</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>22</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>22</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><label>(1)</label></disp-formula>where in addition to <bold><italic>x</italic></bold>
<sub>1</sub> and <bold><italic>x</italic></bold>
<sub>2</sub> as defined above, <italic>n</italic>
<sub><italic>t</italic></sub> is the number of points of type <italic>t</italic>, <italic>β</italic>
<sub><italic>t</italic></sub> is the first order intensity of points of type <italic>t</italic>, <inline-formula id="inf4"><mml:math id="m5" overflow="scroll"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>⋅</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> counts the number of pairs of points of types <italic>t</italic> and <italic>l</italic> within <italic>R</italic>
<sub><italic>tl</italic></sub> of one another where <italic>R</italic>
<sub><italic>tl</italic></sub> is selected <italic>a priori</italic> based on subject specific knowledge, and <italic>γ</italic>
<sub><italic>tl</italic></sub> captures the tendency of points of type <italic>l</italic> to be near points of type <italic>t</italic>. It bears mentioning that this model can be extended to arbitrary numbers of marks (i.e., types of cells). For our current application, we have focused on tumor-immune interactions, but it would be trivial to extend the chosen model to as multiple cell types as were available for a given data set.</p>
      </sec>
      <sec id="s2-3-3">
        <title>2.3.3 Interpretation of parameters</title>
        <p>As previously mentioned, <italic>γ</italic>
<sub><italic>tl</italic></sub> can be thought of as the degree to which points of type <italic>l</italic> tend to be close to or far away from points of type <italic>t</italic>. This allows us to distinguish between the mere relative abundance of different types of points (which is captured by the <italic>β</italic>
<sub>1</sub> and <italic>β</italic>
<sub>2</sub> parameters) and the actual spatial associations between the different types of points. This distinction is important in situations where there are substantial numbers of points of both types but no positive spatial association (and possibly a negative one). For examples, see <xref rid="s3-1" ref-type="sec">Section 3.1</xref> for results from the simulation study. When <italic>t</italic> = 1 and <italic>l</italic> = 2, this association is interpreted conditionally upon the locations of the type 1 points. Under the hierarchical Strauss model, <italic>γ</italic>
<sub>12</sub> ∈ (−<italic>∞</italic>, <italic>∞</italic>), with <italic>γ</italic>
<sub>12</sub> ∈ (−<italic>∞</italic>, 0) implying negative interaction, <italic>γ</italic>
<sub>12</sub> ∈ (0, <italic>∞</italic>) implying positive interaction, and <italic>γ</italic>
<sub>12</sub> = 0 implying no interaction at all. As one might intuitively expect, larger values of <italic>γ</italic>
<sub>12</sub> correspond to more positive interaction, and smaller values correspond to a more negative interaction. Due to mathematical constraints on the density, we must have <inline-formula id="inf5"><mml:math id="m6" overflow="scroll"><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>11</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>22</mml:mn></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mfenced open="(" close="]"><mml:mrow><mml:mo>−</mml:mo><mml:mi>∞</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula>. This constrains interaction between points of the same type to be modeled as negative or null, i.e., as in panels 1 and 2 of <xref rid="F2" ref-type="fig">Figure 2</xref>. Since this constraint is unlikely to be satisfied in the context of a tumor biopsy, we set <italic>γ</italic>
<sub>11</sub> = <italic>γ</italic>
<sub>22</sub> = 0, in effect assuming no interaction between cells of the same type. Based on prior biological knowledge, we set <italic>R</italic>
<sub>12</sub> = 30 microns. The need to select values of <italic>R</italic>
<sub>11</sub> and <italic>R</italic>
<sub>22</sub> is obviated by setting <italic>γ</italic>
<sub>11</sub> = <italic>γ</italic>
<sub>22</sub> = 0.</p>
      </sec>
    </sec>
    <sec id="s2-4">
      <title>2.4 Model fitting</title>
      <p>Except in the trivial case where <italic>γ</italic>
<sub>12</sub> = 0, the normalizing constant of this distribution is computationally intractable. This motivates the usage of a pseudolikelihood formulation as outlined by <xref rid="B6" ref-type="bibr">Baddeley and Turner, 2000</xref>. For the density <italic>f</italic>(⋅) of the simplified hierarchical Strauss Model outlined in <xref rid="e1" ref-type="disp-formula">(1)</xref>, define the conditional intensity function at a point <italic>u</italic> given <italic>θ</italic> = {<italic>β</italic>
<sub>1</sub>, <italic>β</italic>
<sub>2</sub>, <italic>γ</italic>
<sub>12</sub>} and points <bold><italic>x</italic></bold> observed in window <italic>A</italic> by<disp-formula id="e2"><mml:math id="m7" overflow="scroll"><mml:mi>λ</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>u</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced open="{" close=""><mml:mrow><mml:mtable class="cases"><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>∪</mml:mo><mml:mfenced open="{" close="}"><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="1em"/></mml:mtd><mml:mtd columnalign="left"><mml:mi>u</mml:mi><mml:mo>∉</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>−</mml:mo><mml:mfenced open="{" close="}"><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="1em"/></mml:mtd><mml:mtd columnalign="left"><mml:mi>u</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><label>(2)</label></disp-formula>
</p>
      <p>Given this, the pseudolikelihood is defined as follows,<disp-formula id="e3"><mml:math id="m8" overflow="scroll"><mml:mi>P</mml:mi><mml:mi>L</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>θ</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:munder><mml:mi>λ</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced><mml:mi>exp</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mi>λ</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>u</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:mi>u</mml:mi></mml:mrow></mml:mfenced></mml:math><label>(3)</label></disp-formula>
</p>
      <p>In essence, this provides a computationally tractable alternative to the likelihood function that can be used in inference. Specifically, the integral in the pseudolikelihood function can be easily approximated by summing over a weighted quadrature on <italic>A</italic>, as described in <xref rid="B6" ref-type="bibr">Baddeley and Turner, 2000</xref>. See <xref rid="s10" ref-type="sec">Supplementary Equation S1</xref> for additional details.</p>
      <p>Using this approximation of the pseudolikelihood function in place of the more standard likelihood function, Bayesian analysis can proceed in the style of <xref rid="B29" ref-type="bibr">King et al., 2012</xref> by simply assigning priors to the parameters of interest and using techniques to sample from non-closed form posterior likelihoods. We assigned non-informative normal priors with mean 0 and variance 10<sup>6</sup> to <italic>γ</italic>
<sub>12</sub>, <italic>β</italic>
<sub>1</sub>, and <italic>β</italic>
<sub>2</sub>. In all analysis presented below the quadrature and weights used to estimate the integral in the pseudolikelihood function was generated by the spatstat package (<xref rid="B7" ref-type="bibr">Baddeley and Turner, 2005</xref>). Samples from the posterior were taken using JAGS via the R2jags package (<xref rid="B50" ref-type="bibr">Yu-Sung et al., 2015</xref>); see <xref rid="s10" ref-type="sec">Supplementary Algorithm S1</xref> for details.</p>
    </sec>
    <sec id="s2-5">
      <title>2.5 Cell type interaction probability</title>
      <sec id="s2-5-1">
        <title>2.5.1 Motivation</title>
        <p>For ease of exposition, we suppress the subscript in <italic>γ</italic>
<sub>12</sub> parameter, and refer to it as <italic>γ</italic>
<sub>•</sub> in the following sections. <italic>γ</italic>
<sub>•</sub>, <italic>β</italic>
<sub>1</sub>, and <italic>β</italic>
<sub>2</sub> allow us to distinguish between the tendency of cells of different types to be spatially near one another (captured by <italic>γ</italic>
<sub>•</sub>) and the relative abundance of the cells of each type (captured by <italic>β</italic>
<sub>1</sub> and <italic>β</italic>
<sub>2</sub>), as well as the uncertainty around these various tendencies. However, this does not capture the difference between the observed spatial association and what one would expect to observe by chance given a particular configuration of tumor cells. Even if the locations of the immune cells are completely random and unrelated to those of the tumor cells, there is still a possibility of a configuration that may indicate positive interaction when considered in isolation. In order to properly account for this, the observed distribution of <italic>γ</italic>
<sub>•</sub> must be compared to a counterfactual distribution that captures the tendency when there is no interaction. This motivated the development of Cell Type Interaction Probability (CTIP).</p>
      </sec>
      <sec id="s2-5-2">
        <title>2.5.2 Definition</title>
        <p>Let <italic>π</italic>(<italic>γ</italic>): = <italic>f</italic>(<italic>γ</italic>
<sub>•</sub>|<bold><italic>x</italic></bold>
<sub>1</sub>, <bold><italic>x</italic></bold>
<sub>2</sub>) be the posterior distribution of <italic>γ</italic>
<sub>•</sub> conditional upon the observed tumor cells and immune cells, and <inline-formula id="inf6"><mml:math id="m9" overflow="scroll"><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> be the posterior distribution of the interaction parameter conditional upon the observed locations of the tumor cells and <inline-formula id="inf7"><mml:math id="m10" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, a set of points distributed as a Poisson Process. Further, assume independence between the true distribution and the null distribution. Then we define the CTIP (denoted by <italic>r</italic>) as:<disp-formula id="e4"><mml:math id="m11" overflow="scroll"><mml:mspace width="1em"/><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mo>∬</mml:mo><mml:mi>I</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>γ</mml:mi><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>π</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:mi>γ</mml:mi><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math><label>(4)</label></disp-formula>where <italic>I</italic>(⋅) denotes the indicator function, and both <italic>π</italic>(<italic>γ</italic>) and <italic>π</italic>
<sub>0</sub>(<italic>γ</italic>
<sub>0</sub>) are as defined above. By construction, the observed parameter is independent from the null parameter, since immune cells drawn from a Poisson process should not yield any information about immune cells realized under either positive or negative interaction. More concretely, by the definitional independence of <inline-formula id="inf8"><mml:math id="m12" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> from <bold><italic>x</italic></bold>
<sub>2</sub>, it follows trivially that <inline-formula id="inf9"><mml:math id="m13" overflow="scroll"><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mo>•</mml:mo></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mo>•</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. This construction means that CTIP is the expectation of an indicator function, and thus can be interpreted as a probability. Specifically, it represents the probability that the observed value of <italic>γ</italic>
<sub>•</sub> is larger than what we would observe if there was truly no underlying interaction.</p>
      </sec>
      <sec id="s2-5-3">
        <title>2.5.3 Sampling from the empirical null distribution</title>
        <p>The problem of estimating CTIP hinges on being able to sample from the distribution of <italic>γ</italic>
<sub>0</sub>, since estimation of the posterior can proceed as described in <xref rid="s2-3" ref-type="sec">Section 2.3</xref>. In order to estimate the null distribution of <italic>γ</italic>
<sub>0</sub> conditional upon the location of the observed tumor cells, we used simulation to construct an empirical null distribution. Recall that when there is no interaction, by definition <italic>γ</italic> = 0. This means that the hierarchical Strauss given in Eq. <xref rid="e1" ref-type="disp-formula">1</xref> reduces to two independent Poisson processes with intensities <italic>β</italic>
<sub>1</sub> and <italic>β</italic>
<sub>2</sub>, which are trivial to simulate.</p>
        <p>Given this, the estimation of the null distribution for a given tile proceeded as follows. First, the first order intensity of the immune cells was estimated using the standard estimator, <inline-formula id="inf10"><mml:math id="m14" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>log</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> where <italic>I</italic>
<sub><italic>ik</italic></sub> is the number of immune cells observed in tile <italic>k</italic> of biopsy <italic>i</italic> and <italic>A</italic>
<sub><italic>ik</italic></sub> is the area in square microns of the tile. Second, <italic>S</italic> simulations of immune cells were generated from a poisson process with intensity <inline-formula id="inf11"><mml:math id="m15" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, <italic>S</italic> being selected <italic>a priori</italic>. Third and finally, each simulated set of immune cells was superimposed over the actual observed tumor cells, and samples were drawn from the resulting posterior distribution. These samples, combined across simulations 1, …, <italic>S</italic> approximate <italic>π</italic>
<sub>0</sub>(<italic>γ</italic>) as previously defined.</p>
      </sec>
      <sec id="s2-5-4">
        <title>2.5.4 Computation of CTIP</title>
        <p>Having established the ability to sample from the posterior distribution as well as the null distribution for <italic>γ</italic>, estimation of CTIP can be done via stochastic integration. Note that Eq. <xref rid="e4" ref-type="disp-formula">4</xref> is equivalent to <inline-formula id="inf12"><mml:math id="m16" overflow="scroll"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mi>I</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>γ</mml:mi><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. Thus, given <italic>P</italic> posterior samples <italic>γ</italic>
<sub>1</sub>, …, <italic>γ</italic>
<sub><italic>P</italic></sub> from the posterior <italic>π</italic> and <italic>γ</italic>
<sub>01</sub>, …, <italic>γ</italic>
<sub>0<italic>P</italic>
</sub> from the empirical null <italic>π</italic>
<sub>0</sub>, (5) can be estimated by<disp-formula id="e5"><mml:math id="m17" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:mfrac><mml:munderover accentunder="false" accent="true"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:munderover><mml:mi>I</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><label>(5)</label></disp-formula>
</p>
      </sec>
      <sec id="s2-5-5">
        <title>2.5.5 Interpretation</title>
        <p>By definition, <italic>r</italic> ∈ [0, 1]. As previously mentioned, <italic>r</italic> can be construed as the expected value of an indicator random variable with respect to the joint distribution of <italic>π</italic>(<italic>γ</italic>) and <italic>π</italic>
<sub>0</sub>(<italic>γ</italic>
<sub>0</sub>). This naturally yields an interpretation of <italic>r</italic> as a probability. Specifically, it can be thought of as measuring the posterior probability that the observed value of <italic>γ</italic>
<sub>•</sub> is larger than the value that would be observed given the observed tumor cells and immune cell intensity if there were no underlying interaction.</p>
      </sec>
      <sec id="s2-5-6">
        <title>2.5.6 Model outputs and summaries</title>
        <p>Because models can be fit for each sub-region <italic>T</italic>
<sub><italic>ij</italic></sub> of biopsy <italic>B</italic>
<sub><italic>i</italic></sub>, CTIP can also be computed for each tile. The result for each biopsy is a collection of tile specific estimations of CTIP for each biopsy, <inline-formula id="inf13"><mml:math id="m18" overflow="scroll"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math></inline-formula> for <italic>i</italic> = 1, <italic>…</italic>, <italic>N</italic>. These estimates are then summarized at the biopsy level into a singular value that quantifies the overall level of infiltration in the biopsy, which can be used in downstream analyses to investigate the association between biopsy level of tumor-immune interaction and other patient features of interest-see <xref rid="s3-2" ref-type="sec">Section 3.2</xref> for results. We chose to use the mean value, since even under the assumption of spatial association between tiles the result is an unbiased estimate of the biopsy level mean. Because the values themselves encode the local spatial association for each tile, the result is an appropriate proxy for the amount of interaction between tumor cells and immune cells at the biopsy level. We further logit-transformed the tile level CTIP values prior to computing the biopsy level mean in order to make the resulting distribution across biopsies closer to a Gaussian distribution. See <xref rid="Algorithm_1" ref-type="statement">Algorithm 1</xref> for the full SPARTIN method.</p>
        <p>
          <statement content-type="algorithm" id="Algorithm_1">
            <label>Algorithm 1</label>
            <p>SPARTIN algorithm.<list list-type="simple"><list-item><p><bold>Input</bold>: <italic>N</italic> biopsies</p></list-item><list-item><p><bold>for</bold> biopsy <italic>i</italic> = 1, <italic>…</italic>, <italic>N</italic>
<bold>do</bold>
</p></list-item><list-item><p>Intensity threshold biopsy <italic>i</italic>
</p></list-item><list-item><p>Partition intensity thresholded biopsy <italic>i</italic> into <italic>N</italic>
<sub><italic>i</italic></sub> tiles</p></list-item><list-item><p><bold>for</bold> tile <italic>j</italic> = 1, <italic>…</italic>, <italic>N</italic>
<sub><italic>i</italic></sub>
<bold>do</bold>
</p></list-item><list-item><p>Estimate CTIP <inline-formula id="inf14"><mml:math id="m19" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> for tile <italic>j</italic>
</p></list-item><list-item><p><bold>end for</bold></p></list-item><list-item><p>Compute <inline-formula id="inf15"><mml:math id="m20" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>mean</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mtext>logit</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mtext>logit</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>
</p></list-item><list-item><p><bold>end for</bold></p></list-item><list-item><p><bold>return</bold><inline-formula id="inf16"><mml:math id="m21" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> for usage in downstream analysis</p></list-item></list>
</p>
          </statement>
        </p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="results" id="s3">
    <title>3 Results</title>
    <sec id="s3-1">
      <title>3.1 Simulations</title>
      <sec id="s3-1-1">
        <title>3.1.1 Simulation overview</title>
        <p>To compare our model’s detection of spatial association between different cell types, we conducted simulation studies in which we tested the ability of SPARTIN to accurately identify positive interaction across a range of different simulated cell compositions and degrees of spatial association. For each of four sets of simulations, the number of simulated tumor cells and immune cells were set <italic>a priori</italic> at <italic>T</italic>
<sub><italic>s</italic></sub> and <italic>L</italic>
<sub><italic>s</italic></sub>. These levels across the four simulations were, respectively, 20 and 50, 50 and 20, 50 and 50, and 100 and 100. Further, interaction was controlled by a parameter <italic>ϕ</italic> ∈ [−1, 1], with −1 indicating the most negative possible interaction using our simulation method and 1 indicating the most positive possible interaction using our simulation method. For each of the four settings, 50 data sets were simulated for <italic>ϕ</italic> = ±1, ±0.8, ±0.6, ±0.4, ±0.2, and 100 were simulated for <italic>ϕ</italic> = 0. Because the goal was classification as either positive interaction or non-positive (i.e., null or negative) interaction, we used AUC as our summary metric. This is a natural choice, since CTIP is interpreted as the posterior probability of positive interaction. As a benchmark for performance, we compared CTIP to the G-cross function, a commonly used non-parametric statistical method for assessing the spatial relationship between different types of points in marked point processes (<xref rid="B34" ref-type="bibr">Van Lieshout and Baddeley, 1999</xref>).</p>
      </sec>
      <sec id="s3-1-2">
        <title>3.1.2 Simulations of negative interaction</title>
        <p>For a given combination of <italic>T</italic>
<sub><italic>s</italic></sub> and <italic>L</italic>
<sub><italic>s</italic></sub>, the simulations of positive interaction and simulations of negative interaction proceeded differently. For the simulations of negative interaction (<italic>ϕ</italic> ∈ [−1, 0]), <italic>T</italic>
<sub><italic>s</italic></sub> tumor cells and <italic>L</italic>
<sub><italic>s</italic></sub> immune cells were simulated as independent poisson processes in regions of the window that overlapped to varying degrees. The overlap was controlled by <italic>ϕ</italic>, such that the processes overlapped on (100 ⋅ (1 + <italic>ϕ</italic>))% of the window in which the simulation occurred. Note that when <italic>ϕ</italic> = −1 there was no overlap, and when <italic>ϕ</italic> = 0 there was complete overlap and the simulation reduced to generating two independent Poisson Processes within the same window.</p>
      </sec>
      <sec id="s3-1-3">
        <title>3.1.3 Simulations of positive interaction</title>
        <p>For the simulations of positive interaction (<inline-formula id="inf17"><mml:math id="m22" overflow="scroll"><mml:mi>ϕ</mml:mi><mml:mo>∈</mml:mo><mml:mfenced open="(" close="]"><mml:mrow><mml:mn>0,1</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula>), <italic>T</italic>
<sub><italic>s</italic></sub> tumor cells were simulated under a Poisson process. After their locations were determined, <italic>L</italic>
<sub><italic>s</italic></sub> immune cells were simulated. For each immune cell <italic>l</italic>
<sub><italic>i</italic></sub>, a Bernoulli random variable <italic>C</italic>
<sub><italic>i</italic></sub>∼<italic>Bern</italic>(<italic>ϕ</italic>) was drawn. If <italic>C</italic>
<sub><italic>i</italic></sub> = 1, <italic>l</italic>
<sub><italic>i</italic></sub> was simulated within 30 microns of a randomly selected tumor cell. Otherwise, <italic>l</italic>
<sub><italic>i</italic></sub> was simulated from a Poisson process. Thus, the level of interaction was again controlled by <italic>ϕ</italic>, with <italic>ϕ</italic> = 0 again corresponding to two independent Poisson Processes and <italic>ϕ</italic> = 1 corresponding to a situation in which all immune cells are within 30 microns of at least one tumor cell.</p>
      </sec>
      <sec id="s3-1-4">
        <title>3.1.4 Simulation assessment</title>
        <p>Because CTIP is most naturally interpreted as a probability, in order to classify a given collection of points as indicating positive or negative interaction in practice a cutoff value must be chosen above which CTIP is considered to indicate positive interaction and below which it is not. This leads to a natural tradeoff: if the cutoff is too low, then many cases where there is no positive interaction will be incorrectly classified as having positive interaction. If the cutoff is too high, the opposite will occur. This tradeoff can be visualized across different thresholds using a receiver operating characteristic (ROC) curve, which can in turn be summarized by the area under the curve (AUC). AUC ranges between 0.5 and 1, with 0.5 indicating total inability to correctly discriminate between different outcomes and 1 indicating perfect ability to discriminate. AUC is therefore a natural choice for a metric to assess the ability of CTIP to distinguish between positive and non-positive interaction between cells of different types.</p>
        <p>As a benchmark for performance, we examined the performance of the G-cross function in discriminating positive interaction from non-positive interaction. The G-cross function is a non-parametric estimate of the cumulative distribution functions of minimum distances from cells of one type to those of another. In this application, the G-cross function evaluated at a specific distance yields a non-parametric estimate of the probability that a tumor cell will have at least one immune cell within that distance. We chose to evaluate the G-cross function at a distance of 30 microns in order to be consistent with the modeling of CTIP.</p>
      </sec>
      <sec id="s3-1-5">
        <title>3.1.5 Results</title>
        <p>For examples of simulated data as well as visualizations of results for CTIP, see <xref rid="F3" ref-type="fig">Figure 3</xref>. Across the different simulation settings, accurate classification was achieved using CTIP. The top panels depict a sample of simulations across a range of interaction values, from <italic>ϕ</italic> = −1 to <italic>ϕ</italic> = 1. The bottom left panel shows the distribution of the estimated CTIP values for each set of simulations across each of the four sets of simulations and the values of <italic>ϕ</italic>, plotted on the logit scale. The bottom right panel shows the AUC for each of the four simulation settings across all values of <italic>ϕ</italic>. The results of these simulations demonstrate that CTIP reliably distinguishes between a broad ranges of interaction levels, across a similarly broad range of relative abundances in cell types. The lowest overall AUC (0.85) was achieved in simulation 3, while the highest was achieved in simulation 1 (0.96). For the G-cross function, the highest overall AUC was achieved in simulation 2 (0.8), while the lowest was achieved in simulation 1 (0.73)—see <xref rid="s10" ref-type="sec">Supplementary Figure S4</xref> in the supplementary materials for more detailed results for the G-cross function, and <xref rid="s10" ref-type="sec">Supplementary Section S5</xref> for additional simulation results examining the relative performance when model assumptions are violated.</p>
        <fig position="float" id="F3">
          <label>FIGURE 3</label>
          <caption>
            <p>Simulated examples and results. Top row: examples of simulations of positive and negative interaction for different values of <italic>ϕ</italic>, all from simulation setting 1. Bottom left: box plots of CTIP across all simulated compositions for different values of <italic>ϕ</italic> on logit scale. Bottom right: ROC curves and associated AUC for classification (positive interaction vs. non-positive interaction) for different simulation settings and the two methods investigated (CTIP and G-cross).</p>
          </caption>
          <graphic xlink:href="fgene-14-1175603-g003" position="float"/>
        </fig>
      </sec>
    </sec>
    <sec id="s3-2">
      <title>3.2 Application</title>
      <p>We applied the SPARTIN pipeline to a data set consisting of 335 high definition images of SKin Cutaneous Melanoma (SKCM) biopsies stained using hematoxylin and eosin, obtained from The Cancer Genome Atlas (TCGA) Genomic Data Commons Data Portal. SKCM is an appealing target for the investigation of immune cell infiltration for several reasons. SKCM has been shown to be particularly responsive to immunotherapy in some cases (<xref rid="B1" ref-type="bibr">Achkar and Tarhini, 2017</xref>; <xref rid="B18" ref-type="bibr">Franklin et al., 2017</xref>). It is possible that the ability to quantify immune infiltration at a large scale may allow for more detailed investigation into the scenarios in which this treatment may be most effectively deployed. It is also well established that SKCM has an unusually high mutational load amongst the various cancer types (<xref rid="B11" ref-type="bibr">Berger et al., 2012</xref>). The ability to quantify spatial infiltration patterns may allow for further downstream investigations into not only genomic associations of this occurrence but associations with other phenotypic and clinical outcomes as well.</p>
      <sec id="s3-2-1">
        <title>3.2.1 Cell classification model</title>
        <sec id="s3-2-1-1">
          <title>3.2.1.1 Whole-slide image (WSI) retrieval and obtaining training labels</title>
          <p>WSI from 20 different patients were used as our primary training and testing data. The images were imported from The Cancer Genome Atlas (TCGA) Genomic Data Commons Data Portal, which is a repository of validated datasets from various National Cancer Institute Programs: <ext-link xlink:href="https://www.cancer.gov/tcga" ext-link-type="uri">https://www.cancer.gov/tcga</ext-link>. Also known as the gigapixel pathology image, one image slide contained two tissue smears stained with hematoxylin and eosin, imported in a vendor specific format. The imported image for classification is scanned at the “high” magnification level in a microscope of ×40. The pixel size for images was approximately 0.25 microns per pixel. Manual marking of a minimum of ten samples from each of the classes, i.e., Tumors, Immune, Macrophage, and other cell was performed by a pathologist on all slides. Care was taken to ensure that the samples were as diverse as possible, to account for all possible morphologies of the same cell type across all cases. In total, 1,250 annotations were made in all the images, with each annotated cell labelled by a pathologist. The reasons for the comparatively smaller labelled dataset available lie in the large size of the slide, and pathologist availability; the large size makes parsing through difficult and explains the diversity of labelled structures in each image.</p>
        </sec>
        <sec id="s3-2-1-2">
          <title>3.2.1.2 Whole-slide image (WSI) nucleus segmentation</title>
          <p>Before nuclear segmentation and extraction can be performed on the WSIs, certain pre-processing steps are carried out to ensure staining uniformity across images. A representative and generalizable stain vector estimation for each of the stains being used in the image is estimated, to normalize the staining intensities across all the images. In our application, vectors from hematoxylin, eosin and residual stains were estimated from a standard image, selected by the clinician. These vectors are then applied across all images to keep the stain detection parameters uniform across the dataset (<xref rid="B8" ref-type="bibr">Bankhead et al., 2018</xref>).</p>
          <p>Due to the variations in staining procedures across the dataset, it is difficult to accurately isolate whole cells on the slide, as the cytoplasmic boundaries are not well-defined due to lack of membrane staining. As heterogeneity in nuclear morphology has been shown to be a good discriminator, only the nucleus is segmented out of each cell in every image for classification purposes, using Qupath (<xref rid="B51" ref-type="bibr">Yuan et al., 2012</xref>). Watershed segmentation is used to obtain separated and contoured nuclei from the hematoxylin color channel of the whole slide image, in a patch-based manner (<xref rid="B8" ref-type="bibr">Bankhead et al., 2018</xref>). The separate hematoxylin channel is obtained by performing color deconvolution to separate out the stains used in the slide (<xref rid="B42" ref-type="bibr">Ruifrok and Johnston, 2001</xref>). It was observed that an average of 200,000 cells were segmented out per image, and morphological and intensity features such as spatial location, eccentricity, circularity, and stain intensities were computed. All pertinent image analysis and nuclear segmentation was performed using Qupath, an open-sourced software platform that can be used for a range of pathological image analysis applications (<xref rid="B9" ref-type="bibr">Bankhead et al., 2017</xref>).</p>
          <p>A Random Forest model is a type of ensemble learning method, where the weak predictive power of multiple decision trees is aggregated to produce an accurate result (<xref rid="B14" ref-type="bibr">Breiman, 2001</xref>). Our four-class classifier model was developed with the pathologist labelled dataset of 1,250 morphologically diverse cells, each belonging to Tumor, Immune, Macrophage, or other cells (including cell types such as stromal cells). 5-fold cross-validation was used to assess model accuracy and the receiver operator characteristic curve AUC for each class, with proportional representation of all 4 classes ensured. After adjusting for multiple parameters, including the number of decision trees, the accuracy was obtained in the range of 87%–91%.</p>
          <p>This step allowed for a preparation of a dataset for each cell with its spatial location using global coordinates and class of the cell, which is then used for further downstream analysis. The training, testing, and classification of cells from the WSIs was performed on MATLAB version 2017A. For visualizations of distributions of cell counts across biopsies, see <xref rid="s10" ref-type="sec">Supplementary Figures S1–S3</xref>. For this analysis, only data for tumor cells and immune cells were kept to quantify the immune cell infiltration using SPARTIN.</p>
        </sec>
      </sec>
      <sec id="s3-2-2">
        <title>3.2.2 SPARTIN analyses of SKCM</title>
        <p>While we are broadly grouping immune cells together for the purposes of this analysis, it is important to note that within the microevironment of melanoma there is a great deal of heterogeneity in the types of immune cells present. Tumor Infiltrating Lymphocytes (TILs) receive a disproportionate amount of attention in cancer literature due to the well-established prognostic value of the presence. However, in the context of melanoma this focus can obscure the tremendous amount of variability in the types of immune cells present in the microenvironment. Even referring to TILs as a monolith obfuscates the different cell types captured under this umbrella, many of which serve different purposes (<xref rid="B35" ref-type="bibr">Mukherji, 2013</xref>; <xref rid="B48" ref-type="bibr">Weiss, 2016</xref>; <xref rid="B5" ref-type="bibr">Antohe et al., 2019</xref>). The richness of the immunological aspect of the melanoma microenvironment makes it a logical target of analysis via the SPARTIN pipeline.</p>
        <sec id="s3-2-2-1">
          <title>3.2.2.1 CTIP quantification</title>
          <p>In order to compute CTIP, models were fit in using the methods described in <xref rid="s2" ref-type="sec">Section 2</xref>. The same settings were used for all biopsies across the pipeline. Each biopsy was partitioned such that the resulting tiles would have approximately 75 tumor cells per tile, with the minimum possible tumor cells per tile being 50 and the maximum being 100. For an analysis of the sensitivity to the biopsy level estimation of CTIP to the number of tumor cells per tile as well as the clustering algorithm used, see <xref rid="s10" ref-type="sec">Supplementary Section S6</xref>. The CTIP quantifications are shown in <xref rid="F4" ref-type="fig">Figure 4</xref> Panel A wherein we have highlighted three biopsy images (top row). In the middle row, the color of each tile indicates the value of CTIP estimated for that tile. More varied colors across a given biopsy are indicative of more spatial variation in CTIP, and thus infiltration. CTIP was summarized at the biopsy level by taking the empirical mean across all tiles for a given biopsy, which are plotted in the bottom row. As can be seen, the range of CTIP was 0.26–0.99 with a median CTIP value of 0.69 and an interquartile range of 0.19. This points to the fact that SKCM has high level of immune cell infiltration and these results are consistent with the conventional wisdom that melanoma is a generally more immunogenic cancer relative to other variants (<xref rid="B35" ref-type="bibr">Mukherji, 2013</xref>; <xref rid="B19" ref-type="bibr">Fu et al., 2019</xref>).</p>
          <fig position="float" id="F4">
            <label>FIGURE 4</label>
            <caption>
              <p>Visualization of selected biopsies, and distribution of CTIP across all biopsies analyzed. Selected examples of actual biopsies, both raw spatial data and with tessellations and CTIP by tile. The leftmost biopsy pictured has among the lowest mean estimated CTIP in the sample (0.4), while the rightmost has among the highest (0.94). The middle biopsy has average mean CTIP (0.7), but also exhibits more spatial variation than the left or right biopsy. Bottom: distribution of mean CTIP by biopsy for all biopsies investigated. This illustrates the between-biopsy variation in overall levels of infiltration.</p>
            </caption>
            <graphic xlink:href="fgene-14-1175603-g004" position="float"/>
          </fig>
        </sec>
      </sec>
      <sec id="s3-2-3">
        <title>3.2.3 Genomic associations</title>
        <p>We conducted a focused analysis on CTIP and genes that are associated with immune activity. <xref rid="B12" ref-type="bibr">Bhattacharya et al., 2018</xref> have collected and classified a list of 1,793 unique genes associated with various aspects of human immune activity. Notably, this includes genes related to processes that involve or are directly related to immune cells of interest including CD8<sup>+</sup> T-cells, Natural Killer cells, and B cells. Of these, gene expression data was available for 1,305 genes across 330 patients. We assessed the univariate association between biopsy level mean logit-CTIP and these genes using Spearman correlation. The advantage of Spearman correlation as opposed to the more standard Pearson correlation is that the former does not assume a linear relationship between the underlying variables of interest. Such assumptions can be problematic, particularly when there is no strong reason <italic>a priori</italic> to believe the relationship between the two variables is of a particular form. However, like Pearson correlation Spearman correlation is defined to lie in [−1, 1], with each extreme indicating the same directionality and strength of association as Pearson Correlation. After applying a Bonferroni correction, we found that 28 genes were significantly associated with CTIP. See <xref rid="F5" ref-type="fig">Figure 5</xref> for a volcano plot of results; for the complete list of genes, see <xref rid="T1" ref-type="table">Table 1</xref>. Most notably, mean logit-CTIP was most significantly negatively associated with CD244, a gene associated with increased cytotoxicity in natural killer cells (<xref rid="B2" ref-type="bibr">Agresta et al., 2018</xref>). In addition, mean logit-CTIP was significantly negatively associated with expression of Cathepsin S, a gene associated with immunosuppression in the tumor microenvironment, and C-C motif chemokine receptor 8 (CCR8), a gene related to immunosuppressive T regulatory cells (<xref rid="B20" ref-type="bibr">Fuchs et al., 2020</xref>; <xref rid="B47" ref-type="bibr">Weaver et al., 2022</xref>).</p>
        <fig position="float" id="F5">
          <label>FIGURE 5</label>
          <caption>
            <p>Volcano Plot of Spearman correlations between CTIP and gene expression values. Negative log<sub>10</sub>
<italic>p</italic>-values plotted against Spearman Correlation for ImmPort genes. Colors indicate ImmPort Gene List, which are the collections provided by ImmPort to organize genes into groups of similar function; Red line indicates Bonferroni correction-see <xref rid="T1" ref-type="table">Table 1</xref> for full list of significant genes.</p>
          </caption>
          <graphic xlink:href="fgene-14-1175603-g005" position="float"/>
        </fig>
        <table-wrap position="float" id="T1">
          <label>TABLE 1</label>
          <caption>
            <p>Full ImmPort Analysis Results. ImmPort Genes significantly associated with average logit biopsy level CTIP after Bonferroni correction, alpha = 0.05.</p>
          </caption>
          <table frame="hsides" rules="groups">
            <thead valign="top">
              <tr>
                <th align="left" rowspan="1" colspan="1">Gene</th>
                <th align="left" rowspan="1" colspan="1">Group</th>
                <th align="left" rowspan="1" colspan="1">Spearman Correlation</th>
                <th align="left" rowspan="1" colspan="1"><italic>p</italic>-value</th>
              </tr>
            </thead>
            <tbody valign="top">
              <tr>
                <td align="left" rowspan="1" colspan="1">CD244</td>
                <td align="left" rowspan="1" colspan="1">Natural Killer Cell</td>
                <td align="left" rowspan="1" colspan="1">−0.29</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CTSS</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.29</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CCR8</td>
                <td align="left" rowspan="1" colspan="1">Cytokine Receptors</td>
                <td align="left" rowspan="1" colspan="1">−0.27</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CD3G</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.26</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">PTPRC</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.26</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">TLR8</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.26</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">ITK</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.26</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">TLR3</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.25</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">STAT1</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.25</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">TNFRSF9</td>
                <td align="left" rowspan="1" colspan="1">TNF Family Members Receptors</td>
                <td align="left" rowspan="1" colspan="1">−0.25</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">EREG</td>
                <td align="left" rowspan="1" colspan="1">Cytokines</td>
                <td align="left" rowspan="1" colspan="1">0.24</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">LCK</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.24</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf18">
                    <mml:math id="m23" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">PIK3CG</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.24</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf19">
                    <mml:math id="m24" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">ERAP1</td>
                <td align="left" rowspan="1" colspan="1">Antigen Processing and Presentation</td>
                <td align="left" rowspan="1" colspan="1">−0.24</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf20">
                    <mml:math id="m25" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">TNFSF14</td>
                <td align="left" rowspan="1" colspan="1">TNF Family Members</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf21">
                    <mml:math id="m26" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">IL6R</td>
                <td align="left" rowspan="1" colspan="1">Interleukins Receptors</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf22">
                    <mml:math id="m27" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CIITA</td>
                <td align="left" rowspan="1" colspan="1">Antigen Processing and Presentation</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf23">
                    <mml:math id="m28" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">ICOS</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf24">
                    <mml:math id="m29" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">DES</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf25">
                    <mml:math id="m30" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">APLN</td>
                <td align="left" rowspan="1" colspan="1">Cytokines</td>
                <td align="left" rowspan="1" colspan="1">0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf26">
                    <mml:math id="m31" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">IFIH1</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf27">
                    <mml:math id="m32" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">RFX5</td>
                <td align="left" rowspan="1" colspan="1">Antigen Processing and Presentation</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf28">
                    <mml:math id="m33" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">LYZ</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf29">
                    <mml:math id="m34" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CXCR6</td>
                <td align="left" rowspan="1" colspan="1">Cytokine Receptors</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf30">
                    <mml:math id="m35" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CRABP1</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf31">
                    <mml:math id="m36" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CYBB</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf32">
                    <mml:math id="m37" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
            </tbody>
          </table>
        </table-wrap>
        <p>We also investigated the association between CTIP values and tumor deconvolution data in order to assess the association between the presence of specific immune cell types and overall tumor-immune interaction. Because the specific immune cell types were not ascertained in the data collection, deconvolution algorithms can offer an estimation of the relative prevalence of different types of immune cells. We obtained data from the Tumor Immune Estimation Resource 2.0 (TIMER 2.0): <ext-link xlink:href="http://timer.cistrome.org/" ext-link-type="uri">http://timer.cistrome.org/</ext-link>. Using data from TIMER2.0, we examined the association between the prevalence of different types of immune cells including CD8<sup>+</sup> T cells, Natural Killer cells, and B cells with biopsy level mean logit-CTIP. Among the available options from TIMER 2.0, we decided to use the MCP-counter algorithm (<xref rid="B10" ref-type="bibr">Becht et al., 2016</xref>) based on the analysis of <xref rid="B21" ref-type="bibr">Sturm et al., 2019</xref>, since it was judged to be most effective in detecting the presence and prevalence of the most relevant types of immune cells. We investigated the association of the score of each type of immune cell estimated by MCP-counter with biopsy level mean logit-CTIP using Spearman correlation (as done previously for gene expression). Significance was assessed using the standard test of statistical significance of Spearman correlation.</p>
        <p>After applying a Bonferroni correction (<italic>α</italic> = 0.05), we found that six different immune cell scores as computed by MCP-counter were significantly negatively associated with biopsy level mean logit-CTIP: CD8<sup>+</sup> T cells, B cells, Monocytes, Macrophages, Myeloid Dendritic Cells, and Natural Killer cells. No cell types were significantly positively associated with biopsy level mean logit-CTIP after the Bonferroni correction, though the magnitude of the positive association with Cancer Associated Fibroblasts (CAFs) is notable, and while not statistically significant still highly consistent with a truly positive underlying association between biopsy level CTIP and prevalence of CAFs. See <xref rid="F6" ref-type="fig">Figure 6</xref> and <xref rid="T2" ref-type="table">Table 2</xref> for full details on specific cell type score associations. CD8<sup>+</sup> T cells, B cells, and Natural Killer cells are generally associated with better prognosis in SKCM. This would imply, perhaps somewhat counterintuitively, that higher mean logit-CTIP would be expected to be associated with poorer survival, and lower levels of pathology assessment of lymphocyte infiltration. However, this is precisely what we observed, as discussed in next Section.</p>
        <fig position="float" id="F6">
          <label>FIGURE 6</label>
          <caption>
            <p>Volcano plot of association with deconvolution data. Negative log-10 <italic>p</italic>-values plotted against Spearman Correlation between CTIP and cell type prevalance scores estimated by MCP. Red line indicates Bonferroni correction, alpha = 0.05.</p>
          </caption>
          <graphic xlink:href="fgene-14-1175603-g006" position="float"/>
        </fig>
        <table-wrap position="float" id="T2">
          <label>TABLE 2</label>
          <caption>
            <p>Associations with cell prevalence. Cell type associated with average logit biopsy level CTIP. <italic>p</italic>-values are presented uncorrected; see <xref rid="F6" ref-type="fig">Figure 6</xref>.</p>
          </caption>
          <table frame="hsides" rules="groups">
            <thead valign="top">
              <tr>
                <th align="left" rowspan="1" colspan="1">Cell Type</th>
                <th align="left" rowspan="1" colspan="1">Spearman Correlation</th>
                <th align="left" rowspan="1" colspan="1"><italic>p</italic>-Value</th>
              </tr>
            </thead>
            <tbody valign="top">
              <tr>
                <td align="left" rowspan="1" colspan="1">T cell</td>
                <td align="left" rowspan="1" colspan="1">−0.13</td>
                <td align="left" rowspan="1" colspan="1">0.014</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">T cell CD8<sup>+</sup>
</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf33">
                    <mml:math id="m38" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">cytotoxicity score</td>
                <td align="left" rowspan="1" colspan="1">−0.13</td>
                <td align="left" rowspan="1" colspan="1">0.015</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">NK cell</td>
                <td align="left" rowspan="1" colspan="1">−0.17</td>
                <td align="left" rowspan="1" colspan="1">0.0025</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">B cell</td>
                <td align="left" rowspan="1" colspan="1">−0.21</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf34">
                    <mml:math id="m39" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Monocyte</td>
                <td align="left" rowspan="1" colspan="1">−0.19</td>
                <td align="left" rowspan="1" colspan="1">0.0004</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Macrophage/Monocyte</td>
                <td align="left" rowspan="1" colspan="1">−0.19</td>
                <td align="left" rowspan="1" colspan="1">0.0004</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Myeloid dendritic cell</td>
                <td align="left" rowspan="1" colspan="1">−0.18</td>
                <td align="left" rowspan="1" colspan="1">0.0012</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Neutrophil</td>
                <td align="left" rowspan="1" colspan="1">0.02</td>
                <td align="left" rowspan="1" colspan="1">0.75</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Endothelial cell</td>
                <td align="left" rowspan="1" colspan="1">0.06</td>
                <td align="left" rowspan="1" colspan="1">0.26</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Cancer associated fibroblast</td>
                <td align="left" rowspan="1" colspan="1">0.14</td>
                <td align="left" rowspan="1" colspan="1">0.0094</td>
              </tr>
            </tbody>
          </table>
        </table-wrap>
      </sec>
      <sec id="s3-2-4">
        <title>3.2.4 Association with phenotypic and clinical outcomes</title>
        <sec id="s3-2-4-1">
          <title>3.2.4.1 Transcriptomic classes and pathology asessments</title>
          <p><xref rid="B3" ref-type="bibr">Akbani et al. (2015)</xref> also identified three transcriptomic classes by applying consensus hierarchical clustering techniques to gene expression data from 1,500 genes: the “immune” subclass, the “keratin” subclass, and the “MITF-low” subclass. Most notably for our current application, the immune subclass was characterized by overexpression of genes associated with T cells, B cells, and Natural Killer cells. Of the patients classified using these methods, 235 were present in our data set. Of these 235, 114 (49%) were in the immune subclass, 78 (33%) were in the keratin subclass, and 43 (18%) were in the MITF-low subclass. <xref rid="F7" ref-type="fig">Figure 7</xref> demonstrates a clear visual difference between the immune subclass and both the MITF-low and keratin subclasses. In order to determine if these apparent differences were statistically significant, we analyzed the differences in average logit-CTIP between each pair of classes using a standard two-sided <italic>t</italic>-test, and found that the mean logit-CTIP in the immune class was significantly lower than either the keratin or the MITF-low subclass (<italic>p</italic> &lt; 10<sup>–5</sup> and <italic>p</italic> = 0.011, respectively). We found no significant difference between the mean logit-CTIP in the MITF-low subclass and the keratin subclass (<italic>p</italic> = 0.21). This is highly consistent with the results of the deconvolution analysis, which suggest that the degree of abundance of such cells are inversely associated with mean logit-CTIP.</p>
          <fig position="float" id="F7">
            <label>FIGURE 7</label>
            <caption>
              <p>Average CTIP by transcriptomic subclass and overall survival hazard ratios. <bold>(A)</bold> Average logit-CTIP by transcriptomic class according to <xref rid="B3" ref-type="bibr">Akbani et al. (2015)</xref>. <bold>(B)</bold> Hazard ratios from Cox Proportional Hazards models. Points at 1 indicate reference category. Age was standardized by subtracting the mean value and dividing by the standard deviation. Logit-CTIP was significantly associated with increased hazard of death (<italic>p</italic> = 0.019), while normalized logit-MCON was non-significantly associated with an increased hazard of death (<italic>p</italic> = 0.057) and normalized logit-G-cross was non-significantly associated with a decreased hazard of death (<italic>p</italic> = 0.32).</p>
            </caption>
            <graphic xlink:href="fgene-14-1175603-g007" position="float"/>
          </fig>
          <p>In addition to classifying the biopsies into transcriptomic subclasses, <xref rid="B3" ref-type="bibr">Akbani et al., 2015</xref> had pathologists assess biopsies for lymphocyte infiltration. Biopsies were scored from 0 to 3 on lymphocyte distribution, with 0 indicating no lymphocytes present in the tissue and 3 indicating that lymphocytes were present in over 50% of the tissue. They were also scored from 0 to 3 on lymphocyte density, with 0 indicating an absence of lymphocytes and 3 indicating a “severe” presence. These measures were added to create a Lymphocyte Score, a measure that ranged from 0 to 6 meant to summarize the general presence and degree of lymphocyte infiltration in that biopsy. Of the 235 patients in our sample that were assessed by the pathologists, 29% had a score of zero, 23% had a score of two, 10% had a score of three, 13% had a score of four, 15% had a score of five, and 9% had a score of six. Note that by definition of the component scores, a score of one is not possible. We performed a linear regression of Lymphocyte Score on mean biopsy level logit-CTIP, treating Lymphocyte Score as continuous. We found that a one unit increase in mean biopsy level logit-CTIP was highly significantly associated with a 0.45 unit decrease in mean Lymphocyte Score (<italic>p</italic> ≪ 0.0001). This result is also consistent with both previous results, and provide further evidence for the apparent negative association between mean logit-CTIP and the presence of specific immune cell types generally associated with positive prognosis.</p>
        </sec>
        <sec id="s3-2-4-2">
          <title>3.2.4.2 Survival analysis</title>
          <p>In order to assess association between logit-CTIP and overall survival, we fit a Cox Proportional Hazards model using clinical data as well as CTIP values. Clinical patient data were retrieved from the TCGA website and matched to biopsy images via TCGA identifier. In addition to adjusting for mean logit-CTIP, we adjusted for cancer stage, age in years, and sex. Age in years was standardized by subtracting the mean value and dividing by the standard deviation.</p>
          <p>Using this model, we found that after adjusting for other factors an increase in normalized logit-CTIP was significantly associated with increased hazard of death (<italic>p</italic> = 0.02). See <xref rid="F7" ref-type="fig">Figure 7</xref> for hazard ratio estimates and associated confidence intervals. In addition to this, we found that normalized age was significantly positively associated with an increased hazard of death (<italic>p</italic> &lt; 0.05), as was having stage 3 disease (relative to stage 1, <italic>p</italic> &lt; 0.05). Having stage 4 disease was positively associated with increased hazard of death, though not significantly. This is most likely due to the lack of patients with stage 4 disease in the data set.</p>
          <p>In order to assess the performance of CTIP relative to a more traditional measure of spatial association the same model was fitted with average logit-CTIP exchanged for the average value of the estimated G-cross function (discussed previously in <xref rid="s3-1" ref-type="sec">Section 3.1</xref>) as well as the Mark Connection Function (MCON). The Mark Connection Function is another natural point of comparison because it is a measure that is commonly used to investigate spatial associations between points with discrete marks, it is constrained to lie in [0,1] like CTIP, and it has been used elsewhere as a comparison point for similar survival modeling using spatial information (<xref rid="B31" ref-type="bibr">Li et al., 2019b</xref>). To produce a single value, the MCON function was evaluated at <italic>r</italic> = 30, which is the same as the radius of interaction used in our computation of CTIP as well as the G-cross function. Both G-cross and MCON values were logit-transformed. Because the values remained skewed even after logit-transform, they were subsequently centered and scaled by subtracting their respective mean and dividing by their respective standard deviation. While increased normalized logit-MCON was also associated with an increased hazard of death, the association was not significant (<italic>p</italic> = 0.057). The G-cross function was associated with a decreased hazard of death, though the association was also not significant (<italic>p</italic> = 0.32). <xref rid="F7" ref-type="fig">Figure 7</xref> summarizes the results across all three models.</p>
          <p>This result, along with the other results presented in this paper, provide evidence of an immune phenotype in SKCM that corresponds to poor prognosis from a number of different perspectives. With respect to overall survival, we have demonstrated that adjusting for other relevant clinical factors, an increase in CTIP is associated with an increased hazard of death. For gene expression data, average CTIP is associated with decreased expression of genes related to immune cells that are generally associated with good overall prognosis. And finally, we found that average CTIP is significantly lower in biopsies that have been classified as immune enriched through gene expression clustering, as well as biopsies that have been assessed by pathologists to have higher densities and spatial distributions of tumor infiltrating lymphocytes. These results fundamentally support the notion that CTIP is capturing an anti-immunogenic phenotype that is associated with poor prognosis, possibly due to an overall negative association with the presence of immune cells that are associated with improved prognosis such as CD8<sup>+</sup> T Cells and Natural Killer cells.</p>
        </sec>
      </sec>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s4">
    <title>4 Discussion</title>
    <p>The SPARTIN method provides a general framework for applying traditional spatial statistical techniques to whole biopsy imaging data. More specifically, it provides a modular algorithmic mechanism for partitioning the biopsies into more readily analyzable sub-regions that can be assessed for local spatial patterns using marked point process models. We have demonstrated the utility of such a method using a novel characterization of spatial cellular interaction, CTIP, that allows rigorous quantification of uncertainty and is highly intepretable. We demonstrate through simulation that CTIP can reliably distinguish between different patterns of spatial interaction across a range of different dependencies. We also demonstrate the utility of SPARTIN through a comprehensive analyses of an SKCM dataset, wherein we quantify and evaluate the spatial extent of tumor-immune infiltration and its association with genomic, phenotypic and clinical outcomes. These results are particularly suggestive in the context of SKCM. Melanoma has a uniquely rich literature regarding the potential applications of immunotherapy. While there are many factors that have contributed to this, not the least of which is the relative accessibility of skin cancers compared to other types of cancer, the net result is a far more mature understanding of immunotherapy in the context of melanoma than other types of cancer (<xref rid="B38" ref-type="bibr">Oble et al., 2009</xref>; <xref rid="B37" ref-type="bibr">Nguyen et al., 2010</xref>; <xref rid="B40" ref-type="bibr">Pitcovski et al., 2017</xref>). Thus, possible implications of the spatial immune organization in melanoma for immunotherapy may be more readily interpreted within the context of Melanoma than other cancer types, particularly as the ability to distinguish between different types of immune cells improves.</p>
    <p>The SPARTIN pipeline represents a valuable contribution in and of itself to digital pathology through its ability to model and quantify immune infiltration across entire biopsies in a way that captures meaningful variation along with uncertainty quantifications across patients. However, it also creates numerous opportunities for future work in this area. As algorithms for cell-level image classification improve, the opportunities for more and more detailed quantitative analysis of histopathological imaging data will become both more numerous and more fruitful. Specifically, as the ability to reliably distinguish between different types of immune cells will allow for more granular investigations into the prognoses associated with interaction between immune cells of different kinds and the tumor. Moreover, as spatial biology techniques (e.g., spatial multiplex imaging and spatial transcriptomics) evolve and data becomes abundant, so too will opportunities for synthesizing data on the relative spatial locations of different cell types along with cell or spot specific gene/protein expression data through rigorous, principled, and complex modeling. It would be straightforward (particularly in a Bayesian framework) to model a function of one or all of the parameters of interest as a linear combination of the local genes/proteins that are known to be relevant to immune response. Alternatively, future methods in this area could be developed at the intersection of spatial data and high-dimensional omic features.</p>
    <p>The SPARTIN pipeline could also be generalized for further investigation not directly related to assessing immune infiltration. Partitioning each biopsy into non-overlapping sub-regions invites the application of other tools from the spatial statistical catalogue to other relevant spatial features of the tumor microenvironment. In fact, SPARTIN can be utilized even when investigating features of the tumor that are not spatial in nature. So long as a feature (such as average tumor cell size) can be quantified at the cellular level and summarized locally at the level of sub-regions, SPARTIN provides a framework for mapping the variation of that feature across the entire biopsy.</p>
    <p>One limitation of this analysis is that immune cells were modeled as a single agglomerated class rather than as separate cell types belonging to the same family. While our results paint a consistent picture from several different angles, the exact mechanism of these various associations could be further refined by utilizing a more precise categorization of the various types of immune cells. It is worth emphasizing, however, that nothing about the structure of our pipeline depends on the presence of only one type of immune cell in addition to the cancer cells. The SPARTIN method can be generalized to multiple types cells through multicategory marked point process models, though this would raise additional computational and practical challenges. Another potential limitation of our analysis that suggests an avenue for future methodological development is the presence of repeated measurements within biopsies. Note that the result of fitting models on the partitioned tumor microenvironment is a set of repeated observations with some underlying spatial covariance structure related to the spatial relationships between the different subspaces. For now, we have ignored this spatial covariance, and instead chosen to summarize the variation at the biopsy level. While this does take into account local spatial dependencies (i.e., within tiles), it is possible that incorporating additional global spatial structure across the biopsy (i.e., between tiles) could lead to additional gains in efficiency, and possibly insight into the nature of the spatial variation in immune activation in the tumor microenvironment. Thus, future work will likely include the development of methods to efficiently analyze this complex structured areal data. Finally, it should be noted that the hierarchical Strauss model makes two important assumptions about the nature of the data, those of stationarity and isotropy. This essentially amounts to the assumption that on the level of the tiles for each biopsy on which the models are fit, the point process would be unaffected by horizontal translation (stationarity) or rotation (isotropy). Because tumor biopsies do not have a natural orientation in <inline-formula id="inf35"><mml:math id="m40" overflow="scroll"><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>, it is plausible to assume isotropy. Stationarity is somewhat more challenging to justify <italic>a priori</italic>. However, because the model fitting takes place on relatively small sub-sections of the biopsy, i.e., the “tile” specific level, it is quite plausible that this assumption is at least locally satisfied well enough. Since each tile is modeled using separate spatial parameters, this accounts for non-stationarity at a biopsy level and the ultimate measure of interest, CTIP, still yields a reliable estimate of the degree of interaction between cell types. Still, future work could involve employing methods that relax or eliminate these assumptions during the modeling of interaction.</p>
    <p>Software is available at <ext-link xlink:href="https://github.com/bayesrx/SPARTIN" ext-link-type="uri">https://github.com/bayesrx/SPARTIN</ext-link>. The website for the project, which features an application that can be used as a visualization companion to the software can be found at <ext-link xlink:href="https://nateosher.github.io/SPARTIN" ext-link-type="uri">https://nateosher.github.io/SPARTIN</ext-link>. Using the SPARTIN R package, data can be exported and visualized on the web application in order for users to interactively navigate the patterns of interaction at both the biopsy and individual tile level.</p>
  </sec>
</body>
<back>
  <sec sec-type="data-availability" id="s5">
    <title>Data availability statement</title>
    <p>The datasets presented in this study can be found in online repositories. The names of the repository/repositories and accession number(s) can be found in the article/<xref rid="s10" ref-type="sec">Supplementary Material</xref>.</p>
  </sec>
  <sec id="s6">
    <title>Author contributions</title>
    <p>NO and VB conceptualized the project. NO developed the idea for the partitioning of the biopsy and for cell type interaction probability, and wrote the introduction, methods, results, and conclusion section. VB and JK oversaw the creation, implementation and visualization of the analyses pipeline. AR oversaw the preprocessing and preparation of the data by SK, and SK also contributed to writing the results section. AR and SK also provided guidance on the interpretation of results. VB and JK reviewed the manuscript and provided feedback for its ultimate construction and form.</p>
  </sec>
  <sec sec-type="COI-statement" id="s8">
    <title>Conflict of interest</title>
    <p>AR serves as a member for Voxel analytics LLC. and consults for Genophyll, LLC.</p>
    <p>The remaining authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest.</p>
  </sec>
  <sec sec-type="disclaimer" id="s9">
    <title>Publisher’s note</title>
    <p>All claims expressed in this article are solely those of the authors and do not necessarily represent those of their affiliated organizations, or those of the publisher, the editors and the reviewers. Any product that may be evaluated in this article, or claim that may be made by its manufacturer, is not guaranteed or endorsed by the publisher.</p>
  </sec>
  <sec id="s10">
    <title>Supplementary material</title>
    <p>The Supplementary Material for this article can be found online at: <ext-link xlink:href="https://www.frontiersin.org/articles/10.3389/fgene.2023.1175603/full#supplementary-material" ext-link-type="uri">https://www.frontiersin.org/articles/10.3389/fgene.2023.1175603/full#supplementary-material</ext-link>
</p>
    <supplementary-material id="SM1" position="float" content-type="local-data">
      <media xlink:href="Presentation1.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="SM2" position="float" content-type="local-data">
      <media xlink:href="Table3.CSV">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="SM3" position="float" content-type="local-data">
      <media xlink:href="Table2.CSV">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="SM4" position="float" content-type="local-data">
      <media xlink:href="Table1.CSV">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="SM5" position="float" content-type="local-data">
      <media xlink:href="DataSheet1.CSV">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Achkar</surname><given-names>T.</given-names></name><name><surname>Tarhini</surname><given-names>A. A.</given-names></name></person-group> (<year>2017</year>). <article-title>The use of immunotherapy in the treatment of melanoma</article-title>. <source>J. Hematol. Oncol.</source>
<volume>10</volume> (<issue>1</issue>), <fpage>88</fpage>–<lpage>89</lpage>. <pub-id pub-id-type="doi">10.1186/s13045-017-0458-3</pub-id>
<pub-id pub-id-type="pmid">28434398</pub-id></mixed-citation>
    </ref>
    <ref id="B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Agresta</surname><given-names>L.</given-names></name><name><surname>KasperHoebe</surname><given-names>H. N.</given-names></name><name><surname>Janssen</surname><given-names>E. M.</given-names></name></person-group> (<year>2018</year>). <article-title>The emerging role of cd244 signaling in immune cells of the tumor microenvironment</article-title>. <source>Front. Immunol.</source>
<volume>9</volume>, <fpage>2809</fpage>. <comment>ISSN 1664-3224</comment>. <pub-id pub-id-type="doi">10.3389/fimmu.2018.02809</pub-id>
<pub-id pub-id-type="pmid">30546369</pub-id></mixed-citation>
    </ref>
    <ref id="B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Akbani</surname><given-names>R.</given-names></name><name><surname>Akdemir</surname><given-names>K. C.</given-names></name><name><surname>Aksoy</surname><given-names>B. A.</given-names></name><name><surname>Albert</surname><given-names>M.</given-names></name><name><surname>Ally</surname><given-names>A.</given-names></name><name><surname>Amin</surname><given-names>S. B.</given-names></name><etal/></person-group> (<year>2015</year>). <article-title>Genomic classification of cutaneous melanoma</article-title>. <source>Cell</source>
<volume>161</volume> (<issue>7</issue>), <fpage>1681</fpage>–<lpage>1696</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2015.05.044</pub-id>
<pub-id pub-id-type="pmid">26091043</pub-id></mixed-citation>
    </ref>
    <ref id="B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Amgad</surname><given-names>M.</given-names></name><name><surname>Sarkar</surname><given-names>A.</given-names></name><name><surname>Srinivas</surname><given-names>C.</given-names></name><name><surname>Redman</surname><given-names>R.</given-names></name><name><surname>Ratra</surname><given-names>S.</given-names></name><name><surname>Bechert</surname><given-names>C. J.</given-names></name><etal/></person-group> (<year>2019</year>). <article-title>Joint region and nucleus segmentation for characterization of tumor infiltrating lymphocytes in breast cancer</article-title>. <source>Med. Imaging 2019 Digit. Pathol.</source>
<volume>10956</volume>, <fpage>129</fpage>–<lpage>136</lpage>.</mixed-citation>
    </ref>
    <ref id="B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Antohe</surname><given-names>M.</given-names></name><name><surname>Nedelcu</surname><given-names>R.</given-names></name><name><surname>Nichita</surname><given-names>L.</given-names></name><name><surname>Popp</surname><given-names>C.</given-names></name><name><surname>Cioplea</surname><given-names>M.</given-names></name><name><surname>Brinzea</surname><given-names>A.</given-names></name></person-group> (<year>2019</year>). <article-title>Tumor infiltrating lymphocytes: The regulator of melanoma evolution</article-title>. <source>Oncol. Lett.</source>
<volume>17</volume>, <fpage>1792</fpage>–<lpage>1082</lpage>. <comment>ISSN 4155-4161</comment>. <pub-id pub-id-type="doi">10.3892/ol.2019.9940</pub-id>
</mixed-citation>
    </ref>
    <ref id="B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baddeley</surname><given-names>A.</given-names></name><name><surname>Turner</surname><given-names>R.</given-names></name></person-group> (<year>2000</year>). <article-title>Practical maximum pseudolikelihood for spatial point patterns: (with discussion)</article-title>. <source>Aust. N. Z. J. Statistics</source>
<volume>42</volume> (<issue>3</issue>), <fpage>283</fpage>–<lpage>322</lpage>. <pub-id pub-id-type="doi">10.1111/1467-842x.00128</pub-id>
</mixed-citation>
    </ref>
    <ref id="B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baddeley</surname><given-names>A.</given-names></name><name><surname>Turner</surname><given-names>R.</given-names></name></person-group> (<year>2005</year>). <article-title>Spatstat: An r package for analyzing spatial point patterns</article-title>. <source>J. Stat. Softw.</source>
<volume>12</volume>, <fpage>1</fpage>–<lpage>42</lpage>. <pub-id pub-id-type="doi">10.18637/jss.v012.i06</pub-id>
</mixed-citation>
    </ref>
    <ref id="B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bankhead</surname><given-names>P.</given-names></name><name><surname>Fernández</surname><given-names>J. A.</given-names></name><name><surname>McArt</surname><given-names>D. G.</given-names></name><name><surname>Boyle</surname><given-names>D. P.</given-names></name><name><surname>Li</surname><given-names>G.</given-names></name><name><surname>Loughrey</surname><given-names>M. B.</given-names></name><etal/></person-group> (<year>2018</year>). <article-title>Integrated tumor identification and automated scoring minimizes pathologist involvement and provides new insights to key biomarkers in breast cancer</article-title>. <source>Lab. Investig.</source>
<volume>98</volume> (<issue>1</issue>), <fpage>15</fpage>–<lpage>26</lpage>. <pub-id pub-id-type="doi">10.1038/labinvest.2017.131</pub-id>
<pub-id pub-id-type="pmid">29251737</pub-id></mixed-citation>
    </ref>
    <ref id="B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bankhead</surname><given-names>P.</given-names></name><name><surname>Loughrey</surname><given-names>M. B.</given-names></name><name><surname>Fernández</surname><given-names>J. A.</given-names></name><name><surname>Dombrowski</surname><given-names>Y.</given-names></name><name><surname>McArt</surname><given-names>D. G.</given-names></name><name><surname>Dunne</surname><given-names>P. D.</given-names></name><etal/></person-group> (<year>2017</year>). <article-title>Qupath: Open source software for digital pathology image analysis</article-title>. <source>Sci. Rep.</source>
<volume>7</volume> (<issue>1</issue>), <fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">28127051</pub-id></mixed-citation>
    </ref>
    <ref id="B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Becht</surname><given-names>E.</given-names></name><name><surname>Giraldo</surname><given-names>N. A.</given-names></name><name><surname>Lacroix</surname><given-names>L.</given-names></name><name><surname>Buttard</surname><given-names>B.</given-names></name><name><surname>Elarouci</surname><given-names>N.</given-names></name><name><surname>Petitprez</surname><given-names>F.</given-names></name></person-group> (<year>2016</year>). <article-title>Estimating the population abundance of tissue-infiltrating immune and stromal cell populations using gene expression</article-title>. <source>Genome Biol.</source>
<volume>17</volume> (<issue>1</issue>), <fpage>218</fpage>. <comment>ISSN 1474-760X</comment>. <pub-id pub-id-type="doi">10.1186/s13059-016-1070-5</pub-id>
<pub-id pub-id-type="pmid">27765066</pub-id></mixed-citation>
    </ref>
    <ref id="B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berger</surname><given-names>M. F.</given-names></name><name><surname>Hodis</surname><given-names>E.</given-names></name><name><surname>Heffernan</surname><given-names>T. P.</given-names></name><name><surname>Lawrence</surname><given-names>M. S.</given-names></name><name><surname>Protopopov</surname><given-names>A.</given-names></name><name><surname>Ivanova</surname><given-names>E.</given-names></name><etal/></person-group> (<year>2012</year>). <article-title>Melanoma genome sequencing reveals frequent prex2 mutations</article-title>. <source>Nature</source>
<volume>485</volume> (<issue>7399</issue>), <fpage>502</fpage>–<lpage>506</lpage>. <pub-id pub-id-type="doi">10.1038/nature11071</pub-id>
<pub-id pub-id-type="pmid">22622578</pub-id></mixed-citation>
    </ref>
    <ref id="B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bhattacharya</surname><given-names>S.</given-names></name><name><surname>Dunn</surname><given-names>P.</given-names></name><name><surname>Thomas</surname><given-names>C. G.</given-names></name><name><surname>Smith</surname><given-names>B.</given-names></name><name><surname>Schaefer</surname><given-names>H.</given-names></name><name><surname>Chen</surname><given-names>J.</given-names></name><etal/></person-group> (<year>2018</year>). <article-title>Immport, toward repurposing of open access immunological assay data for translational and clinical research</article-title>. <source>Sci. data</source>
<volume>5</volume> (<issue>1</issue>), <fpage>180015</fpage>–<lpage>180019</lpage>. <pub-id pub-id-type="doi">10.1038/sdata.2018.15</pub-id>
<pub-id pub-id-type="pmid">29485622</pub-id></mixed-citation>
    </ref>
    <ref id="B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bian</surname><given-names>Y.</given-names></name><name><surname>Liu</surname><given-names>Y. F.</given-names></name><name><surname>Jiang</surname><given-names>H.</given-names></name><name><surname>Meng</surname><given-names>Y.</given-names></name><name><surname>Liu</surname><given-names>F.</given-names></name><name><surname>Cao</surname><given-names>K.</given-names></name><etal/></person-group> (<year>2021</year>). <article-title>Machine learning for mri radiomics: A study predicting tumor-infiltrating lymphocytes in patients with pancreatic ductal adenocarcinoma</article-title>. <source>Abdom. Radiol.</source>
<volume>46</volume> (<issue>10</issue>), <fpage>4800</fpage>–<lpage>4816</lpage>. <pub-id pub-id-type="doi">10.1007/s00261-021-03159-9</pub-id>
</mixed-citation>
    </ref>
    <ref id="B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Breiman</surname><given-names>L.</given-names></name></person-group> (<year>2001</year>). <article-title>Random forests machine learning</article-title>. <source>Mach. Learn.</source>
<volume>45</volume>, <fpage>5</fpage>–<lpage>32</lpage>. <comment><italic>View Article PubMed/NCBI Google Scholar</italic></comment>. <pub-id pub-id-type="doi">10.1023/a:1010933404324</pub-id>
</mixed-citation>
    </ref>
    <ref id="B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Denkert</surname><given-names>C.</given-names></name><name><surname>Von Minckwitz</surname><given-names>G.</given-names></name><name><surname>Brase</surname><given-names>J. C.</given-names></name><name><surname>Bruno</surname><given-names>V. S.</given-names></name><name><surname>Gade</surname><given-names>S.</given-names></name><name><surname>Kronenwett</surname><given-names>R.</given-names></name><etal/></person-group> (<year>2015</year>). <article-title>Tumor-infiltrating lymphocytes and response to neoadjuvant chemotherapy with or without carboplatin in human epidermal growth factor receptor 2-positive and triple-negative primary breast cancers</article-title>. <source>J. Clin. Oncol.</source>
<volume>33</volume> (<issue>9</issue>), <fpage>983</fpage>–<lpage>991</lpage>. <pub-id pub-id-type="doi">10.1200/JCO.2014.58.1967</pub-id>
<pub-id pub-id-type="pmid">25534375</pub-id></mixed-citation>
    </ref>
    <ref id="B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dieci</surname><given-names>M. V.</given-names></name><name><surname>Radosevic-Robin</surname><given-names>N.</given-names></name><name><surname>Fineberg</surname><given-names>S.</given-names></name><name><surname>Van den Eynden</surname><given-names>G.</given-names></name><name><surname>Ternes</surname><given-names>N.</given-names></name><name><surname>Penault-Llorca</surname><given-names>F.</given-names></name><etal/></person-group> (<year>2018</year>). <article-title>Update on tumor-infiltrating lymphocytes (tils) in breast cancer, including recommendations to assess tils in residual disease after neoadjuvant therapy and in carcinoma <italic>in situ</italic>: A report of the international immuno-oncology biomarker working group on breast cancer</article-title>. <source>Seminars cancer Biol.</source>
<volume>52</volume>, <fpage>16</fpage>–<lpage>25</lpage>. <pub-id pub-id-type="doi">10.1016/j.semcancer.2017.10.003</pub-id>
</mixed-citation>
    </ref>
    <ref id="B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ertosun</surname><given-names>M. G.</given-names></name><name><surname>Rubin</surname><given-names>D. L.</given-names></name></person-group> (<year>2015</year>). <article-title>Automated grading of gliomas using deep learning in digital pathology images: A modular approach with ensemble of convolutional neural networks</article-title>. <source>AMIA Annu. Symp. Proc. AMIA Symp.</source>
<volume>2015</volume>, <fpage>1899</fpage>–<lpage>1908</lpage>. <comment>ISSN 1942-597X</comment>.,<pub-id pub-id-type="pmid">26958289</pub-id></mixed-citation>
    </ref>
    <ref id="B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Franklin</surname><given-names>E. L.</given-names></name><name><surname>Roesch</surname><given-names>A.</given-names></name><name><surname>Schilling</surname><given-names>B.</given-names></name><name><surname>Schadendorf</surname><given-names>D.</given-names></name></person-group> (<year>2017</year>). <article-title>Immunotherapy in melanoma: Recent advances and future directions</article-title>. <source>Eur. J. Surg. Oncol. (EJSO)</source>
<volume>43</volume> (<issue>3</issue>), <fpage>604</fpage>–<lpage>611</lpage>. <pub-id pub-id-type="doi">10.1016/j.ejso.2016.07.145</pub-id>
<pub-id pub-id-type="pmid">27769635</pub-id></mixed-citation>
    </ref>
    <ref id="B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fu</surname><given-names>Q.</given-names></name><name><surname>Chen</surname><given-names>N.</given-names></name><name><surname>Ge</surname><given-names>C.</given-names></name><name><surname>Li</surname><given-names>R.</given-names></name><name><surname>Li</surname><given-names>Z.</given-names></name><name><surname>Zeng</surname><given-names>B.</given-names></name><etal/></person-group> (<year>2019</year>). <article-title>Prognostic value of tumor-infiltrating lymphocytes in melanoma: A systematic review and meta-analysis</article-title>. <source>Oncoimmunology</source>
<volume>8</volume> (<issue>7</issue>), <fpage>e1593806</fpage>. <pub-id pub-id-type="doi">10.1080/2162402X.2019.1593806</pub-id>
</mixed-citation>
    </ref>
    <ref id="B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fuchs</surname><given-names>N.</given-names></name><name><surname>Meta</surname><given-names>M.</given-names></name><name><surname>Schuppan</surname><given-names>D.</given-names></name><name><surname>Lutz</surname><given-names>N.</given-names></name><name><surname>Schirmeister</surname><given-names>T.</given-names></name></person-group> (<year>2020</year>). <article-title>Novel opportunities for cathepsin s inhibitors in cancer immunotherapy by nanocarrier-mediated delivery</article-title>. <source>Cells</source>
<volume>9</volume> (<issue>9</issue>), <fpage>2021</fpage>. <comment>ISSN 2073-4409</comment>. <pub-id pub-id-type="doi">10.3390/cells9092021</pub-id>
<pub-id pub-id-type="pmid">32887380</pub-id></mixed-citation>
    </ref>
    <ref id="B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heindl</surname><given-names>A.</given-names></name><name><surname>Nawaz</surname><given-names>S.</given-names></name><name><surname>Yuan</surname><given-names>Y.</given-names></name></person-group> (<year>2015</year>). <article-title>Mapping spatial heterogeneity in the tumor microenvironment: A new era for digital pathology</article-title>. <source>Lab. Investig.</source>
<volume>95</volume> (<issue>4</issue>), <fpage>377</fpage>–<lpage>384</lpage>. <pub-id pub-id-type="doi">10.1038/labinvest.2014.155</pub-id>
<pub-id pub-id-type="pmid">25599534</pub-id></mixed-citation>
    </ref>
    <ref id="B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Högmander</surname><given-names>H.</given-names></name><name><surname>Aila</surname><given-names>S.</given-names></name></person-group> (<year>1999</year>). <article-title>Multitype spatial point patterns with hierarchical interactions</article-title>. <source>Biometrics</source>
<volume>55</volume> (<issue>4</issue>), <fpage>1051</fpage>–<lpage>1058</lpage>. <pub-id pub-id-type="doi">10.1111/j.0006-341x.1999.01051.x</pub-id>
<pub-id pub-id-type="pmid">11315047</pub-id></mixed-citation>
    </ref>
    <ref id="B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Idos</surname><given-names>G. E.</given-names></name><name><surname>Kwok</surname><given-names>J.</given-names></name><name><surname>Bonthala</surname><given-names>N.</given-names></name><name><surname>Lynn</surname><given-names>K.</given-names></name><name><surname>Gruber</surname><given-names>S. B.</given-names></name><name><surname>Qu</surname><given-names>C.</given-names></name><etal/></person-group> (<year>2020</year>). <article-title>The prognostic implications of tumor infiltrating lymphocytes in colorectal cancer: A systematic review and meta-analysis</article-title>. <source>Sci. Rep.</source>
<volume>10</volume> (<issue>1</issue>), <fpage>3360</fpage>. <pub-id pub-id-type="doi">10.1038/s41598-020-60255-4</pub-id>
<pub-id pub-id-type="pmid">32099066</pub-id></mixed-citation>
    </ref>
    <ref id="B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kang</surname><given-names>J.</given-names></name><name><surname>Johnson</surname><given-names>T. D.</given-names></name><name><surname>Nichols</surname><given-names>T. E.</given-names></name><name><surname>Tor</surname><given-names>D. W.</given-names></name></person-group> (<year>2011</year>). <article-title>Meta analysis of functional neuroimaging data via bayesian spatial point processes</article-title>. <source>J. Am. Stat. Assoc.</source>
<volume>106</volume> (<issue>493</issue>), <fpage>124</fpage>–<lpage>134</lpage>. <pub-id pub-id-type="doi">10.1198/jasa.2011.ap09735</pub-id>
<pub-id pub-id-type="pmid">21706069</pub-id></mixed-citation>
    </ref>
    <ref id="B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Khong</surname><given-names>H. T.</given-names></name><name><surname>Restifo</surname><given-names>N. P.</given-names></name></person-group> (<year>2002</year>). <article-title>Natural selection of tumor variants in the generation of “tumor escape” phenotypes</article-title>. <source>Nat. Immunol.</source>
<volume>3</volume> (<issue>11</issue>), <fpage>999</fpage>–<lpage>1005</lpage>. <pub-id pub-id-type="doi">10.1038/ni1102-999</pub-id>
<pub-id pub-id-type="pmid">12407407</pub-id></mixed-citation>
    </ref>
    <ref id="B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Khosravi</surname><given-names>P.</given-names></name><name><surname>Kazemi</surname><given-names>E.</given-names></name><name><surname>Imielinski</surname><given-names>M.</given-names></name><name><surname>Elemento</surname><given-names>O.</given-names></name><name><surname>Hajirasouliha</surname><given-names>I.</given-names></name></person-group> (<year>2018</year>). <article-title>Deep convolutional neural networks enable discrimination of heterogeneous digital pathology images</article-title>. <source>EBioMedicine</source>
<volume>27</volume>, <fpage>317</fpage>–<lpage>328</lpage>. <comment>ISSN 23523964</comment>. <pub-id pub-id-type="doi">10.1016/j.ebiom.2017.12.026</pub-id>
<pub-id pub-id-type="pmid">29292031</pub-id></mixed-citation>
    </ref>
    <ref id="B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>King</surname><given-names>R.</given-names></name><name><surname>Janine</surname><given-names>B. I.</given-names></name><name><surname>King</surname><given-names>S. E.</given-names></name><name><surname>Nightingale</surname><given-names>G. F.</given-names></name><name><surname>Hendrichsen</surname><given-names>D. K.</given-names></name></person-group> (<year>2012</year>). <article-title>A bayesian approach to fitting gibbs processes with temporal random effects</article-title>. <source>J. Agric. Biol. Environ. statistics</source>
<volume>17</volume> (<issue>4</issue>), <fpage>601</fpage>–<lpage>622</lpage>. <pub-id pub-id-type="doi">10.1007/s13253-012-0111-0</pub-id>
</mixed-citation>
    </ref>
    <ref id="B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Komura</surname><given-names>D.</given-names></name><name><surname>Ishikawa</surname><given-names>S.</given-names></name></person-group> (<year>2018</year>). <article-title>Machine learning methods for histopathological image analysis</article-title>. <source>Comput. Struct. Biotechnol. J.</source>
<volume>16</volume>, <fpage>34</fpage>–<lpage>42</lpage>. <pub-id pub-id-type="doi">10.1016/j.csbj.2018.01.001</pub-id>
<pub-id pub-id-type="pmid">30275936</pub-id></mixed-citation>
    </ref>
    <ref id="B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Q.</given-names></name><name><surname>Wang</surname><given-names>X.</given-names></name><name><surname>Liang</surname><given-names>F.</given-names></name><name><surname>Yi</surname><given-names>F.</given-names></name><name><surname>Xie</surname><given-names>Y.</given-names></name><name><surname>Gazdar</surname><given-names>A.</given-names></name><etal/></person-group> (<year>2019a</year>). <article-title>A bayesian hidden potts mixture model for analyzing lung cancer pathology images</article-title>. <source>Biostatistics</source>
<volume>20</volume> (<issue>4</issue>), <fpage>565</fpage>–<lpage>581</lpage>. <pub-id pub-id-type="doi">10.1093/biostatistics/kxy019</pub-id>
<pub-id pub-id-type="pmid">29788035</pub-id></mixed-citation>
    </ref>
    <ref id="B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Q.</given-names></name><name><surname>Wang</surname><given-names>X.</given-names></name><name><surname>Liang</surname><given-names>F.</given-names></name><name><surname>Xiao</surname><given-names>G.</given-names></name></person-group> (<year>2019b</year>). <article-title>A bayesian mark interaction model for analysis of tumor pathology images</article-title>. <source>Ann. Appl. statistics</source>
<volume>13</volume> (<issue>3</issue>), <fpage>1708</fpage>–<lpage>1732</lpage>. <pub-id pub-id-type="doi">10.1214/19-aoas1254</pub-id>
</mixed-citation>
    </ref>
    <ref id="B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lu</surname><given-names>Z.</given-names></name><name><surname>Xu</surname><given-names>S.</given-names></name><name><surname>Shao</surname><given-names>W.</given-names></name><name><surname>Wu</surname><given-names>Y.</given-names></name><name><surname>Zhang</surname><given-names>J.</given-names></name><name><surname>Han</surname><given-names>Z.</given-names></name><etal/></person-group> (<year>2020</year>). <article-title>Deep-learning–based characterization of tumor-infiltrating lymphocytes in breast cancers from histopathology images and multiomics data</article-title>. <source>JCO Clin. cancer Inf.</source>
<volume>4</volume>, <fpage>480</fpage>–<lpage>490</lpage>. <pub-id pub-id-type="doi">10.1200/CCI.19.00126</pub-id>
</mixed-citation>
    </ref>
    <ref id="B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mukherji</surname><given-names>B.</given-names></name></person-group> (<year>2013</year>). <article-title>Immunology of melanoma</article-title>. <source>Clin. Dermatology</source>
<volume>31</volume> (<issue>2</issue>), <fpage>156</fpage>–<lpage>165</lpage>. <comment>ISSN 0738081X</comment>. <pub-id pub-id-type="doi">10.1016/j.clindermatol.2012.08.017</pub-id>
</mixed-citation>
    </ref>
    <ref id="B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Negahbani</surname><given-names>F.</given-names></name><name><surname>Sabzi</surname><given-names>R.</given-names></name><name><surname>Firouzabadi</surname><given-names>D.</given-names></name><name><surname>Movahedi</surname><given-names>F.</given-names></name><name><surname>Kohandel Shirazi</surname><given-names>M.</given-names></name><name><surname>Majidi</surname><given-names>S.</given-names></name><etal/></person-group> (<year>2021</year>). <article-title>Pathonet introduced as a deep neural network backend for evaluation of ki-67 and tumor-infiltrating lymphocytes in breast cancer</article-title>. <source>Sci. Rep.</source>
<volume>11</volume> (<issue>1</issue>), <fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">33414495</pub-id></mixed-citation>
    </ref>
    <ref id="B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nguyen</surname><given-names>L. T.</given-names></name><name><surname>Pei</surname><given-names>H. Y.</given-names></name><name><surname>Nie</surname><given-names>J.</given-names></name><name><surname>Liadis</surname><given-names>N.</given-names></name><name><surname>Ghazarian</surname><given-names>D.</given-names></name><name><surname>Al-Habeeb</surname><given-names>A.</given-names></name><etal/></person-group> (<year>2010</year>). <article-title>Expansion and characterization of human melanoma tumor-infiltrating lymphocytes (tils)</article-title>. <source>PLoS ONE</source>
<volume>5</volume> (<issue>11</issue>), <fpage>e13940</fpage>. <comment>ISSN 1932-6203</comment>. <pub-id pub-id-type="doi">10.1371/journal.pone.0013940</pub-id>
<pub-id pub-id-type="pmid">21085676</pub-id></mixed-citation>
    </ref>
    <ref id="B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Oble</surname><given-names>D. A.</given-names></name><name><surname>Robert Loewe</surname></name><name><surname>Yu</surname><given-names>P.</given-names></name><name><surname>Martin</surname><given-names>C. M.</given-names><suffix>Jr</suffix></name></person-group> (<year>2009</year>). <article-title>Focus on tils: Prognostic significance of tumor infiltrating lymphocytes in human melanoma</article-title>. <source>Cancer Immun.</source>
<volume>9</volume>, <fpage>3</fpage>.<pub-id pub-id-type="pmid">19338264</pub-id></mixed-citation>
    </ref>
    <ref id="B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pagès</surname><given-names>F.</given-names></name><name><surname>Galon</surname><given-names>J.</given-names></name><name><surname>Dieu-Nosjean</surname><given-names>M-C.</given-names></name><name><surname>Tartour</surname><given-names>E.</given-names></name><name><surname>Sautès-Fridman</surname><given-names>C.</given-names></name><name><surname>Fridman</surname><given-names>W-H.</given-names></name></person-group> (<year>2010</year>). <article-title>Immune infiltration in human tumors: A prognostic factor that should not be ignored</article-title>. <source>Oncogene</source>
<volume>29</volume> (<issue>8</issue>), <fpage>1093</fpage>–<lpage>1102</lpage>. <comment>ISSN 0950-9232, 1476-5594</comment>. <pub-id pub-id-type="doi">10.1038/onc.2009.416</pub-id>
<pub-id pub-id-type="pmid">19946335</pub-id></mixed-citation>
    </ref>
    <ref id="B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pitcovski</surname><given-names>J.</given-names></name><name><surname>Shahar</surname><given-names>E.</given-names></name><name><surname>Aizenshtein</surname><given-names>E.</given-names></name><name><surname>Gorodetsky</surname><given-names>R.</given-names></name></person-group> (<year>2017</year>). <article-title>Melanoma antigens and related immunological markers</article-title>. <source>Crit. Rev. Oncology/Hematology</source>
<volume>115</volume>, <fpage>36</fpage>–<lpage>49</lpage>. <comment>ISSN 10408428</comment>. <pub-id pub-id-type="doi">10.1016/j.critrevonc.2017.05.001</pub-id>
</mixed-citation>
    </ref>
    <ref id="B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ray</surname><given-names>M.</given-names></name><name><surname>Kang</surname><given-names>J.</given-names></name><name><surname>Zhang</surname><given-names>H.</given-names></name></person-group> (<year>2015</year>). <article-title>Identifying activation centers with spatial cox point processes using fmri data</article-title>. <source>IEEE/ACM Trans. Comput. Biol. Bioinforma.</source>
<volume>13</volume> (<issue>6</issue>), <fpage>1130</fpage>–<lpage>1141</lpage>. <pub-id pub-id-type="doi">10.1109/TCBB.2015.2510007</pub-id>
</mixed-citation>
    </ref>
    <ref id="B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ruifrok</surname><given-names>A. C.</given-names></name><name><surname>Johnston</surname><given-names>D. A.</given-names></name><etal/></person-group> (<year>2001</year>). <article-title>Quantification of histochemical staining by color deconvolution</article-title>. <source>Anal. quantitative Cytol. histology</source>
<volume>23</volume> (<issue>4</issue>), <fpage>291</fpage>–<lpage>299</lpage>.</mixed-citation>
    </ref>
    <ref id="B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saltz</surname><given-names>J.</given-names></name><name><surname>Gupta</surname><given-names>R.</given-names></name><name><surname>Hou</surname><given-names>L.</given-names></name><name><surname>Kurc</surname><given-names>T.</given-names></name><name><surname>Singh</surname><given-names>P.</given-names></name><name><surname>Nguyen</surname><given-names>V.</given-names></name><etal/></person-group> (<year>2018</year>). <article-title>Spatial organization and molecular correlation of tumor-infiltrating lymphocytes using deep learning on pathology images</article-title>. <source>Cell Rep.</source>
<volume>23</volume> (<issue>1</issue>), <fpage>181</fpage>–<lpage>193.e7</lpage>. <pub-id pub-id-type="doi">10.1016/j.celrep.2018.03.086</pub-id>
<pub-id pub-id-type="pmid">29617659</pub-id></mixed-citation>
    </ref>
    <ref id="B43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Seal</surname><given-names>S.</given-names></name><name><surname>Ghosh</surname><given-names>D.</given-names></name></person-group> (<year>2022</year>). <article-title>Miami: Mutual information-based analysis of multiplex imaging data</article-title>. <source>Bioinformatics</source>, <volume>38</volume> (<issue>15</issue>):<fpage>3818</fpage>–<lpage>3826</lpage>. <comment>ISSN 1367-4803, 1460-2059</comment>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btac414</pub-id>
<pub-id pub-id-type="pmid">35748713</pub-id></mixed-citation>
    </ref>
    <ref id="B44">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Seal</surname><given-names>S.</given-names></name><name><surname>Vu</surname><given-names>T.</given-names></name><name><surname>Ghosh</surname><given-names>T.</given-names></name><name><surname>Wrobel</surname><given-names>J.</given-names></name><name><surname>Ghosh</surname><given-names>D.</given-names></name></person-group> (<year>2022</year>). <article-title>Denvar: Density-based variation analysis of multiplex imaging data</article-title>. <source>Bioinforma. Adv.</source>
<volume>2</volume> (<issue>1</issue>), <fpage>vbac039</fpage>. <comment>ISSN 2635-0041</comment>. <pub-id pub-id-type="doi">10.1093/bioadv/vbac039</pub-id>
</mixed-citation>
    </ref>
    <ref id="B45">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Strauss</surname><given-names>D. J.</given-names></name></person-group> (<year>1975</year>). <article-title>A model for clustering</article-title>. <source>Biometrika</source>
<volume>62</volume> (<issue>2</issue>), <fpage>467</fpage>–<lpage>475</lpage>. <pub-id pub-id-type="doi">10.1093/biomet/62.2.467</pub-id>
</mixed-citation>
    </ref>
    <ref id="B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sturm</surname><given-names>G.</given-names></name><name><surname>Finotello</surname><given-names>F.</given-names></name><name><surname>Petitprez</surname><given-names>F.</given-names></name><name><surname>Zhang</surname><given-names>J. D.</given-names></name><name><surname>Jan</surname><given-names>B.</given-names></name><name><surname>Fridman</surname><given-names>W. H.</given-names></name><etal/></person-group> (<year>2019</year>). <article-title>Comprehensive evaluation of transcriptome-based cell-type quantification methods for immuno-oncology</article-title>. <source>Bioinformatics</source>, <volume>35</volume>(<issue>14</issue>):<fpage>i436</fpage>–<lpage>i445</lpage>. <comment>ISSN 1367-4803, 1460-2059</comment>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btz363</pub-id>
<pub-id pub-id-type="pmid">31510660</pub-id></mixed-citation>
    </ref>
    <ref id="B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van Lieshout</surname><given-names>M. N. M.</given-names></name><name><surname>Baddeley</surname><given-names>A. J.</given-names></name></person-group> (<year>1999</year>). <article-title>Indices of dependence between types in multivariate point patterns</article-title>. <source>Scand. J. Statistics</source>, <volume>26</volume>(<issue>4</issue>):<fpage>511</fpage>–<lpage>532</lpage>. <comment>ISSN 0303-6898, 1467-9469</comment>. <pub-id pub-id-type="doi">10.1111/1467-9469.00165</pub-id>
</mixed-citation>
    </ref>
    <ref id="B46">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>S.</given-names></name><name><surname>Wang</surname><given-names>T.</given-names></name><name><surname>Yang</surname><given-names>L.</given-names></name><name><surname>Yang</surname><given-names>D. M.</given-names></name><name><surname>Fujimoto</surname><given-names>J.</given-names></name><name><surname>Yi</surname><given-names>F.</given-names></name><etal/></person-group> (<year>2019</year>). <article-title>Convpath: A software tool for lung adenocarcinoma digital pathological image analysis aided by a convolutional neural network</article-title>. <source>EBioMedicine</source>
<volume>50</volume>, <fpage>103</fpage>–<lpage>110</lpage>. <pub-id pub-id-type="doi">10.1016/j.ebiom.2019.10.033</pub-id>
<pub-id pub-id-type="pmid">31767541</pub-id></mixed-citation>
    </ref>
    <ref id="B47">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weaver</surname><given-names>J. D.</given-names></name><name><surname>Stack</surname><given-names>E. C.</given-names></name><name><surname>Buggé</surname><given-names>J. A.</given-names></name><name><surname>Hu</surname><given-names>C.</given-names></name><name><surname>McGrath</surname><given-names>L.</given-names></name><name><surname>Mueller</surname><given-names>A.</given-names></name><etal/></person-group> (<year>2022</year>). <article-title>Differential expression of ccr8 in tumors versus normal tissue allows specific depletion of tumor-infiltrating t regulatory cells by gs-1811, a novel fc-optimized anti-ccr8 antibody</article-title>. <source>OncoImmunology</source>
<volume>11</volume> (<issue>1</issue>), <fpage>2141007</fpage>. <comment>ISSN 2162-402X</comment>. <pub-id pub-id-type="doi">10.1080/2162402X.2022.2141007</pub-id>
<pub-id pub-id-type="pmid">36352891</pub-id></mixed-citation>
    </ref>
    <ref id="B48">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weiss</surname><given-names>S. A.</given-names></name><name><surname>Han</surname><given-names>S. W.</given-names></name><name><surname>Lui</surname><given-names>K.</given-names></name><name><surname>Tchack</surname><given-names>J.</given-names></name><name><surname>Berman</surname><given-names>R.</given-names></name><etal/></person-group> (<year>2016</year>). <article-title>Immunologic heterogeneity of tumor-infiltrating lymphocyte composition in primary melanoma</article-title>. <source>Hum. Pathol.</source>
<volume>57</volume>, <fpage>116</fpage>–<lpage>125</lpage>. <comment>ISSN 00468177</comment>. <pub-id pub-id-type="doi">10.1016/j.humpath.2016.07.008</pub-id>
<pub-id pub-id-type="pmid">27473267</pub-id></mixed-citation>
    </ref>
    <ref id="B50">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Yu-Sung</surname><given-names>S.</given-names></name><name><surname>Masanao</surname><given-names>Y.</given-names></name><name><surname>Yu-Sung</surname><given-names>M.</given-names></name></person-group> (<year>2015</year>). <source>Package ‘r2jags’. R package version 0.03-08</source>. <comment>Available at: <ext-link xlink:href="http://CRAN.R-project.org/package=R2jags" ext-link-type="uri">http://CRAN.R-project.org/package=R2jags</ext-link>
</comment>.</mixed-citation>
    </ref>
    <ref id="B51">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yuan</surname><given-names>Y.</given-names></name><name><surname>Failmezger</surname><given-names>H.</given-names></name><name><surname>Oscar</surname><given-names>M. R.</given-names></name><name><surname>Ali</surname><given-names>H. R.</given-names></name><name><surname>Gräf</surname><given-names>S.</given-names></name><name><surname>Chin</surname><given-names>S-F.</given-names></name><etal/></person-group> (<year>2012</year>). <article-title>Quantitative image analysis of cellular heterogeneity in breast tumors complements genomic profiling</article-title>. <source>Sci. Transl. Med.</source>
<volume>4</volume> (<issue>157</issue>), <fpage>157ra143</fpage>. <pub-id pub-id-type="doi">10.1126/scitranslmed.3004330</pub-id>
</mixed-citation>
    </ref>
    <ref id="B49">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>Y.</given-names></name><name><surname>Zhang</surname><given-names>Z.</given-names></name></person-group> (<year>2020</year>). <article-title>The history and advances in cancer immunotherapy: Understanding the characteristics of tumor-infiltrating immune cells and their therapeutic implications</article-title>. <source>Cell. Mol. Immunol.</source>, <volume>17</volume>(<issue>8</issue>):<fpage>807</fpage>–<lpage>821</lpage>. <comment>ISSN 1672-7681</comment>. <pub-id pub-id-type="doi">10.1038/s41423-020-0488-6</pub-id>
<pub-id pub-id-type="pmid">32612154</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
<?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName journalpublishing.dtd?>
<?SourceDTD.Version 2.3?>
<?ConverterInfo.XSLTName nlm2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Front Genet</journal-id>
    <journal-id journal-id-type="iso-abbrev">Front Genet</journal-id>
    <journal-id journal-id-type="publisher-id">Front. Genet.</journal-id>
    <journal-title-group>
      <journal-title>Frontiers in Genetics</journal-title>
    </journal-title-group>
    <issn pub-type="epub">1664-8021</issn>
    <publisher>
      <publisher-name>Frontiers Media S.A.</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10232864</article-id>
    <article-id pub-id-type="publisher-id">1175603</article-id>
    <article-id pub-id-type="doi">10.3389/fgene.2023.1175603</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Genetics</subject>
        <subj-group>
          <subject>Original Research</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>SPARTIN: a Bayesian method for the quantification and characterization of cell type interactions in spatial pathology data</article-title>
      <alt-title alt-title-type="left-running-head">Osher et al.</alt-title>
      <alt-title alt-title-type="right-running-head">
        <ext-link xlink:href="https://doi.org/10.3389/fgene.2023.1175603" ext-link-type="uri">10.3389/fgene.2023.1175603</ext-link>
      </alt-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <name>
          <surname>Osher</surname>
          <given-names>Nathaniel</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="c001" ref-type="corresp">*</xref>
        <uri xlink:href="https://loop.frontiersin.org/people/2213637/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Kang</surname>
          <given-names>Jian</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/148472/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Krishnan</surname>
          <given-names>Santhoshi</given-names>
        </name>
        <xref rid="aff2" ref-type="aff">
          <sup>2</sup>
        </xref>
        <xref rid="aff3" ref-type="aff">
          <sup>3</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/1470327/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rao</surname>
          <given-names>Arvind</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="aff2" ref-type="aff">
          <sup>2</sup>
        </xref>
        <xref rid="aff3" ref-type="aff">
          <sup>3</sup>
        </xref>
        <xref rid="aff4" ref-type="aff">
          <sup>4</sup>
        </xref>
        <xref rid="aff5" ref-type="aff">
          <sup>5</sup>
        </xref>
        <uri xlink:href="https://loop.frontiersin.org/people/1177294/overview"/>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Baladandayuthapani</surname>
          <given-names>Veerabhadran</given-names>
        </name>
        <xref rid="aff1" ref-type="aff">
          <sup>1</sup>
        </xref>
        <xref rid="aff2" ref-type="aff">
          <sup>2</sup>
        </xref>
      </contrib>
    </contrib-group>
    <aff id="aff1"><sup>1</sup><institution>Department of Biostatistics</institution>, <institution>University of Michigan</institution>, <addr-line>Ann Arbor</addr-line>, <addr-line>MI</addr-line>, <country>United States</country></aff>
    <aff id="aff2"><sup>2</sup><institution>Department of Computational Medicine and Bioinformatics</institution>, <institution>University of Michigan</institution>, <addr-line>Ann Arbor</addr-line>, <addr-line>MI</addr-line>, <country>United States</country></aff>
    <aff id="aff3"><sup>3</sup><institution>Department of Electrical and Computer Engineering</institution>, <institution>Rice University</institution>, <addr-line>Houston</addr-line>, <addr-line>TX</addr-line>, <country>United States</country></aff>
    <aff id="aff4"><sup>4</sup><institution>Department of Radiation Oncology</institution>, <institution>University of Michigan</institution>, <addr-line>Ann Arbor</addr-line>, <addr-line>MI</addr-line>, <country>United States</country></aff>
    <aff id="aff5"><sup>5</sup><institution>Department of Biomedical Engineering</institution>, <institution>University of Michigan</institution>, <addr-line>Ann Arbor</addr-line>, <addr-line>MI</addr-line>, <country>United States</country></aff>
    <author-notes>
      <fn fn-type="edited-by">
        <p><bold>Edited by:</bold><ext-link xlink:href="https://loop.frontiersin.org/people/258592/overview" ext-link-type="uri">Himel Mallick</ext-link>, Cornell University, United States</p>
      </fn>
      <fn fn-type="edited-by">
        <p><bold>Reviewed by:</bold><ext-link xlink:href="https://loop.frontiersin.org/people/2125109/overview" ext-link-type="uri">Boyu Ren</ext-link>, McLean Hospital, United States</p>
        <p><ext-link xlink:href="https://loop.frontiersin.org/people/2123252/overview" ext-link-type="uri">Federico Ferrari</ext-link>, Merck, United States</p>
        <p><ext-link xlink:href="https://loop.frontiersin.org/people/2200778/overview" ext-link-type="uri">Piyali Basak</ext-link>, Merck, United States</p>
      </fn>
      <corresp id="c001">*Correspondence: Nathaniel Osher, <email>oshern@umich.edu</email>
</corresp>
    </author-notes>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>5</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>1175603</elocation-id>
    <history>
      <date date-type="received">
        <day>27</day>
        <month>2</month>
        <year>2023</year>
      </date>
      <date date-type="accepted">
        <day>25</day>
        <month>4</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2023 Osher, Kang, Krishnan, Rao and Baladandayuthapani.</copyright-statement>
      <copyright-year>2023</copyright-year>
      <copyright-holder>Osher, Kang, Krishnan, Rao and Baladandayuthapani</copyright-holder>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License (CC BY). The use, distribution or reproduction in other forums is permitted, provided the original author(s) and the copyright owner(s) are credited and that the original publication in this journal is cited, in accordance with accepted academic practice. No use, distribution or reproduction is permitted which does not comply with these terms.</license-p>
      </license>
    </permissions>
    <abstract>
      <p><bold>Introduction:</bold> The acquisition of high-resolution digital pathology imaging data has sparked the development of methods to extract context-specific features from such complex data. In the context of cancer, this has led to increased exploration of the tumor microenvironment with respect to the presence and spatial composition of immune cells. Spatial statistical modeling of the immune microenvironment may yield insights into the role played by the immune system in the natural development of cancer as well as downstream therapeutic interventions.</p>
      <p><bold>Methods:</bold> In this paper, we present SPatial Analysis of paRtitioned Tumor-Immune imagiNg (SPARTIN), a Bayesian method for the spatial quantification of immune cell infiltration from pathology images. SPARTIN uses Bayesian point processes to characterize a novel measure of local tumor-immune cell interaction, Cell Type Interaction Probability (CTIP). CTIP allows rigorous incorporation of uncertainty and is highly interpretable, both within and across biopsies, and can be used to assess associations with genomic and clinical features.</p>
      <p><bold>Results:</bold> Through simulations, we show SPARTIN can accurately distinguish various patterns of cellular interactions as compared to existing methods. Using SPARTIN, we characterized the local spatial immune cell infiltration within and across 335 melanoma biopsies and evaluated their association with genomic, phenotypic, and clinical outcomes. We found that CTIP was significantly (negatively) associated with deconvolved immune cell prevalence scores including CD8+ T-Cells and Natural Killer cells. Furthermore, average CTIP scores differed significantly across previously established transcriptomic classes and significantly associated with survival outcomes.</p>
      <p><bold>Discussion:</bold> SPARTIN provides a general framework for investigating spatial cellular interactions in high-resolution digital histopathology imaging data and its associations with patient level characteristics. The results of our analysis have potential implications relevant to both treatment and prognosis in the context of Skin Cutaneous Melanoma. The R-package for SPARTIN is available at <ext-link xlink:href="https://github.com/bayesrx/SPARTIN" ext-link-type="uri">https://github.com/bayesrx/SPARTIN</ext-link> along with a visualization tool for the images and results at: <ext-link xlink:href="https://nateosher.github.io/SPARTIN" ext-link-type="uri">https://nateosher.github.io/SPARTIN</ext-link>.</p>
    </abstract>
    <kwd-group>
      <kwd>Bayesian modeling</kwd>
      <kwd>digital pathology</kwd>
      <kwd>hierarchical strauss models</kwd>
      <kwd>spatial point processes</kwd>
      <kwd>tumor-immune microenvironments</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source id="cn001">
          <institution-wrap>
            <institution>National Institutes of Health
</institution>
            <institution-id institution-id-type="doi">10.13039/100000002</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn001">R01CA244845-01A1 R01DA048993 P30 CA46592 R01MH105561 R01GM124061</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn003">
          <institution-wrap>
            <institution>National Cancer Institute
</institution>
            <institution-id institution-id-type="doi">10.13039/100000054</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn003">5 P30 CA046592 R37-CA214955 5T32CA083654-18</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn005">
          <institution-wrap>
            <institution>American Cancer Society
</institution>
            <institution-id institution-id-type="doi">10.13039/100000048</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn005">RSG-16-005-01</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn008">
          <institution-wrap>
            <institution>Division of Mathematical Sciences
</institution>
            <institution-id institution-id-type="doi">10.13039/100000121</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn008">1463233</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn009">
          <institution-wrap>
            <institution>Division of Information and Intelligent Systems
</institution>
            <institution-id institution-id-type="doi">10.13039/100000145</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id award-type="contract" rid="cn009">2123777</award-id>
      </award-group>
      <award-group>
        <funding-source id="cn002">
          <institution-wrap>
            <institution>Rogel Cancer Center, University of Michigan
</institution>
            <institution-id institution-id-type="doi">10.13039/100017065</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group>
        <funding-source id="cn004">
          <institution-wrap>
            <institution>Agilent Technologies
</institution>
            <institution-id institution-id-type="doi">10.13039/100004322</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group>
        <funding-source id="cn006">
          <institution-wrap>
            <institution>Michigan Institute for Data Science, University of Michigan
</institution>
            <institution-id institution-id-type="doi">10.13039/100015711</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
      <award-group>
        <funding-source id="cn007">
          <institution-wrap>
            <institution>University of Michigan
</institution>
            <institution-id institution-id-type="doi">10.13039/100007270</institution-id>
          </institution-wrap>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <funding-statement>VB was supported by NIH grants R01CA244845-01A1, and P30 CA46592 (Cancer Data Science Shared Resource), NSF grant 1463233, and start-up funds from the U-M Rogel Cancer Center and School of Public Health. JK was supported by NIH grants R01DA048993, R01MH105561 and R01GM124061 and NSF grant IIS2123777. AR and SK were supported by CCSG Bioinformatics Shared Resource 5 P30 CA046592, a gift from Agilent technologies, a Research Scholar Grant from the American Cancer Society (RSG-16-005-01), a Precision health Investigator award from U-M Precision Health to AR along with L. Rozek and M. Sartor, and a University of Michigan MIDAS PODS Grant. SK, VB, and AR were partially supported by the NCI Grant R37-CA214955. SK and AR were also partially supported by The University of Michigan (U-M) startup institutional research funds. NO was supported by the cancer biostatistical training grant #5T32CA083654-18.</funding-statement>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>section-at-acceptance</meta-name>
        <meta-value>Computational Genomics</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="s1">
    <title>1 Introduction</title>
    <p>While the staining and examination of tissue samples has been a ubiquitous medical practice for decades, it has only been relatively recently that high-resolution pathology images of such stainings have begun to be explored through the lens of formal quantitative models (<xref rid="B22" ref-type="bibr">Heindl et al., 2015</xref>). A considerable amount of work has thus far been put into building and training statistical and machine learning models capable of accurate classifications of overall tissue samples as well as subsections of tissue samples (<xref rid="B4" ref-type="bibr">Amgad et al., 2019</xref>; <xref rid="B33" ref-type="bibr">Lu et al., 2020</xref>; <xref rid="B13" ref-type="bibr">Bian et al., 2021</xref>; <xref rid="B36" ref-type="bibr">Negahbani et al., 2021</xref>). In the context of cancer this work, often referred to as <italic>Histopathological Image Analysis</italic> or <italic>Digital Pathology</italic>, encompasses a broad collection of methods and goals ranging from developing models to assist in the quantitative scoring and staging of cancer biopsies to the classification of cells in tumor biopsies (<xref rid="B30" ref-type="bibr">Komura and Ishikawa, 2018</xref>). The value of these methods have important implications for basic science and translational research. Given the precision with which such algorithms can assess biopsies at a cellular level, it is now possible to uncover structures and associations which might not immediately apparent to human pathologists. This degree of precision also allows for rigorous modeling and examination of intratumoral heterogeneity with respect to their genomic determinants and clinical characteristics (<xref rid="B25" ref-type="bibr">Saltz et al., 2018</xref>; <xref rid="B32" ref-type="bibr">Li et al., 2019a</xref>).</p>
    <p>Several research works in the past decade provide evidence regarding the importance of this line of investigation, especially for quantifying tumor-immune cellular interactions in cancer. <xref rid="B39" ref-type="bibr">Pagès et al. (2010)</xref> proposed immune reaction as the seventh hallmark of cancer, and laid out different associations between various types of immune cells and outcomes of interest. Among the different types of immune cells, the most well-studied are lymphocytes. Lymphocyte infiltration is both a meaningful prognostic indicator that can help inform treatment and predict survival across different types of cancer, including in colorectal cancer (<xref rid="B24" ref-type="bibr">Idos et al., 2020</xref>), breast cancer (<xref rid="B15" ref-type="bibr">Denkert et al., 2015</xref>; <xref rid="B16" ref-type="bibr">Dieci et al., 2018</xref>), and melanoma (<xref rid="B19" ref-type="bibr">Fu et al., 2019</xref>). This has led to increased interest in computational Tumor Infiltrating Lymphocyte (TIL) assessment, a sub-field of digital pathology devoted to developing computational methods to assess lymphocyte infiltration in biopsy images. Thus far, results that have emerged from this research have provided additional evidence regarding the importance of tumor infiltrating lymphocytes and their spatial features in the assessment of pathology images. <xref rid="B25" ref-type="bibr">Saltz et al. (2018)</xref> specifically examined the presence of lymphocytes across biopsies in several types of cancer, and found that certain summarization metrics of lymphocyte clusters were significantly associated with survival in certain types of cancer. <xref rid="B33" ref-type="bibr">Lu et al. (2020)</xref> also found that various spatial features of tumor infiltrating lymphocytes present in a sample of breast cancer biopsies were significantly associated with survival both marginally and after adjusting for other factors. Further, they found that these associations actually differed by tumor subtype. In addition to this, they found that certain spatial features of tumor infiltrating lymphocytes were also significantly associated with gene expression data.</p>
    <p>From an analytical perspective, digital pathology research can be broadly classified along two axes: the type of quantitative models, and the scale of the assessment. Quantitative models range from primarily machine-learning in nature to primarily statistical. The most obvious way this difference manifests is in the models and methods used. Machine learning approaches tend to use tools like deep learning and convolutional neural networks and focus on predictive accuracy (<xref rid="B28" ref-type="bibr">Khosravi et al., 2018</xref>), while statistical approaches tend to use specialized model-based spatial methods and focus more on the quantification of uncertainty (<xref rid="B44" ref-type="bibr">Seal et al., 2022</xref>). The scale of assessment, on the other hand, relates to how much of the biopsy is used. Some methods operate on sub-regions of the biopsy images while others operate at the level of the entire biopsy (<xref rid="B17" ref-type="bibr">Ertosun and Rubin, 2015</xref>; <xref rid="B31" ref-type="bibr">Li et al., 2019b</xref>).</p>
    <p>In theory, these two qualities-type of research and scale of assessment-are independent. In practice, methods that use machine learning approaches tend to operate on whole biopsy images or data, while statistical approaches tend to operate on sub-regions of images, or substantially smaller biopsies as with multiplex imaging data analysis (<xref rid="B43" ref-type="bibr">Seal and Ghosh, 2022</xref>). There has been limited work to build off of the cell classification abilities of modern machine learning methods at the level of full biopsy imaging. There are two probable reasons for this. First, many statistical methods designed for usage with spatial data rely on the definition of a window in which the analysis occurs. For biopsies, such a window is not readily defined, except in deliberately chosen sub-regions. While such issues can be avoided by using methods that do not rely on an explicit window, this tends to introduce additional computational challenges that may not scale to the biopsy level, especially as biopsy size and resolution increases. Second, even if one were to define a singular window for the entire biopsy, applying spatial methods across the entire space may prove problematic. In addition to being computationally intensive, it is not clear that measures of various local spatial characteristics summarized at the biopsy level are able to capture the heterogeneity across the biopsy, and thus may not be informative enough to be useful in practice. For these reasons, there has been limited work in development of spatial statistical models that use cell classification data from full biopsy images. To the author’s knowledge, the most notable attempts to do so have been <xref rid="B31" ref-type="bibr">Li et al. (2019b)</xref>’s work which utilized data classified by the ConvPath pipeline (<xref rid="B46" ref-type="bibr">Wang et al., 2019</xref>).</p>
    <p>In order to address these issues, we propose SPARTIN (SPatial Analysis of paRtitioned Tumor-Immune imagiNg) pipeline. SPARTIN is unique in the spatial pathological imaging analysis literature in that it uses spatial statistical models to assess the association between tumor cells and immune cells across an entire partitioned biopsy, rather than select sub-regions. This allows for rigorous quantification of uncertainty in the style of <xref rid="B31" ref-type="bibr">Li et al., 2019b</xref> while still allowing for the assessment of full images in the style of <xref rid="B25" ref-type="bibr">Saltz et al. (2018)</xref>. We accomplish this by partitioning the cell-level imaging data of each biopsy into non-overlapping sub-regions, which can then be modeled to capture the local infiltration patterns using techniques from spatial point process theory. Spatial point processes have long been used in the domain of ecology to rigorously investigate spatial relationships between various organisms (<xref rid="B23" ref-type="bibr">Högmander and Aila, 1999</xref>; <xref rid="B29" ref-type="bibr">King et al., 2012</xref>). More recently, methods from this field have been successfully applied within the biomedical domain to functional neuroimaging and magnetic resonance imaging data (<xref rid="B26" ref-type="bibr">Kang et al., 2011</xref>; <xref rid="B41" ref-type="bibr">Ray et al., 2015</xref>). Briefly SPARTIN uses whole slide images of biopsies that are partitioned into sub-regions using an iterative clustering algorithm and a Bayesian spatial marked point process model is then fit on each sub-region (see <xref rid="F1" ref-type="fig">Figure 1</xref>). We discuss the constructions and justifications behind the choice of models underlying SPARTIN in <xref rid="s2" ref-type="sec">Section 2</xref>. Using our model parameters, we construct a measure of local immune cell infiltration, termed <italic>Cell Type Interaction Probability</italic> (CTIP) that allows rigorous incorporation of uncertainty and is highly interpretable (on a probability scale) both within and across biopsies, and can be used to assess associations with genomic and clinical features. We evaluate the performance of SPARTIN on simulated data across multiple scenarios of cell interactions (<xref rid="s3-1" ref-type="sec">Section 3.1</xref>) and show that our models are able to reliably distinguish positive interaction from negative and null interaction under a variety of scenarios (minimum AUC 0.85, maximum 0.97).</p>
    <fig position="float" id="F1">
      <label>FIGURE 1</label>
      <caption>
        <p>Overview of SPARTIN pipeline for single biopy image. Raw biopsy images <bold>(A)</bold> are preprocessed into cell types (tumor cells or immune cells, colored black and red respectively) and locations. The points are intensity thresholded, removing excess white space from the image and producing a more closely fitted window <bold>(B)</bold>. Next, the biopsy is tessellated into “tiles” consisting of non-overlapping sub-regions containing comparable numbers of tumor cells <bold>(C)</bold>. Bayesian Spatial point process models are fit on each tile <bold>(D)</bold>, and tile-specific Cell Type Interaction Probability (CTIP) is calculated from the resulting posterior distributions <bold>(E)</bold>, allowing us to capture heterogeneity in infiltration across the biopsy in a manner that can be aggregated <bold>(F)</bold> and appropriately summarized <bold>(G)</bold>.</p>
      </caption>
      <graphic xlink:href="fgene-14-1175603-g001" position="float"/>
    </fig>
    <p>We demonstrate the utility of SPARTIN on a Skin Cutaneous Melanoma dataset consisting of 335 biopsies obtained from The Cancer Genome Atlas (TCGA) Genomic Data Commons Data Portal (<xref rid="s3-2" ref-type="sec">Section 3.2</xref>). Our scientific goals are to quantify and characterize local spatial immune cell infiltration within and across melanoma biopsies and evaluate their association with genomic, phenotypic, and clinical outcomes. Using local spatial infiltration patterns quantified using CTIP, we found that CTIP was significantly negatively associated deconvolved immune cell prevalence scores including <italic>CD</italic>8+ T-Cells and Natural Killer cells. Furthermore, average CTIP scores differed significantly across previously established transcriptomic classes in melanoma (<xref rid="B3" ref-type="bibr">Akbani et al., 2015</xref>). CTIP was also more significantly associated with increased hazard of death, as compared to existing measures of spatial interaction. Beyond the inverse association with survival we found that CTIP was significantly inversely associated with clinical assessment of TIL abundance. Finally, we discuss the implications of this pipeline as well as potential future directions for the work (<xref rid="s4" ref-type="sec">Section 4</xref>).</p>
  </sec>
  <sec sec-type="materials|methods" id="s2">
    <title>2 Materials and methods</title>
    <sec id="s2-1">
      <title>2.1 Overview of SPARTIN</title>
      <p>The overall schematic of the SPARTIN pipeline (for a single biopsy image) is shown in <xref rid="F1" ref-type="fig">Figure 1</xref>. Briefly, for each whole-slide image of a biopsy (Panel A), the smallest window that fit all cells (Tumor and Immune) in the entire biopsy is constructed by thresholding the image intensity (Panel B). This window is then divided into “tiles” via a tessellation process that fully partitions the image into contiguous sub-regions containing similar numbers of tumor cells (Panel C; zoomed in version in Panel D). A Bayesian spatial point process model is then fit on each of these tiles separately, yielding a posterior distribution of the local interaction parameter (Panel E). For each tile, this local distribution is compared to a tile-specific null distribution to compute the local CTIP value, which is then combined to summarize the overall level of interaction at the biopsy level (Panel G). Each of these steps in detailed in the ensuing sections.</p>
    </sec>
    <sec id="s2-2">
      <title>2.2 Intensity thresholding and partition</title>
      <sec id="s2-2-1">
        <title>2.2.1 Motivation for partition</title>
        <p>Each biopsy was partitioned into non-overlapping sub-regions, each of which was modeled separately as a point process. The primary motivation for structuring the analysis in this manner came from prior biological knowledge about tumor composition. Tumors are heterogeneous entities in many respects, and immune infiltration is no exception. Tumor biopsies can also be quite large relative to the scale on which interaction is defined. While we used a radius of interaction of 30 microns, some biopsies in our sample comprised tens if not hundreds of thousands of square microns of tissue. Additionally, setting aside practical computational issues with fitting a single model on an entire biopsy, such an approach would also both fail to capture spatial variability in immune infiltration and fail to allow for a more granular spatial investigation of the immune infiltration in a given biopsy. A natural way to improve over this method is to algorithmically partition the biopsy into non-overlapping sub-regions and fit models on each sub-region. Aside from better capturing the spatial variability of immune infiltration, an additional benefit of this method is that it allows for the parallelization of model fitting across the resulting sub-regions within a single biopsy. Much like selecting a quadrature when approximating an integral, calibrating the fineness of the partition entails a tradeoff between the precision with which one can assess the spatial heterogeneity within the biopsy and the computational load that a finer partition entails.</p>
      </sec>
      <sec id="s2-2-2">
        <title>2.2.2 Partition pipeline</title>
        <p>In order to partition a given biopsy into non-overlapping sub-regions, we began with the smallest bounding rectangular window that contained all cells. We then applied an intensity thresholding algorithm in order to find the smallest possible window that still contained all cells. This was accomplished by breaking the full image up into small (∼15 microns<sup>2</sup>) sub-windows, and computing a smoothed cell intensity on each sub-window. Sub-windows which had a sufficiently high intensity were combined to form the overall window on which the subsequent partition took place. The final window can thus be thought of as the union of many small square windows which, due to their size, are able to fit the contours of the differently shaped biopsies and exclude areas both outside and within the biopsies where no cells are present. The algorithm takes in three tuning parameters that determine the resulting partition. The same values for all three parameters were used across all biopsies, and the values themselves were selected through empirical tuning on a subset of the total dataset. For more details on the parameters themselves, see <xref rid="s10" ref-type="sec">Supplementary Section S3</xref>.</p>
        <p>Next, we applied a voronoi tessellation to the tumor cells within the intensity thresholded window, partitioning it into tumor cell specific sub-windows. We then applied a modified version of K-means to the tumor cells, such that each of the resulting clusters was constrained to be between a pre-defined range of cell counts. Finally, each tumor cell specific sub-window within a given cluster was combined into a tile, corresponding to each of the clusters from the K-means clustering; see <xref rid="F1" ref-type="fig">Figure 1</xref> for an illustration of the process. This results in a set of tiles that fully partition the intensity thresholded window. This partition uniquely defines the membership of each of the total cells (tumor or immune) into one of the resulting tiles. Because each resulting tile has a well-defined boundary and each cell in the biopsy belongs to exactly one tile, a hierarchical Strauss model can be fit on each tile to compute a tile specific value of each parameter in the model. Most notably, this allows for the estimation of a tile-specific CTIP value, which captures the local degree of tumor cell-immune cell interaction. By modeling this parameter locally to each tile, we are able to capture not only the overall level of infiltration in the biopsy, but also the potentially spatially heterogeneous nature of the infiltration.</p>
        <p>It is worth emphasizing at this point the modular nature of our pipeline. The clustering method does not depend on the details of the model used, and the model in turn does not depend on details of the clustering method. Either can be exchanged for a different algorithm or model without disrupting the rest of the pipeline, so long as the output of the clustering algorithm is a spatial partition of the biopsy. Further, while the value ultimately selected to summarize the local infiltration at the tile level will obviously be informed by the exact model selected, there is flexibility in the choice of this quantity as well.</p>
      </sec>
    </sec>
    <sec id="s2-3">
      <title>2.3 Spatial point process models</title>
      <sec id="s2-3-1">
        <title>2.3.1 Data structure</title>
        <p>Let <italic>N</italic> be the number of biopsies, each with <italic>N</italic>
<sub><italic>i</italic></sub> tiles. More formally, after the partition biopsy <italic>i</italic> can be represented by <inline-formula id="inf1"><mml:math id="m1" overflow="scroll"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∪</mml:mo><mml:mo>⋯</mml:mo><mml:mo>∪</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula>, where each <italic>T</italic>
<sub><italic>ij</italic></sub> closed subset of <inline-formula id="inf2"><mml:math id="m2" overflow="scroll"><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>. Further, let <bold><italic>x</italic></bold>
<sub><italic>ij</italic></sub> = <bold><italic>x</italic></bold>
<sub><italic>ij1</italic></sub> ∪ <bold><italic>x</italic></bold>
<sub><italic>ij2</italic></sub>, where each <bold><italic>x</italic></bold>
<sub><italic>ijk</italic></sub> is a set of points in <inline-formula id="inf3"><mml:math id="m3" overflow="scroll"><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>⊂</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>, and <italic>k</italic> = 1 for tumor cells and 2 for immune cells. Then for each element of the partition of each biopsy, this data can be naturally viewed as the realization of a marked point process. Broadly speaking, marked point process models are a family of models that treat the number of points, their locations, and their discrete classification (often called their “mark”) as random. We specifically chose to model this data as a hierarchical Multitype Strauss Process. Hierarchical Strauss Processes are unique in that they allow for the modeling of both the tendency of points of different types to be generally close (positive interaction) as well as generally far apart (negative interaction).</p>
      </sec>
      <sec id="s2-3-2">
        <title>2.3.2 Model construction</title>
        <p>The usage of a Strauss model to study spatial interaction in a marked point process is natural in this setting, since Strauss models were originally conceived for this purpose (<xref rid="B45" ref-type="bibr">Strauss, 1975</xref>). There are two primary model variants to consider when modeling multi-type data using the Strauss model: the hierarchical variant and the symmetric variant. These models are superficially similar, but differ in important ways. Broadly speaking the symmetric variant models the interaction between the different types of points jointly, whereas the hierarchical variant models the locations of certain types of points <italic>conditional</italic> upon the locations of other types. Using the hierarchical Strauss model thus requires an important choice for each pair of types as to which type of point will be “dominating,” i.e., conditioned upon, and thus unaffected by the other type. This choice, which must be made with <italic>a priori</italic> information about the nature of the process, has important consequences for the resulting model fit. Aside from the differing interpretations depending on the choice, different choices of dominating vs. non-dominating types will also result in different conditional likelihoods and thus parameter values (<xref rid="B23" ref-type="bibr">Högmander and Aila, 1999</xref>). It is also worth noting here that the term “hierarchical” is used differently in this context than it is often used in more typical statistical modeling. Rather than referring to mechanisms to account for dependence in observations or induce shrinkage, here the term refers to the hierarchical relationship between the dominating and non-dominating types: the locations of the dominating type do not depend on the locations of the non-dominating type, but the locations of the non-dominating type <italic>do</italic> explicitly depend on those of the dominating type.</p>
        <p>We ultimately chose to use the hierarchical variant of the multi-type Strauss model over the symmetric variant for two key reasons. First, in our imaging application treating the locations of the immune cells as conditional upon the locations of the tumor cells is <italic>a priori</italic> biologically plausible. It has been established that there is an interplay between a tumor and the host’s immune system whereby the immune system responds to the tumor, thus shaping its development, and the tumor in turn “escapes” the immune system and influences its response (<xref rid="B27" ref-type="bibr">Khong and Restifo, 2002</xref>; <xref rid="B49" ref-type="bibr">Zhang and Zhang, 2020</xref>). While such dynamics are no doubt of interest, this natural evolution cannot be easily inferred from a “snapshot” in time that a biopsy presents. Despite this, conditioning on the locations of the tumor cells to model the immune response is a reasonable starting point: in order for the immune system to respond, there must at the very least be a tumor to respond to. The hierarchical Strauss Model thus serves as a first order approximation to this complex interplay. Second, the hierarchical Strauss model allows for the proper modeling of positive interaction between points of different types, while the symmetric model does not. <xref rid="F2" ref-type="fig">Figure 2</xref> depicts examples of different types of spatial interaction, ranging from negative to positive. The left and center panels depict the range of interactions that can be modeled by the traditional Strauss process: either the case where cells of both types actively avoid the other (left panel) or are spatially unaffected by the other’s presence (middle panel). Because we are interested in not just these cases but the case where points of both types tend to cluster around points of the other type (right panel), the hierarchical variant is the clear choice.</p>
        <fig position="float" id="F2">
          <label>FIGURE 2</label>
          <caption>
            <p>An illustration of spatial interaction between cells of different types. The leftmost panel depicts low/negative interaction; the middle panel depicts null interaction; the rightmost panel depicts high/positive interaction.</p>
          </caption>
          <graphic xlink:href="fgene-14-1175603-g002" position="float"/>
        </fig>
        <p>The density function of the hierarchical Multitype Strauss Model with two qualitative marks (tumor and immune cells in our setting) is defined by<disp-formula id="e1"><mml:math id="m4" overflow="scroll"><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>∝</mml:mo><mml:mi>exp</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>11</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>11</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>22</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>22</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><label>(1)</label></disp-formula>where in addition to <bold><italic>x</italic></bold>
<sub>1</sub> and <bold><italic>x</italic></bold>
<sub>2</sub> as defined above, <italic>n</italic>
<sub><italic>t</italic></sub> is the number of points of type <italic>t</italic>, <italic>β</italic>
<sub><italic>t</italic></sub> is the first order intensity of points of type <italic>t</italic>, <inline-formula id="inf4"><mml:math id="m5" overflow="scroll"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>⋅</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> counts the number of pairs of points of types <italic>t</italic> and <italic>l</italic> within <italic>R</italic>
<sub><italic>tl</italic></sub> of one another where <italic>R</italic>
<sub><italic>tl</italic></sub> is selected <italic>a priori</italic> based on subject specific knowledge, and <italic>γ</italic>
<sub><italic>tl</italic></sub> captures the tendency of points of type <italic>l</italic> to be near points of type <italic>t</italic>. It bears mentioning that this model can be extended to arbitrary numbers of marks (i.e., types of cells). For our current application, we have focused on tumor-immune interactions, but it would be trivial to extend the chosen model to as multiple cell types as were available for a given data set.</p>
      </sec>
      <sec id="s2-3-3">
        <title>2.3.3 Interpretation of parameters</title>
        <p>As previously mentioned, <italic>γ</italic>
<sub><italic>tl</italic></sub> can be thought of as the degree to which points of type <italic>l</italic> tend to be close to or far away from points of type <italic>t</italic>. This allows us to distinguish between the mere relative abundance of different types of points (which is captured by the <italic>β</italic>
<sub>1</sub> and <italic>β</italic>
<sub>2</sub> parameters) and the actual spatial associations between the different types of points. This distinction is important in situations where there are substantial numbers of points of both types but no positive spatial association (and possibly a negative one). For examples, see <xref rid="s3-1" ref-type="sec">Section 3.1</xref> for results from the simulation study. When <italic>t</italic> = 1 and <italic>l</italic> = 2, this association is interpreted conditionally upon the locations of the type 1 points. Under the hierarchical Strauss model, <italic>γ</italic>
<sub>12</sub> ∈ (−<italic>∞</italic>, <italic>∞</italic>), with <italic>γ</italic>
<sub>12</sub> ∈ (−<italic>∞</italic>, 0) implying negative interaction, <italic>γ</italic>
<sub>12</sub> ∈ (0, <italic>∞</italic>) implying positive interaction, and <italic>γ</italic>
<sub>12</sub> = 0 implying no interaction at all. As one might intuitively expect, larger values of <italic>γ</italic>
<sub>12</sub> correspond to more positive interaction, and smaller values correspond to a more negative interaction. Due to mathematical constraints on the density, we must have <inline-formula id="inf5"><mml:math id="m6" overflow="scroll"><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>11</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>22</mml:mn></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mfenced open="(" close="]"><mml:mrow><mml:mo>−</mml:mo><mml:mi>∞</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula>. This constrains interaction between points of the same type to be modeled as negative or null, i.e., as in panels 1 and 2 of <xref rid="F2" ref-type="fig">Figure 2</xref>. Since this constraint is unlikely to be satisfied in the context of a tumor biopsy, we set <italic>γ</italic>
<sub>11</sub> = <italic>γ</italic>
<sub>22</sub> = 0, in effect assuming no interaction between cells of the same type. Based on prior biological knowledge, we set <italic>R</italic>
<sub>12</sub> = 30 microns. The need to select values of <italic>R</italic>
<sub>11</sub> and <italic>R</italic>
<sub>22</sub> is obviated by setting <italic>γ</italic>
<sub>11</sub> = <italic>γ</italic>
<sub>22</sub> = 0.</p>
      </sec>
    </sec>
    <sec id="s2-4">
      <title>2.4 Model fitting</title>
      <p>Except in the trivial case where <italic>γ</italic>
<sub>12</sub> = 0, the normalizing constant of this distribution is computationally intractable. This motivates the usage of a pseudolikelihood formulation as outlined by <xref rid="B6" ref-type="bibr">Baddeley and Turner, 2000</xref>. For the density <italic>f</italic>(⋅) of the simplified hierarchical Strauss Model outlined in <xref rid="e1" ref-type="disp-formula">(1)</xref>, define the conditional intensity function at a point <italic>u</italic> given <italic>θ</italic> = {<italic>β</italic>
<sub>1</sub>, <italic>β</italic>
<sub>2</sub>, <italic>γ</italic>
<sub>12</sub>} and points <bold><italic>x</italic></bold> observed in window <italic>A</italic> by<disp-formula id="e2"><mml:math id="m7" overflow="scroll"><mml:mi>λ</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>u</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfenced open="{" close=""><mml:mrow><mml:mtable class="cases"><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>∪</mml:mo><mml:mfenced open="{" close="}"><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="1em"/></mml:mtd><mml:mtd columnalign="left"><mml:mi>u</mml:mi><mml:mo>∉</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mfrac><mml:mrow><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo>−</mml:mo><mml:mfenced open="{" close="}"><mml:mrow><mml:mi>u</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mspace width="1em"/></mml:mtd><mml:mtd columnalign="left"><mml:mi>u</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math><label>(2)</label></disp-formula>
</p>
      <p>Given this, the pseudolikelihood is defined as follows,<disp-formula id="e3"><mml:math id="m8" overflow="scroll"><mml:mi>P</mml:mi><mml:mi>L</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>θ</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∏</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:munder><mml:mi>λ</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced><mml:mi>exp</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>∫</mml:mo></mml:mrow><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mi>λ</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>u</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mi>θ</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:mi>u</mml:mi></mml:mrow></mml:mfenced></mml:math><label>(3)</label></disp-formula>
</p>
      <p>In essence, this provides a computationally tractable alternative to the likelihood function that can be used in inference. Specifically, the integral in the pseudolikelihood function can be easily approximated by summing over a weighted quadrature on <italic>A</italic>, as described in <xref rid="B6" ref-type="bibr">Baddeley and Turner, 2000</xref>. See <xref rid="s10" ref-type="sec">Supplementary Equation S1</xref> for additional details.</p>
      <p>Using this approximation of the pseudolikelihood function in place of the more standard likelihood function, Bayesian analysis can proceed in the style of <xref rid="B29" ref-type="bibr">King et al., 2012</xref> by simply assigning priors to the parameters of interest and using techniques to sample from non-closed form posterior likelihoods. We assigned non-informative normal priors with mean 0 and variance 10<sup>6</sup> to <italic>γ</italic>
<sub>12</sub>, <italic>β</italic>
<sub>1</sub>, and <italic>β</italic>
<sub>2</sub>. In all analysis presented below the quadrature and weights used to estimate the integral in the pseudolikelihood function was generated by the spatstat package (<xref rid="B7" ref-type="bibr">Baddeley and Turner, 2005</xref>). Samples from the posterior were taken using JAGS via the R2jags package (<xref rid="B50" ref-type="bibr">Yu-Sung et al., 2015</xref>); see <xref rid="s10" ref-type="sec">Supplementary Algorithm S1</xref> for details.</p>
    </sec>
    <sec id="s2-5">
      <title>2.5 Cell type interaction probability</title>
      <sec id="s2-5-1">
        <title>2.5.1 Motivation</title>
        <p>For ease of exposition, we suppress the subscript in <italic>γ</italic>
<sub>12</sub> parameter, and refer to it as <italic>γ</italic>
<sub>•</sub> in the following sections. <italic>γ</italic>
<sub>•</sub>, <italic>β</italic>
<sub>1</sub>, and <italic>β</italic>
<sub>2</sub> allow us to distinguish between the tendency of cells of different types to be spatially near one another (captured by <italic>γ</italic>
<sub>•</sub>) and the relative abundance of the cells of each type (captured by <italic>β</italic>
<sub>1</sub> and <italic>β</italic>
<sub>2</sub>), as well as the uncertainty around these various tendencies. However, this does not capture the difference between the observed spatial association and what one would expect to observe by chance given a particular configuration of tumor cells. Even if the locations of the immune cells are completely random and unrelated to those of the tumor cells, there is still a possibility of a configuration that may indicate positive interaction when considered in isolation. In order to properly account for this, the observed distribution of <italic>γ</italic>
<sub>•</sub> must be compared to a counterfactual distribution that captures the tendency when there is no interaction. This motivated the development of Cell Type Interaction Probability (CTIP).</p>
      </sec>
      <sec id="s2-5-2">
        <title>2.5.2 Definition</title>
        <p>Let <italic>π</italic>(<italic>γ</italic>): = <italic>f</italic>(<italic>γ</italic>
<sub>•</sub>|<bold><italic>x</italic></bold>
<sub>1</sub>, <bold><italic>x</italic></bold>
<sub>2</sub>) be the posterior distribution of <italic>γ</italic>
<sub>•</sub> conditional upon the observed tumor cells and immune cells, and <inline-formula id="inf6"><mml:math id="m9" overflow="scroll"><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> be the posterior distribution of the interaction parameter conditional upon the observed locations of the tumor cells and <inline-formula id="inf7"><mml:math id="m10" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, a set of points distributed as a Poisson Process. Further, assume independence between the true distribution and the null distribution. Then we define the CTIP (denoted by <italic>r</italic>) as:<disp-formula id="e4"><mml:math id="m11" overflow="scroll"><mml:mspace width="1em"/><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mo>∬</mml:mo><mml:mi>I</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>γ</mml:mi><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>π</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:mi>γ</mml:mi></mml:mrow></mml:mfenced><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>d</mml:mi><mml:mi>γ</mml:mi><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math><label>(4)</label></disp-formula>where <italic>I</italic>(⋅) denotes the indicator function, and both <italic>π</italic>(<italic>γ</italic>) and <italic>π</italic>
<sub>0</sub>(<italic>γ</italic>
<sub>0</sub>) are as defined above. By construction, the observed parameter is independent from the null parameter, since immune cells drawn from a Poisson process should not yield any information about immune cells realized under either positive or negative interaction. More concretely, by the definitional independence of <inline-formula id="inf8"><mml:math id="m12" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> from <bold><italic>x</italic></bold>
<sub>2</sub>, it follows trivially that <inline-formula id="inf9"><mml:math id="m13" overflow="scroll"><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mo>•</mml:mo></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mo>•</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">∣</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. This construction means that CTIP is the expectation of an indicator function, and thus can be interpreted as a probability. Specifically, it represents the probability that the observed value of <italic>γ</italic>
<sub>•</sub> is larger than what we would observe if there was truly no underlying interaction.</p>
      </sec>
      <sec id="s2-5-3">
        <title>2.5.3 Sampling from the empirical null distribution</title>
        <p>The problem of estimating CTIP hinges on being able to sample from the distribution of <italic>γ</italic>
<sub>0</sub>, since estimation of the posterior can proceed as described in <xref rid="s2-3" ref-type="sec">Section 2.3</xref>. In order to estimate the null distribution of <italic>γ</italic>
<sub>0</sub> conditional upon the location of the observed tumor cells, we used simulation to construct an empirical null distribution. Recall that when there is no interaction, by definition <italic>γ</italic> = 0. This means that the hierarchical Strauss given in Eq. <xref rid="e1" ref-type="disp-formula">1</xref> reduces to two independent Poisson processes with intensities <italic>β</italic>
<sub>1</sub> and <italic>β</italic>
<sub>2</sub>, which are trivial to simulate.</p>
        <p>Given this, the estimation of the null distribution for a given tile proceeded as follows. First, the first order intensity of the immune cells was estimated using the standard estimator, <inline-formula id="inf10"><mml:math id="m14" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>log</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> where <italic>I</italic>
<sub><italic>ik</italic></sub> is the number of immune cells observed in tile <italic>k</italic> of biopsy <italic>i</italic> and <italic>A</italic>
<sub><italic>ik</italic></sub> is the area in square microns of the tile. Second, <italic>S</italic> simulations of immune cells were generated from a poisson process with intensity <inline-formula id="inf11"><mml:math id="m15" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, <italic>S</italic> being selected <italic>a priori</italic>. Third and finally, each simulated set of immune cells was superimposed over the actual observed tumor cells, and samples were drawn from the resulting posterior distribution. These samples, combined across simulations 1, …, <italic>S</italic> approximate <italic>π</italic>
<sub>0</sub>(<italic>γ</italic>) as previously defined.</p>
      </sec>
      <sec id="s2-5-4">
        <title>2.5.4 Computation of CTIP</title>
        <p>Having established the ability to sample from the posterior distribution as well as the null distribution for <italic>γ</italic>, estimation of CTIP can be done via stochastic integration. Note that Eq. <xref rid="e4" ref-type="disp-formula">4</xref> is equivalent to <inline-formula id="inf12"><mml:math id="m16" overflow="scroll"><mml:msub><mml:mrow><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mi>I</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>γ</mml:mi><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. Thus, given <italic>P</italic> posterior samples <italic>γ</italic>
<sub>1</sub>, …, <italic>γ</italic>
<sub><italic>P</italic></sub> from the posterior <italic>π</italic> and <italic>γ</italic>
<sub>01</sub>, …, <italic>γ</italic>
<sub>0<italic>P</italic>
</sub> from the empirical null <italic>π</italic>
<sub>0</sub>, (5) can be estimated by<disp-formula id="e5"><mml:math id="m17" overflow="scroll"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:mfrac><mml:munderover accentunder="false" accent="true"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>P</mml:mi></mml:mrow></mml:munderover><mml:mi>I</mml:mi><mml:mfenced open="(" close=")"><mml:mrow><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mrow><mml:mi>γ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math><label>(5)</label></disp-formula>
</p>
      </sec>
      <sec id="s2-5-5">
        <title>2.5.5 Interpretation</title>
        <p>By definition, <italic>r</italic> ∈ [0, 1]. As previously mentioned, <italic>r</italic> can be construed as the expected value of an indicator random variable with respect to the joint distribution of <italic>π</italic>(<italic>γ</italic>) and <italic>π</italic>
<sub>0</sub>(<italic>γ</italic>
<sub>0</sub>). This naturally yields an interpretation of <italic>r</italic> as a probability. Specifically, it can be thought of as measuring the posterior probability that the observed value of <italic>γ</italic>
<sub>•</sub> is larger than the value that would be observed given the observed tumor cells and immune cell intensity if there were no underlying interaction.</p>
      </sec>
      <sec id="s2-5-6">
        <title>2.5.6 Model outputs and summaries</title>
        <p>Because models can be fit for each sub-region <italic>T</italic>
<sub><italic>ij</italic></sub> of biopsy <italic>B</italic>
<sub><italic>i</italic></sub>, CTIP can also be computed for each tile. The result for each biopsy is a collection of tile specific estimations of CTIP for each biopsy, <inline-formula id="inf13"><mml:math id="m18" overflow="scroll"><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math></inline-formula> for <italic>i</italic> = 1, <italic>…</italic>, <italic>N</italic>. These estimates are then summarized at the biopsy level into a singular value that quantifies the overall level of infiltration in the biopsy, which can be used in downstream analyses to investigate the association between biopsy level of tumor-immune interaction and other patient features of interest-see <xref rid="s3-2" ref-type="sec">Section 3.2</xref> for results. We chose to use the mean value, since even under the assumption of spatial association between tiles the result is an unbiased estimate of the biopsy level mean. Because the values themselves encode the local spatial association for each tile, the result is an appropriate proxy for the amount of interaction between tumor cells and immune cells at the biopsy level. We further logit-transformed the tile level CTIP values prior to computing the biopsy level mean in order to make the resulting distribution across biopsies closer to a Gaussian distribution. See <xref rid="Algorithm_1" ref-type="statement">Algorithm 1</xref> for the full SPARTIN method.</p>
        <p>
          <statement content-type="algorithm" id="Algorithm_1">
            <label>Algorithm 1</label>
            <p>SPARTIN algorithm.<list list-type="simple"><list-item><p><bold>Input</bold>: <italic>N</italic> biopsies</p></list-item><list-item><p><bold>for</bold> biopsy <italic>i</italic> = 1, <italic>…</italic>, <italic>N</italic>
<bold>do</bold>
</p></list-item><list-item><p>Intensity threshold biopsy <italic>i</italic>
</p></list-item><list-item><p>Partition intensity thresholded biopsy <italic>i</italic> into <italic>N</italic>
<sub><italic>i</italic></sub> tiles</p></list-item><list-item><p><bold>for</bold> tile <italic>j</italic> = 1, <italic>…</italic>, <italic>N</italic>
<sub><italic>i</italic></sub>
<bold>do</bold>
</p></list-item><list-item><p>Estimate CTIP <inline-formula id="inf14"><mml:math id="m19" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> for tile <italic>j</italic>
</p></list-item><list-item><p><bold>end for</bold></p></list-item><list-item><p>Compute <inline-formula id="inf15"><mml:math id="m20" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>mean</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mtext>logit</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mtext>logit</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>
</p></list-item><list-item><p><bold>end for</bold></p></list-item><list-item><p><bold>return</bold><inline-formula id="inf16"><mml:math id="m21" overflow="scroll"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> for usage in downstream analysis</p></list-item></list>
</p>
          </statement>
        </p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="results" id="s3">
    <title>3 Results</title>
    <sec id="s3-1">
      <title>3.1 Simulations</title>
      <sec id="s3-1-1">
        <title>3.1.1 Simulation overview</title>
        <p>To compare our model’s detection of spatial association between different cell types, we conducted simulation studies in which we tested the ability of SPARTIN to accurately identify positive interaction across a range of different simulated cell compositions and degrees of spatial association. For each of four sets of simulations, the number of simulated tumor cells and immune cells were set <italic>a priori</italic> at <italic>T</italic>
<sub><italic>s</italic></sub> and <italic>L</italic>
<sub><italic>s</italic></sub>. These levels across the four simulations were, respectively, 20 and 50, 50 and 20, 50 and 50, and 100 and 100. Further, interaction was controlled by a parameter <italic>ϕ</italic> ∈ [−1, 1], with −1 indicating the most negative possible interaction using our simulation method and 1 indicating the most positive possible interaction using our simulation method. For each of the four settings, 50 data sets were simulated for <italic>ϕ</italic> = ±1, ±0.8, ±0.6, ±0.4, ±0.2, and 100 were simulated for <italic>ϕ</italic> = 0. Because the goal was classification as either positive interaction or non-positive (i.e., null or negative) interaction, we used AUC as our summary metric. This is a natural choice, since CTIP is interpreted as the posterior probability of positive interaction. As a benchmark for performance, we compared CTIP to the G-cross function, a commonly used non-parametric statistical method for assessing the spatial relationship between different types of points in marked point processes (<xref rid="B34" ref-type="bibr">Van Lieshout and Baddeley, 1999</xref>).</p>
      </sec>
      <sec id="s3-1-2">
        <title>3.1.2 Simulations of negative interaction</title>
        <p>For a given combination of <italic>T</italic>
<sub><italic>s</italic></sub> and <italic>L</italic>
<sub><italic>s</italic></sub>, the simulations of positive interaction and simulations of negative interaction proceeded differently. For the simulations of negative interaction (<italic>ϕ</italic> ∈ [−1, 0]), <italic>T</italic>
<sub><italic>s</italic></sub> tumor cells and <italic>L</italic>
<sub><italic>s</italic></sub> immune cells were simulated as independent poisson processes in regions of the window that overlapped to varying degrees. The overlap was controlled by <italic>ϕ</italic>, such that the processes overlapped on (100 ⋅ (1 + <italic>ϕ</italic>))% of the window in which the simulation occurred. Note that when <italic>ϕ</italic> = −1 there was no overlap, and when <italic>ϕ</italic> = 0 there was complete overlap and the simulation reduced to generating two independent Poisson Processes within the same window.</p>
      </sec>
      <sec id="s3-1-3">
        <title>3.1.3 Simulations of positive interaction</title>
        <p>For the simulations of positive interaction (<inline-formula id="inf17"><mml:math id="m22" overflow="scroll"><mml:mi>ϕ</mml:mi><mml:mo>∈</mml:mo><mml:mfenced open="(" close="]"><mml:mrow><mml:mn>0,1</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula>), <italic>T</italic>
<sub><italic>s</italic></sub> tumor cells were simulated under a Poisson process. After their locations were determined, <italic>L</italic>
<sub><italic>s</italic></sub> immune cells were simulated. For each immune cell <italic>l</italic>
<sub><italic>i</italic></sub>, a Bernoulli random variable <italic>C</italic>
<sub><italic>i</italic></sub>∼<italic>Bern</italic>(<italic>ϕ</italic>) was drawn. If <italic>C</italic>
<sub><italic>i</italic></sub> = 1, <italic>l</italic>
<sub><italic>i</italic></sub> was simulated within 30 microns of a randomly selected tumor cell. Otherwise, <italic>l</italic>
<sub><italic>i</italic></sub> was simulated from a Poisson process. Thus, the level of interaction was again controlled by <italic>ϕ</italic>, with <italic>ϕ</italic> = 0 again corresponding to two independent Poisson Processes and <italic>ϕ</italic> = 1 corresponding to a situation in which all immune cells are within 30 microns of at least one tumor cell.</p>
      </sec>
      <sec id="s3-1-4">
        <title>3.1.4 Simulation assessment</title>
        <p>Because CTIP is most naturally interpreted as a probability, in order to classify a given collection of points as indicating positive or negative interaction in practice a cutoff value must be chosen above which CTIP is considered to indicate positive interaction and below which it is not. This leads to a natural tradeoff: if the cutoff is too low, then many cases where there is no positive interaction will be incorrectly classified as having positive interaction. If the cutoff is too high, the opposite will occur. This tradeoff can be visualized across different thresholds using a receiver operating characteristic (ROC) curve, which can in turn be summarized by the area under the curve (AUC). AUC ranges between 0.5 and 1, with 0.5 indicating total inability to correctly discriminate between different outcomes and 1 indicating perfect ability to discriminate. AUC is therefore a natural choice for a metric to assess the ability of CTIP to distinguish between positive and non-positive interaction between cells of different types.</p>
        <p>As a benchmark for performance, we examined the performance of the G-cross function in discriminating positive interaction from non-positive interaction. The G-cross function is a non-parametric estimate of the cumulative distribution functions of minimum distances from cells of one type to those of another. In this application, the G-cross function evaluated at a specific distance yields a non-parametric estimate of the probability that a tumor cell will have at least one immune cell within that distance. We chose to evaluate the G-cross function at a distance of 30 microns in order to be consistent with the modeling of CTIP.</p>
      </sec>
      <sec id="s3-1-5">
        <title>3.1.5 Results</title>
        <p>For examples of simulated data as well as visualizations of results for CTIP, see <xref rid="F3" ref-type="fig">Figure 3</xref>. Across the different simulation settings, accurate classification was achieved using CTIP. The top panels depict a sample of simulations across a range of interaction values, from <italic>ϕ</italic> = −1 to <italic>ϕ</italic> = 1. The bottom left panel shows the distribution of the estimated CTIP values for each set of simulations across each of the four sets of simulations and the values of <italic>ϕ</italic>, plotted on the logit scale. The bottom right panel shows the AUC for each of the four simulation settings across all values of <italic>ϕ</italic>. The results of these simulations demonstrate that CTIP reliably distinguishes between a broad ranges of interaction levels, across a similarly broad range of relative abundances in cell types. The lowest overall AUC (0.85) was achieved in simulation 3, while the highest was achieved in simulation 1 (0.96). For the G-cross function, the highest overall AUC was achieved in simulation 2 (0.8), while the lowest was achieved in simulation 1 (0.73)—see <xref rid="s10" ref-type="sec">Supplementary Figure S4</xref> in the supplementary materials for more detailed results for the G-cross function, and <xref rid="s10" ref-type="sec">Supplementary Section S5</xref> for additional simulation results examining the relative performance when model assumptions are violated.</p>
        <fig position="float" id="F3">
          <label>FIGURE 3</label>
          <caption>
            <p>Simulated examples and results. Top row: examples of simulations of positive and negative interaction for different values of <italic>ϕ</italic>, all from simulation setting 1. Bottom left: box plots of CTIP across all simulated compositions for different values of <italic>ϕ</italic> on logit scale. Bottom right: ROC curves and associated AUC for classification (positive interaction vs. non-positive interaction) for different simulation settings and the two methods investigated (CTIP and G-cross).</p>
          </caption>
          <graphic xlink:href="fgene-14-1175603-g003" position="float"/>
        </fig>
      </sec>
    </sec>
    <sec id="s3-2">
      <title>3.2 Application</title>
      <p>We applied the SPARTIN pipeline to a data set consisting of 335 high definition images of SKin Cutaneous Melanoma (SKCM) biopsies stained using hematoxylin and eosin, obtained from The Cancer Genome Atlas (TCGA) Genomic Data Commons Data Portal. SKCM is an appealing target for the investigation of immune cell infiltration for several reasons. SKCM has been shown to be particularly responsive to immunotherapy in some cases (<xref rid="B1" ref-type="bibr">Achkar and Tarhini, 2017</xref>; <xref rid="B18" ref-type="bibr">Franklin et al., 2017</xref>). It is possible that the ability to quantify immune infiltration at a large scale may allow for more detailed investigation into the scenarios in which this treatment may be most effectively deployed. It is also well established that SKCM has an unusually high mutational load amongst the various cancer types (<xref rid="B11" ref-type="bibr">Berger et al., 2012</xref>). The ability to quantify spatial infiltration patterns may allow for further downstream investigations into not only genomic associations of this occurrence but associations with other phenotypic and clinical outcomes as well.</p>
      <sec id="s3-2-1">
        <title>3.2.1 Cell classification model</title>
        <sec id="s3-2-1-1">
          <title>3.2.1.1 Whole-slide image (WSI) retrieval and obtaining training labels</title>
          <p>WSI from 20 different patients were used as our primary training and testing data. The images were imported from The Cancer Genome Atlas (TCGA) Genomic Data Commons Data Portal, which is a repository of validated datasets from various National Cancer Institute Programs: <ext-link xlink:href="https://www.cancer.gov/tcga" ext-link-type="uri">https://www.cancer.gov/tcga</ext-link>. Also known as the gigapixel pathology image, one image slide contained two tissue smears stained with hematoxylin and eosin, imported in a vendor specific format. The imported image for classification is scanned at the “high” magnification level in a microscope of ×40. The pixel size for images was approximately 0.25 microns per pixel. Manual marking of a minimum of ten samples from each of the classes, i.e., Tumors, Immune, Macrophage, and other cell was performed by a pathologist on all slides. Care was taken to ensure that the samples were as diverse as possible, to account for all possible morphologies of the same cell type across all cases. In total, 1,250 annotations were made in all the images, with each annotated cell labelled by a pathologist. The reasons for the comparatively smaller labelled dataset available lie in the large size of the slide, and pathologist availability; the large size makes parsing through difficult and explains the diversity of labelled structures in each image.</p>
        </sec>
        <sec id="s3-2-1-2">
          <title>3.2.1.2 Whole-slide image (WSI) nucleus segmentation</title>
          <p>Before nuclear segmentation and extraction can be performed on the WSIs, certain pre-processing steps are carried out to ensure staining uniformity across images. A representative and generalizable stain vector estimation for each of the stains being used in the image is estimated, to normalize the staining intensities across all the images. In our application, vectors from hematoxylin, eosin and residual stains were estimated from a standard image, selected by the clinician. These vectors are then applied across all images to keep the stain detection parameters uniform across the dataset (<xref rid="B8" ref-type="bibr">Bankhead et al., 2018</xref>).</p>
          <p>Due to the variations in staining procedures across the dataset, it is difficult to accurately isolate whole cells on the slide, as the cytoplasmic boundaries are not well-defined due to lack of membrane staining. As heterogeneity in nuclear morphology has been shown to be a good discriminator, only the nucleus is segmented out of each cell in every image for classification purposes, using Qupath (<xref rid="B51" ref-type="bibr">Yuan et al., 2012</xref>). Watershed segmentation is used to obtain separated and contoured nuclei from the hematoxylin color channel of the whole slide image, in a patch-based manner (<xref rid="B8" ref-type="bibr">Bankhead et al., 2018</xref>). The separate hematoxylin channel is obtained by performing color deconvolution to separate out the stains used in the slide (<xref rid="B42" ref-type="bibr">Ruifrok and Johnston, 2001</xref>). It was observed that an average of 200,000 cells were segmented out per image, and morphological and intensity features such as spatial location, eccentricity, circularity, and stain intensities were computed. All pertinent image analysis and nuclear segmentation was performed using Qupath, an open-sourced software platform that can be used for a range of pathological image analysis applications (<xref rid="B9" ref-type="bibr">Bankhead et al., 2017</xref>).</p>
          <p>A Random Forest model is a type of ensemble learning method, where the weak predictive power of multiple decision trees is aggregated to produce an accurate result (<xref rid="B14" ref-type="bibr">Breiman, 2001</xref>). Our four-class classifier model was developed with the pathologist labelled dataset of 1,250 morphologically diverse cells, each belonging to Tumor, Immune, Macrophage, or other cells (including cell types such as stromal cells). 5-fold cross-validation was used to assess model accuracy and the receiver operator characteristic curve AUC for each class, with proportional representation of all 4 classes ensured. After adjusting for multiple parameters, including the number of decision trees, the accuracy was obtained in the range of 87%–91%.</p>
          <p>This step allowed for a preparation of a dataset for each cell with its spatial location using global coordinates and class of the cell, which is then used for further downstream analysis. The training, testing, and classification of cells from the WSIs was performed on MATLAB version 2017A. For visualizations of distributions of cell counts across biopsies, see <xref rid="s10" ref-type="sec">Supplementary Figures S1–S3</xref>. For this analysis, only data for tumor cells and immune cells were kept to quantify the immune cell infiltration using SPARTIN.</p>
        </sec>
      </sec>
      <sec id="s3-2-2">
        <title>3.2.2 SPARTIN analyses of SKCM</title>
        <p>While we are broadly grouping immune cells together for the purposes of this analysis, it is important to note that within the microevironment of melanoma there is a great deal of heterogeneity in the types of immune cells present. Tumor Infiltrating Lymphocytes (TILs) receive a disproportionate amount of attention in cancer literature due to the well-established prognostic value of the presence. However, in the context of melanoma this focus can obscure the tremendous amount of variability in the types of immune cells present in the microenvironment. Even referring to TILs as a monolith obfuscates the different cell types captured under this umbrella, many of which serve different purposes (<xref rid="B35" ref-type="bibr">Mukherji, 2013</xref>; <xref rid="B48" ref-type="bibr">Weiss, 2016</xref>; <xref rid="B5" ref-type="bibr">Antohe et al., 2019</xref>). The richness of the immunological aspect of the melanoma microenvironment makes it a logical target of analysis via the SPARTIN pipeline.</p>
        <sec id="s3-2-2-1">
          <title>3.2.2.1 CTIP quantification</title>
          <p>In order to compute CTIP, models were fit in using the methods described in <xref rid="s2" ref-type="sec">Section 2</xref>. The same settings were used for all biopsies across the pipeline. Each biopsy was partitioned such that the resulting tiles would have approximately 75 tumor cells per tile, with the minimum possible tumor cells per tile being 50 and the maximum being 100. For an analysis of the sensitivity to the biopsy level estimation of CTIP to the number of tumor cells per tile as well as the clustering algorithm used, see <xref rid="s10" ref-type="sec">Supplementary Section S6</xref>. The CTIP quantifications are shown in <xref rid="F4" ref-type="fig">Figure 4</xref> Panel A wherein we have highlighted three biopsy images (top row). In the middle row, the color of each tile indicates the value of CTIP estimated for that tile. More varied colors across a given biopsy are indicative of more spatial variation in CTIP, and thus infiltration. CTIP was summarized at the biopsy level by taking the empirical mean across all tiles for a given biopsy, which are plotted in the bottom row. As can be seen, the range of CTIP was 0.26–0.99 with a median CTIP value of 0.69 and an interquartile range of 0.19. This points to the fact that SKCM has high level of immune cell infiltration and these results are consistent with the conventional wisdom that melanoma is a generally more immunogenic cancer relative to other variants (<xref rid="B35" ref-type="bibr">Mukherji, 2013</xref>; <xref rid="B19" ref-type="bibr">Fu et al., 2019</xref>).</p>
          <fig position="float" id="F4">
            <label>FIGURE 4</label>
            <caption>
              <p>Visualization of selected biopsies, and distribution of CTIP across all biopsies analyzed. Selected examples of actual biopsies, both raw spatial data and with tessellations and CTIP by tile. The leftmost biopsy pictured has among the lowest mean estimated CTIP in the sample (0.4), while the rightmost has among the highest (0.94). The middle biopsy has average mean CTIP (0.7), but also exhibits more spatial variation than the left or right biopsy. Bottom: distribution of mean CTIP by biopsy for all biopsies investigated. This illustrates the between-biopsy variation in overall levels of infiltration.</p>
            </caption>
            <graphic xlink:href="fgene-14-1175603-g004" position="float"/>
          </fig>
        </sec>
      </sec>
      <sec id="s3-2-3">
        <title>3.2.3 Genomic associations</title>
        <p>We conducted a focused analysis on CTIP and genes that are associated with immune activity. <xref rid="B12" ref-type="bibr">Bhattacharya et al., 2018</xref> have collected and classified a list of 1,793 unique genes associated with various aspects of human immune activity. Notably, this includes genes related to processes that involve or are directly related to immune cells of interest including CD8<sup>+</sup> T-cells, Natural Killer cells, and B cells. Of these, gene expression data was available for 1,305 genes across 330 patients. We assessed the univariate association between biopsy level mean logit-CTIP and these genes using Spearman correlation. The advantage of Spearman correlation as opposed to the more standard Pearson correlation is that the former does not assume a linear relationship between the underlying variables of interest. Such assumptions can be problematic, particularly when there is no strong reason <italic>a priori</italic> to believe the relationship between the two variables is of a particular form. However, like Pearson correlation Spearman correlation is defined to lie in [−1, 1], with each extreme indicating the same directionality and strength of association as Pearson Correlation. After applying a Bonferroni correction, we found that 28 genes were significantly associated with CTIP. See <xref rid="F5" ref-type="fig">Figure 5</xref> for a volcano plot of results; for the complete list of genes, see <xref rid="T1" ref-type="table">Table 1</xref>. Most notably, mean logit-CTIP was most significantly negatively associated with CD244, a gene associated with increased cytotoxicity in natural killer cells (<xref rid="B2" ref-type="bibr">Agresta et al., 2018</xref>). In addition, mean logit-CTIP was significantly negatively associated with expression of Cathepsin S, a gene associated with immunosuppression in the tumor microenvironment, and C-C motif chemokine receptor 8 (CCR8), a gene related to immunosuppressive T regulatory cells (<xref rid="B20" ref-type="bibr">Fuchs et al., 2020</xref>; <xref rid="B47" ref-type="bibr">Weaver et al., 2022</xref>).</p>
        <fig position="float" id="F5">
          <label>FIGURE 5</label>
          <caption>
            <p>Volcano Plot of Spearman correlations between CTIP and gene expression values. Negative log<sub>10</sub>
<italic>p</italic>-values plotted against Spearman Correlation for ImmPort genes. Colors indicate ImmPort Gene List, which are the collections provided by ImmPort to organize genes into groups of similar function; Red line indicates Bonferroni correction-see <xref rid="T1" ref-type="table">Table 1</xref> for full list of significant genes.</p>
          </caption>
          <graphic xlink:href="fgene-14-1175603-g005" position="float"/>
        </fig>
        <table-wrap position="float" id="T1">
          <label>TABLE 1</label>
          <caption>
            <p>Full ImmPort Analysis Results. ImmPort Genes significantly associated with average logit biopsy level CTIP after Bonferroni correction, alpha = 0.05.</p>
          </caption>
          <table frame="hsides" rules="groups">
            <thead valign="top">
              <tr>
                <th align="left" rowspan="1" colspan="1">Gene</th>
                <th align="left" rowspan="1" colspan="1">Group</th>
                <th align="left" rowspan="1" colspan="1">Spearman Correlation</th>
                <th align="left" rowspan="1" colspan="1"><italic>p</italic>-value</th>
              </tr>
            </thead>
            <tbody valign="top">
              <tr>
                <td align="left" rowspan="1" colspan="1">CD244</td>
                <td align="left" rowspan="1" colspan="1">Natural Killer Cell</td>
                <td align="left" rowspan="1" colspan="1">−0.29</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CTSS</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.29</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CCR8</td>
                <td align="left" rowspan="1" colspan="1">Cytokine Receptors</td>
                <td align="left" rowspan="1" colspan="1">−0.27</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CD3G</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.26</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">PTPRC</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.26</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">TLR8</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.26</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">ITK</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.26</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">TLR3</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.25</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">STAT1</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.25</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">TNFRSF9</td>
                <td align="left" rowspan="1" colspan="1">TNF Family Members Receptors</td>
                <td align="left" rowspan="1" colspan="1">−0.25</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">EREG</td>
                <td align="left" rowspan="1" colspan="1">Cytokines</td>
                <td align="left" rowspan="1" colspan="1">0.24</td>
                <td align="left" rowspan="1" colspan="1">≪ 0.0001</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">LCK</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.24</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf18">
                    <mml:math id="m23" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">PIK3CG</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.24</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf19">
                    <mml:math id="m24" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">ERAP1</td>
                <td align="left" rowspan="1" colspan="1">Antigen Processing and Presentation</td>
                <td align="left" rowspan="1" colspan="1">−0.24</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf20">
                    <mml:math id="m25" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">TNFSF14</td>
                <td align="left" rowspan="1" colspan="1">TNF Family Members</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf21">
                    <mml:math id="m26" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">IL6R</td>
                <td align="left" rowspan="1" colspan="1">Interleukins Receptors</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf22">
                    <mml:math id="m27" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CIITA</td>
                <td align="left" rowspan="1" colspan="1">Antigen Processing and Presentation</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf23">
                    <mml:math id="m28" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">ICOS</td>
                <td align="left" rowspan="1" colspan="1">TCR Signaling Pathway</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf24">
                    <mml:math id="m29" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">DES</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf25">
                    <mml:math id="m30" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">APLN</td>
                <td align="left" rowspan="1" colspan="1">Cytokines</td>
                <td align="left" rowspan="1" colspan="1">0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf26">
                    <mml:math id="m31" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">IFIH1</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf27">
                    <mml:math id="m32" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">RFX5</td>
                <td align="left" rowspan="1" colspan="1">Antigen Processing and Presentation</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf28">
                    <mml:math id="m33" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">LYZ</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf29">
                    <mml:math id="m34" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CXCR6</td>
                <td align="left" rowspan="1" colspan="1">Cytokine Receptors</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf30">
                    <mml:math id="m35" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CRABP1</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf31">
                    <mml:math id="m36" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">CYBB</td>
                <td align="left" rowspan="1" colspan="1">Antimicrobials</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf32">
                    <mml:math id="m37" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
            </tbody>
          </table>
        </table-wrap>
        <p>We also investigated the association between CTIP values and tumor deconvolution data in order to assess the association between the presence of specific immune cell types and overall tumor-immune interaction. Because the specific immune cell types were not ascertained in the data collection, deconvolution algorithms can offer an estimation of the relative prevalence of different types of immune cells. We obtained data from the Tumor Immune Estimation Resource 2.0 (TIMER 2.0): <ext-link xlink:href="http://timer.cistrome.org/" ext-link-type="uri">http://timer.cistrome.org/</ext-link>. Using data from TIMER2.0, we examined the association between the prevalence of different types of immune cells including CD8<sup>+</sup> T cells, Natural Killer cells, and B cells with biopsy level mean logit-CTIP. Among the available options from TIMER 2.0, we decided to use the MCP-counter algorithm (<xref rid="B10" ref-type="bibr">Becht et al., 2016</xref>) based on the analysis of <xref rid="B21" ref-type="bibr">Sturm et al., 2019</xref>, since it was judged to be most effective in detecting the presence and prevalence of the most relevant types of immune cells. We investigated the association of the score of each type of immune cell estimated by MCP-counter with biopsy level mean logit-CTIP using Spearman correlation (as done previously for gene expression). Significance was assessed using the standard test of statistical significance of Spearman correlation.</p>
        <p>After applying a Bonferroni correction (<italic>α</italic> = 0.05), we found that six different immune cell scores as computed by MCP-counter were significantly negatively associated with biopsy level mean logit-CTIP: CD8<sup>+</sup> T cells, B cells, Monocytes, Macrophages, Myeloid Dendritic Cells, and Natural Killer cells. No cell types were significantly positively associated with biopsy level mean logit-CTIP after the Bonferroni correction, though the magnitude of the positive association with Cancer Associated Fibroblasts (CAFs) is notable, and while not statistically significant still highly consistent with a truly positive underlying association between biopsy level CTIP and prevalence of CAFs. See <xref rid="F6" ref-type="fig">Figure 6</xref> and <xref rid="T2" ref-type="table">Table 2</xref> for full details on specific cell type score associations. CD8<sup>+</sup> T cells, B cells, and Natural Killer cells are generally associated with better prognosis in SKCM. This would imply, perhaps somewhat counterintuitively, that higher mean logit-CTIP would be expected to be associated with poorer survival, and lower levels of pathology assessment of lymphocyte infiltration. However, this is precisely what we observed, as discussed in next Section.</p>
        <fig position="float" id="F6">
          <label>FIGURE 6</label>
          <caption>
            <p>Volcano plot of association with deconvolution data. Negative log-10 <italic>p</italic>-values plotted against Spearman Correlation between CTIP and cell type prevalance scores estimated by MCP. Red line indicates Bonferroni correction, alpha = 0.05.</p>
          </caption>
          <graphic xlink:href="fgene-14-1175603-g006" position="float"/>
        </fig>
        <table-wrap position="float" id="T2">
          <label>TABLE 2</label>
          <caption>
            <p>Associations with cell prevalence. Cell type associated with average logit biopsy level CTIP. <italic>p</italic>-values are presented uncorrected; see <xref rid="F6" ref-type="fig">Figure 6</xref>.</p>
          </caption>
          <table frame="hsides" rules="groups">
            <thead valign="top">
              <tr>
                <th align="left" rowspan="1" colspan="1">Cell Type</th>
                <th align="left" rowspan="1" colspan="1">Spearman Correlation</th>
                <th align="left" rowspan="1" colspan="1"><italic>p</italic>-Value</th>
              </tr>
            </thead>
            <tbody valign="top">
              <tr>
                <td align="left" rowspan="1" colspan="1">T cell</td>
                <td align="left" rowspan="1" colspan="1">−0.13</td>
                <td align="left" rowspan="1" colspan="1">0.014</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">T cell CD8<sup>+</sup>
</td>
                <td align="left" rowspan="1" colspan="1">−0.23</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf33">
                    <mml:math id="m38" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">cytotoxicity score</td>
                <td align="left" rowspan="1" colspan="1">−0.13</td>
                <td align="left" rowspan="1" colspan="1">0.015</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">NK cell</td>
                <td align="left" rowspan="1" colspan="1">−0.17</td>
                <td align="left" rowspan="1" colspan="1">0.0025</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">B cell</td>
                <td align="left" rowspan="1" colspan="1">−0.21</td>
                <td align="left" rowspan="1" colspan="1">
                  <inline-formula id="inf34">
                    <mml:math id="m39" overflow="scroll">
                      <mml:mo>&lt;</mml:mo>
                      <mml:mn>0.0001</mml:mn>
                    </mml:math>
                  </inline-formula>
                </td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Monocyte</td>
                <td align="left" rowspan="1" colspan="1">−0.19</td>
                <td align="left" rowspan="1" colspan="1">0.0004</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Macrophage/Monocyte</td>
                <td align="left" rowspan="1" colspan="1">−0.19</td>
                <td align="left" rowspan="1" colspan="1">0.0004</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Myeloid dendritic cell</td>
                <td align="left" rowspan="1" colspan="1">−0.18</td>
                <td align="left" rowspan="1" colspan="1">0.0012</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Neutrophil</td>
                <td align="left" rowspan="1" colspan="1">0.02</td>
                <td align="left" rowspan="1" colspan="1">0.75</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Endothelial cell</td>
                <td align="left" rowspan="1" colspan="1">0.06</td>
                <td align="left" rowspan="1" colspan="1">0.26</td>
              </tr>
              <tr>
                <td align="left" rowspan="1" colspan="1">Cancer associated fibroblast</td>
                <td align="left" rowspan="1" colspan="1">0.14</td>
                <td align="left" rowspan="1" colspan="1">0.0094</td>
              </tr>
            </tbody>
          </table>
        </table-wrap>
      </sec>
      <sec id="s3-2-4">
        <title>3.2.4 Association with phenotypic and clinical outcomes</title>
        <sec id="s3-2-4-1">
          <title>3.2.4.1 Transcriptomic classes and pathology asessments</title>
          <p><xref rid="B3" ref-type="bibr">Akbani et al. (2015)</xref> also identified three transcriptomic classes by applying consensus hierarchical clustering techniques to gene expression data from 1,500 genes: the “immune” subclass, the “keratin” subclass, and the “MITF-low” subclass. Most notably for our current application, the immune subclass was characterized by overexpression of genes associated with T cells, B cells, and Natural Killer cells. Of the patients classified using these methods, 235 were present in our data set. Of these 235, 114 (49%) were in the immune subclass, 78 (33%) were in the keratin subclass, and 43 (18%) were in the MITF-low subclass. <xref rid="F7" ref-type="fig">Figure 7</xref> demonstrates a clear visual difference between the immune subclass and both the MITF-low and keratin subclasses. In order to determine if these apparent differences were statistically significant, we analyzed the differences in average logit-CTIP between each pair of classes using a standard two-sided <italic>t</italic>-test, and found that the mean logit-CTIP in the immune class was significantly lower than either the keratin or the MITF-low subclass (<italic>p</italic> &lt; 10<sup>–5</sup> and <italic>p</italic> = 0.011, respectively). We found no significant difference between the mean logit-CTIP in the MITF-low subclass and the keratin subclass (<italic>p</italic> = 0.21). This is highly consistent with the results of the deconvolution analysis, which suggest that the degree of abundance of such cells are inversely associated with mean logit-CTIP.</p>
          <fig position="float" id="F7">
            <label>FIGURE 7</label>
            <caption>
              <p>Average CTIP by transcriptomic subclass and overall survival hazard ratios. <bold>(A)</bold> Average logit-CTIP by transcriptomic class according to <xref rid="B3" ref-type="bibr">Akbani et al. (2015)</xref>. <bold>(B)</bold> Hazard ratios from Cox Proportional Hazards models. Points at 1 indicate reference category. Age was standardized by subtracting the mean value and dividing by the standard deviation. Logit-CTIP was significantly associated with increased hazard of death (<italic>p</italic> = 0.019), while normalized logit-MCON was non-significantly associated with an increased hazard of death (<italic>p</italic> = 0.057) and normalized logit-G-cross was non-significantly associated with a decreased hazard of death (<italic>p</italic> = 0.32).</p>
            </caption>
            <graphic xlink:href="fgene-14-1175603-g007" position="float"/>
          </fig>
          <p>In addition to classifying the biopsies into transcriptomic subclasses, <xref rid="B3" ref-type="bibr">Akbani et al., 2015</xref> had pathologists assess biopsies for lymphocyte infiltration. Biopsies were scored from 0 to 3 on lymphocyte distribution, with 0 indicating no lymphocytes present in the tissue and 3 indicating that lymphocytes were present in over 50% of the tissue. They were also scored from 0 to 3 on lymphocyte density, with 0 indicating an absence of lymphocytes and 3 indicating a “severe” presence. These measures were added to create a Lymphocyte Score, a measure that ranged from 0 to 6 meant to summarize the general presence and degree of lymphocyte infiltration in that biopsy. Of the 235 patients in our sample that were assessed by the pathologists, 29% had a score of zero, 23% had a score of two, 10% had a score of three, 13% had a score of four, 15% had a score of five, and 9% had a score of six. Note that by definition of the component scores, a score of one is not possible. We performed a linear regression of Lymphocyte Score on mean biopsy level logit-CTIP, treating Lymphocyte Score as continuous. We found that a one unit increase in mean biopsy level logit-CTIP was highly significantly associated with a 0.45 unit decrease in mean Lymphocyte Score (<italic>p</italic> ≪ 0.0001). This result is also consistent with both previous results, and provide further evidence for the apparent negative association between mean logit-CTIP and the presence of specific immune cell types generally associated with positive prognosis.</p>
        </sec>
        <sec id="s3-2-4-2">
          <title>3.2.4.2 Survival analysis</title>
          <p>In order to assess association between logit-CTIP and overall survival, we fit a Cox Proportional Hazards model using clinical data as well as CTIP values. Clinical patient data were retrieved from the TCGA website and matched to biopsy images via TCGA identifier. In addition to adjusting for mean logit-CTIP, we adjusted for cancer stage, age in years, and sex. Age in years was standardized by subtracting the mean value and dividing by the standard deviation.</p>
          <p>Using this model, we found that after adjusting for other factors an increase in normalized logit-CTIP was significantly associated with increased hazard of death (<italic>p</italic> = 0.02). See <xref rid="F7" ref-type="fig">Figure 7</xref> for hazard ratio estimates and associated confidence intervals. In addition to this, we found that normalized age was significantly positively associated with an increased hazard of death (<italic>p</italic> &lt; 0.05), as was having stage 3 disease (relative to stage 1, <italic>p</italic> &lt; 0.05). Having stage 4 disease was positively associated with increased hazard of death, though not significantly. This is most likely due to the lack of patients with stage 4 disease in the data set.</p>
          <p>In order to assess the performance of CTIP relative to a more traditional measure of spatial association the same model was fitted with average logit-CTIP exchanged for the average value of the estimated G-cross function (discussed previously in <xref rid="s3-1" ref-type="sec">Section 3.1</xref>) as well as the Mark Connection Function (MCON). The Mark Connection Function is another natural point of comparison because it is a measure that is commonly used to investigate spatial associations between points with discrete marks, it is constrained to lie in [0,1] like CTIP, and it has been used elsewhere as a comparison point for similar survival modeling using spatial information (<xref rid="B31" ref-type="bibr">Li et al., 2019b</xref>). To produce a single value, the MCON function was evaluated at <italic>r</italic> = 30, which is the same as the radius of interaction used in our computation of CTIP as well as the G-cross function. Both G-cross and MCON values were logit-transformed. Because the values remained skewed even after logit-transform, they were subsequently centered and scaled by subtracting their respective mean and dividing by their respective standard deviation. While increased normalized logit-MCON was also associated with an increased hazard of death, the association was not significant (<italic>p</italic> = 0.057). The G-cross function was associated with a decreased hazard of death, though the association was also not significant (<italic>p</italic> = 0.32). <xref rid="F7" ref-type="fig">Figure 7</xref> summarizes the results across all three models.</p>
          <p>This result, along with the other results presented in this paper, provide evidence of an immune phenotype in SKCM that corresponds to poor prognosis from a number of different perspectives. With respect to overall survival, we have demonstrated that adjusting for other relevant clinical factors, an increase in CTIP is associated with an increased hazard of death. For gene expression data, average CTIP is associated with decreased expression of genes related to immune cells that are generally associated with good overall prognosis. And finally, we found that average CTIP is significantly lower in biopsies that have been classified as immune enriched through gene expression clustering, as well as biopsies that have been assessed by pathologists to have higher densities and spatial distributions of tumor infiltrating lymphocytes. These results fundamentally support the notion that CTIP is capturing an anti-immunogenic phenotype that is associated with poor prognosis, possibly due to an overall negative association with the presence of immune cells that are associated with improved prognosis such as CD8<sup>+</sup> T Cells and Natural Killer cells.</p>
        </sec>
      </sec>
    </sec>
  </sec>
  <sec sec-type="discussion" id="s4">
    <title>4 Discussion</title>
    <p>The SPARTIN method provides a general framework for applying traditional spatial statistical techniques to whole biopsy imaging data. More specifically, it provides a modular algorithmic mechanism for partitioning the biopsies into more readily analyzable sub-regions that can be assessed for local spatial patterns using marked point process models. We have demonstrated the utility of such a method using a novel characterization of spatial cellular interaction, CTIP, that allows rigorous quantification of uncertainty and is highly intepretable. We demonstrate through simulation that CTIP can reliably distinguish between different patterns of spatial interaction across a range of different dependencies. We also demonstrate the utility of SPARTIN through a comprehensive analyses of an SKCM dataset, wherein we quantify and evaluate the spatial extent of tumor-immune infiltration and its association with genomic, phenotypic and clinical outcomes. These results are particularly suggestive in the context of SKCM. Melanoma has a uniquely rich literature regarding the potential applications of immunotherapy. While there are many factors that have contributed to this, not the least of which is the relative accessibility of skin cancers compared to other types of cancer, the net result is a far more mature understanding of immunotherapy in the context of melanoma than other types of cancer (<xref rid="B38" ref-type="bibr">Oble et al., 2009</xref>; <xref rid="B37" ref-type="bibr">Nguyen et al., 2010</xref>; <xref rid="B40" ref-type="bibr">Pitcovski et al., 2017</xref>). Thus, possible implications of the spatial immune organization in melanoma for immunotherapy may be more readily interpreted within the context of Melanoma than other cancer types, particularly as the ability to distinguish between different types of immune cells improves.</p>
    <p>The SPARTIN pipeline represents a valuable contribution in and of itself to digital pathology through its ability to model and quantify immune infiltration across entire biopsies in a way that captures meaningful variation along with uncertainty quantifications across patients. However, it also creates numerous opportunities for future work in this area. As algorithms for cell-level image classification improve, the opportunities for more and more detailed quantitative analysis of histopathological imaging data will become both more numerous and more fruitful. Specifically, as the ability to reliably distinguish between different types of immune cells will allow for more granular investigations into the prognoses associated with interaction between immune cells of different kinds and the tumor. Moreover, as spatial biology techniques (e.g., spatial multiplex imaging and spatial transcriptomics) evolve and data becomes abundant, so too will opportunities for synthesizing data on the relative spatial locations of different cell types along with cell or spot specific gene/protein expression data through rigorous, principled, and complex modeling. It would be straightforward (particularly in a Bayesian framework) to model a function of one or all of the parameters of interest as a linear combination of the local genes/proteins that are known to be relevant to immune response. Alternatively, future methods in this area could be developed at the intersection of spatial data and high-dimensional omic features.</p>
    <p>The SPARTIN pipeline could also be generalized for further investigation not directly related to assessing immune infiltration. Partitioning each biopsy into non-overlapping sub-regions invites the application of other tools from the spatial statistical catalogue to other relevant spatial features of the tumor microenvironment. In fact, SPARTIN can be utilized even when investigating features of the tumor that are not spatial in nature. So long as a feature (such as average tumor cell size) can be quantified at the cellular level and summarized locally at the level of sub-regions, SPARTIN provides a framework for mapping the variation of that feature across the entire biopsy.</p>
    <p>One limitation of this analysis is that immune cells were modeled as a single agglomerated class rather than as separate cell types belonging to the same family. While our results paint a consistent picture from several different angles, the exact mechanism of these various associations could be further refined by utilizing a more precise categorization of the various types of immune cells. It is worth emphasizing, however, that nothing about the structure of our pipeline depends on the presence of only one type of immune cell in addition to the cancer cells. The SPARTIN method can be generalized to multiple types cells through multicategory marked point process models, though this would raise additional computational and practical challenges. Another potential limitation of our analysis that suggests an avenue for future methodological development is the presence of repeated measurements within biopsies. Note that the result of fitting models on the partitioned tumor microenvironment is a set of repeated observations with some underlying spatial covariance structure related to the spatial relationships between the different subspaces. For now, we have ignored this spatial covariance, and instead chosen to summarize the variation at the biopsy level. While this does take into account local spatial dependencies (i.e., within tiles), it is possible that incorporating additional global spatial structure across the biopsy (i.e., between tiles) could lead to additional gains in efficiency, and possibly insight into the nature of the spatial variation in immune activation in the tumor microenvironment. Thus, future work will likely include the development of methods to efficiently analyze this complex structured areal data. Finally, it should be noted that the hierarchical Strauss model makes two important assumptions about the nature of the data, those of stationarity and isotropy. This essentially amounts to the assumption that on the level of the tiles for each biopsy on which the models are fit, the point process would be unaffected by horizontal translation (stationarity) or rotation (isotropy). Because tumor biopsies do not have a natural orientation in <inline-formula id="inf35"><mml:math id="m40" overflow="scroll"><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>, it is plausible to assume isotropy. Stationarity is somewhat more challenging to justify <italic>a priori</italic>. However, because the model fitting takes place on relatively small sub-sections of the biopsy, i.e., the “tile” specific level, it is quite plausible that this assumption is at least locally satisfied well enough. Since each tile is modeled using separate spatial parameters, this accounts for non-stationarity at a biopsy level and the ultimate measure of interest, CTIP, still yields a reliable estimate of the degree of interaction between cell types. Still, future work could involve employing methods that relax or eliminate these assumptions during the modeling of interaction.</p>
    <p>Software is available at <ext-link xlink:href="https://github.com/bayesrx/SPARTIN" ext-link-type="uri">https://github.com/bayesrx/SPARTIN</ext-link>. The website for the project, which features an application that can be used as a visualization companion to the software can be found at <ext-link xlink:href="https://nateosher.github.io/SPARTIN" ext-link-type="uri">https://nateosher.github.io/SPARTIN</ext-link>. Using the SPARTIN R package, data can be exported and visualized on the web application in order for users to interactively navigate the patterns of interaction at both the biopsy and individual tile level.</p>
  </sec>
</body>
<back>
  <sec sec-type="data-availability" id="s5">
    <title>Data availability statement</title>
    <p>The datasets presented in this study can be found in online repositories. The names of the repository/repositories and accession number(s) can be found in the article/<xref rid="s10" ref-type="sec">Supplementary Material</xref>.</p>
  </sec>
  <sec id="s6">
    <title>Author contributions</title>
    <p>NO and VB conceptualized the project. NO developed the idea for the partitioning of the biopsy and for cell type interaction probability, and wrote the introduction, methods, results, and conclusion section. VB and JK oversaw the creation, implementation and visualization of the analyses pipeline. AR oversaw the preprocessing and preparation of the data by SK, and SK also contributed to writing the results section. AR and SK also provided guidance on the interpretation of results. VB and JK reviewed the manuscript and provided feedback for its ultimate construction and form.</p>
  </sec>
  <sec sec-type="COI-statement" id="s8">
    <title>Conflict of interest</title>
    <p>AR serves as a member for Voxel analytics LLC. and consults for Genophyll, LLC.</p>
    <p>The remaining authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest.</p>
  </sec>
  <sec sec-type="disclaimer" id="s9">
    <title>Publisher’s note</title>
    <p>All claims expressed in this article are solely those of the authors and do not necessarily represent those of their affiliated organizations, or those of the publisher, the editors and the reviewers. Any product that may be evaluated in this article, or claim that may be made by its manufacturer, is not guaranteed or endorsed by the publisher.</p>
  </sec>
  <sec id="s10">
    <title>Supplementary material</title>
    <p>The Supplementary Material for this article can be found online at: <ext-link xlink:href="https://www.frontiersin.org/articles/10.3389/fgene.2023.1175603/full#supplementary-material" ext-link-type="uri">https://www.frontiersin.org/articles/10.3389/fgene.2023.1175603/full#supplementary-material</ext-link>
</p>
    <supplementary-material id="SM1" position="float" content-type="local-data">
      <media xlink:href="Presentation1.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="SM2" position="float" content-type="local-data">
      <media xlink:href="Table3.CSV">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="SM3" position="float" content-type="local-data">
      <media xlink:href="Table2.CSV">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="SM4" position="float" content-type="local-data">
      <media xlink:href="Table1.CSV">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
    <supplementary-material id="SM5" position="float" content-type="local-data">
      <media xlink:href="DataSheet1.CSV">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
  <ref-list>
    <title>References</title>
    <ref id="B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Achkar</surname><given-names>T.</given-names></name><name><surname>Tarhini</surname><given-names>A. A.</given-names></name></person-group> (<year>2017</year>). <article-title>The use of immunotherapy in the treatment of melanoma</article-title>. <source>J. Hematol. Oncol.</source>
<volume>10</volume> (<issue>1</issue>), <fpage>88</fpage>–<lpage>89</lpage>. <pub-id pub-id-type="doi">10.1186/s13045-017-0458-3</pub-id>
<pub-id pub-id-type="pmid">28434398</pub-id></mixed-citation>
    </ref>
    <ref id="B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Agresta</surname><given-names>L.</given-names></name><name><surname>KasperHoebe</surname><given-names>H. N.</given-names></name><name><surname>Janssen</surname><given-names>E. M.</given-names></name></person-group> (<year>2018</year>). <article-title>The emerging role of cd244 signaling in immune cells of the tumor microenvironment</article-title>. <source>Front. Immunol.</source>
<volume>9</volume>, <fpage>2809</fpage>. <comment>ISSN 1664-3224</comment>. <pub-id pub-id-type="doi">10.3389/fimmu.2018.02809</pub-id>
<pub-id pub-id-type="pmid">30546369</pub-id></mixed-citation>
    </ref>
    <ref id="B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Akbani</surname><given-names>R.</given-names></name><name><surname>Akdemir</surname><given-names>K. C.</given-names></name><name><surname>Aksoy</surname><given-names>B. A.</given-names></name><name><surname>Albert</surname><given-names>M.</given-names></name><name><surname>Ally</surname><given-names>A.</given-names></name><name><surname>Amin</surname><given-names>S. B.</given-names></name><etal/></person-group> (<year>2015</year>). <article-title>Genomic classification of cutaneous melanoma</article-title>. <source>Cell</source>
<volume>161</volume> (<issue>7</issue>), <fpage>1681</fpage>–<lpage>1696</lpage>. <pub-id pub-id-type="doi">10.1016/j.cell.2015.05.044</pub-id>
<pub-id pub-id-type="pmid">26091043</pub-id></mixed-citation>
    </ref>
    <ref id="B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Amgad</surname><given-names>M.</given-names></name><name><surname>Sarkar</surname><given-names>A.</given-names></name><name><surname>Srinivas</surname><given-names>C.</given-names></name><name><surname>Redman</surname><given-names>R.</given-names></name><name><surname>Ratra</surname><given-names>S.</given-names></name><name><surname>Bechert</surname><given-names>C. J.</given-names></name><etal/></person-group> (<year>2019</year>). <article-title>Joint region and nucleus segmentation for characterization of tumor infiltrating lymphocytes in breast cancer</article-title>. <source>Med. Imaging 2019 Digit. Pathol.</source>
<volume>10956</volume>, <fpage>129</fpage>–<lpage>136</lpage>.</mixed-citation>
    </ref>
    <ref id="B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Antohe</surname><given-names>M.</given-names></name><name><surname>Nedelcu</surname><given-names>R.</given-names></name><name><surname>Nichita</surname><given-names>L.</given-names></name><name><surname>Popp</surname><given-names>C.</given-names></name><name><surname>Cioplea</surname><given-names>M.</given-names></name><name><surname>Brinzea</surname><given-names>A.</given-names></name></person-group> (<year>2019</year>). <article-title>Tumor infiltrating lymphocytes: The regulator of melanoma evolution</article-title>. <source>Oncol. Lett.</source>
<volume>17</volume>, <fpage>1792</fpage>–<lpage>1082</lpage>. <comment>ISSN 4155-4161</comment>. <pub-id pub-id-type="doi">10.3892/ol.2019.9940</pub-id>
</mixed-citation>
    </ref>
    <ref id="B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baddeley</surname><given-names>A.</given-names></name><name><surname>Turner</surname><given-names>R.</given-names></name></person-group> (<year>2000</year>). <article-title>Practical maximum pseudolikelihood for spatial point patterns: (with discussion)</article-title>. <source>Aust. N. Z. J. Statistics</source>
<volume>42</volume> (<issue>3</issue>), <fpage>283</fpage>–<lpage>322</lpage>. <pub-id pub-id-type="doi">10.1111/1467-842x.00128</pub-id>
</mixed-citation>
    </ref>
    <ref id="B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baddeley</surname><given-names>A.</given-names></name><name><surname>Turner</surname><given-names>R.</given-names></name></person-group> (<year>2005</year>). <article-title>Spatstat: An r package for analyzing spatial point patterns</article-title>. <source>J. Stat. Softw.</source>
<volume>12</volume>, <fpage>1</fpage>–<lpage>42</lpage>. <pub-id pub-id-type="doi">10.18637/jss.v012.i06</pub-id>
</mixed-citation>
    </ref>
    <ref id="B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bankhead</surname><given-names>P.</given-names></name><name><surname>Fernández</surname><given-names>J. A.</given-names></name><name><surname>McArt</surname><given-names>D. G.</given-names></name><name><surname>Boyle</surname><given-names>D. P.</given-names></name><name><surname>Li</surname><given-names>G.</given-names></name><name><surname>Loughrey</surname><given-names>M. B.</given-names></name><etal/></person-group> (<year>2018</year>). <article-title>Integrated tumor identification and automated scoring minimizes pathologist involvement and provides new insights to key biomarkers in breast cancer</article-title>. <source>Lab. Investig.</source>
<volume>98</volume> (<issue>1</issue>), <fpage>15</fpage>–<lpage>26</lpage>. <pub-id pub-id-type="doi">10.1038/labinvest.2017.131</pub-id>
<pub-id pub-id-type="pmid">29251737</pub-id></mixed-citation>
    </ref>
    <ref id="B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bankhead</surname><given-names>P.</given-names></name><name><surname>Loughrey</surname><given-names>M. B.</given-names></name><name><surname>Fernández</surname><given-names>J. A.</given-names></name><name><surname>Dombrowski</surname><given-names>Y.</given-names></name><name><surname>McArt</surname><given-names>D. G.</given-names></name><name><surname>Dunne</surname><given-names>P. D.</given-names></name><etal/></person-group> (<year>2017</year>). <article-title>Qupath: Open source software for digital pathology image analysis</article-title>. <source>Sci. Rep.</source>
<volume>7</volume> (<issue>1</issue>), <fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">28127051</pub-id></mixed-citation>
    </ref>
    <ref id="B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Becht</surname><given-names>E.</given-names></name><name><surname>Giraldo</surname><given-names>N. A.</given-names></name><name><surname>Lacroix</surname><given-names>L.</given-names></name><name><surname>Buttard</surname><given-names>B.</given-names></name><name><surname>Elarouci</surname><given-names>N.</given-names></name><name><surname>Petitprez</surname><given-names>F.</given-names></name></person-group> (<year>2016</year>). <article-title>Estimating the population abundance of tissue-infiltrating immune and stromal cell populations using gene expression</article-title>. <source>Genome Biol.</source>
<volume>17</volume> (<issue>1</issue>), <fpage>218</fpage>. <comment>ISSN 1474-760X</comment>. <pub-id pub-id-type="doi">10.1186/s13059-016-1070-5</pub-id>
<pub-id pub-id-type="pmid">27765066</pub-id></mixed-citation>
    </ref>
    <ref id="B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berger</surname><given-names>M. F.</given-names></name><name><surname>Hodis</surname><given-names>E.</given-names></name><name><surname>Heffernan</surname><given-names>T. P.</given-names></name><name><surname>Lawrence</surname><given-names>M. S.</given-names></name><name><surname>Protopopov</surname><given-names>A.</given-names></name><name><surname>Ivanova</surname><given-names>E.</given-names></name><etal/></person-group> (<year>2012</year>). <article-title>Melanoma genome sequencing reveals frequent prex2 mutations</article-title>. <source>Nature</source>
<volume>485</volume> (<issue>7399</issue>), <fpage>502</fpage>–<lpage>506</lpage>. <pub-id pub-id-type="doi">10.1038/nature11071</pub-id>
<pub-id pub-id-type="pmid">22622578</pub-id></mixed-citation>
    </ref>
    <ref id="B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bhattacharya</surname><given-names>S.</given-names></name><name><surname>Dunn</surname><given-names>P.</given-names></name><name><surname>Thomas</surname><given-names>C. G.</given-names></name><name><surname>Smith</surname><given-names>B.</given-names></name><name><surname>Schaefer</surname><given-names>H.</given-names></name><name><surname>Chen</surname><given-names>J.</given-names></name><etal/></person-group> (<year>2018</year>). <article-title>Immport, toward repurposing of open access immunological assay data for translational and clinical research</article-title>. <source>Sci. data</source>
<volume>5</volume> (<issue>1</issue>), <fpage>180015</fpage>–<lpage>180019</lpage>. <pub-id pub-id-type="doi">10.1038/sdata.2018.15</pub-id>
<pub-id pub-id-type="pmid">29485622</pub-id></mixed-citation>
    </ref>
    <ref id="B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bian</surname><given-names>Y.</given-names></name><name><surname>Liu</surname><given-names>Y. F.</given-names></name><name><surname>Jiang</surname><given-names>H.</given-names></name><name><surname>Meng</surname><given-names>Y.</given-names></name><name><surname>Liu</surname><given-names>F.</given-names></name><name><surname>Cao</surname><given-names>K.</given-names></name><etal/></person-group> (<year>2021</year>). <article-title>Machine learning for mri radiomics: A study predicting tumor-infiltrating lymphocytes in patients with pancreatic ductal adenocarcinoma</article-title>. <source>Abdom. Radiol.</source>
<volume>46</volume> (<issue>10</issue>), <fpage>4800</fpage>–<lpage>4816</lpage>. <pub-id pub-id-type="doi">10.1007/s00261-021-03159-9</pub-id>
</mixed-citation>
    </ref>
    <ref id="B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Breiman</surname><given-names>L.</given-names></name></person-group> (<year>2001</year>). <article-title>Random forests machine learning</article-title>. <source>Mach. Learn.</source>
<volume>45</volume>, <fpage>5</fpage>–<lpage>32</lpage>. <comment><italic>View Article PubMed/NCBI Google Scholar</italic></comment>. <pub-id pub-id-type="doi">10.1023/a:1010933404324</pub-id>
</mixed-citation>
    </ref>
    <ref id="B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Denkert</surname><given-names>C.</given-names></name><name><surname>Von Minckwitz</surname><given-names>G.</given-names></name><name><surname>Brase</surname><given-names>J. C.</given-names></name><name><surname>Bruno</surname><given-names>V. S.</given-names></name><name><surname>Gade</surname><given-names>S.</given-names></name><name><surname>Kronenwett</surname><given-names>R.</given-names></name><etal/></person-group> (<year>2015</year>). <article-title>Tumor-infiltrating lymphocytes and response to neoadjuvant chemotherapy with or without carboplatin in human epidermal growth factor receptor 2-positive and triple-negative primary breast cancers</article-title>. <source>J. Clin. Oncol.</source>
<volume>33</volume> (<issue>9</issue>), <fpage>983</fpage>–<lpage>991</lpage>. <pub-id pub-id-type="doi">10.1200/JCO.2014.58.1967</pub-id>
<pub-id pub-id-type="pmid">25534375</pub-id></mixed-citation>
    </ref>
    <ref id="B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dieci</surname><given-names>M. V.</given-names></name><name><surname>Radosevic-Robin</surname><given-names>N.</given-names></name><name><surname>Fineberg</surname><given-names>S.</given-names></name><name><surname>Van den Eynden</surname><given-names>G.</given-names></name><name><surname>Ternes</surname><given-names>N.</given-names></name><name><surname>Penault-Llorca</surname><given-names>F.</given-names></name><etal/></person-group> (<year>2018</year>). <article-title>Update on tumor-infiltrating lymphocytes (tils) in breast cancer, including recommendations to assess tils in residual disease after neoadjuvant therapy and in carcinoma <italic>in situ</italic>: A report of the international immuno-oncology biomarker working group on breast cancer</article-title>. <source>Seminars cancer Biol.</source>
<volume>52</volume>, <fpage>16</fpage>–<lpage>25</lpage>. <pub-id pub-id-type="doi">10.1016/j.semcancer.2017.10.003</pub-id>
</mixed-citation>
    </ref>
    <ref id="B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ertosun</surname><given-names>M. G.</given-names></name><name><surname>Rubin</surname><given-names>D. L.</given-names></name></person-group> (<year>2015</year>). <article-title>Automated grading of gliomas using deep learning in digital pathology images: A modular approach with ensemble of convolutional neural networks</article-title>. <source>AMIA Annu. Symp. Proc. AMIA Symp.</source>
<volume>2015</volume>, <fpage>1899</fpage>–<lpage>1908</lpage>. <comment>ISSN 1942-597X</comment>.,<pub-id pub-id-type="pmid">26958289</pub-id></mixed-citation>
    </ref>
    <ref id="B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Franklin</surname><given-names>E. L.</given-names></name><name><surname>Roesch</surname><given-names>A.</given-names></name><name><surname>Schilling</surname><given-names>B.</given-names></name><name><surname>Schadendorf</surname><given-names>D.</given-names></name></person-group> (<year>2017</year>). <article-title>Immunotherapy in melanoma: Recent advances and future directions</article-title>. <source>Eur. J. Surg. Oncol. (EJSO)</source>
<volume>43</volume> (<issue>3</issue>), <fpage>604</fpage>–<lpage>611</lpage>. <pub-id pub-id-type="doi">10.1016/j.ejso.2016.07.145</pub-id>
<pub-id pub-id-type="pmid">27769635</pub-id></mixed-citation>
    </ref>
    <ref id="B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fu</surname><given-names>Q.</given-names></name><name><surname>Chen</surname><given-names>N.</given-names></name><name><surname>Ge</surname><given-names>C.</given-names></name><name><surname>Li</surname><given-names>R.</given-names></name><name><surname>Li</surname><given-names>Z.</given-names></name><name><surname>Zeng</surname><given-names>B.</given-names></name><etal/></person-group> (<year>2019</year>). <article-title>Prognostic value of tumor-infiltrating lymphocytes in melanoma: A systematic review and meta-analysis</article-title>. <source>Oncoimmunology</source>
<volume>8</volume> (<issue>7</issue>), <fpage>e1593806</fpage>. <pub-id pub-id-type="doi">10.1080/2162402X.2019.1593806</pub-id>
</mixed-citation>
    </ref>
    <ref id="B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fuchs</surname><given-names>N.</given-names></name><name><surname>Meta</surname><given-names>M.</given-names></name><name><surname>Schuppan</surname><given-names>D.</given-names></name><name><surname>Lutz</surname><given-names>N.</given-names></name><name><surname>Schirmeister</surname><given-names>T.</given-names></name></person-group> (<year>2020</year>). <article-title>Novel opportunities for cathepsin s inhibitors in cancer immunotherapy by nanocarrier-mediated delivery</article-title>. <source>Cells</source>
<volume>9</volume> (<issue>9</issue>), <fpage>2021</fpage>. <comment>ISSN 2073-4409</comment>. <pub-id pub-id-type="doi">10.3390/cells9092021</pub-id>
<pub-id pub-id-type="pmid">32887380</pub-id></mixed-citation>
    </ref>
    <ref id="B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heindl</surname><given-names>A.</given-names></name><name><surname>Nawaz</surname><given-names>S.</given-names></name><name><surname>Yuan</surname><given-names>Y.</given-names></name></person-group> (<year>2015</year>). <article-title>Mapping spatial heterogeneity in the tumor microenvironment: A new era for digital pathology</article-title>. <source>Lab. Investig.</source>
<volume>95</volume> (<issue>4</issue>), <fpage>377</fpage>–<lpage>384</lpage>. <pub-id pub-id-type="doi">10.1038/labinvest.2014.155</pub-id>
<pub-id pub-id-type="pmid">25599534</pub-id></mixed-citation>
    </ref>
    <ref id="B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Högmander</surname><given-names>H.</given-names></name><name><surname>Aila</surname><given-names>S.</given-names></name></person-group> (<year>1999</year>). <article-title>Multitype spatial point patterns with hierarchical interactions</article-title>. <source>Biometrics</source>
<volume>55</volume> (<issue>4</issue>), <fpage>1051</fpage>–<lpage>1058</lpage>. <pub-id pub-id-type="doi">10.1111/j.0006-341x.1999.01051.x</pub-id>
<pub-id pub-id-type="pmid">11315047</pub-id></mixed-citation>
    </ref>
    <ref id="B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Idos</surname><given-names>G. E.</given-names></name><name><surname>Kwok</surname><given-names>J.</given-names></name><name><surname>Bonthala</surname><given-names>N.</given-names></name><name><surname>Lynn</surname><given-names>K.</given-names></name><name><surname>Gruber</surname><given-names>S. B.</given-names></name><name><surname>Qu</surname><given-names>C.</given-names></name><etal/></person-group> (<year>2020</year>). <article-title>The prognostic implications of tumor infiltrating lymphocytes in colorectal cancer: A systematic review and meta-analysis</article-title>. <source>Sci. Rep.</source>
<volume>10</volume> (<issue>1</issue>), <fpage>3360</fpage>. <pub-id pub-id-type="doi">10.1038/s41598-020-60255-4</pub-id>
<pub-id pub-id-type="pmid">32099066</pub-id></mixed-citation>
    </ref>
    <ref id="B26">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kang</surname><given-names>J.</given-names></name><name><surname>Johnson</surname><given-names>T. D.</given-names></name><name><surname>Nichols</surname><given-names>T. E.</given-names></name><name><surname>Tor</surname><given-names>D. W.</given-names></name></person-group> (<year>2011</year>). <article-title>Meta analysis of functional neuroimaging data via bayesian spatial point processes</article-title>. <source>J. Am. Stat. Assoc.</source>
<volume>106</volume> (<issue>493</issue>), <fpage>124</fpage>–<lpage>134</lpage>. <pub-id pub-id-type="doi">10.1198/jasa.2011.ap09735</pub-id>
<pub-id pub-id-type="pmid">21706069</pub-id></mixed-citation>
    </ref>
    <ref id="B27">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Khong</surname><given-names>H. T.</given-names></name><name><surname>Restifo</surname><given-names>N. P.</given-names></name></person-group> (<year>2002</year>). <article-title>Natural selection of tumor variants in the generation of “tumor escape” phenotypes</article-title>. <source>Nat. Immunol.</source>
<volume>3</volume> (<issue>11</issue>), <fpage>999</fpage>–<lpage>1005</lpage>. <pub-id pub-id-type="doi">10.1038/ni1102-999</pub-id>
<pub-id pub-id-type="pmid">12407407</pub-id></mixed-citation>
    </ref>
    <ref id="B28">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Khosravi</surname><given-names>P.</given-names></name><name><surname>Kazemi</surname><given-names>E.</given-names></name><name><surname>Imielinski</surname><given-names>M.</given-names></name><name><surname>Elemento</surname><given-names>O.</given-names></name><name><surname>Hajirasouliha</surname><given-names>I.</given-names></name></person-group> (<year>2018</year>). <article-title>Deep convolutional neural networks enable discrimination of heterogeneous digital pathology images</article-title>. <source>EBioMedicine</source>
<volume>27</volume>, <fpage>317</fpage>–<lpage>328</lpage>. <comment>ISSN 23523964</comment>. <pub-id pub-id-type="doi">10.1016/j.ebiom.2017.12.026</pub-id>
<pub-id pub-id-type="pmid">29292031</pub-id></mixed-citation>
    </ref>
    <ref id="B29">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>King</surname><given-names>R.</given-names></name><name><surname>Janine</surname><given-names>B. I.</given-names></name><name><surname>King</surname><given-names>S. E.</given-names></name><name><surname>Nightingale</surname><given-names>G. F.</given-names></name><name><surname>Hendrichsen</surname><given-names>D. K.</given-names></name></person-group> (<year>2012</year>). <article-title>A bayesian approach to fitting gibbs processes with temporal random effects</article-title>. <source>J. Agric. Biol. Environ. statistics</source>
<volume>17</volume> (<issue>4</issue>), <fpage>601</fpage>–<lpage>622</lpage>. <pub-id pub-id-type="doi">10.1007/s13253-012-0111-0</pub-id>
</mixed-citation>
    </ref>
    <ref id="B30">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Komura</surname><given-names>D.</given-names></name><name><surname>Ishikawa</surname><given-names>S.</given-names></name></person-group> (<year>2018</year>). <article-title>Machine learning methods for histopathological image analysis</article-title>. <source>Comput. Struct. Biotechnol. J.</source>
<volume>16</volume>, <fpage>34</fpage>–<lpage>42</lpage>. <pub-id pub-id-type="doi">10.1016/j.csbj.2018.01.001</pub-id>
<pub-id pub-id-type="pmid">30275936</pub-id></mixed-citation>
    </ref>
    <ref id="B32">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Q.</given-names></name><name><surname>Wang</surname><given-names>X.</given-names></name><name><surname>Liang</surname><given-names>F.</given-names></name><name><surname>Yi</surname><given-names>F.</given-names></name><name><surname>Xie</surname><given-names>Y.</given-names></name><name><surname>Gazdar</surname><given-names>A.</given-names></name><etal/></person-group> (<year>2019a</year>). <article-title>A bayesian hidden potts mixture model for analyzing lung cancer pathology images</article-title>. <source>Biostatistics</source>
<volume>20</volume> (<issue>4</issue>), <fpage>565</fpage>–<lpage>581</lpage>. <pub-id pub-id-type="doi">10.1093/biostatistics/kxy019</pub-id>
<pub-id pub-id-type="pmid">29788035</pub-id></mixed-citation>
    </ref>
    <ref id="B31">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Q.</given-names></name><name><surname>Wang</surname><given-names>X.</given-names></name><name><surname>Liang</surname><given-names>F.</given-names></name><name><surname>Xiao</surname><given-names>G.</given-names></name></person-group> (<year>2019b</year>). <article-title>A bayesian mark interaction model for analysis of tumor pathology images</article-title>. <source>Ann. Appl. statistics</source>
<volume>13</volume> (<issue>3</issue>), <fpage>1708</fpage>–<lpage>1732</lpage>. <pub-id pub-id-type="doi">10.1214/19-aoas1254</pub-id>
</mixed-citation>
    </ref>
    <ref id="B33">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lu</surname><given-names>Z.</given-names></name><name><surname>Xu</surname><given-names>S.</given-names></name><name><surname>Shao</surname><given-names>W.</given-names></name><name><surname>Wu</surname><given-names>Y.</given-names></name><name><surname>Zhang</surname><given-names>J.</given-names></name><name><surname>Han</surname><given-names>Z.</given-names></name><etal/></person-group> (<year>2020</year>). <article-title>Deep-learning–based characterization of tumor-infiltrating lymphocytes in breast cancers from histopathology images and multiomics data</article-title>. <source>JCO Clin. cancer Inf.</source>
<volume>4</volume>, <fpage>480</fpage>–<lpage>490</lpage>. <pub-id pub-id-type="doi">10.1200/CCI.19.00126</pub-id>
</mixed-citation>
    </ref>
    <ref id="B35">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mukherji</surname><given-names>B.</given-names></name></person-group> (<year>2013</year>). <article-title>Immunology of melanoma</article-title>. <source>Clin. Dermatology</source>
<volume>31</volume> (<issue>2</issue>), <fpage>156</fpage>–<lpage>165</lpage>. <comment>ISSN 0738081X</comment>. <pub-id pub-id-type="doi">10.1016/j.clindermatol.2012.08.017</pub-id>
</mixed-citation>
    </ref>
    <ref id="B36">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Negahbani</surname><given-names>F.</given-names></name><name><surname>Sabzi</surname><given-names>R.</given-names></name><name><surname>Firouzabadi</surname><given-names>D.</given-names></name><name><surname>Movahedi</surname><given-names>F.</given-names></name><name><surname>Kohandel Shirazi</surname><given-names>M.</given-names></name><name><surname>Majidi</surname><given-names>S.</given-names></name><etal/></person-group> (<year>2021</year>). <article-title>Pathonet introduced as a deep neural network backend for evaluation of ki-67 and tumor-infiltrating lymphocytes in breast cancer</article-title>. <source>Sci. Rep.</source>
<volume>11</volume> (<issue>1</issue>), <fpage>1</fpage>–<lpage>13</lpage>.<pub-id pub-id-type="pmid">33414495</pub-id></mixed-citation>
    </ref>
    <ref id="B37">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nguyen</surname><given-names>L. T.</given-names></name><name><surname>Pei</surname><given-names>H. Y.</given-names></name><name><surname>Nie</surname><given-names>J.</given-names></name><name><surname>Liadis</surname><given-names>N.</given-names></name><name><surname>Ghazarian</surname><given-names>D.</given-names></name><name><surname>Al-Habeeb</surname><given-names>A.</given-names></name><etal/></person-group> (<year>2010</year>). <article-title>Expansion and characterization of human melanoma tumor-infiltrating lymphocytes (tils)</article-title>. <source>PLoS ONE</source>
<volume>5</volume> (<issue>11</issue>), <fpage>e13940</fpage>. <comment>ISSN 1932-6203</comment>. <pub-id pub-id-type="doi">10.1371/journal.pone.0013940</pub-id>
<pub-id pub-id-type="pmid">21085676</pub-id></mixed-citation>
    </ref>
    <ref id="B38">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Oble</surname><given-names>D. A.</given-names></name><name><surname>Robert Loewe</surname></name><name><surname>Yu</surname><given-names>P.</given-names></name><name><surname>Martin</surname><given-names>C. M.</given-names><suffix>Jr</suffix></name></person-group> (<year>2009</year>). <article-title>Focus on tils: Prognostic significance of tumor infiltrating lymphocytes in human melanoma</article-title>. <source>Cancer Immun.</source>
<volume>9</volume>, <fpage>3</fpage>.<pub-id pub-id-type="pmid">19338264</pub-id></mixed-citation>
    </ref>
    <ref id="B39">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pagès</surname><given-names>F.</given-names></name><name><surname>Galon</surname><given-names>J.</given-names></name><name><surname>Dieu-Nosjean</surname><given-names>M-C.</given-names></name><name><surname>Tartour</surname><given-names>E.</given-names></name><name><surname>Sautès-Fridman</surname><given-names>C.</given-names></name><name><surname>Fridman</surname><given-names>W-H.</given-names></name></person-group> (<year>2010</year>). <article-title>Immune infiltration in human tumors: A prognostic factor that should not be ignored</article-title>. <source>Oncogene</source>
<volume>29</volume> (<issue>8</issue>), <fpage>1093</fpage>–<lpage>1102</lpage>. <comment>ISSN 0950-9232, 1476-5594</comment>. <pub-id pub-id-type="doi">10.1038/onc.2009.416</pub-id>
<pub-id pub-id-type="pmid">19946335</pub-id></mixed-citation>
    </ref>
    <ref id="B40">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pitcovski</surname><given-names>J.</given-names></name><name><surname>Shahar</surname><given-names>E.</given-names></name><name><surname>Aizenshtein</surname><given-names>E.</given-names></name><name><surname>Gorodetsky</surname><given-names>R.</given-names></name></person-group> (<year>2017</year>). <article-title>Melanoma antigens and related immunological markers</article-title>. <source>Crit. Rev. Oncology/Hematology</source>
<volume>115</volume>, <fpage>36</fpage>–<lpage>49</lpage>. <comment>ISSN 10408428</comment>. <pub-id pub-id-type="doi">10.1016/j.critrevonc.2017.05.001</pub-id>
</mixed-citation>
    </ref>
    <ref id="B41">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ray</surname><given-names>M.</given-names></name><name><surname>Kang</surname><given-names>J.</given-names></name><name><surname>Zhang</surname><given-names>H.</given-names></name></person-group> (<year>2015</year>). <article-title>Identifying activation centers with spatial cox point processes using fmri data</article-title>. <source>IEEE/ACM Trans. Comput. Biol. Bioinforma.</source>
<volume>13</volume> (<issue>6</issue>), <fpage>1130</fpage>–<lpage>1141</lpage>. <pub-id pub-id-type="doi">10.1109/TCBB.2015.2510007</pub-id>
</mixed-citation>
    </ref>
    <ref id="B42">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ruifrok</surname><given-names>A. C.</given-names></name><name><surname>Johnston</surname><given-names>D. A.</given-names></name><etal/></person-group> (<year>2001</year>). <article-title>Quantification of histochemical staining by color deconvolution</article-title>. <source>Anal. quantitative Cytol. histology</source>
<volume>23</volume> (<issue>4</issue>), <fpage>291</fpage>–<lpage>299</lpage>.</mixed-citation>
    </ref>
    <ref id="B25">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saltz</surname><given-names>J.</given-names></name><name><surname>Gupta</surname><given-names>R.</given-names></name><name><surname>Hou</surname><given-names>L.</given-names></name><name><surname>Kurc</surname><given-names>T.</given-names></name><name><surname>Singh</surname><given-names>P.</given-names></name><name><surname>Nguyen</surname><given-names>V.</given-names></name><etal/></person-group> (<year>2018</year>). <article-title>Spatial organization and molecular correlation of tumor-infiltrating lymphocytes using deep learning on pathology images</article-title>. <source>Cell Rep.</source>
<volume>23</volume> (<issue>1</issue>), <fpage>181</fpage>–<lpage>193.e7</lpage>. <pub-id pub-id-type="doi">10.1016/j.celrep.2018.03.086</pub-id>
<pub-id pub-id-type="pmid">29617659</pub-id></mixed-citation>
    </ref>
    <ref id="B43">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Seal</surname><given-names>S.</given-names></name><name><surname>Ghosh</surname><given-names>D.</given-names></name></person-group> (<year>2022</year>). <article-title>Miami: Mutual information-based analysis of multiplex imaging data</article-title>. <source>Bioinformatics</source>, <volume>38</volume> (<issue>15</issue>):<fpage>3818</fpage>–<lpage>3826</lpage>. <comment>ISSN 1367-4803, 1460-2059</comment>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btac414</pub-id>
<pub-id pub-id-type="pmid">35748713</pub-id></mixed-citation>
    </ref>
    <ref id="B44">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Seal</surname><given-names>S.</given-names></name><name><surname>Vu</surname><given-names>T.</given-names></name><name><surname>Ghosh</surname><given-names>T.</given-names></name><name><surname>Wrobel</surname><given-names>J.</given-names></name><name><surname>Ghosh</surname><given-names>D.</given-names></name></person-group> (<year>2022</year>). <article-title>Denvar: Density-based variation analysis of multiplex imaging data</article-title>. <source>Bioinforma. Adv.</source>
<volume>2</volume> (<issue>1</issue>), <fpage>vbac039</fpage>. <comment>ISSN 2635-0041</comment>. <pub-id pub-id-type="doi">10.1093/bioadv/vbac039</pub-id>
</mixed-citation>
    </ref>
    <ref id="B45">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Strauss</surname><given-names>D. J.</given-names></name></person-group> (<year>1975</year>). <article-title>A model for clustering</article-title>. <source>Biometrika</source>
<volume>62</volume> (<issue>2</issue>), <fpage>467</fpage>–<lpage>475</lpage>. <pub-id pub-id-type="doi">10.1093/biomet/62.2.467</pub-id>
</mixed-citation>
    </ref>
    <ref id="B21">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sturm</surname><given-names>G.</given-names></name><name><surname>Finotello</surname><given-names>F.</given-names></name><name><surname>Petitprez</surname><given-names>F.</given-names></name><name><surname>Zhang</surname><given-names>J. D.</given-names></name><name><surname>Jan</surname><given-names>B.</given-names></name><name><surname>Fridman</surname><given-names>W. H.</given-names></name><etal/></person-group> (<year>2019</year>). <article-title>Comprehensive evaluation of transcriptome-based cell-type quantification methods for immuno-oncology</article-title>. <source>Bioinformatics</source>, <volume>35</volume>(<issue>14</issue>):<fpage>i436</fpage>–<lpage>i445</lpage>. <comment>ISSN 1367-4803, 1460-2059</comment>. <pub-id pub-id-type="doi">10.1093/bioinformatics/btz363</pub-id>
<pub-id pub-id-type="pmid">31510660</pub-id></mixed-citation>
    </ref>
    <ref id="B34">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van Lieshout</surname><given-names>M. N. M.</given-names></name><name><surname>Baddeley</surname><given-names>A. J.</given-names></name></person-group> (<year>1999</year>). <article-title>Indices of dependence between types in multivariate point patterns</article-title>. <source>Scand. J. Statistics</source>, <volume>26</volume>(<issue>4</issue>):<fpage>511</fpage>–<lpage>532</lpage>. <comment>ISSN 0303-6898, 1467-9469</comment>. <pub-id pub-id-type="doi">10.1111/1467-9469.00165</pub-id>
</mixed-citation>
    </ref>
    <ref id="B46">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>S.</given-names></name><name><surname>Wang</surname><given-names>T.</given-names></name><name><surname>Yang</surname><given-names>L.</given-names></name><name><surname>Yang</surname><given-names>D. M.</given-names></name><name><surname>Fujimoto</surname><given-names>J.</given-names></name><name><surname>Yi</surname><given-names>F.</given-names></name><etal/></person-group> (<year>2019</year>). <article-title>Convpath: A software tool for lung adenocarcinoma digital pathological image analysis aided by a convolutional neural network</article-title>. <source>EBioMedicine</source>
<volume>50</volume>, <fpage>103</fpage>–<lpage>110</lpage>. <pub-id pub-id-type="doi">10.1016/j.ebiom.2019.10.033</pub-id>
<pub-id pub-id-type="pmid">31767541</pub-id></mixed-citation>
    </ref>
    <ref id="B47">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weaver</surname><given-names>J. D.</given-names></name><name><surname>Stack</surname><given-names>E. C.</given-names></name><name><surname>Buggé</surname><given-names>J. A.</given-names></name><name><surname>Hu</surname><given-names>C.</given-names></name><name><surname>McGrath</surname><given-names>L.</given-names></name><name><surname>Mueller</surname><given-names>A.</given-names></name><etal/></person-group> (<year>2022</year>). <article-title>Differential expression of ccr8 in tumors versus normal tissue allows specific depletion of tumor-infiltrating t regulatory cells by gs-1811, a novel fc-optimized anti-ccr8 antibody</article-title>. <source>OncoImmunology</source>
<volume>11</volume> (<issue>1</issue>), <fpage>2141007</fpage>. <comment>ISSN 2162-402X</comment>. <pub-id pub-id-type="doi">10.1080/2162402X.2022.2141007</pub-id>
<pub-id pub-id-type="pmid">36352891</pub-id></mixed-citation>
    </ref>
    <ref id="B48">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weiss</surname><given-names>S. A.</given-names></name><name><surname>Han</surname><given-names>S. W.</given-names></name><name><surname>Lui</surname><given-names>K.</given-names></name><name><surname>Tchack</surname><given-names>J.</given-names></name><name><surname>Berman</surname><given-names>R.</given-names></name><etal/></person-group> (<year>2016</year>). <article-title>Immunologic heterogeneity of tumor-infiltrating lymphocyte composition in primary melanoma</article-title>. <source>Hum. Pathol.</source>
<volume>57</volume>, <fpage>116</fpage>–<lpage>125</lpage>. <comment>ISSN 00468177</comment>. <pub-id pub-id-type="doi">10.1016/j.humpath.2016.07.008</pub-id>
<pub-id pub-id-type="pmid">27473267</pub-id></mixed-citation>
    </ref>
    <ref id="B50">
      <mixed-citation publication-type="book"><person-group person-group-type="author"><name><surname>Yu-Sung</surname><given-names>S.</given-names></name><name><surname>Masanao</surname><given-names>Y.</given-names></name><name><surname>Yu-Sung</surname><given-names>M.</given-names></name></person-group> (<year>2015</year>). <source>Package ‘r2jags’. R package version 0.03-08</source>. <comment>Available at: <ext-link xlink:href="http://CRAN.R-project.org/package=R2jags" ext-link-type="uri">http://CRAN.R-project.org/package=R2jags</ext-link>
</comment>.</mixed-citation>
    </ref>
    <ref id="B51">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yuan</surname><given-names>Y.</given-names></name><name><surname>Failmezger</surname><given-names>H.</given-names></name><name><surname>Oscar</surname><given-names>M. R.</given-names></name><name><surname>Ali</surname><given-names>H. R.</given-names></name><name><surname>Gräf</surname><given-names>S.</given-names></name><name><surname>Chin</surname><given-names>S-F.</given-names></name><etal/></person-group> (<year>2012</year>). <article-title>Quantitative image analysis of cellular heterogeneity in breast tumors complements genomic profiling</article-title>. <source>Sci. Transl. Med.</source>
<volume>4</volume> (<issue>157</issue>), <fpage>157ra143</fpage>. <pub-id pub-id-type="doi">10.1126/scitranslmed.3004330</pub-id>
</mixed-citation>
    </ref>
    <ref id="B49">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>Y.</given-names></name><name><surname>Zhang</surname><given-names>Z.</given-names></name></person-group> (<year>2020</year>). <article-title>The history and advances in cancer immunotherapy: Understanding the characteristics of tumor-infiltrating immune cells and their therapeutic implications</article-title>. <source>Cell. Mol. Immunol.</source>, <volume>17</volume>(<issue>8</issue>):<fpage>807</fpage>–<lpage>821</lpage>. <comment>ISSN 1672-7681</comment>. <pub-id pub-id-type="doi">10.1038/s41423-020-0488-6</pub-id>
<pub-id pub-id-type="pmid">32612154</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
