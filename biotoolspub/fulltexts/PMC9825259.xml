<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.2?>
<?ConverterInfo.XSLTName jats2jats3.xsl?>
<?ConverterInfo.Version 1?>
<?properties open_access?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">9825259</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btac842</article-id>
    <article-id pub-id-type="publisher-id">btac842</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Applications Note</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>Genome Analysis</subject>
        </subj-group>
      </subj-group>
      <subj-group subj-group-type="category-taxonomy-collection">
        <subject>AcademicSubjects/SCI01060</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>ASTER: accurately estimating the number of cell types in single-cell chromatin accessibility data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-3503-9306</contrib-id>
        <name>
          <surname>Chen</surname>
          <given-names>Shengquan</given-names>
        </name>
        <aff><institution>School of Mathematical Sciences and LPMC, Nankai University</institution>, Tianjin 300071, <country country="CN">China</country></aff>
        <xref rid="btac842-cor1" ref-type="corresp"/>
        <!--chenshengquan@nankai.edu.cn-->
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Wang</surname>
          <given-names>Rongxiang</given-names>
        </name>
        <aff><institution>Ministry of Education Key Laboratory of Bioinformatics, Research Department of Bioinformatics at the Beijing National Research Center for Information Science and Technology, Center for Synthetic and Systems Biology, Department of Automation, Tsinghua University</institution>, Beijing 100084, <country country="CN">China</country></aff>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Long</surname>
          <given-names>Wenxin</given-names>
        </name>
        <aff><institution>School of Mathematical Sciences and LPMC, Nankai University</institution>, Tianjin 300071, <country country="CN">China</country></aff>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid" authenticated="false">https://orcid.org/0000-0002-7533-3753</contrib-id>
        <name>
          <surname>Jiang</surname>
          <given-names>Rui</given-names>
        </name>
        <aff><institution>Ministry of Education Key Laboratory of Bioinformatics, Research Department of Bioinformatics at the Beijing National Research Center for Information Science and Technology, Center for Synthetic and Systems Biology, Department of Automation, Tsinghua University</institution>, Beijing 100084, <country country="CN">China</country></aff>
        <xref rid="btac842-cor1" ref-type="corresp"/>
        <!--ruijiang@tsinghua.edu.cn-->
      </contrib>
    </contrib-group>
    <contrib-group>
      <contrib contrib-type="editor">
        <name>
          <surname>Marschall</surname>
          <given-names>Tobias</given-names>
        </name>
        <role>Associate Editor</role>
      </contrib>
    </contrib-group>
    <author-notes>
      <corresp id="btac842-cor1">To whom correspondence should be addressed. <email>chenshengquan@nankai.edu.cn</email> or <email>ruijiang@tsinghua.edu.cn</email></corresp>
    </author-notes>
    <pub-date pub-type="collection">
      <month>1</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2022-12-27">
      <day>27</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>27</day>
      <month>12</month>
      <year>2022</year>
    </pub-date>
    <volume>39</volume>
    <issue>1</issue>
    <elocation-id>btac842</elocation-id>
    <history>
      <date date-type="received">
        <day>28</day>
        <month>6</month>
        <year>2022</year>
      </date>
      <date date-type="rev-recd">
        <day>04</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="editorial-decision">
        <day>23</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>26</day>
        <month>12</month>
        <year>2022</year>
      </date>
      <date date-type="corrected-typeset">
        <day>04</day>
        <month>1</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2022. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2022</copyright-year>
      <license>
        <ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btac842.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Summary</title>
        <p>Recent innovations in single-cell chromatin accessibility sequencing (scCAS) have revolutionized the characterization of epigenomic heterogeneity. Estimation of the number of cell types is a crucial step for downstream analyses and biological implications. However, efforts to perform estimation specifically for scCAS data are limited. Here, we propose ASTER, an ensemble learning-based tool for accurately estimating the number of cell types in scCAS data. ASTER outperformed baseline methods in systematic evaluation on 27 datasets of various protocols, sizes, numbers of cell types, degrees of cell-type imbalance, cell states and qualities, providing valuable guidance for scCAS data analysis.</p>
      </sec>
      <sec id="s2">
        <title>Availability and implementation</title>
        <p>ASTER along with detailed documentation is freely accessible at <ext-link xlink:href="https://aster.readthedocs.io/" ext-link-type="uri">https://aster.readthedocs.io/</ext-link> under the MIT License. It can be seamlessly integrated into existing scCAS analysis workflows. The source code is available at <ext-link xlink:href="https://github.com/biox-nku/aster" ext-link-type="uri">https://github.com/biox-nku/aster</ext-link>.</p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref rid="sup1" ref-type="supplementary-material">Supplementary data</xref> are available at <italic toggle="yes">Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <institution-wrap>
            <institution>National Key Research and Development Program of China</institution>
            <institution-id institution-id-type="DOI">10.13039/501100012166</institution-id>
          </institution-wrap>
        </funding-source>
        <award-id>2021YFF1200902</award-id>
        <award-id>62203236</award-id>
        <award-id>62273194</award-id>
        <award-id>61873141</award-id>
        <award-id>61721003</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="3"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Rapid advances in single-cell chromatin accessibility sequencing (scCAS) technologies, such as single-cell assay for transposase-accessible chromatin with sequencing, have enabled the characterization of epigenomic heterogeneity and the interrogation of gene regulation at an unprecedented resolution. A number of embedding and clustering methods have been proposed to identify groups of cells with similar epigenomic patterns in scCAS data (<xref rid="btac842-B1" ref-type="bibr">Chen <italic toggle="yes">et al.</italic>, 2019</xref>, <xref rid="btac842-B2" ref-type="bibr">2021</xref>). However, none of these methods suggests the number of cell types present in the data, which is crucial in clustering analysis and can be critical for downstream analyses of single-cell data (<xref rid="btac842-B10" ref-type="bibr">Yu <italic toggle="yes">et al.</italic>, 2022</xref>).</p>
    <p>Several methods have been proposed specifically for cell-type number estimation in single-cell RNA sequencing (scRNA-seq) data (<xref rid="sup1" ref-type="supplementary-material">Supplementary Text S1</xref>), and their performance has been benchmarked systematically (<xref rid="btac842-B10" ref-type="bibr">Yu <italic toggle="yes">et al.</italic>, 2022</xref>). Although almost all the widely-used scCAS data analysis workflows, e.g. Signac (<xref rid="btac842-B9" ref-type="bibr">Stuart <italic toggle="yes">et al.</italic>, 2021</xref>), ArchR (<xref rid="btac842-B6" ref-type="bibr">Granja <italic toggle="yes">et al.</italic>, 2021</xref>) and EpiScanpy (<xref rid="btac842-B4" ref-type="bibr">Danese <italic toggle="yes">et al.</italic>, 2021</xref>), adopted community detection-based techniques to find the best possible grouping, the estimation of the number of cell types in scCAS data is still typically subjective and largely relied on the investigator’s desired clustering resolution and/or prior knowledge (<xref rid="sup1" ref-type="supplementary-material">Supplementary Text S2</xref>).</p>
    <p>To address this need, we propose a Python package named ASTER to <bold>a</bold>ccurately e<bold>st</bold>imate the numb<bold>er</bold> of cell types in scCAS data.</p>
  </sec>
  <sec>
    <title>2 Materials and methods</title>
    <p>Given a peak-by-cell scCAS data <inline-formula id="IE1"><mml:math id="IM1" display="inline" overflow="scroll"><mml:mi mathvariant="bold">X</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula>, ASTER estimates the number of cell types based on ensemble strategies (<xref rid="btac842-F1" ref-type="fig">Fig. 1a</xref>). Firstly, ASTER performs estimation based on the within-cluster sum-of-squares (WSS) criterion. Specifically, ASTER applies term frequency-inverse document frequency (TF-IDF) transformation (V1) to matrix <inline-formula id="IE2"><mml:math id="IM2" display="inline" overflow="scroll"><mml:mi mathvariant="bold">X</mml:mi></mml:math></inline-formula> (<xref rid="sup1" ref-type="supplementary-material">Supplementary Text S3</xref>). ASTER then performs principal component analysis (PCA) using the widely-used EpiScanpy workflow and performs K-Means clustering to measure <inline-formula id="IE3"><mml:math id="IM3" display="inline" overflow="scroll"><mml:mi mathvariant="normal">WSS</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mfenced open="‖" close="‖" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula id="IE4"><mml:math id="IM4" display="inline" overflow="scroll"><mml:mi>N</mml:mi></mml:math></inline-formula> denotes the number of cells, <inline-formula id="IE5"><mml:math id="IM5" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> the representation of the <inline-formula id="IE6"><mml:math id="IM6" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula>-th cell, <inline-formula id="IE7"><mml:math id="IM7" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> the representation of the <inline-formula id="IE8"><mml:math id="IM8" display="inline" overflow="scroll"><mml:mi>j</mml:mi></mml:math></inline-formula>-th cluster center and <inline-formula id="IE9"><mml:math id="IM9" display="inline" overflow="scroll"><mml:mi>C</mml:mi></mml:math></inline-formula> the resulting clusters. A good clustering is one with a low WSS score and a low number (<inline-formula id="IE10"><mml:math id="IM10" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula>) of clusters. However, this is a tradeoff because WSS decreases as <inline-formula id="IE11"><mml:math id="IM11" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> increases. Therefore, we adopt an elbow method to identify the elbow/knee point (the point with maximum curvature) of a <inline-formula id="IE12"><mml:math id="IM12" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula>-versus-WSS line (<xref rid="btac842-B8" ref-type="bibr">Satopaa <italic toggle="yes">et al.</italic>, 2011</xref>). The <inline-formula id="IE13"><mml:math id="IM13" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> of the elbow point is adopted as the optimal number of clusters.</p>
    <fig position="float" id="btac842-F1">
      <label>Fig. 1.</label>
      <caption>
        <p>Benchmarking results of various methods based on 27 scCAS datasets. (<bold>a</bold>) The ensemble estimation strategy of ASTER. (<bold>b</bold>) Performance of different methods on datasets generated from different species and protocols, and with various sizes, dimensions, numbers of batches, numbers of cell types, proportions of the major type, degrees of cell-type imbalance, levels of sparsity and cell states. Note that we encountered memory errors (exceeded 256 GB) when performing scCCESS and scLCA on BoneMarrowB. (<bold>c</bold>) <italic toggle="yes">P</italic>-values of one-sided paired Wilcoxon signed-rank tests that test if a method (one of the row names) achieves significantly lower absolute estimation deviation on the 27 datasets than another method (one of the column names). (<bold>d</bold>) The performance of various methods on BoneMarrowA at different dropout rates evaluated by estimation error.</p>
      </caption>
      <graphic xlink:href="btac842f1" position="float"/>
    </fig>
    <p>Secondly, ASTER performs estimation based on the Davies–Bouldin index (<xref rid="btac842-B5" ref-type="bibr">Davies and Bouldin, 1979</xref>). Instead of TF-IDF transformation (V1), ASTER applies another widely-used TF-IDF transformation (V2) to <inline-formula id="IE14"><mml:math id="IM14" display="inline" overflow="scroll"><mml:mi mathvariant="bold">X</mml:mi></mml:math></inline-formula> (<xref rid="sup1" ref-type="supplementary-material">Supplementary Text S3</xref>). ASTER then performs PCA and K-Means as above to measure the Davies–Bouldin index, which is defined as <inline-formula id="IE15"><mml:math id="IM15" display="inline" overflow="scroll"><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where<inline-formula id="IE16"><mml:math id="IM16" display="inline" overflow="scroll"><mml:mo> </mml:mo><mml:mi>k</mml:mi></mml:math></inline-formula> is the number of clusters, <inline-formula id="IE17"><mml:math id="IM17" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> the average distance between each cell of cluster <inline-formula id="IE18"><mml:math id="IM18" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> and the centroid of that cluster and <inline-formula id="IE19"><mml:math id="IM19" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> the distance between cluster centroids <inline-formula id="IE20"><mml:math id="IM20" display="inline" overflow="scroll"><mml:mi>i</mml:mi></mml:math></inline-formula> and<inline-formula id="IE21"><mml:math id="IM21" display="inline" overflow="scroll"><mml:mo> </mml:mo><mml:mi>j</mml:mi></mml:math></inline-formula>. A lower index indicates a better partition, and the <inline-formula id="IE22"><mml:math id="IM22" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> that provides the minimum index is thus adopted as the optimal number of clusters.</p>
    <p>Thirdly, ASTER performs estimation based on the silhouette coefficient (<xref rid="btac842-B7" ref-type="bibr">Rousseeuw, 1987</xref>), which is defined for a single cell as <inline-formula id="IE23"><mml:math id="IM23" display="inline" overflow="scroll"><mml:mfrac><mml:mrow><mml:mi>b</mml:mi><mml:mo>-</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfrac></mml:math></inline-formula>, where <inline-formula id="IE24"><mml:math id="IM24" display="inline" overflow="scroll"><mml:mi>a</mml:mi></mml:math></inline-formula> denotes the mean distance between the cell and all other cells in the same cluster, <inline-formula id="IE25"><mml:math id="IM25" display="inline" overflow="scroll"><mml:mi>b</mml:mi></mml:math></inline-formula> denotes the mean distance between the cell and all other cells in the next nearest cluster. ASTER performs TF-IDF transformation (V2) and PCA as above, and then constructs a neighborhood graph of cells using the EpiScanpy workflow. Instead of K-Means clustering, ASTER adopts another two widely-used clustering methods, i.e. Louvain and Leiden, which require a resolution parameter but not the number of clusters. To obtain the desired number of clusters, a binary search strategy is usually adopted (<xref rid="btac842-B1" ref-type="bibr">Chen <italic toggle="yes">et al.</italic>, 2019</xref>, <xref rid="btac842-B2" ref-type="bibr">2021</xref>; <xref rid="btac842-B4" ref-type="bibr">Danese <italic toggle="yes">et al.</italic>, 2021</xref>). However, each attempt in the search process is time-consuming, especially for large data. To speed up the search process, we further improve the search strategy based on the weighted bias as follows:
<disp-formula id="E1"><mml:math id="M1" display="block" overflow="scroll"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">next</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">this</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfenced open="(" close=")" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>×</mml:mo><mml:mfrac><mml:mrow><mml:mi>k</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></disp-formula>where <inline-formula id="IE26"><mml:math id="IM26" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">next</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE27"><mml:math id="IM27" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">this</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> denote the resolutions in the next and this attempt, respectively, <inline-formula id="IE28"><mml:math id="IM28" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE29"><mml:math id="IM29" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> denote the maximum and minimum resolutions to be searched, respectively, <inline-formula id="IE30"><mml:math id="IM30" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula id="IE31"><mml:math id="IM31" display="inline" overflow="scroll"><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> denote the obtained numbers of clusters using the maximum and minimum resolutions, respectively. For each <inline-formula id="IE32"><mml:math id="IM32" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula>, ASTER calculates the mean silhouette coefficient of all cells based on Louvain and Leiden clustering results, respectively, and then sums up the two means. A higher silhouette coefficient relates to a model with better-defined clusters, and the <inline-formula id="IE33"><mml:math id="IM33" display="inline" overflow="scroll"><mml:mi>k</mml:mi></mml:math></inline-formula> that provides the maximum coefficient is thus adopted as the optimal number of clusters.</p>
    <p>Finally, ASTER estimates the number of cell types by averaging the three numbers estimated above, that is, the ensemble estimation is based on three metrics, two TF-IDF approaches, and three clustering methods. Besides, building upon the widely-used AnnData format, ASTER can be seamlessly integrated into the EpiScanpy analysis workflow.</p>
  </sec>
  <sec>
    <title>3 Results</title>
    <p>We evaluated the performance of ASTER by estimation error (the difference between the estimated and true number of cell types) and estimation deviation (the estimation error normalized by the true number of cell types) as recommended in a recent benchmark study (<xref rid="btac842-B10" ref-type="bibr">Yu <italic toggle="yes">et al.</italic>, 2022</xref>). Note that this task is different from clustering and higher clustering concordance does not necessarily mean a more accurate estimation (<xref rid="btac842-B10" ref-type="bibr">Yu <italic toggle="yes">et al.</italic>, 2022</xref>). We compared the performance of ASTER with four methods (<xref rid="sup1" ref-type="supplementary-material">Supplementary Text S4</xref>), including Louvain and Leiden with default resolution, two widely-used methods in scCAS data analysis, and scCCESS and scLCA (<xref rid="btac842-B3" ref-type="bibr">Cheng <italic toggle="yes">et al.</italic>, 2019</xref>), two of the best methods in the most recent benchmark study for scRNA-seq data (<xref rid="btac842-B10" ref-type="bibr">Yu <italic toggle="yes">et al.</italic>, 2022</xref>). We collected 27 datasets generated from different protocols, and with various sizes, dimensions, numbers of batches, numbers of cell types, degrees of cell-type imbalance, cell states and levels of sparsity for systematic benchmarking (<xref rid="sup1" ref-type="supplementary-material">Supplementary Text S5</xref> and <xref rid="sup1" ref-type="supplementary-material">Table S1</xref>).</p>
    <p>As shown in <xref rid="btac842-F1" ref-type="fig">Figure 1b</xref>, ASTER accurately estimates the number of cell types in scCAS data and significantly outperformed the baseline methods. First, ASTER performed well on BM0828BoneMarrow (a dataset of differentiating bone marrow cells from a donor), indicating its ability for datasets where expression changes among cells are expected to be gradients. Second, ASTER performed well on CLP/CMP/MPP (a subset of bone marrow cells from four donors) and BoneMarrowA (the entire dataset of bone marrow cells from seven donors), indicating its ability for datasets derived from multiple batches. However, ASTER does not model the batch variation specifically. Since technical variation may be large in some scCAS datasets, we recommend performing batch correction before estimating the number of cell types by ASTER. Third, ASTER also outperformed other methods on Melanoma (a dataset of cells in time series after knockdown of SOX10 in two short-term patient cultures). Fourth, we evaluated ASTER on BoneMarrowB, a dataset containing 136 463 cells from two batches. ASTER again provided superior performance, indicating its ability for large-scale datasets, which can lead to poor estimation in the benchmark study (<xref rid="btac842-B10" ref-type="bibr">Yu <italic toggle="yes">et al.</italic>, 2022</xref>). Fifth, in addition to differentiating cell states, we also demonstrated the superior performance of ASTER on three differentiated cell-line mixtures. Sixth, in addition to the above human datasets generated by three various protocols, ASTER also outperformed other methods on 19 mouse datasets generated by another 3 protocols. Seventh, ASTER also performed well on challenging datasets generated from complex tissues and with high degrees of cell-type imbalance. One-sided paired Wilcoxon signed-rank tests further demonstrated that the advantages of ASTER over the baseline methods were significant (<xref rid="btac842-F1" ref-type="fig">Fig. 1c</xref>). We provided more details of the above results in <xref rid="sup1" ref-type="supplementary-material">Supplementary Text S6 and Figures S1 and S2</xref>.</p>
    <p>To mimic protocols that generate sparser scCAS data, we downsampled the reads in BoneMarrowA, which provides cell-type labels after fluorescent-activated cell sorting. ASTER consistently outperformed other methods when the dropout rate varied from 5% to 90% (<xref rid="btac842-F1" ref-type="fig">Fig. 1d</xref>). We also performed model ablation analysis to demonstrate the advantage of the ensemble strategies of ASTER (<xref rid="sup1" ref-type="supplementary-material">Supplementary Text S7</xref> and <xref rid="sup1" ref-type="supplementary-material">Figs S3 and S4</xref>). Besides, among all the 27 datasets, the improved Louvain and Leiden clustering strategies in ASTER reduced the average number of searches by 4.74 and 2.04, respectively.</p>
  </sec>
  <sec>
    <title>4 Conclusion</title>
    <p>Based on comprehensive experiments on multiple datasets, ASTER provides an accurate way to estimate the number of cell types in scCAS data. We anticipate that ASTER will provide a valuable guidance and greatly assist with refining cell ontology in scCAS data analysis.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material id="sup1" position="float" content-type="local-data">
      <label>btac842_Supplementary_Data</label>
      <media xlink:href="btac842_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <sec>
    <title>Funding</title>
    <p>This work was supported by the National Key Research and Development Program of China [2021YFF1200902] and the <underline>National Natural Science Foundation of China</underline> [62203236, 62273194, 61873141 and 61721003].</p>
    <p><italic toggle="yes">Conflict of Interest</italic>: none declared.</p>
  </sec>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btac842-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chen</surname><given-names>H.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Assessment of computational methods for the analysis of single-cell ATAC-seq data</article-title>. <source>Genome Biol</source>., <volume>20</volume>, <fpage>241</fpage>.<pub-id pub-id-type="pmid">31739806</pub-id></mixed-citation>
    </ref>
    <ref id="btac842-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chen</surname><given-names>S.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>RA3 is a reference-guided approach for epigenetic characterization of single cells</article-title>. <source>Nat. Commun</source>., <volume>12</volume>, <fpage>2177</fpage>.<pub-id pub-id-type="pmid">33846355</pub-id></mixed-citation>
    </ref>
    <ref id="btac842-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cheng</surname><given-names>C.</given-names></string-name></person-group><etal>et al</etal> (<year>2019</year>) <article-title>Latent cellular analysis robustly reveals subtle diversity in large-scale single-cell RNA-seq data</article-title>. <source>Nucleic Acids Res</source>., <volume>47</volume>, <fpage>e143</fpage>.<pub-id pub-id-type="pmid">31566233</pub-id></mixed-citation>
    </ref>
    <ref id="btac842-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Danese</surname><given-names>A.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>EpiScanpy: integrated single-cell epigenomic analysis</article-title>. <source>Nat. Commun</source>., <volume>12</volume>, <fpage>5228</fpage>.<pub-id pub-id-type="pmid">34471111</pub-id></mixed-citation>
    </ref>
    <ref id="btac842-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Davies</surname><given-names>D.L.</given-names></string-name>, <string-name><surname>Bouldin</surname><given-names>D.W.</given-names></string-name></person-group> (<year>1979</year>) <article-title>A cluster separation measure</article-title>. <source>IEEE Trans. Pattern Anal. Mach. Intell</source>., <volume>1</volume>, <fpage>224</fpage>–<lpage>227</lpage>.<pub-id pub-id-type="pmid">21868852</pub-id></mixed-citation>
    </ref>
    <ref id="btac842-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Granja</surname><given-names>J.M.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>ArchR is a scalable software package for integrative single-cell chromatin accessibility analysis</article-title>. <source>Nat. Genet</source>., <volume>53</volume>, <fpage>403</fpage>–<lpage>411</lpage>.<pub-id pub-id-type="pmid">33633365</pub-id></mixed-citation>
    </ref>
    <ref id="btac842-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rousseeuw</surname><given-names>P.J.</given-names></string-name></person-group> (<year>1987</year>) <article-title>Silhouettes: a graphical aid to the interpretation and validation of cluster analysis</article-title>. <source>J. Comput. Appl. Math</source>., <volume>20</volume>, <fpage>53</fpage>–<lpage>65</lpage>.</mixed-citation>
    </ref>
    <ref id="btac842-B8">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><surname>Satopaa</surname><given-names>V.</given-names></string-name></person-group><etal>et al</etal> (<year>2011</year>) Finding a “Kneedle” in a haystack: detecting knee points in system behavior. In: <italic toggle="yes">2011 31st International Conference on Distributed Computing Systems Workshops</italic>. IEEE, Minneapolis, MN, USA. pp. <fpage>166</fpage>–<lpage>171</lpage>. <pub-id pub-id-type="doi">10.1109/ICDCSW.2011.20</pub-id>.</mixed-citation>
    </ref>
    <ref id="btac842-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stuart</surname><given-names>T.</given-names></string-name></person-group><etal>et al</etal> (<year>2021</year>) <article-title>Single-cell chromatin state analysis with Signac</article-title>. <source>Nat. Methods</source>, <volume>18</volume>, <fpage>1333</fpage>–<lpage>1341</lpage>.<pub-id pub-id-type="pmid">34725479</pub-id></mixed-citation>
    </ref>
    <ref id="btac842-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yu</surname><given-names>L.</given-names></string-name></person-group><etal>et al</etal> (<year>2022</year>) <article-title>Benchmarking clustering algorithms on estimating the number of cell types from single-cell RNA-sequencing data</article-title>. <source>Genome Biol</source>., <volume>23</volume>, <fpage>49</fpage>.<pub-id pub-id-type="pmid">35135612</pub-id></mixed-citation>
    </ref>
  </ref-list>
</back>
