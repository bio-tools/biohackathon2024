<?DTDIdentifier.IdentifierValue -//NPG//DTD XML Article//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName NPG_XML_Article.dtd?>
<?SourceDTD.Version 2.7.10?>
<?ConverterInfo.XSLTName nature2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">5454369</article-id>
    <article-id pub-id-type="pii">ncomms15452</article-id>
    <article-id pub-id-type="doi">10.1038/ncomms15452</article-id>
    <article-id pub-id-type="pmid">28516912</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>A complete tool set for molecular QTL discovery and analysis</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Delaneau</surname>
          <given-names>Olivier</given-names>
        </name>
        <xref ref-type="corresp" rid="c1">a</xref>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
        <xref ref-type="aff" rid="a3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ongen</surname>
          <given-names>Halit</given-names>
        </name>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
        <xref ref-type="aff" rid="a3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Brown</surname>
          <given-names>Andrew A.</given-names>
        </name>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
        <xref ref-type="aff" rid="a3">3</xref>
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8087-3033</contrib-id>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fort</surname>
          <given-names>Alexandre</given-names>
        </name>
        <xref ref-type="aff" rid="a1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Panousis</surname>
          <given-names>Nikolaos I.</given-names>
        </name>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
        <xref ref-type="aff" rid="a3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dermitzakis</surname>
          <given-names>Emmanouil T.</given-names>
        </name>
        <xref ref-type="corresp" rid="c2">b</xref>
        <xref ref-type="aff" rid="a1">1</xref>
        <xref ref-type="aff" rid="a2">2</xref>
        <xref ref-type="aff" rid="a3">3</xref>
      </contrib>
      <aff id="a1"><label>1</label><institution>Department of Genetic Medicine and Development, University of Geneva</institution>, 1 Michel Servet, Geneva CH1211, <country>Switzerland</country></aff>
      <aff id="a2"><label>2</label><institution>Swiss Institute of Bioinformatics, University of Geneva</institution>, 1 Michel Servet, Geneva CH1211, <country>Switzerland</country></aff>
      <aff id="a3"><label>3</label><institution>Institute of Genetics and Genomics in Geneva, University of Geneva</institution>, 1 Michel Servet, Geneva CH1211, <country>Switzerland</country></aff>
    </contrib-group>
    <author-notes>
      <corresp id="c1">
        <label>a</label>
        <email>olivier.delaneau@gmail.com</email>
      </corresp>
      <corresp id="c2">
        <label>b</label>
        <email>emmanouil.dermitzakis@unige.ch</email>
      </corresp>
    </author-notes>
    <pub-date pub-type="epub">
      <day>18</day>
      <month>05</month>
      <year>2017</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2017</year>
    </pub-date>
    <volume>8</volume>
    <elocation-id>15452</elocation-id>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>08</month>
        <year>2016</year>
      </date>
      <date date-type="accepted">
        <day>30</day>
        <month>03</month>
        <year>2017</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>Copyright © 2017, The Author(s)</copyright-statement>
      <copyright-year>2017</copyright-year>
      <copyright-holder>The Author(s)</copyright-holder>
      <license xmlns:xlink="http://www.w3.org/1999/xlink" license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/4.0/">
        <!--author-paid-->
        <license-p>This work is licensed under a Creative Commons Attribution 4.0 International License. The images or other third party material in this article are included in the article's Creative Commons license, unless indicated otherwise in the credit line; if the material is not included under the Creative Commons license, users will need to obtain permission from the license holder to reproduce the material. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link></license-p>
      </license>
    </permissions>
    <abstract>
      <p>Population scale studies combining genetic information with molecular phenotypes (for example, gene expression) have become a standard to dissect the effects of genetic variants onto organismal phenotypes. These kinds of data sets require powerful, fast and versatile methods able to discover molecular Quantitative Trait Loci (molQTL). Here we propose such a solution, QTLtools, a modular framework that contains multiple new and well-established methods to prepare the data, to discover proximal and distal molQTLs and, finally, to integrate them with GWAS variants and functional annotations of the genome. We demonstrate its utility by performing a complete expression QTL study in a few easy-to-perform steps. QTLtools is open source and available at <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" ext-link-type="uri" xlink:href="https://qtltools.github.io/qtltools/">https://qtltools.github.io/qtltools/</ext-link>.</p>
    </abstract>
    <abstract abstract-type="web-summary">
      <p>Analysis of molecular quantitative trait loci (molQTL) can help interpret genome-wide association studies and requires efficient approaches to correct for multiple testing. This study describes a bioinformatics toolkit called QTLtool that can handle large data sets and quickly perform multiple types of molQTL analyses.</p>
    </abstract>
  </article-meta>
</front>
<body>
  <p>To increase the explanatory power of genome-wide association studies (GWAS), many genetic studies now routinely combine genetic information with one or multiple molecular phenotypes such as gene expression<xref ref-type="bibr" rid="b1">1</xref><xref ref-type="bibr" rid="b2">2</xref><xref ref-type="bibr" rid="b3">3</xref>, protein abundance<xref ref-type="bibr" rid="b4">4</xref>, metabolomics<xref ref-type="bibr" rid="b5">5</xref>, methylation<xref ref-type="bibr" rid="b6">6</xref> and chromatin activity<xref ref-type="bibr" rid="b7">7</xref>. This makes the discovery of molecular Quantitative Trait Loci (molQTL) possible; a key step towards better understanding the effects of genetic variants on the cellular machinery and eventually on organismal phenotypes. In practice, this requires analysing data sets comprising of millions of genetic variants and thousands of molecular phenotypes measured on a population scale; a design that aims to perform orders of magnitude more association tests than in a standard GWAS, which prevents the use of standard tools designed to handle only few phenotypes<xref ref-type="bibr" rid="b8">8</xref><xref ref-type="bibr" rid="b9">9</xref>. To face this computational and statistical challenge, there is a clear need of computational methods that are (i) powerful enough to handle the multiple testing problem, (ii) fast enough to easily process large amounts of data in reasonable running times and (iii) versatile enough to adapt to new data sets as they are being generated. Here, we present such an integrated framework, called QTLtools, which allows users to transform raw sequence data into collections of molQTLs in a few easy-to-perform steps, all based on powerful methods that either match or improve those employed in large scale reference studies such as Geuvadis<xref ref-type="bibr" rid="b1">1</xref> and GTEx<xref ref-type="bibr" rid="b10">10</xref>.</p>
  <p>QTLtools is a modular framework designed to accommodate new analysis modules as they are being developed by our group or the scientific community. In its current state, QTLtools performs multiple key tasks (<xref ref-type="fig" rid="f1">Fig. 1</xref>) such as checking the quality of the sequence data, checking that sequence and genotype data match, quantifying and stratifying individuals using molecular phenotypes, discovering proximal or distal molQTLs and integrating them with functional annotations or GWAS data. To demonstrate the utility of this new tool with real data, we used it to perform a complete expression QTL (eQTL) study for 358 European samples where genotype and expression data were generated as part of the 1,000 Genomes<xref ref-type="bibr" rid="b11">11</xref> and Geuvadis<xref ref-type="bibr" rid="b1">1</xref> projects (<xref ref-type="supplementary-material" rid="S1">Supplementary Data 1</xref>).</p>
  <sec disp-level="1">
    <title>Results</title>
    <sec disp-level="2">
      <title>Controlling the quality of the sequence data</title>
      <p>To control the quality of the sequence data, QTLtools proposes two complementary approaches. First, it can measure the proportions of reads (i) mapping to the reference genome and (ii) falling within an annotation of interest (<xref ref-type="supplementary-material" rid="S1">Supplementary Note 1</xref>), such as GENCODE for RNA-seq<xref ref-type="bibr" rid="b12">12</xref>. Second, it can ensure that the sequence data matches the corresponding genotype data; the opposite being an evidence of sample mislabelling<xref ref-type="bibr" rid="b13">13</xref>. To achieve this, QTLtools measures concordance between genotypes and sequencing reads, separately for heterozygous and homozygous genotypes (<xref ref-type="supplementary-material" rid="S1">Supplementary Note 2</xref>). Low values in any of the two measures indicate problems such as sample mislabelling, contamination or amplification biases (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 1</xref>). When performed on Geuvadis, these two approaches demonstrate the high quality of the RNA-seq data (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 2</xref>) and the good match with available genotype data (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 3</xref>).</p>
    </sec>
    <sec disp-level="2">
      <title>Quantifying gene expression</title>
      <p>To quantify gene expression, QTLtools counts the number of sequencing reads overlapping a set of genomic features (for example, exons) listed in a given annotation file (<xref ref-type="supplementary-material" rid="S1">Supplementary Note 3</xref>). We quantified both exon and gene expression levels in all 358 Geuvadis samples using this approach and find 22,147 genes with non-zero quantifications in more than half of the samples (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 4</xref>). Then, we run principal component analysis (PCA) on these quantifications, as implemented in QTLtools (<xref ref-type="supplementary-material" rid="S1">Supplementary Note 4</xref>), to capture any stratification in the sequence data or in the genotype data. In the Geuvadis data, we did not observe any unexpected clusters in the expression data or in the genotype data (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 5</xref>) and used the resulting weights on the first few principal components as latent variables to increase discovery power of any downstream association testing (<xref ref-type="supplementary-material" rid="S1">Supplementary Note 5</xref>).</p>
    </sec>
    <sec disp-level="2">
      <title>Mapping proximal molQTLs</title>
      <p>A core task of QTLtools is to discover proximal (that is, <italic>cis</italic>-acting) molQTLs. To do so, it extends the QTL mapping method introduced by FastQTL<xref ref-type="bibr" rid="b14">14</xref> and offers multiple key improvements that make this step fast and easy-to-perform. First, it uses a permutation scheme that needs a relatively small number of permutations to adjust nominal <italic>P</italic> values for multiple testing (see Methods section and <xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 6</xref>). As a consequence, the whole-Geuvadis eQTL analysis can be performed in short running times (∼32 CPU hours) which has previously been proved to be an order of magnitude faster than a widely used tool, Matrix eQTL<xref ref-type="bibr" rid="b15">15</xref> and provides adjusted <italic>P</italic> values without any lower bounds (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 7</xref>). The running times are actually so small that it becomes possible to process rapidly massive data sets such as the GTEx v6p study<xref ref-type="bibr" rid="b16">16</xref> (7,051 samples in ∼870 CPU hours; <xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 8</xref>) and to repeat the whole analysis multiple times across different sets of quantifications, covariates and QC filters to determine the optimal configuration which maximizes the number of discoveries (<xref ref-type="supplementary-material" rid="S1">Supplementary Figs 9 and 10</xref>). In addition, QTLtools also provides ways to easily extract subsets of data and therefore facilitate detailed inspection of particular eQTLs (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 11</xref>).</p>
    </sec>
    <sec disp-level="2">
      <title>Mapping proximal molQTLs for groups of phenotypes</title>
      <p>As multiple molecular phenotypes can belong to higher order biological entities, for example exons lying within genes or histone modification peaks which form larger variable chromatin modules (VCMs<xref ref-type="bibr" rid="b7">7</xref>), we also implemented two methods to maximize the discoveries in such particular cases (Methods section). Specifically, QTLtools can either (i) aggregate multiple phenotypes in a given group into a single phenotype via PCA or (ii) directly use all individual phenotypes in an extended permutation scheme that accounts for their number and correlation structure. In our experiments, the permutation-based approach seems to outperform the PCA-based approach in terms of number of discoveries in the two data sets we tested (<xref ref-type="fig" rid="f2">Fig. 2a</xref>, <xref ref-type="supplementary-material" rid="S1">Supplementary Data 2</xref>, <xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 12</xref>). In Geuvadis, the permutation-based approach is able to discover an additional set of ∼1,056 eQTLs compared to the standard gene-level quantifications, most of them being for genes containing many exons (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 13</xref>).</p>
    </sec>
    <sec disp-level="2">
      <title>Mapping proximal molQTLs using conditional analysis</title>
      <p>Furthermore, QTLtools can also perform conditional analysis to discover multiple proximal molQTLs with independent effects on a molecular phenotype. To do so, it first uses permutations to derive a nominal <italic>P</italic> value threshold per molecular phenotype that varies and reflects the number of independent tests per <italic>cis</italic>-window. Then, it uses a forward–backward stepwise regression to (i) learn the number of independent signals per phenotype, (ii) determine the best candidate variant per signal and (iii) assign all significant hits to the independent signal they relate to (Methods section). We applied this conditional analysis on Geuvadis and discovered that ∼38% of the significant genes have actually more than one eQTL (<xref ref-type="fig" rid="f2">Fig. 2b</xref>); some have up to six independent eQTLs (<xref ref-type="fig" rid="f2">Fig. 2c</xref>). Interestingly, we also find that combining the conditional analysis with the phenotype grouping approach described above could help to discover even more signals (<xref ref-type="fig" rid="f2">Fig. 2b,c</xref>). The new discoveries resulting from theses analyses in Geuvadis have high replication rates within an independent data set (GTEx<xref ref-type="bibr" rid="b10">10</xref>) suggesting that these are genuine discoveries (<xref ref-type="supplementary-material" rid="S1">Supplementary Note 6</xref>, <xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 14</xref>).</p>
    </sec>
    <sec disp-level="2">
      <title>Mapping distal molQTLs</title>
      <p>Beyond mapping proximal molQTLs, QTLtools also includes methods to discover distal (that is, <italic>trans</italic>-acting) molQTLs. The first method we implemented relies on permuting all phenotypes together to draw from the null distribution of associations while preserving the correlation structure within genotype and phenotype data intact (Methods section). By repeating this permutation scheme multiple times (for example, 100 times in our experiments), we can obtain an empirically calibrated Quantile–Quantile plot that properly shows signal enrichment (<xref ref-type="fig" rid="f2">Fig. 2d</xref>) and can estimate the false discovery rate (FDR) for all the most significant associations: in Geuvadis, we could find 52 genes with at least one significant signal in <italic>trans</italic> at 5% FDR. Given that this full permutation scheme is computationally intensive (∼450 CPU hours for 100 permutations), we also designed an approximation of this process that gives reasonably close FDR estimates while being multiple orders of magnitude faster (∼7 CPU hours; Methods section). Given that the whole genome is effectively tested for each phenotype, we quickly build a null distribution of associations for a single phenotype by permutations. We then use this null distribution to adjust each nominal <italic>P</italic> value for the number of variants being tested and then use standard FDR methods<xref ref-type="bibr" rid="b17">17</xref> on the resulting set of adjusted <italic>P</italic> values to correct for the multiple phenotypes being tested. In practice, this approach can be seen as an extension of the mapping strategy we use in <italic>cis</italic> for <italic>trans</italic> analysis, and gives FDR estimates that are close to those obtained with the full permutation pass (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 15</xref>) while being much faster to obtain (∼64 times faster in our experiments).</p>
    </sec>
    <sec disp-level="2">
      <title>Integrating molQTLs with GWAS and functional data</title>
      <p>Finally, we also implemented multiple methods to integrate collections of molQTLs with two types of external data: functional genome annotations and GWAS results. First, QTLtools can estimate if a molQTL and a variant of interest (typically a GWAS hit) pinpoint the same underlying functional variant. To do so, it uses regulatory trait concordance<xref ref-type="bibr" rid="b18">18</xref> (<xref ref-type="supplementary-material" rid="S1">Supplementary Note 7</xref>); a sophisticated conditional analysis scheme designed to account for linkage disequilibrium as a confounding factor when co-localizing molQTLs and GWAS hits. This can be used, for instance, to determine the subset of GWAS hits that are likely mediated by molQTLs; a useful piece of information to understand the function of GWAS hits. When applied on Geuvadis and the NHGRI-EBI GWAS catalogue<xref ref-type="bibr" rid="b19">19</xref>, we estimated to which extent the disease associated variants reported in this catalogue overlap with eQTLs for lymphoblastoid cell lines (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 16</xref>). Alternatively, QTLtools can also look at the overlap between molQTLs and functional annotations such as those provided by ENCODE<xref ref-type="bibr" rid="b12">12</xref>. Specifically, it can compute the density of annotations around molQTL locations and, when they do overlap, estimate if it is more often than what is expected by chance (Methods section). This allows the distribution of functional annotations around molQTLs to be inspected visually (<xref ref-type="fig" rid="f2">Fig. 2e</xref>) and statistically (<xref ref-type="fig" rid="f2">Fig. 2f</xref>). When using this on the various sets of eQTLs we have discovered so far, we find that they tend to fall within transcription factor binding sites and open chromatin regions (<xref ref-type="fig" rid="f2">Fig. 2f</xref>), in line with previous knowledge on eQTLs<xref ref-type="bibr" rid="b1">1</xref>.</p>
    </sec>
    <sec disp-level="2">
      <title>Computational efficiency</title>
      <p>All functionality described above has been implemented in C++ for high performance and in a modular way to facilitate future implementation of additional functionalities by the community. In practice, this allows all the experiments described above to be run in a relatively short time (<xref ref-type="supplementary-material" rid="S1">Supplementary Table 1</xref>); the full set of analyses described above were completed in ∼1,327 CPU hours (=∼55 CPU days). In addition, QTLtools has been designed so that the computational load can be easily distributed across the multiple CPU cores that are typically available on a compute cluster. The tasks run on individual samples (for example, QC the sequence data) are simple to parallelize as one compute job per individual. For population-based tasks, such as QTL mapping, the input data is automatically split into small genomic chunks that are then run conveniently and independently on distinct CPU cores.</p>
    </sec>
  </sec>
  <sec disp-level="1">
    <title>Discussion</title>
    <p>Population scale studies combining genetic variation and molecular phenotypes have become a standard to detect molecular QTLs. This requires multiple computational steps to go from the raw sequence and genotype data to collections of molecular QTLs. So far, this can be done using multiple tools that are often hard to combine and/or adapt to the amount of data involved. We propose in this paper, QTLtools, a software package that integrates all functionalities required to easily and rapidly perform this task. It includes multiple new and powerful statistical methods to prepare and control the quality of the data, to map proximal and distal QTLs and to integrate those with GWAS results and functional annotations. It also offers a unique framework for the community to develop further additional methods or alternative to the ones already included, so that molecular QTL analysis can be more seamless among laboratories. By its integrative design and efficient implementation, QTLtools dramatically decreases the time needed to set up and run the various analysis pipelines traditionally needed by molecular QTL studies, freeing researchers to spend more effort on the interpretation and validation of their results.</p>
  </sec>
  <sec disp-level="1">
    <title>Methods</title>
    <sec disp-level="2">
      <title>Mapping proximal molQTLs using permutations</title>
      <p>Mapping proximal molecular QTL consists of finding statistically significant associations between molecular phenotypes and nearby genetic variants; a task commonly undertaken using linear regressions<xref ref-type="bibr" rid="b1">1</xref><xref ref-type="bibr" rid="b10">10</xref><xref ref-type="bibr" rid="b14">14</xref>. In practice, this requires millions of association tests to scan all possible phenotype-variant pairs in <italic>cis</italic> (that is, variants located within a specific window around a phenotype), resulting in millions of nominal <italic>P</italic> values. Due to the large number of tests performed per molecular phenotype, multiple testing has to be accounted for to assess the significance of any discovered candidate molQTL. A first naive solution to this problem is to correct the nominal <italic>P</italic> values for the number of tested variants using the Bonferroni method. However, due to the specific and highly variable nature of each genomic region being tested in terms of allele frequency and linkage disequilibrium, the Bonferroni method usually proves to be overly stringent and results in many false negatives. To overcome this issue, a commonly adopted approach is to analyse thousands of permuted data sets for each phenotype to empirically characterize the null distribution of associations (that is, the distribution of <italic>P</italic> values expected under the null hypothesis of no associations). Then, we can easily assess how likely an observed association obtained in the nominal pass originates from the null, resulting in an adjusted <italic>P</italic> value. In practice, thousands of permutations are required in this context and therefore fast methods able to absorb such substantial computational loads in reasonable running times are needed. FastQTL has recently emerged as a good candidate for this task by proposing a fast and efficient permutation scheme in which the null distribution of associations for a phenotype is modelled using a beta distribution<xref ref-type="bibr" rid="b14">14</xref>. This allows approximating the tail of the null distribution relatively well using only few permutations and also accurately estimating adjusted <italic>P</italic> values at any significance level in short running times. In the original FastQTL paper, it has been shown that running 1,000 permutations gives accurate adjusted <italic>P</italic> values while being ∼17 times faster than when implementing the standard permutation scheme with MatrixeQTL running on a BLAS-optimized R version<xref ref-type="bibr" rid="b15">15</xref>. In QTLtools, we use exactly the same approach than in FastQTL: we approximate the permutation outcome with a beta distribution. We run this method on Geuvadis using 1,000 permutations and a <italic>cis</italic>-window of 1 Mb. And since the eQTL mapping is quick and easy, we repeated the whole-mapping pass multiple times across multiple conditions. Specifically, we repeated the whole-Geuvadis analysis across multiple missing data proportion filters (that is, %genes with RPKM=0 between 0 and 100; <xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 10</xref>) and numbers of expression-derived Principal Components (that is, PCs between 0 and 100; <xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 9</xref>). We therefore determine that the optimal configuration to maximize the number of discoveries relies on filtering out genes with more than 50% of the samples with non-zero quantifications and using 50 expression-based PCs as covariates. In all downstream analyses, we used this configuration when not specified otherwise.</p>
    </sec>
    <sec disp-level="2">
      <title>Mapping proximal QTLs for groups of phenotypes</title>
      <p>It is common that some kinds of molecular phenotypes may belong to higher order biological entities. For instance, a given gene often contains multiple exons. Similarly, nearby regulatory elements may cooperate within some module structures such as VCM<xref ref-type="bibr" rid="b7">7</xref> or topologically associated domains<xref ref-type="bibr" rid="b20">20</xref>. To map molecular QTLs at the level of these higher order biological entities, we need methods able to properly combine information at all the multiple molecular phenotypes they contain. In the context of genes, this has traditionally been done at the quantification level: read counts at multiple exons are summed up to get gene-level quantifications that are then used to discover gene-level eQTL. In QTLtools, we introduced two approaches to combine locally multiple molecular phenotypes belonging to a given group. First, we extended the permutation scheme described above to deal with each group of phenotype independently. Assuming that a phenotypic group <italic>P</italic> (for example, gene) contains <italic>M</italic> phenotypes (for example, exons) and that the corresponding <italic>cis</italic>-window <italic>G</italic> contains <italic>L</italic> genetic variants, QTLtools proceeds as follows:
<list id="l1" list-type="order"><list-item><p>All <italic>M</italic>x<italic>L</italic> possible variant-phenotype pairs are tested using linear regressions. The pair with the smallest nominal <italic>P</italic> value is stored as best candidate QTL for this group of phenotype.</p></list-item><list-item><p>Permute simultaneously all phenotypes in <italic>P</italic> using the same random number sequence. As a result, the inner correlation structure within both <italic>P</italic> and <italic>G</italic> remains completely unchanged, while the correlation in between <italic>P</italic> and <italic>G</italic> is broken.</p></list-item><list-item><p>Draw from the null distribution of association between <italic>P</italic> and <italic>G</italic> by scanning all <italic>M</italic>x<italic>L</italic> possible variant-phenotype pairs in the permuted data set and by retaining the best association.</p></list-item><list-item><p>Build empirically the null distribution of association between <italic>G</italic> and <italic>P</italic> by repeating the steps (2) and (3) as many times as needed (typically 1,000 times is enough).</p></list-item><list-item><p>Fit a beta distribution on this empirically defined null distribution using expectation-maximization<xref ref-type="bibr" rid="b14">14</xref>. This effectively makes the null distribution continuous.</p></list-item><list-item><p>Adjust the nominal <italic>P</italic> value of the best pair obtained in step (1) using the fitted beta distribution.</p></list-item><list-item><p>Repeat step (1) to (6) for all groups of phenotypes to get a candidate QTL together with an adjusted <italic>P</italic> value of association for each.</p></list-item><list-item><p>Determine all significant QTLs at a given FDR (typically 5%) using a FDR procedure such as Storey–Tibshirani implemented in <italic>R/q</italic> value<xref ref-type="bibr" rid="b17">17</xref> on the adjusted <italic>P</italic> values.</p></list-item></list></p>
      <p>Note that this permutation scheme corrects for both the number of genetic variants and the number of molecular phenotypes being tested while properly accounting for their inner correlation structure. As a consequence, when the beta distribution is fitted in step (5), we get an estimate of the effective number of independent tests corresponding to the actual <italic>M</italic>x<italic>L</italic> tests we performed. Alternatively to this extended permutation scheme, we also implemented an approach based on dimensionality reduction. This has been previously used to discover QTLs for VCMs from single-ChIP-seq peak quantifications<xref ref-type="bibr" rid="b7">7</xref>. Here, a PCA is first performed on the <italic>M</italic> phenotypes and the loadings on the first PC are used as a quantification vector for the entire group of phenotypes. We can then perform the standard mapping approach implemented in QTLtools to discover a QTL for <italic>P</italic>. We applied these two approaches on Geuvadis to discover gene-level eQTL from exonic quantifications and compared them with the standard gene-level quantifications. We find that the largest number of eQTL is obtained with the extended permutation scheme and the smallest with the PCA-based approach; the gene-level quantifications lying in between. The boost provided by the extended permutation scheme is really appreciable since we get an additional set of 1,019 eQTLs that the gene-level quantification is unable to discover (<xref ref-type="fig" rid="f2">Fig. 2a</xref>). Of note, it really helps to discover eQTL for genes having a high number of exons (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 13</xref>). In addition to this, we also applied both approaches on the histone modification data to discover vcmQTL and find similar results (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 12</xref>). Despite the lower performance of the PCA-based approach in this context, we decided to keep it in QTLtools since we believe it can still be useful in a different context; such as for instance when we are more interested in capturing instead the common trend between multiple phenotypes within a group.</p>
    </sec>
    <sec disp-level="2">
      <title>Mapping proximal molQTLs using conditional analysis</title>
      <p>The two mapping approaches above only report a single candidate QTL per phenotype or group of phenotypes. In some cases, this limitation may reduce significantly the number of discoveries. For example, it is relatively frequent that expression for a given gene is affected by multiple proximal eQTLs<xref ref-type="bibr" rid="b1">1</xref>. A well-established approach to discover multiple QTLs with independent effects on a given phenotype relies on conditional analysis: new discoveries are made by conditioning on previous ones. In QTLtools, we implemented a conditional analysis scheme based on stepwise linear regression that is fast, accounts for multiple testing and automatically learns the number of independent signals per phenotype. Specifically, we implemented it as follows for both grouped and ungrouped phenotypes:
<list id="l2" list-type="order"><list-item><p><italic>Initialization</italic>. We determine a nominal <italic>P</italic> value threshold of significance on a per-phenotype basis. To do so, we first perform a permutation pass as described above which gives us an adjusted <italic>P</italic> value per phenotype (or group of phenotypes) together with its most likely beta parameter values. Next, we determine the adjusted <italic>P</italic> value threshold corresponding to the targeted FDR level (for example, 5% FDR) and feed the beta quantile function (for example, <italic>R/q</italic> beta) with it to get a specific nominal <italic>P</italic> value threshold for each phenotype. Here, the beta quantile function allows us to use the Beta distribution in a reversed way: from adjusted <italic>P</italic> value to nominal <italic>P</italic> value. Note that the resulting nominal <italic>P</italic> value thresholds vary from one phenotype to the other depending on the complexity of the <italic>cis</italic> regions being tested and the effective number of independent tests they encapsulate.</p></list-item><list-item><p><italic>Forward pass</italic>. We next learn the number of independent signals per phenotype using stepwise regressions with forward variable selection. More specifically, we start from the original phenotype quantifications and search for the variant in <italic>cis</italic> with the strongest association. When the corresponding nominal <italic>P</italic> value of association is below the threshold defined in step (1), we store the variant as additional and independent discovery and residualize its genotypes out from the phenotype quantifications. We then repeat these two steps until no more significant discovery is made: this immediately gives us the number of independent molQTLs together with a best candidate variant for each.</p></list-item><list-item><p><italic>Backward pass</italic>. Finally, we try to assign nearby genetic variants to the various independent signals we discovered in step (2). To do so, we define a linear regression model that contains all candidate QTLs discovered so far in the forward pass: <italic>P</italic>=<italic>Q</italic><sub><italic>1</italic></sub>+…+<italic>Q</italic><sub><italic>i</italic></sub>+…+<italic>Q</italic><sub><italic>R</italic></sub> where <italic>R</italic> is the number of independent signals and {<italic>Q</italic>
<sub><italic>1</italic></sub>, …, <italic>Q</italic>
<sub><italic>i</italic></sub>, …, <italic>Q</italic>
<sub><italic>R</italic></sub>} are the corresponding best molQTL candidates. Then, we test all possible hypotheses by fitting this model <italic>R</italic>x(<italic>L</italic>-<italic>R</italic>) times each time fixing { <italic>Q</italic>
<sub><italic>1</italic></sub>, …, <italic>Q</italic>
<sub><italic>i−1</italic></sub>, <italic>Q</italic>
<sub><italic>i+1</italic></sub>,…, <italic>Q</italic>
<sub><italic>R</italic></sub> } and setting <italic>Q</italic>
<sub><italic>i</italic></sub> as another variant in <italic>cis</italic> (<italic>L</italic>–<italic>R</italic> variants in <italic>cis</italic> not being a candidate molQTL times <italic>R</italic> independent signals). We then end up with a vector of <italic>R</italic> nominal <italic>P</italic> values for each variant in <italic>cis</italic> which allows us to determine the signal the variant belongs to by simply finding the smallest <italic>P</italic> value in this vector and comparing it to the significance threshold obtained in step (1).</p></list-item></list></p>
    </sec>
    <sec disp-level="2">
      <title>Mapping distal molQTLs</title>
      <p>Another common problem in the field of QTL discovery relates to mapping distal QTLs (that is, <italic>trans</italic>-QTL). This presents multiple computational and statistical challenges related to multiple testing, computational feasibility and confounding factors such as read misalignment, gene homology or incorrect gene location. In the context of this work; we only address two particular problems: how to correct for multiple testing and how to perform this analysis in reasonable running times. We solved this problem by testing all possible phenotype-variant pairs for association excluding all those in <italic>cis</italic> (that is, implying that the phenotype and the variant cannot be proximal, typically &lt;5 Mb) using linear regressions with high computational performance as we do for <italic>cis</italic> mapping. In practice, we manage to perform ∼1.3 M linear regressions per second for 358 individuals on an AMD Opteron(tm) Processor 6,174 at 2.2 GHz. To minimize the RAM usage, the phenotype data is stored in memory and the genotype data streamed as we move along the genome and tested against all phenotypes at once. To minimize the size of the output files, we only report detailed information for associations below a given threshold (typically 10<sup>−5</sup> for nominal <italic>P</italic> values); all those above are simply binned to have an idea of the overall <italic>P</italic> value distribution. Once the nominal pass done, we correct for multiple testing using one of these two approaches:
<list id="l3" list-type="order"><list-item><p><italic>Full permutation scheme</italic>. We permute all phenotypes using the same random number sequence to preserve the correlation structure unchanged. By doing so, the only association we actually break in the data is between the genotype and the phenotype data. Then, we proceed with a standard association scan identical to the one used in the nominal pass. In practice, we repeat this for 100 permutations of the phenotype data. Then, we can proceed with FDR correction by ranking all the nominal <italic>P</italic> values in increasing order and by counting how many <italic>P</italic> values in the permuted data sets are smaller. This immediately gives an FDR estimate: if we have 500 <italic>P</italic> values in the permuted data sets being smaller than the 100th smallest nominal <italic>P</italic> value, we can then assume that the FDR for the 100 first associations is around 5% (=500/(100 × 100)).</p></list-item><list-item><p><italic>Approximate permutation scheme</italic>. To enable fast screening in <italic>trans</italic>, we also designed an approximation of the method described just above based on what we already do in <italic>cis</italic>. To make it possible, we assume that the phenotypes are independent and normally distributed (which can be enforced in practice). Then, we draw from the null by permuting only one randomly chosen phenotype, testing for associations with all variants in <italic>trans</italic> and storing the smallest <italic>P</italic> value. When we repeat this many times (typically 1,000 or 10,000 times), we effectively build a null distribution of the strongest associations for a single phenotype. We then make it continuous by fitting a beta distribution as we do in <italic>cis</italic> and use it to adjust every nominal <italic>P</italic> value coming from the initial pass for the number of variants being tested. To correct for the number of phenotypes being tested, we estimate FDR (using <italic>R/q</italic> value) again as we do in <italic>cis</italic>; that is onto the best adjusted <italic>P</italic> values per phenotype (one per phenotype). As a by-product, this also gives an adjusted <italic>P</italic> value threshold that we finally use to identify all phenotype-variant pairs that are whole-genome significant. In our experiments, this approach gives similar results to the full permutation scheme both in term of FDR estimates and number of discoveries (<xref ref-type="supplementary-material" rid="S1">Supplementary Fig. 15</xref>).</p></list-item></list></p>
    </sec>
    <sec disp-level="2">
      <title>Integrating molQTLs with functional annotations</title>
      <p>QTLtools includes two approaches to integrate molQTLs with functional annotations. First, it can measure the density of functional annotations around the genomic positions of molQTLs. To do so, we first enumerate all annotations within a given window around the molQTLs (by default 1 Mb). Then, we split this window into small bins (default 1 kb) and count the number of functional annotations overlapping each bin. This produces an annotation count per bin that can be then plotted to see if there is any peak or depletion around the molQTLs (<xref ref-type="fig" rid="f2">Fig. 2e</xref>). Complementary to this density-based representation, QTLtools can also assess if the molQTLs overlap the functional annotations more often than what we expect by chance. Here, we mean by chance what is expected given the non-uniform distributions of molQTLs and functional annotations around the genomic positions of the molecular phenotypes. To do so, we first enumerate all the functional annotations located nearby (for example, within 1 Mb) a given molecular phenotype. In practice, for <italic>X</italic> phenotypes being quantified, we have <italic>X</italic> lists of annotations. And, for the subset <italic>Y</italic> of those having a significant molQTL, we count how often the <italic>Y</italic> molQTLs overlap the annotations in the corresponding lists: this gives the observed overlap frequency <italic>fobs(Y)</italic> between molQTLs and functional annotations. Then, we permute randomly many times (typically a 1,000 times) the lists of functional annotations across the phenotypes (for example, phenotype <italic>A</italic> may be assigned the list of annotations coming from phenotype <italic>B</italic>) and for each permuted data set, we count how often the <italic>Y</italic> molQTLs do overlap the newly assigned functional annotations: this gives the expected overlap frequency <italic>fexp(Y)</italic> between molQTLs and functional annotations. By doing this permutation scheme, we keep unchanged the distribution of functional annotations and molQTLs around molecular phenotypes. Now that we have the observed and expected overlap frequencies, we use a fisher test to assess how <italic>fobs(Y)</italic> and <italic>fexp(Y)</italic> differ. This gives an odd ratio estimate and a tow-sided <italic>P</italic> value which basically tells us first if there is enrichment or depletion and second how significant this is. Then, we typically plot these two quantities on a scatter plot with the <italic>x</italic> axis and <italic>y</italic> axis being the odd ratio and the significance of the enrichment/depletion, respectively (<xref ref-type="fig" rid="f2">Fig. 2f</xref>). In our experiments, we use three types of functional annotations generated by ENCODE<xref ref-type="bibr" rid="b12">12</xref> for lymphoblastoid cell lines: open chromatin regions given by DNAse footprinting, a union of all transcription factor binding sites assayed by ChIP-seq and transcribed regions as predicted by ChromHMM<xref ref-type="bibr" rid="b21">21</xref>.</p>
    </sec>
    <sec disp-level="2">
      <title>Data availability</title>
      <p>The Geuvadis RNA-seq data corresponds exactly to what has been generated in the original Geuvadis study, so please consult the <xref ref-type="supplementary-material" rid="S1">Supplementary Materials</xref> of the paper<xref ref-type="bibr" rid="b1">1</xref> for a more detailed description of the experimental protocol used for RNA-seq data generation. In our experiments, we focus our attention on a subset of 358 European samples for which we also have complete DNA sequence data generated as part of the phase 3 of the 1,000 Genomes project<xref ref-type="bibr" rid="b22">22</xref>. All variant sites with a minor allele frequency across all 358 samples below 5% or exhibiting more than two possible alleles have been removed which resulted in a set of 6,241,929 single-nucleotide variants and 843,851 short insertion–deletions or structural variants left for the analysis. All the raw sequence data can be downloaded from <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" ext-link-type="uri" xlink:href="http://www.ebi.ac.uk/arrayexpress/files/E-GEUV-1/processed/(RNA-seq%20data">http://www.ebi.ac.uk/arrayexpress/files/E-GEUV-1/processed/</ext-link> (RNA-seq data) and <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" ext-link-type="uri" xlink:href="ftp://ftp.1000genomes.ebi.ac.uk/vol1/ftp/release/20130502/">ftp://ftp.1000genomes.ebi.ac.uk/vol1/ftp/release/20130502/</ext-link> (for DNA-seq data)</p>
      <p>The histone modification data set contains ChIP-seq across for 3 histone modifications across 47 European samples: H3K4me1, H3K4me3 and H3K27ac that are known to usually tag enhancers, promoters and active regions. Please consult this paper<xref ref-type="bibr" rid="b7">7</xref> for more detailed description of the experimental protocols used for the ChIP-seq data generation. In this data set, the samples have been either sequenced or imputed from an Illumina OMNI2.5 M as part of the phase 1 of the 1,000 Genomes project<xref ref-type="bibr" rid="b11">11</xref>. Again, all variant sites with a minor allele frequency across the 47 samples below 5% or exhibiting more than two possible alleles have been removed which resulted in a set of 6,085,881 single-nucleotide variants and 606,344 short insertion–deletions or structural variants. All the raw ChIP-seq data can be downloaded from <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-3657/">https://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-3657/</ext-link>.</p>
      <p>QTLtools is open source and available for download at <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" ext-link-type="uri" xlink:href="https://qtltools.github.io/qtltools/">https://qtltools.github.io/qtltools/</ext-link>.</p>
    </sec>
  </sec>
  <sec disp-level="1">
    <title>Additional information</title>
    <p><bold>How to cite this article:</bold> Delaneau, O. <italic>et al</italic>. A complete tool set for molecular QTL discovery and analysis. <italic>Nat. Commun.</italic>
<bold>8,</bold> 15452 doi: 10.1038/ncomms15452 (2017).</p>
    <p><bold>Publisher's note</bold>: Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
  </sec>
  <sec sec-type="supplementary-material" id="S1">
    <title>Supplementary Material</title>
    <supplementary-material id="d32e18" content-type="local-data">
      <caption>
        <title>Supplementary Information</title>
        <p>Supplementary Figures, Supplementary Table, Supplementary Notes and Supplementary References</p>
      </caption>
      <media xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="ncomms15452-s1.pdf"/>
    </supplementary-material>
    <supplementary-material id="d32e24" content-type="local-data">
      <caption>
        <title>Peer Review File</title>
      </caption>
      <media xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="ncomms15452-s2.pdf"/>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack>
    <p>This research is supported by grants from European Commission SYSCOL FP7, European Research Council, Louis Jeantet Foundation, Swiss National Science Foundation, SystemsX, the NIH-NIMH (GTEx) and Helse Sør Øst. The computations were performed at the Vital-IT Swiss Institute of Bioinformatics.</p>
  </ack>
  <ref-list>
    <ref id="b1">
      <mixed-citation publication-type="journal"><name><surname>Lappalainen</surname><given-names>T.</given-names></name><etal/>. <article-title>Transcriptome and genome sequencing uncovers functional variation in humans</article-title>. <source>Nature</source><volume>501</volume>, <fpage>506</fpage>–<lpage>511</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">24037378</pub-id></mixed-citation>
    </ref>
    <ref id="b2">
      <mixed-citation publication-type="journal"><name><surname>Westra</surname><given-names>H. J.</given-names></name><etal/>. <article-title>Systematic identification of trans-eQTLs as putative drivers of known disease associations</article-title>. <source>Nat Genet.</source><volume>45</volume>, <fpage>1238</fpage>–<lpage>1243</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">24013639</pub-id></mixed-citation>
    </ref>
    <ref id="b3">
      <mixed-citation publication-type="journal"><name><surname>Pickrell</surname><given-names>J. K.</given-names></name><etal/>. <article-title>Understanding mechanisms underlying human gene expression variation with RNA sequencing</article-title>. <source>Nature</source><volume>464</volume>, <fpage>768</fpage>–<lpage>772</lpage> (<year>2010</year>).<pub-id pub-id-type="pmid">20220758</pub-id></mixed-citation>
    </ref>
    <ref id="b4">
      <mixed-citation publication-type="journal"><name><surname>Picotti</surname><given-names>P.</given-names></name><etal/>. <article-title>A complete mass-spectrometric map of the yeast proteome applied to quantitative trait analysis</article-title>. <source>Nature</source><volume>494</volume>, <fpage>266</fpage>–<lpage>270</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">23334424</pub-id></mixed-citation>
    </ref>
    <ref id="b5">
      <mixed-citation publication-type="journal"><name><surname>Kraus</surname><given-names>W. E.</given-names></name><etal/>. <article-title>Metabolomic Quantitative Trait Loci (mQTL) mapping implicates the ubiquitin proteasome system in cardiovascular disease pathogenesis</article-title>. <source>PLoS Genet.</source><volume>11</volume>, <fpage>e1005553</fpage> (<year>2015</year>).<pub-id pub-id-type="pmid">26540294</pub-id></mixed-citation>
    </ref>
    <ref id="b6">
      <mixed-citation publication-type="journal"><name><surname>Gutierrez-Arcelus</surname><given-names>M.</given-names></name><etal/>. <article-title>Passive and active DNA methylation and the interplay with genetic variation in gene regulation</article-title>. <source>eLife</source><volume>2</volume>, <fpage>e00523</fpage> (<year>2013</year>).<pub-id pub-id-type="pmid">23755361</pub-id></mixed-citation>
    </ref>
    <ref id="b7">
      <mixed-citation publication-type="journal"><name><surname>Waszak</surname><given-names>S.</given-names></name><etal/>. <article-title>Population variation and genetic control of modular chromatin architecture in humans</article-title>. <source>Cell</source><volume>162</volume>, <fpage>1039</fpage>–<lpage>1050</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">26300124</pub-id></mixed-citation>
    </ref>
    <ref id="b8">
      <mixed-citation publication-type="journal"><name><surname>Canela-Xandri</surname><given-names>O.</given-names></name><etal/>. <article-title>A new tool called DISSECT for analysing large genomic data sets using a Big Data approach</article-title>. <source>Nat. Commun.</source><volume>6</volume>, <fpage>10162</fpage> (<year>2015</year>).<pub-id pub-id-type="pmid">26657010</pub-id></mixed-citation>
    </ref>
    <ref id="b9">
      <mixed-citation publication-type="journal"><name><surname>Purcell</surname><given-names>S.</given-names></name><etal/>. <article-title>PLINK: a tool set for whole-genome association and population-based linkage analyses</article-title>. <source>Am. J. Hum. Genet.</source><volume>81</volume>, <fpage>559</fpage>–<lpage>575</lpage> (<year>2007</year>).<pub-id pub-id-type="pmid">17701901</pub-id></mixed-citation>
    </ref>
    <ref id="b10">
      <mixed-citation publication-type="journal">GTEx Consortium. <article-title>The Genotype-Tissue Expression (GTEx) pilot analysis: multitissue gene regulation in humans</article-title>. <source>Science</source>
<volume>348</volume>, <fpage>648</fpage>–<lpage>660</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">25954001</pub-id></mixed-citation>
    </ref>
    <ref id="b11">
      <mixed-citation publication-type="journal">The 1000 Genomes Project Consortium. <article-title>An integrated map of genetic variation from 1,092 human genomes</article-title>. <source>Nature</source>
<volume>491</volume>, <fpage>56</fpage>–<lpage>65</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">23128226</pub-id></mixed-citation>
    </ref>
    <ref id="b12">
      <mixed-citation publication-type="journal">ENCODE Project Consortium. <article-title>An integrated encyclopedia of DNA elements in the human genome</article-title>. <source>Nature</source>
<volume>489</volume>, <fpage>57</fpage>–<lpage>74</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">22955616</pub-id></mixed-citation>
    </ref>
    <ref id="b13">
      <mixed-citation publication-type="journal"><name><surname>Hoen</surname><given-names>P. A.</given-names></name><etal/>. <article-title>Reproducibility of high-throughput mRNA and small RNA sequencing across laboratories</article-title>. <source>Nat. Biotechnol.</source><volume>31</volume>, <fpage>1015</fpage>–<lpage>1022</lpage> (<year>2013</year>).<pub-id pub-id-type="pmid">24037425</pub-id></mixed-citation>
    </ref>
    <ref id="b14">
      <mixed-citation publication-type="journal"><name><surname>Ongen</surname><given-names>H.</given-names></name><etal/>. <article-title>Fast and efficient QTL mapper for thousands of molecular phenotypes</article-title>. <source>Bioinformatics</source><volume>32</volume>, <fpage>1479</fpage>–<lpage>1485</lpage> (<year>2016</year>).<pub-id pub-id-type="pmid">26708335</pub-id></mixed-citation>
    </ref>
    <ref id="b15">
      <mixed-citation publication-type="journal"><name><surname>Shabalin</surname><given-names>A. A.</given-names></name><article-title>Matrix eQTL: ultra fast eQTL analysis via large matrix operations</article-title>. <source>Bioinformatics</source><volume>28</volume>, <fpage>1353</fpage>–<lpage>1358</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">22492648</pub-id></mixed-citation>
    </ref>
    <ref id="b16">
      <mixed-citation publication-type="other"><name><surname>Aguet</surname><given-names>F.</given-names></name><etal/>. Local genetic effects on gene expression across 44 human tissues. bioRxiv 074450; <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" ext-link-type="uri" xlink:href="http://dx.doi.org/10.1101/074450">http://dx.doi.org/10.1101/074450</ext-link>.</mixed-citation>
    </ref>
    <ref id="b17">
      <mixed-citation publication-type="journal"><name><surname>Storey</surname><given-names>J. D.</given-names></name> &amp; <name><surname>Tibshirani</surname><given-names>R.</given-names></name>
<article-title>Statistical significance for genomewide studies</article-title>. <source>Proc. Natl Acad. Sci. USA</source>
<volume>100</volume>, <fpage>9440</fpage>–<lpage>9445</lpage> (<year>2003</year>).<pub-id pub-id-type="pmid">12883005</pub-id></mixed-citation>
    </ref>
    <ref id="b18">
      <mixed-citation publication-type="journal"><name><surname>Nica</surname><given-names>A. C.</given-names></name><etal/>. <article-title>Candidate causal regulatory effects by integration of expression QTLs with complex trait genetic associations</article-title>. <source>PLoS Genet.</source><volume>6</volume>, <fpage>e1000895</fpage> (<year>2010</year>).<pub-id pub-id-type="pmid">20369022</pub-id></mixed-citation>
    </ref>
    <ref id="b19">
      <mixed-citation publication-type="journal"><name><surname>Welter</surname><given-names>D.</given-names></name><etal/>. <article-title>The NHGRI GWAS Catalog, a curated resource of SNP-trait associations</article-title>. <source>Nucleic Acids Res.</source><volume>42</volume>, <fpage>D1001</fpage>–<lpage>D1006</lpage> (<year>2014</year>).<pub-id pub-id-type="pmid">24316577</pub-id></mixed-citation>
    </ref>
    <ref id="b20">
      <mixed-citation publication-type="journal"><name><surname>Rao</surname><given-names>S. S.</given-names></name><etal/>. <article-title>A 3D map of the human genome at kilobase resolution reveals principles of chromatin looping</article-title>. <source>Cell</source><volume>159</volume>, <fpage>1665</fpage>–<lpage>1680</lpage> (<year>2014</year>).<pub-id pub-id-type="pmid">25497547</pub-id></mixed-citation>
    </ref>
    <ref id="b21">
      <mixed-citation publication-type="journal"><name><surname>Ernst</surname><given-names>J.</given-names></name> &amp; <name><surname>et Kellis</surname><given-names>M.</given-names></name>
<article-title>ChromHMM: automating chromatin-state discovery and characterization</article-title>. <source>Nat. Methods.</source>
<volume>9</volume>, <fpage>215</fpage>–<lpage>216</lpage> (<year>2012</year>).<pub-id pub-id-type="pmid">22373907</pub-id></mixed-citation>
    </ref>
    <ref id="b22">
      <mixed-citation publication-type="journal">1000 Genomes Project Consortium. <article-title>A global reference for human genetic variation</article-title>. <source>Nature</source>
<volume>526</volume>, <fpage>68</fpage>–<lpage>74</lpage> (<year>2015</year>).<pub-id pub-id-type="pmid">26432245</pub-id></mixed-citation>
    </ref>
  </ref-list>
  <fn-group>
    <fn fn-type="COI-statement">
      <p>The authors declare no competing financial interests.</p>
    </fn>
    <fn>
      <p><bold>Author contributions</bold> O.D., H.O., A.A.B. and E.T.D. designed the research. O.D. and H.O. implemented the methods. O.D. analysed data. A.F. and N.I.P. helped to test various functionalities. O.D. and E.T.D. supervised the research. O.D. wrote the paper.</p>
    </fn>
  </fn-group>
</back>
<floats-group>
  <fig id="f1">
    <label>Figure 1</label>
    <caption>
      <title>Flow chart of the main QTLtools functionalities.</title>
      <p>This represents how the various functionalities of QTLtools can be combined to go from the raw sequence and genotype data to collections of molecular QTLs which can then be integrated with both GWAS data and functional annotations. Data is represented with ovals and tasks with boxes in which the name of the mode is shown in bold black with a short description of what it does.</p>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="ncomms15452-f1"/>
  </fig>
  <fig id="f2">
    <label>Figure 2</label>
    <caption>
      <title>Outcome of multiple key analyses on Geuvadis.</title>
      <p>(<bold>a</bold>) The number of eGenes discovered (<italic>y</italic> axis) as a function of the number of Principal Components (<italic>x</italic> axis) used to correct for technical variance for three different ways of aggregating signal at multiple exons: at the quantification level (in blue) or at the QTL mapping level by using either the extended permutation scheme (in red) or PCA (in brown). (<bold>b</bold>) The numbers of eGenes (<italic>y</italic> axis) with a unique eQTL (solid lines) or multiple eQTLs (dotted lines) as a function of the number of principal components (<italic>x</italic> axis) used to correct for technical variance. This is shown for two approaches for aggregating the signal at multiple exons: at the quantification level (in blue) or at the QTL mapping level by using the extended permutation scheme (in red). (<bold>c</bold>) The number of eGenes on a log scale (<italic>y</italic> axis) as a function of the number of independent eQTLs discovered for those (<italic>x</italic> axis). This is again shown for two different approaches for aggregating the signal at multiple exons. (<bold>d</bold>) A Quantile–Quantile plot produced from a <italic>trans</italic>-QTL analysis on Geuvadis. Each green solid line compares the <italic>P</italic> values of associations of the original gene expression data to those obtained from a permuted data set. In total, 100 permutations have been performed, resulting in 100 green lines. (<bold>e</bold>) The density of transcription factor binding sites (TFBS) as their number per kb around the positions of two types of eQTLs shown in <bold>b</bold> (primary and secondary, gene-level quantification). (<bold>f</bold>) The enrichments of the four types of eQTLs shown in <bold>b</bold> (primary versus secondary, gene quantification versus phenotype grouping) within three types of functional annotations (Methods section). The odd ratios and the −log10 of the enrichment <italic>P</italic> values are shown on the <italic>x</italic> axis and <italic>y</italic> axis, respectively. The percentages of eQTLs falling within these annotations are shown next to the corresponding points.</p>
    </caption>
    <graphic xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="ncomms15452-f2"/>
  </fig>
</floats-group>
