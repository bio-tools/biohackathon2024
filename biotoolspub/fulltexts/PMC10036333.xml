<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Commun</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Commun</journal-id>
    <journal-title-group>
      <journal-title>Nature Communications</journal-title>
    </journal-title-group>
    <issn pub-type="epub">2041-1723</issn>
    <publisher>
      <publisher-name>Nature Publishing Group UK</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10036333</article-id>
    <article-id pub-id-type="publisher-id">37123</article-id>
    <article-id pub-id-type="doi">10.1038/s41467-023-37123-6</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>IMC-Denoise: a content aware denoising pipeline to enhance Imaging Mass Cytometry</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3259-474X</contrib-id>
        <name>
          <surname>Lu</surname>
          <given-names>Peng</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-2846-8831</contrib-id>
        <name>
          <surname>Oetjen</surname>
          <given-names>Karolyn A.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8311-4390</contrib-id>
        <name>
          <surname>Bender</surname>
          <given-names>Diane E.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Ruzinova</surname>
          <given-names>Marianna B.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fisher</surname>
          <given-names>Daniel A. C.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Shim</surname>
          <given-names>Kevin G.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pachynski</surname>
          <given-names>Russell K.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9807-7433</contrib-id>
        <name>
          <surname>Brennen</surname>
          <given-names>W. Nathaniel</given-names>
        </name>
        <xref ref-type="aff" rid="Aff7">7</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8564-5400</contrib-id>
        <name>
          <surname>Oh</surname>
          <given-names>Stephen T.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3170-7581</contrib-id>
        <name>
          <surname>Link</surname>
          <given-names>Daniel C.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2437-1239</contrib-id>
        <name>
          <surname>Thorek</surname>
          <given-names>Daniel L. J.</given-names>
        </name>
        <address>
          <email>thorekd@wustl.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff9">9</xref>
        <xref ref-type="aff" rid="Aff10">10</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>Department of Biomedical Engineering, </institution><institution>Washington University in St. Louis, </institution></institution-wrap>St. Louis, USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>Department of Radiology, Mallinckrodt Institute of Radiology, </institution><institution>Washington University School of Medicine, </institution></institution-wrap>St. Louis, USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>Program in Quantitative Molecular Therapeutics, </institution><institution>Washington University School of Medicine, </institution></institution-wrap>St. Louis, USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>Department of Medicine, </institution><institution>Washington University School of Medicine, </institution></institution-wrap>St. Louis, USA </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>The Bursky Center for Human Immunology and Immunotherapy Programs Immunomonitoring Laboratory, </institution><institution>Washington University School of Medicine, </institution></institution-wrap>St. Louis, USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>Department of Pathology &amp; Immunology, </institution><institution>Washington University School of Medicine, </institution></institution-wrap>St. Louis, USA </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="GRID">grid.21107.35</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9311</institution-id><institution>Department of Oncology, Sidney Kimmel Comprehensive Cancer Center (SKCCC), </institution><institution>Johns Hopkins University, </institution></institution-wrap>Baltimore, USA </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="GRID">grid.21107.35</institution-id><institution-id institution-id-type="ISNI">0000 0001 2171 9311</institution-id><institution>Department of Urology, James Buchanan Brady Urological Institute, </institution><institution>Johns Hopkins University School of Medicine, </institution></institution-wrap>Baltimore, USA </aff>
      <aff id="Aff9"><label>9</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>Department of Radiation Oncology, </institution><institution>Washington University School of Medicine, </institution></institution-wrap>St. Louis, USA </aff>
      <aff id="Aff10"><label>10</label><institution-wrap><institution-id institution-id-type="GRID">grid.4367.6</institution-id><institution-id institution-id-type="ISNI">0000 0001 2355 7002</institution-id><institution>Oncologic Imaging Program, Siteman Cancer Center, </institution><institution>Washington University School of Medicine, </institution></institution-wrap>St. Louis, USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>23</day>
      <month>3</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>23</day>
      <month>3</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2023</year>
    </pub-date>
    <volume>14</volume>
    <elocation-id>1601</elocation-id>
    <history>
      <date date-type="received">
        <day>15</day>
        <month>9</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>2</day>
        <month>3</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Imaging Mass Cytometry (IMC) is an emerging multiplexed imaging technology for analyzing complex microenvironments using more than 40 molecularly-specific channels. However, this modality has unique data processing requirements, particularly for patient tissue specimens where signal-to-noise ratios for markers can be low, despite optimization, and pixel intensity artifacts can deteriorate image quality and downstream analysis. Here we demonstrate an automated content-aware pipeline, IMC-Denoise, to restore IMC images deploying a differential intensity map-based restoration (DIMR) algorithm for removing hot pixels and a self-supervised deep learning algorithm for shot noise image filtering (DeepSNiF). IMC-Denoise outperforms existing methods for adaptive hot pixel and background noise removal, with significant image quality improvement in modeled data and datasets from multiple pathologies. This includes in technically challenging human bone marrow; we achieve noise level reduction of 87% for a 5.6-fold higher contrast-to-noise ratio, and more accurate background noise removal with approximately 2 × improved F1 score. Our approach enhances manual gating and automated phenotyping with cell-scale downstream analyses. Verified by manual annotations, spatial and density analysis for targeted cell groups reveal subtle but significant differences of cell populations in diseased bone marrow. We anticipate that IMC-Denoise will provide similar benefits across mass cytometric applications to more deeply characterize complex tissue microenvironments.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">Multiplexed imaging technologies can reveal the complex cellular and molecular profiles of tissue. Here, the authors develop and implement a denoising pipeline to significantly enhance imaging mass cytometry quality and improve single-cell analyses.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Histology</kwd>
      <kwd>Imaging the immune system</kwd>
      <kwd>Diagnostic markers</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000054</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R01CA240711</award-id>
        <award-id>P30CA091842</award-id>
        <award-id>K12CA167540</award-id>
        <principal-award-recipient>
          <name>
            <surname>Thorek</surname>
            <given-names>Daniel L. J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100000050</institution-id>
            <institution>U.S. Department of Health &amp; Human Services | NIH | National Heart, Lung, and Blood Institute (NHLBI)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>R21HL150636</award-id>
        <principal-award-recipient>
          <name>
            <surname>Thorek</surname>
            <given-names>Daniel L. J.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution>U.S. Department of Health &amp; Human Services | NIH | National Cancer Institute (NCI)</institution>
        </funding-source>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2023</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1" sec-type="introduction">
    <title>Introduction</title>
    <p id="Par3">Disease states are the result of a complex interplay of many different cell types interacting in close proximity in the context of often heterogeneous tissues. Traditional approaches to study these features at the tissue scale have been limited in the number of specific markers that can be acquired to robustly resolve distinct cell types. Flow cytometry, perhaps the most widely used technique to study cell populations and states in this milieu, requires single-cell disaggregation of the tissue resulting in complete loss of spatial context<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR2">2</xref></sup>. Highly multiplexed imaging provides a means to assess these events at cellular resolution in situ, with extensive protocol development in progress<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, including tissue-based cyclic immunofluorescence (<italic>t</italic>-CyCIF)<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, co-detection by indexing (CODEX)<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>, Multiplexed Ion Beam Imaging (MIBI)<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref></sup>, and Imaging Mass Cytometry (IMC)<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>. In IMC, tissue sections are stained with a panel of metal-conjugated antibodies, and data is acquired by UV-laser raster ablation of the section in 1-micron pixels for cytometry by time-of-flight (CyTOF) mass analyzer. This novel imaging technology allows for the detection of more than 40 antigens simultaneously to facilitate single-cell, spatially resolved, highly multiplexed analysis of solid tissues. This provides essential information on the distribution of transcripts, proteins, and protein modifications within single cells, microenvironments, and entire tissues<sup><xref ref-type="bibr" rid="CR8">8</xref>–<xref ref-type="bibr" rid="CR17">17</xref></sup>. The pixel data is processed into an image, thereby allowing the visualization of phenotypes and incorporation of spatial information in subsequent analyses. These properties make it a unique tool for the evaluation of complex biological systems.</p>
    <p id="Par4">Despite the wide applications in pre- and clinical research using this state-of-the-art multiplexed imaging technique, there exist specific technical noise sources in IMC, which include hot pixels, channel spillover and shot noise<sup><xref ref-type="bibr" rid="CR8">8</xref>–<xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR18">18</xref>,<xref ref-type="bibr" rid="CR19">19</xref></sup>. Hot pixels are concentrated areas of high counts which are uncorrelated with any biological structures. Putatively, these can result from deposition of metal-stained antibody aggregates. In IMC images, single hot pixels are the most common outliers, and small hot clusters with several consecutive pixels may also exist. Channel spillover refers to scenarios where the signal of a source channel contaminates a target channel or is correlated with such contamination. The spillover in IMC can occur from a variety of reasons, such as instrument properties (abundance sensitivity), isotopic impurities and oxidation. Finally, shot noise exists because of ion counting imaging processes, which are pixel-independent, signal-dependent and usually modeled as a Poisson process. Additionally, noise levels are related to multiple other factors, including variations in conjugated metal isotopes, antibody concentration and arrangement.</p>
    <p id="Par5">Together these noise sources appreciably deteriorate image quality and distort downstream analyses of IMC data. Differing from traditional fluorescence-based imaging modalities, there are low background features and no read-out noises from imaging sensors in IMC. A number of studies have attempted to address the unique imaging data features of IMC. Hot pixels can be corrected by thresholding methods<sup><xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR20">20</xref></sup>; however, due to the differences between marker channels and tissues, a threshold needs to be pre-set carefully. An inappropriate threshold may lead to unsatisfactory results. Post-acquisition methods<sup><xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR19">19</xref></sup> and a bead-based compensation workflow<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> have been proposed to correct the channel spillover phenomenon. However, spillover correction may not be necessary if the marker panel employed is well-designed and titrated; and the intensity of channel-overlapping signal is often weak<sup><xref ref-type="bibr" rid="CR18">18</xref></sup>. Therefore, spillover can be neglected when using low concentrations of staining antibodies, which however further lowers signal-to-noise ratio (SNR). To account for the impact of shot noise, MAUI<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR19">19</xref></sup> and a semi-automated Ilastik-based method<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> have been used for background noise removal. These approaches require finely tuned parameters or manually annotated background regions, requiring preprocessing expertize. In tissues with low marker signals, highly intermixed cell populations, or difficult immunostaining defining thresholds can be time consuming with high inter-user subjectivity, which may still result in poor image quality that complicates further analyses.</p>
    <p id="Par6">In the present work we develop and apply IMC-Denoise, a content aware denoising pipeline to enhance IMC images through an automated process. To account for the two major noise sources in this modality, hot pixels and shot noise, IMC-Denoise invokes novel algorithms for differential intensity map-based restoration (DIMR) and self-supervised deep learning-based shot noise image filtering (DeepSNiF). We demonstrate the flexibility and effectiveness of the proposed pipeline on publicly available IMC datasets of pancreatic cancer<sup><xref ref-type="bibr" rid="CR10">10</xref></sup>, breast cancer<sup><xref ref-type="bibr" rid="CR12">12</xref></sup>, a MIBI dataset<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, and deploy it on a technically challenging unique human bone marrow dataset. We benchmark our approach against existing hot pixel removal methods<sup><xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR20">20</xref></sup> and other advanced biomedical imaging denoising algorithms, such as non-local means filtering (NLM)<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, batch matching and 3D filtering (BM3D)<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> and Noise2Void (N2V)<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>, which is used in IMC here for the first time. We demonstrate that the image formation model derived IMC-Denoise pipeline produces image quality enhancements that are best-in-class and leads to improved downstream analysis, with limited manual user manipulation. Qualitative improvements in images enhances their interpretation, and quantitatively improve molecularly-defined phenotyping. Results from the IMC-Denoise pipeline are suitable for further downstream analysis, such as Mesmer/DeepCell and ark-analysis<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> or MCMicro<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>. The IMC-Denoise software package and the corresponding tutorial have been published on Github (<ext-link ext-link-type="uri" xlink:href="https://github.com/PENGLU-WashU/IMC_Denoise">https://github.com/PENGLU-WashU/IMC_Denoise</ext-link>). We provide this tool to augment studies that seek to more deeply characterize the complex and diverse tissue microenvironment.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>IMC-Denoise principle</title>
      <p id="Par7">The general principle of IMC-Denoise is schematized in Fig. <xref rid="Fig1" ref-type="fig">1</xref>a and Supplementary Notes <xref rid="MOESM1" ref-type="media">1</xref>. To account for hot pixels and shot noise, an accurate IMC imaging joint model is built as Eq. (<xref rid="Equ1" ref-type="disp-formula">1</xref>), by considering ion counting imaging as a Poisson process (Supplementary Notes <xref rid="MOESM1" ref-type="media">1.1)</xref>.<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\bf{R}}}}}}}}={{{{{{{\mathcal{P}}}}}}}}[{{{{{{{\bf{X}}}}}}}}+{{{{{{{{\bf{X}}}}}}}}}^{{{{{{{{\rm{spillover}}}}}}}}}]+{{{{{{{\bf{Q}}}}}}}},$$\end{document}</tex-math><mml:math id="M2"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>=</mml:mo><mml:mi class="MJX-tex-caligraphic" mathvariant="script">P</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi mathvariant="bold">X</mml:mi><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">spillover</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi mathvariant="bold">Q</mml:mi><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2023_37123_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>where <bold>R</bold> is the raw image, <bold>X</bold> the “clean” signal, <bold>X</bold><sup>spillover</sup> the spillover signals without noise, <inline-formula id="IEq1"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{P}}}}}}}}$$\end{document}</tex-math><mml:math id="M4"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">P</mml:mi></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq1.gif"/></alternatives></inline-formula>[<italic>x</italic>] the Poisson noise with mean <italic>x</italic>, and <bold>Q</bold> the hot pixels. The term <bold>X</bold><sup>spillover</sup> in Eq. (<xref rid="Equ1" ref-type="disp-formula">1</xref>) can be omitted if the spillover is limited, which is often the case. However, the magnitude of image degradation from hot pixel and shot noise sources is considerable, resulting in bias and errors in downstream analysis and addressed in turn, below (Supplementary Notes <xref rid="MOESM1" ref-type="media">1.2)</xref>.<fig id="Fig1"><label>Fig. 1</label><caption><title>General principle and validation of IMC-Denoise on the human bone marrow IMC dataset.</title><p><bold>a</bold> Schematic of IMC-Denoise: (i) the DIMR algorithm: after the Anscombe transformation, the difference maps calculated from the raw image are operated to form a histogram. The outliers are detected based on this histogram and removed by a 3 × 3 median filter, iteratively. (ii) The training phase of the self-supervised DeepSNiF algorithm: In the hot pixel corrected images, several pixels are randomly selected and masked. The hot pixel corrected images before and after the masking are set as the outputs and inputs of a deep neural network, respectively. Statistics-derived I-divergence on the masked pixels combined with the Hessian norm regularization on all the pixels is set as the loss function to guarantee the optimal denoising performance. (iii) The prediction phase of the DeepSNiF algorithm: the hot pixel corrected IMC images are fed into the trained network to account for the shot noise. <bold>b</bold> The fractions of detected hot pixels by DIMR in selected channels. <bold>c</bold> DIMR removes hot pixels in DNA intercalator channel effectively. Left: Comparison of the raw and DIMR-processed images; and the difference between the images, in which Residual corresponds to the detected hot pixels. Upper right: the corresponding histograms of the raw and DIMR-processed images. Lower right: comparisons between the raw, NTHM, MTHM and DIMR processed images. <bold>d</bold> Visual inspection of DeepSNiF and other statistics-based denoising algorithms on a Collagen III-labeled IMC image. <bold>e</bold> DeepSNiF performs significantly better than other algorithms (<italic>n</italic> = 12 independent images) on denoising Collagen III-labeled IMC images in terms of STDB and CNR. <bold>f</bold> Visual inspection of DeepSNiF denoised IMC images labeled with other markers. <bold>g</bold> DeepSNiF improves the Pearson correlations between Collagen III-labeled IMC images with low and high SNR significantly (<italic>n</italic> = 10 independent images). In <bold>e</bold> and <bold>g</bold>, box center indicates median, box edges 25th and 75th percentile, and whiskers minimum and maximum percentile; <italic>P</italic> values were calculated through two-sided Wilcoxon matched-paired test (*<italic>P</italic> &lt; 0.05, **<italic>P</italic> &lt; 0.01, ***<italic>P</italic> &lt; 0.001 and ns: no significance). Scale bar: <bold>a</bold> Upper: 100 μm, lower: 125 μm. <bold>c</bold> Whole region: 75 μm, sub-region 1–3: 8 μm. <bold>d</bold> 50 μm. <bold>f</bold> 45 μm. <bold>g</bold> 100 μm.</p></caption><graphic xlink:href="41467_2023_37123_Fig1_HTML" id="d32e767"/></fig></p>
      <p id="Par8">In IMC-Denoise, the DIMR algorithm (Fig. <xref rid="Fig1" ref-type="fig">1</xref>ai and Supplementary Notes <xref rid="MOESM1" ref-type="media">1.3)</xref> builds differential maps to detect the hot pixels by comparing adjacent pixels in a 3 × 3 sliding window, as hot pixels are local maxima. The Anscombe transformation<sup><xref ref-type="bibr" rid="CR27">27</xref></sup> is applied to the raw image <bold>R</bold> followed by background removal of intensities lower than 4 (for IMC), so that the difference between adjacent pixels, <bold>D</bold><sub><italic>i</italic></sub>, can be feasibly approximated as a generalized Gaussian distribution<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>, where <italic>i</italic> is the neighbor index in the sliding window (<italic>i</italic> ∈ {1, 2, ..., 8}). Additionally, as with all biomedical imaging acquisition, in IMC datasets the tissue or background pixels should be continuous. Under these conditions, for a specific pixel <italic>p</italic> there must exist several <italic>d</italic><inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${}_{i}^{p}$$\end{document}</tex-math><mml:math id="M6"><mml:msubsup><mml:mrow/><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq2.gif"/></alternatives></inline-formula> close to the mean <italic>μ</italic><sub><italic>i</italic></sub> of its corresponding distribution <bold>D</bold><sub><italic>i</italic></sub>, except in the presence of a hot pixel. To unmix outliers from normal pixels, we consequently calculate the distances between <italic>d</italic><inline-formula id="IEq3"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${}_{i}^{p}$$\end{document}</tex-math><mml:math id="M8"><mml:msubsup><mml:mrow/><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq3.gif"/></alternatives></inline-formula> and <italic>μ</italic><sub><italic>i</italic></sub> as <inline-formula id="IEq4"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bigtriangleup }_{i}^{p}=|{d}_{i}^{p}-{\mu }_{i}|$$\end{document}</tex-math><mml:math id="M10"><mml:msubsup><mml:mrow><mml:mi>△</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mo>∣</mml:mo><mml:msubsup><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq4.gif"/></alternatives></inline-formula> and sort <inline-formula id="IEq5"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bigtriangleup }_{i}^{p}$$\end{document}</tex-math><mml:math id="M12"><mml:msubsup><mml:mrow><mml:mi>△</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq5.gif"/></alternatives></inline-formula> for <italic>i</italic> ∈ {1, 2, ..., 8}. Then, the <italic>d</italic><inline-formula id="IEq6"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${}_{i}^{p}$$\end{document}</tex-math><mml:math id="M14"><mml:msubsup><mml:mrow/><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq6.gif"/></alternatives></inline-formula> corresponding to the first <italic>l</italic> smallest <inline-formula id="IEq7"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\bigtriangleup }_{i}^{p}$$\end{document}</tex-math><mml:math id="M16"><mml:msubsup><mml:mrow><mml:mi>△</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq7.gif"/></alternatives></inline-formula> are summed, and the results from all pixels form a new distribution, <bold>T</bold><sub><italic>l</italic></sub>. Compared to those in the distributions <bold>D</bold><sub><italic>i</italic></sub>, the hot pixels move beyond the right tail of <bold>T</bold><sub><italic>l</italic></sub>, while the normal relevant pixels move towards its center (Supplementary Note <xref rid="MOESM1" ref-type="media">1.3.1)</xref>. To robustly detect the outliers, the kernel density estimation algorithm<sup><xref ref-type="bibr" rid="CR29">29</xref></sup> is applied to <bold>T</bold><sub><italic>l</italic></sub> afterwards (Supplementary Note <xref rid="MOESM1" ref-type="media">1.3.2)</xref>. On the fitted curve (<italic>x</italic>, <inline-formula id="IEq8"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\hat{g}}_{h}$$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq8.gif"/></alternatives></inline-formula>(<italic>x</italic>)), a threshold point <italic>x</italic><sub><italic>T</italic></sub> is defined so that any points <italic>x</italic>&gt;<italic>x</italic><sub><italic>T</italic></sub> are considered as outliers and filtered by a 3 × 3 median filter. Because outliers are located beyond the right tail of <bold>T</bold><sub><italic>l</italic></sub>, it is reasonable to set <italic>x</italic><sub><italic>T</italic></sub> when <inline-formula id="IEq9"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{d{\hat{g}}_{h}(x)}{dx}\to$$\end{document}</tex-math><mml:math id="M20"><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo>→</mml:mo></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq9.gif"/></alternatives></inline-formula>0, which means the current distribution ends. Likewise, the shape of the distribution should not change from convex to concave on the right tail. Thus, it is also reasonable to set <italic>x</italic><sub><italic>T</italic></sub> when <inline-formula id="IEq10"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{{d}^{{{{{{{{\rm{2}}}}}}}}}{\hat{g}}_{h}(x-\bigtriangleup x)}{{dx}^{{{{{{{{\rm{2}}}}}}}}}}\ge 0$$\end{document}</tex-math><mml:math id="M22"><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">2</mml:mi></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mi>△</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">2</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>≥</mml:mo><mml:mn>0</mml:mn></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq10.gif"/></alternatives></inline-formula> and <inline-formula id="IEq11"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\frac{{d}^{{{{{{{{\rm{2}}}}}}}}}{\hat{g}}_{h}(x)}{{dx}^{{{{{{{{\rm{2}}}}}}}}}}\le$$\end{document}</tex-math><mml:math id="M24"><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">2</mml:mi></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mo>^</mml:mo></mml:mrow></mml:mover></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">2</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>≤</mml:mo></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq11.gif"/></alternatives></inline-formula>0, where △<italic>x</italic> represents a small value. Because the pixel values of the raw images are discrete, △<italic>x</italic> is normally set as 1. We operate DIMR for multiple iterations to adequately remove hot pixels until no outliers are detected. The hot pixel removed images are transformed to their original scales with the direct algebraic inverse Anscombe transformation<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. The DIMR algoirthm is summarized as Supplementary Algorithm <xref rid="MOESM1" ref-type="media">1</xref>. In the implementation, we use the median <inline-formula id="IEq12"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\widetilde{\mu }}_{i}$$\end{document}</tex-math><mml:math id="M26"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq12.gif"/></alternatives></inline-formula> of distribution <bold>D</bold><sub><italic>i</italic></sub> as a robust estimation of the mean <italic>μ</italic><sub><italic>i</italic></sub>. In addition, it is normally assumed that at least half of the neighbors are close to the center pixel in a 3 × 3 window so that <italic>l</italic> = 4<sup><xref ref-type="bibr" rid="CR31">31</xref>,<xref ref-type="bibr" rid="CR32">32</xref></sup>. Validated by simulation (Supplementary Note <xref rid="MOESM1" ref-type="media">3.3.1)</xref>, the iteration number is set as 3 to adequately remove hot pixels; for a 500 × 500 image, it takes ~0.05–0.4 s to run DIMR, depending on the hot pixel densities.</p>
      <p id="Par9">After hot pixel removal, the imaging model is simplified as: <inline-formula id="IEq13"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\bf{R}}}}}}}}={{{{{{{\mathcal{P}}}}}}}}[{{{{{{{\bf{X}}}}}}}}]$$\end{document}</tex-math><mml:math id="M28"><mml:mi mathvariant="bold">R</mml:mi><mml:mo>=</mml:mo><mml:mi class="MJX-tex-caligraphic" mathvariant="script">P</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq13.gif"/></alternatives></inline-formula>, for which we have developed DeepSNiF (Fig. <xref rid="Fig1" ref-type="fig">1</xref>aii, iii and Supplementary Note <xref rid="MOESM1" ref-type="media">1.4)</xref> to account for the ion noise in IMC images. By combining Poisson statistics and detection theory, I-divergence<sup><xref ref-type="bibr" rid="CR33">33</xref></sup> is derived as the loss function to enable the maximized likelihood estimation for the denoising task. Unlike traditional imaging methods for which noise-free training label images can be generated, commonly with long exposures, the image formation process in IMC requires laser ablation. Thus, a tissue can only be imaged once in IMC. Autofluorescence artifacts in immunofluorescence (IF) images, and the tedious and potentially interfering processes for consecutive IF and IMC imaging, are further confounds. Therefore, conventional supervised denoising approaches<sup><xref ref-type="bibr" rid="CR34">34</xref>–<xref ref-type="bibr" rid="CR36">36</xref></sup> or Noise2Noise<sup><xref ref-type="bibr" rid="CR37">37</xref></sup> are not available here.</p>
      <p id="Par10">We overcome these limitations by applying a self-supervised approach inspired by Noise2Void<sup><xref ref-type="bibr" rid="CR24">24</xref></sup> and Noise2Self<sup><xref ref-type="bibr" rid="CR38">38</xref></sup>. This approach randomly masks several pixels in the DIMR-processed hot pixel-removed images by a stratified sampling strategy. Subsequently, the manipulated images are set as the inputs of the network and the hot pixel removed ones are the outputs. For this construct, the self-supervised training is approximately equivalent to a supervised learning process (Supplementary Note <xref rid="MOESM1" ref-type="media">1.4.1)</xref>. The network follows U-Net<sup><xref ref-type="bibr" rid="CR39">39</xref></sup> structure with Res-Blocks<sup><xref ref-type="bibr" rid="CR40">40</xref></sup> to enable high quality training and prediction (Methods, Supplementary Fig. <xref rid="MOESM1" ref-type="media">13)</xref>. Notably, the last activation function of the network is set as softplus (<inline-formula id="IEq14"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\log (1+\exp (x))$$\end{document}</tex-math><mml:math id="M30"><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq14.gif"/></alternatives></inline-formula>) to restrict non-negativity for the images. Nevertheless, the denoising performance is still sub-optimal, due to neglected information of the masked pixels and partially utilized pixels in the self-supervised strategy. To further boost DeepSNiF, the Hessian norm regularization<sup><xref ref-type="bibr" rid="CR41">41</xref>–<xref ref-type="bibr" rid="CR43">43</xref></sup> is applied in the loss function with the continuity between biological structures a priori (Supplementary Note <xref rid="MOESM1" ref-type="media">1.4.2)</xref>. Overall, the loss function of DeepSNiF is summarized as Eq. (<xref rid="Equ2" ref-type="disp-formula">2</xref>).<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\mathcal{L}}}}}}}}\left({{{{{{{\bf{R}}}}}}}},\,{{{{{{{{\mathcal{F}}}}}}}}}_{\!\theta }\left[\;f({{{{{{{\bf{R}}}}}}}})\right]\right)=	 \mathop{\sum}\limits_{p}{{{{{{{{\bf{M}}}}}}}}}_{p}\cdot \left[{r}_{p}\log \frac{{r}_{p}}{{{{{{{{{\mathcal{F}}}}}}}}}_{\!\theta }{[\;f({{{{{{{\bf{R}}}}}}}})]}_{p}}-{r}_{p}+{{{{{{{{\mathcal{F}}}}}}}}}_{\!\theta }{\left[\;f({{{{{{{\bf{R}}}}}}}})\right]}_{p}\right]/\mathop{\sum}\limits_{p}{{{{{{{{\bf{M}}}}}}}}}_{p}\\ 	+{\lambda }_{{{{{{{{\rm{Hessian}}}}}}}}}\mathop{\sum}\limits_{p}||{{{{{{{{\mathcal{R}}}}}}}}}_{{{{{{{{\rm{Hessian}}}}}}}}}({{{{{{{{\mathcal{F}}}}}}}}}_{\!\theta }[\;f({{{{{{{\bf{R}}}}}}}})])|{|}_{p}/\mathop{\sum}\limits_{p},$$\end{document}</tex-math><mml:math id="M32"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">L</mml:mi><mml:mfenced close=")" open="("><mml:mrow><mml:mi mathvariant="bold">R</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">F</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.3em"/><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mfenced close="]" open="["><mml:mrow><mml:mspace width="0.16em"/><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mfenced close="]" open="["><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mi>log</mml:mi><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">F</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.3em"/><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mspace width="0.16em"/><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">F</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.3em"/><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mfenced close="]" open="["><mml:mrow><mml:mspace width="0.16em"/><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>/</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mrow><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>λ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Hessian</mml:mi></mml:mrow></mml:msub><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:mo>∣</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Hessian</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">F</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.3em"/><mml:mi>θ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mspace width="0.16em"/><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">R</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mo>∣</mml:mo></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:munder><mml:mrow><mml:mo>∑</mml:mo></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2023_37123_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>where <inline-formula id="IEq15"><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\mathcal{F}}}}}}}}}_{\!\theta }$$\end{document}</tex-math><mml:math id="M34"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">F</mml:mi></mml:mrow><mml:mrow><mml:mspace width="0.3em"/><mml:mi>θ</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq15.gif"/></alternatives></inline-formula> represents the learnt weights of the network, <italic>f</italic> demonstrates the random pixel masking approach, <italic>r</italic><sub><italic>p</italic></sub> the <italic>p</italic>-th pixel of the hot pixel removed training set <bold>R</bold>, <bold>M</bold><sub><italic>p</italic></sub> the pixel mask (<bold>M</bold><sub><italic>p</italic></sub> ∈ {0, 1}), <inline-formula id="IEq16"><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{{\mathcal{R}}}}}}}}}_{{{{{{{{\rm{Hessian}}}}}}}}}$$\end{document}</tex-math><mml:math id="M36"><mml:msub><mml:mrow><mml:mi class="MJX-tex-caligraphic" mathvariant="script">R</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">Hessian</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq16.gif"/></alternatives></inline-formula> the Hessian operator, <italic>λ</italic><sub><italic>H</italic><italic>e</italic><italic>s</italic><italic>s</italic><italic>i</italic><italic>a</italic><italic>n</italic></sub> the regularization parameter and <italic>p</italic> the pixel index. Here, the pixel <italic>p</italic> is masked only when <bold>M</bold><sub><italic>p</italic></sub> = 1. Note that the first term works only on the selected masked pixels, while the second regularization term utilizes all of the image information. Prior to training and prediction, the images are normalized between 0 and 1 by a percentile-normalization approach (Supplementary Note <xref rid="MOESM1" ref-type="media">1.4.3)</xref>. The DeepSNiF algorithm is summarized as Supplementary Algorithm <xref rid="MOESM1" ref-type="media">2</xref>. As validated by simulation (Supplementary Note <xref rid="MOESM1" ref-type="media">3.4.2)</xref>, <italic>λ</italic><sub>Hessian</sub> is empirically set as 3e-6 to balance the trade-off between data fidelity and regularization.</p>
    </sec>
    <sec id="Sec4">
      <title>Validation of IMC image quality improvement</title>
      <p id="Par11">We initially tested our DIMR algorithm on selected markers of a human bone marrow dataset. Here, inherently high autofluorescence and tissue features (fragile haematopoietic stroma intermixed with dense cortical bone) excluded other spatial biology methods, even after substantial pre-processing. Figure <xref rid="Fig1" ref-type="fig">1</xref>b enumerates the proportion of hot pixels detected by DIMR for each marker. We then selected DNA intercalator and CD235a (Fig. <xref rid="Fig1" ref-type="fig">1</xref>c and Supplementary Fig. <xref rid="MOESM1" ref-type="media">14)</xref> to evaluate DIMR due to their high hot pixel density. By comparing the images and the corresponding histograms, hot pixels are effectively eliminated by DIMR.</p>
      <p id="Par12">We further compared DIMR with two recent hot pixel removal methods, neighbor-based threshold hot pixel removal method (NTHM)<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR20">20</xref></sup> and median-based threshold hot pixel removal method (MTHM)<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> with default parameters, to benchmark its performance (Table <xref rid="Tab1" ref-type="table">1</xref>, Supplementary Note <xref rid="MOESM1" ref-type="media">2.1</xref>, Supplementary Algorithms <xref rid="MOESM1" ref-type="media">3</xref> and <xref rid="MOESM1" ref-type="media">4)</xref>. From the results, all three methods can remove spurious signal, but their performances varied from each other. To quantitatively evaluate these methods, we utilized <italic>t</italic>-CyCIF data<sup><xref ref-type="bibr" rid="CR44">44</xref></sup> to generate simulated IMC images (Supplementary Note <xref rid="MOESM1" ref-type="media">3.1)</xref> with a range of noise levels and hot pixel densities. The three methods were then applied on the simulated datasets, and root mean squared errors between the hot pixel-free and processed images were set as the metric to evaluate the accuracy of hot pixel removal (Supplementary Note <xref rid="MOESM1" ref-type="media">3.2)</xref>. Note that in simulations, the thresholds of NTHM and MTHM were manually tuned to guarantee their optimal performances, while DIMR was configured automatically.<table-wrap id="Tab1"><label>Table 1</label><caption><p>Reference denoising algorithm summary</p></caption><table frame="hsides" rules="groups"><thead><tr><th>Acronym</th><th>Full name</th><th>Algorithm details</th></tr></thead><tbody><tr><td>NTHM</td><td>Neighbour-based threshold hot pixel removal method<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR20">20</xref></sup></td><td>Supplementary Note <xref rid="MOESM1" ref-type="media">2.1</xref></td></tr><tr><td/><td/><td>Supplementary Algorithm <xref rid="MOESM1" ref-type="media">3</xref></td></tr><tr><td>MTHM</td><td>Median-based threshold hot pixel removal method<sup><xref ref-type="bibr" rid="CR10">10</xref></sup></td><td>Supplementary Note <xref rid="MOESM1" ref-type="media">2.1</xref></td></tr><tr><td/><td/><td>Supplementary Algorithm <xref rid="MOESM1" ref-type="media">4</xref></td></tr><tr><td>N2V</td><td>Noise2Void<sup><xref ref-type="bibr" rid="CR24">24</xref></sup></td><td>Supplementary Note <xref rid="MOESM1" ref-type="media">2.2.1</xref></td></tr><tr><td>MN2V</td><td>Modified Noise2Void with Anscombe transformation<sup><xref ref-type="bibr" rid="CR27">27</xref></sup></td><td>Supplementary Note <xref rid="MOESM1" ref-type="media">2.2.2</xref></td></tr><tr><td>N2T</td><td>Noise2True<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, only simulations used</td><td>Supplementary Note <xref rid="MOESM1" ref-type="media">2.2.3</xref></td></tr><tr><td>GAUSS</td><td>Gaussian filter with kernel size of 5x5 and standard deviation of 0.8</td><td>Supplementary Note <xref rid="MOESM1" ref-type="media">2.3.1</xref></td></tr><tr><td>NLM</td><td>Non-local means algorithm<sup><xref ref-type="bibr" rid="CR22">22</xref></sup></td><td>Supplementary Note <xref rid="MOESM1" ref-type="media">2.3.2</xref></td></tr><tr><td>BM3D</td><td>Batch-matching and 3D filtering algorithm<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> with Anscombe transformation</td><td>Supplementary Note <xref rid="MOESM1" ref-type="media">2.3.3</xref></td></tr></tbody></table></table-wrap></p>
      <p id="Par13">The simulation results indicate DIMR is the best performer among the three methods (Supplementary Note <xref rid="MOESM1" ref-type="media">3.3.2)</xref>. In fact, the threshold of NTHM requires contextual adjustment as different tissues and channels may have different scales. Moreover, this method is not efficient at removing consecutive hot pixels. MTHM is not locally adaptive and may overlook hot pixels with similar intensity to that of normal pixels; or erroneously remove normal pixels located at the border between tissues and background. Use of a lower search range or threshold for MTHM may also generate false negatives. In comparison, the outlier detection of DIMR is based on overall image statistics. Therefore, no manual threshold adjustment is required for images with different intensity scales, and a higher detection sensitivity is achieved even for hot pixels with lower intensities. These features along with the simulation data results demonstrate the versatility and accuracy of DIMR. The automated DIMR approach also results in the additional benefit of moderately improved cell segmentation, the result of robust removal of artifacts caused by hot pixels (Supplementary Fig. <xref rid="MOESM1" ref-type="media">15)</xref>.</p>
      <p id="Par14">With hot pixels removed from image data, we next benchmarked the denoising performance of DeepSNiF along with DIMR and other statistics-based methods including a Gaussian filter with standard deviation of 1 (GAUSS), NLM, BM3D, N2V, modified N2V (MN2V) and DeepSNiF with no regularization (DeepSNiF-NR) (Table <xref rid="Tab1" ref-type="table">1</xref>, Supplementary Notes <xref rid="MOESM1" ref-type="media">2.2</xref> and <xref rid="MOESM1" ref-type="media">2.3)</xref> on the simulated dataset (Supplementary Note <xref rid="MOESM1" ref-type="media">3.4)</xref>. These comparisons were carried out on IMC images labeled with Collagen III, CD31, CD34 and CD3 from the human bone marrow dataset (Fig. <xref rid="Fig1" ref-type="fig">1</xref>d and Supplementary Fig. <xref rid="MOESM1" ref-type="media">16)</xref>. First we visually assessed images with different processing approaches for their overall appearance and in particular for retention of fine cell-level details. We found all the algorithms enhanced the DIMR data even though variant performances were achieved. GAUSS lowers the noise level by sacrificing resolution. NLM is effective at background denoising but does not account adequately for the noise components of signal. BM3D improves NLM further by its cooperative denoising procedure. However, we found it tended to over-smooth foreground and distorted cell shapes. N2V always generates artifacts because of an inappropriate noise model. DeepSNiF-NR performs better than MN2V because the Anscombe transformation in MN2V may generate some bias for extremely low counts; both of which are better than GAUSS, NLM and BM3D. DeepSNiF further enhances these results by mitigating the discontinuities in the DeepSNiF-NR output, and furthermore retains cell morphology features.</p>
      <p id="Par15">We then quantitatively compared the differently processed images across a range of different characterization methods. Assessment of peak SNR (PSNR) and structural similarity (SSIM)<sup><xref ref-type="bibr" rid="CR45">45</xref></sup> (Supplementary Note <xref rid="MOESM1" ref-type="media">3.2)</xref> were computed from the simulated data, and the standard deviation of background (STDB) and contrast-to-noise ratio (CNR; “Methods” section) were utilized for the IMC images labeled with Collagen III. All results indicated DeepSNiF enables the optimal denoising performance among these algorithms (Fig. <xref rid="Fig1" ref-type="fig">1</xref>e and Supplementary Note <xref rid="MOESM1" ref-type="media">3.4)</xref>. In particular, the noise level (STDB) decreased by 87% and CNR increased by 5.6-fold after DeepSNiF (0.9938 to 0.1254 and 1.1749 to 7.8065, median value).</p>
      <p id="Par16">We further visually inspect the denoising results of IMC-Denoise on multiple datasets including human bone marrow images (Fig. <xref rid="Fig1" ref-type="fig">1</xref>f and Supplementary Fig. <xref rid="MOESM1" ref-type="media">17)</xref>, human breast cancer (Supplementary Fig. <xref rid="MOESM1" ref-type="media">18)</xref>, human pancreatic cancer (Supplementary Fig. <xref rid="MOESM1" ref-type="media">19)</xref> and a MIBI dataset (Supplementary Fig. <xref rid="MOESM1" ref-type="media">20)</xref>. Image quality improvements that enhance image interpretation are apparent, for both visual inspection and quantitative assessment, in particular for low SNR channels. Two orthogonal staining approaches were pursued in order to provide further validation of these image quality improvements. Firstly, the same antibody was conjugated to two different metals and co-stained on the same tissue for detection in high and low sensitivity channels, without spillover. IMC-Denoise was employed on the low signal channel (209Bi) and was able to restore the image quality to match the high sensitivity channel (173Yb) with the Pearson correlation coefficient (PCC) improved as high as 0.16, as shown in representative images (Supplementary Fig. <xref rid="MOESM1" ref-type="media">21</xref> and Fig. <xref rid="Fig1" ref-type="fig">1</xref>g). Similar conclusions can also be drawn from other channels with increased PCC by more than 0.48 and 0.35, respectively (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22)</xref>. Secondly, tissue sections stained with metal-conjugated antibodies (for CD3, CD4, CD61, and CD169) were probed with a fluorophore-conjugated secondary antibody for IF, individually. We then followed IF imaging by ablative-IMC (Supplementary Fig. <xref rid="MOESM1" ref-type="media">23)</xref>. The additional handling and washing after IF imaging often leads to extremely low remaining metal isotope signal; however, enhancement in image quality can still be observed to restore the image to correlate to the IF. Specifically, the PCC quantitatively verified the image quality improvement of DeepSNiF (CD3: 0.5557–0.7939, CD4: 0.4975–0.7793, CD61: 0.9096–0.9492, and CD169: 0.4481–0.7726).</p>
    </sec>
    <sec id="Sec5">
      <title>IMC-Denoise enhances IMC background noise removal and downstream analysis</title>
      <p id="Par17">We next evaluated the ability of DeepSNiF in IMC-Denoise to remove background noise of IMC images. Visual inspection (Supplementary Fig. <xref rid="MOESM1" ref-type="media">24)</xref> reveal DeepSNiF enhances background noise removal of the examples effectively by a single threshold. To fully evaluate the enhancement by DeepSNiF, we manually annotated 15 images labeled with CD34 and 12 IMC images labeled with Collagen III (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a). The single threshold-based method and semi-automated Ilastik-based method<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> were applied on both DIMR and DeepSNiF-processed CD34 and Collagen III images (DIMR_thresh, DeepSNiF_thresh, DIMR_Ilastik and DeepSNiF_Ilastik, respectively), and MAUI was only applied on DIMR images (Methods). The results were compared with the manually annotated ground truths (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b), and F1 score was set as the accuracy metric to quantitatively assess the results (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c). To guarantee the best performance of threshold-based methods and MAUI, a wide range of parameters were tested (Supplementary Figs. <xref rid="MOESM1" ref-type="media">25</xref>–<xref rid="MOESM1" ref-type="media">27)</xref>. Note that in threshold-based methods, optimal thresholds from 1 to 4 were selected for individual DIMR-processed images per marker for fair comparison. Nevertheless, the single threshold 1 was selected for all the images per marker for DeepSNiF-processing, without the need of further tuning.<fig id="Fig2"><label>Fig. 2</label><caption><title>IMC-Denoise enables background noise removal and enhances downstream analysis of the human bone marrow IMC dataset.</title><p><bold>a</bold> Examples of DIMR and DeepSNiF-processed IMC images labeled with CD34 and Collagen III. <bold>b</bold> Visual inspection of background removal results of DIMR and DeepSNiF-processed images, in which DIMR_thresh and DeepSNiF_thresh are binarized with the optimal thresholds (Supplementary Figs. <xref rid="MOESM1" ref-type="media">25</xref> and <xref rid="MOESM1" ref-type="media">26)</xref>, DIMR_Ilastik and DeepSNiF_Ilastik are segmented by the Ilastik software package, and MAUI results are the DIMR images processed by the MAUI software package (Supplementary Fig. <xref rid="MOESM1" ref-type="media">27)</xref>, respectively. Manual annotated images are served as ground truths. <bold>c</bold> After DeepSNiF denoising, the background removal accuracy improves significantly in terms of F1 score, for both CD34 and Collagen III-labeled images (<italic>n</italic> = 15 independent images for CD34 and <italic>n</italic> = 12 independent images for Collagen III). Notably, DeepSNiF_Ilastik achieves the highest accuracy, while DeepSNiF_thresh performs better than all the background removal results from DIMR images. Box center indicates median, box edges 25th and 75th percentile, and whiskers minimum and maximum percentile. <italic>P</italic> values were calculated through two-sided Wilcoxon matched-paired test (**<italic>P</italic> &lt; 0.01, ***<italic>P</italic> &lt; 0.001, and ****<italic>P</italic> &lt; 0.0001). <bold>d</bold> Visual inspection of DeepSNiF and DIMR_Ilastik-based denoising results on different markers-labeled IMC images. <bold>e</bold>–<bold>h</bold> Evaluations of denoising algorithms with manual gating strategies on single-cell data. The numbers in these panels are the cell percentages of the corresponding ranges. DIMR slightly enhances the single-cell analysis over raw data, while DeepSNiF further enhances the DIMR results and overall performs better than semi-automated DIMR_Ilastik-processing. Scale bar: <bold>a</bold> Top: 50 μm, bottom: 35 μm. <bold>d</bold> 107 μm.</p></caption><graphic xlink:href="41467_2023_37123_Fig2_HTML" id="d32e2109"/></fig></p>
      <p id="Par18">Overlaid masks and F1 scores for both markers indicated DeepSNiF_Ilastik achieves the highest accuracy while DIMR_thresh is the weakest performer (CD34: 0.9143 to 0.4155, and Collagen III: 0.9434 to 0.5378, median value). Surprisingly, DeepSNiF_thresh is a better method for background noise removal than the semi-automated DIMR_Ilastik (CD34: 0.9040 to 0.8716, and Collagen III: 0.9345 to 0.9108, median value), and its F1 score was improved by approximately twofold compared to DIMR_thresh. We infer that DeepSNiF is capable of unmixing the signal and background, while the shot noise in DIMR images hinders the performances of the Ilastik-based method. MAUI was able to account for the background noise at the cost of false negative generation (CD34: 0.7824 and Collagen III: 0.7305, median value). Furthermore, we have also visually inspected and manually annotated marker images from Supplementary Figs. <xref rid="MOESM1" ref-type="media">16</xref>–<xref rid="MOESM1" ref-type="media">18</xref>. All the results indicate DeepSNiF achieves good background removal performance (Supplementary Figs. <xref rid="MOESM1" ref-type="media">28</xref>–<xref rid="MOESM1" ref-type="media">30)</xref>.Indeed, the signal has been unmixed from background through DeepSNiF because we have proved a simple thresholding can remove background accurately (Fig. <xref rid="Fig2" ref-type="fig">2</xref>b, c, Supplementary Figs. <xref rid="MOESM1" ref-type="media">28</xref>b, <xref rid="MOESM1" ref-type="media">29</xref>b, and <xref rid="MOESM1" ref-type="media">30</xref>b). These findings support replacement of tedious semi-automated approaches by automated DeepSNiF.</p>
      <p id="Par19">Next, we were curious to evaluate the impact of IMC-Denoise on single-cell profiles. Using segmented cell masks, we extracted the cell intensities of CD38, MPO, CD14, CD71, CD11b, CD4, CD169, CD20, CD8a, CD15, CD3, and CD235a markers for 96232 cells in total (Methods). Please note that segmentation masks were identical for each comparison, using masks generated from DeepSNiF, so that the impact of variability in segmentation algorithms can be neglected. In Supplementary Figs. <xref rid="MOESM1" ref-type="media">31</xref> and <xref rid="MOESM1" ref-type="media">32</xref>a, the comparison of the single-cell profiles of raw, DIMR and DeepSNiF data show that DIMR has the potential to correct false positive data, and DeepSNiF corrects all cell profiles. We have also conducted line fitting for the DIMR and DeepSNiF-processed single-cell data and calculated their PCC (Supplementary Fig. <xref rid="MOESM1" ref-type="media">32</xref>a). The results indicate DeepSNiF has not changed the single-cell intensity scale nor biased the overall linearity of the data. Furthermore, larger mean positive marker expressions lead to lighter corrections by DeepSNiF (Supplementary Fig. <xref rid="MOESM1" ref-type="media">30</xref>b). This follows from the logic that larger ion counts have lower shot noise levels.</p>
      <p id="Par20">Subsequently, we benchmarked the single-cell data from the raw, DIMR, DIMR_Ilastik and DeepSNiF-processed images (Fig. <xref rid="Fig2" ref-type="fig">2</xref>d). To achieve this, manual gating approaches with prior knowledge of cell markers were applied to DIMR, DIMR_Ilastik and DeepSNiF on IMC data (Fig. <xref rid="Fig2" ref-type="fig">2</xref>e–h). For example, among T cells (CD3-positive, CD14-negative), myeloid (CD11b, CD15) and erythroid (CD71, CD235a) markers should be absent. However, this condition may not hold because: segmentation and staining artifacts are unavoidable, and because hot pixels are present in the raw data. With the presence of shot noise, the single-cell data could be further biased (Supplementary Note <xref rid="MOESM1" ref-type="media">1.2.2)</xref>. In Fig. <xref rid="Fig2" ref-type="fig">2</xref>e, f, the false positive myeloid and erythroid markers decrease slightly after DIMR correction (0.8% and 0.4%). DIMR_Ilastik and DeepSNiF further removed false positive myeloid (3.86% and 6.31%) and erythroid markers (3.52% and 5.83%) after the slight improvement of DIMR. Similarly, among B cells (CD20-positive), myeloid and erythroid markers (CD11b, CD15, MPO and CD235a) should be absent as well. In Fig. <xref rid="Fig2" ref-type="fig">2</xref>g and h, the false positive markers decrease slightly after DIMR correction (0.06% and 0.74%). Compared to DIMR, DIMR_Ilastik and DeepSNiF removed more false positive markers (DIMR_Ilastik: 6.41% and 7.86%, DeepSNiF: 5.22% and 8.44%). Overall, as expected DIMR could enhance the single-cell analysis to a limited extent. DeepSNiF and DIMR_Ilastik enable further enhancement, and overall the former achieves better performance than the latter on this task.</p>
      <p id="Par21">To test whether DeepSNiF-based segmented cell masks potentially favor DeepSNiF data, we have extracted the raw, DIMR, DIMR_Ilastik and DeepSNiF-processed single-cell data from DIMR-based cell masks. Both the single-cell data comparisons (Supplementary Fig. <xref rid="MOESM1" ref-type="media">33)</xref> and manual gating results (Supplementary Fig. <xref rid="MOESM1" ref-type="media">34)</xref> are similar to that from DeepSNiF-based cell masks. Therefore, we infer that our IMC-Denoise pipeline is also robust across different cell segmentation masks.</p>
    </sec>
    <sec id="Sec6">
      <title>DeepSNiF in IMC-Denoise enhances automated cell phenotyping</title>
      <p id="Par22">Cell phenotype annotation plays a key role in tissue microenvironment analysis. Indeed, false annotation of cell phenotypes has the potential to lead to false biological or clinical conclusions. Hot pixel removal is normally conducted before automated cell phenotyping<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR17">17</xref></sup>. Therefore, we focused on whether DeepSNiF in IMC-Denoise could impact phenotypic annotation of cell types. Here, the extracted single-cell data with DeepSNiF-based segmentation masks from the human bone marrow dataset were used for phenotypic annotation, including CD38, MPO, CD14, CD71, CD11b, CD4, CD169, CD20, CD8a, CD15, CD3 and CD235a channels. We clustered the DIMR dataset by the Phenograph algorithm<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> with the Leiden community detection algorithm<sup><xref ref-type="bibr" rid="CR47">47</xref></sup> (Methods). The generated clusters were then annotated as immune cell subsets (B cell, CD4+ T cell, CD8+ T cell and plasma cell, monocyte/macrophages), erythroid, myeloid, and other CD4+ cells and others. To better demonstrate the modifications of DeepSNiF denoising, we then utilized a weighted KNN approach to map the DeepSNiF data into the DIMR-based clusters (Methods). The weights were acquired by calculating the Jaccard index between each DeepSNiF-processed cell profile with all of the DIMR cells (which is identical to the Jaccard graph construction of Phenograph). For visualization, the cell markers of DIMR and DeepSNiF were also compressed into two dimensions by the fast interpolation-based <italic>t</italic>-SNE algorithm<sup><xref ref-type="bibr" rid="CR48">48</xref></sup> as Supplementary Fig. <xref rid="MOESM1" ref-type="media">35</xref> (Methods). The assigned phenotypes of DIMR and DeepSNiF datasets are demonstrated in Fig. <xref rid="Fig3" ref-type="fig">3</xref>a and the relative changes of each cell sub-population after DeepSNiF processing is shown in Fig. <xref rid="Fig3" ref-type="fig">3</xref>b. After DeepSNiF processing, B cells, CD8 T cells, plasma cells, CD4 T cells and other CD4+ cells decrease (20.86%, 3.70%, 13.44%, 18.49%, and 8.23%, respectively), the monocytes/macrophages increase (4.82%), while erythroid, myeloid and other cells remain largely unchanged.<fig id="Fig3"><label>Fig. 3</label><caption><title>DeepSNiF enhances automated cell phenotyping on human bone marrow IMC data.</title><p><bold>a</bold><italic>t</italic>-SNE plots of DIMR and DeepSNiF with cell phenotyping results. <bold>b</bold> The relative change in cell phenotypes before and after DeepSNiF. <bold>c</bold>, <bold>d</bold> Comparisons of DIMR and DeepSNiF-processed IMC images labeled with different cell markers, and the corresponding cell annotation results. The sub-panels (i)–(iv) in <bold>c</bold> and the bottom row in <bold>d</bold> correspond to the white dashed box region selection in their first panels, respectively. The white contours represent the differential phenotyping results between DIMR and DeepSNiF. <bold>e</bold> DeepSNiF enhances the sensitivity of cell phenotyping. After DeepSNiF processing, the non-specific marker signals reduce while the specific ones enrich in the cell types, respectively. The circle size indicates the positive marker percentage in a particular phenotype of DIMR, and the circle color indicates the relative changes of the positive rate for the particular markers after DeepSNiF enhancement. <bold>f</bold> DeepSNiF enhances the specificity of cell phenotyping. With DeepSNiF denoising, the ratios of specific phenotypes increase while those of non-specific phenotypes decrease in the positive markers. The relative change is the difference in percentage composition of each cell type before and after DeepSNiF enhancement. Scale bar: <bold>c</bold> 110 μm. <bold>d</bold> Top: 145 μm, bottom: 50 μm.</p></caption><graphic xlink:href="41467_2023_37123_Fig3_HTML" id="d32e2259"/></fig></p>
      <p id="Par23">The phenotyping results of DIMR and DeepSNiF were mapped back into their segmentation masks and images (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c, d and Supplementary Fig. <xref rid="MOESM1" ref-type="media">36)</xref>. To highlight cells where DeepSNiF changes the cell phenotyping results, conflicting annotations between DIMR and DeepSNiF were labeled with white contours, and the changes were quantified for cell phenotype and marker enrichments (Methods). After DeepSNiF denoising, non-specific markers are reduced, while specific markers are enriched within the cell phenotypes (Fig. <xref rid="Fig3" ref-type="fig">3</xref>e). For example, we observed the positive rate increased for CD20 in B cells (10.53%), CD8a in CD8 T cells (2.32%), CD3 and CD4 in CD4 T cells (6.84% and 4.64%), CD38 in plasma cells (6.21%) and CD4 in other CD4+ cells (4.26%). Conversely, we observed a decrease of non-specific markers, such as CD38, MPO and CD14 in B cells (5.24%, 8.11%, and 5.64%), CD3 in erythroid (1.79%) and myeloid (1.62%) cells, and all marker signals in “other” cells. Furthermore, the identified cell types were enriched in a marker-specific manner after DeepSNiF (Fig. <xref rid="Fig3" ref-type="fig">3</xref>f). For instance, we observed a post-DeepSNiF enrichment of monocytes/macrophages in CD14+ cells (2.36%), CD11b+ cells (1.70%) and CD169+ cells (2.21%), and enrichment of B cells in CD20+ cells (5.42%) and CD8 T cells in CD8a+ cells (3.15%). Similarly, myeloid cells were enriched in MPO+ (1.26%), and erythroid cells in CD71+, CD235a+ cells (2.45% and 1.48%). DeepSNiF also yielded an enriched composition of CD8 and CD4 T cells (3.50% and 2.54%), and reduced composition of myeloid and erythroid cells (2.47% and 4.27%) in CD3+ cells. However, we noticed the enrichment of erythroid cells in CD169+ cells (1.03%), which may result from an artifact of the current segmentation approach due to the close relationship and irregular morphology at the boundaries between erythroids and macrophages within the bone marrow<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>.</p>
      <p id="Par24">Cell phenotyping by immunostaining of FFPE tissues is also inherently limited by antibody specificity and antigen retrieval protocols. In this tissue, CD38+ and CD14+ antibody staining is not strictly restricted to single lineages, and these markers can be aberrantly expressed in myeloid neoplasms included in this data set (Supplementary Fig. <xref rid="MOESM1" ref-type="media">37)</xref>. On manual inspection, DeepSNiF improves the ability to identify co-localization of cell surface markers (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c, d and Supplementary Fig. <xref rid="MOESM1" ref-type="media">36)</xref>. Overall, DeepSNiF enhances the sensitivity and specificity of cell phenotyping. We have conducted similar analysis for the single-cell data from the DIMR-based segmentation masks as well (Supplementary Fig. <xref rid="MOESM1" ref-type="media">38)</xref>. Likewise, the results are also similar to those from the DeepSNiF-based segmentation masks, which demonstrates the robustness of IMC-Denoise.</p>
      <p id="Par25">We observed that the enhancements in cell phenotyping and marker enrichments in Fig. <xref rid="Fig3" ref-type="fig">3</xref>e, f are related to the noise level of the IMC images. Specifically, DeepSNiF has the highest impact on CD20 and CD3 related phenotypes, improvement for CD15, MPO and CD235a related phenotypes is limited, with moderate changes for other cell classes. These findings agree with Supplementary Fig. <xref rid="MOESM1" ref-type="media">32</xref>b, where we plot the STD of the normalized positive marker differences between DIMR and DeepSNiF against intensity. To investigate the influence of DeepSNiF on phenotyping results more deeply, we applied a leave-one-out DeepSNiF strategy for CD20, CD3, CD71, CD235a, and MPO (“Methods” section and Supplementary Figs. <xref rid="MOESM1" ref-type="media">39</xref>–<xref rid="MOESM1" ref-type="media">43)</xref>. Briefly, this involved processing one marker for hot pixel removal with DIMR, e.g. CD20, and all the other markers by both DIMR and DeepSNiF. Then the same weighted KNN approach was applied on these leave-one-out DeepSNiF datasets. Similar to the conclusions from Fig. <xref rid="Fig3" ref-type="fig">3</xref>e, f and Supplementary Fig. <xref rid="MOESM1" ref-type="media">32</xref>b, CD20 and CD3 denoised by DeepSNiF improve cell phenotyping because of the high noise level of the corresponding IMC images. DeepSNiF has moderate impact on CD71 due to better IMC image quality than those of CD20 and CD3, and has minor impact on MPO and CD235a because of their good SNRs.</p>
    </sec>
    <sec id="Sec7">
      <title>DeepSNiF in IMC-Denoise enhances lymphocyte analysis</title>
      <p id="Par26">Cell-cell interactions of immune cells within the tumor microenvironment is of broad interest for many clinical pathology specimens. In myeloid malignancies, immune infiltrates are most commonly assessed by flow cytometry and are an active area of interest in therapeutic clinical trials<sup><xref ref-type="bibr" rid="CR50">50</xref></sup>. However, in situ spatial context of cell-cell interaction mediated immune responses cannot be directly measured through this approach. We quantified the enhancement of lymphocyte spatial analysis for B cells, CD8+ T cells and CD4+ T cells by DeepSNiF, and compared these to a manually curated set of image annotations based on DeepSNiF-based cell masks (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a). CD3, CD4, and CD20-stained images are more easily contaminated by shot noise than others (Supplementary Fig. <xref rid="MOESM1" ref-type="media">32</xref>b). Therefore, this approach can further validate the shot noise accounting ability of DeepSNiF as well. The phenotyping accuracy of DIMR and DeepSNiF as evaluated by the Jaccard score and F1 score indicate a significant improvement by DeepSNiF denoising (Fig. <xref rid="Fig4" ref-type="fig">4</xref>b); and DeepSNiF denoised data closely recapitulates gold-standard but laborious manual annotation. Specifically, the overall Jaccard scores improve from 0.6785, 0.8229, and 0.6781 to 0.9201, 0.8922, and 0.8860 for B cells, CD8+ T cells and CD4+ T cells, respectively. Similarly, the F1 scores improve from 0.8085, 0.9029, and 0.8082 to 0.9584, 0.9430, and 0.9396 for these cell types, respectively. We have also compared the annotation results on the DIMR-based cell masks (Supplementary Fig. <xref rid="MOESM1" ref-type="media">44)</xref>. While there are some variations due to the differences from segmentation masks, this comparison demonstrates accuracy improvements as well.<fig id="Fig4"><label>Fig. 4</label><caption><title>DeepSNiF enhances lymphocyte analysis.</title><p><bold>a</bold> Manual annotations for lymphocytes and comparisons with DIMR and DeepSNiF phenotyping results with DeepSNiF-based cell masks. The white contours represent the differential phenotyping results between the annotated and DIMR/DeepSNiF results. <bold>b</bold> Annotation evaluations of DIMR and DeepSNiF by both Jaccard and F1 scores across all the tissues (<italic>n</italic> = 15 biologically independent samples). Box center indicates median, box edges 25th and 75th percentile, and whiskers minimum and maximum percentile. <italic>P</italic> values were calculated through two-sided Wilcoxon matched-paired test (**<italic>P</italic> &lt; 0.01 and ****<italic>P</italic> &lt; 0.0001). <bold>c</bold> Representative images of lymphocyte markers after DeepSNiF denoising from specimens of normal (upper left), myelodysplastic syndromes (MDS, upper right), acute myeloid leukemia (AML, lower left) and AML with lymphoid aggregate (lower right) tissue samples. <bold>d</bold> Nearest distance comparisons between different cell types of normal (<italic>n</italic> = 5 biologically independent samples), MDS (<italic>n</italic> = 5 biologically independent) samples and AML (<italic>n</italic> = 4 biologically independent samples) tissues from manual, DIMR and DeepSNiF phentyping results. Tukey box center indicates median, box edges 25th and 75th percentile, and whiskers the highest and lowest values that are not outliers. Outliers (single points) are defined as values that are more than 1.5 times the interquartile range). <bold>e</bold> Cell densities comparisons of normal (<italic>n</italic> = 5 biologically independent samples), MDS (<italic>n</italic> = 5 biologically independent samples) and AML (<italic>n</italic> = 4 biologically independent samples) tissues from manual, DIMR and DeepSNiF phentyping results. The center bars define the mean, and the error bars are 95% confidence interval. <italic>P</italic> values were calculated through two-sided Kolmogorov-Smirnov test (*<italic>P</italic> &lt; 0.05, **<italic>P</italic> &lt; 0.01, and ****<italic>P</italic> &lt; 0.0001). <bold>f</bold>, <bold>g</bold> Correlation analysis between CD4 T cell and B cell, monocyte/macrophage densities per tissue from manual, DIMR and DeepSNiF phentyping results. The data from the reference group in <bold>f</bold> comes from annotated data; while that from the reference in <bold>g</bold> comes from annotated (CD4 T cells) and DeepSNiF (monocytes/macrophages) results, separately. The solid lines represent the fitting results with the data while the dashed lines represent 95% confidence interval. Scale bar: <bold>a</bold> 85 μm; <bold>c</bold> 112 μm.</p></caption><graphic xlink:href="41467_2023_37123_Fig4_HTML" id="d32e2423"/></fig></p>
      <p id="Par27">Subsequently, the tissues were classified as normal morphology (Normal), myelodysplastic syndromes (MDS) and acute myeloid leukemia (AML). The improvements in visual quality afforded by DeepSNiF denoising facilitated manual review of lymphocyte staining patterns for annotation annotation of lymphocyte subpopulations (Supplementary Fig. <xref rid="MOESM1" ref-type="media">45)</xref>. B and T cell populations are scattered throughout the bone marrow cellularity in normal and malignant specimens, and lymphoid aggregates are occasionally present (Fig. <xref rid="Fig4" ref-type="fig">4</xref>c). To characterize the density and distance relationships between lymphocyte subpopulations, samples were analyzed in cohorts of extent of malignant blast involvement, after exclusion of the lymphoid aggregate outlier. Nearest neighbor distances between B cells, CD4 T and B cells, and CD4 and CD8 T cells were calculated for different disease tissues (Fig. <xref rid="Fig4" ref-type="fig">4</xref>d). Overall, the distributions from DeepSNiF are more concordant with annotated data. By contrast, those from DIMR are biased, with significant differences to the annotations due to cell misclassifications.</p>
      <p id="Par28">Automated DeepSNiF denoising reveals that as disease develops, the B cell distances become larger (<italic>P</italic> &lt; 0.01); The distances between CD4 T and B cells in normal and MDS tissues are greater than those of AML (<italic>P</italic> &lt; 0.0001); And CD4 and CD8 T cells in normal tissues trend towards longer distances than those in MDS (<italic>P</italic> = 0.0916). Interestingly, the overall distances between CD4 T and B cells in MDS tissues are greater than those of Normal samples (<italic>P</italic> &lt; 0.01). These findings hold for DeepSNiF denoised data in distances between B cells from MDS to AML (<italic>P</italic> &lt; 0.05), and from Normal to MDS samples for CD4 and CD8 T cells (<italic>P</italic> = 0.0929) and CD4 T to B cells (<italic>P</italic> &lt; 0.05). However in non-DeepSNiF denoised DIMR data, the trends between B cells has been violated from MDS to AML by DIMR data (<italic>P</italic> = 0.4923), as well as those from Normal to MDS between CD4 and CD8 T cells (<italic>P</italic> = 0.4762), and CD4 T to B cells (<italic>P</italic> = 0.6685). From this point, DeepSNiF is able to correct the distorted cell spatial distributions from less accurate annotations caused by noise, which may further enhance downstream cell-specific spatial analyses.</p>
      <p id="Par29">We also calculated the cell densities per tissue of these lymphocytes (Fig. <xref rid="Fig4" ref-type="fig">4</xref>e). The DeepSNiF results are closer to those annotated data for B cell and CD4 T cell. By contrast, the CD8 T cell densities from DIMR, DeepSNiF and annotated data are close to each other. Additionally, we observe higher B cell and CD4 T cell densities in Normal tissues than others, and higher B cell density of MDS than that of AML. No obvious developing trend for CD8 T cells are observed as the disease status changes. Furthermore, we have analyzed the correlations between the densities from different cell types (Fig. <xref rid="Fig4" ref-type="fig">4</xref>f, g). Note that in the reference groups, the B and CD4 T cell densities are generated from the annotated data, while the monocyte/macrophage density comes from DeepSNiF data. This is because the relative change of the monocytes/macrophages by DeepSNiF is smaller compared to those of B and CD4 T cells (Fig. <xref rid="Fig3" ref-type="fig">3</xref>b) and because DeepSNiF achieves higher accuracy than DIMR for the cell phenotyping (Fig. <xref rid="Fig3" ref-type="fig">3</xref>e, f). From the reference group in Fig. <xref rid="Fig4" ref-type="fig">4</xref>f, the densities of CD4 T and B cells are negatively correlated with each other (PCC: -0.4371). Nevertheless, DIMR result indicates no correlation between the cell densities (PCC: 0.0090), which demonstrates false annotations hinder true relational definition between different cell types. Again, the negatively correlated relationship can be uncovered using automated DeepSNiF (PCC: −0.2837). Likewise, the DIMR data fails to detect the correlation between the densities of CD4 T cell and monocyte/macrophages (PCC: 0.2781; Fig. <xref rid="Fig4" ref-type="fig">4</xref>g). Corrected by DeepSNiF, the measured correlation (PCC: 0.4503) approximates the reference finding (PCC: 0.4310).</p>
    </sec>
  </sec>
  <sec id="Sec8" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par30">With the rise of novel multiplexed technologies for the characterization of cellular context in health and disease, IMC has emerged as a valuable tool to investigate immunophenotypes while preserving spatial information<sup><xref ref-type="bibr" rid="CR8">8</xref>–<xref ref-type="bibr" rid="CR16">16</xref></sup>. Differing from traditional multiplexed imaging approaches based upon fluorescence microscopy, IMC allows for simultaneous acquisition of more than 40 cell-specific markers with greatly suppressed channel crosstalk, and avoids tissue and marker degradation in multi-round staining protocols. Furthermore, it eliminates autofluorescence and background signal issues that are inherent in fluorescent microscopy. The high-dimensional datasets then enable complex microenvironment analysis. However, IMC suffers from unique hot pixel and shot noise features. Analyzing raw IMC data without further restoration may lead to distortions, even errors, in downstream analysis. Contemporary denoising strategies<sup><xref ref-type="bibr" rid="CR10">10</xref>,<xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR15">15</xref>,<xref ref-type="bibr" rid="CR19">19</xref>,<xref ref-type="bibr" rid="CR21">21</xref></sup> are usually not adaptive or effective for these particular noise conditions. For example, the parameters of some methods must be tuned manually, which is not suitable for large datasets and may cause subjective, batch, and channel-specific errors.</p>
    <p id="Par31">In this work, we propose IMC-Denoise to account for the specific technical noise present in IMC images. In this pipeline, the DIMR algorithm is first applied to adaptively remove hot pixels. It does not use a user-defined intensity threshold or range to define hot pixels, eliminating the impact of the density and intensity variations of hot pixels in different datasets or markers. Instead, it builds a histogram from the differential maps of raw images followed by an iterative outlier detection algorithm. In comparison with other methods, DIMR achieves more robust hot pixel detection capability and normal pixel preserving performance. After hot pixel removal, the DeepSNiF algorithm is proposed to restore image quality. I-divergence is derived as the optimal loss function for this denoising task. Due to the absence of noise-free IMC images and incompatibility with repeated scanning to generate training labels<sup><xref ref-type="bibr" rid="CR8">8</xref></sup>, we applied a masking strategy with stratified sampling from Noise2Void<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. This enabled self-supervised training for this denoising task, in which multiple pixels are randomly masked and replaced by its adjacent pixels. With the continuity of antibody signals in IMC, Hessian norm regularization<sup><xref ref-type="bibr" rid="CR41">41</xref>–<xref ref-type="bibr" rid="CR43">43</xref></sup> is added in the loss function to boost the denoising performance. In DeepSNiF, we train a single network for a single marker, which reduces the memory allocated for training. Nevertheless, we note that DeepSNiF also works on multi-marker training (Supplementary Fig. <xref rid="MOESM1" ref-type="media">46)</xref>. In another aspect, this demonstrates that DeepSNiF works on the markers stained for morphologically heterogeneous markers, since the variant features have been learned in the training process. In addition, monocytes/macrophages are morphologically heterogeneous so that the successful denoising of CD14/CD169 (Fig. <xref rid="Fig1" ref-type="fig">1</xref>f) validates the adaptability of DeepSNiF as well. In fact, the networks are able to learn all the features existing in the training images but not focus on any specific structures. As a result, markers with interstitial staining patterns (e.g. vessels, fibrosis, reticular cytoplasmic projections) can be well restored (CD31, CD34 and Collagen III in Figs. <xref rid="Fig1" ref-type="fig">1</xref> and <xref rid="Fig2" ref-type="fig">2</xref> and Supplementary Figs. <xref rid="MOESM1" ref-type="media">19</xref> and <xref rid="MOESM1" ref-type="media">20)</xref>. However, small areas of staining at the size of a sub-cellular synapse (e.g. 1–2 μm diameter) will not be successfully distinguished by IMC due to its relatively low resolution of 1 μm. Therefore, the network cannot learn the features of such small structures. The trained network can be employed to other datasets which share similar features (Supplementary Fig. <xref rid="MOESM1" ref-type="media">22)</xref>.</p>
    <p id="Par32">To determine the applicability of our approach, reference denoising algorithms were utilized to rigorously evaluate IMC-Denoise on both simulated data and multiple pathological patient datasets. Compared to other methodologies, both DIMR and DeepSNiF achieve the best denoising performance, qualitatively and quantitatively. Orthogonal approaches that have not been previously tested in evaluation of IMC restoration are also used to verify the image quality improvement by IMC-Denoise. This pipeline can be further extended by existing analytical processing pipelines including Mesmer/DeepCell and ark-analysis<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> or MCMicro<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>. If warranted, one may<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> address spillover issues after hot pixel removal and shot noise filtering, as indicated in Eq. (<xref rid="Equ1" ref-type="disp-formula">1</xref>). A related modality, MIBI<sup><xref ref-type="bibr" rid="CR6">6</xref>,<xref ref-type="bibr" rid="CR7">7</xref></sup>, shares several image formation and noise features with IMC, and the denoising pipeline deployed here may also enhance MIBI datasets.</p>
    <p id="Par33">IMC-Denoise is effective at removing background noise and enhancing downstream analysis of IMC data with limited, subjective, user-input. Multiple datasets processed by DIMR and DeepSNiF were compared with state-of-the-art IMC background removal methods, including single threshold binarization, semi-automated Ilastik-based<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, and MAUI<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>, using the F1 score as the accuracy metric to evaluate the results. The qualitative and quantitative results indicate DeepSNiF can affect significant background noise removal, and is superior to tedious semi-automated approaches. In particular, DeepSNiF is capable of unmixing specific IMC staining signal from background noise. This means that even the thesholding approach for background removal is not essential after DeepSNiF denoising.</p>
    <p id="Par34">Conventional workflows typically use manual gating strategies combined with prior cell marker knowledge to identify and compare cell types in pathological samples. We used real world data and these methods to evaluate the IMC denoising algorithm for single-cell analyses, and compared to DIMR, DIMR_Ilastik, and DeepSNiF. Automated IMC-Denoise performs equally or superior to the semi-manual Ilastik-based method in downstream single cell analysis, and DeepSNiF notably enhances cell clustering and annotation. Quantitative evaluations of cell phenotyping results indicate the improvement of sensitivity and specificity by DeepSNiF denoising. Further validations with DIMR-based cell masks demonstrate the robustness of IMC-Denoise to variant cell segmentation results. For lymphocyte annotation, Jaccard and F1 scores demonstrate that DeepSNiF performs significantly better than DIMR on phenotyping of B, CD8-positive T and CD4-positive T cells. Further, spatial distribution and cell density correlation analysis indicate less accurate annotations by the data denoised solely by DIMR, leading to biased conclusions. With the data denoised by DeepSNiF, such distortions can be corrected and more accurate downstream analysis is achieved.</p>
    <p id="Par35">As noted, DeepSNiF enhances all the markers and their downstream analysis. However, the marker channels with high noise levels benefit to a larger degree. In theory, there is no maximum noise level present for denoising algorithms. Even under some extremely noisy conditions (CD20 and CD3 in Fig. <xref rid="Fig1" ref-type="fig">1</xref>f, markers in Supplementary Figs. <xref rid="MOESM1" ref-type="media">18</xref> and <xref rid="MOESM1" ref-type="media">20)</xref>, DeepSNiF improves the image quality. Nevertheless, lower SNR in raw images means lower specific information content and thus the quality of the restored images are lower (Supplementary Figs. <xref rid="MOESM1" ref-type="media">6</xref>–<xref rid="MOESM1" ref-type="media">11)</xref>. Because of the signal-dependent characteristics of shot noise, the noise components of high SNR channels contribute less to overall image quality, and thus have lower impact on downstream analysis. Empirically, we find that denoising by DeepSNiF can be omitted when the mean expressions of positive markers are larger than 7 (MPO, CD15, and CD235a), however denoising all marker channels improves performance and is not computationally intensive.</p>
    <p id="Par36">Limitations of IMC-Denoise include the inability to remove large hot pixel clusters, as DIMR cannot discriminate these larger areas of outliers from signal (Supplementary Fig. <xref rid="MOESM1" ref-type="media">47)</xref>. Further the self-supervised DeepSNiF algorithm cannot reach the accuracy of supervised denoising methods due to unavailability of ground truths (Supplementary Figs. <xref rid="MOESM1" ref-type="media">8</xref> and <xref rid="MOESM1" ref-type="media">9)</xref>. Nevertheless, DIMR can remove single hot pixels and small hot clusters of several consecutive pixels, and DeepSNiF performs better than other unsupervised and self-supervised denoising methods on IMC datasets. To conclude, we have developed the content aware IMC-Denoise for improved IMC image quality and quantitative accuracy. Predicated on a novel combination of differential map-based and self-supervised CNN-based algorithms, this open source pipeline removes hot pixels and effectively suppresses shot noise in multiplexed IMC data. Multiple image and cell-based analyses from different IMC datasets verified the enhancements brought by this approach, with the ability to resolve significant cellular phenotypic and spatial information approximating manual annotation. We have provided tutorials to help users implement IMC-Denoise (Supplementary Note <xref rid="MOESM1" ref-type="media">4</xref> and <ext-link ext-link-type="uri" xlink:href="https://github.com/PENGLU-WashU/IMC_Denoise">https://github.com/PENGLU-WashU/IMC_Denoise</ext-link>). We expect IMC-Denoise to become a widely used pipeline in IMC analysis due to its adaptability, effectiveness and flexibility.</p>
  </sec>
  <sec id="Sec9">
    <title>Methods</title>
    <sec id="Sec10">
      <title>Human bone marrow dataset</title>
      <p id="Par37">Sections were cut in 4-6 μm thickness from formalin-fixed paraffin-embedded (FFPE) blocks of ethylenediaminetetraacetic acid (EDTA)-decalicifed bone marrow trephine biopsy specimens. Three patients demonstrated normal morphology, and 4 patients were diagnosed with myelodysplastic syndromes (MDS), with additional later timepoints obtained at disease progression including acute myeloid leukemia (AML). Use of specimens for secondary analysis in this study was approved by the Washington University in St. Louis Institutional Review Board (#201912110). Informed consent was waived, per IRB-approved protocol.</p>
    </sec>
    <sec id="Sec11">
      <title>Tissue staining and IMC data acquisition</title>
      <p id="Par38">Descriptions of cell markers and isotope tags are provided in Supplementary Tables <xref rid="MOESM1" ref-type="media">2</xref>–<xref rid="MOESM1" ref-type="media">5</xref>. Staining was performed according to Fluidigm IMC recommendations for FFPE as follows. Briefly, tissue sections were dewaxed in xylene and rehydrated in a graded series of alcohol. Epitope retrieval was conducted in a water bath at 96 °C in Tris-EDTA buffer at pH 9 for 30 minutes, then cooled and washed in metal-free PBS. Blocking with Superblock (ThermoFisher) plus 5% FcX TruBlock (Biolegend) was followed by staining with antibody cocktail prepared in 0.5% BSA and metal-free PBS overnight at 4 °C. Sections were washed in 0.02% TritonX100 followed by metal-free PBS, then nuclear staining was performed using 1:200 or 1:300 dilution of Intercalator-Ir (125 μm, Fluidigm) solution for 30 min, followed by ddH<sub>2</sub>O for 5 min. Slides were air-dried before IMC measurement.</p>
      <p id="Par39">The abundance of bound antibody was quantified using the Hyperion imaging system (Fluidigm) controlled by CyTOF Software (version 7.0.8493), with UV-laser set at 200 Hz. Count data were then converted to tiff image stacks for further analysis using MCD Viewer (version 1.0.560.6, Fluidigm) or imctools (Bodenmiller lab, <ext-link ext-link-type="uri" xlink:href="https://github.com/BodenmillerGroup/imctools">https://github.com/BodenmillerGroup/imctools</ext-link>).</p>
    </sec>
    <sec id="Sec12">
      <title>Tissue staining and IF data acquisition</title>
      <p id="Par40">For IF staining, tissue was prepared using the same protocal in IMC staining, then stained overnight at 4 °C with a single metal-conjugated primary antibody (CD3, CD4, CD169, or CD61 in Supplemental Table <xref rid="MOESM1" ref-type="media">5)</xref>. The single-stained tissue was washed, then stained with secondary antibody (donkey anti-rabbit AF647 or goat anti-mouse AF750, Invitrogen, 2 mg/mL diluted 1:400 in 0.5% BSA in PBS) at room temperature 1 h, followed by additional washing in PBS and DAPI (1 μg/mL) staining. Slides were mounted with SlowFade Glass antifade reagent (ThermoFisher) and # 1 1/2 coverslips. Images were acquired using Leica DMi8 inverted widefield microscope with Lumencor SOLA SE U-nIR light engine, DAPI/FITC/TRITC/Cy5/Cy7 filters, DFC9000 GT sCMOS camera, PL APO 20x/0.80 objective and LAS X software (version 3.7.3.23245). After image acquisition, coverslips were removed with gentle agitation in PBS, then Ir-intercalator staining, washing and drying performed as above for subsequent Hyperion data acquisition.</p>
    </sec>
    <sec id="Sec13">
      <title>Human pancreatic, breast cancer IMC datasets, and MIBI dataset</title>
      <p id="Par41">We applied the human pancreatic<sup><xref ref-type="bibr" rid="CR10">10</xref></sup>, breast cancer<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> IMC datasets, and a MIBI dataset<sup><xref ref-type="bibr" rid="CR19">19</xref></sup> to verify the flexibility of IMC-Denoise. All of these datasets are publicly available. The links are provided in the corresponding papers. In breast cancer dataset, CD3, CD20, CD45, CD68, c-Myc, EGFR, EpCAM, Ki-67, Rabbit IgG H L, Slug, Twist, and vWF were selected; in pancreatic cancer dataset, CD3, CD4, CD8, CD11b, CD14, CD31, CD44, CD45, CD45RO, CD56, Foxp3, and pS6 were selected; and in the MIBI dataset, CD3, CD4, CD8, CD11b, CD11c, CD14, CD20, CD31, CD45, CD68, CD206, and HLA-DR were selected. The two IMC datasets were processed by both DIMR and DeepSNiF. The MIBI dataset is only processed by DeepSNiF because no hot pixels are observed, and the hot clusters observed in MIBI images can be removed by the MAUI software package<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>. Details on software implementation can be found in the relevant sections below.</p>
    </sec>
    <sec id="Sec14">
      <title>Neural network implementation</title>
      <p id="Par42">The DeepSNiF neural network follows the U-Net architecture<sup><xref ref-type="bibr" rid="CR39">39</xref></sup> with Res-block modules<sup><xref ref-type="bibr" rid="CR40">40</xref></sup>, in which the input and output images share the same size (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13)</xref>. U-Net architecture is widely used for image deblurring and denoising<sup><xref ref-type="bibr" rid="CR24">24</xref>,<xref ref-type="bibr" rid="CR34">34</xref></sup>. In general, the network is composed of an encoder and a decoder. Starting with the input, the encoder path gradually condenses the spatial information into high-level feature maps with growing depths; the decoder path reverses this process by recombining the information into feature maps with gradually increased lateral details. The information in adjacent feature maps transfers by convolving with 3 × 3 convolutional filters. The down-sampling and up-sampling are used in encoder and decoder for compressing and reconstructing features, performed here by 2 × 2 max-pooling and 2 × 2 up-sampling operations, respectively. Res-blocks are applied to facilitate efficient training. Each res-block contains a convolution layer, batch normalization and the rectified linear unit (ReLU) nonlinear activation, in which the batch normalization layer aims to speed up training process, ReLU could provide non-linearity in the network. Drop out layers are also added with 0.5 dropout rate after the central two res-blocks to mitigate overfitting. The skip connections link low-level features and high-level features by concatenating their feature maps. We use the softplus function (<inline-formula id="IEq17"><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\log (1+\exp (x))$$\end{document}</tex-math><mml:math id="M38"><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq17.gif"/></alternatives></inline-formula>) as the activation function of the final layer and Eq. (<xref rid="Equ2" ref-type="disp-formula">2</xref>) as the loss function so that the output of the network is guaranteed to be non-negative.</p>
      <p id="Par43">The hot pixel-removed images are split into multiple 64 × 64 patches. Then, the patches are rotated by 90°, 180°, and 270°, and flipped as a data augmentation approach. In IMC images, foreground objects of interest might be distributed sparsely. In this case, the model might overfit the background areas and fail to learn the structure of foreground objects if the entire image is used indiscriminately for training. Therefore, patches from the background regions are excluded from training. In IMC images, pixels with intensity value 0 are considered as background. Afterwards, we define the background pixel ratio <italic>r</italic> as ratio of the number of background pixels and that of total pixels in the patch. Patches are considered as the background regions if <italic>r</italic> ≤ <italic>ρ</italic>, where <italic>ρ</italic> is the threshold and set from 0.2 to 0.99 for different channels and datasets. We applied a smaller <italic>ρ</italic> for the datasets less sparse images and vice versa. For good generalization ability of the network, we recommend at least 5000 patches for training. Before training, all the generated patches were percentile normalized (99.9–99.999, Supplementary Note <xref rid="MOESM1" ref-type="media">1.3.3)</xref>. The percentile of 99.9 was applied for those training sets with extremely bright markers and larger percentile with relatively homogeneous intensity distributions. To balance the training efficiency and accuracy, 0.2% pixels of each patch are masked and replaced by their neighbors using a stratified sampling strategy<sup><xref ref-type="bibr" rid="CR24">24</xref></sup>. Finally, 85% of the patches are set as training set and the rest as validation set.</p>
      <p id="Par44">All models were trained using Keras<sup><xref ref-type="bibr" rid="CR51">51</xref></sup> (version 2.3.1) on a single NVIDIA Quadro RTX 6000 GPU with 24 GB of VRAM. Adam optimizer<sup><xref ref-type="bibr" rid="CR52">52</xref></sup> was applied as the optimization algorithm with a initial learning rate of 0.001 for 200 epochs and batch size of 128. Learning rate is multiplied by 0.6 if validation loss does not improve for 20 epoches. The training details for all the datasets are summarized as Supplementary Tables <xref rid="MOESM1" ref-type="media">6</xref>–<xref rid="MOESM1" ref-type="media">11</xref>. Note that the training datasets for N2V, MN2V, and DeepSNiF-NR are the same as those for DeepSNiF, and the training time of N2V, MN2V, and DeepSNiF-NR is approximately equal to that of DeepSNiF.</p>
    </sec>
    <sec id="Sec15">
      <title>Neural network inference details</title>
      <p id="Par45">Given a trained denoising model, we denoise full-size IMC images to avoid edge stitching effects. In order to achieve end-to-end prediction, we pad pixels around each image so their width and height are the multiples of 16 with reference to the network architecture (Supplementary Fig. <xref rid="MOESM1" ref-type="media">13)</xref>. The padding pixels are the replications of the border pixels. Before prediction, the IMC images are normalized by the pre-calculated maximum of the corresponding channels in the training set. The outputs of the network are re-scaled and set as the denoised images. Given the trained denoising model, inference is fast. We are able to denoise IMC images with pixels of 1000 by 1000 less than 1 second per image on a single NVIDIA Quadro RTX 6000 GPU.</p>
    </sec>
    <sec id="Sec16">
      <title>Reference hot pixel removal and statistics-based shot noise filtering methods</title>
    </sec>
    <sec id="Sec17">
      <title>Semi-automated Ilastik-based background noise removal</title>
      <p id="Par46">The semi-automated strategy in<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> utilizes Ilastik segmentation<sup><xref ref-type="bibr" rid="CR53">53</xref></sup> to remove background noise in IMC images. An expert annotates signal or background regions of IMC images, and then Ilastik trains a random forest classifier for background noise removal. To achieve good denoising quality, large areas of background require manual labeling, which is labor-intensive. Furthermore, low image quality may affect the accuracy of this method as well. After background removal, the images are binarized to solve batch effect issues. Then the single cell information is calculated by counting the positive signal frequency rather than the mean intensity of every single cell. Here, we only utilized Ilastik (version 1.3.2post1) for background noise removal of IMC images, and still applied the mean intensities as the single cell profiles. To better reveal the enhancement by DeepSNiF, we applied the same labels for the trainings of DIMR and DeepSNiF-processed images.</p>
    </sec>
    <sec id="Sec18">
      <title>MAUI</title>
      <p id="Par47">MAUI software package<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR19">19</xref></sup> includes spillover correction, noise removal and aggregate removal. All three steps require expert observation, which is also labor-intensive. Here, we only benchmarked the noise removal method in MAUI with our DeepSNiF algorithm. Briefly, it calculates the distances between a non-zero pixel and its K nearest non-zero neighbors, then builds a histogram based on the summations of the distances for all the non-zero pixels. Next, a threshold is manually selected to remove the pixels with larger summations by observing the distribution of the histogram. This method is based on the assumption that noisy regions look more sparse than normal regions. MAUI was implemented by the software package from <ext-link ext-link-type="uri" xlink:href="https://github.com/angelolab/MAUI">https://github.com/angelolab/MAUI</ext-link>. The parameter K and the threshold were manually tuned to guarantee the best performance of MAUI (Supplementary Fig. <xref rid="MOESM1" ref-type="media">27)</xref>.</p>
    </sec>
    <sec id="Sec19">
      <title>Pixel classification and cell segmentation</title>
      <p id="Par48">In single cell segmentation, the pixels in each image were defined as belonging to the nucleus, cytoplasm, or background compartment using the pixel classification module of Ilastik<sup><xref ref-type="bibr" rid="CR53">53</xref></sup> (version 1.3.2post1) as described in <ext-link ext-link-type="uri" xlink:href="https://github.com/BodenmillerGroup/ImcSegmentationPipeline">https://github.com/BodenmillerGroup/ImcSegmentationPipeline</ext-link>. In our experiments, the DIMR and DeepSNiF-processed images were both set as inputs for cell mask segmentation. The DeepSNiF-based cell masks were primarily used for further analysis, while those based on DIMR were validated for robustness in some cases. The Random Forest classifier was trained on the channels including CD38, MPO, CD14, CD71, CD11b, CD4, CD20, CD8a, CD15, Ki-67, CD3, CD45RO CD235a, Histone-H3, and Iridium. This allowed for the generation of maps that integrate for each pixel the probability of belonging to each of three compartments. Based on the trained classifier, probability maps were generated for the whole dataset and exported as tiff files in batch mode.</p>
      <p id="Par49">Subsequently, CellProfiler<sup><xref ref-type="bibr" rid="CR54">54</xref></sup> (version 3.1.8) was used to define cell masks for marker expression quantification. To define cell borders, nuclei were first identified as primary objects based on ilastik probability maps and expanded through the cytoplasm compartment until either a neighboring cell or the background compartment was reached. Cell masks were generated for identification of single cells and used to extract single-cell information from IMC images.</p>
    </sec>
    <sec id="Sec20">
      <title>Single-cell marker profile extraction and line fitting</title>
      <p id="Par50">We used HistoCAT<sup><xref ref-type="bibr" rid="CR55">55</xref></sup> (version 1.7.6) to extract single-cell marker profiles based on the IMC images and their segmentation masks. All the data were not transformed and used directly.</p>
      <p id="Par51">We conducted bisqaure line fitting for the extracted DIMR and DeepSNiF-processed single cell data with customized MATLAB (R2021a, MathWork) scripts.</p>
    </sec>
    <sec id="Sec21">
      <title>Positive cell identification</title>
      <p id="Par52">For initial identification of marker-positive cells, we modified the method described in<sup><xref ref-type="bibr" rid="CR14">14</xref></sup>. Briefly, univariate Gaussian mixture models with scikit-learn<sup><xref ref-type="bibr" rid="CR56">56</xref></sup> (version 1.0.2) were used to estimate the positive thresholds of each marker. Before threshold estimation, all data were 99th-percentile normalized so that the impact of extremely bright cells can be eliminated.</p>
      <p id="Par53">For each channel, we performed model selection with models with 6–15 mixtures for DIMR data, in order to estimate the positive threshold accurately. We selected the model on the basis of the Davies-Bouldin index<sup><xref ref-type="bibr" rid="CR57">57</xref></sup> and identified a positive threshold for a given channel by considering both the distributions of cell profiles and the overall IMC image intensities. The estimated positive thresholds of single cell data from DIMR and DeepSNiF-based cell segmentations are summarized in Supplementary Tables <xref rid="MOESM1" ref-type="media">12</xref> and <xref rid="MOESM1" ref-type="media">13</xref>.</p>
    </sec>
    <sec id="Sec22">
      <title>Cell-type annotation</title>
      <p id="Par54">A subset of markers extracted from DeepSNiF-based cell segmentation masks of the human bone marrow dataset were utilized for cell phenotypic annotation, including CD38, MPO, CD14, CD71, CD11b, CD4, CD169, CD20, CD8a, CD15, CD3, and CD235a. Before analysis, data were 99th-percentile normalized followed by Z-score normalization. Then the DIMR data was clustered by the Phenograph algorithm with 20 nearest neighbors of each cell<sup><xref ref-type="bibr" rid="CR46">46</xref></sup> with the Leiden community detection algorithm<sup><xref ref-type="bibr" rid="CR47">47</xref></sup> with resolution of 6.0, which resulted in over clustering with 117 clusters. The generated clusters were manually labeled with a broad ontogeny and the channels that were most abundant in each cluster (Supplementary Fig. <xref rid="MOESM1" ref-type="media">35)</xref>, resulting in 9 cell types, including immune cell subsets (B cell, CD4+ T cell, CD8+ T cell, and plasma cell, monocyte/macrophages), erythroid, myeloid, and other CD4+ cells and others.</p>
      <p id="Par55">The DeepSNiF data clustering and annotation utilized a weighted K-nearest neighbor (KNN) approach (K=20) to map the DeepSNiF data into the DIMR clusters. It first constructs a Jaccard graph between each cell from DeepSNiF and all the DIMR cells, and then maps the DeepSNiF data into the DIMR clusters with the shortest weighted distance. The leave-one-out DeepSNiF data was also annotated with the same approach. The Phenograph with Leiden algorithms were implemented by the software packages from <ext-link ext-link-type="uri" xlink:href="https://github.com/jacoblevine/PhenoGraph">https://github.com/jacoblevine/PhenoGraph</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://github.com/vtraag/leidenalg">https://github.com/vtraag/leidenalg</ext-link>. DeepSNiF data annotation was implemented with customized python scripts. The same markers extracted from DIMR-based cell masks were also analyzed with the same approach (Supplementary Fig. <xref rid="MOESM1" ref-type="media">38)</xref>.</p>
      <p id="Par56">Notably, multiple strategies were applied to reduce the noise impact during DIMR clustering: (1) Z-score normalization is consistent for handling different sources of noise in multiplexed cell data, including low intensity signal, high background signal, segmentation noise, and imaging artifacts, as verified by<sup><xref ref-type="bibr" rid="CR58">58</xref></sup>; (2) the Jaccard graph construction in Phenograph is robust to noise, which is verified in<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>; and (3) over-clustering could improve the clustering accuracy<sup><xref ref-type="bibr" rid="CR58">58</xref></sup>. Besides, we didn’t annotate the DeepSNiF and leave-one-out DeepSNiF data with the same approach of DIMR because (1) The community detection results by Leiden algorithm is random so that it is very difficult to compare the annotations from different data; and (2) the weighted KNN method for DeepSNiF and leave-one-out DeepSNiF clustering could clearly reveal the differences before and after the processing.</p>
      <p id="Par57">The manual cell-type annotation in Fig. <xref rid="Fig4" ref-type="fig">4</xref> was based on the DeepSNiF-based cell segmentation masks. Briefly, DIMR and DeepSNiF images were overlaid with the cell masks in FIJI<sup><xref ref-type="bibr" rid="CR59">59</xref></sup>. In some extremely noisy cases, the DIMR images were denoised by Gaussian filters to improve the annotation accuracy. Based on the signal in each cell mask, the cells were classified as B, CD8 T, CD4 T cells and other cells. Some positive signals were identified as hot clusters and discarded. The annotation results were manually recorded. To test the impact of segmentation masks on annotation results, we have also annotated the lymphocytes on DIMR-based cell masks (Supplementary Fig. <xref rid="MOESM1" ref-type="media">44)</xref>.</p>
    </sec>
    <sec id="Sec23">
      <title>Fast interpolation-based <italic>t</italic>-SNE algorithm</title>
      <p id="Par58">For visualization, high-dimensional single-cell data of DIMR and DeepSNiF were reduced to two dimensions using the nonlinear dimensionality reduction algorithm fast interpolation-based <italic>t</italic>-SNE<sup><xref ref-type="bibr" rid="CR48">48</xref></sup>. This algorithm was implemented by the software package in <ext-link ext-link-type="uri" xlink:href="https://github.com/KlugerLab/FIt-SNE">https://github.com/KlugerLab/FIt-SNE</ext-link>. Before the analysis, data were 99th-percentile normalized followed by Z-score normalization. The <italic>t</italic>-SNE parameters with perplexity of 50 and theta of 0.5 were used. The random seeds for the individual runs were recorded.</p>
    </sec>
    <sec id="Sec24">
      <title>Enrichment calculation of positive cell markers after DeepSNiF and leave-one-out DeepSNiF</title>
      <p id="Par59">To evaluate the effect of positive cell marker enrichment after DeepSNiF and leave-one-out DeepSNiF, the cell-type annotations before and after the processing were selected, and the percentage of positive markers on each cell types was calculated. The relative change was then defined as the difference between the percentage of positive markers after and before the processing.</p>
    </sec>
    <sec id="Sec25">
      <title>Enrichment calculation of cell types after DeepSNiF and leave-one-out DeepSNiF</title>
      <p id="Par60">To evaluate the effect of cell type enrichment after DeepSNiF and leave-one-out DeepSNiF, the positive cells for a given marker before and after the processing were selected, and the percentage of each cell type based on cell-type annotation was calculated. The relative change was then defined as the difference between the percentage of cell-type composition after and before the processing.</p>
    </sec>
    <sec id="Sec26">
      <title>Accuracy metrics</title>
      <p id="Par61">In simulation, the accuracy metrics including root mean squared error, peak SNR and structural similarity<sup><xref ref-type="bibr" rid="CR45">45</xref></sup> are used to access the image qualities because of the availability of ground truths. They are defined in Supplementary Note <xref rid="MOESM1" ref-type="media">3.2</xref> in detail.</p>
      <p id="Par62">For the real experimental data, five types of metrics were used for quantitative evaluations. The standard deviation of background (STDB) and contrast-to-noise ratio (CNR) were used to evaluate the noise level and contrast of IMC images. CNR is defined as Eq. (<xref rid="Equ3" ref-type="disp-formula">3</xref>),<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{CNR}}}}}}}}=({C}_{{{{{{{{\rm{sig}}}}}}}}}-{C}_{{{{{{{{\rm{bg}}}}}}}}})/{\sigma }_{{{{{{{{\rm{bg}}}}}}}}}$$\end{document}</tex-math><mml:math id="M40"><mml:mi mathvariant="normal">CNR</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">sig</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">bg</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">bg</mml:mi></mml:mrow></mml:msub></mml:math><graphic xlink:href="41467_2023_37123_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula>where <italic>C</italic><sub>sig</sub> and <italic>C</italic><sub>bg</sub> are the mean of the signal and background and <italic>σ</italic><sub>bg</sub> is the STDB. In this metric, the signal and background regions of IMC images are manually annotated.</p>
      <p id="Par63">Pearson’s correlation coefficient (PCC) was used as the metric to reflect the similarity between two groups of data. The PCC between measured data <bold>Y</bold> and the reference <bold>Y</bold><sub>ref</sub> is defined as Eq. (<xref rid="Equ4" ref-type="disp-formula">4</xref>),<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{PCC}}}}}}}}({{{{{{{\bf{Y}}}}}}}},{{{{{{{{\bf{Y}}}}}}}}}_{{{{{{{{\rm{ref}}}}}}}}})=\frac{E[({{{{{{{\bf{Y}}}}}}}}-{\mu }_{{{{{{{{\bf{Y}}}}}}}}})({{{{{{{{\bf{Y}}}}}}}}}_{{{{{{{{\rm{ref}}}}}}}}}-{\mu }_{{{{{{{{{\bf{Y}}}}}}}}}_{{{{{{{{\rm{ref}}}}}}}}}})]}{{\sigma }_{{{{{{{{\bf{Y}}}}}}}}}{\sigma }_{{{{{{{{{\bf{Y}}}}}}}}}_{{{{{{{{\rm{ref}}}}}}}}}}},$$\end{document}</tex-math><mml:math id="M42"><mml:mi mathvariant="normal">PCC</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ref</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>E</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ref</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ref</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ref</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2023_37123_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>where <italic>μ</italic><sub><bold>Y</bold></sub> and <inline-formula id="IEq18"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\mu }_{{{{{{{{{\bf{Y}}}}}}}}}_{{{{{{{{\rm{ref}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M44"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ref</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq18.gif"/></alternatives></inline-formula> are the mean values of images <bold>Y</bold> and <bold>Y</bold><sub>ref</sub>, respectively; <italic>σ</italic><sub><bold>Y</bold></sub> and <inline-formula id="IEq19"><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${\sigma }_{{{{{{{{{\bf{Y}}}}}}}}}_{{{{{{{{\rm{ref}}}}}}}}}}$$\end{document}</tex-math><mml:math id="M46"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">ref</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="41467_2023_37123_Article_IEq19.gif"/></alternatives></inline-formula> are the standard deviations of <bold>Y</bold> and <bold>Y</bold><sub>ref</sub>, respectively; and <italic>E</italic> represents arithmetic mean.</p>
      <p id="Par64">Furthermore, F1 score was used to evaluate the accuracy of background noise removal. F1 score and Jaccard score were used to evaluate the accuracy of cell annotation of B, CD8 T and CD4 T cells, which can be formulated as Eqs. (<xref rid="Equ5" ref-type="disp-formula">5</xref>) and (<xref rid="Equ6" ref-type="disp-formula">6</xref>), respectively.<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{F}}}}}}}}1\,{{{{{{{\rm{score}}}}}}}}=\frac{2{{{{{{{\rm{TP}}}}}}}}}{2{{{{{{{\rm{TP}}}}}}}}+{{{{{{{\rm{FP}}}}}}}}+{{{{{{{\rm{FN}}}}}}}}},$$\end{document}</tex-math><mml:math id="M48"><mml:mi mathvariant="normal">F</mml:mi><mml:mn>1</mml:mn><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">score</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi mathvariant="normal">TP</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi mathvariant="normal">TP</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">FP</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">FN</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2023_37123_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula><disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$${{{{{{{\rm{Jaccard}}}}}}}}\,\,{{{{{{{\rm{score}}}}}}}}=\frac{{{{{{{{\rm{TP}}}}}}}}}{{{{{{{{\rm{TP}}}}}}}}+{{{{{{{\rm{FP}}}}}}}}+{{{{{{{\rm{FN}}}}}}}}},$$\end{document}</tex-math><mml:math id="M50"><mml:mi mathvariant="normal">Jaccard</mml:mi><mml:mspace width="0.25em"/><mml:mspace width="0.25em"/><mml:mi mathvariant="normal">score</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">TP</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">TP</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">FP</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="normal">FN</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math><graphic xlink:href="41467_2023_37123_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula>where TP, FP and FN are the pixel number of true positives, false positives and false negatives, respectively. All of the evaluation process was implemented with customized MATLAB (R2021a, MathWork) scripts. RMSE, PSNR, SSIM, PCC, F1 score, and Jaccard score were computed using MATLAB built-in functions.</p>
    </sec>
    <sec id="Sec27">
      <title>Statistical analysis</title>
      <p id="Par65">Other than specially stated, quantitative data are presented as box-and-whisker plots (center line, median; limits, 75% and 25%; whiskers, maximum and minimum). The two-sided Wilcoxon matched-paired test was used for the statistical significance determination of repeated measurements. The two-sided Kolmogorov-Smirnov test was used for the statistical significance determination of different distributions in Fig. <xref rid="Fig4" ref-type="fig">4</xref>d. All the statistical tests are implemented with Prism 9 (GraphPad Software Inc.). Statistical significance at <italic>P</italic> &lt; 0.05, 0.01, 0.001, and 0.0001 are denoted by *, **, *** and ****, respectively. “ns” means “no significance”.</p>
    </sec>
    <sec id="Sec28">
      <title>Reporting summary</title>
      <p id="Par66">Further information on research design is available in the <xref rid="MOESM3" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary information</title>
    <sec id="Sec29">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41467_2023_37123_MOESM1_ESM.pdf">
            <caption>
              <p>Supplementary Information</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41467_2023_37123_MOESM2_ESM.pdf">
            <caption>
              <p>Peer Review File</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41467_2023_37123_MOESM3_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec30">
        <title>Source data</title>
        <p id="Par70">
          <media position="anchor" xlink:href="41467_2023_37123_MOESM4_ESM.xlsx" id="MOESM4">
            <caption>
              <p>Source data</p>
            </caption>
          </media>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Peng Lu, Karolyn A. Oetjen.</p>
    </fn>
  </fn-group>
  <sec>
    <title>Supplementary information</title>
    <p>The online version contains supplementary material available at 10.1038/s41467-023-37123-6.</p>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>Research reported in this publication was supported in part by NIH NCI R01CA240711, R01CA229893, K12 CA167540, and 1P50CA171963; NHLBI R21HL150636; American Society of Hematology Scholar Award; and Evans Foundation Edward P. Evans Center for MDS. We thank the Alvin J. Siteman Cancer Center at Washington University School of Medicine and Barnes-Jewish Hospital in St. Louis, MO., for the use of the Bursky Center for Human Immunology and Immunotherapy Programs Immunomonitoring Laboratory, which provided IMC service. The Siteman Cancer Center is supported in part by NCI Cancer Center Support Grant #P30 CA091842. The content is solely the responsibility of the authors and does not necessarily represent the official views of the NIH.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>P.L., K.A.O., and D.L.J.T. conceived and designed the project. P.L. developed and implemented the software. K.A.O., D.E.B., S.T.O., M.B.R., D.A.C.F., and D.C.L. obtained the human bone marrow tissues and performed the IMC staining and imaging. P.L., K.A.O., and D.L.J.T. conducted image and downstream analysis. R.K.P., W.N.B., K.G.S., S.T.O., and D.C.L. helped with analysis. P.L. and K.A.O. conducted the manual annotation with the further verification from all authors. D.L.J.T. supervised the project. P.L., K.A.O., and D.L.J.T. wrote the manuscript with input from all authors.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar1">
      <title>Peer review information</title>
      <p id="Par67"><italic>Nature Communications</italic> thanks Eric Gamazon, Febe van Maldegem and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. <xref rid="MOESM2" ref-type="media">Peer reviewer reports</xref> are available.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>The human bone marrow IMC data and simulated data generated in this study are available from Zenodo 10.5281/zenodo.6533905<sup><xref ref-type="bibr" rid="CR60">60</xref></sup>. The human pancreatic cancer IMC dataset<sup><xref ref-type="bibr" rid="CR10">10</xref></sup> can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://hpap.pmacs.upenn.edu/">https://hpap.pmacs.upenn.edu/</ext-link>, the human breast cancer IMC dataset<sup><xref ref-type="bibr" rid="CR12">12</xref></sup> can be downloaded from 10.5281/zenodo.3518284, and the MIBI data set<sup><xref ref-type="bibr" rid="CR19">19</xref></sup> can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/angelolab/MAUI">https://github.com/angelolab/MAUI</ext-link>, respectively. Source data for Figs. <xref rid="Fig1" ref-type="fig">1</xref>b, e, g, <xref rid="Fig2" ref-type="fig">2</xref>c, <xref rid="Fig3" ref-type="fig">3</xref>b, e, f, <xref rid="Fig4" ref-type="fig">4</xref>b, d–g, and Supplementary Figs. <xref rid="MOESM1" ref-type="media">2</xref>, <xref rid="MOESM1" ref-type="media">3</xref>–<xref rid="MOESM1" ref-type="media">11</xref>a, <xref rid="MOESM1" ref-type="media">18</xref>–<xref rid="MOESM1" ref-type="media">20</xref>b, <xref rid="MOESM1" ref-type="media">25</xref>b, <xref rid="MOESM1" ref-type="media">26</xref>b, <xref rid="MOESM1" ref-type="media">28</xref>–<xref rid="MOESM1" ref-type="media">30</xref>b, <xref rid="MOESM1" ref-type="media">32</xref>b, <xref rid="MOESM1" ref-type="media">38</xref>–<xref rid="MOESM1" ref-type="media">43</xref>, and <xref rid="MOESM1" ref-type="media">44</xref>b are provided in the source data file. All the other data supporting the results in this paper can be accessed from 10.5281/zenodo.7336448<sup><xref ref-type="bibr" rid="CR61">61</xref></sup>. <xref rid="Sec30" ref-type="sec">Source data</xref> are provided with this paper.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>The code used in this study and the corresponding tutorial are publicly available at GitHub <ext-link ext-link-type="uri" xlink:href="https://github.com/PENGLU-WashU/IMC_Denoise">https://github.com/PENGLU-WashU/IMC_Denoise</ext-link> and Zenodo 10.5281/zenodo.7559428<sup><xref ref-type="bibr" rid="CR62">62</xref></sup>.</p>
  </notes>
  <notes id="FPar2" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par68">The authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Saeys</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Van Gassen</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lambrecht</surname>
            <given-names>BN</given-names>
          </name>
        </person-group>
        <article-title>Computational flow cytometry: helping to make sense of high-dimensional immunology data</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2016</year>
        <volume>16</volume>
        <fpage>449</fpage>
        <lpage>462</lpage>
        <pub-id pub-id-type="doi">10.1038/nri.2016.56</pub-id>
        <?supplied-pmid 27320317?>
        <pub-id pub-id-type="pmid">27320317</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Adan</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Alizada</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Kiraz</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Baran</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Nalbant</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Flow cytometry: basic principles and applications</article-title>
        <source>Crit. Rev. Biotechnol.</source>
        <year>2017</year>
        <volume>37</volume>
        <fpage>163</fpage>
        <lpage>176</lpage>
        <pub-id pub-id-type="doi">10.3109/07388551.2015.1128876</pub-id>
        <?supplied-pmid 26767547?>
        <pub-id pub-id-type="pmid">26767547</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hickey</surname>
            <given-names>JW</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial mapping of protein composition and tissue organization: a primer for multiplexed antibody-based imaging</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>284</fpage>
        <lpage>295</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01316-y</pub-id>
        <?supplied-pmid 34811556?>
        <pub-id pub-id-type="pmid">34811556</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lin</surname>
            <given-names>JR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly multiplexed immunofluorescence imaging of human tissues and tumors using t-CyCIF and conventional optical microscopes</article-title>
        <source>Elife</source>
        <year>2018</year>
        <volume>7</volume>
        <fpage>e31657</fpage>
        <pub-id pub-id-type="doi">10.7554/eLife.31657</pub-id>
        <?supplied-pmid 29993362?>
        <pub-id pub-id-type="pmid">29993362</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Goltsev</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep profiling of mouse splenic architecture with codex multiplexed imaging</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>968</fpage>
        <lpage>981</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.07.010</pub-id>
        <?supplied-pmid 30078711?>
        <pub-id pub-id-type="pmid">30078711</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Angelo</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplexed ion beam imaging of human breast tumors</article-title>
        <source>Nat. Med.</source>
        <year>2014</year>
        <volume>20</volume>
        <fpage>436</fpage>
        <lpage>442</lpage>
        <pub-id pub-id-type="doi">10.1038/nm.3488</pub-id>
        <?supplied-pmid 24584119?>
        <pub-id pub-id-type="pmid">24584119</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Keren</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A structured tumor-immune microenvironment in triple negative breast cancer revealed by multiplexed ion beam imaging</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>1373</fpage>
        <lpage>1387</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.08.039</pub-id>
        <?supplied-pmid 30193111?>
        <pub-id pub-id-type="pmid">30193111</pub-id>
      </element-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Giesen</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly multiplexed imaging of tumor tissues with subcellular resolution by mass cytometry</article-title>
        <source>Nat. Methods</source>
        <year>2014</year>
        <volume>11</volume>
        <fpage>417</fpage>
        <lpage>422</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2869</pub-id>
        <?supplied-pmid 24584193?>
        <pub-id pub-id-type="pmid">24584193</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baharlou</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Canete</surname>
            <given-names>NP</given-names>
          </name>
          <name>
            <surname>Cunningham</surname>
            <given-names>AL</given-names>
          </name>
          <name>
            <surname>Harman</surname>
            <given-names>AN</given-names>
          </name>
          <name>
            <surname>Patrick</surname>
            <given-names>E</given-names>
          </name>
        </person-group>
        <article-title>Mass cytometry imaging for the study of human diseases–applications and data analysis strategies</article-title>
        <source>Front. Immunol.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>2657</fpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2019.02657</pub-id>
        <?supplied-pmid 31798587?>
        <pub-id pub-id-type="pmid">31798587</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>YJ</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Multiplexed in situ imaging mass cytometry analysis of the human endocrine pancreas and immune system in type 1 diabetes</article-title>
        <source>Cell Metab.</source>
        <year>2019</year>
        <volume>29</volume>
        <fpage>769</fpage>
        <lpage>783</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cmet.2019.01.003</pub-id>
        <?supplied-pmid 30713110?>
        <pub-id pub-id-type="pmid">30713110</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Damond</surname>
            <given-names>N</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A map of human type 1 diabetes progression by imaging mass cytometry</article-title>
        <source>Cell Metab.</source>
        <year>2019</year>
        <volume>29</volume>
        <fpage>755</fpage>
        <lpage>768</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cmet.2018.11.014</pub-id>
        <?supplied-pmid 30713109?>
        <pub-id pub-id-type="pmid">30713109</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jackson</surname>
            <given-names>HW</given-names>
          </name>
        </person-group>
        <article-title>The single-cell pathology landscape of breast cancer</article-title>
        <source>Nature</source>
        <year>2020</year>
        <volume>578</volume>
        <fpage>615</fpage>
        <lpage>620</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1876-x</pub-id>
        <?supplied-pmid 31959985?>
        <pub-id pub-id-type="pmid">31959985</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ali</surname>
            <given-names>HR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Imaging mass cytometry and multiplatform genomics define the phenogenomic landscape of breast cancer</article-title>
        <source>Nat. Cancer</source>
        <year>2020</year>
        <volume>1</volume>
        <fpage>163</fpage>
        <lpage>175</lpage>
        <pub-id pub-id-type="doi">10.1038/s43018-020-0026-6</pub-id>
        <?supplied-pmid 35122013?>
        <pub-id pub-id-type="pmid">35122013</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rendeiro</surname>
            <given-names>AF</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The spatial landscape of lung pathology during COVID-19 progression</article-title>
        <source>Nature</source>
        <year>2021</year>
        <volume>593</volume>
        <fpage>564</fpage>
        <lpage>569</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-021-03475-6</pub-id>
        <?supplied-pmid 33780969?>
        <pub-id pub-id-type="pmid">33780969</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wu</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell analysis of the human pancreas in type 2 diabetes using multi-spectral imaging mass cytometry</article-title>
        <source>Cell Rep.</source>
        <year>2021</year>
        <volume>37</volume>
        <fpage>109919</fpage>
        <pub-id pub-id-type="doi">10.1016/j.celrep.2021.109919</pub-id>
        <?supplied-pmid 34731614?>
        <pub-id pub-id-type="pmid">34731614</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moldoveanu</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatially mapping the immune landscape of melanoma using imaging mass cytometry</article-title>
        <source>Sci. Immunol.</source>
        <year>2022</year>
        <volume>7</volume>
        <fpage>eabi5072</fpage>
        <pub-id pub-id-type="doi">10.1126/sciimmunol.abi5072</pub-id>
        <?supplied-pmid 35363543?>
        <pub-id pub-id-type="pmid">35363543</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kuett</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Three-dimensional imaging mass cytometry for highly multiplexed molecular and cellular mapping of tissues and the tumor microenvironment</article-title>
        <source>Nat. Cancer</source>
        <year>2022</year>
        <volume>3</volume>
        <fpage>122</fpage>
        <lpage>133</lpage>
        <pub-id pub-id-type="doi">10.1038/s43018-021-00301-w</pub-id>
        <?supplied-pmid 35121992?>
        <pub-id pub-id-type="pmid">35121992</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chevrier</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Compensation of signal spillover in suspension and imaging mass cytometry</article-title>
        <source>Cell Syst.</source>
        <year>2018</year>
        <volume>6</volume>
        <fpage>612</fpage>
        <lpage>620</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2018.02.010</pub-id>
        <?supplied-pmid 29605184?>
        <pub-id pub-id-type="pmid">29605184</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Baranski</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MAUI (MBI analysis user interface)–an image processing pipeline for multiplexed mass based imaging</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2021</year>
        <volume>17</volume>
        <fpage>e1008887</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1008887</pub-id>
        <?supplied-pmid 33872301?>
        <pub-id pub-id-type="pmid">33872301</pub-id>
      </element-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Zanotelli, V. &amp; Bodenmiller, B. IMC segmentation pipeline: a pixel classification based multiplexed image segmentation pipeline. <italic>Zenodo</italic>10.5281/zenodo.3841960 (2017).</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ijsselsteijn</surname>
            <given-names>ME</given-names>
          </name>
          <name>
            <surname>Somarakis</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Lelieveldt</surname>
            <given-names>BP</given-names>
          </name>
          <name>
            <surname>Höllt</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>de Miranda</surname>
            <given-names>NF</given-names>
          </name>
        </person-group>
        <article-title>Semi-automated background removal limits data loss and normalizes imaging mass cytometry data</article-title>
        <source>Cytometry A</source>
        <year>2021</year>
        <volume>99</volume>
        <fpage>1187</fpage>
        <lpage>1197</lpage>
        <pub-id pub-id-type="doi">10.1002/cyto.a.24480</pub-id>
        <?supplied-pmid 34196108?>
        <pub-id pub-id-type="pmid">34196108</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Buades, A., Coll, B. &amp; Morel, J. M. A non-local algorithm for image denoising. <italic>Proceedings of the 2005 IEEE Computer Society Conference on Computer Vision and Pattern Recognition.</italic><italic>Vol.</italic> 2, p. 60–65 (IEEE Computer Society<italic>,</italic> 2005). .</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dabov</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Foi</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Katkovnik</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Egiazarian</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Image denoising by sparse 3-D transform-domain collaborative filtering</article-title>
        <source>IEEE Trans. Image Process.</source>
        <year>2007</year>
        <volume>16</volume>
        <fpage>2080</fpage>
        <lpage>2095</lpage>
        <pub-id pub-id-type="doi">10.1109/TIP.2007.901238</pub-id>
        <?supplied-pmid 17688213?>
        <pub-id pub-id-type="pmid">17688213</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Krull, A., Buchholz, T. O. &amp; Jug, F. Noise2void-learning denoising from single noisy images. <italic>2019 IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR)</italic>, p. 2129–2137 (IEEE, 2019).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Greenwald</surname>
            <given-names>NF</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Whole-cell segmentation of tissue images with human-level performance using large-scale data annotation and deep learning</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>555</fpage>
        <lpage>565</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01094-0</pub-id>
        <?supplied-pmid 34795433?>
        <pub-id pub-id-type="pmid">34795433</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schapiro</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MCMICRO: A scalable, modular image-processing pipeline for multiplexed tissue imaging</article-title>
        <source>Nat. Methods</source>
        <year>2022</year>
        <volume>19</volume>
        <fpage>311</fpage>
        <lpage>315</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01308-y</pub-id>
        <?supplied-pmid 34824477?>
        <pub-id pub-id-type="pmid">34824477</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Anscombe</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>The transformation of poisson, binomial and negative-binomial data</article-title>
        <source>Biometrika</source>
        <year>1948</year>
        <volume>35</volume>
        <fpage>246</fpage>
        <lpage>254</lpage>
        <pub-id pub-id-type="doi">10.1093/biomet/35.3-4.246</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <mixed-citation publication-type="other">Russell, M. F. T. B. C. &amp; Freeman, W. T. Exploiting the sparse derivative prior for super-resolution and image demosaicing. IEEE <italic>SCTV</italic>, p. 1–28 (Institute of Electrical and Electronics Engineers (IEEE), 2003).</mixed-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <mixed-citation publication-type="other">Silverman, B. W. <italic>Density Estimation For Statistics And Data Analysis</italic> (Routledge, 2018).</mixed-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Makitalo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Foi</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Optimal inversion of the Anscombe transformation in low-count Poisson image denoising</article-title>
        <source>IEEE Trans. Image Process.</source>
        <year>2010</year>
        <volume>20</volume>
        <fpage>99</fpage>
        <lpage>109</lpage>
        <pub-id pub-id-type="doi">10.1109/TIP.2010.2056693</pub-id>
        <?supplied-pmid 20615809?>
        <pub-id pub-id-type="pmid">20615809</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Garnett</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Huegerich</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Chui</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>He</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>A universal noise removal algorithm with an impulse detector</article-title>
        <source>IEEE Trans. Image Process.</source>
        <year>2005</year>
        <volume>11</volume>
        <fpage>1747</fpage>
        <lpage>1754</lpage>
        <pub-id pub-id-type="doi">10.1109/TIP.2005.857261</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dong</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Chan</surname>
            <given-names>RH</given-names>
          </name>
          <name>
            <surname>Xu</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>A detection statistic for random-valued impulse noise</article-title>
        <source>IEEE Trans. Image Process.</source>
        <year>2007</year>
        <volume>16</volume>
        <fpage>1112</fpage>
        <lpage>1120</lpage>
        <pub-id pub-id-type="doi">10.1109/TIP.2006.891348</pub-id>
        <?supplied-pmid 17405441?>
        <pub-id pub-id-type="pmid">17405441</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finesso</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Spreij</surname>
            <given-names>P</given-names>
          </name>
        </person-group>
        <article-title>Nonnegative matrix factorization and I-divergence alternating minimization</article-title>
        <source>Linear Algebra Appl.</source>
        <year>2006</year>
        <volume>416</volume>
        <fpage>270</fpage>
        <lpage>287</lpage>
        <pub-id pub-id-type="doi">10.1016/j.laa.2005.11.012</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Weigert</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Content-aware image restoration: pushing the limits of fluorescence microscopy</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1090</fpage>
        <lpage>1097</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0216-7</pub-id>
        <?supplied-pmid 30478326?>
        <pub-id pub-id-type="pmid">30478326</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Xie</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Ji</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>Global voxel transformer networks for augmented microscopy</article-title>
        <source>Nat. Mach. Intell.</source>
        <year>2021</year>
        <volume>3</volume>
        <fpage>161</fpage>
        <lpage>171</lpage>
        <pub-id pub-id-type="doi">10.1038/s42256-020-00283-x</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Three-dimensional residual channel attention networks denoise and sharpen fluorescence microscopy image volumes</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>678</fpage>
        <lpage>687</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01155-x</pub-id>
        <?supplied-pmid 34059829?>
        <pub-id pub-id-type="pmid">34059829</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <mixed-citation publication-type="other">Lehtinen, J. et al. Noise2Noise: Learning image restoration without clean data. <italic>Proceedings of the 35th International Conference on Machine Learning</italic>, p. 4620–4631 (Machine Learning Research Press, 2018).</mixed-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Batson, J. &amp; Royer, L. Noise2self: Blind denoising by self-supervision. <italic>Proceedings of Machine Learning Research,</italic> p. 524–533 (Machine Learning Research Press, 2019).</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <mixed-citation publication-type="other">Ronneberger, O., Fischer, P. &amp; Brox, T. U-net: convolutional networks for biomedical image segmentation. <italic>Medical Image Computing and Computer-Assisted Intervention</italic>, p. 234–241 (Springer, 2015).</mixed-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <mixed-citation publication-type="other">He, K., Zhang, X., Ren, S. &amp; Sun, J. Identity mappings in deep residual networks. In <italic>Computer Vision – ECCV 2016. Lecture Notes in Computer Science</italic>, (eds Leibe, B., Matas, J., Sebe, N. &amp; Welling, M.) Vol 9908 p. 630–645 (Springer, Cham., 2016) 10.1007/978-3-319-46493-0_38.</mixed-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lu</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Blind image restoration enhances digital autoradiographic imaging of radiopharmaceutical tissue distribution</article-title>
        <source>J. Nucl. Med.</source>
        <year>2022</year>
        <volume>63</volume>
        <fpage>591</fpage>
        <lpage>597</lpage>
        <pub-id pub-id-type="doi">10.2967/jnumed.121.262270</pub-id>
        <pub-id pub-id-type="pmid">34385337</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Huang</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast, long-term, super-resolution imaging with hessian structured illumination microscopy</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>451</fpage>
        <lpage>459</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4115</pub-id>
        <?supplied-pmid 29644998?>
        <pub-id pub-id-type="pmid">29644998</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zhao</surname>
            <given-names>W</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Sparse deconvolution improves the resolution of live-cell super-resolution fluorescence microscopy</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>606</fpage>
        <lpage>617</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01092-2</pub-id>
        <?supplied-pmid 34782739?>
        <pub-id pub-id-type="pmid">34782739</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rashid</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Highly multiplexed immunofluorescence images and single-cell data of immune markers in tonsil and lung cancer</article-title>
        <source>Sci. Data</source>
        <year>2019</year>
        <volume>6</volume>
        <fpage>1</fpage>
        <lpage>10</lpage>
        <pub-id pub-id-type="doi">10.1038/s41597-019-0332-y</pub-id>
        <pub-id pub-id-type="pmid">30647409</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>Z</given-names>
          </name>
          <name>
            <surname>Bovik</surname>
            <given-names>AC</given-names>
          </name>
          <name>
            <surname>Sheikh</surname>
            <given-names>HR</given-names>
          </name>
          <name>
            <surname>Simoncelli</surname>
            <given-names>EP</given-names>
          </name>
        </person-group>
        <article-title>Image quality assessment: from error visibility to structural similarity</article-title>
        <source>IEEE Trans. Image Process.</source>
        <year>2004</year>
        <volume>13</volume>
        <fpage>600</fpage>
        <lpage>612</lpage>
        <pub-id pub-id-type="doi">10.1109/TIP.2003.819861</pub-id>
        <?supplied-pmid 15376593?>
        <pub-id pub-id-type="pmid">15376593</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Levine</surname>
            <given-names>JH</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Data-driven phenotypic dissection of aml reveals progenitor-like cells that correlate with prognosis</article-title>
        <source>Cell</source>
        <year>2015</year>
        <volume>162</volume>
        <fpage>184</fpage>
        <lpage>197</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2015.05.047</pub-id>
        <?supplied-pmid 26095251?>
        <pub-id pub-id-type="pmid">26095251</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Traag</surname>
            <given-names>VA</given-names>
          </name>
          <name>
            <surname>Waltman</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Van Eck</surname>
            <given-names>NJ</given-names>
          </name>
        </person-group>
        <article-title>From Louvain to Leiden: guaranteeing well-connected communities</article-title>
        <source>Sci. Rep.</source>
        <year>2019</year>
        <volume>9</volume>
        <fpage>1</fpage>
        <lpage>12</lpage>
        <pub-id pub-id-type="doi">10.1038/s41598-019-41695-z</pub-id>
        <pub-id pub-id-type="pmid">30626917</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Linderman</surname>
            <given-names>GC</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fast interpolation-based t-SNE for improved visualization of single-cell RNA-seq data</article-title>
        <source>Nat. Methods</source>
        <year>2019</year>
        <volume>16</volume>
        <fpage>243</fpage>
        <lpage>245</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0308-4</pub-id>
        <?supplied-pmid 30742040?>
        <pub-id pub-id-type="pmid">30742040</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chou</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CD169+ macrophages provide a niche promoting erythropoiesis under homeostasis and stress</article-title>
        <source>Nat. Med.</source>
        <year>2013</year>
        <volume>19</volume>
        <fpage>429</fpage>
        <lpage>436</lpage>
        <pub-id pub-id-type="doi">10.1038/nm.3057</pub-id>
        <pub-id pub-id-type="pmid">23502962</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Williams</surname>
            <given-names>P</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The distribution of T-cell subsets and the expression of immune checkpoint receptors and ligands in patients with newly diagnosed and relapsed acute myeloid leukemia</article-title>
        <source>Cancer</source>
        <year>2019</year>
        <volume>125</volume>
        <fpage>1470</fpage>
        <lpage>1481</lpage>
        <pub-id pub-id-type="doi">10.1002/cncr.31896</pub-id>
        <?supplied-pmid 30500073?>
        <pub-id pub-id-type="pmid">30500073</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <mixed-citation publication-type="other">Chollet, F. Keras. <italic>GitHub</italic><ext-link ext-link-type="uri" xlink:href="https://github.com/fchollet/keras">https://github.com/fchollet/keras</ext-link> (2015).</mixed-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <mixed-citation publication-type="other">Kingma, D. P. &amp; Adam, J. Ba. Adam: A method for stochastic optimization. Preprint at arXiv <ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1412.6980">https://arxiv.org/abs/1412.6980</ext-link> (2014).</mixed-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <mixed-citation publication-type="other">Sommer, C., Straehle, C., Koethe, U. &amp; Hamprecht, F. A. Ilastik: Interactive learning and segmentation toolkit. <italic>ISBI</italic>, p. 230–233 (2011).</mixed-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kamentsky</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Improved structure, function and compatibility for CellProfiler: modular high-throughput image analysis software</article-title>
        <source>Bioinformatics</source>
        <year>2011</year>
        <volume>27</volume>
        <fpage>1179</fpage>
        <lpage>1180</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btr095</pub-id>
        <?supplied-pmid 21349861?>
        <pub-id pub-id-type="pmid">21349861</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schapiro</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>histoCAT: analysis of cell phenotypes and interactions in multiplex image cytometry data</article-title>
        <source>Nat. Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>873</fpage>
        <lpage>876</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4391</pub-id>
        <?supplied-pmid 28783155?>
        <pub-id pub-id-type="pmid">28783155</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pedregosa</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scikit-learn: machine learning in Python</article-title>
        <source>JMLR</source>
        <year>2011</year>
        <volume>12</volume>
        <fpage>2825</fpage>
        <lpage>2830</lpage>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Davies</surname>
            <given-names>DL</given-names>
          </name>
          <name>
            <surname>Bouldin</surname>
            <given-names>DW</given-names>
          </name>
        </person-group>
        <article-title>A cluster separation measure</article-title>
        <source>IEEE Trans. Pattern Anal. Mach. Intell.</source>
        <year>1979</year>
        <volume>2</volume>
        <fpage>224</fpage>
        <lpage>227</lpage>
        <pub-id pub-id-type="doi">10.1109/TPAMI.1979.4766909</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hickey</surname>
            <given-names>JW</given-names>
          </name>
          <name>
            <surname>Tan</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Nolan</surname>
            <given-names>GP</given-names>
          </name>
          <name>
            <surname>Goltsev</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Strategies for accurate cell type identification in CODEX multiplexed imaging data</article-title>
        <source>Front. Immunol.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>727626</fpage>
        <lpage>727639</lpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2021.727626</pub-id>
        <?supplied-pmid 34484237?>
        <pub-id pub-id-type="pmid">34484237</pub-id>
      </element-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schindelin</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Fiji: an open-source platform for biological-image analysis</article-title>
        <source>Nat. Methods</source>
        <year>2012</year>
        <volume>9</volume>
        <fpage>676</fpage>
        <lpage>682</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.2019</pub-id>
        <?supplied-pmid 22743772?>
        <pub-id pub-id-type="pmid">22743772</pub-id>
      </element-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <mixed-citation publication-type="other">Lu, P. et al. Human bone marrow IMC dataset and simulation dataset. <italic>Zenodo</italic>10.5281/zenodo.6533905 (2022).</mixed-citation>
    </ref>
    <ref id="CR61">
      <label>61.</label>
      <mixed-citation publication-type="other">Lu, P. et al. Results of IMC-Denoise: a content aware pipeline to enhance Imaging Mass Cytometry. <italic>Zenodo</italic>10.5281/zenodo.7336448 (2022).</mixed-citation>
    </ref>
    <ref id="CR62">
      <label>62.</label>
      <mixed-citation publication-type="other">Lu, P. et al. IMC-Denoise: a content aware denoising pipeline to enhance Imaging Mass Cytometry. <italic>Zenodo</italic>10.5281/zenodo.7559428 (2023).</mixed-citation>
    </ref>
  </ref-list>
</back>
