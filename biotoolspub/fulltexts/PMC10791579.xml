<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats">
  <restricted-by>pmc</restricted-by>
</processing-meta>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Nat Biotechnol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Nat Biotechnol</journal-id>
    <journal-title-group>
      <journal-title>Nature Biotechnology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1087-0156</issn>
    <issn pub-type="epub">1546-1696</issn>
    <publisher>
      <publisher-name>Nature Publishing Group US</publisher-name>
      <publisher-loc>New York</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">10791579</article-id>
    <article-id pub-id-type="pmid">37055623</article-id>
    <article-id pub-id-type="publisher-id">1734</article-id>
    <article-id pub-id-type="doi">10.1038/s41587-023-01734-7</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Article</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Dandelion uses the single-cell adaptive immune receptor repertoire to explore lymphocyte developmental origins</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Suo</surname>
          <given-names>Chenqu</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-2586-9576</contrib-id>
        <name>
          <surname>Polanski</surname>
          <given-names>Krzysztof</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7400-7438</contrib-id>
        <name>
          <surname>Dann</surname>
          <given-names>Emma</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3660-504X</contrib-id>
        <name>
          <surname>Lindeboom</surname>
          <given-names>Rik G. H.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Vilarrasa-Blasi</surname>
          <given-names>Roser</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9870-8474</contrib-id>
        <name>
          <surname>Vento-Tormo</surname>
          <given-names>Roser</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Haniffa</surname>
          <given-names>Muzlifah</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff3">3</xref>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5906-1498</contrib-id>
        <name>
          <surname>Meyer</surname>
          <given-names>Kerstin B.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-2873-6787</contrib-id>
        <name>
          <surname>Dratva</surname>
          <given-names>Lisa M.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6735-6808</contrib-id>
        <name>
          <surname>Tuong</surname>
          <given-names>Zewen Kelvin</given-names>
        </name>
        <address>
          <email>z.tuong@uq.edu.au</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff8">8</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-3340-9828</contrib-id>
        <name>
          <surname>Clatworthy</surname>
          <given-names>Menna R.</given-names>
        </name>
        <address>
          <email>mrc38@cam.ac.uk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6294-6366</contrib-id>
        <name>
          <surname>Teichmann</surname>
          <given-names>Sarah A.</given-names>
        </name>
        <address>
          <email>st9@sanger.ac.uk</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05cy4wa09</institution-id><institution-id institution-id-type="GRID">grid.10306.34</institution-id><institution-id institution-id-type="ISNI">0000 0004 0606 5382</institution-id><institution>Wellcome Sanger Institute, </institution><institution>Wellcome Genome Campus, </institution></institution-wrap>Cambridge, UK </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.24029.3d</institution-id><institution-id institution-id-type="ISNI">0000 0004 0383 8386</institution-id><institution>Department of Paediatrics, </institution><institution>Cambridge University Hospitals, </institution></institution-wrap>Cambridge, UK </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/01kj2bm70</institution-id><institution-id institution-id-type="GRID">grid.1006.7</institution-id><institution-id institution-id-type="ISNI">0000 0001 0462 7212</institution-id><institution>Biosciences Institute, </institution><institution>Newcastle University, </institution></institution-wrap>Newcastle upon Tyne, UK </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/05p40t847</institution-id><institution-id institution-id-type="GRID">grid.420004.2</institution-id><institution-id institution-id-type="ISNI">0000 0004 0444 2244</institution-id><institution>Department of Dermatology and NIHR Newcastle Biomedical Research Centre, </institution><institution>Newcastle upon Tyne Hospitals NHS Foundation Trust, </institution></institution-wrap>Newcastle upon Tyne, UK </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/013meh722</institution-id><institution-id institution-id-type="GRID">grid.5335.0</institution-id><institution-id institution-id-type="ISNI">0000 0001 2188 5934</institution-id><institution>Molecular Immunity Unit, Department of Medicine, </institution><institution>University of Cambridge, </institution></institution-wrap>Cambridge, UK </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/00rqy9422</institution-id><institution-id institution-id-type="GRID">grid.1003.2</institution-id><institution-id institution-id-type="ISNI">0000 0000 9320 7537</institution-id><institution>Frazer Institute, Faculty of Medicine, </institution><institution>The University of Queensland, </institution></institution-wrap>Brisbane, Queensland Australia </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/013meh722</institution-id><institution-id institution-id-type="GRID">grid.5335.0</institution-id><institution-id institution-id-type="ISNI">0000 0001 2188 5934</institution-id><institution>Theory of Condensed Matter, Cavendish Laboratory, Department of Physics, </institution><institution>University of Cambridge, </institution></institution-wrap>Cambridge, UK </aff>
      <aff id="Aff8"><label>8</label><institution-wrap><institution-id institution-id-type="ROR">https://ror.org/00rqy9422</institution-id><institution-id institution-id-type="GRID">grid.1003.2</institution-id><institution-id institution-id-type="ISNI">0000 0000 9320 7537</institution-id><institution>Present Address: Ian Frazer Centre for Children’s Immunotherapy Research, Child Health Research Centre, Faculty of Medicine, </institution><institution>The University of Queensland, </institution></institution-wrap>Brisbane, Queensland Australia </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>13</day>
      <month>4</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>13</day>
      <month>4</month>
      <year>2023</year>
    </pub-date>
    <pub-date pub-type="ppub">
      <year>2024</year>
    </pub-date>
    <volume>42</volume>
    <issue>1</issue>
    <fpage>40</fpage>
    <lpage>51</lpage>
    <history>
      <date date-type="received">
        <day>18</day>
        <month>11</month>
        <year>2022</year>
      </date>
      <date date-type="accepted">
        <day>7</day>
        <month>3</month>
        <year>2023</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2023</copyright-statement>
      <license>
        <ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
        <license-p><bold>Open Access</bold> This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The images or other third party material in this article are included in the article’s Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the article’s Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this license, visit <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Assessment of single-cell gene expression (single-cell RNA sequencing) and adaptive immune receptor (AIR) sequencing (scVDJ-seq) has been invaluable in studying lymphocyte biology. Here we introduce Dandelion, a computational pipeline for scVDJ-seq analysis. It enables the application of standard V(D)J analysis workflows to single-cell datasets, delivering improved V(D)J contig annotation and the identification of nonproductive and partially spliced contigs. We devised a strategy to create an AIR feature space that can be used for both differential V(D)J usage analysis and pseudotime trajectory inference. The application of Dandelion improved the alignment of human thymic development trajectories of double-positive T cells to mature single-positive CD4/CD8 T cells, generating predictions of factors regulating lineage commitment. Dandelion analysis of other cell compartments provided insights into the origins of human B1 cells and ILC/NK cell development, illustrating the power of our approach. Dandelion is available at <ext-link ext-link-type="uri" xlink:href="https://www.github.com/zktuong/dandelion">https://www.github.com/zktuong/dandelion</ext-link>.</p>
    </abstract>
    <abstract id="Abs2" abstract-type="web-summary">
      <p id="Par2">A computational pipeline enables differential V(D)J usage analysis and pseudotime trajectory inference from single-cell AIR sequencing.</p>
    </abstract>
    <kwd-group kwd-group-type="npg-subject">
      <title>Subject terms</title>
      <kwd>Computational biology and bioinformatics</kwd>
      <kwd>Immunology</kwd>
    </kwd-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100004440</institution-id>
            <institution>Wellcome Trust (Wellcome)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>WT107931/Z/15/Z</award-id>
        <award-id>108413/A/15/D</award-id>
        <award-id>WT206194</award-id>
        <award-id>WT211276/Z/18/Z</award-id>
        <award-id>220268/Z/20/Z</award-id>
        <award-id>WT211276/Z/18/Z</award-id>
        <award-id>108413/A/15/D</award-id>
        <award-id>WT206194</award-id>
        <principal-award-recipient>
          <name>
            <surname>Haniffa</surname>
            <given-names>Muzlifah</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>Kerstin B.</given-names>
          </name>
          <name>
            <surname>Clatworthy</surname>
            <given-names>Menna R.</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>Sarah A.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/501100000265</institution-id>
            <institution>RCUK | Medical Research Council (MRC)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>MR/S035907/1</award-id>
        <award-id>MR/S035842/1</award-id>
        <principal-award-recipient>
          <name>
            <surname>Meyer</surname>
            <given-names>Kerstin B.</given-names>
          </name>
          <name>
            <surname>Clatworthy</surname>
            <given-names>Menna R.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">https://doi.org/10.13039/100010663</institution-id>
            <institution>EC | EU Framework Programme for Research and Innovation H2020 | H2020 Priority Excellent Science | H2020 European Research Council (H2020 Excellent Science - European Research Council)</institution>
          </institution-wrap>
        </funding-source>
        <award-id>646794</award-id>
        <principal-award-recipient>
          <name>
            <surname>Teichmann</surname>
            <given-names>Sarah A.</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© Springer Nature America, Inc. 2024</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Main</title>
    <p id="Par3">Single-cell genomics has advanced our understanding of human immunology<sup><xref ref-type="bibr" rid="CR1">1</xref>,<xref ref-type="bibr" rid="CR2">2</xref></sup>. Paired adaptive immune receptor (AIR) sequencing with mRNA expression in the same cell allows for direct linkage of AIR repertoire with cellular phenotypes, which is a powerful way to understand lymphocyte development and function<sup><xref ref-type="bibr" rid="CR3">3</xref>–<xref ref-type="bibr" rid="CR6">6</xref></sup>.</p>
    <p id="Par4">Multi-omics analysis has enabled the study of cellular biology across data modalities at an unprecedented resolution. This includes the integration of paired single-cell RNA sequencing (scRNA-seq) and assay for transposase-accessible chromatin with high-throughput sequencing data or cellular indexing of transcriptomes and epitopes by sequencing data<sup><xref ref-type="bibr" rid="CR7">7</xref>,<xref ref-type="bibr" rid="CR8">8</xref></sup>. However, unlike these modalities, which largely consist of continuous data, AIR data consist of a mixture of categorical and continuous data, posing additional challenges for integration. This includes annotations of variable (V), diversity (D) and joining (J) genes, which are recombined and selected during B/T cell development<sup><xref ref-type="bibr" rid="CR9">9</xref></sup>. The Adaptive Immune Receptor Repertoire (AIRR) community was formed in 2015 to help address challenges related to AIR data analysis<sup><xref ref-type="bibr" rid="CR10">10</xref>–<xref ref-type="bibr" rid="CR12">12</xref></sup>. This has led to the standardization of repertoire data representation across AIR analysis domains. There are established packages that can deal with single-cell AIR repertoire data and they provide a variety of methods for downstream analyses (nonexhaustive list of popular tools is shown in Extended Data Fig. <xref rid="Fig6" ref-type="fig">1</xref>). The functions include re-annotation of AIR genes, quality control checks, matching contigs to cells, clonotype definition, mutation quantification, diversity estimation and many more (Extended Data Fig. <xref rid="Fig6" ref-type="fig">1</xref>). Single-cell AIR software are often designed to interact with a companion single-cell gene expression software, for example, scirpy<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> with scanpy<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> and scRepertoire<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> with Seurat<sup><xref ref-type="bibr" rid="CR16">16</xref></sup>, providing valuable analysis and visualization options. There are also tools for predicting antigen specificity of T cell receptors (TCRs; for example, TcellMatch<sup><xref ref-type="bibr" rid="CR17">17</xref></sup>), annotating TCRs with epitopes (for example, Platypus<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> and Immunarch<sup><xref ref-type="bibr" rid="CR19">19</xref></sup>) and extraction of significant motifs and motif groups (for example, ALICE<sup><xref ref-type="bibr" rid="CR20">20</xref></sup>). Tools for joint embedding of single-cell gene expression and AIR complementarity-determining region 3 (CDR3) sequences have also been developed (for example, CoNGA<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> and mvTCR<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>). There remain opportunities for new methods to realize the full potential of paired scRNA-seq and scVDJ-seq data.</p>
    <p id="Par5">To that end, we developed Dandelion, a holistic analysis framework for understanding single-cell lymphocyte biology. It offers a B cell receptor (BCR) and TCR contig annotation pipeline, integrative analysis with single-cell RNA-seq data and a V(D)J feature space for differential V(D)J usage and pseudotime trajectory inference. Here using two immune development datasets, we showcase how Dandelion can improve the alignment of cells along T cell development trajectory and provide insights into human B1 cell origin and innate lymphoid cell (ILC) and natural killer (NK) cell development.</p>
  </sec>
  <sec id="Sec2" sec-type="results">
    <title>Results</title>
    <sec id="Sec3">
      <title>Dandelion enables holistic scVDJ-seq analysis</title>
      <p id="Par6">As Dandelion operates on the AIRR data format, it is highly interoperable with existing AIRR tools<sup><xref ref-type="bibr" rid="CR13">13</xref>,<xref ref-type="bibr" rid="CR23">23</xref></sup>. It can serve as a bridge between the various tools for AIRR analysis and the single-cell software ecosystem, for example, scverse<sup><xref ref-type="bibr" rid="CR14">14</xref>,<xref ref-type="bibr" rid="CR24">24</xref></sup> (Fig. <xref rid="Fig1" ref-type="fig">1a</xref>). Dandelion has been certified by the AIRR Software Working Group to be AIRR standards compliant.<fig id="Fig1"><label>Fig. 1</label><caption><title>Holistic scVDJ-seq analysis pipeline.</title><p><bold>a</bold>, Schematic illustration showing that Dandelion bridges methods from single-cell V(D)J workflows, such as AIRR standards and the single-cell gene expression analysis software, and combines with them additional new methods of its own to create a holistic pipeline for analysis. <bold>b</bold>, Schematic illustration of the Dandelion workflow. Paired single-cell gene expression (scRNA-seq) and AIR repertoire (scVDJ-seq) data are generated, followed by mapping of the sequencing reads. From the mapped results, Dandelion provides refined contig annotations with BCR mutation calling, improved γδTCR mapping and identification of multi-J mapping contigs. It also provides downstream analysis after integration with scRNA-seq results. Apart from allowing the users to explore clonotype networks and V(D)J usage, Dandelion also supports building a V(D)J feature space on pseudobulked cells, that can be used for differential V(D)J usage and pseudotime inference. Additional unique features provided by Dandelion are boxed in orange.</p></caption><graphic xlink:href="41587_2023_1734_Fig1_HTML" id="d32e495"/></fig></p>
      <p id="Par7">Dandelion can be used to analyze single-cell BCR, αβTCR and γδTCR data, allowing for mutation calling, improved γδTCR annotation, analysis of productive and nonproductive V(D)J contigs and identification of unspliced <italic>J</italic> gene alignments (Fig. <xref rid="Fig1" ref-type="fig">1b</xref>). Dandelion performs quality control checks, clonotype calling and network generation for downstream analyses. It is designed to work with AIRR-formatted input or 10X Genomics’ cellranger vdj output. A main feature of Dandelion is the creation of a ‘V(D)J feature space’ that can be used to perform and visualize differential TCR/BCR usage across cell pseudo-bulks or neighborhoods and infer pseudotime trajectory inference. Extended Data Fig. <xref rid="Fig6" ref-type="fig">1</xref> shows a summary of features in Dandelion and other pipelines. Dandelion was previously applied to a large COVID-19 study<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>, which showcased its network-based repertoire diversity analysis method.</p>
    </sec>
    <sec id="Sec4">
      <title>Dandelion provides a streamlined preprocessing pipeline</title>
      <p id="Par8">For optional re-annotation of contigs, Dandelion expects 10X Genomics’ cellranger vdj output files (for example, all_contig_annotations.csv and all_contig.fasta).</p>
      <p id="Par9">Similar to Change-O<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>, Dandelion re-annotates V(D)J contigs using igblastn<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> with reference sequences contained in the international ImMunoGeneTics information system (IMGT) database<sup><xref ref-type="bibr" rid="CR26">26</xref></sup>. blastn is also used to check the <italic>D</italic> and <italic>J</italic> genes separately (same settings as igblastn<sup><xref ref-type="bibr" rid="CR25">25</xref></sup>. The additional blastn step allows us to (1) apply an <italic>e</italic>-value cutoff for D/J calls to only retain high confidence calls; (2) identify ‘multi-J mapping’ contigs (see below) and (3) recover contigs without <italic>V</italic> gene calls (removed by igblastn). We packaged this preprocessing workflow into a singularity container to streamline and improve the user experience and avoid the difficulties with setting up the pipeline.</p>
      <p id="Par10">Nonproductive contigs do not translate into functional proteins and are often filtered out by other scVDJ-seq analysis pipelines, for example, scirpy<sup><xref ref-type="bibr" rid="CR13">13</xref></sup>, scRepertoire<sup><xref ref-type="bibr" rid="CR15">15</xref></sup> and Platypus<sup><xref ref-type="bibr" rid="CR18">18</xref></sup> (Extended Data Fig. <xref rid="Fig6" ref-type="fig">1</xref>). In the Immcantation<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> workflow, nonproductive contigs are preserved and there are specific instructions for filtering or retention during annotation and clone definition steps. Moreover, igblastn is a <italic>V</italic> gene annotation tool<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> and would filter contigs without <italic>V</italic> gene. We found that a significant proportion of αβTCR, γδTCR and BCR data were nonproductive in fetal human tissues<sup><xref ref-type="bibr" rid="CR3">3</xref></sup> and the majority were due to absent <italic>V</italic> genes, with the exception of the TRA locus where most were due to presence of premature stop codons (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>). This pattern was consistent even after excluding thymic samples to account for developing T cells (Extended Data Fig. <xref rid="Fig7" ref-type="fig">2a</xref>). These nonproductive contigs without <italic>V</italic> genes were captured in scVDJ-seq because the rapid amplification of 5′ complementary DNA (cDNA) ends (5′ RACE) technology used in the protocol does not require primers against <italic>V</italic> genes for targeted enrichment, in contrast to the previous multiplex PCR approach (Extended Data Fig. <xref rid="Fig7" ref-type="fig">2b</xref>). They likely represent products of partial or failed recombination and we reasoned that they are still biologically meaningful, reflecting a cell’s history and origin. The Immcantation workflow would divert these contigs into a ‘failed’ file and this file is not typically exposed to the user. Therefore, Dandelion does not automatically filter out nonproductive contigs, and this data have utility, as later discussed.<fig id="Fig2"><label>Fig. 2</label><caption><title>Dandelion offers improved contig annotations.</title><p><bold>a</bold>, Left—barplot of proportion of contigs that are productive or nonproductive in each locus. Right—barplot showing the causes of nonproductive contigs in each locus. <bold>b</bold>, Schematic illustration of the V(D)J rearrangement process and the potential cause of multi-J mapping. <bold>c</bold>, Boxplot of the proportion of contigs with multi-J mapping, in the presence (blue) or absence (orange) of <italic>V</italic> genes. Only samples with at least ten contigs are shown. Boxes capture the first to third quartiles and whisks span a further 1.5× interquartile range on each side of the box (two-sided Wilcoxon rank-sum test). The sample sizes of all boxplots from left to right are 51, 46, 52, 55, 26, 29, 20, 29, 33, 27, 33, 29, 34 and 25. <bold>d</bold>, Top—logistic regression formula to explore factors associated with multi-J mapping. Bottom—volcano plot summarizing logistic regression results (ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup>); <italic>y</italic> axis: −log<sub>10</sub>(BH adjusted <italic>P</italic> value); <italic>x</italic> axis: log(odds ratio). Variables that were also significant in our control/cycloheximide-treated PBMC dataset are highlighted in red (associated with increased multi-J mapping) or blue (associated with decreased multi-J mapping). <bold>e</bold>, Sequence logos covering the last 11 and first 10 nucleotides at 3′ ends (position 1–11) and the neighboring intron (position 12–21), respectively, for genes associated with increased (top) or decreased (bottom) multi-J mapping. <italic>J</italic> genes associated with increased multi-J mapping were less likely to have T in position 17 (logistic regression; two-tailed <italic>P</italic> value). ‘GTAAGT’ is a known consensus motif for splicing in position 12–17 that is +1 to +6 in the intron. They were also more likely to have T in position 6 (logistic regression; two-tailed <italic>P</italic> value). <bold>f</bold>, Swarmplots of fraction difference of sc-γδTCR contigs (<italic>n</italic> = 33) annotated by Dandelion versus 10X cellranger vdj (v6.1.2). The red dashed line marks the threshold of 0, above which Dandelion recovers more γδTCR contigs than 10X. Left—all high confidence contigs. Right—high confidence productive contigs. Data for <bold>a</bold>, <bold>c</bold>, <bold>d</bold> (bottom) and <bold>f</bold> were taken from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup> and each dot represents a sample.</p></caption><graphic xlink:href="41587_2023_1734_Fig2_HTML" id="d32e675"/></fig></p>
      <p id="Par11">We also discovered that multiple <italic>J</italic> genes can be sequentially mapped onto different regions in the same mRNA contig, a phenomenon we termed ‘multi-J mapping’. We found that the majority of the most frequent multi-J mapping contigs contained two to four neighboring <italic>J</italic> genes interspersed with introns (Supplementary Table <xref rid="MOESM3" ref-type="media">1</xref>). As RNA splicing, rather than DNA recombination, is the process of linking the chosen <italic>J</italic> to <italic>C</italic> genes, contigs with multi-J mapping are likely products of partially spliced transcripts (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). It is biologically plausible that the <italic>J</italic> gene nearest to the 5′ end is the intended exon that would be expressed in the mature mRNA.</p>
      <p id="Par12">We next investigated factors that might contribute to multi-J mapping. We first noted that nonproductive contigs without <italic>V</italic> genes were more likely to have multi-J mapping (Fig. <xref rid="Fig2" ref-type="fig">2c</xref>). This difference could be due to nonsense-mediated decay (NMD), an RNA degradation process that is triggered due to premature stop codons<sup><xref ref-type="bibr" rid="CR27">27</xref></sup>. Multi-J mapping contigs containing a <italic>V</italic> gene will initiate translation from the <italic>V</italic> gene, triggering degradation by NMD due to premature stop codons in <italic>J</italic> gene introns, whereas those without a <italic>V</italic> gene cannot be translated and will therefore evade degradation by NMD. To test the contribution of NMD to multi-J mapping, we analyzed peripheral blood mononuclear cells (PBMCs) treated with cycloheximide against control cells. Treatment resulted in an increase in the proportion of multi-J mapping in TCR contigs with <italic>V</italic> genes (Extended Data Fig. <xref rid="Fig7" ref-type="fig">2c</xref>), supporting that NMD recognizes and degrades <italic>V</italic>-gene-containing multi-J mapping contigs.</p>
      <p id="Par13">Using a logistic regression model, we found that there was a significant interaction (Benjamini–Hochberg (BH) adjusted <italic>P</italic> = 7.07 × 10<sup>−4</sup>) between <italic>V</italic> gene presence and cycloheximide treatment on multi-J mapping (Fig. <xref rid="Fig2" ref-type="fig">2d</xref>; ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup>; Supplementary Table <xref rid="MOESM3" ref-type="media">2</xref>, cycloheximide treatment, and Supplementary Table <xref rid="MOESM3" ref-type="media">3</xref>), supporting the above findings. However, the significant noninteracting <italic>V</italic> gene term (BH adjusted <italic>P</italic> = 5.73 × 10<sup>−182</sup>) suggests that NMD may only partially account for the effect of <italic>V</italic> genes on multi-J mapping. Furthermore, we found that the known consensus motif for splicing, ‘GTAAGT’ in +1 to +6 position of adjacent intron<sup><xref ref-type="bibr" rid="CR28">28</xref></sup>, was disrupted in <italic>J</italic> genes associated with more multi-J mapping (Fig. <xref rid="Fig2" ref-type="fig">2e</xref> and Supplementary Table <xref rid="MOESM3" ref-type="media">4</xref>). In conclusion, specific cell types, <italic>J</italic> gene identity, <italic>V</italic> gene presence and NMD are factors that may contribute to multi-J mapping (Extended Data Fig. <xref rid="Fig7" ref-type="fig">2d</xref>).</p>
      <p id="Par14">Dandelion also performs γδTCR contig annotation. There are two existing methods for sc-γδTCR mapping as follows: (1) 10X Genomics’ cellranger vdj, (primarily tailored for αβTCR contigs); (2) <italic>TRUST4</italic> (ref. <sup><xref ref-type="bibr" rid="CR29">29</xref></sup>), which performs de novo contig assembly and annotation. The cellranger software can reconstruct γδTCR contigs but most versions struggle with annotating them (Supplementary <xref rid="MOESM1" ref-type="media">Note</xref>). While TRUST4 can yield sc-TCR annotations, including γδTCR, it relies on the presence of a <italic>V</italic> gene in the contig thus unable to handle nonproductive contigs without <italic>V</italic> genes. For comparisons, we processed 33 γδTCR libraries<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>; one mapping was done with cellranger 6.1.2 to the 10X GRCh38 5.0.0V(D)J reference, with the contigs identified by cellranger as high confidence subsequently re-annotated with Dandelion. Another mapping was done with cellranger 6.1.2 to the 5.0.0 reference modified to obtain annotated γδTCR contigs as per 10X Genomics’ workaround instructions. We see a consistently higher recovery rate of both high confidence γδTCR contigs and high confidence productive γδTCR contigs in the mapping postprocessed with Dandelion (high confidence contigs: <italic>P</italic> = 5.39 × 10<sup>−7</sup>, high confidence productive contigs: <italic>P</italic> = 3.14 × 10<sup>−6</sup>, Wilcoxon signed-rank test; rank correlations were 1 and 0.98, respectively; Fig. <xref rid="Fig2" ref-type="fig">2f</xref>). While 10X Genomics has introduced some γδTCR support with cellranger 7.0.0, the results were inferior to the prior workaround from version 6 (Extended Data Fig. <xref rid="Fig7" ref-type="fig">2e</xref>).</p>
    </sec>
    <sec id="Sec5">
      <title>Creating a V(D)J feature space</title>
      <p id="Par15">To better leverage the combined gene expression and AIR repertoire data, we introduced an analysis strategy to create a pseudobulked V(D)J feature space, transforming V(D)J data from categorical to continuous format for downstream applications (Fig. <xref rid="Fig3" ref-type="fig">3a</xref>). Transcriptionally similar cells are first grouped into pseudo-bulks, which can be based on metadata features, or partially overlapping cell neighborhoods<sup><xref ref-type="bibr" rid="CR30">30</xref></sup>. For instance, cells can be pseudobulked by cell type, donor and organ to perform differential analysis across cell types while controlling for donor and organ differences. For trajectory analysis, we recommend pseudo-bulking cells by partially overlapping cell neighborhoods sampled from gene expression space for example using Milo<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> to model a more continuous cell state. For each pseudobulk, we compute the fraction of cells using each of the genes in a segment (for example, TRAJ1 to TRAJ61 in the TRAJ segment). The fractions from the various segments are concatenated, forming the V(D)J matrix/space. This can then be used with conventional dimension reduction techniques such as principal component analysis (PCA) or uniform manifold approximation and projection (UMAP).<fig id="Fig3"><label>Fig. 3</label><caption><title>Creating a V(D)J feature space.</title><p><bold>a</bold>, Schematic illustration of the workflow of creating a V(D)J feature space. Step 1—cells are assigned to pseudobulks, which can be based on metadata features, or partially overlapping cell neighborhoods. Step 2—V(D)J usage frequency per pseudobulk is computed for each gene and used as input of the V(D)J feature space. Step 3—the V(D)J feature space can be visualized with conventional dimension reduction techniques such as PCA or UMAP, and it can then be used for differential V(D)J usage analysis and pseudotime inference. <bold>b</bold>, Top left—gene expression UMAP of all T cells from adult human tissues in ref. <sup><xref ref-type="bibr" rid="CR5">5</xref></sup>, colored by low-level cell type annotations. Each point represents a cell. Top middle—V(D)J usage frequency per celltype_donor pseudobulk is computed for each gene and used as input of the V(D)J feature space. Top right—UMAP of the pseudobulk V(D)J feature space of the same cells. Each point represents a cell pseudobulk. Bottom panel—top two differentially expressed TCR genes in CD4<sup>+</sup> T cells, CD8<sup>+</sup> T cells and MAIT cells. <bold>c</bold>, Left—UMAP of neighborhood V(D)J feature space covering DP to mature T cells with paired productive αβTCR in data from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Each point represents a cell neighborhood, colored by the dominant cell type in each neighborhood. The point size represents neighborhood size, with connecting edges representing overlapping cell numbers between any two neighborhoods. Only edges with more than 30 overlapping cells are shown. Right top—inferred pseudotime, and branch probabilities to CD8<sup>+</sup> T and to CD4<sup>+</sup> T, respectively, overlaid onto the same UMAP embedding on the left. Right bottom—scatterplot of branch probability to CD8<sup>+</sup> T against pseudotime. Each point represents a cell neighborhood, colored by the dominant cell type in each neighborhood.</p></caption><graphic xlink:href="41587_2023_1734_Fig3_HTML" id="d32e883"/></fig></p>
      <p id="Par16">One utility of this V(D)J space is demonstrated as we pseudobulked adult human T cells<sup><xref ref-type="bibr" rid="CR5">5</xref></sup> by cell types and donors to explore differential usage that is consistent across different donors. On the V(D)J feature space-based UMAP, pseudobulks containing mucosal-associated invariant T (MAIT) cells formed a distinct cluster, in contrast to the single-cell gene expression-based UMAP (Fig. <xref rid="Fig3" ref-type="fig">3b</xref> and Extended Data Fig. <xref rid="Fig8" ref-type="fig">3a,b</xref>). This is expected due to the semi-invariant nature of MAIT TCRs and illustrates the power of the V(D)J feature space. Although there is no clear clustering in other cell types apart from MAIT (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3b</xref>), CD4<sup>+</sup> T cells were distinctly separated from CD8<sup>+</sup> T cells (Fig. <xref rid="Fig3" ref-type="fig">3b</xref>). Differential V(D)J usage for each cell type can be computed, for example, with nonparametric statistical tests implemented within scanpy<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> (Fig. <xref rid="Fig3" ref-type="fig">3b</xref> and Supplementary Table <xref rid="MOESM3" ref-type="media">5</xref>).</p>
    </sec>
    <sec id="Sec6">
      <title>Leveraging V(D)J usage in pseudotime trajectory inference</title>
      <p id="Par17">We also developed a new usage for V(D)J data by performing pseudotime inference on the cell neighborhood-based V(D)J feature space. Many pseudotime inference methods have been proposed based on transcriptome similarity<sup><xref ref-type="bibr" rid="CR31">31</xref></sup>. However, current approaches remain problematic in immune cell development because the differentiation process is often interspersed with waves of proliferation, and transcriptomic convergence, for example, between NKT and NK cells can be misleading. Because the usage of <italic>V</italic>(<italic>D</italic>)<italic>J</italic> genes in AIRs changes definitively as a result of cycles of recombination and selection during lymphocyte development, the AIR repertoire acts as a natural ‘time-keeper’ for developing T and B cells. A developing T cell’s fate toward CD8 versus CD4 T cells is determined by whether its TCR interacts with antigen presented on MHC class I or class II during positive selection. Therefore, it is biologically conceivable that the TCR gives more accurate predictions on the branch probability of each T cell lineage. For this task, we chose to pseudobulk by cell neighborhoods as modeling cell states with partially overlapping cell neighborhoods has advantages over clustering into discrete groups.</p>
      <p id="Par18">We sampled cell neighborhoods from developing T cells with productive αβTCR (double positive (DP) to mature single positive CD4<sup>+</sup>/CD8<sup>+</sup> T cells)<sup><xref ref-type="bibr" rid="CR3">3</xref></sup> on a k-nearest neighbor graph built with gene expression data using Milo<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> and constructed the neighborhood V(D)J feature space (Fig. <xref rid="Fig3" ref-type="fig">3c</xref> and Extended Data Fig. <xref rid="Fig8" ref-type="fig">3c</xref>). Trajectory analysis on this V(D)J feature space was performed using Palantir<sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. It outputs pseudotime and branch probabilities (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>) to each terminal state (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3d</xref>). The inferred pseudotime follows from proliferating to quiescent DP ((DP(P)) and DP(Q)) T cells, to abT(entry), which splits into CD8<sup>+</sup> T and CD4<sup>+</sup> T lineages. TCR usage trend can be visualized along the pseudotime trajectory (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3e</xref>). The average pseudotime and branch probabilities per cell can also then be projected back from its neighborhoods (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>).<fig id="Fig4"><label>Fig. 4</label><caption><title>Comparing pseudotime inferred from V(D)J space or gene expression (GEX) space.</title><p><bold>a</bold>, Top—pseudotime and branch probability to CD8<sup>+</sup> T inferred from neighborhood V(D)J space in Fig. <xref rid="Fig3" ref-type="fig">3c</xref>, projected back to the cells, overlaid onto the same UMAP embedding as in the top left panel. Left bottom—UMAP of DP to mature T cells with paired productive αβTCR in data from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Each point represents a cell, colored by cell types. Underneath the UMAP is a schematic showing the T cell differentiation process. Right bottom—pseudotime and branch probability to CD8<sup>+</sup> T inferred from neighborhood GEX space, projected back to the cells, overlaid onto the same UMAP embedding as in the top left panel. <bold>b</bold>, Scatterplots of the pseudotime ordering against the average relative TRAV or TRAJ location. Each point represents a cell neighborhood. Each <italic>TRAV</italic> or <italic>TRAJ</italic> gene is encoded numerically for its relative genomic order. The <italic>x</italic> axis represents the average TRAV/TRAJ relative location for each cell neighborhood. Top—results from pseudotime inferred from neighborhood V(D)J space. Bottom—results from pseudotime inferred from neighborhood GEX space. <bold>c</bold>, Stripplot of correlation coefficients of gene expression with branch probabilities to CD8<sup>+</sup> T within abT(entry) cells, for branch probabilities inferred from neighborhood V(D)J space and neighborhood GEX space separately. Only genes that are known CD4<sup>+</sup>/CD8<sup>+</sup> T cell markers or TFs involved in CD8<sup>+</sup> T/CD4<sup>+</sup> T lineage decisions are labeled and colored. The rest of the genes are grayed out. Labeled genes that had significant (BH adjusted <italic>P</italic> &lt; 0.05) positive correlations were colored in red, the ones with significant negative correlations were colored in blue and those without significant correlations were colored in orange.</p></caption><graphic xlink:href="41587_2023_1734_Fig4_HTML" id="d32e1027"/></fig></p>
      <p id="Par19">There are two alternative tools, CoNGA<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> and mvTCR<sup><xref ref-type="bibr" rid="CR22">22</xref></sup>, that integrate transcriptome with TCR information. Both were created to detect clonally expanded cell types with CDR3 sequences being the input. We tested whether they could also be used to reveal developmental relationships with the same dataset above. Both CoNGA and mvTCR failed to preserve the intercellular relationships (Extended Data Fig. <xref rid="Fig9" ref-type="fig">4a,b</xref>). This is not surprising, as selection of different <italic>V</italic>(<italic>D</italic>)<italic>J</italic> genes underpins recombination, while CDR3 diversity can additionally be influenced by random nucleotide insertions.</p>
    </sec>
    <sec id="Sec7">
      <title>V(D)J trajectory accurately orders T cell development</title>
      <p id="Par20">We next compared the results of trajectory inference on feature spaces from pseudobulked neighborhood V(D)J, pseudobulked neighborhood gene expression or single-cell gene expression.</p>
      <p id="Par21">The analysis of single-cell gene expression performed unsatisfactorily as a large proportion of CD8<sup>+</sup> T and CD4<sup>+</sup> T cells were misclassified with higher branch probabilities to the opposite terminal state (Extended Data Fig. <xref rid="Fig10" ref-type="fig">5a,b</xref>). Therefore, we mainly focused our comparison with results from pseudobulked neighborhood gene expression (GEX) space, which produced more biologically meaningful pseudotime and branch probabilities (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). When projected back to cells, the inferred pseudotime in the pseudobulked space better reflected the known biology of DP(P)_T to DP(Q)_T, to abT(entry) and subsequent splits into CD8<sup>+</sup> T and CD4<sup>+</sup> T lineages (Extended Data Fig. <xref rid="Fig10" ref-type="fig">5c,d</xref>). This suggests that pseudotime inference with pseudobulked cells works better than directly from single cells, potentially due to less noise compared to single-cell data.</p>
      <p id="Par22">We observed two major differences when comparing the pseudotime inferred from neighborhood V(D)J feature space versus that from neighborhood GEX space (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>). First, the DP(Q) T cells dwelled for a longer ‘time’ in the V(D)J trajectory compared to the GEX trajectory. Second, the branching point of CD8<sup>+</sup> T and CD4<sup>+</sup> T cell lineages happened earlier in abT(entry) cells in the V(D)J trajectory (Extended Data Fig. <xref rid="Fig11" ref-type="fig">6c</xref>). To assess the fidelity of the V(D)J trajectory, we used the known fact that V–J recombination in the TRA locus happens processively<sup><xref ref-type="bibr" rid="CR33">33</xref></sup> (from middle to distal ends on the genome). We encoded the genomic order numerically for each <italic>TRAV</italic> and <italic>TRAJ</italic> gene and the V(D)J pseudotime ordering for each DP(Q) neighborhood showed a substantially better monotonic relationship with the TRAV relative locations (Fig. <xref rid="Fig4" ref-type="fig">4b</xref>). Average local correlations across adjacent neighborhoods along V(D)J pseudotime had higher absolute correlation coefficients on average (−0.67 versus −0.43 for TRAV; Extended Data Fig. <xref rid="Fig11" ref-type="fig">6a</xref>). A smaller improvement was also observed for <italic>TRAJ</italic>, with the average local Pearson’s correlations improved from 0.42 to 0.50 (Extended Data Fig. <xref rid="Fig11" ref-type="fig">6b</xref>).</p>
      <p id="Par23">CD4 versus CD8 T cell lineage commitment is a classical immunological binary lineage decision that has been intensely investigated over many years<sup><xref ref-type="bibr" rid="CR34">34</xref></sup> but remains challenging to study as the selection intermediates have been difficult to observe directly<sup><xref ref-type="bibr" rid="CR35">35</xref></sup>. We examined which genes in abT(entry) cells showed expression patterns that are correlated with branch probabilities to CD8<sup>+</sup> T versus CD4<sup>+</sup> T lineage (Fig. <xref rid="Fig4" ref-type="fig">4c</xref>).</p>
      <p id="Par24">The top genes that were positively correlated with the CD8<sup>+</sup> T cell lineage choice included <italic>CD8A</italic> and <italic>CD8B</italic>, which are markers for CD8<sup>+</sup> T cells<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>. The top genes that were negatively correlated included <italic>CD40LG</italic>, which is a marker for CD4<sup>+</sup> T helper cells<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>, and <italic>ITM2A</italic> (induced during positive selection and causes CD8 downregulation<sup><xref ref-type="bibr" rid="CR36">36</xref></sup>). Other markers of CD4<sup>+</sup> T cells such as <italic>CD4</italic> (ref. <sup><xref ref-type="bibr" rid="CR6">6</xref></sup>), together with highly validated transcription factors (TFs) that are known to be involved in CD8<sup>+</sup> T or CD4<sup>+</sup> T lineage decisions<sup><xref ref-type="bibr" rid="CR34">34</xref></sup>, including <italic>RUNX3</italic> (ref. <sup><xref ref-type="bibr" rid="CR37">37</xref>,<xref ref-type="bibr" rid="CR38">38</xref></sup>), <italic>ZBTB7B</italic><sup><xref ref-type="bibr" rid="CR39">39</xref>,<xref ref-type="bibr" rid="CR40">40</xref></sup>, <italic>TOX</italic><sup><xref ref-type="bibr" rid="CR41">41</xref></sup> and <italic>GATA3</italic> (ref. <sup><xref ref-type="bibr" rid="CR42">42</xref>,<xref ref-type="bibr" rid="CR43">43</xref></sup>), all displayed significant correlations in the expected directions. However, when using GEX pseudotime, the correlations were notably reduced and some (for example, <italic>TOX</italic> and <italic>RUNX3</italic>) were no longer statistically significant (Fig. <xref rid="Fig4" ref-type="fig">4c</xref>). For <italic>TOX</italic>, the direction of the correlation was wrongly inverted (Fig. <xref rid="Fig4" ref-type="fig">4c</xref>). In addition, the V(D)J pseudotime also revealed new associations for TFs such as <italic>ZNF496</italic>, <italic>MBNL2</italic> and <italic>RORC</italic> for CD8<sup>+</sup> T, and <italic>SATB1, STAT5A</italic> and <italic>STAT1</italic> for CD4<sup>+</sup> T (Extended Data Fig. <xref rid="Fig11" ref-type="fig">6d</xref> and Supplementary Table <xref rid="MOESM3" ref-type="media">6</xref>).</p>
      <p id="Par25">We have also used different pseudotime inference methods to ensure the robustness of the results. Neighborhood V(D)J-based pseudotime trajectories inferred using monocle3 (ref. <sup><xref ref-type="bibr" rid="CR44">44</xref></sup>) and diffusion pseudotime<sup><xref ref-type="bibr" rid="CR45">45</xref></sup> similarly showed a better monotonic relationship with TRAV/TRAJ relative locations compared to neighborhood GEX-based pseudotime (Extended Data Fig. <xref rid="Fig12" ref-type="fig">7a,b</xref>). Overall, Palantir is preferred as it outputs the branch probabilities, which is useful in deciphering CD4/8 lineage decisions.</p>
      <p id="Par26">Taken together, we showed that V(D)J-based pseudotime inference gives more accurate DP(Q) T cell alignment and improves lineage association within abT(entry) cells. We can use this approach to recapitulate known regulators and uncover new candidate regulators underlying CD8<sup>+</sup> T/CD4<sup>+</sup> T fate choice.</p>
    </sec>
    <sec id="Sec8">
      <title>Using nonproductive recombination as a ‘fossil record’</title>
      <p id="Par27">Based on our earlier observations of high proportions of nonproductive contigs being represented in the single-cell V(D)J data (Fig. <xref rid="Fig2" ref-type="fig">2a</xref>), we next explored whether this was cell-type specific. As expected, nonproductive BCR contigs were restricted to B lineage cells (Extended Data Fig. <xref rid="Fig13" ref-type="fig">8a,b</xref>). However, nonproductive TRB contigs were surprisingly expressed in many cell-type lineages (developing DN T cells, ILC/NK, B cells; Fig. <xref rid="Fig5" ref-type="fig">5a</xref> and Extended Data Fig. <xref rid="Fig13" ref-type="fig">8c</xref>). The majority of the nonproductive TRB contigs within ILC/NK/B cells were contigs without <italic>V</italic> gene (Extended Data Fig. <xref rid="Fig13" ref-type="fig">8d</xref>).<fig id="Fig5"><label>Fig. 5</label><caption><title>Insights into lymphocyte development from nonproductive TCR.</title><p><bold>a</bold>, Boxplot of the proportion of cells with productive (blue) or nonproductive (orange) TRB in different fetal lymphocyte subsets. Each point represents a sample and data were taken from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Only samples with at least 20 cells are shown. Boxes capture the first to third quartiles and whisks span a further 1.5× interquartile range on each side of the box. The annotations used here were based on the version whereby the exact identity of cycling B cells was predicted to be immature B, mature B, B1 or plasma B cells using Celltypist<sup><xref ref-type="bibr" rid="CR3">3</xref>,<xref ref-type="bibr" rid="CR5">5</xref></sup>. The equivalent boxplot using the original annotations is shown in Extended Data Fig. <xref rid="Fig13" ref-type="fig">8a</xref>. <bold>b</bold>, Top left—schematic illustration showing the proposed development of B cells (top panel), and the relationship between ILC/NK and T cell lineages. Top right—UMAP of neighborhood V(D)J feature space covering ILC, NK and developing T cells with TRBJ in data from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Each point represents a cell neighborhood, colored by cell types. The point size represents neighborhood size, with connecting edges representing overlapping cell numbers between any two neighborhoods. Only edges with more than 30 overlapping cells are shown. Bottom—inferred pseudotime and branch probabilities to ILC/NK and T lineage, respectively, overlaid onto the same UMAP embedding on the top right. <bold>c</bold>, Top—scatterplot of branch probability to ILC/NK lineage against pseudotime. The pseudotime was inferred from neighborhood V(D)J space shown in Fig. 5b and projected back cells. Each point represents a cell, colored by cell types. Bottom—heatmap of TF expressions across pseudotime in DN T cells. Pseudotime is equally divided into 100 bins, and the average gene expression is calculated for DN T cells with pseudotime that falls within each bin. Genes selected here are TFs that had significantly high Chatterjee’s correlation<sup><xref ref-type="bibr" rid="CR73">73</xref></sup> with pseudotime (BH adjusted <italic>P</italic> &lt; 0.05, and correlation coefficient &gt;0.1).</p></caption><graphic xlink:href="41587_2023_1734_Fig5_HTML" id="d32e1344"/></fig></p>
      <p id="Par28">The B lineage cells with nonproductive TRB contigs included pre–pro B and B1 cells but not pro- or pre-B cells (Fig. <xref rid="Fig5" ref-type="fig">5a</xref> and Extended Data Fig. <xref rid="Fig13" ref-type="fig">8c</xref>). Pre–pro B and B1 cells expressed only nonproductive TRB but not TRG/D contigs (Extended Data Fig. <xref rid="Fig14" ref-type="fig">9a–c</xref>), suggesting that they share a common developmental route (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>), bypassing pro-/pre-B cell stages. This clarifies that human fetal B1 cells can emerge through an alternative route. The conventional route is thought to progress from pre–pro, pro-, pre-, immature, to mature naive B cells<sup><xref ref-type="bibr" rid="CR46">46</xref></sup>. Our observations are consistent with findings in mouse B1s, which were shown to bypass the pre-BCR selection stage<sup><xref ref-type="bibr" rid="CR47">47</xref>,<xref ref-type="bibr" rid="CR48">48</xref></sup>, which normally happens in pre-B cells to remove self-reactive B cells. This may also explain why B1 cells have BCRs with shorter noncoded/palindromic (N/P) nucleotide insertions<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, due to negligible expression of DNTT in pre–pro B but much higher expression in pro- and late pro-B cells<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. In addition, as pre–pro B cells are almost undetectable in adult bone marrow<sup><xref ref-type="bibr" rid="CR49">49</xref></sup>, it potentially explains the difficulty of identifying B1-like cells in adult human tissues<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>.</p>
      <p id="Par29">Similar to DN T cells, the ILC/NK lineage also expressed nonproductive TRG/D contigs with some TRA contigs (Extended Data Fig. <xref rid="Fig14" ref-type="fig">9a–c</xref>). We used TRBJ frequency to construct a V(D)J feature space because all T/ILC/NK cells express TRBJ (Fig. <xref rid="Fig5" ref-type="fig">5b</xref> and Extended Data Fig. <xref rid="Fig15" ref-type="fig">10a</xref>). The inferred trajectory suggests that ILC/NK cells deviate away from T cell development between DN(early) and DN(Q) stage (Fig. <xref rid="Fig5" ref-type="fig">5b,c</xref>).</p>
      <p id="Par30">Previous literature on the ILC/NK lineage has also demonstrated partial recombination of TRG/D in mouse lung ILC2 (ref. <sup><xref ref-type="bibr" rid="CR50">50</xref></sup>) and of TRB/G in mouse thymic ILC2 (ref. <sup><xref ref-type="bibr" rid="CR51">51</xref></sup>), leading to the hypothesis of ‘aborted’ DNs for ILC/NK development<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>. Our observation of the expression of nonproductive TRB/G/D in ILC/NK cells partially supports this theory. Notably, we also observed nonproductive TRB expression in ILC/NK cells in other fetal organs, with no overt differences in frequencies between organs (Extended Data Fig. <xref rid="Fig14" ref-type="fig">9d</xref>). This potentially suggests that T cells and ILC/NK cells might share the same initial stage of development, and then deviate away from each other before productive TRB/TRG/TRD is made.</p>
      <p id="Par31">We observed that expression levels of genes encoding TFs (Fig. <xref rid="Fig5" ref-type="fig">5c</xref>) and cell surface proteins (Extended Data Fig. <xref rid="Fig15" ref-type="fig">10b</xref>) such as <italic>SPI1</italic>, <italic>RAG1</italic>, <italic>HHEX</italic>, <italic>TCF12</italic>, <italic>CD34</italic>, <italic>CD3D</italic>, <italic>CD8A</italic> and <italic>CD8B</italic>, followed an expected pattern along the TRBJ-inferred trajectory<sup><xref ref-type="bibr" rid="CR53">53</xref></sup>. At the same time, we also discovered many new genes that could redefine DN stages at a higher resolution than previously reported in the literature. We note that there were some discordances in expression patterns of selected TFs between human and mouse DN development<sup><xref ref-type="bibr" rid="CR53">53</xref></sup> (Extended Data Fig. <xref rid="Fig15" ref-type="fig">10c</xref>). However, this discrepancy could be due to age mismatch that is fetal human to adult mouse, and the mouse data was mainly learned from TF-knockout studies. Future work with detailed comparison using paired scRNA-seq and scVDJ-seq in mice and humans of different age groups will help provide clarity to this.</p>
      <p id="Par32">Finally, we repeated the analysis in human fetal myeloid cells<sup><xref ref-type="bibr" rid="CR3">3</xref></sup> to ask whether the pDCs that have initiated BCR rearrangements are derived from lymphoid progenitors<sup><xref ref-type="bibr" rid="CR54">54</xref>,<xref ref-type="bibr" rid="CR55">55</xref></sup>. pDC can be derived from both myeloid and lymphoid lineages<sup><xref ref-type="bibr" rid="CR54">54</xref>,<xref ref-type="bibr" rid="CR55">55</xref></sup> and there is IgH D-J rearrangement in some pDCs<sup><xref ref-type="bibr" rid="CR54">54</xref>,<xref ref-type="bibr" rid="CR56">56</xref>–<xref ref-type="bibr" rid="CR59">59</xref></sup>. We found some nonproductive BCR in pDC (both heavy and light chain as shown in Supplementary Fig. <xref rid="MOESM1" ref-type="media">1a,b</xref>) in agreement with previously reported IgH D-J rearrangement in pDC<sup><xref ref-type="bibr" rid="CR54">54</xref>,<xref ref-type="bibr" rid="CR56">56</xref>–<xref ref-type="bibr" rid="CR59">59</xref></sup>. However, pDC itself expresses RAG and DNTT (Supplementary Fig. <xref rid="MOESM1" ref-type="media">1c</xref>). The presence of nonproductive BCR does not necessarily indicate that pDCs are derived from lymphoid progenitors as BCR rearrangement can be carried by RAG in pDC itself<sup><xref ref-type="bibr" rid="CR57">57</xref></sup>. While it may be interesting to use our VDJ-based trajectory to explore whether the development of pDC overlaps with early B cell development, the current dataset is limited by the cell number as only 51 pDC and cycling pDC cells have nonproductive IGH.</p>
      <p id="Par33">In summary, the unexpected finding of expression of nonproductive TCR contigs in specific cell types has the potential to shed new light on lymphocyte development. Our analysis suggests that B1 potentially arises directly from pre–pro B cells and provides support for the ‘aborted’ DN theory for ILC/NK cell origins.</p>
    </sec>
  </sec>
  <sec id="Sec9" sec-type="discussion">
    <title>Discussion</title>
    <p id="Par34">Overall, Dandelion improves upon existing methods with more refined contig annotations, recognizing nonproductive contigs, identifying multi-J mapping and recovering more γδTCR contigs. Pseudotime inference on V(D)J feature space better aligned CD4/CD8 T cell lineage trajectories and suggested developmental origins of ILCs.</p>
    <p id="Par35">Our improved workflow revealed two unexpected data challenges and opportunities with scVDJ-seq. First, the high proportion of nonproductive TCR/BCR contigs suggests that these are unique challenges due to the choice of single-cell library construction. However, it is not unexpected as V(D)J rearrangement is a ‘wasteful’ exercise, a price to generate effective and diverse immune responses, for example, two of three rearrangement events for immunoglobulins are destined to be nonproductive<sup><xref ref-type="bibr" rid="CR60">60</xref>,<xref ref-type="bibr" rid="CR61">61</xref></sup>. While nonproductive and productive TCR/BCRs from high-throughput ‘bulk’ AIR sequencing data have been previously used together to estimate the generation probabilities and diversities of AIRs during affinity maturation and infection<sup><xref ref-type="bibr" rid="CR62">62</xref>,<xref ref-type="bibr" rid="CR63">63</xref></sup>, these would only have included contigs with <italic>V</italic> gene due to library limitations as discussed.</p>
    <p id="Par36">Second, detection of multi-J mapping suggests that these are naturally occurring and likely represent products of partial splicing events. While a few factors were identified to be associated with multi-J mapping, the biological implications are unclear at this stage, warranting future explorations.</p>
    <p id="Par37">We introduced a new way of analyzing the single-cell V(D)J modality in Dandelion with the pseudobulk V(D)J feature space, which can be used for visualization and differential V(D)J usage testing. When pseudobulked on cell neighborhoods, the V(D)J feature space is anchored to the underlying neighborhood gene expression space and can be used for pseudotime trajectory inference.</p>
    <p id="Par38">The first case study examined thymic T cell development. Previously, abT(entry) cells were suggested to be a divergent point as it was between DP T cells and mature single positive T cells<sup><xref ref-type="bibr" rid="CR6">6</xref></sup>. With the V(D)J trajectory, we are now able to better delineate the branching point to a much earlier point within the abT(entry) cells. The new trajectories better aligned CD4/CD8 T cell fate with gene expression patterns of known marker genes and TFs and additionally revealed new associations with other TFs that remain to be explored.</p>
    <p id="Par39">This method can be useful for other applications for example studying T cell developmental stages across the lifespan, diseases and in vitro settings. It remains to be seen whether a VDJ-based trajectory can be used in T cell activation. This approach has not been optimized for BCR trajectories, as we are limited by the small number of B progenitors in available data. Further, BCRs have additional rearrangement rules that need to be considered, for example, somatic hypermutation, asymmetric usage of kappa/lambda light chains and light chain editing<sup><xref ref-type="bibr" rid="CR64">64</xref></sup>, as well as recently described light chain coherence in functional antibodies. We hope to improve on these aspects in a future iteration of Dandelion when more single-cell V(D)J data become available.</p>
    <p id="Par40">The second case study extended the observations of nonproductive V(D)J contigs in single-cell data, which has been largely ignored and/or not easily accessible with other workflows, for example, scirpy<sup><xref ref-type="bibr" rid="CR13">13</xref></sup> and immcantation<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>. Our unexpected finding that B1 cells and pre–pro B cells expressed relatively higher levels of nonproductive TRB contigs suggest that B1 lineage commitment diverged earlier than expected, between the pre–pro B stage and pro-B stage. Two competing models have been described regarding B1 origin<sup><xref ref-type="bibr" rid="CR65">65</xref></sup>. The lineage model or layered immune system hypothesis<sup><xref ref-type="bibr" rid="CR66">66</xref></sup> proposed that B1 and B2 cells arise from distinct progenitors that emerge at different times during development<sup><xref ref-type="bibr" rid="CR67">67</xref>–<xref ref-type="bibr" rid="CR70">70</xref></sup>, while the selection model hypothesized that they originate from the same progenitors but after differential signaling depending on self-reactivity<sup><xref ref-type="bibr" rid="CR71">71</xref>,<xref ref-type="bibr" rid="CR72">72</xref></sup>. Our findings here potentially offer a reconciliation of both models, with fetal-specific pre–pro B cells being B1 progenitors, supporting the layered immune system model, and the skipping of pre-BCR selection presumably allows the formation of self-reactive BCR, supporting the selection model.</p>
    <p id="Par41">Enrichment of the nonproductive TRB/TRG/TRD contigs was also observed in NK/ILC lineages. Partial recombination of TCR has been reported in mouse ILC<sup><xref ref-type="bibr" rid="CR50">50</xref>,<xref ref-type="bibr" rid="CR51">51</xref></sup> and our findings support the ‘abandoned’ DN theory<sup><xref ref-type="bibr" rid="CR52">52</xref></sup>. The hypothesis is that ILC/NK cells are originally on a canonical T cell development trajectory but subsequently influenced to abort this process, resulting in sustained expression of nonproductive TCR, although we cannot rule out other routes of ILC/NK development.</p>
    <p id="Par42">In summary, Dandelion is a freely available package for integrative analyses of single-cell GEX and V(D)J data. The V(D)J trajectories are also publicly available for use as a reference to a project or to align new query data. We hope that the software and resource will be useful in generating more insights into immune cell development and function.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Dandelion</title>
      <sec id="Sec12">
        <title>Preprocessing</title>
        <p id="Par43">Dandelion can run the preprocessing of data using the standard outputs from all cellranger vdj versions. In this manuscript, single-cell V(D)J data from the 5′ Chromium 10X kit were initially processed with cellranger vdj pipeline (v6.1.2) with cellranger vdj reference (v5.0.0). TCR and BCR contigs contained in ‘all_contigs.fasta’ and ‘all_contig_annotations.csv’ from all three library types (αβTCR, γδTCR and BCR) were then re-annotated using an immcantation-inspired<sup><xref ref-type="bibr" rid="CR23">23</xref></sup> preprocessing pipeline contained in the Dandelion singularity container (v0.3.0).</p>
        <p id="Par44">The preprocessing pipeline includes the following steps:<list list-type="simple"><list-item><label>i.</label><p id="Par45">Adjust cell and contig barcodes by adding user-supplied suffixes and/or prefixes to ensure that there are no overlapping barcodes between samples.</p></list-item><list-item><label>ii.</label><p id="Par46">Optionally subset to contigs deemed high confidence in the cellranger output; this was done in the analysis performed here.</p></list-item><list-item><label>iii.</label><p id="Par47">Re-annotation of contigs with igblastn (v1.19.0) against IMGT (international ImMunoGeneTics) reference sequences (last downloaded: 01/08/2021) with the following parameters: minimum <italic>D</italic> gene nucleotide match = 9, <italic>V</italic> gene <italic>e</italic>-value cutoff = 10<sup>−4</sup>; rearrangements missing the CDR3/junction sequences are enforced to be nonproductive (productive = ‘F’) and incomplete (complete_vdj = ‘F’).</p></list-item><list-item><label>iv.</label><p id="Par48">Re-annotation of <italic>D</italic> and <italic>J</italic> genes separately using blastn with similar parameters as per igblastn<sup><xref ref-type="bibr" rid="CR25">25</xref></sup> (dust = ‘no’, word size (J = 7; D = 9)) but with an additional <italic>e</italic>-value cutoff (J = 10<sup>−4</sup> in contrast to igblastn’s default cutoff of 10; D = 10<sup>−3</sup>). This is to enable the annotation of contigs without the <italic>V</italic> gene present.</p></list-item><list-item><label>v.</label><p id="Par49">Identification and recovery of nonoverlapping individual <italic>J</italic> gene segments (under associated ‘j_chain_multimapper’ columns). In the list of all mapped <italic>J</italic> genes (all_contig_j_blast.tsv) from blastn, the <italic>J</italic> gene with the highest score (j_support) was chosen. Dandelion then looks for the next <italic>J</italic> gene with the highest ‘j_support’ value, and with start (j_sequence_start) and end (j_sequence_end) positions not overlapping with the selected <italic>J</italic> gene, and does so iteratively until the list of all mapped <italic>J</italic> genes are exhausted. In contigs without <italic>V</italic> gene annotations, we then select the 5′ end leftmost <italic>J</italic> gene and update the ‘j_call’ column in the final AIRR table. For contigs with <italic>V</italic> gene annotations, but with multiple <italic>J</italic> gene calls, we use the annotations provided by igblastn (NCBI IgBLAST Release 1.19.0’s release notes state that they ‘*Added logic to handle the case where there is an unrearranged <italic>J</italic> gene downstream of the VDJ rearrangement.’).</p></list-item></list></p>
        <p id="Par50">For BCRs, there are two additional steps:<list list-type="simple"><list-item><label>i.</label><p id="Par51">Additional re-annotation of heavy-chain constant (C) region calls using blastn (v2.13.0+) against curated sequences from CH1 regions of respective isotype class.</p></list-item><list-item><label>ii.</label><p id="Par52">Heavy chain <italic>V</italic> gene allele correction using TIgGER (v1.0.0) (ref. <sup><xref ref-type="bibr" rid="CR74">74</xref></sup>). The final outputs are then parsed into AIRR format with change-o scripts<sup><xref ref-type="bibr" rid="CR23">23</xref></sup>.</p></list-item></list></p>
        <p id="Par53">All the outputs from each step are saved in a subfolder, which the user can elect to retain or remove as per their requirements. Typically, a user would proceed with the file ending with the suffix ‘_contig_dandelion.tsv’ as this represents the rearrangement sequences that pass standard quality control checks. In this manuscript, we used the data found in the ‘all_contig_db-all.tsv’ as it also contains the multi-J mapping.</p>
      </sec>
      <sec id="Sec13">
        <title>Postprocessing</title>
        <p id="Par54">In addition to the preprocessing steps at the contig level, postprocessing or integrating cell-level quality control is performed using Dandelion’s ‘check_contig’ function. The function checks whether a rearrangement is annotated with consistent <italic>V</italic>, <italic>D</italic>, <italic>J</italic> and <italic>C</italic> gene calls and performs special operations when a cell has multiple contigs. All contigs in a cell are sorted according to the unique molecular identifier (UMI) count in descending order, and productive contigs are ordered higher than nonproductive contigs. For cells with other than one pair of productive contigs (one VDJ and one VJ), the function will assess if the cell is to be flagged with having orphan (no paired VDJ or VJ chain), extra pair(s) or ambiguous (biologically irreconcilable, for example, both TCRs and BCRs in the same cell) status with some exceptions as follows: (1) IgM and IgD are allowed to coexist in the same B cell if no other isotypes are detected; (2) TRD and TRB contigs are allowed in the same cell because rearrangement of TRB and TRD loci happens at the same time during development, and TRD variable region genes exhibit allelic inclusion<sup><xref ref-type="bibr" rid="CR75">75</xref></sup>. The function also asserts a library type restriction with the rationale that the choice of the library type should mean that the primers used would most likely amplify only relevant sequences to a particular locus. Therefore, if there are any annotations to unexpected loci, these contigs likely represent artifacts and will be filtered away. A more stringent version of ‘check_contigs’ is implemented in a separate function, ‘filter_contigs’, which only considers productive VDJ contigs, asserts a single cell should only have one VDJ and one VJ pair, or only an orphan VDJ chain, and explicitly removes contigs that fail these checks (with the same exceptions for IgM/IgD and TRB/TRD as per above). If a single-cell gene expression object (AnnData) is provided to the functions, it will also remove contigs that do not match to any cell barcodes in the gene expression data. Lastly, Dandelion can accept any AIRR-formatted data format, for example, BDRhapsody VDJ data.</p>
      </sec>
      <sec id="Sec14">
        <title>Clonotype definition and diversity</title>
        <p id="Par55">Dandelion’s mode of clonotype definition and network-based diversity analysis has been previously described<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>. Briefly, TCRs and BCRs are grouped into clones/clonotypes based on the following sequential criteria that apply to both heavy-chain and light-chain contigs as follows: (1) identical <italic>V</italic> and <italic>J</italic> genes usage; (2) identical junctional CDR3 amino acid length and (3) CDR3 sequence similarity—for TCRs, 100% nucleotide sequence identity at the CDR3 junction is recommended while the default setting for BCRs is to use 85% amino acid sequence similarity (based on Hamming distance). Single-cell V(D)J networks are constructed using adjacency matrices computed from pairwise Levenshtein distance of the full amino acid sequence alignment for TCR/BCR(s) on a per-cell basis. A minimum-spanning tree is then constructed on the adjacency matrix for each clone/clonotype, creating a simple graph with edges indicating the shortest total edit distance between a cell and its neighbor. Cells with a total pairwise edit distance of zero are then connected to the graph to recover edges trimmed off during the minimum-spanning-tree construction step. A graph layout is then computed either using the Fruchterman–Reingold algorithm in networkx (≥v2.5) or Scalable Force-Directed Placement algorithm implemented through graph-tool (v2.46) package<sup><xref ref-type="bibr" rid="CR76">76</xref>,<xref ref-type="bibr" rid="CR77">77</xref></sup>. Visualization of the resulting single-cell V(D)J network is achieved via the transfer of the graph to relevant ‘AnnData’ slots, allowing for access to plotting tools in scanpy. The resulting V(D)J network enables computation of Gini coefficients based on cluster/cell size/centrality distributions, as discussed previously<sup><xref ref-type="bibr" rid="CR4">4</xref></sup>.</p>
      </sec>
      <sec id="Sec15">
        <title>Pseudobulk V(D)J feature space</title>
        <p id="Par56">Pseudobulk construction requires pseudobulk assignment information of cells, along with <italic>V</italic> and <italic>J</italic> genes for the cells’ identified primary TCR/BCR contigs (selected based on productive status and highest UMI count). The former is a cell by pseudobulk binary matrix, which can be either explicitly provided by the user or inferred from unique combinations of cell-level discrete metadata. While the code is calibrated to work with Dandelion’s structuring by default, it can work with any V(D)J processing provided it stores cell-level information on primary per-locus V/D/J calls. The input is used to generate a pseudobulk by V(D)J feature space, with the V(D)J calls converted to a binary matrix, added up for each pseudobulk, and normalized to a unit sum on a per-pseudobulk, per-locus, per-segment basis. The cell by pseudobulk information is stored in the resulting object for potential communication with the original cell space. Utility functions are provided for compatibility with Palantir<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> output for trajectory inference.</p>
      </sec>
    </sec>
    <sec id="Sec16">
      <title>Nonproductive TCR/BCR contigs</title>
      <p id="Par57">Single-cell BCR, αβTCR and γδTCR data from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup> were remapped with cellranger vdj (v6.1.2) and processed further using Dandelion as described above. For all samples, contigs were extracted from ‘all_contig_igblast_db-all.tsv’ or in the case whereby ‘all_contig_igblast_db-all.tsv’ was empty, ‘all_contig_igblast_db-fail.tsv’ was used. Preprocessed and annotated scRNA-seq data was downloaded from <ext-link ext-link-type="uri" xlink:href="https://developmental.cellatlas.io/fetal-immune">https://developmental.cellatlas.io/fetal-immune</ext-link>. Only contigs from annotated cells were kept for downstream analysis. For each contig, productive status was obtained from the column ‘productive’, and the causes for nonproductive contigs were extracted from ‘vj_in_frame’ (is ‘F’ if there is a frameshift), ‘stop_codon’ (is ‘T’ if there is a premature stop codon) and ‘v_gene_present’ (is ‘False’ if <italic>V</italic> gene is absent) columns.</p>
    </sec>
    <sec id="Sec17">
      <title>Cycloheximide treatment on PBMC</title>
      <p id="Par58">A vial of frozen PBMCs was acquired from Stemcell Technologies (70025.1) with informed consent (as stated by Stemcell Technologies) and approval from the Yorkshire &amp; The Humber—Leeds East Research Ethics Committee (19/YH/0441). Frozen PBMCs were thawed in prewarmed RF10 media, which was RPMI (Corning, 10-041-CV) supplemented with 10% FBS (Gibco, A4766801) and penicillin/streptomycin (Sigma-Aldrich, P4333). Cells were pelleted by centrifugation at 500<italic>g</italic> for 5 min and resuspended in RF10 media, and split between two 10 cm Petri dishes. Control PBMCs were then incubated in a total of 10 ml RF10 media at 37 °C for 2 h, whereas treated PBMCs were incubated in RF10 supplemented with cycloheximide (Sigma-Aldrich, C4859-1ML; final concentration of 100 μg ml<sup>−1</sup>). After incubation, control and treated PBMCs were washed with ice-cold RF10 and resuspended in 2% FBS in PBS (Gibco, 14190144). For treated PBMCs, both the washing and resuspension buffer contained 100 μg ml<sup>−1</sup> cycloheximide.</p>
      <p id="Par59">Control and treated PBMCs were then loaded onto two separate channels of the chromium chip from chromium single cell V(D)J kit (10X Genomics 5′ v2 PN-1000263) following the manufacturer’s instructions before droplet encapsulation on the Chromium controller. Single-cell cDNA synthesis, amplification, gene expression (GEX) and targeted BCR and αβTCR libraries were generated. Sequencing was performed on the Illumina Novaseq 6000 system. The gene expression libraries were sequenced at a target depth of 50,000 reads per cell using the following parameters: Read1, 26 cycles; i7, 8 cycles; i5, 0 cycles and Read2, 91 cycles to generate 75-bp paired-end reads. BCR and TCR libraries were sequenced at a target depth of 5,000 reads per cell.</p>
      <p id="Par60">Raw scRNA-seq reads were mapped with cellranger 3.0.2 with Ensembl 93-based GRCh38 reference. Low-quality cells were filtered out (minimum number of reads &gt;2,000, minimum number of genes &gt;500, maximum number of genes &lt;7,000, maximum mitochondrial reads fraction &lt;0.2 and maximum scrublet<sup><xref ref-type="bibr" rid="CR78">78</xref></sup> (v0.2.1) doublet score ≤ 0.5). Data normalization and log transformation were performed using scanpy<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> (v1.9.1) (scanpy.pp.normalize_per_cell(counts_per_cell_after=10e4) and scanpy.pp.log1p). Highly variable genes were then selected (scanpy.pp.highly_variable_genes), and PCA (scanpy.pp.pca), neighborhood graph (scanpy.pp.neighbors) and UMAP (scanpy.tl.umap) were computed. Automatic annotation was done using celltypist (v1.2.0) (celltypist.annotate(model = 'Immune_All_Low.pkl', majority_voting = True)).</p>
      <p id="Par61">Single-cell αβTCR and BCR sequencing data were mapped with cellranger vdj (v6.1.2) and processed further using Dandelion, as described above. For all samples, contigs were extracted from ‘all_contig_igblast_db-all.tsv’ or in the case whereby ‘all_contig_igblast_db-all.tsv’ was empty, ‘all_contig_igblast_db-fail.tsv’ was used. Only contigs from annotated cells were kept for downstream analysis.</p>
    </sec>
    <sec id="Sec18">
      <title>Factors associated with multi-J mapping</title>
      <sec id="Sec19">
        <title>Logistic regression analysis</title>
        <p id="Par62">We used the following logistic regression model to look for factors associated with multi-J mapping:<disp-formula id="Equa"><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\mathrm{log}\frac{{p_i}}{{1 - p_i}} = \beta _{\mathrm{cell},c(i)} + \beta _{J,j(i)} + \beta _Vx_{V,i} + \beta _{{{\mathrm{cyclo}}}}x_{V,i}x_{{{\mathrm{cyclo}}},i}$$\end{document}</tex-math><mml:math id="M2"><mml:mrow><mml:mi mathvariant="normal">log</mml:mi><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">cell</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>V</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">cyclo</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">cyclo</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math><graphic xlink:href="41587_2023_1734_Article_Equa.gif" position="anchor"/></alternatives></disp-formula>where <italic>p</italic><sub><italic>i</italic></sub> is the probability of multi-J mapping present in the <italic>i</italic>th contig, <italic>c(i)</italic> and <italic>j(i)</italic> are the cell type and the 5′ end <italic>J</italic> gene of the <italic>i</italic>th contig, respectively, <italic>x</italic><sub><italic>V</italic>,<italic>i</italic></sub> is the indicator of whether <italic>V</italic> gene is present in the <italic>i</italic>th contig and <italic>x</italic><sub>cyclo,<italic>i</italic></sub> is the indicator of whether <italic>i</italic>th contig belongs to a cell that had cycloheximide treatment. Here <inline-formula id="IEq1"><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {\beta _{\mathrm{cell},c}:c \in \mathrm{cell}\;\mathrm{types}} \right)$$\end{document}</tex-math><mml:math id="M4"><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">cell</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="normal">cell</mml:mi><mml:mspace width="0.16em"/><mml:mi mathvariant="normal">types</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41587_2023_1734_Article_IEq1.gif"/></alternatives></inline-formula>, <inline-formula id="IEq2"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$\left( {\beta _{\mathrm{cell},j}:j \in 5{\prime}\;\mathrm{end}\;J\;\mathrm{genes}} \right)$$\end{document}</tex-math><mml:math id="M6"><mml:mfenced close=")" open="("><mml:mrow><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">cell</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mn>5</mml:mn><mml:mo>′</mml:mo><mml:mspace width="0.16em"/><mml:mi mathvariant="normal">end</mml:mi><mml:mspace width="0.16em"/><mml:mi>J</mml:mi><mml:mspace width="0.16em"/><mml:mi mathvariant="normal">genes</mml:mi></mml:mrow></mml:mfenced></mml:math><inline-graphic xlink:href="41587_2023_1734_Article_IEq2.gif"/></alternatives></inline-formula>, <italic>β</italic><sub><italic>V</italic></sub> and <italic>β</italic><sub>cyclo</sub> are parameters to be estimated.</p>
        <p id="Par63">To control for multiple testing, two-tailed <italic>P</italic> values were adjusted with BH procedure<sup><xref ref-type="bibr" rid="CR79">79</xref></sup>. This was applied on all contigs from the γδTCR, αβTCR and BCR sequencing data that were identified within high-quality annotated cells from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup> and results are shown in Supplementary Table <xref rid="MOESM3" ref-type="media">2</xref>, and it was also applied on contigs from the αβTCR and BCR sequencing data that were identified within high-quality annotated cells from control/cycloheximide-treated PBMCs and results are shown in Supplementary Table <xref rid="MOESM3" ref-type="media">3</xref>.</p>
      </sec>
      <sec id="Sec20">
        <title>Splicing site motif analysis</title>
        <p id="Par64">For the lists of 5′ end <italic>J</italic> genes that had significant (BH adjusted two-tailed <italic>P</italic> &lt; 0.05) association with increased or decreased multi-J mapping from Supplementary Table <xref rid="MOESM3" ref-type="media">2</xref>, the sequences of the last 11 nucleotides at each gene’s 3′ ends with the first ten nucleotides of its 3′ end intron were extracted from the 10X GRCh38 2020-A reference. Sequence logos shown in Fig. <xref rid="Fig2" ref-type="fig">2e</xref> were generated on <ext-link ext-link-type="uri" xlink:href="https://weblogo.berkeley.edu/logo.cgi">https://weblogo.berkeley.edu/logo.cgi</ext-link> (ref. <sup><xref ref-type="bibr" rid="CR80">80</xref></sup>).</p>
      </sec>
    </sec>
    <sec id="Sec21">
      <title>γδTCR annotation comparison</title>
      <p id="Par65">To compare our γδTCR annotations against the 10X cellranger vdj output in the 33 γδTCR libraries<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, we performed two additional mappings following 10X γδTCR support instructions. In one, the 5.0.0 reference was modified according to 10X instructions by replacing all instances of TRG with TRA and TRD with TRB. The reference was filtered to just TRG/TRD sequences before this replacement to avoid erroneous sequence overlaps. For the other, we performed the alignment with cellranger v7.0.0 with the accompanying reference (v7.0.0). The output of these two mappings was compared with the cellranger–Dandelion preprocessing pipeline described above. The number of high confidence γδTCR contigs and high confidence productive γδTCR contigs were determined for each mapping and each sample, and mappings were compared with the Wilcoxon signed-rank test. The effect size <italic>r</italic> is the rank correlation, which is the signed-rank test statistic divided by the total rank-sum<sup><xref ref-type="bibr" rid="CR81">81</xref></sup>.</p>
    </sec>
    <sec id="Sec22">
      <title>Differential V(D)J usage in adult T cell subsets</title>
      <p id="Par66">Preprocessed and annotated scRNA-seq data of TLC and ILCs with paired αβTCR information from ref. <sup><xref ref-type="bibr" rid="CR5">5</xref></sup> was downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.tissueimmunecellatlas.org/">https://www.tissueimmunecellatlas.org/</ext-link>. Only cells within the T cell subsets with paired αβTCR were included in the downstream analysis. T_CD4/CD8 was excluded as a low-quality cell cluster. The cells were then pseudobulked by donor ID and cell type, and the pseudobulk V(D)J feature space was created with TRAV, TRAJ, TRBV and TRBJ. Only pseudobulks with at least ten cells were kept. PCA, neighborhood graph and UMAP of the pseudobulk V(D)J feature space were computed using scanpy<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> (v1.9.1) with default settings (scanpy.pp.pca, scanpy.pp.neighbors, scanpy.tl.umap).</p>
      <p id="Par67">For low-level cell type annotations, Tem/emra_CD8, Tnaive/CM_CD8, Trm/em_CD8 and Trm_gut_CD8 were grouped into CD8<sup>+</sup> T, and Teffector/EM_CD4, Tfh, Tnaive/CM_CD4, Tnaive/CM_CD4_activated, Tregs and Trm_Th1/Th17 were grouped into CD4<sup>+</sup> T, while MAIT was left as a separate annotation. For differential V(D)J usage, Wilcoxon rank-sum test was performed using scanpy.tl.rank_genes_groups(method=‘wilcoxon’).</p>
    </sec>
    <sec id="Sec23">
      <title>Pseudotime inference from DP to mature T cells</title>
      <sec id="Sec24">
        <title>Data integration and filtering</title>
        <p id="Par68">scRNA-seq data of human fetal lymphoid cells from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup> was integrated with Dandelion preprocessed αβTCR, BCR and γδTCR data (see section ‘Nonproductive TCR/BCR contigs’, using all_contig_igblast_db-all.tsv for all samples) with dandelion.tl.transfer. Two samples from F67, F67_TH_CD137_FCAImmP7851896 and F67_TH_MAIT_FCAImmP7851897 were excluded from the analysis as they were sorted for specific T cell subpopulations, instead of the CD45 sorting in all other donor samples, and inclusion might result in biased TCR sampling within this donor. Only DP(P)_T, DP(Q)_T, ABT(ENTRY), CD8<sup>+</sup> T and CD4<sup>+</sup> T cells with productive TRA and TRB were included in the trajectory analysis. Neighborhood graph (scanpy.pp.neighbors(n_neighbors=50)) and UMAP (scanpy.tl.umap) were recalculated using scVI latent factors as the initial data was integrated with scVI<sup><xref ref-type="bibr" rid="CR82">82</xref></sup>.</p>
      </sec>
      <sec id="Sec25">
        <title>Pseudotime inference from neighborhood V(D)J feature space</title>
        <p id="Par69">Neighborhoods were sampled using Milo<sup><xref ref-type="bibr" rid="CR30">30</xref></sup> (milopy v0.1.0) (milo.make_nhoods). Cells were pseudobulked by the sampled neighborhoods and the V(D)J feature space was created with cells’ primary TRAV, TRAJ, TRBV and TRBJ genes. The cell type annotation of each neighborhood was assigned to be the most frequent annotation of the cells within that neighborhood. PCA, neighborhood graph and UMAP of the neighborhood V(D)J feature space were computed using scanpy<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> (v1.9.1) with default settings (scanpy.pp.pca, scanpy.pp.neighbors, scanpy.tl.umap).</p>
        <p id="Par70">For pseudotime trajectory analysis, Palantir<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> (v1.0.1) was used and diffusion map was computed using the first five principal components (PCs; (palantir.utils.run_diffusion_maps(n_components=5), palantir.utils.determine_multiscale_space). The root cell was chosen to be the DP(P) T neighborhood with the smallest value on UMAP1 axis, and the two terminal states were chosen with the largest and smallest values on the UMAP2 axis for CD4<sup>+</sup> T and CD8<sup>+</sup> T neighborhoods, respectively (Extended Data Fig. <xref rid="Fig8" ref-type="fig">3d</xref>). Pseudotime and branch probabilities to the terminal states were then computed with palantir.core.run_palantir(num_waypoints = <italic>500)</italic>.</p>
        <p id="Par71">Imputed pseudotime and branch probabilities were then projected back from neighborhoods (Fig. <xref rid="Fig3" ref-type="fig">3c</xref>) to cells (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, top panel) by averaging the parameters from all neighborhoods a given cell belongs to, weighted by the inverse of the neighborhood size. Cells that did not belong to any neighborhood were removed (91 of 17,248).</p>
        <p id="Par72">For pseudotime inferred with other trajectory inference methods as shown in Extended Data Fig. <xref rid="Fig12" ref-type="fig">7</xref>, monocle3 (ref<italic>.</italic>
<sup><xref ref-type="bibr" rid="CR44">44</xref></sup>; 0.2.3.0) was applied on the UMAP embedding of the neighborhood V(D)J feature space and diffusion pseudotime<sup><xref ref-type="bibr" rid="CR45">45</xref></sup> was applied using scanpy.tl.dpt function with default settings. The same root cell neighborhood was used as above.</p>
      </sec>
      <sec id="Sec26">
        <title>Pseudotime inference from neighborhood GEX feature space</title>
        <p id="Par73">Raw gene counts from scRNA-seq data were pseudobulked by the same cell neighborhoods as above. Data normalization and log transformation were performed using scanpy<sup><xref ref-type="bibr" rid="CR14">14</xref></sup> (v1.9.1) (scanpy.pp.normalize_per_cell(counts_per_cell_after=10e4) and scanpy.pp.log1p). Highly variable genes were then selected (scanpy.pp.highly_variable_genes), and PCA (scanpy.pp.pca), neighborhood graph (scanpy.pp.neighbors) and UMAP (scanpy.tl.umap) of the neighborhood GEX feature space were computed. Pseudotime trajectory inference was done similar to above with the first five PCs. The root cell was chosen to be the DP(P) T neighborhood with the smallest value on UMAP1 axis, and the two terminal states were chosen with the smallest and largest values on the UMAP2 axis for CD4<sup>+</sup> T and CD8<sup>+</sup> T neighborhoods, respectively (Extended Data Fig. <xref rid="Fig10" ref-type="fig">5c</xref>). Imputed pseudotime and branch probabilities were then projected back from neighborhoods (Extended Data Fig. <xref rid="Fig10" ref-type="fig">5d</xref>) to cells (Fig. <xref rid="Fig4" ref-type="fig">4a</xref>, bottom right panel).</p>
      </sec>
      <sec id="Sec27">
        <title>Pseudotime inference from single-cell GEX</title>
        <p id="Par74">Pseudotime trajectory inference was performed with Palantir<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> (v1.0.1) using the first 20 scVI latent factors. The root cell was chosen to be the DP(P) T cell with the largest value on UMAP2 axis, and the two terminal states were chosen with the largest value on the UMAP2 axis for CD8+ T and the smallest value on the UMAP1 axis for CD4<sup>+</sup> T cells, respectively (Extended Data Fig. <xref rid="Fig10" ref-type="fig">5a</xref>). Results of the inferred pseudotime and branch probabilities are shown in Extended Data Fig. <xref rid="Fig10" ref-type="fig">5b</xref>.</p>
      </sec>
      <sec id="Sec28">
        <title>Correlation between pseudotime ordering and relative TRAV/TRAJ locations</title>
        <p id="Par75">The relative genomic location of each TRAV gene was encoded numerically based on its order among all TRAV genes from 5′ to 3′ on the genome, and similarly for TRAJ. For each neighborhood, its relative TRAV or TRAJ location was computed by the average relative locations of all cells within that neighborhood. Only neighborhoods that had more than 90% cells being DP(Q) T cells were selected. The relative pseudotime order was plotted against the average relative TRAV or TRAJ location for each neighborhood in Fig. <xref rid="Fig4" ref-type="fig">4b</xref>. Local Pearson’s correlations were then computed over sliding windows of 30 adjacent neighborhoods on the pseudotime order (Extended Data Fig. <xref rid="Fig11" ref-type="fig">6a,b</xref>).</p>
      </sec>
      <sec id="Sec29">
        <title>Correlation between gene expression and branch probabilities to CD8<sup>+</sup> T in abT(entry) cells</title>
        <p id="Par76">Pearson’s correlations were computed between gene expression and branch probabilities to CD8<sup>+</sup> T lineage within abT(entry) cells for all genes. Two-tailed <italic>P</italic> values were adjusted for multiple testing with BH procedure. Results are shown in Fig. <xref rid="Fig4" ref-type="fig">4c</xref>, Extended Data Fig. <xref rid="Fig11" ref-type="fig">6d</xref> and Supplementary Table <xref rid="MOESM3" ref-type="media">6</xref>.</p>
      </sec>
    </sec>
    <sec id="Sec30">
      <title>VDJ-based dimensionality reduction with CoNGA</title>
      <p id="Par77">Preprocessed and annotated scRNA-seq data of human fetal lymphoid cells from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup> was downloaded from <ext-link ext-link-type="uri" xlink:href="https://developmental.cellatlas.io/fetal-immune">https://developmental.cellatlas.io/fetal-immune</ext-link>. Matching αβTCR samples had their all_contig_annotations.csv cellranger output files flagged with the sample IDs for both cell and contig IDs and were subsequently merged into a single file and subset to just high confidence contigs for cells present in the scRNA-seq object. This file was used on input for <italic>CoNGA</italic>’s<sup><xref ref-type="bibr" rid="CR21">21</xref></sup> (v0.1.1) setup_10x_for_conga.py script, which produced a tcrdist-based PCA representation of the cells’ VDJ data. The PCA coordinates were used to compute a neighborhood graph and UMAP representation (Extended Data Fig. <xref rid="Fig9" ref-type="fig">4a</xref>), using default scanpy settings.</p>
    </sec>
    <sec id="Sec31">
      <title>Joint embedding of single-cell gene expression and TCR with mvTCR</title>
      <p id="Par78">The same cells for which we performed pseudotime inference from DP to mature T cells above were used in the mvTCR<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> (version under development, cloned from the repo at commit 528d3e11a360fc4b0f09d782b88f5ec7de9283d6) trial. Clonotypes were called based on CDR3 nucleotide sequence identity of the cells’ primary TRA and TRB chains (scirpy.pp.ir_dist, and scirpy.tl.define_clonotypes(receptor_arms=’all’, dual_ir=’primary_only’)).</p>
      <p id="Par79">Normalized and log-transformed data were used as recommended in mvTCR’s tutorial. The donor ID was one-hot encoded and supplied as a conditional variable. Eighty percent of cells were used as training data, the remaining 20% for validation. The models were trained for 200 epochs. Three runs were performed with the GEX to TCR ratio varying between 1:1, 2:1 and 3:1. Each run produced 15 trials and each trial had a different combination of model hyperparameters resulting from an automated hyperparameter grid search. The ‘best’ trial (lowest validation loss) was indicated at the end of each run; however, when we manually inspected all the trial results, we found the ‘best’ trials showed strong variations between different donors. Thus, we selected one representative result from each run with minimal cross-donor batch effects for Extended Data Fig. <xref rid="Fig9" ref-type="fig">4b</xref>.</p>
    </sec>
    <sec id="Sec32">
      <title>Pseudotime inference combining ILC/NK and T cells</title>
      <sec id="Sec33">
        <title>Pseudotime inference using TRBJ</title>
        <p id="Par80">scRNA-seq data of human fetal lymphoid cells from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup> was integrated with αβTCR data as described above. Only DN(early)_T, DN(P)_T, DN(Q)_T, DP(P)_T, DP(Q)_T, ILC2, ILC3, CYCLING_ILC, NK and CYCLING_NK cells with TRBJ were included for the trajectory analysis. Neighborhood graph (<italic>k</italic> = 50) and UMAP were recalculated using scVI latent factors similar to those above.</p>
        <p id="Par81">For pseudotime trajectory analysis, Palantir<sup><xref ref-type="bibr" rid="CR32">32</xref></sup> (v1.0.1) was used and a diffusion map was computed using the first five PCs. The root cell was chosen to be the neighborhood with the highest CD34 expression, and the two terminal states were chosen with the largest and smallest values on the UMAP1 axis for T and NK/ILC cell neighborhoods, respectively (Extended Data Fig. <xref rid="Fig15" ref-type="fig">10a</xref>). Pseudotime and branch probabilities to the terminal states were then computed and projected back from neighborhoods (Fig. <xref rid="Fig5" ref-type="fig">5b</xref>) to cells (Fig. <xref rid="Fig5" ref-type="fig">5c</xref> top panel).</p>
      </sec>
      <sec id="Sec34">
        <title>Gene expression trend in DN T cells along pseudotime</title>
        <p id="Par82">Chatterjee’s correlations<sup><xref ref-type="bibr" rid="CR73">73</xref></sup> were computed between gene expression and inferred pseudotime within DN T cells for all genes that were expressed in at least 50 cells. Chatterjee’s correlation was chosen instead of Pearson’s or Spearman’s correlation to look for any functional change and not restricted to a monotonic change. TFs<sup><xref ref-type="bibr" rid="CR83">83</xref></sup> and genes encoding cell surface proteins that had significantly high Chatterjee’s correlation with pseudotime (BH adjusted <italic>P</italic> &lt; 0.05; correlation coefficient &gt;0.1) were shown in Fig. <xref rid="Fig5" ref-type="fig">5c</xref> and Extended Data Fig. <xref rid="Fig15" ref-type="fig">10b</xref>, respectively.</p>
      </sec>
    </sec>
    <sec id="Sec35">
      <title>Other visualization</title>
      <p id="Par83">In general, results were plotted using <italic>seaborn</italic> (v0.11.1; python) or ggplot2 (v3.3.3; R). Other single-cell plots were plotted using scanpy (v1.9.1). Visualization of Milo neighborhood graphs was plotted in R using ggraph (v2.1.0) and igraph (v1.2.6). Correlation/volcano plots were plotted in R using ggplot2 (v3.3.3). dplyr (v1.0.5) was used for general data frame handling for plotting in R.</p>
    </sec>
    <sec id="Sec36">
      <title>Reporting summary</title>
      <p id="Par84">Further information on research design is available in the <xref rid="MOESM2" ref-type="media">Nature Portfolio Reporting Summary</xref> linked to this article.</p>
    </sec>
  </sec>
  <sec id="Sec37" sec-type="materials|methods">
    <title>Online content</title>
    <p id="Par85">Any methods, additional references, Nature Portfolio reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at 10.1038/s41587-023-01734-7.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <sec id="Sec39">
      <title>Supplementary information</title>
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="41587_2023_1734_MOESM1_ESM.pdf">
            <label>Supplementary Information</label>
            <caption>
              <p>Supplementary Fig. 1 and Supplementary Note.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="41587_2023_1734_MOESM2_ESM.pdf">
            <caption>
              <p>Reporting Summary</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="41587_2023_1734_MOESM3_ESM.xlsx">
            <label>Supplementary Tables 1–6</label>
            <caption>
              <p>Table 1: Top ten <italic>J</italic> gene combinations with multi-J mapping for each locus in data from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, with the number of contigs containing each combination shown next to it. Table 2: Logistic regression results exploring factors associated with multi-J mapping presence in data from ref. <sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Table 3: Logistic regression results exploring factors associated with multi-J mapping presence in control and cycloheximide-treated PBMC data. Table 4: List of leftmost (5′ end) <italic>J</italic> genes that had significant association with increased or decreased multi-J mapping, together with the sequences of their last 10 nucleotides at 3′ ends and the first 11 nucleotides of its 3′ end intron. Table 5: Differential V(D)J usage across CD4<sup>+</sup> T, CD8<sup>+</sup> T, and MAIT cells in data from ref. <sup><xref ref-type="bibr" rid="CR5">5</xref></sup>. Table 6: Pearson’s correlation coefficients and BH adjusted <italic>P</italic> values of all genes with branch probabilities to CD8<sup>+</sup> T lineage within abT(entry) cells. [cor_tcr] Pearson’s correlation coefficients for pseudotime inferred from neighborhood V(D)J space. [pval_tcr] Pearson’s correlation <italic>P</italic> values for pseudotime inferred from neighborhood V(D)J space. [adjp_tcr] <italic>P</italic> values from pval_tcr adjusted by BH procedure. [cor_gex] Pearson’s correlation coefficients for pseudotime inferred from neighborhood GEX space.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <app-group>
    <app id="App1">
      <sec id="Sec38">
        <title>Extended data</title>
        <p id="Par90">
          <fig id="Fig6">
            <label>Extended Data Fig. 1</label>
            <caption>
              <title>List of features included in AIR repertoire analysis pipelines.</title>
              <p>A table outlining the features of a non-exhaustive list of other methods compared to <italic>Dandelion</italic>. Handling of non-productive contigs (with or without V gene annotation) is not common across the various software packages. While the <italic>Immcantation</italic> workflow is capable of handling the data, contigs without V genes are typically diverted to a ‘failed’ file but can be retrieved separately. The output from <italic>Dandelion</italic> is compatible with any AIRR-compliant software for example <italic>Dandelion</italic> output can be passed to <italic>Immcantation</italic> to perform phylogenetic lineage inference.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig6_ESM" id="d32e2485"/>
          </fig>
        </p>
        <p id="Par91">
          <fig id="Fig7">
            <label>Extended Data Fig. 2</label>
            <caption>
              <title><italic>Dandelion</italic> offers improved contig annotations.</title>
              <p><bold>a</bold>, Left: barplot of proportion of contigs that are productive or non-productive in each locus. Right: barplot showing the causes of non-productive contigs in each locus. For both plots, sc-γδTCR, -αβTCR and -BCR data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="CR3">3</xref></sup> excluding thymus samples. <bold>b</bold>, Schematic illustration showing that mRNA without V genes would be captured by 5′RACE + Switch oligo technique but not by multiplex PCR strategy. <bold>c</bold>, Pointplot of proportion of contigs with multi-J mapping in the presence of V gene in control and cycloheximide-treated PBMC samples. Points are colored by locus of TCR/BCR. For both IGH and IGL/IGK, the proportions were 0% in control and treated. <bold>d</bold>, Schematic illustration showing the factors associated with multi-J mapping and the proposed mechanisms. <bold>e</bold>, Boxplots of sc-γδTCR contig counts annotated by 10X <italic>cellranger vdj</italic> v6.1.2 <italic>versus</italic> v7.0.0 using data from n = 33 independent samples from Suo et al. 2022<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Left: all high confidence contigs (<italic>P</italic>-value 5.43e-6, r 0.91 in the two-sided Wilcoxon signed-rank test). Right: high confidence productive contigs (<italic>P</italic>-value 1.69e-6, r 0.96 in the two-sided Wilcoxon signed-rank test). Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig7_ESM" id="d32e2535"/>
          </fig>
        </p>
        <p id="Par92">
          <fig id="Fig8">
            <label>Extended Data Fig. 3</label>
            <caption>
              <title>V(D)J feature space.</title>
              <p><bold>a</bold>, Gene expression UMAP of all T cells from Conde et al. 2022<sup><xref ref-type="bibr" rid="CR5">5</xref></sup>, colored by donor ID (left) or high-level cell type annotations (right). Each point represents a cell. <bold>b</bold>, UMAP of the pseudo-bulk V(D)J feature space of the same cells as in <bold>a</bold>, colored by donor ID (left) or high-level cell type annotations (right). Each point represents a cell pseudo-bulk. <bold>c</bold>, Left: UMAP of DP to mature T cells with paired productive αβTCR in data from Suo et al. 2022<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Each point represents a cell, colored by cell types. Right: cell neighborhood graph on the same UMAP embedding. Each point represents a cell neighborhood, colored by cell types. The point size represents neighborhood size, with connecting edges representing overlapping cell numbers between any two neighborhoods. Only edges with more than 30 overlapping cells are shown. The layout of nodes is determined by the position of the neighborhood index cell in the UMAP on the left. <bold>d</bold>, The root cell and terminal states selected for pseudotime inference in Fig. <xref rid="Fig3" ref-type="fig">3c</xref>. <bold>e</bold>, Gene expression trends over CD8 + T pseudotime imputed with <italic>Palantir</italic><sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. Only the top 10 most frequently used TRAV or TRAJ genes are shown.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig8_ESM" id="d32e2582"/>
          </fig>
        </p>
        <p id="Par93">
          <fig id="Fig9">
            <label>Extended Data Fig. 4</label>
            <caption>
              <title>Embedding with alternative methods.</title>
              <p><bold>a</bold>, UMAP representation of tcrdist-derived PCA coordinates of VDJ data computed by CoNGA<sup><xref ref-type="bibr" rid="CR21">21</xref></sup>, with the same dataset as used in Supplementary Fig. <xref rid="MOESM1" ref-type="media">3c</xref>, colored by cell types. <bold>b</bold>, UMAP representation of joint gene expression and TCR embedding computed by mvTCR<sup><xref ref-type="bibr" rid="CR22">22</xref></sup> with varying weights for GEX and VDJ input, on the same dataset as used in Supplementary Fig. <xref rid="MOESM1" ref-type="media">3c</xref>. Cells are colored by donor ID (top panel) or cell types (bottom panel).</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig9_ESM" id="d32e2613"/>
          </fig>
        </p>
        <p id="Par94">
          <fig id="Fig10">
            <label>Extended Data Fig. 5</label>
            <caption>
              <title>T cell development pseudotime inference comparison.</title>
              <p><bold>a</bold>, DP to mature T cells with paired productive αβTCR in data from Suo et al. 2022<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>, on the same UMAP embedding as in Fig. <xref rid="Fig4" ref-type="fig">4a</xref> and Supplementary Fig. <xref rid="MOESM1" ref-type="media">3c</xref>. The first two panels show the root cell and terminal states selected for pseudotime inferred directly from single-cell gene expression. The last panel shows the cell types. <bold>b</bold>, Top: pseudotime and branch probabilities inferred directly from single-cell gene expression on the same UMAP embedding as in <bold>a</bold>. Bottom: scatterplot of branch probability to CD8+ T against pseudotime. Each point represents a cell. <bold>c</bold>, UMAP of neighborhood GEX space, with the same neighborhoods as sampled in Supplementary Fig. <xref rid="MOESM1" ref-type="media">3c</xref> and UMAP embedding computed on gene expression pseudo-bulked by neighborhoods. Each point represents a cell neighborhood. The first two panels show the root cell and terminal states selected for pseudotime inferred from neighborhood GEX space. The last panel shows the cell types. <bold>d</bold>, Inferred pseudotime, and branch probabilities to CD8+ T and to CD4+ T respectively overlaid onto the same UMAP embedding in <bold>c</bold>.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig10_ESM" id="d32e2656"/>
          </fig>
        </p>
        <p id="Par95">
          <fig id="Fig11">
            <label>Extended Data Fig. 6</label>
            <caption>
              <title>Comparing pseudotime inferred from neighborhood V(D)J space or GEX space.</title>
              <p><bold>a</bold>, Pearson’s correlation coefficients of pseudotime order and average relative TRAV location over sliding windows of 30 adjacent neighborhoods on the pseudotime order (left: pseudotime inferred from neighborhood V(D)J space; right: pseudotime inferred from neighborhood GEX space). <italic>Y</italic>-axis is the correlation coefficient and the x-axis is the median pseudotime order of the 30 adjacent neighborhoods. The color of the points represents statistical significance (orange: <italic>P</italic>-value from the Pearson’s correlation &lt; 0.05; blue: <italic>P</italic>-value ≥ 0.05). The red dashed lines mark the correlation coefficient of 0. <bold>b</bold>, The same plot as in a but for TRAJ. <bold>c</bold>, Scatterplots of branch probability to CD8+ T against pseudotime in abT(entry) cells. Each point represents a cell. Top panel: pseudotime inferred from neighborhood V(D)J space as in Fig. <xref rid="Fig4" ref-type="fig">4a</xref> top panel. Bottom panel: pseudotime inferred from neighborhood GEX space as in Fig. <xref rid="Fig4" ref-type="fig">4a</xref> bottom right panel. <bold>d</bold>, Volcano plot summarizing results of TFs that are correlated with branch probabilities to CD8+ T lineage in V(D)J pseudotime within abT(entry) cells. The <italic>y</italic>-axis is the -log<sub>10</sub>(BH adjusted <italic>P</italic>-value) and the <italic>x</italic>-axis is the correlation coefficient. Labeled TFs that had significant (BH adjusted <italic>P</italic>-value &lt; 0.05) positive correlations (correlation coefficient &gt; 0.1) were colored in red, the ones with significant negative correlations (correlation coefficient &lt; −0.1) were colored in blue, and the rest were colored in black.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig11_ESM" id="d32e2710"/>
          </fig>
        </p>
        <p id="Par96">
          <fig id="Fig12">
            <label>Extended Data Fig. 7</label>
            <caption>
              <title>Pseudotime inferred with different trajectory inference methods.</title>
              <p><bold>a</bold>, First three panels display pseudotime inferred from neighborhood V(D)J space using <italic>Palantir</italic><sup><xref ref-type="bibr" rid="CR32">32</xref></sup>, <italic>monocle3</italic><sup><xref ref-type="bibr" rid="CR44">44</xref></sup>, and <italic>diffusion pseudotime</italic><sup><xref ref-type="bibr" rid="CR45">45</xref></sup> respectively, overlaid onto the same UMAP embedding as in Fig. <xref rid="Fig3" ref-type="fig">3c</xref> with each point represents a cell neighborhood. The fourth panel represents the pseudotime inferred from neighborhood GEX space using <italic>Palantir</italic><sup><xref ref-type="bibr" rid="CR32">32</xref></sup>. The last panel represents the dominant cell type in each neighborhood. b, Scatterplots of the pseudotime ordering against the average relative TRAV (top) and TRAJ (bottom) location. Each point represents a cell neighborhood. Each TRAV or TRAJ gene is encoded numerically for its relative genomic order. The <italic>x</italic>-axis represents the average TRAV/TRAJ relative location for each cell neighborhood. The <italic>y</italic>-axis represents the pseudotime order inferred from neighborhood V(D)J space using <italic>Palantir</italic><sup><xref ref-type="bibr" rid="CR32">32</xref></sup>, <italic>monocle3</italic><sup><xref ref-type="bibr" rid="CR44">44</xref></sup>, and <italic>diffusion pseudotime</italic><sup><xref ref-type="bibr" rid="CR45">45</xref></sup>, and the pseudotime order inferred from neighborhood GEX space using <italic>Palantir</italic><sup><xref ref-type="bibr" rid="CR32">32</xref></sup> respectively. The Pearson’s correlations are −0.95, −0.91, −0.95, and −0.90 respectively (<italic>P</italic>-values of 4.8e-76, 4.9e-56, 2.1e-74, and 7.4e-54) for TRAV, and 0.93, 0.90, 0.93, and 0.89 respectively (<italic>P</italic>-values of 1.7e-62, 3.8e-54, 7.6e-65, and 4.2e-52) for TRAJ.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig12_ESM" id="d32e2790"/>
          </fig>
        </p>
        <p id="Par97">
          <fig id="Fig13">
            <label>Extended Data Fig. 8</label>
            <caption>
              <title>Non-productive BCR and TCR.</title>
              <p><bold>a,b,c</bold>, Boxplot of the proportion of cells with productive (blue) or non-productive (orange) BCR light chain (<bold>a</bold>) and heavy chain (<bold>b</bold>), and TRB (<bold>c</bold>) in different fetal lymphocyte subsets. Each point represents a sample and data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Only samples with at least 20 cells are shown. Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box. <bold>d</bold>, Barplot showing the VDJ composition of non-productive TRB contigs in selected lymphocyte subsets from Fig. <xref rid="Fig5" ref-type="fig">5a</xref>.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig13_ESM" id="d32e2824"/>
          </fig>
        </p>
        <p id="Par98">
          <fig id="Fig14">
            <label>Extended Data Fig. 9</label>
            <caption>
              <title>Non-productive TCR.</title>
              <p><bold>a</bold>–<bold>c</bold>, Boxplot of the proportion of cells with productive (blue) or non-productive (orange) TRA (<bold>a</bold>), TRG (<bold>b</bold>) and TRD (<bold>c</bold>) in different fetal lymphocyte subsets. Each point represents a sample and data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="CR3">3</xref></sup>. Only samples with at least 20 cells are shown. Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box. <bold>d</bold>, Boxplot of the proportion of cells with non-productive TRB in different fetal lymphocyte subsets, colored by organs. Each point represents a sample. Only samples with at least 20 cells are shown. Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box. Sample sizes (n) of all box plots from left to right are 3, 12, 10, 15, 13, 13, 1, 1, 4, 2, 12, 3, 2, 8, 3, 1, 2, 1, 12, 3, 2, 8, 2, 1, 2, 12, 3, 2, 7, 1, 12, 1, 2, 6, 1, 12, 1, 2, 8, 2, 2, 4, 3, 1, 4, 2, 7, 3, 2, 6, 3, 1, 4, 5, 3, 2, 7, 6, 1, 7, 8, 3, 3, 2, 8, 5, 2, 7, 1, 1, 3, 2, 7, 2, 1, 4, 2, 1, 1, 3, 10, 1, 4, 11, 1, 2, 3, 10, 1, 1, 7, 10, 1, 2, 1, 7, 9, 2, 5, 1, 4, 3, 1, 6, 5, 6, 1, 3, 2, 8, 2, 1, 3, 1, 2, 3, 2, 3, 3.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig14_ESM" id="d32e2858"/>
          </fig>
        </p>
        <p id="Par99">
          <fig id="Fig15">
            <label>Extended Data Fig. 10</label>
            <caption>
              <title>TRBJ-based trajectory for ILC/NK/T cell lineage.</title>
              <p><bold>a</bold>, Neighborhood V(D)J feature space covering ILC, NK and developing T cells with TRBJ on the same UMAP embedding as in Fig. <xref rid="Fig5" ref-type="fig">5b</xref>. The first two panels show the root cell and terminal states selected for pseudotime inference. The last panel shows the cell types. <bold>b</bold>, Heatmap of gene expression for genes encoding cell surface proteins across pseudotime in DN T cells. Pseudotime is equally divided into 100 bins, and the average gene expression is calculated for DN T cells with pseudotime that falls within each bin. Genes selected here had significantly high Chatterjee’s correlation with pseudotime (BH adjusted <italic>P</italic>-value &lt; 0.05, and correlation coefficient &gt; 0.1). <bold>c</bold>, Heatmap of gene expression for TFs known to be important in mouse DN T cell development<sup><xref ref-type="bibr" rid="CR53">53</xref></sup>, across pseudotime in human fetal DN T cells. TFs that showed discordant expression patterns between mouse and human are highlighted in red.</p>
            </caption>
            <graphic position="anchor" xlink:href="41587_2023_1734_Fig15_ESM" id="d32e2888"/>
          </fig>
        </p>
      </sec>
    </app>
  </app-group>
  <fn-group>
    <fn>
      <p><bold>Publisher’s note</bold> Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>These authors contributed equally: Chenqu Suo, Krzysztof Polanski.</p>
    </fn>
    <fn>
      <p>These authors jointly supervised this work: Zewen Kelvin Tuong, Menna R. Clatworthy, Sarah A. Teichmann.</p>
    </fn>
  </fn-group>
  <sec>
    <sec id="FPar1">
      <title>Extended data</title>
      <p id="Par86">is available for this paper at 10.1038/s41587-023-01734-7.</p>
    </sec>
    <sec id="FPar2" sec-type="supplementary-material">
      <title>Supplementary information</title>
      <p id="Par87">The online version contains supplementary material available at 10.1038/s41587-023-01734-7.</p>
    </sec>
  </sec>
  <ack>
    <title>Acknowledgements</title>
    <p>We acknowledge the Cellular Genetics IT, New Pipeline Group and DNA pipelines of Sanger Institute. K.B.M. and S.A.T. are supported by Wellcome (WT211276/Z/18/Z, 108413/A/15/D, Sanger core grant WT206194 and Sanger QQ award 220540/Z/20/A). K.B.M. acknowledges funding from the MRC (MR/S035907/1). M.H. is supported by Wellcome (grant WT107931/Z/15/Z), the Lister Institute for Preventive Medicine, NIHR, and the Newcastle Biomedical Research Centre. S.A.T. is supported by an ERC Consolidator Grant ThDEFINE (646794). C.S. is supported by a Wellcome Trust Ph.D. Fellowship for Clinicians. Z.K.T. and M.R.C. are supported by a Medical Research Council Research Project Grant (MR/S035842/1). M.R.C. is supported by the National Institute of Health Research (NIHR) Research Professorship (RP-2017-08-ST2-002), a Wellcome Investigator Award (220268/Z/20/Z), the Blood and Transplant Research Unit in Organ Donation and the NIHR Cambridge Biomedical Research Centre. This publication is part of the Human Cell Atlas (<ext-link ext-link-type="uri" xlink:href="http://www.humancellatlas.org/publications">www.humancellatlas.org/publications</ext-link>). We would like to thank the reviewers for their thoughtful comments and suggestions, which helped us to improve the quality of the manuscript.</p>
  </ack>
  <notes notes-type="author-contribution">
    <title>Author contributions</title>
    <p>C.S., Z.K.T., M.R.C. and S.A.T. conceived the initial project. C.S. and Z.K.T. set up and directed the study. C.S., K.P., E.D. and Z.K.T. performed bioinformatic analyses. C.S., K.P. and Z.K.T developed the software. C.S. and R.V.B. performed cell culture experiments. E.D., R.G.H.L., R.V.B., R.V., M.H., K.B.M., M.R.C. and S.A.T. provided intellectual input. M.R.C. and S.A.T. acquired funding. C.S., K.P. and Z.K.T. wrote the manuscript. All authors read and/or edited the manuscript.</p>
  </notes>
  <notes notes-type="peer-review">
    <title>Peer review</title>
    <sec id="FPar3">
      <title>Peer review information</title>
      <p id="Par88"><italic>Nature Biotechnology</italic> thanks Francesca Finotello, Kelly McNagny, and the other, anonymous, reviewer for their contribution to the peer review of this work.</p>
    </sec>
  </notes>
  <notes notes-type="data-availability">
    <title>Data availability</title>
    <p>Raw sequencing data for newly generated sequencing libraries have been deposited in ArrayExpress (accession number <ext-link ext-link-type="uri" xlink:href="http://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-12524/">E-MTAB-12524</ext-link>). Other datasets used are available at <ext-link ext-link-type="uri" xlink:href="https://developmental.cellatlas.io/fetal-immune">https://developmental.cellatlas.io/fetal-immune</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://www.tissueimmunecellatlas.org/">https://www.tissueimmunecellatlas.org/</ext-link>.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Code availability</title>
    <p>Dandelion is implemented as an open-source package in Python 3 (<ext-link ext-link-type="uri" xlink:href="https://github.com/zktuong/dandelion">https://github.com/zktuong/dandelion</ext-link>) with tutorials available at <ext-link ext-link-type="uri" xlink:href="https://sc-dandelion.readthedocs.io/en/latest/">https://sc-dandelion.readthedocs.io/en/latest/</ext-link>. The tool and workflow are also available through an interactive online Google Colab notebook at <ext-link ext-link-type="uri" xlink:href="https://colab.research.google.com/github/zktuong/dandelion/blob/master/container/dandelion_singularity.ipynb">https://colab.research.google.com/github/zktuong/dandelion/blob/master/container/dandelion_singularity.ipynb</ext-link>. Code and data used to generate figures and perform analyses in the manuscript are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/zktuong/dandelion-demo-files/dandelion_manuscript">https://github.com/zktuong/dandelion-demo-files/dandelion_manuscript</ext-link>.</p>
  </notes>
  <notes id="FPar4" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par89">In the past three years, S.A.T. has received remuneration for Scientific Advisory Board Membership from Sanofi, GlaxoSmithKline, Foresite Labs and Qiagen. S.A.T. is a cofounder and holds equity in Transition Bio. Z.K.T. has received consulting fees from Synteny Biotechnologies Ltd. on activities unrelated to this manuscript. The remaining authors declare no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Single-cell RNA sequencing to explore immune cell heterogeneity</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2018</year>
        <volume>18</volume>
        <fpage>35</fpage>
        <lpage>45</lpage>
        <pub-id pub-id-type="doi">10.1038/nri.2017.76</pub-id>
        <?supplied-pmid 28787399?>
        <pub-id pub-id-type="pmid">28787399</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Efremova</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Vento-Tormo</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>J-E</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>James</surname>
            <given-names>KR</given-names>
          </name>
        </person-group>
        <article-title>Immunology in the era of single-cell technologies</article-title>
        <source>Annu. Rev. Immunol.</source>
        <year>2020</year>
        <volume>38</volume>
        <fpage>727</fpage>
        <lpage>757</lpage>
        <pub-id pub-id-type="doi">10.1146/annurev-immunol-090419-020340</pub-id>
        <?supplied-pmid 32075461?>
        <pub-id pub-id-type="pmid">32075461</pub-id>
      </element-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Suo</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping the developing human immune system across organs</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>376</volume>
        <fpage>eabo0510</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abo0510</pub-id>
        <?supplied-pmid 35549310?>
        <pub-id pub-id-type="pmid">35549310</pub-id>
      </element-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stephenson</surname>
            <given-names>E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell multi-omics analysis of the immune response in COVID-19</article-title>
        <source>Nat. Med.</source>
        <year>2021</year>
        <volume>27</volume>
        <fpage>904</fpage>
        <lpage>916</lpage>
        <pub-id pub-id-type="doi">10.1038/s41591-021-01329-2</pub-id>
        <?supplied-pmid 33879890?>
        <pub-id pub-id-type="pmid">33879890</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Domínguez Conde</surname>
            <given-names>C</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Cross-tissue immune cell analysis reveals tissue-specific features in humans</article-title>
        <source>Science</source>
        <year>2022</year>
        <volume>376</volume>
        <fpage>eabl5197</fpage>
        <pub-id pub-id-type="doi">10.1126/science.abl5197</pub-id>
        <?supplied-pmid 35549406?>
        <pub-id pub-id-type="pmid">35549406</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Park</surname>
            <given-names>J-E</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A cell atlas of human thymic development defines T cell repertoire formation</article-title>
        <source>Science</source>
        <year>2020</year>
        <volume>367</volume>
        <fpage>eaay3224</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aay3224</pub-id>
        <?supplied-pmid 32079746?>
        <pub-id pub-id-type="pmid">32079746</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <mixed-citation publication-type="other">Lance, C. et al. Multimodal single cell data integration challenge: results and lessons learned. Preprint at <italic>bioRxiv</italic>10.1101/2022.04.11.487796 (2022).</mixed-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lee</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Hyeon</surname>
            <given-names>DY</given-names>
          </name>
          <name>
            <surname>Hwang</surname>
            <given-names>D</given-names>
          </name>
        </person-group>
        <article-title>Single-cell multiomics: technologies and data analysis methods</article-title>
        <source>Exp. Mol. Med.</source>
        <year>2020</year>
        <volume>52</volume>
        <fpage>1428</fpage>
        <lpage>1442</lpage>
        <pub-id pub-id-type="doi">10.1038/s12276-020-0420-2</pub-id>
        <?supplied-pmid 32929225?>
        <pub-id pub-id-type="pmid">32929225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Roth</surname>
            <given-names>DB</given-names>
          </name>
        </person-group>
        <article-title>V(D)J recombination: mechanism, errors, and fidelity</article-title>
        <source>Microbiol. Spectr.</source>
        <year>2014</year>
        <pub-id pub-id-type="doi">10.1128/microbiolspec.mdna3-0041-2014</pub-id>
        <?supplied-pmid 26104458?>
        <pub-id pub-id-type="pmid">26104458</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vander Heiden</surname>
            <given-names>JA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>AIRR community standardized representations for annotated immune repertoires</article-title>
        <source>Front. Immunol.</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>2206</fpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2018.02206</pub-id>
        <pub-id pub-id-type="pmid">30323809</pub-id>
      </element-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rubelt</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Adaptive Immune Receptor Repertoire Community recommendations for sharing immune-repertoire sequencing data</article-title>
        <source>Nat. Immunol.</source>
        <year>2017</year>
        <volume>18</volume>
        <fpage>1274</fpage>
        <lpage>1278</lpage>
        <pub-id pub-id-type="doi">10.1038/ni.3873</pub-id>
        <?supplied-pmid 29144493?>
        <pub-id pub-id-type="pmid">29144493</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Breden</surname>
            <given-names>F</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Reproducibility and reuse of adaptive immune receptor repertoire data</article-title>
        <source>Front. Immunol.</source>
        <year>2017</year>
        <volume>8</volume>
        <fpage>1418</fpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2017.01418</pub-id>
        <?supplied-pmid 29163494?>
        <pub-id pub-id-type="pmid">29163494</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sturm</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Scirpy: a Scanpy extension for analyzing single-cell T-cell receptor-sequencing data</article-title>
        <source>Bioinformatics</source>
        <year>2020</year>
        <volume>36</volume>
        <fpage>4817</fpage>
        <lpage>4818</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btaa611</pub-id>
        <?supplied-pmid 32614448?>
        <pub-id pub-id-type="pmid">32614448</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Angerer</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title>
        <source>Genome Biol.</source>
        <year>2018</year>
        <volume>19</volume>
        <fpage>15</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id>
        <?supplied-pmid 29409532?>
        <pub-id pub-id-type="pmid">29409532</pub-id>
      </element-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Borcherding</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Bormann</surname>
            <given-names>NL</given-names>
          </name>
          <name>
            <surname>Kraus</surname>
            <given-names>G</given-names>
          </name>
        </person-group>
        <article-title>scRepertoire: an R-based toolkit for single-cell immune receptor analysis</article-title>
        <source>F1000Res.</source>
        <year>2020</year>
        <volume>9</volume>
        <fpage>47</fpage>
        <pub-id pub-id-type="doi">10.12688/f1000research.22139.1</pub-id>
        <?supplied-pmid 32789006?>
        <pub-id pub-id-type="pmid">32789006</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Smibert</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2018</year>
        <volume>36</volume>
        <fpage>411</fpage>
        <lpage>420</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id>
        <?supplied-pmid 29608179?>
        <pub-id pub-id-type="pmid">29608179</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fischer</surname>
            <given-names>DS</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Schubert</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Predicting antigen specificity of single T cells based on TCR CDR3 regions</article-title>
        <source>Mol. Syst. Biol.</source>
        <year>2020</year>
        <volume>16</volume>
        <fpage>e9416</fpage>
        <pub-id pub-id-type="doi">10.15252/msb.20199416</pub-id>
        <?supplied-pmid 32779888?>
        <pub-id pub-id-type="pmid">32779888</pub-id>
      </element-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yermanos</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Platypus: an open-access software for integrating lymphocyte single-cell immune repertoires with transcriptomes</article-title>
        <source>NAR Genom. Bioinform.</source>
        <year>2021</year>
        <volume>3</volume>
        <fpage>lqab023</fpage>
        <pub-id pub-id-type="doi">10.1093/nargab/lqab023</pub-id>
        <?supplied-pmid 33884369?>
        <pub-id pub-id-type="pmid">33884369</pub-id>
      </element-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <mixed-citation publication-type="other">Popov, A. immunomind/immunarch: Immunarch 0.7.0. Zenodo. 10.5281/zenodo.6984421 (2022).</mixed-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pogorelyy</surname>
            <given-names>MV</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Detecting T cell receptors involved in immune responses from single repertoire snapshots</article-title>
        <source>PLoS Biol.</source>
        <year>2019</year>
        <volume>17</volume>
        <fpage>e3000314</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pbio.3000314</pub-id>
        <?supplied-pmid 31194732?>
        <pub-id pub-id-type="pmid">31194732</pub-id>
      </element-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schattgen</surname>
            <given-names>SA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Integrating T cell receptor sequences and transcriptional profiles by clonotype neighbor graph analysis (CoNGA)</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>54</fpage>
        <lpage>63</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-00989-2</pub-id>
        <?supplied-pmid 34426704?>
        <pub-id pub-id-type="pmid">34426704</pub-id>
      </element-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Drost, F. et al. Integrating T-cell receptor and transcriptome for large-scale single-cell immune profiling analysis. Preprint at <italic>bioRxiv</italic>10.1101/2021.06.24.449733 (2021).</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gupta</surname>
            <given-names>NT</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Change-O: a toolkit for analyzing large-scale B cell immunoglobulin repertoire sequencing data</article-title>
        <source>Bioinformatics</source>
        <year>2015</year>
        <volume>31</volume>
        <fpage>3356</fpage>
        <lpage>3358</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btv359</pub-id>
        <?supplied-pmid 26069265?>
        <pub-id pub-id-type="pmid">26069265</pub-id>
      </element-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <mixed-citation publication-type="other">Virshup, I., Rybakov, S., Theis, F. J., Angerer, P. &amp; Alexander Wolf, F. anndata: annotated data. Preprint at <italic>bioRxiv</italic>10.1101/2021.12.16.473007 (2021).</mixed-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ye</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Ma</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Madden</surname>
            <given-names>TL</given-names>
          </name>
          <name>
            <surname>Ostell</surname>
            <given-names>JM</given-names>
          </name>
        </person-group>
        <article-title>IgBLAST: an immunoglobulin variable domain sequence analysis tool</article-title>
        <source>Nucleic Acids Res.</source>
        <year>2013</year>
        <volume>41</volume>
        <fpage>W34</fpage>
        <lpage>W40</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/gkt382</pub-id>
        <?supplied-pmid 23671333?>
        <pub-id pub-id-type="pmid">23671333</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lefranc</surname>
            <given-names>MP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>IMGT, the international ImMunoGeneTics database</article-title>
        <source>Nucleic Acids Res.</source>
        <year>1999</year>
        <volume>27</volume>
        <fpage>209</fpage>
        <lpage>212</lpage>
        <pub-id pub-id-type="doi">10.1093/nar/27.1.209</pub-id>
        <?supplied-pmid 9847182?>
        <pub-id pub-id-type="pmid">9847182</pub-id>
      </element-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Le Hir</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Gatfield</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Izaurralde</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Moore</surname>
            <given-names>MJ</given-names>
          </name>
        </person-group>
        <article-title>The exon–exon junction complex provides a binding platform for factors involved in mRNA export and nonsense-mediated mRNA decay</article-title>
        <source>EMBO J.</source>
        <year>2001</year>
        <volume>20</volume>
        <fpage>4987</fpage>
        <lpage>4997</lpage>
        <pub-id pub-id-type="doi">10.1093/emboj/20.17.4987</pub-id>
        <?supplied-pmid 11532962?>
        <pub-id pub-id-type="pmid">11532962</pub-id>
      </element-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Irimia</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Complex selection on 5′ splice sites in intron-rich organisms</article-title>
        <source>Genome Res.</source>
        <year>2009</year>
        <volume>19</volume>
        <fpage>2021</fpage>
        <lpage>2027</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.089276.108</pub-id>
        <?supplied-pmid 19745111?>
        <pub-id pub-id-type="pmid">19745111</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Song</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>TRUST4: immune repertoire reconstruction from bulk and single-cell RNA-seq data</article-title>
        <source>Nat. Methods</source>
        <year>2021</year>
        <volume>18</volume>
        <fpage>627</fpage>
        <lpage>630</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-021-01142-2</pub-id>
        <?supplied-pmid 33986545?>
        <pub-id pub-id-type="pmid">33986545</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Dann</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Henderson</surname>
            <given-names>NC</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Morgan</surname>
            <given-names>MD</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>Differential abundance testing on single-cell data using k-nearest neighbor graphs</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2022</year>
        <volume>40</volume>
        <fpage>245</fpage>
        <lpage>253</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-021-01033-z</pub-id>
        <?supplied-pmid 34594043?>
        <pub-id pub-id-type="pmid">34594043</pub-id>
      </element-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Saelens</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cannoodt</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Todorov</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Saeys</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>A comparison of single-cell trajectory inference methods</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>547</fpage>
        <lpage>554</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0071-9</pub-id>
        <?supplied-pmid 30936559?>
        <pub-id pub-id-type="pmid">30936559</pub-id>
      </element-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Setty</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Characterization of cell fate probabilities in single-cell data with Palantir</article-title>
        <source>Nat. Biotechnol.</source>
        <year>2019</year>
        <volume>37</volume>
        <fpage>451</fpage>
        <lpage>460</lpage>
        <pub-id pub-id-type="doi">10.1038/s41587-019-0068-4</pub-id>
        <?supplied-pmid 30899105?>
        <pub-id pub-id-type="pmid">30899105</pub-id>
      </element-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Carico</surname>
            <given-names>ZM</given-names>
          </name>
          <name>
            <surname>Roy Choudhury</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Zhuang</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Krangel</surname>
            <given-names>MS</given-names>
          </name>
        </person-group>
        <article-title>Tcrd rearrangement redirects a processive Tcra recombination program to expand the Tcra repertoire</article-title>
        <source>Cell Rep.</source>
        <year>2017</year>
        <volume>19</volume>
        <fpage>2157</fpage>
        <lpage>2173</lpage>
        <pub-id pub-id-type="doi">10.1016/j.celrep.2017.05.045</pub-id>
        <?supplied-pmid 28591585?>
        <pub-id pub-id-type="pmid">28591585</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Singer</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Adoro</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Park</surname>
            <given-names>J-H</given-names>
          </name>
        </person-group>
        <article-title>Lineage fate and intense debate: myths, models and mechanisms of CD4- versus CD8-lineage choice</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2008</year>
        <volume>8</volume>
        <fpage>788</fpage>
        <lpage>801</lpage>
        <pub-id pub-id-type="doi">10.1038/nri2416</pub-id>
        <?supplied-pmid 18802443?>
        <pub-id pub-id-type="pmid">18802443</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Karimi</surname>
            <given-names>MM</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The order and logic of CD4 versus CD8 lineage choice and differentiation in mouse thymus</article-title>
        <source>Nat. Commun.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>99</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-020-20306-w</pub-id>
        <?supplied-pmid 33397934?>
        <pub-id pub-id-type="pmid">33397934</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kirchner</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bevan</surname>
            <given-names>MJ</given-names>
          </name>
        </person-group>
        <article-title>ITM2A is induced during thymocyte selection and T cell activation and causes downregulation of CD8 when overexpressed in CD4<sup>+</sup>CD8<sup>+</sup> double positive thymocytes</article-title>
        <source>J. Exp. Med.</source>
        <year>1999</year>
        <volume>190</volume>
        <fpage>217</fpage>
        <lpage>228</lpage>
        <pub-id pub-id-type="doi">10.1084/jem.190.2.217</pub-id>
        <?supplied-pmid 10432285?>
        <pub-id pub-id-type="pmid">10432285</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Taniuchi</surname>
            <given-names>I</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Differential requirements for Runx proteins in CD4 repression and epigenetic silencing during T lymphocyte development</article-title>
        <source>Cell</source>
        <year>2002</year>
        <volume>111</volume>
        <fpage>621</fpage>
        <lpage>633</lpage>
        <pub-id pub-id-type="doi">10.1016/S0092-8674(02)01111-X</pub-id>
        <?supplied-pmid 12464175?>
        <pub-id pub-id-type="pmid">12464175</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sato</surname>
            <given-names>T</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Dual functions of Runx proteins for reactivating CD8 and silencing CD4 at the commitment process into CD8 thymocytes</article-title>
        <source>Immunity</source>
        <year>2005</year>
        <volume>22</volume>
        <fpage>317</fpage>
        <lpage>328</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2005.01.012</pub-id>
        <?supplied-pmid 15780989?>
        <pub-id pub-id-type="pmid">15780989</pub-id>
      </element-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>He</surname>
            <given-names>X</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The zinc finger transcription factor Th-POK regulates CD4 versus CD8 T-cell lineage commitment</article-title>
        <source>Nature</source>
        <year>2005</year>
        <volume>433</volume>
        <fpage>826</fpage>
        <lpage>833</lpage>
        <pub-id pub-id-type="doi">10.1038/nature03338</pub-id>
        <?supplied-pmid 15729333?>
        <pub-id pub-id-type="pmid">15729333</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The zinc finger protein cKrox directs CD4 lineage differentiation during intrathymic T cell positive selection</article-title>
        <source>Nat. Immunol.</source>
        <year>2005</year>
        <volume>6</volume>
        <fpage>373</fpage>
        <lpage>381</lpage>
        <pub-id pub-id-type="doi">10.1038/ni1183</pub-id>
        <?supplied-pmid 15750595?>
        <pub-id pub-id-type="pmid">15750595</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Aliahmad</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Kaye</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Development of all CD4 T lineages requires nuclear factor TOX</article-title>
        <source>J. Exp. Med.</source>
        <year>2008</year>
        <volume>205</volume>
        <fpage>245</fpage>
        <lpage>256</lpage>
        <pub-id pub-id-type="doi">10.1084/jem.20071944</pub-id>
        <?supplied-pmid 18195075?>
        <pub-id pub-id-type="pmid">18195075</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hernández-Hoyos</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Anderson</surname>
            <given-names>MK</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Rothenberg</surname>
            <given-names>EV</given-names>
          </name>
          <name>
            <surname>Alberola-Ila</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>GATA-3 expression is controlled by TCR signals and regulates CD4/CD8 differentiation</article-title>
        <source>Immunity</source>
        <year>2003</year>
        <volume>19</volume>
        <fpage>83</fpage>
        <lpage>94</lpage>
        <pub-id pub-id-type="doi">10.1016/S1074-7613(03)00176-6</pub-id>
        <?supplied-pmid 12871641?>
        <pub-id pub-id-type="pmid">12871641</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pai</surname>
            <given-names>S-Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Critical roles for transcription factor GATA-3 in thymocyte development</article-title>
        <source>Immunity</source>
        <year>2003</year>
        <volume>19</volume>
        <fpage>863</fpage>
        <lpage>875</lpage>
        <pub-id pub-id-type="doi">10.1016/S1074-7613(03)00328-5</pub-id>
        <?supplied-pmid 14670303?>
        <pub-id pub-id-type="pmid">14670303</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Cao</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The single-cell transcriptional landscape of mammalian organogenesis</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>566</volume>
        <fpage>496</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-0969-x</pub-id>
        <?supplied-pmid 30787437?>
        <pub-id pub-id-type="pmid">30787437</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Haghverdi</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Büttner</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Wolf</surname>
            <given-names>FA</given-names>
          </name>
          <name>
            <surname>Buettner</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Theis</surname>
            <given-names>FJ</given-names>
          </name>
        </person-group>
        <article-title>Diffusion pseudotime robustly reconstructs lineage branching</article-title>
        <source>Nat. Methods</source>
        <year>2016</year>
        <volume>13</volume>
        <fpage>845</fpage>
        <lpage>848</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.3971</pub-id>
        <?supplied-pmid 27571553?>
        <pub-id pub-id-type="pmid">27571553</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Clark</surname>
            <given-names>MR</given-names>
          </name>
          <name>
            <surname>Mandal</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Ochiai</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Singh</surname>
            <given-names>H</given-names>
          </name>
        </person-group>
        <article-title>Orchestrating B cell lymphopoiesis through interplay of IL-7 receptor and pre-B cell receptor signalling</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2014</year>
        <volume>14</volume>
        <fpage>69</fpage>
        <lpage>80</lpage>
        <pub-id pub-id-type="doi">10.1038/nri3570</pub-id>
        <?supplied-pmid 24378843?>
        <pub-id pub-id-type="pmid">24378843</pub-id>
      </element-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wong</surname>
            <given-names>JB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>B-1a cells acquire their unique characteristics by bypassing the pre-BCR selection stage</article-title>
        <source>Nat. Commun.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>4768</fpage>
        <pub-id pub-id-type="doi">10.1038/s41467-019-12824-z</pub-id>
        <?supplied-pmid 31628339?>
        <pub-id pub-id-type="pmid">31628339</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kitamura</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A critical role of λ5 protein in B cell development</article-title>
        <source>Cell</source>
        <year>1992</year>
        <volume>69</volume>
        <fpage>823</fpage>
        <lpage>831</lpage>
        <pub-id pub-id-type="doi">10.1016/0092-8674(92)90293-L</pub-id>
        <?supplied-pmid 1591779?>
        <pub-id pub-id-type="pmid">1591779</pub-id>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>O’Byrne</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Discovery of a CD10-negative B-progenitor in human fetal life identifies unique ontogeny-related developmental programs</article-title>
        <source>Blood</source>
        <year>2019</year>
        <volume>134</volume>
        <fpage>1059</fpage>
        <lpage>1071</lpage>
        <pub-id pub-id-type="doi">10.1182/blood.2019001289</pub-id>
        <?supplied-pmid 31383639?>
        <pub-id pub-id-type="pmid">31383639</pub-id>
      </element-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shin</surname>
            <given-names>SB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Abortive γδTCR rearrangements suggest ILC2s are derived from T-cell precursors</article-title>
        <source>Blood Adv.</source>
        <year>2020</year>
        <volume>4</volume>
        <fpage>5362</fpage>
        <lpage>5372</lpage>
        <pub-id pub-id-type="doi">10.1182/bloodadvances.2020002758</pub-id>
        <?supplied-pmid 33137203?>
        <pub-id pub-id-type="pmid">33137203</pub-id>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Qian</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Suppression of ILC2 differentiation from committed T cell precursors by E protein transcription factors</article-title>
        <source>J. Exp. Med.</source>
        <year>2019</year>
        <volume>216</volume>
        <fpage>884</fpage>
        <lpage>899</lpage>
        <pub-id pub-id-type="doi">10.1084/jem.20182100</pub-id>
        <?supplied-pmid 30898894?>
        <pub-id pub-id-type="pmid">30898894</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shin</surname>
            <given-names>SB</given-names>
          </name>
          <name>
            <surname>McNagny</surname>
            <given-names>KM</given-names>
          </name>
        </person-group>
        <article-title>ILC-You in the thymus: a fresh look at innate lymphoid cell development</article-title>
        <source>Front. Immunol.</source>
        <year>2021</year>
        <volume>12</volume>
        <fpage>681110</fpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2021.681110</pub-id>
        <?supplied-pmid 34025680?>
        <pub-id pub-id-type="pmid">34025680</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Hosokawa</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Rothenberg</surname>
            <given-names>EV</given-names>
          </name>
        </person-group>
        <article-title>How transcription factors drive choice of the T cell fate</article-title>
        <source>Nat. Rev. Immunol.</source>
        <year>2021</year>
        <volume>21</volume>
        <fpage>162</fpage>
        <lpage>176</lpage>
        <pub-id pub-id-type="doi">10.1038/s41577-020-00426-6</pub-id>
        <?supplied-pmid 32918063?>
        <pub-id pub-id-type="pmid">32918063</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Musumeci</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Lutz</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Winheim</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Krug</surname>
            <given-names>AB</given-names>
          </name>
        </person-group>
        <article-title>What makes a pDC: recent advances in understanding plasmacytoid DC development and heterogeneity</article-title>
        <source>Front. Immunol.</source>
        <year>2019</year>
        <volume>10</volume>
        <fpage>1222</fpage>
        <pub-id pub-id-type="doi">10.3389/fimmu.2019.01222</pub-id>
        <?supplied-pmid 31191558?>
        <pub-id pub-id-type="pmid">31191558</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Popescu</surname>
            <given-names>D-M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Decoding human fetal liver haematopoiesis</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>574</volume>
        <fpage>365</fpage>
        <lpage>371</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1652-y</pub-id>
        <?supplied-pmid 31597962?>
        <pub-id pub-id-type="pmid">31597962</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Corcoran</surname>
            <given-names>L</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The lymphoid past of mouse plasmacytoid cells and thymic dendritic cells</article-title>
        <source>J. Immunol.</source>
        <year>2003</year>
        <volume>170</volume>
        <fpage>4926</fpage>
        <lpage>4932</lpage>
        <pub-id pub-id-type="doi">10.4049/jimmunol.170.10.4926</pub-id>
        <?supplied-pmid 12734335?>
        <pub-id pub-id-type="pmid">12734335</pub-id>
      </element-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shigematsu</surname>
            <given-names>H</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Plasmacytoid dendritic cells activate lymphoid-specific genetic programs irrespective of their cellular origin</article-title>
        <source>Immunity</source>
        <year>2004</year>
        <volume>21</volume>
        <fpage>43</fpage>
        <lpage>53</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2004.06.011</pub-id>
        <?supplied-pmid 15345219?>
        <pub-id pub-id-type="pmid">15345219</pub-id>
      </element-citation>
    </ref>
    <ref id="CR58">
      <label>58.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Pelayo</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Derivation of 2 categories of plasmacytoid dendritic cells in murine bone marrow</article-title>
        <source>Blood</source>
        <year>2005</year>
        <volume>105</volume>
        <fpage>4407</fpage>
        <lpage>4415</lpage>
        <pub-id pub-id-type="doi">10.1182/blood-2004-07-2529</pub-id>
        <?supplied-pmid 15728131?>
        <pub-id pub-id-type="pmid">15728131</pub-id>
      </element-citation>
    </ref>
    <ref id="CR59">
      <label>59.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sathe</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Vremec</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Corcoran</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Shortman</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Convergent differentiation: myeloid and lymphoid pathways to murine plasmacytoid dendritic cells</article-title>
        <source>Blood</source>
        <year>2013</year>
        <volume>121</volume>
        <fpage>11</fpage>
        <lpage>19</lpage>
        <pub-id pub-id-type="doi">10.1182/blood-2012-02-413336</pub-id>
        <?supplied-pmid 23053574?>
        <pub-id pub-id-type="pmid">23053574</pub-id>
      </element-citation>
    </ref>
    <ref id="CR60">
      <label>60.</label>
      <mixed-citation publication-type="other">Mak, T. W. &amp; Saunders, M. E. <italic>The Immune Response</italic>, 373–401 (Elsevier, 2006).</mixed-citation>
    </ref>
    <ref id="CR61">
      <label>61.</label>
      <mixed-citation publication-type="other">Charles, A., Janeway, J., Travers, P. &amp; Walport, M. <italic>Immunobiology: The Immune System in Health and Disease</italic> (Garland Science, 2001).</mixed-citation>
    </ref>
    <ref id="CR62">
      <label>62.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Elhanati</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Inferring processes underlying B-cell repertoire diversity</article-title>
        <source>Philos. Trans. R. Soc. Lond. B Biol. Sci.</source>
        <year>2015</year>
        <volume>370</volume>
        <fpage>20140243</fpage>
        <pub-id pub-id-type="doi">10.1098/rstb.2014.0243</pub-id>
        <?supplied-pmid 26194757?>
        <pub-id pub-id-type="pmid">26194757</pub-id>
      </element-citation>
    </ref>
    <ref id="CR63">
      <label>63.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sethna</surname>
            <given-names>Z</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Population variability in the generation and selection of T-cell repertoires</article-title>
        <source>PLoS Comput. Biol.</source>
        <year>2020</year>
        <volume>16</volume>
        <fpage>e1008394</fpage>
        <pub-id pub-id-type="doi">10.1371/journal.pcbi.1008394</pub-id>
        <?supplied-pmid 33296360?>
        <pub-id pub-id-type="pmid">33296360</pub-id>
      </element-citation>
    </ref>
    <ref id="CR64">
      <label>64.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Okoreeh</surname>
            <given-names>MK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Asymmetrical forward and reverse developmental trajectories determine molecular programs of B cell antigen receptor editing</article-title>
        <source>Sci. Immunol.</source>
        <year>2022</year>
        <volume>7</volume>
        <fpage>eabm1664</fpage>
        <pub-id pub-id-type="doi">10.1126/sciimmunol.abm1664</pub-id>
        <?supplied-pmid 35930652?>
        <pub-id pub-id-type="pmid">35930652</pub-id>
      </element-citation>
    </ref>
    <ref id="CR65">
      <label>65.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Montecino-Rodriguez</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Dorshkind</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>B-1 B cell development in the fetus and adult</article-title>
        <source>Immunity</source>
        <year>2012</year>
        <volume>36</volume>
        <fpage>13</fpage>
        <lpage>21</lpage>
        <pub-id pub-id-type="doi">10.1016/j.immuni.2011.11.017</pub-id>
        <?supplied-pmid 22284417?>
        <pub-id pub-id-type="pmid">22284417</pub-id>
      </element-citation>
    </ref>
    <ref id="CR66">
      <label>66.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Herzenberg</surname>
            <given-names>LA</given-names>
          </name>
          <name>
            <surname>Herzenberg</surname>
            <given-names>LA</given-names>
          </name>
        </person-group>
        <article-title>Toward a layered immune system</article-title>
        <source>Cell</source>
        <year>1989</year>
        <volume>59</volume>
        <fpage>953</fpage>
        <lpage>954</lpage>
        <pub-id pub-id-type="doi">10.1016/0092-8674(89)90748-4</pub-id>
        <?supplied-pmid 2688900?>
        <pub-id pub-id-type="pmid">2688900</pub-id>
      </element-citation>
    </ref>
    <ref id="CR67">
      <label>67.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Solvason</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Lehuen</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Kearney</surname>
            <given-names>JF</given-names>
          </name>
        </person-group>
        <article-title>An embryonic source of Ly1 but not conventional B cells</article-title>
        <source>Int. Immunol.</source>
        <year>1991</year>
        <volume>3</volume>
        <fpage>543</fpage>
        <lpage>550</lpage>
        <pub-id pub-id-type="doi">10.1093/intimm/3.6.543</pub-id>
        <?supplied-pmid 1679664?>
        <pub-id pub-id-type="pmid">1679664</pub-id>
      </element-citation>
    </ref>
    <ref id="CR68">
      <label>68.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Montecino-Rodriguez</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Leathers</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Dorshkind</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Identification of a B-1 B cell-specified progenitor</article-title>
        <source>Nat. Immunol.</source>
        <year>2006</year>
        <volume>7</volume>
        <fpage>293</fpage>
        <lpage>301</lpage>
        <pub-id pub-id-type="doi">10.1038/ni1301</pub-id>
        <?supplied-pmid 16429139?>
        <pub-id pub-id-type="pmid">16429139</pub-id>
      </element-citation>
    </ref>
    <ref id="CR69">
      <label>69.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Esplin</surname>
            <given-names>BL</given-names>
          </name>
          <name>
            <surname>Welner</surname>
            <given-names>RS</given-names>
          </name>
          <name>
            <surname>Zhang</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Borghesi</surname>
            <given-names>LA</given-names>
          </name>
          <name>
            <surname>Kincade</surname>
            <given-names>PW</given-names>
          </name>
        </person-group>
        <article-title>A differentiation pathway for B1 cells in adult bone marrow</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2009</year>
        <volume>106</volume>
        <fpage>5773</fpage>
        <lpage>5778</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.0811632106</pub-id>
        <?supplied-pmid 19307589?>
        <pub-id pub-id-type="pmid">19307589</pub-id>
      </element-citation>
    </ref>
    <ref id="CR70">
      <label>70.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yoshimoto</surname>
            <given-names>M</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Embryonic day 9 yolk sac and intra-embryonic hemogenic endothelium independently generate a B-1 and marginal zone progenitor lacking B-2 potential</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2011</year>
        <volume>108</volume>
        <fpage>1468</fpage>
        <lpage>1473</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1015841108</pub-id>
        <?supplied-pmid 21209332?>
        <pub-id pub-id-type="pmid">21209332</pub-id>
      </element-citation>
    </ref>
    <ref id="CR71">
      <label>71.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kreslavsky</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Wong</surname>
            <given-names>JB</given-names>
          </name>
          <name>
            <surname>Fischer</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Skok</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Busslinger</surname>
            <given-names>M</given-names>
          </name>
        </person-group>
        <article-title>Control of B-1a cell development by instructive BCR signaling</article-title>
        <source>Curr. Opin. Immunol.</source>
        <year>2018</year>
        <volume>51</volume>
        <fpage>24</fpage>
        <lpage>31</lpage>
        <pub-id pub-id-type="doi">10.1016/j.coi.2018.01.001</pub-id>
        <?supplied-pmid 29414528?>
        <pub-id pub-id-type="pmid">29414528</pub-id>
      </element-citation>
    </ref>
    <ref id="CR72">
      <label>72.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Graf</surname>
            <given-names>R</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>BCR-dependent lineage plasticity in mature B cells</article-title>
        <source>Science</source>
        <year>2019</year>
        <volume>363</volume>
        <fpage>748</fpage>
        <lpage>753</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aau8475</pub-id>
        <?supplied-pmid 30765568?>
        <pub-id pub-id-type="pmid">30765568</pub-id>
      </element-citation>
    </ref>
    <ref id="CR73">
      <label>73.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chatterjee</surname>
            <given-names>S</given-names>
          </name>
        </person-group>
        <article-title>A new coefficient of correlation</article-title>
        <source>J. Am. Stat. Assoc.</source>
        <year>2021</year>
        <volume>116</volume>
        <fpage>2009</fpage>
        <lpage>2022</lpage>
        <pub-id pub-id-type="doi">10.1080/01621459.2020.1758115</pub-id>
      </element-citation>
    </ref>
    <ref id="CR74">
      <label>74.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Gadala-Maria</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Yaari</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Uduman</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Kleinstein</surname>
            <given-names>SH</given-names>
          </name>
        </person-group>
        <article-title>Automated analysis of high-throughput B-cell sequencing data reveals a high frequency of novel immunoglobulin <italic>V</italic> gene segment alleles</article-title>
        <source>Proc. Natl Acad. Sci. USA</source>
        <year>2015</year>
        <volume>112</volume>
        <fpage>E862</fpage>
        <lpage>E870</lpage>
        <pub-id pub-id-type="doi">10.1073/pnas.1417683112</pub-id>
        <?supplied-pmid 25675496?>
        <pub-id pub-id-type="pmid">25675496</pub-id>
      </element-citation>
    </ref>
    <ref id="CR75">
      <label>75.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sleckman</surname>
            <given-names>BP</given-names>
          </name>
          <name>
            <surname>Khor</surname>
            <given-names>B</given-names>
          </name>
          <name>
            <surname>Monroe</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Alt</surname>
            <given-names>FW</given-names>
          </name>
        </person-group>
        <article-title>Assembly of productive T cell receptor delta variable region genes exhibits allelic inclusion</article-title>
        <source>J. Exp. Med.</source>
        <year>1998</year>
        <volume>188</volume>
        <fpage>1465</fpage>
        <lpage>1471</lpage>
        <pub-id pub-id-type="doi">10.1084/jem.188.8.1465</pub-id>
        <?supplied-pmid 9782123?>
        <pub-id pub-id-type="pmid">9782123</pub-id>
      </element-citation>
    </ref>
    <ref id="CR76">
      <label>76.</label>
      <mixed-citation publication-type="other">Hu, Y. Efficient, high-quality force-directed graph drawing. <italic>Math. J.</italic><bold>10</bold>, 37–71 (2005).</mixed-citation>
    </ref>
    <ref id="CR77">
      <label>77.</label>
      <mixed-citation publication-type="other">Peixoto, T. P. The graph-tool python library. 10.6084/M9.FIGSHARE.1164194 (2017).</mixed-citation>
    </ref>
    <ref id="CR78">
      <label>78.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Wolock</surname>
            <given-names>SL</given-names>
          </name>
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Klein</surname>
            <given-names>AM</given-names>
          </name>
        </person-group>
        <article-title>Scrublet: computational identification of cell doublets in single-cell transcriptomic data</article-title>
        <source>Cell Syst.</source>
        <year>2019</year>
        <volume>8</volume>
        <fpage>281</fpage>
        <lpage>291</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cels.2018.11.005</pub-id>
        <?supplied-pmid 30954476?>
        <pub-id pub-id-type="pmid">30954476</pub-id>
      </element-citation>
    </ref>
    <ref id="CR79">
      <label>79.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Benjamini</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Hochberg</surname>
            <given-names>Y</given-names>
          </name>
        </person-group>
        <article-title>Controlling the false discovery rate: a practical and powerful approach to multiple testing</article-title>
        <source>J. R. Stat. Soc.</source>
        <year>1995</year>
        <volume>57</volume>
        <fpage>289</fpage>
        <lpage>300</lpage>
      </element-citation>
    </ref>
    <ref id="CR80">
      <label>80.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Crooks</surname>
            <given-names>GE</given-names>
          </name>
          <name>
            <surname>Hon</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Chandonia</surname>
            <given-names>J-M</given-names>
          </name>
          <name>
            <surname>Brenner</surname>
            <given-names>SE</given-names>
          </name>
        </person-group>
        <article-title>WebLogo: a sequence logo generator</article-title>
        <source>Genome Res.</source>
        <year>2004</year>
        <volume>14</volume>
        <fpage>1188</fpage>
        <lpage>1190</lpage>
        <pub-id pub-id-type="doi">10.1101/gr.849004</pub-id>
        <?supplied-pmid 15173120?>
        <pub-id pub-id-type="pmid">15173120</pub-id>
      </element-citation>
    </ref>
    <ref id="CR81">
      <label>81.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kerby</surname>
            <given-names>DS</given-names>
          </name>
        </person-group>
        <article-title>The simple difference formula: an approach to teaching nonparametric correlation</article-title>
        <source>Compr. Psychol.</source>
        <year>2014</year>
        <pub-id pub-id-type="doi">10.2466/11.IT.3.1</pub-id>
      </element-citation>
    </ref>
    <ref id="CR82">
      <label>82.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lopez</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Regier</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Cole</surname>
            <given-names>MB</given-names>
          </name>
          <name>
            <surname>Jordan</surname>
            <given-names>MI</given-names>
          </name>
          <name>
            <surname>Yosef</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Deep generative modeling for single-cell transcriptomics</article-title>
        <source>Nat. Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>1053</fpage>
        <lpage>1058</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id>
        <?supplied-pmid 30504886?>
        <pub-id pub-id-type="pmid">30504886</pub-id>
      </element-citation>
    </ref>
    <ref id="CR83">
      <label>83.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lambert</surname>
            <given-names>SA</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The human transcription factors</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>175</volume>
        <fpage>598</fpage>
        <lpage>599</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.09.045</pub-id>
        <?supplied-pmid 30290144?>
        <pub-id pub-id-type="pmid">30290144</pub-id>
      </element-citation>
    </ref>
  </ref-list>
</back>
