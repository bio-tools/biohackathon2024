<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName JATS-journalpublishing1.dtd?>
<?SourceDTD.Version 1.1?>
<?ConverterInfo.XSLTName jp2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id>
    <journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id>
    <journal-id journal-id-type="publisher-id">bioinformatics</journal-id>
    <journal-title-group>
      <journal-title>Bioinformatics</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1367-4803</issn>
    <issn pub-type="epub">1367-4811</issn>
    <publisher>
      <publisher-name>Oxford University Press</publisher-name>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">6612871</article-id>
    <article-id pub-id-type="doi">10.1093/bioinformatics/btz345</article-id>
    <article-id pub-id-type="publisher-id">btz345</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Ismb/Eccb 2019 Conference Proceedings</subject>
        <subj-group subj-group-type="category-toc-heading">
          <subject>General Computational Biology</subject>
        </subj-group>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Unsupervised segmentation of mass spectrometric ion images characterizes morphology of tissues</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author">
        <name>
          <surname>Guo</surname>
          <given-names>Dan</given-names>
        </name>
        <xref ref-type="aff" rid="btz345-aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bemis</surname>
          <given-names>Kylie</given-names>
        </name>
        <xref ref-type="aff" rid="btz345-aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Rawlins</surname>
          <given-names>Catherine</given-names>
        </name>
        <xref ref-type="aff" rid="btz345-aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Agar</surname>
          <given-names>Jeffrey</given-names>
        </name>
        <xref ref-type="aff" rid="btz345-aff2">2</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Vitek</surname>
          <given-names>Olga</given-names>
        </name>
        <xref ref-type="aff" rid="btz345-aff1">1</xref>
        <xref ref-type="corresp" rid="btz345-cor1"/>
        <!--<email>o.vitek@neu.edu</email>-->
      </contrib>
    </contrib-group>
    <aff id="btz345-aff1"><label>1</label>Khoury College of Computer Sciences, Northeastern University, Boston, MA, USA</aff>
    <aff id="btz345-aff2"><label>2</label>Department of Chemistry and Chemical Biology, Northeastern University, Boston, MA, USA</aff>
    <author-notes>
      <corresp id="btz345-cor1">To whom correspondence should be addressed. <email>o.vitek@neu.edu</email></corresp>
    </author-notes>
    <pub-date pub-type="ppub">
      <month>7</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="epub" iso-8601-date="2019-07-05">
      <day>05</day>
      <month>7</month>
      <year>2019</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>05</day>
      <month>7</month>
      <year>2019</year>
    </pub-date>
    <!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. -->
    <volume>35</volume>
    <issue>14</issue>
    <fpage>i208</fpage>
    <lpage>i217</lpage>
    <permissions>
      <copyright-statement>© The Author(s) 2019. Published by Oxford University Press.</copyright-statement>
      <copyright-year>2019</copyright-year>
      <license license-type="cc-by-nc" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">
        <license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p>
      </license>
    </permissions>
    <self-uri xlink:href="btz345.pdf"/>
    <abstract>
      <title>Abstract</title>
      <sec id="s1">
        <title>Motivation</title>
        <p>Mass spectrometry imaging (MSI) characterizes the spatial distribution of ions in complex biological samples such as tissues. Since many tissues have complex morphology, treatments and conditions often affect the spatial distribution of the ions in morphology-specific ways. Evaluating the selectivity and the specificity of ion localization and regulation across morphology types is biologically important. However, MSI lacks algorithms for segmenting images at both single-ion and spatial resolution.</p>
      </sec>
      <sec id="s2">
        <title>Results</title>
        <p>This article contributes spatial-Dirichlet Gaussian mixture model (DGMM), an algorithm and a workflow for the analyses of MSI experiments, that detects components of single-ion images with homogeneous spatial composition. The approach extends DGMMs to account for the spatial structure of MSI. Evaluations on simulated and experimental datasets with diverse MSI workflows demonstrated that spatial-DGMM accurately segments ion images, and can distinguish ions with homogeneous and heterogeneous spatial distribution. We also demonstrated that the extracted spatial information is useful for downstream analyses, such as detecting morphology-specific ions, finding groups of ions with similar spatial patterns, and detecting changes in chemical composition of tissues between conditions.</p>
      </sec>
      <sec id="s3">
        <title>Availability and implementation</title>
        <p>The data and code are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Vitek-Lab/IonSpattern">https://github.com/Vitek-Lab/IonSpattern</ext-link>.</p>
      </sec>
      <sec id="s4">
        <title>Supplementary information</title>
        <p><xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group award-type="grant">
        <funding-source>
          <named-content content-type="funder-name">NSF-BIO/DBI</named-content>
        </funding-source>
        <award-id>1759736</award-id>
      </award-group>
    </funding-group>
    <counts>
      <page-count count="10"/>
    </counts>
  </article-meta>
</front>
<body>
  <sec>
    <title>1 Introduction</title>
    <p>Mass spectrometry imaging (MSI) characterizes the spatial distribution of chemical composition of complex biological samples such as tissues. It is broadly applied in biological and clinical research, including diagnosis and prognosis of disease and the study of drug delivery (<xref rid="btz345-B14" ref-type="bibr">Jones <italic>et al.</italic>, 2012</xref>; <xref rid="btz345-B20" ref-type="bibr">Spengler, 2015</xref>). MSI experiments rely on ionization techniques, among which matrix-assisted laser desorption ionization (MALDI), desorption electrospray ionization (DESI) and nano-DESI are the most widely used. In a MALDI-MSI experiment, a tissue section is coated with a matrix, which absorbs the energy of laser and aids extraction and ionization of molecules from tissue section (<xref rid="btz345-B1" ref-type="bibr">Aichler and Walch, 2015</xref>). For DESI-MSI, primary charged droplets generated by electrospray ionization are sprayed upon the tissue section and molecules are ionized and desorbed in secondary droplet (<xref rid="btz345-B23" ref-type="bibr">Wu <italic>et al.</italic>, 2013</xref>).</p>
    <p>The ions of proteins or peptides (for MALDI), or of lipids or metabolites (for DESI and MALDI) are separated according to their ratios of mass over charge (<italic>m</italic>/<italic>z</italic>). This produces a mass spectrum, i.e. a graph where the <italic>x</italic> axis represents the <italic>m</italic>/<italic>z</italic> of the ions, and the <italic>y</italic> axis is the intensity (related to the abundance of the ions). MSI experiments collect mass spectra in a raster pattern throughout a tissue. A color representation of the intensities of one <italic>m</italic>/<italic>z</italic> across the locations is referred to as an <italic>ion image</italic>. Mass spectrometric workflows differ in their spatial resolution, mass resolution and the dynamic range of the intensity signals (<xref rid="btz345-B22" ref-type="bibr">Watrous <italic>et al.</italic>, 2011</xref>). A typical experiment contains spectra with tens of thousands of <italic>m</italic>/<italic>z</italic>, collected across hundreds to tens of thousands of locations, across multiple tissues sections of a biological replicate, and across multiple biological replicates from multiple conditions, thus producing high-dimensional datasets with complex structures of variation.</p>
    <p>Many tissues have distinct morphological structures. For example, the cerebral cortex, <italic>corpus callosum</italic> and <italic>caudate putamen</italic> are a few of the hundreds within a mouse brain. Treatments and conditions affect the ion distributions in the tissue, often in ways that are morphology-specific (<xref rid="btz345-B12" ref-type="bibr">Delcourt <italic>et al.</italic>, 2018</xref>; <xref rid="btz345-B17" ref-type="bibr">Norris and Caprioli, 2013</xref>). For example, most neurodegenerative diseases have regionally confined subsets of neurons that are selectively vulnerable to disease (<xref rid="btz345-B10" ref-type="bibr">Cleveland and Rothstein, 2001</xref>). Examination of the regional selectivity of a drug delivered to a targeted area in the tissue helps understand the effectiveness of the treatment (<xref rid="btz345-B18" ref-type="bibr">Prasad <italic>et al.</italic>, 2018</xref>). Evaluating the selectivity and the specificity of ion localization and regulation is therefore biologically and clinically important.</p>
    <p>Despite the name ‘imaging’, MSI differs from other imaging techniques in its highly quantitative and multivariate nature of the measurements, large between-experiment differences, and a small sample size. Therefore, most common methods for image analysis are inappropriate. Currently the exploration of ion-selective and morphology-selective patterns is mostly done by hand. As the spatial resolution, the mass resolution, and the number of biological replicates increase, MSI routinely generates thousands of ion images in a single experiment (<xref rid="btz345-B22" ref-type="bibr">Watrous <italic>et al.</italic>, 2011</xref>). A manual exploration of the images becomes impossible in practice.</p>
    <p>Statistical methods complementing manual exploration perform image segmentation and differential analysis (<xref rid="btz345-B14" ref-type="bibr">Jones <italic>et al.</italic>, 2012</xref>; <xref rid="btz345-B22" ref-type="bibr">Watrous <italic>et al.</italic>, 2011</xref>). Multivariate methods for image segmentation, e.g. principle component analysis (PCA), hierarchical clustering and <italic>K</italic>-means, detect regions (or, <italic>components</italic>) of the tissues with homogeneous chemical composition. Their output is a single set of components for all the ions. For differential analysis, <italic>t</italic>-test and analysis of variance (ANOVA) average the abundances of an ion across all the locations in each tissue. Their output is the change in ion abundance between tissue replicates from different conditions. Overall, these methods lose the information on either the heterogeneity of the spatial distribution across the ions, or the specificity or selectivity of ion localization within the tissues (<xref rid="btz345-B11" ref-type="bibr">de Muller <italic>et al.</italic>, 2017</xref>).</p>
    <p>This article contributes an algorithm, and a workflow for the analyses of individual ion images, that overcomes the limitations above. The approach, based on Dirichlet Gaussian Mixture Model (DGMM) that we call <italic>spatial-DGMM</italic>, detects ion-specific tissue components with homogeneous spatial composition. This is the first application of Gaussian mixture models (GMM) in MSI. We show that spatial-DGMM accurately segments ion images, and can distinguish ions with homogeneous or heterogeneous spatial distribution in experiments in diverse MALDI- and DESI-based MSI workflows. We also demonstrate that the extracted spatial information is useful for downstream analyses, such as detecting morphology-specific ions, finding groups of ions with similar spatial patterns, and detecting changes in chemical composition.</p>
  </sec>
  <sec>
    <title>2 Background</title>
    <sec>
      <title>2.1 Multivariate analyses of MSI</title>
      <sec>
        <title>2.1.1 Classical multivariate analyses</title>
        <p>Unsupervised multivariate analyses are commonly used for MSI visualization and segmentation. High-dimensional spectra are visualized in lower dimensions, e.g. by PCA (<xref rid="btz345-B8" ref-type="bibr">Bonnel <italic>et al.</italic>, 2011</xref>; <xref rid="btz345-B13" ref-type="bibr">Jones <italic>et al.</italic>, 2011</xref>) and non-negative matrix factorization (<xref rid="btz345-B13" ref-type="bibr">Jones <italic>et al.</italic>, 2011</xref>). For image segmentation, <italic>K</italic>-means and hierarchical clustering are most commonly used (<xref rid="btz345-B8" ref-type="bibr">Bonnel <italic>et al.</italic>, 2011</xref>; <xref rid="btz345-B13" ref-type="bibr">Jones <italic>et al.</italic>, 2011</xref>). However, the classical multivariate analyses do not account for the spatial dependence of the locations, or for the fact that ions may have subtle but important differences in the spatial distribution in the tissue. As a motivating example, <xref ref-type="fig" rid="btz345-F1">Figure 1a</xref> presents a sample of known composition, an oil painting (described in greater details in Section 4). <xref ref-type="fig" rid="btz345-F1">Figure 1b</xref> illustrates that a PCA analysis of the MSI experiment of the painting, although useful, failed to effectively distinguish subregions of homogeneous color.
</p>
        <fig id="btz345-F1" orientation="portrait" position="float">
          <label>Fig. 1.</label>
          <caption>
            <p>Multivariate analysis of the MSI experiment with an oil painting. (<bold>a</bold>) The painting representing the ground truth. Each color has a unique chemical composition, and is a homogeneous component of the image. (<bold>b</bold>) PCA analysis of all the ions. <italic>k</italic> represents the number of principle components. Colors are principle components, and intensity of each color is the score of the location in that principle components. (<bold>c</bold>) Spatial <italic>K</italic>-means segmentation of all the ions. <italic>k</italic> represents the number of segments. Colors are segments. (<bold>d</bold>) Spatial shrunken centroid segmentation of all the ions. <italic>k</italic> represents the number of segments. Colors are segments. <italic>k</italic> in (b–d) was chosen to best visualize the structure of the painting</p>
          </caption>
          <graphic xlink:href="btz345f1"/>
        </fig>
      </sec>
      <sec>
        <title>2.1.2 Spatial multivariate analyses</title>
        <p>Spatial <italic>K</italic>-means (<xref rid="btz345-B3" ref-type="bibr">Alexandrov and Kobarg, 2011</xref>) and spatial centroid segmentation (<xref rid="btz345-B5" ref-type="bibr">Bemis <italic>et al.</italic>, 2016</xref>), designed specifically for MSI, account for the spatial dependency between locations and for the similarity of mass spectra at each location. As shown in <xref ref-type="fig" rid="btz345-F1">Figure 1c and d</xref>, these methods provide less noisy image segmentation, and preserve sharp edges. However, the segmentation does not uncover the differences of spatial distribution between the ions. For example, the ion images in <xref ref-type="fig" rid="btz345-F2">Figure 2a and c</xref> show that <italic>m</italic>/<italic>z</italic> 650.17 and <italic>m</italic>/<italic>z</italic> 321.25 are color-specific. Such specificity of ion localization cannot be deduced from <xref ref-type="fig" rid="btz345-F1">Figure 1c and d</xref>.
</p>
        <fig id="btz345-F2" orientation="portrait" position="float">
          <label>Fig. 2.</label>
          <caption>
            <p>Univariate analysis of the MSI experiment of an oil painting. (<bold>a</bold>) Ion image of <italic>m</italic>/<italic>z</italic> 650.17 specific to the color black. (<bold>b</bold>) Spatial-DGMM segmentation of the ion selects the color-specific locations, <italic>K </italic>=<italic> </italic>2 and <inline-formula id="IE1"><mml:math id="IM1"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>= </mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>. (<bold>c</bold>) Ion image of <italic>m</italic>/<italic>z</italic> 321.25 specific to the grass area in the painting. (<bold>d</bold>) Spatial-DGMM segmentation of the ion selects the grass-specific locations, <italic>K </italic>=<italic> </italic>2 and <inline-formula id="IE2"><mml:math id="IM2"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>. <italic>K</italic> is the number of components estimated by GMM and <inline-formula id="IE3"><mml:math id="IM3"><mml:mrow><mml:mi>K</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> is the number of components estimated by spatial-DGMM</p>
          </caption>
          <graphic xlink:href="btz345f2"/>
        </fig>
      </sec>
    </sec>
    <sec>
      <title>2.2 Univariate analyses of MSI</title>
      <sec>
        <title>2.2.1 Capturing morphological patterns of individual ions</title>
        <p>Univariate methods analyze ion images as in <xref ref-type="fig" rid="btz345-F2">Figure 2a and c</xref>, one image at a time. Many analyses first specify a region of interest (ROI) selected by an optical image of the tissue, or determined by the location of a pre-defined marker ion. Then, the colocalization of the ion image and of the ROI is manually examined. Alternatively, computational methods define ROI as a binary vector containing the values of 1 for tissue locations inside the ROI, and 0 outside. A correlation coefficient between the binary matrix and the ion intensity quantifies the extent of colocalization (<xref rid="btz345-B2" ref-type="bibr">Alexandrov <italic>et al.</italic>, 2010</xref>; <xref rid="btz345-B21" ref-type="bibr">Trede <italic>et al.</italic>, 2012</xref>). The method is simple and fast, but fails when an ion is localized in multiple regions of the tissue, when the ROI is relatively small, or when the ion contains outlying intensity values (<xref rid="btz345-B5" ref-type="bibr">Bemis <italic>et al.</italic>, 2016</xref>).</p>
        <p>Another group of methods quantitatively capture the spatial distribution of individual ions. One example is a homogeneity index based on a texture analysis technique (<xref rid="btz345-B18" ref-type="bibr">Prasad <italic>et al.</italic>, 2018</xref>). It provides automated measure of homogeneity, but cannot comprehensively capture ions selective to multiple areas of the tissue. Another example is morphometric analysis (<xref rid="btz345-B11" ref-type="bibr">de Muller <italic>et al.</italic>, 2017</xref>). It characterizes the number of objects in the total surface of an ion image; however, the biological interpretation of the ‘number of objects’ and of the ‘total surface’ may be a challenge.</p>
      </sec>
      <sec>
        <title>2.2.2 Differential analysis</title>
        <p>To examine changes in ion abundance between conditions, it is common to average the intensity of a <italic>m</italic>/<italic>z</italic> in each replicate tissue, and use the averages as input to <italic>t</italic>-test or ANOVA. Alternative tissue summaries, more complex than the averaging, have also been proposed (<xref rid="btz345-B6" ref-type="bibr">Bemis <italic>et al.</italic>, 2019</xref>; <xref rid="btz345-B9" ref-type="bibr">Cassese <italic>et al.</italic>, 2016</xref>). However, these summaries are not designed to distinguish patterns of ion distribution within a tissue.</p>
      </sec>
    </sec>
    <sec>
      <title>2.3 Mixture models</title>
      <p>Mixture modeling has long been a popular approach for finding patterns in data; however, it has not yet been adopted for MSI. A popular class is GMM (<xref rid="btz345-B24" ref-type="bibr">Zivkovic, 2004</xref>). GMM assume that the data contain sub-structures, each following a Gaussian distribution. GMM have a small number of parameters, estimated by the expectation maximization (EM). However, GMM assume that the individual data points (such as locations of the tissue) are independent, and do not make use of the spatial information.</p>
      <p>A common way to relax the assumption of independence, and to incorporate the spatial information is to use a Markov random field (MRF; <xref rid="btz345-B7" ref-type="bibr">Blekas <italic>et al.</italic>, 2005</xref>). GMM can also be extended with Dirichlet priors to form DGMMs (<xref rid="btz345-B16" ref-type="bibr">Nikou <italic>et al.</italic>, 2010</xref>). This simplifies parameter estimation as compared to GMM when incorporating spatial dependence using an MRF. Instead of using MRF, spatial dependence can also be incorporated to the Dirichlet priors (<xref rid="btz345-B15" ref-type="bibr">Nguyen and Wu, 2011</xref>). However, these methods assume that neighboring locations contribute to spatial smoothness equally, which is not true in MSI data.</p>
      <p>This article adapts DGMM to MSI experiments, by incorporating spatial dependence in a way that is specifically designed for MSI. The proposed method, <italic>spatial-DGMM</italic>, assigns spatial weights to neighboring locations based on both spatial proximity and spectral similarity. Since MSI experiments have many <italic>m</italic>/<italic>z</italic> features, and since different <italic>m</italic>/<italic>z</italic> have different spatial distributions, spatial-DGMM estimates the number of Gaussian components separately for each <italic>m</italic>/<italic>z</italic>. The output of spatial-DGMM, which we call <italic>spatial-DGMM map</italic>, is illustrated in <xref ref-type="fig" rid="btz345-F2">Figure 2b and d</xref>. Spatial-DGMM uncovers ions <italic>m</italic>/<italic>z</italic> 650.17 and <italic>m</italic>/<italic>z</italic> 321.25 of spatial distributions specific to colors, which is hidden in the results of multivariate segmentation (<xref ref-type="fig" rid="btz345-F1">Fig. 1c and d</xref>). Below, we show that it delimits ion images in ways that are specific to the underlying structures, and provides meaningful information for downstream statistical analyses.</p>
    </sec>
  </sec>
  <sec>
    <title>3 Materials and methods</title>
    <p>In this section, we first introduce the notation and the existing DGMM. Then, we introduce the proposed extension, and the iterative Expectation-Maximization algorithm for spatial-DGMM parameter estimation. Finally, we review the overall proposed data analysis workflow.</p>
    <sec>
      <title>3.1 Notation</title>
      <p>Let <inline-formula id="IE4"><mml:math id="IM4"><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> denote the ion intensity at location <italic>i</italic> at one of the <italic>N</italic> locations. Let <inline-formula id="IE5"><mml:math id="IM5"><mml:mrow><mml:msup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>K</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE6"><mml:math id="IM6"><mml:mrow><mml:msup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>K</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> denote the vector of prior and posterior probabilities of <italic>i<sub>th</sub></italic> location to belong to each of the <italic>K</italic> Gaussian components. Let <inline-formula id="IE7"><mml:math id="IM7"><mml:mrow><mml:msup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>K</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> denote the discrete label of the <italic>i<sub>th</sub></italic> location, where <inline-formula id="IE8"><mml:math id="IM8"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> if location <italic>i</italic> belongs to component <italic>j</italic>, and 0 otherwise; and <inline-formula id="IE9"><mml:math id="IM9"><mml:mrow><mml:mo>μ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>K</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE10"><mml:math id="IM10"><mml:mrow><mml:mo>σ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>K</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> denote the mean intensity and the standard deviation of each Gaussian component.</p>
    </sec>
    <sec>
      <title>3.2 Dirichlet gaussian mixture model</title>
      <p>Ion images (such as in <xref ref-type="fig" rid="btz345-F2">Fig. 2a and c</xref>) have regions of distinct average intensity. Within each region, the ion intensity is relatively homogeneous, and the variation is random. Gaussian mixture models represent such regions as <italic>components</italic>, and assume that the ion intensity within each component approximately follows a Gaussian distribution. In a Gaussian mixture model, the probability density at <italic>x<sup>i</sup></italic> is
<disp-formula id="E1"><label>(1)</label><mml:math id="M1"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where <inline-formula id="IE11"><mml:math id="IM11"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> is defined as
<disp-formula id="E2"><label>(2)</label><mml:math id="M2"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msqrt><mml:mrow><mml:mn>2</mml:mn><mml:mo>π</mml:mo></mml:mrow></mml:msqrt><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mi>e</mml:mi><mml:mi mathvariant="italic">xp</mml:mi><mml:mrow><mml:mo stretchy="true">{</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">}</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
The parameters of interest are <inline-formula id="IE12"><mml:math id="IM12"><mml:mrow><mml:mo>Θ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="true">{</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">}</mml:mo></mml:mrow></mml:math></inline-formula>, and the log-likelihood is
<disp-formula id="E3"><label>(3)</label><mml:math id="M3"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mo>Θ</mml:mo><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
Dirichlet Gaussian mixture models extend the basic GMM by assuming that the indicators of component membership <inline-formula id="IE13"><mml:math id="IM13"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> are random variables (<xref rid="btz345-B16" ref-type="bibr">Nikou <italic>et al.</italic>, 2010</xref>). Each <inline-formula id="IE14"><mml:math id="IM14"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> is one realization from a multinomial distribution with parameters <inline-formula id="IE15"><mml:math id="IM15"><mml:mrow><mml:msup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>K</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo><mml:mo>≥</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. Therefore, the probability distribution of the vector <italic>z<sup>i</sup></italic> is
<disp-formula id="E4"><label>(4)</label><mml:math id="M4"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:msup></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
The hyperprior distribution of <italic>ξ<sup>i</sup></italic> is defined as a Dirichlet process
<disp-formula id="E5"><label>(5)</label><mml:math id="M5"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>Γ</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mo>Γ</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where <inline-formula id="IE16"><mml:math id="IM16"><mml:mrow><mml:msup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>K</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, is the vector of Dirichlet parameters. Integrating <xref ref-type="disp-formula" rid="E4">Equations 4</xref> and <xref ref-type="disp-formula" rid="E5">5</xref>, the probability distribution of component membership <italic>z<sup>i</sup></italic> simplifies to
<disp-formula id="E6"><label>(6)</label><mml:math id="M6"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>Γ</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>!</mml:mo><mml:mo>Γ</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:mo>Γ</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mrow><mml:mo>Γ</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
In particular, the probability of the event where the <italic>i<sub>th</sub></italic> location on the tissue belongs to component <italic>j</italic> is
<disp-formula id="E7"><label>(7)</label><mml:math id="M7"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
It is the prior probability before knowing <italic>x<sup>i</sup></italic>, thus <inline-formula id="IE17"><mml:math id="IM17"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p>
      <p>In DGMM the parameters of interest are <inline-formula id="IE18"><mml:math id="IM18"><mml:mrow><mml:mo>Θ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:math></inline-formula>. An iterative optimization such as the expectation maximization (EM) algorithm is typically used for parameter estimation. At the iteration <italic>t</italic> of the algorithm, the parameters of <inline-formula id="IE19"><mml:math id="IM19"><mml:mrow><mml:msup><mml:mrow><mml:mo>Θ</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> are updated, and the posterior probability of the event where location <italic>i</italic> belongs to component <italic>j</italic> is derived
<disp-formula id="E8"><label>(8)</label><mml:math id="M8"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msubsup><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec>
      <title>3.3 Spatial-DGMM</title>
      <p>Since biological tissues have spatial substructures, the ion intensities in neighboring locations are correlated. Therefore, the probabilities of locations belonging to each Gaussian component should also be spatially dependent. To incorporate spatial dependence, we were inspired by the work in <xref rid="btz345-B15" ref-type="bibr">Nguyen and Wu (2011</xref>), which incorporated a linear filter to the posterior probabilities of DGMM. At each iteration <italic>t</italic> of the EM algorithm, the linear filter <inline-formula id="IE20"><mml:math id="IM20"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> linearly combines the posterior probabilities <inline-formula id="IE21"><mml:math id="IM21"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> of the neighboring locations to achieve spatial smoothing. Unlike <xref rid="btz345-B15" ref-type="bibr">Nguyen and Wu (2011</xref>), we define weighted linear combinations
<disp-formula id="E9"><label>(9)</label><mml:math id="M9"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>⊆</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:munder><mml:mrow><mml:msubsup><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:mrow></mml:mfrac><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>⊆</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:munder><mml:mrow><mml:msubsup><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where <inline-formula id="IE22"><mml:math id="IM22"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="script">N</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> is the vector of indexes of neighboring locations of location <italic>i</italic>. The weights <inline-formula id="IE23"><mml:math id="IM23"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> express the proximity of location <italic>m</italic> to location <italic>i</italic>.</p>
      <p>The weights <inline-formula id="IE24"><mml:math id="IM24"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> are designed specifically for MSI. Similarly to <xref rid="btz345-B3" ref-type="bibr">Alexandrov and Kobarg (2011</xref>), we consider the fact that neighboring locations may be similar in chemical composition, but they may also be different, e.g. if they fall on opposite sides of edges separating distinct morphological structures. The similarity of chemical composition of the two locations can be quantified by the similarity of their mass spectra. Specifically, denote <inline-formula id="IE25"><mml:math id="IM25"><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>x</mml:mi><mml:mi>′</mml:mi><mml:msup><mml:mrow/><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mi>′</mml:mi><mml:msup><mml:mrow/><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> the spatial coordinate of the location <italic>i</italic>, and <italic>S<sub>i</sub></italic>=<inline-formula id="IE26"><mml:math id="IM26"><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mi>i</mml:mi><mml:mi>D</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> the spectrum of intensities of all the <italic>m</italic>/<italic>z</italic> values at that location. The weights <inline-formula id="IE27"><mml:math id="IM27"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> combine the spatial distance and the spectrum similarity as:
<disp-formula id="E10"><mml:math id="M10"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mtext>exp</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>x</mml:mi><mml:mi>^′</mml:mi><mml:msup><mml:mrow/><mml:mi>i</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:mi>x</mml:mi><mml:mi>^′</mml:mi><mml:msup><mml:mrow/><mml:mi>m</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>y</mml:mi><mml:mi>^′</mml:mi><mml:msup><mml:mrow/><mml:mi>i</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:mi>y</mml:mi><mml:mi>^′</mml:mi><mml:msup><mml:mrow/><mml:mi>m</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>·</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="E11"><label>(10)</label><mml:math id="M11"><mml:mrow><mml:mtext>exp</mml:mtext><mml:mo> </mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mo>λ</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
The tuning parameters <italic>λ</italic><sub>1</sub> and <italic>λ</italic><sub>2</sub> reflect the scale and the relative importance of spatial and spectrum similarities.</p>
      <p>Following <xref rid="btz345-B15" ref-type="bibr">Nguyen and Wu (2011</xref>), we incorporate <inline-formula id="IE28"><mml:math id="IM28"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> to the Dirichlet parametrization, such that the prior probability of the location <italic>i</italic> to belong to component <italic>j</italic> can depend on the posterior probabilities <inline-formula id="IE29"><mml:math id="IM29"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> of the neighboring locations. The revised Dirichlet distribution is
<disp-formula id="E12"><label>(11)</label><mml:math id="M12"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>Γ</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mo>Γ</mml:mo><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mfrac><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>ξ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
The parameter <italic>β</italic> represents the extent of spatial dependence, and is estimated from the data. Similar to <xref ref-type="disp-formula" rid="E4 E5 E6 E7">Equations 4–7</xref>, the prior <inline-formula id="IE30"><mml:math id="IM30"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> is:
<disp-formula id="E13"><label>(12)</label><mml:math id="M13"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p>
    </sec>
    <sec>
      <title>3.4 Parameter estimation</title>
      <p>
        <boxed-text id="btz345-BOX1" position="float" orientation="portrait">
          <label>Algorithm 1.</label>
          <caption>
            <p>Expectation maximization algorithm</p>
          </caption>
          <p>1. <bold>procedure</bold> DGMM(<inline-formula id="IE31"><mml:math id="IM31"><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">max</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">max</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>ε</mml:mo></mml:mrow></mml:math></inline-formula>)</p>
          <p>2.   Initialization:</p>
          <p>3.   <bold>if</bold> Initialization=“<italic>km</italic>” <bold>then</bold></p>
          <p>4.     <italic>μ<sub>j</sub></italic><inline-formula id="IE32"><mml:math id="IM32"><mml:mo>←</mml:mo></mml:math></inline-formula> kmeans(<italic>x<sup>i</sup></italic>)</p>
          <p>5.     <inline-formula id="IE33"><mml:math id="IM33"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0.15</mml:mn><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula></p>
          <p>6.   <bold>end if</bold></p>
          <p>7.   <bold>if</bold> Initialization=“<italic>gmm</italic>” <bold>then</bold></p>
          <p>8.     <inline-formula id="IE34"><mml:math id="IM34"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula><inline-formula id="IE35"><mml:math id="IM35"><mml:mo>←</mml:mo></mml:math></inline-formula> gmm(<inline-formula id="IE36"><mml:math id="IM36"><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>)</p>
          <p>9.   <bold>end if</bold></p>
          <p>10.   <inline-formula id="IE37"><mml:math id="IM37"><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>β</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula></p>
          <p>11.   <inline-formula id="IE38"><mml:math id="IM38"><mml:mrow><mml:msub><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>K</mml:mi><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> (<xref ref-type="disp-formula" rid="E13">Equations 12</xref> and <xref ref-type="disp-formula" rid="E8">8</xref>)</p>
          <p>12.   parameter estimation:</p>
          <p>13.   <bold>for</bold><italic>t</italic> = 1 to <italic>t<sub>max</sub></italic><bold>do</bold></p>
          <p>14.     compute <inline-formula id="IE39"><mml:math id="IM39"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> (<xref ref-type="disp-formula" rid="E9">Equation 9</xref>)</p>
          <p>15.     compute <inline-formula id="IE40"><mml:math id="IM40"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>π</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> (<xref ref-type="disp-formula" rid="E13">Equation 12</xref>)</p>
          <p>16.     compute <inline-formula id="IE41"><mml:math id="IM41"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> (<xref ref-type="disp-formula" rid="E8">Equation 8</xref>)</p>
          <p>17.     <inline-formula id="IE42"><mml:math id="IM42"><mml:mrow><mml:msup><mml:mrow><mml:mo>Θ</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>←</mml:mo><mml:msup><mml:mrow><mml:mo>Θ</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:mo>η</mml:mo><mml:mo>▽</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mo>Θ</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula></p>
          <p>18.     <bold>if</bold> Simulated Annealing <bold>then</bold></p>
          <p>19.       pick <italic>k<sub>c</sub></italic> from <inline-formula id="IE43"><mml:math id="IM43"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula></p>
          <p>20.       <inline-formula id="IE44"><mml:math id="IM44"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ′</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>σ</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE45"><mml:math id="IM45"><mml:mrow><mml:mo>Θ</mml:mo><mml:mo>′</mml:mo><mml:mo>←</mml:mo><mml:mo>Θ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>μ′</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula></p>
          <p>21.       <bold>if</bold><inline-formula id="IE46"><mml:math id="IM46"><mml:mrow><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>Θ</mml:mo><mml:mo>′</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>&gt;</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>Θ</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula><bold>then</bold></p>
          <p>22.         <inline-formula id="IE47"><mml:math id="IM47"><mml:mrow><mml:mo>Θ</mml:mo><mml:mo>←</mml:mo><mml:mo>Θ</mml:mo><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula></p>
          <p>23.       <bold>end if</bold></p>
          <p>24.       <inline-formula id="IE48"><mml:math id="IM48"><mml:mrow><mml:mi>T</mml:mi><mml:mo>←</mml:mo><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:mo>δ</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:math></inline-formula></p>
          <p>25.     <bold>end if</bold></p>
          <p>26.     Stop when <inline-formula id="IE49"><mml:math id="IM49"><mml:mrow><mml:mo>η</mml:mo><mml:mo>▽</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mo>Θ</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>&lt;</mml:mo><mml:mo>ε</mml:mo></mml:mrow></mml:math></inline-formula></p>
          <p>27.   <bold>end for</bold></p>
          <p>28.   <bold>return</bold><inline-formula id="IE50"><mml:math id="IM50"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo>β</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula></p>
          <p>29. <bold>end procedure</bold></p>
        </boxed-text>
      </p>
      <p>The process of parameter estimation is summarized in Algorithm 1. The inputs are a vector of ion intensities <inline-formula id="IE51"><mml:math id="IM51"><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula>, a <italic>N </italic>×<italic> N</italic> matrix <italic>W</italic> of weights of location <italic>i</italic> relative to location <italic>j</italic>, <italic>K<sub>max</sub></italic> is the maximum number of Gaussian components, <italic>t<sub>max</sub></italic> is the maximum number iterations, and <italic>ε</italic> is the stopping tolerance. The parameters of interest are <inline-formula id="IE52"><mml:math id="IM52"><mml:mrow><mml:mo>Θ</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="true">{</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo>β</mml:mo><mml:mo stretchy="true">}</mml:mo></mml:mrow></mml:math></inline-formula>. Although spatial-DGMM has more parameters than DGMM, the complexity of the parameter space is reduced by the spatial smoothing. We initialize the parameters <inline-formula id="IE53"><mml:math id="IM53"><mml:mrow><mml:mo stretchy="true">{</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">}</mml:mo></mml:mrow></mml:math></inline-formula> with either GMM or <italic>K</italic>-means and initialize <inline-formula id="IE54"><mml:math id="IM54"><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and <italic>β </italic>= 1. The negative log-likelihood is
<disp-formula id="E14"><label>(13)</label><mml:math id="M14"><mml:mrow><mml:mo>−</mml:mo><mml:mi>L</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mo>Θ</mml:mo><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
The estimation relies on EM algorithm, an iterative method for minimizing the negative log likelihood with respect to all the parameters in presence of latent variables. At the iteration <italic>t</italic> in the E step, we calculate <inline-formula id="IE55"><mml:math id="IM55"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> as in <xref ref-type="disp-formula" rid="E8">Equation 8</xref> and write the expectation of negative log-likelihood as
<disp-formula id="E15"><label>(14)</label><mml:math id="M15"><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mo>Θ</mml:mo><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="true">{</mml:mo><mml:mrow><mml:mi mathvariant="italic">log</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="true">)</mml:mo><mml:mo>−</mml:mo><mml:mi mathvariant="italic">log</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mi>l</mml:mi><mml:mi mathvariant="italic">og</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mn>2</mml:mn><mml:mo>π</mml:mo><mml:mo stretchy="true">)</mml:mo><mml:mo>−</mml:mo><mml:mi mathvariant="italic">log</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">}</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
The M step of the algorithm minimizes the function above with respect to parameters Θ by gradient descent. Each parameter is updated with respect to its partial gradient
<disp-formula id="E16"><label>(15)</label><mml:math id="M16"><mml:mrow><mml:msup><mml:mrow><mml:mo>Θ</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>Θ</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:mo>η</mml:mo><mml:mo>▽</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mo>Θ</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="true">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where <italic>η</italic> is the learning step. All <inline-formula id="IE56"><mml:math id="IM56"><mml:mrow><mml:mo>▽</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mo>Θ</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula> have closed form and are subject to the constrains. The partial gradients of each parameter are
<disp-formula id="E17"><label>(16)</label><mml:math id="M17"><mml:mrow><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo><mml:mo>/</mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mi>j</mml:mi><mml:mn>3</mml:mn></mml:msubsup><mml:mo stretchy="true">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>E</mml:mi></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi mathvariant="italic">log</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup><mml:mi>l</mml:mi><mml:mi mathvariant="italic">og</mml:mi><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msubsup><mml:mrow><mml:mo>α</mml:mo></mml:mrow><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>β</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>
The algorithm alternates between the E step and the M step, until it reaches either the stopping criterion or <italic>t<sub>max</sub></italic>.</p>
      <p>To avoid local optima, we enhanced the M step with simulated annealing. At each iteration the step randomly picks a Gaussian component <italic>k<sub>c</sub></italic>, and randomly assign another value to its mean. The proposal for the random assignment is a Gaussian distribution centered at the current mean, with variance proportional to a temperature parameter <italic>T</italic>. The current mean is replaced by the new mean if its log-likelihood increased. The parameter <italic>T</italic> decreases after each iteration, making it less likely to sample a new mean far away from the current mean after each iteration. Our evaluations indicate that the simulated annealing prevents the EM algorithm from being trapped in local optima when the initialization is poor.</p>
      <p>The approach is implemented in R and is available open-source. Analysis of the datasets in this article on a laptop with 2.7GHz CPU and 12G RAM took between 2 and 5 s per ion image.</p>
    </sec>
    <sec>
      <title>3.5 Proposed data analysis workflow</title>
      <p>The overall proposed spatial-DGMM workflow is overviewed in <xref ref-type="fig" rid="btz345-F3">Figure 3</xref>. It consists of data pre-processing (black boxes), fitting the spatial-DGMM model to the observed intensities of an ion in a tissue (red boxes) and model-based inference from the output of spatial-DGMM (blue boxes).
</p>
      <fig id="btz345-F3" orientation="portrait" position="float">
        <label>Fig. 3.</label>
        <caption>
          <p>The proposed workflow of data analysis with spatial-DGMM. Black: data processing; red: model fitting; and blue: model-based inference</p>
        </caption>
        <graphic xlink:href="btz345f3"/>
      </fig>
      <sec>
        <title>3.5.1 Data pre-processing</title>
        <p>Typical MSI pre-processing steps include baseline correction, normalization, peak picking, peak alignment and peak binning (<xref rid="btz345-B19" ref-type="bibr">Ràfols <italic>et al.</italic>, 2018</xref>). Since the technical variance between different MS analyses can be quite large, normalization of spectra across locations and tissues reduces this variation. Different normalization methods can be used, such as total ion current (TIC) normalization, median normalization and normalization based on an internal standard. Smoothing eliminates non-systematic noise in the mass spectra. Peak picking summarizes the mass spectra, and reduces the <italic>m</italic>/<italic>z</italic> features to a subset of meaningful analytes. In the following, we assume that the input to spatial-DGMM are pre-processed <italic>m</italic>/<italic>z</italic> features across locations on one or multiple tissues, from one or several conditions.</p>
      </sec>
      <sec>
        <title>3.5.2 Model fitting</title>
        <p>The number of Gaussian components in an ion image corresponds to the number of morphological sub-structures in the spatial distribution of the ion. A single Gaussian component implies a homogeneous spatial distribution, and multiple Gaussian components imply a heterogeneous spatial distribution of that ion. Since different ions have different spatial distributions, we estimate the ion-specific number of Gaussian components from the data, as follows.</p>
        <p>The Bayesian information criterion (BIC) is a common approach to estimating the number of components <italic>K</italic> in GMM. Therefore, we use it to initialize <italic>K</italic> in spatial-DGMM. However, BIC tends to overestimate the model complexity and <italic>K</italic>. Our simulations demonstrated that when <italic>K</italic> is too large, spatial-DGMM tends to return empty components, i.e. components with no mapped locations. Based on these observations, the proposed workflow estimates <italic>K</italic> using GMM and BIC, fits spatial-DGMM with multiple initializations and multiple neighborhood radii given <italic>K</italic>, and selects the mode <inline-formula id="IE57"><mml:math id="IM57"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> of the numbers of non-empty Gaussian components in these initializations. Finally, spatial-DGMM is re-fit using the number of components <inline-formula id="IE58"><mml:math id="IM58"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula>.</p>
      </sec>
      <sec>
        <title>3.5.3 Model-based inference</title>
        <p>Model-based inference summarizes the fit of spatial-DGMM in ways that are useful for downstream statistical analyses. It consists of predicting component labels for each location <italic>i</italic>, estimating an overlap between a component with a pre-defined ROI, estimating distances between the spatial-DGMM maps of two ions, and estimating the mean ion intensities of each component.</p>
        <p>The component labels for each location <italic>i</italic> are predicted as the label of component with highest posterior probability:
<disp-formula id="E18"><label>(17)</label><mml:math id="M18"><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mtext>label</mml:mtext></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mtext>arg</mml:mtext><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mtext>max</mml:mtext></mml:mrow></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true">(</mml:mo><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mi>j</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="true">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
The overlap between the components detected by spatial-DGMM map and a pre-determined ROI is quantified by a match score
<disp-formula id="E19"><label>(18)</label><mml:math id="M19"><mml:mrow><mml:mtext>match</mml:mtext><mml:mo stretchy="true">(</mml:mo><mml:mtext>ROI</mml:mtext><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mo stretchy="true">{</mml:mo><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mtext>if</mml:mtext><mml:mo> </mml:mo><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mo> </mml:mo><mml:mtext>ROI</mml:mtext><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mtext>and</mml:mtext><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mtext>label</mml:mtext></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mn>0</mml:mn><mml:mo> </mml:mo><mml:mtext>otherwise</mml:mtext><mml:mo> </mml:mo><mml:mo stretchy="true">}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mo stretchy="true">{</mml:mo><mml:mn>1</mml:mn><mml:mo> </mml:mo><mml:mtext>if</mml:mtext><mml:mo> </mml:mo><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mo> </mml:mo><mml:mtext>ROI</mml:mtext><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:mtext>or</mml:mtext><mml:mo> </mml:mo><mml:mo> </mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mtext>label</mml:mtext></mml:mrow></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:mn>0</mml:mn><mml:mo> </mml:mo><mml:mtext>otherwise</mml:mtext><mml:mo stretchy="true">}</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
Ions with a Gaussian component of high matching score are viewed as morphology-specific.</p>
        <p>Distances between the spatial-DGMM maps of two ions are estimated as the proportion of locations belonging to component <italic>j</italic> with identical component labels between two spatial-DGMM maps. Mathematically, we define the distance between two spatial-DGMM maps <italic>M</italic><sub>1</sub> and <italic>M</italic><sub>2</sub> as:
<disp-formula id="E20"><label>(19)</label><mml:math id="M20"><mml:mrow><mml:mtext>distance</mml:mtext><mml:mo stretchy="true">(</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="true">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:mrow><mml:mi>N</mml:mi></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
where <inline-formula id="IE59"><mml:math id="IM59"><mml:mrow><mml:msup><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> if <inline-formula id="IE60"><mml:math id="IM60"><mml:mrow><mml:mi mathvariant="italic">labe</mml:mi><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mi mathvariant="italic">labe</mml:mi><mml:msubsup><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> and 1 otherwise. This is used as input to clustering ions with similar spatial patterns.</p>
        <p>The mean intensities of each component <inline-formula id="IE61"><mml:math id="IM61"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>K</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> estimated from the model are used as input for differential analysis with <italic>t</italic>-test or ANOVA. In an unsupervised manner, as the components are ranked by their mean intensities in each condition, the compared components are mapped between conditions by their relative order. In a supervised manner, the compared components can be mapped manually between conditions or guided by other source of images.</p>
      </sec>
    </sec>
  </sec>
  <sec>
    <title>4 Data</title>
    <sec>
      <title>4.1 Simulated Data 1</title>
      <p>To evaluate the accuracy of ion spatial-DGMM in presence of noise, we simulated 10 ion images with complex morphology. The images had three morphological components: 1 = circle, 2 = background and 3 = triangle, with mean intensities of <inline-formula id="IE62"><mml:math id="IM62"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>100</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>150</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula id="IE63"><mml:math id="IM63"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mn>3</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>225</mml:mn></mml:mrow></mml:math></inline-formula>. The spatial variation in each ion was simulated according to the intrinsic conditional auto-regression (ICAR) model (<xref rid="btz345-B6" ref-type="bibr">Bemis <italic>et al.</italic>, 2019</xref>), namely <inline-formula id="IE64"><mml:math id="IM64"><mml:mrow><mml:msup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>ϕ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>ϵ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>, where <italic>x<sup>i</sup></italic> is the intensity of location <italic>i</italic>, and <inline-formula id="IE65"><mml:math id="IM65"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> the mean intensity of morphological component <italic>k</italic> of location <italic>i</italic>. The term <inline-formula id="IE66"><mml:math id="IM66"><mml:mrow><mml:msup><mml:mrow><mml:mo>ϕ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> expressed the spatial auto-correlation <inline-formula id="IE67"><mml:math id="IM67"><mml:mrow><mml:msup><mml:mrow><mml:mo>ϕ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>∼</mml:mo><mml:mtext>ICAR</mml:mtext><mml:mo stretchy="true">(</mml:mo><mml:msup><mml:mrow><mml:mo>τ</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo stretchy="true">)</mml:mo></mml:mrow></mml:math></inline-formula>, with standard deviation <italic>τ</italic>  =  5. <italic>W</italic> is the <italic>N </italic>×<italic> N</italic> matrix that takes values of 1 for pairs of locations that are direct neighbors, and 0 otherwise. <italic>ϵ<sup>i</sup></italic> is the random noise of location <italic>i</italic>, <inline-formula id="IE68"><mml:math id="IM68"><mml:mrow><mml:msup><mml:mrow><mml:mo>ϵ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msup><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="true">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mo>ϵ</mml:mo><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="true">)</mml:mo><mml:mo>,</mml:mo><mml:mo> </mml:mo><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mo>ϵ</mml:mo></mml:msub></mml:mrow></mml:math></inline-formula> varied from <inline-formula id="IE69"><mml:math id="IM69"><mml:mrow><mml:mn>0.05</mml:mn><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> to <inline-formula id="IE70"><mml:math id="IM70"><mml:mrow><mml:mn>0.32</mml:mn><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.</p>
    </sec>
    <sec>
      <title>4.2 Simulated Data 2</title>
      <p>To evaluate the utility of spatial-DGMM for finding ions with similar patterns, we simulated four groups of ions with different morphologies, 10 ions per group. <italic>m</italic>/<italic>z</italic> 1–10 had three morphological components: 1 = circle, 2 = background and 3 = triangle, with <italic>μ</italic><sub>1</sub> varying from 65 to 116, <inline-formula id="IE71"><mml:math id="IM71"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>150</mml:mn></mml:mrow></mml:math></inline-formula> and <italic>μ</italic><sub>3</sub> varying from 200 to 512. <italic>m</italic>/<italic>z</italic> 11–20 had two morphological components: 1 = background and 2 = triangle, with <inline-formula id="IE72"><mml:math id="IM72"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>150</mml:mn></mml:mrow></mml:math></inline-formula> and <italic>μ</italic><sub>2</sub> varying from 265 to 571. <italic>m</italic>/<italic>z</italic> 21–30 had two morphological components: 1 = circle and 2 = background, with <italic>μ</italic><sub>1</sub> varying from 72 to 124 and <inline-formula id="IE73"><mml:math id="IM73"><mml:mrow><mml:msub><mml:mrow><mml:mo>μ</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>150</mml:mn></mml:mrow></mml:math></inline-formula>. <italic>m</italic>/<italic>z</italic> 31–40 had homogeneous spatial distribution with <italic>μ</italic> varying from 134 to 193. The spatial variation was simulated with the ICAR model as above, and <inline-formula id="IE74"><mml:math id="IM74"><mml:mrow><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mo>ϵ</mml:mo></mml:msub><mml:mo>=</mml:mo><mml:mn>0.1</mml:mn><mml:mo>μ</mml:mo></mml:mrow></mml:math></inline-formula> for all <italic>m</italic>/<italic>z</italic>.</p>
    </sec>
    <sec>
      <title>4.3 Farmhouse painting</title>
      <p>The experiment was used to evaluate spatial-DGMM in a real-life situation with known truth. In the oil painting on paper each color has a unique chemical composition, representing a component of the image. The painting was affixed to a glass slide. A DESI-MSI experiment with an LTQ linear ion trap mass spectrometer (Thermo Finnigan) acquired mass spectra from 12 600 locations, with <italic>m</italic>/<italic>z</italic> range 100–1000, and produced 10 800 <italic>m</italic>/<italic>z</italic> features. The data were analyzed with Cardinal (<xref rid="btz345-B4" ref-type="bibr">Bemis <italic>et al.</italic>, 2015</xref>). At each location, the intensities were normalized with TIC and smoothed using Gaussian kernel. About 187 <italic>m</italic>/<italic>z</italic> features with signal to noise ratio &gt;6 and occurring in &gt;1% of the locations were retained for the analyses. The <italic>m</italic>/<italic>z</italic> in the original spectra were binned to the selected 187 <italic>m</italic>/<italic>z</italic> features.</p>
    </sec>
    <sec>
      <title>4.4 Amyotrophic lateral sclerosis mouse brain</title>
      <p>Amyotrophic lateral sclerosis (ALS) is a neurodegenerative disease of the brain and spinal cord (<xref rid="btz345-B10" ref-type="bibr">Cleveland and Rothstein, 2001</xref>). The brain of one mouse expressing a human ALS mutation (G93A) was collected at Day 45 after birth, sectioned, mounted, coated with 2,5-Dihydroxybenzoic acid (DHB) matrix using the TM Sprayer (HTX Technologies) and analyzed by MALDI-MSI using solariX 9.4 T FTICR MS (Bruker Daltonics) in positive mode. The spatial resolution was 100 <italic>μ</italic>m with a mass range of m/z 609.44–1400. The data were converted from flexImaging (Bruker Daltonics) to imzML format and processed with Cardinal (<xref rid="btz345-B4" ref-type="bibr">Bemis <italic>et al.</italic>, 2015</xref>). There were ∼1800 locations on the tissue and ∼1733 <italic>m</italic>/<italic>z</italic> features per location. For each location, the <italic>m</italic>/<italic>z</italic> were binned to a mass resolution of 2500. After the same pre-processing procedure as for the Farmhouse painting, 60 <italic>m</italic>/<italic>z</italic> features were retained for the analyses.</p>
    </sec>
    <sec>
      <title>4.5 CpG and saline pre-conditioned mouse brain</title>
      <p>CpG is an unmethylated oligodeoxynucleotide that stimulates the toll-like receptor 9 and induces neuroprotection against ischemic damage. Brain tissue sections of three saline (control) and four CpG pre-conditioned mice were collected and analyzed by nano-DESI MSI using an LTQ-orbitrap (Thermo Fisher Scientific) in positive mode (<xref rid="btz345-B6" ref-type="bibr">Bemis <italic>et al.</italic>, 2019</xref>). The spatial resolution was approximately 40 × 200 <italic>μ</italic>m with the mass range of 100–1500. The data in RAW format were converted to NetCDF format using Xcalibur (Thermo Fisher Scientific) and processed with Cardinal (<xref rid="btz345-B4" ref-type="bibr">Bemis <italic>et al.</italic>, 2015</xref>). There were ∼2000 locations on the tissue and ∼7475 <italic>m</italic>/<italic>z</italic> features per location. For each location, <italic>m</italic>/<italic>z</italic> were binned to a mass resolution of 5800, and processed as above. About 433 <italic>m</italic>/<italic>z</italic> features were retained.</p>
    </sec>
  </sec>
  <sec>
    <title>5 Results</title>
    <sec>
      <title>5.1 Spatial-DGMM accurately segments ion images</title>
      <p>We evaluated the accuracy of spatial-DGMM at varying levels of noise, in terms of estimates of the mean intensity of each component, and in terms of classifying tissue locations to their components (Section 3.5). <xref ref-type="fig" rid="btz345-F4">Figure 4</xref> compares the performance of spatial-DGMM to that of GMM on Simulated Data 1 (For comparison of spatial-DGMM and GMM on experimental data in section 4.4 and 4.5, <xref ref-type="supplementary-material" rid="sup1">Supplementary Figs. S1 and S2</xref>). With low noise, both GMM and spatial-DGMM suggest the correct number of morphological components (<inline-formula id="IE75"><mml:math id="IM75"><mml:mrow><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>), have low estimation errors, and low misclassification rates.
</p>
      <fig id="btz345-F4" orientation="portrait" position="float">
        <label>Fig. 4.</label>
        <caption>
          <p>Accuracy of spatial-DGMM on the Simulated Dataset 1. (<bold>a</bold>) Ion image, histogram of ion intensities, GMM segmentation and spatial-DGMM segmentation for the simulated dataset with a low noise (<inline-formula id="IE76"><mml:math id="IM76"><mml:mrow><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mo>ϵ</mml:mo></mml:msub><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn><mml:mo>μ</mml:mo></mml:mrow></mml:math></inline-formula>). (<bold>b</bold>) As in (a), for the simulated dataset with a high noise (<inline-formula id="IE77"><mml:math id="IM77"><mml:mrow><mml:msub><mml:mrow><mml:mo>σ</mml:mo></mml:mrow><mml:mo>ϵ</mml:mo></mml:msub><mml:mo>=</mml:mo><mml:mn>0.17</mml:mn><mml:mo>μ</mml:mo></mml:mrow></mml:math></inline-formula>). (<bold>c</bold>) Estimation error of mean intensity of each morphological component versus noise (in % of intensity). (<bold>d</bold>) Misclassification rate versus noise level (in % of intensity). Only two Gaussian components were inferred with noise above 20%. <italic>K </italic>=<italic> </italic>3 for noise level smaller than 20% of mean intensity and <italic>K </italic>=<italic> </italic>2 for noise level equal or greater than 20% of mean intensity. In all the cases <italic>K<sub>max</sub></italic> = 4 and <inline-formula id="IE78"><mml:math id="IM78"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula>. <italic>K<sub>max</sub></italic> is the initialized maximum number of components, <italic>K</italic> is the number of components estimated by GMM and <inline-formula id="IE79"><mml:math id="IM79"><mml:mrow><mml:mi>K</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> is the number of components estimated by spatial-DGMM</p>
        </caption>
        <graphic xlink:href="btz345f4"/>
      </fig>
      <p>As the noise increases, the component map derived by GMM becomes uncertain, and the estimation error and the misclassification rate rapidly increase. Spatial-DGMM, on the other hand, leverages the information from the neighboring locations, has a lower estimation and misclassification error. In this particular simulation the 1.5-fold change between the mean intensities of the components is obscured when the noise exceeds 20%. GMM and spacial GMM only detect two morphological components, thus inflating the estimation and the misclassification errors.</p>
    </sec>
    <sec>
      <title>5.2 Spatial-DGMM uncovers ion distributions hidden by multivariate segmentation</title>
      <p>The experimental datasets allow us to evaluate the ability of spatial-DGMM to uncover ion-specific and morphology-specific information, in experiments with DESI (farmhouse painting), MALDI (ALS mouse brain) and nano-DESI (saline and CpG mouse brain) acquisitions.</p>
      <sec>
        <title>5.2.1 Farmhouse painting</title>
        <p>Although the multivariate analyses in <xref ref-type="fig" rid="btz345-F1">Figure 1</xref> uncovered the general outlines of the painting, the results lacked color specificity. For example, the spatial shrunken centroids in <xref ref-type="fig" rid="btz345-F1">Figure 1d</xref> highlighted color red (walls), color blue (sky) and color dark green (leaves), but failed to distinguish colors light green (grass), color brown (earth) and color gray (windows). In contrast, images of individual ions in <xref ref-type="fig" rid="btz345-F2">Figure 2</xref> reflect color localization: <italic>m</italic>/<italic>z</italic> 650.17 (<xref ref-type="fig" rid="btz345-F2">Fig. 2a</xref>) was specific to color black, and <italic>m</italic>/<italic>z</italic> 321.25 was selective (i.e. had a higher intensity) for color light green (<xref ref-type="fig" rid="btz345-F2">Fig. 2c</xref>). Spatial-DGMM (<xref ref-type="fig" rid="btz345-F2">Fig. 2b and d</xref>) automatically detected these ion-specific patterns.</p>
      </sec>
      <sec>
        <title>5.2.2 ALS mouse brain</title>
        <p><xref ref-type="fig" rid="btz345-F5">Figure 5</xref> leads to the same conclusion. Spatial shrunken centroids and spatial <italic>K</italic>-means were strongly affected by the noisy ions, and missed the anatomic sub-structures of the mouse brain tissue. Spatial-DGMM successfully distinguished ions with informative (i.e. heterogeneous) spatial distribution from those with uninformative (i.e. homogeneous) spatial distribution. For example, DGMM finds characteristic patterns in <italic>m</italic>/<italic>z</italic> 868.33 and 838.63, which can be lipids (phosphatidylcholines) known to be present in both gray and white matter. DGMM detects relatively homogeneous distributions of <italic>m</italic>/<italic>z</italic> 896.57 and 681.14 across the tissue. We can interpret <italic>m</italic>/<italic>z</italic> 896.57 as driven not by the anatomic structure but by the cellular organization. <italic>m</italic>/<italic>z</italic> 681.14 is not known to be associated with the brain, and may arise from the matrix.
</p>
        <fig id="btz345-F5" orientation="portrait" position="float">
          <label>Fig. 5.</label>
          <caption>
            <p>Segmentation of an ALS mouse brain. (<bold>a</bold>) Multivariate segmentation with spatial shrunken centroids, neighborhood radius = 1 and shrinkage parameter = 3. (<bold>b</bold>) Multivariate segmentation with spatial <italic>K</italic>-means. (<bold>c</bold>) Ion image of <italic>m</italic>/<italic>z</italic> 868.33. (<bold>d</bold>) Univariate spatial-DGMM of <italic>m</italic>/<italic>z</italic> 868.33, <italic>K<sub>max</sub></italic> = 5, <italic>K </italic>=<italic> </italic>4 and <inline-formula id="IE80"><mml:math id="IM80"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula>. (<bold>e</bold>) Ion image of <italic>m</italic>/<italic>z</italic> 838.33. (<bold>f</bold>) Univariate spatial-DGMM of <italic>m</italic>/<italic>z</italic> 838.33, <italic>K<sub>max</sub></italic> = 5, <italic>K </italic>=<italic> </italic>4 and <inline-formula id="IE81"><mml:math id="IM81"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>. (<bold>g</bold>) Ion image of <italic>m</italic>/<italic>z</italic> 681.14. (<bold>h</bold>) Univariate spatial-DGMM of <italic>m</italic>/<italic>z</italic> 681.14, <italic>K<sub>max</sub></italic> = 5, <italic>K </italic>=<italic> </italic>4 and <inline-formula id="IE82"><mml:math id="IM82"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>. (<bold>i</bold>) Ion image of <italic>m</italic>/<italic>z</italic> 896.57. (<bold>j</bold>) Univariate spatial-DGMM of <italic>m</italic>/<italic>z</italic> 896.57, <italic>K<sub>max</sub></italic> = 5, <italic>K </italic>=<italic> </italic>5 and <inline-formula id="IE83"><mml:math id="IM83"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. In d, f, h and j, <italic>K<sub>max</sub></italic> is the initialized maximum number of components, <italic>K</italic> is the number of components estimated by GMM and <inline-formula id="IE84"><mml:math id="IM84"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> is the number of components estimated by spatial-DGMM</p>
          </caption>
          <graphic xlink:href="btz345f5"/>
        </fig>
      </sec>
      <sec>
        <title>5.2.3 Saline and CpG mouse brain</title>
        <p><xref ref-type="fig" rid="btz345-F6">Figure 6</xref> makes a similar point for a Sal pre-conditioned mouse brain tissue. Spatial shrunken centroids and spatial <italic>K</italic>-means produced three structured segments (and an additional segment stochastically distributed across the tissue). However, the multivariate segments could not fully represent the ion-specific spatial distributions. <italic>m</italic>/<italic>z</italic> 756.51 had a higher intensity in the upper and the central parts of the tissue, and spatial-DGMM highlighted that. For <italic>m</italic>/<italic>z</italic> 798.50, spatial-DGMM only detected two morphological components, and was consistent with the ion image.
</p>
        <fig id="btz345-F6" orientation="portrait" position="float">
          <label>Fig. 6.</label>
          <caption>
            <p>Segmentation of a Sal pre-conditioned mouse brain. (<bold>a</bold>) Multivariate segmentation with spatial shrunken centroids, neighborhood radius = 1, shrinkage parameter = 3. (<bold>b</bold>) Multivariate segmentation with spatial <italic>K</italic>-means. (<bold>c</bold>) Ion image of <italic>m</italic>/<italic>z</italic> 756.51. (<bold>d</bold>) The spatial-DGMM map of <italic>m</italic>/<italic>z</italic> 756.51 <inline-formula id="IE85"><mml:math id="IM85"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">max</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>4</mml:mn><mml:mo>,</mml:mo><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. (<bold>e</bold>) Ion image of <italic>m</italic>/<italic>z</italic> 798.50. (<bold>f</bold>) The spatial-DGMM map of <italic>m</italic>/<italic>z</italic> 798.50 <inline-formula id="IE86"><mml:math id="IM86"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">max</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>4</mml:mn><mml:mo>,</mml:mo><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. In d and f, <italic>K<sub>max</sub></italic> is the initialized maximum number of components, <italic>K</italic> is the number of components estimated by GMM and <inline-formula id="IE87"><mml:math id="IM87"><mml:mrow><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula> is the number of components estimated by spatial-DGMM</p>
          </caption>
          <graphic xlink:href="btz345f6"/>
        </fig>
      </sec>
    </sec>
    <sec>
      <title>5.3 Spatial-DGMM maps the distribution of ions to morphologically relevant regions</title>
      <p>In many applications it is important to map the spatial distributions of an ions as present in (or absent from) a ROI (such as a known morphological region) of the tissue. Therefore, we evaluated the overlap between the components of ion distributions selected by spatial-DGMM and the regions of interest (<xref ref-type="disp-formula" rid="E19">Equation 18</xref>). We compared the results to those of Pearson correlation between the ion intensities and the binary vector indicating the region.</p>
      <p><xref ref-type="fig" rid="btz345-F7">Figure 7</xref> illustrates the results in the case of a Sal mouse brain tissue. The ROI in <xref ref-type="fig" rid="btz345-F7">Figure 7a</xref>, obtained by spatial shrunken centroid segmentation, approximated <italic>corpus callosum</italic>. The image of <italic>m</italic>/<italic>z</italic> 844.67 shows a clear selectivity for this segment; however, it is also systematically over-represented in other regions of the brain (<xref ref-type="fig" rid="btz345-F7">Fig. 7b</xref>). As the result, the Pearson correlation is relatively low (−0.51). Spatial-DGMM, on the other hand, had the matching score of 0.78, indicating a high ion selectivity for this region (<xref ref-type="fig" rid="btz345-F7">Fig. 7c</xref>).
</p>
      <fig id="btz345-F7" orientation="portrait" position="float">
        <label>Fig. 7.</label>
        <caption>
          <p>Selectivity of ion localization to a morphological structure in a Sal mouse brain tissue. (<bold>a</bold>) A region of interest, obtained by spatial shrunken centroid segmentation and approximating <italic>corpus callosum</italic>. (<bold>b</bold>) Ion image of <italic>m</italic>/<italic>z</italic> 844.67, the correlation is calculated between ion image and binary matrix indicating the area of interest. (<bold>c</bold>) Morphological component map of (b) modeled by spatial-DGMM</p>
        </caption>
        <graphic xlink:href="btz345f7"/>
      </fig>
    </sec>
    <sec>
      <title>5.4 Spatial-DGMM helps cluster ions with similar spatial distributions</title>
      <p>Grouping ions with similar spatial distributions helps understand the biological processes in the tissue. We evaluated the ability of hierarchical clustering to group such ions in Simulated Data 2, using two types of inputs. The first input was the intensities of the individual locations in the image. In this simulation, this input for each ion was a 1600-dimensional vector of noisy measurements lacking spatial information, and the ions were compared using Euclidean distance. The second input was the spatial-DGMM map generated by the proposed model. In this simulation, the input for each ion was a categorical 1600-dimensional vector, where the entries were the component labels of each location. The ions were compared as defined in <xref ref-type="disp-formula" rid="E20">Equation 19</xref>.</p>
      <p><xref ref-type="fig" rid="btz345-F8">Figure 8a</xref> shows the simulated ion images of the four ion groups, where 10 replicate ions per group have a same spatial distribution. <xref ref-type="fig" rid="btz345-F8">Figure 8b</xref> illustrates that, due to the noise and to the high dimensionality of the input data, the hierarchical clustering failed to consistently group some of the ions with the same spatial distribution. Clustering the ions in the space of the spatial-DGMM components, on the other hand, could more fully characterize the similarity between the spatial distributions.
</p>
      <fig id="btz345-F8" orientation="portrait" position="float">
        <label>Fig. 8.</label>
        <caption>
          <p>Hierarchical clustering of ions with similar spatial distributions in Simulated Dataset 2. (<bold>a</bold>) Simulated morphological components for ions 1–10, 11–20, 21–30 and 31–40. (<bold>b</bold>) Hierarchical clustering of ions in the location space. (<bold>c</bold>) Hierarchical clustering of ions in the Gaussian components space generated by spatial-DGMM. <inline-formula id="IE88"><mml:math id="IM88"><mml:mrow><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> for <italic>m</italic>/<italic>z</italic> 1–10, 16; <inline-formula id="IE89"><mml:math id="IM89"><mml:mrow><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> for <italic>m</italic>/<italic>z</italic> 11–15, 17–30; <inline-formula id="IE90"><mml:math id="IM90"><mml:mrow><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> for <italic>m</italic>/<italic>z</italic> 31–40. <italic>K</italic> is the number of components estimated by GMM and <inline-formula id="IE91"><mml:math id="IM91"><mml:mrow><mml:mi>K</mml:mi><mml:mo>′</mml:mo></mml:mrow></mml:math></inline-formula> is the number of components estimated by spatial-DGMM</p>
        </caption>
        <graphic xlink:href="btz345f8"/>
      </fig>
    </sec>
    <sec>
      <title>5.5 Spatial-DGMM uncovers differences in ion abundance between conditions</title>
      <p>Many MSI experiments characterize changes in chemical compositions of tissues between conditions. We evaluated the utility of spatial-DGMM for this purpose in the CpG and saline pre-conditioned mouse brains experiment. <xref ref-type="fig" rid="btz345-F9">Figure 9</xref> illustrates the comparison for <italic>m</italic>/<italic>z</italic> 826.76. <xref ref-type="fig" rid="btz345-F9">Figure 9a and b</xref> highlights the heterogeneity of the distribution of this ion in a CpG and a saline tissues. Spatial-DGMM detected three morphological components with distinct mean values in the tissues (<xref ref-type="fig" rid="btz345-F9">Fig. 9c and d</xref>).
</p>
      <fig id="btz345-F9" orientation="portrait" position="float">
        <label>Fig. 9.</label>
        <caption>
          <p>Changes in chemical composition in mouse brains between CpG and Sal conditions. (<bold>a</bold>) Ion image (<italic>m</italic>/<italic>z</italic> 826.76) of one of the four biological replicates of CpG pre-conditioned mouse brain. (<bold>b</bold>) Image of the same ion of one of the three biological replicates of saline pre-condition. (<bold>c</bold>) Spatial-DGMM component map of (a). (<bold>d</bold>) Spatial-DGMM component map of (b). (<bold>e</bold>) Comparison between the CpG and the Saline pre-conditioned mice. Black boxplots summarize the average intensities of <italic>m</italic>/<italic>z</italic> 826.76 in each tissue. Color boxplots summarize the average intensities of <italic>m</italic>/<italic>z</italic> 826.76 in each component detected by spatial-DGMM. (<bold>f</bold>) Paired comparison between the CpG and the Saline pre-conditioned mice. The boxplots summarize relative mean intensities of the components in a same tissue. The CpG pre-conditioned group had a smaller intensity of Component 3 relative to Component 1</p>
        </caption>
        <graphic xlink:href="btz345f9"/>
      </fig>
      <p>When the analysis averaged the intensities of this ion separately in each tissue and over all the replicate tissues, we found no apparent difference in abundance between the two conditions (black boxes in <xref ref-type="fig" rid="btz345-F9">Fig. 9e</xref>). However, when comparing the mean intensities of the components detected by spatial-DGMM the differences were more pronounced, and revealed that in Components 1 and 2 the ion was regulated in the direction opposite to that in Component 3 (colored boxes in <xref ref-type="fig" rid="btz345-F9">Fig. 9e</xref>).</p>
      <p>Finally, as an alternative way to gain insight into the regulation, we compared the relative mean intensities of the ion between pairs of components in each group (<xref ref-type="fig" rid="btz345-F9">Fig. 9f</xref>). The ratio is an indicator of the difference between the two morphological components within each tissue. As we can see from <xref ref-type="fig" rid="btz345-F9">Figure 9d</xref>, the mean intensity of Component 3 relative to Component 1 was visibly regulated between two conditions. This information is overlooked when not taking the tissue morphology into account.</p>
    </sec>
  </sec>
  <sec>
    <title>6 Discussion</title>
    <p>We proposed a novel workflow spatial-DGMM for MSI experiments. Spatial-DGMM segments an ion image of a tissue into a data-driven number of Gaussian components, that reflect morphological sub-structures in the analyzed tissue. We showed the application of GMM in MSI for the first time. The number of Gaussian components can be used to distinguish ions with homogeneous or heterogeneous spatial distributions. In addition, spatial-DGMM quantitatively extracts statistical summaries of the Gaussian components, such as their mean intensities and variances, spatial location and overlap with a pre-defined ROI.</p>
    <p>We demonstrated using simulated data that spatial-DGMM accurately estimates the correct number of Gaussian components, and their properties. Applied to experimental data from different experimental workflows, specifically DESI-MSI, MALDI-MSI and nano-DESI MSI with diverse characteristics, spatial-DGMM uncovered ion-specific patterns that could not be found via multivariate analysis. We also explored downstream applications of spatial-DGMM, and demonstrated its utility for selecting ions colocalizing with a region-of-interest, clustering ions with similar spatial patterns and detecting morphology-specific changes in ion abundance between conditions.</p>
    <p>The limitations of spatial-DGMM are related to its assumptions. Spatial-DGMM assumes that ion intensities within a unique morphological sub-structure approximately follow a Gaussian distribution. In reality, the data may have more complex distributions. The accuracy of estimating the number of morphological components and their properties depends on the extent of differences of the intensities in these components, and on the associated noise. Despite the limitations, we believe that spatial-DGMM will help gain useful information from ion images, and will become an important tool for practical applications of MSI.</p>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Material</title>
    <supplementary-material content-type="local-data" id="sup1">
      <label>btz345_Supplementary_Data</label>
      <media xlink:href="btz345_supplementary_data.pdf">
        <caption>
          <p>Click here for additional data file.</p>
        </caption>
      </media>
    </supplementary-material>
  </sec>
</body>
<back>
  <ack id="ack1">
    <title>Acknowledgements</title>
    <p>The authors are grateful to Dr Christina Ferreira and Prof. Graham R. Cooks (Purdue University) for providing access to the farmhouse painting experiment, and to Prof. Ingela Lanekoff (Uppsala University) and Prof. Julia Laskin (Purdue University) for providing access to the CpG and Saline pre-conditioned mouse brain experiment.</p>
    <p><italic>Conflict of Interest</italic>: none declared.</p>
    <sec>
      <title>Funding</title>
      <p>This work was supported in part by the award NSF-BIO/DBI 1759736 to O.V.</p>
    </sec>
  </ack>
  <ref-list id="ref1">
    <title>References</title>
    <ref id="btz345-B1">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Aichler</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Walch</surname><given-names>A.</given-names></name></person-group> (<year>2015</year>) 
<article-title>MALDI imaging mass spectrometry: current frontiers and perspectives in pathology research and practice</article-title>. <source>Lab. Invest</source>., <volume>95</volume>, <fpage>422.</fpage><pub-id pub-id-type="pmid">25621874</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B2">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Alexandrov</surname><given-names>T.</given-names></name></person-group><etal>et al</etal> (<year>2010</year>) 
<article-title>Spatial segmentation of imaging mass spectrometry data with edge-preserving image denoising and clustering</article-title>. <source>J. Proteome Res</source>., <volume>9</volume>, <fpage>6535.</fpage><pub-id pub-id-type="pmid">20954702</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B3">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Alexandrov</surname><given-names>T.</given-names></name>, <name name-style="western"><surname>Kobarg</surname><given-names>J.H.</given-names></name></person-group> (<year>2011</year>) 
<article-title>Efficient spatial segmentation of large imaging mass spectrometry datasets with spatially aware clustering</article-title>. <source>Bioinformatics</source>, <volume>27</volume>, <fpage>i230.</fpage><pub-id pub-id-type="pmid">21685075</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B4">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bemis</surname><given-names>K.</given-names></name></person-group><etal>et al</etal> (<year>2015</year>) 
<article-title>Cardinal: an R package for statistical analysis of mass spectrometry-based imaging experiments</article-title>. <source>Bioinformatics</source>, <volume>31</volume>, <fpage>2418.</fpage><pub-id pub-id-type="pmid">25777525</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B5">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bemis</surname><given-names>K.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Probabilistic segmentation of mass spectrometry images helps select important ions and characterize confidence in the resulting segments</article-title>. <source>Mol. Cell. Proteomics</source>, <volume>15</volume>, <fpage>1761</fpage>–<lpage>1772</lpage>.<pub-id pub-id-type="pmid">26796117</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B6">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bemis</surname><given-names>K.A.</given-names></name></person-group><etal>et al</etal> (<year>2019</year>) 
<article-title>Statistical detection of differentially abundant ions in mass spectrometry-based imaging experiments with complex designs</article-title>. <source>Int. J. Mass Spectrom</source>., <volume>437</volume>, <fpage>49.</fpage></mixed-citation>
    </ref>
    <ref id="btz345-B7">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Blekas</surname><given-names>K.</given-names></name></person-group><etal>et al</etal> (<year>2005</year>) 
<article-title>A spatially constrained mixture model for image segmentation</article-title>. <source>IEEE Trans. Neural Netw</source>., <volume>16</volume>, <fpage>494.</fpage><pub-id pub-id-type="pmid">15787156</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B8">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bonnel</surname><given-names>D.</given-names></name></person-group><etal>et al</etal> (<year>2011</year>) 
<article-title>Multivariate analyses for biomarkers hunting and validation through on-tissue bottom-up or in-source decay in MALDI-MSI: application to prostate cancer</article-title>. <source>Anal. Bioanal. Chem</source>., <volume>401</volume>, <fpage>149.</fpage><pub-id pub-id-type="pmid">21519967</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B9">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cassese</surname><given-names>A.</given-names></name></person-group><etal>et al</etal> (<year>2016</year>) 
<article-title>Spatial autocorrelation in mass spectrometry imaging</article-title>. <source>Anal. Chem</source>., <volume>88</volume>, <fpage>5871</fpage>–<lpage>5877</lpage>.<pub-id pub-id-type="pmid">27180608</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B10">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cleveland</surname><given-names>D.W.</given-names></name>, <name name-style="western"><surname>Rothstein</surname><given-names>J.D.</given-names></name></person-group> (<year>2001</year>) 
<article-title>From Charcot to Lou Gehrig: deciphering selective motor neuron death in ALS</article-title>. <source>Nat. Rev. Neurosci</source>., <volume>2</volume>, <fpage>806</fpage>.<pub-id pub-id-type="pmid">11715057</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B11">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>de Muller</surname><given-names>G.P.</given-names></name></person-group><etal>et al</etal> (<year>2017</year>) 
<article-title>Automated morphological and morphometric analysis of mass spectrometry imaging data: application to biomarker discovery</article-title>. <source>J. Am. Soc. Mass Spectrom</source>., <volume>28</volume>, <fpage>2635.</fpage><pub-id pub-id-type="pmid">28913742</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B12">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Delcourt</surname><given-names>V.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>Spatially-resolved top-down proteomics bridged to MALDI MS imaging reveals the molecular physiome of brain regions</article-title>. <source>Mol. Cell. Proteomics</source>, <volume>17</volume>, <fpage>357.</fpage><pub-id pub-id-type="pmid">29122912</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B13">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Jones</surname><given-names>E.A.</given-names></name></person-group><etal>et al</etal> (<year>2011</year>) 
<article-title>Multiple statistical analysis techniques corroborate intratumor heterogeneity in imaging mass spectrometry datasets of myxofibrosarcoma</article-title>. <source>PLoS One</source>, <volume>6</volume>, <fpage>e24913.</fpage><pub-id pub-id-type="pmid">21980364</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B14">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Jones</surname><given-names>E.A.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) 
<article-title>Imaging mass spectrometry statistical analysis</article-title>. <source>J. Proteomics</source>, <volume>75</volume>, <fpage>4962.</fpage><pub-id pub-id-type="pmid">22743164</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B15">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Nguyen</surname><given-names>T.M.</given-names></name>, <name name-style="western"><surname>Wu</surname><given-names>Q.M.J.</given-names></name></person-group> (<year>2011</year>) 
<article-title>Dirichlet Gaussian mixture model: application to image segmentation</article-title>. <source>Image Vis. Comput</source>., <volume>29</volume>, <fpage>818.</fpage></mixed-citation>
    </ref>
    <ref id="btz345-B16">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Nikou</surname><given-names>C.</given-names></name></person-group><etal>et al</etal> (<year>2010</year>) 
<article-title>A Bayesian framework for image segmentation with spatially varying mixtures</article-title>. <source>IEEE Trans. Image Process</source>., <volume>19</volume>, <fpage>2278.</fpage><pub-id pub-id-type="pmid">20378472</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B17">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Norris</surname><given-names>J.L.</given-names></name>, <name name-style="western"><surname>Caprioli</surname><given-names>R.M.</given-names></name></person-group> (<year>2013</year>) 
<article-title>Analysis of tissue specimens by matrix-assisted laser desorption/ionization imaging mass spectrometry in biological and clinical research</article-title>. <source>Chem. Rev</source>., <volume>113</volume>, <fpage>2309.</fpage><pub-id pub-id-type="pmid">23394164</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B18">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Prasad</surname><given-names>M.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>Drug-homogeneity index in mass spectrometry imaging</article-title>. <source>Anal. Chem</source>., <volume>90</volume>, <fpage>13257.</fpage><pub-id pub-id-type="pmid">30359532</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B19">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Ràfols</surname><given-names>P.</given-names></name></person-group><etal>et al</etal> (<year>2018</year>) 
<article-title>Signal preprocessing, multivariate analysis and software tools for MALDI-TOF mass spectrometry imaging for biological applications</article-title>. <source>Mass Spectrom. Rev</source>., <volume>37</volume>, <fpage>281.</fpage><pub-id pub-id-type="pmid">27862147</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B20">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Spengler</surname><given-names>B.</given-names></name></person-group> (<year>2015</year>) 
<article-title>Mass spectrometry imaging of biomolecular information</article-title>. <source>Anal. Chem</source>., <volume>87</volume>, <fpage>64.</fpage><pub-id pub-id-type="pmid">25490190</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B21">
      <mixed-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Trede</surname><given-names>D.</given-names></name></person-group><etal>et al</etal> (<year>2012</year>) SCiLS Lab: software for analysis and interpretation of large MALDI-IMS datasets. In: <italic>Proceedings of OurCon</italic>, p.<fpage>50</fpage>, <italic>September 3-5, 2012, Ourense, Spain</italic>.</mixed-citation>
    </ref>
    <ref id="btz345-B22">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Watrous</surname><given-names>J.D.</given-names></name></person-group><etal>et al</etal> (<year>2011</year>) 
<article-title>The evolving field of imaging mass spectrometry and its impact on future biological research</article-title>. <source>J. Mass Spectrom</source>., <volume>46</volume>, <fpage>209.</fpage><pub-id pub-id-type="pmid">21322093</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B23">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wu</surname><given-names>C.</given-names></name></person-group><etal>et al</etal> (<year>2013</year>) 
<article-title>Mass spectrometry imaging under ambient conditions</article-title>. <source>Mass Spectrom. Rev</source>., <volume>32</volume>, <fpage>218.</fpage><pub-id pub-id-type="pmid">22996621</pub-id></mixed-citation>
    </ref>
    <ref id="btz345-B24">
      <mixed-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zivkovic</surname><given-names>Z.</given-names></name></person-group> (<year>2004</year>) 
<article-title>Improved adaptive gaussian mixture model for background subtraction</article-title>. <source>Pattern Recognit</source>., <volume>2</volume>, <fpage>28.</fpage></mixed-citation>
    </ref>
  </ref-list>
</back>
