<?properties open_access?>
<?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?>
<?DTDIdentifier.IdentifierType public?>
<?SourceDTD.DTDName A++V2.4.dtd?>
<?SourceDTD.Version 2.4?>
<?ConverterInfo.XSLTName springer2nlmx2.xsl?>
<?ConverterInfo.Version 1?>
<front>
  <journal-meta>
    <journal-id journal-id-type="nlm-ta">Genome Biol</journal-id>
    <journal-id journal-id-type="iso-abbrev">Genome Biol</journal-id>
    <journal-title-group>
      <journal-title>Genome Biology</journal-title>
    </journal-title-group>
    <issn pub-type="ppub">1474-7596</issn>
    <issn pub-type="epub">1474-760X</issn>
    <publisher>
      <publisher-name>BioMed Central</publisher-name>
      <publisher-loc>London</publisher-loc>
    </publisher>
  </journal-meta>
  <article-meta>
    <article-id pub-id-type="pmcid">7938609</article-id>
    <article-id pub-id-type="publisher-id">2286</article-id>
    <article-id pub-id-type="doi">10.1186/s13059-021-02286-2</article-id>
    <article-categories>
      <subj-group subj-group-type="heading">
        <subject>Method</subject>
      </subj-group>
    </article-categories>
    <title-group>
      <article-title>Giotto: a toolbox for integrative analysis and visualization of spatial expression data</article-title>
    </title-group>
    <contrib-group>
      <contrib contrib-type="author" corresp="yes" equal-contrib="yes">
        <name>
          <surname>Dries</surname>
          <given-names>Ruben</given-names>
        </name>
        <address>
          <email>rdries@bu.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff2">2</xref>
      </contrib>
      <contrib contrib-type="author" equal-contrib="yes">
        <name>
          <surname>Zhu</surname>
          <given-names>Qian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Dong</surname>
          <given-names>Rui</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Eng</surname>
          <given-names>Chee-Huat Linus</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Li</surname>
          <given-names>Huipeng</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Liu</surname>
          <given-names>Kan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Fu</surname>
          <given-names>Yuntian</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Zhao</surname>
          <given-names>Tianxiao</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Sarkar</surname>
          <given-names>Arpan</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff5">5</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Bao</surname>
          <given-names>Feng</given-names>
        </name>
        <xref ref-type="aff" rid="Aff4">4</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>George</surname>
          <given-names>Rani E.</given-names>
        </name>
        <xref ref-type="aff" rid="Aff1">1</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Pierson</surname>
          <given-names>Nico</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author">
        <name>
          <surname>Cai</surname>
          <given-names>Long</given-names>
        </name>
        <xref ref-type="aff" rid="Aff3">3</xref>
      </contrib>
      <contrib contrib-type="author" corresp="yes">
        <contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-2283-4714</contrib-id>
        <name>
          <surname>Yuan</surname>
          <given-names>Guo-Cheng</given-names>
        </name>
        <address>
          <email>guo-cheng.yuan@mssm.edu</email>
        </address>
        <xref ref-type="aff" rid="Aff1">1</xref>
        <xref ref-type="aff" rid="Aff6">6</xref>
        <xref ref-type="aff" rid="Aff7">7</xref>
      </contrib>
      <aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="GRID">grid.65499.37</institution-id><institution-id institution-id-type="ISNI">0000 0001 2106 9910</institution-id><institution>Department of Pediatric Oncology, </institution><institution>Dana-Farber Cancer Institute and Harvard Medical School, </institution></institution-wrap>Boston, MA USA </aff>
      <aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="GRID">grid.189504.1</institution-id><institution-id institution-id-type="ISNI">0000 0004 1936 7558</institution-id><institution>Boston University School of Medicine, </institution></institution-wrap>Boston, MA USA </aff>
      <aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="GRID">grid.20861.3d</institution-id><institution-id institution-id-type="ISNI">0000000107068890</institution-id><institution>Division of Biology and Biological Engineering, California Institute of Technology, </institution></institution-wrap>Pasadena, CA USA </aff>
      <aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.12527.33</institution-id><institution-id institution-id-type="ISNI">0000 0001 0662 3178</institution-id><institution>Tsinghua University, </institution></institution-wrap>Beijing, China </aff>
      <aff id="Aff5"><label>5</label><institution-wrap><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution>Departments of Statistics and Molecular and Cellular Biology, </institution><institution>Harvard University, </institution></institution-wrap>Cambridge, MA USA </aff>
      <aff id="Aff6"><label>6</label><institution-wrap><institution-id institution-id-type="GRID">grid.38142.3c</institution-id><institution-id institution-id-type="ISNI">000000041936754X</institution-id><institution>Harvard Stem Cell Institute, </institution></institution-wrap>Boston, MA USA </aff>
      <aff id="Aff7"><label>7</label><institution-wrap><institution-id institution-id-type="GRID">grid.59734.3c</institution-id><institution-id institution-id-type="ISNI">0000 0001 0670 2351</institution-id><institution>Icahn School of Medicine at Mount Sinai, </institution></institution-wrap>New York, NY USA </aff>
    </contrib-group>
    <pub-date pub-type="epub">
      <day>8</day>
      <month>3</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="pmc-release">
      <day>8</day>
      <month>3</month>
      <year>2021</year>
    </pub-date>
    <pub-date pub-type="collection">
      <year>2021</year>
    </pub-date>
    <volume>22</volume>
    <elocation-id>78</elocation-id>
    <history>
      <date date-type="received">
        <day>16</day>
        <month>12</month>
        <year>2020</year>
      </date>
      <date date-type="accepted">
        <day>1</day>
        <month>2</month>
        <year>2021</year>
      </date>
    </history>
    <permissions>
      <copyright-statement>© The Author(s) 2021</copyright-statement>
      <license license-type="OpenAccess">
        <license-p><bold>Open Access</bold>This article is licensed under a Creative Commons Attribution 4.0 International License, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or other third party material in this article are included in the article's Creative Commons licence, unless indicated otherwise in a credit line to the material. If material is not included in the article's Creative Commons licence and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this licence, visit <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>. The Creative Commons Public Domain Dedication waiver (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated in a credit line to the data.</license-p>
      </license>
    </permissions>
    <abstract id="Abs1">
      <p id="Par1">Spatial transcriptomic and proteomic technologies have provided new opportunities to investigate cells in their native microenvironment. Here we present Giotto, a comprehensive and open-source toolbox for spatial data analysis and visualization. The analysis module provides end-to-end analysis by implementing a wide range of algorithms for characterizing tissue composition, spatial expression patterns, and cellular interactions. Furthermore, single-cell RNAseq data can be integrated for spatial cell-type enrichment analysis. The visualization module allows users to interactively visualize analysis outputs and imaging features. To demonstrate its general applicability, we apply Giotto to a wide range of datasets encompassing diverse technologies and platforms.</p>
      <sec>
        <title>Supplementary Information</title>
        <p>The online version contains supplementary material available at 10.1186/s13059-021-02286-2.</p>
      </sec>
    </abstract>
    <funding-group>
      <award-group>
        <funding-source>
          <institution-wrap>
            <institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id>
            <institution>National Institutes of Health</institution>
          </institution-wrap>
        </funding-source>
        <award-id>UH3CA255134</award-id>
        <award-id>R01AG066028</award-id>
        <principal-award-recipient>
          <name>
            <surname>Cai</surname>
            <given-names>Long</given-names>
          </name>
        </principal-award-recipient>
      </award-group>
    </funding-group>
    <custom-meta-group>
      <custom-meta>
        <meta-name>issue-copyright-statement</meta-name>
        <meta-value>© The Author(s) 2021</meta-value>
      </custom-meta>
    </custom-meta-group>
  </article-meta>
</front>
<body>
  <sec id="Sec1">
    <title>Introduction</title>
    <p id="Par2">Most tissues consist of multiple cell types that operate together to perform their functions. The behavior of each cell is in turn mediated by its tissue environment. With the rapid development of single-cell RNAseq (scRNAseq) technologies in the last decade, most attention has gone to unraveling the composition of cell types with each tissue. However, recent studies have also shown that identical cell types may have tissue-specific expression patterns [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR2">2</xref>], indicating that the tissue environment plays an important role in mediating cell states. Since spatial information is lost during the process of tissue dissociation and cell isolation, the scRNAseq technology is intrinsically limited for studying the structural organization of a complex tissue and interactions between cells and their tissue environment.</p>
    <p id="Par3">Recently, a number of technological advances have enabled transcriptomic/proteomic profiling in a spatially resolved manner [<xref ref-type="bibr" rid="CR3">3</xref>–<xref ref-type="bibr" rid="CR14">14</xref>] such that cellular features (for example transcripts or proteins) can be assigned to single cells for which the original cell location information is retained (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a, inset). Applications of these technologies have revealed distinct spatial patterns that previously are only inferred through indirect means [<xref ref-type="bibr" rid="CR15">15</xref>, <xref ref-type="bibr" rid="CR16">16</xref>]. There is an urgent need for standardized spatial analysis tools that can facilitate comprehensive exploration of the current and upcoming spatial datasets [<xref ref-type="bibr" rid="CR17">17</xref>, <xref ref-type="bibr" rid="CR18">18</xref>]. To fill this important gap, we present the first comprehensive, standardized, and user-friendly toolbox, called Giotto, that allows researchers to process, (re-)analyze, and interactively visualize spatial transcriptomic and proteomic datasets. Giotto implements a rich set of algorithms to enable robust spatial data analysis and further provides an easy-to-use workspace for interactive data visualization and exploration. As such, the Giotto toolbox serves as a convenient entry point for spatial transcriptomic/proteomic data analysis and visualization. We have applied Giotto to a wide range of public datasets to demonstrate its general applicability.
<fig id="Fig1"><label>Fig. 1</label><caption><p>The Giotto framework to analyze and visualize spatial expression data<bold>. a</bold> Schematic representation of the Giotto workflow to analyze and visualize spatial expression data. Giotto Analyzer requires a count matrix and physical coordinates for the corresponding cells. It follows standard scRNAseq processing and analysis steps to identify differentially expressed genes and cell types. In the following step, a spatial grid and neighborhood network is created which is further used to incorporate the spatial information of the single-cell environment and which is used for spatial analysis. <bold>b</bold> Cell coordinates, annotations, and clustering information are utilized and incorporated in the Giotto Viewer. This interactive viewer allows users to explore the link between cells’ physical positions and their clustering pattern in the expression space (UMAP or tSNE). The addition of raw subcellular transcript coordinates, staining images, or cell segmentation information is also supported. <bold>c</bold> Overview of the selected broad range of different spatial technologies and datasets which were analyzed and visualized with Giotto. For each dataset the number of features (genes or proteins) and number of cells are shown before filtering. The technologies depicted are sequential fluorescence in situ hybridization plus (seqFISH+), Visium 10X (Visium), Slide-seq, cyclic-ouroboros single-molecule fluorescence in situ hybridization (osmFISH), multiplexed error-robust fluorescent in situ hybridization (merFISH), spatially resolved transcript amplicon readout mapping (STARmap), tissue-based cyclic immunofluorescence (t-CyCIF), Multiplex Ion Beam Imaging (MIBI), and CO-Detection by indexing (CODEX)</p></caption><graphic xlink:href="13059_2021_2286_Fig1_HTML" id="MO1"/></fig></p>
  </sec>
  <sec id="Sec2">
    <title>Results</title>
    <sec id="Sec3">
      <title>Overview of the Giotto toolbox</title>
      <p id="Par4">Giotto provides a comprehensive spatial analysis toolbox that contains two independent yet fully integrated modules (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a, b). The first module (Giotto Analyzer) provides step-by-step instructions about the different steps in analyzing spatial single-cell expression data, whereas the second module (Giotto Viewer) provides a responsive and interactive viewer of such data on the user’s local computer. These two modules can be used either independently or iteratively.</p>
      <p id="Par5">Giotto Analyzer requires as minimal input a gene-by-cell count matrix and the spatial coordinates for the centroid position of each cell (Fig. <xref rid="Fig1" ref-type="fig">1</xref>a). At the basic level, Giotto Analyzer can be used to perform common steps often similar to scRNAseq analysis, such as pre-processing, feature selection, dimension reduction, and unsupervised clustering; on the other hand, the main strength comes from its ability to integrate gene expression and spatial information in order to gain insights into the structural and functional organization of a tissue and its expression patterns. To this end, Giotto Analyzer creates a spatial grid and neighborhood network connecting cells that are physically close to each other. These objects function as the basis to perform analyses that are associated with cell neighborhoods.</p>
      <p id="Par6">Giotto Analyzer is written in the popular language R. The core data structure is the Giotto object, which is specifically designed for spatial expression data analysis based on the flexible S4 object system in R. The Giotto object stores all necessary (spatial) information and is sufficient to perform all calculations and analyses (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1A). This allows the user to quickly evaluate and create their own flexible pipeline for both spatial visualization and data analysis. The Giotto Viewer module is designed to both interactively explore the outputs of Giotto Analyzer and to visualize additional information such as cell morphology and transcript locations (Fig. <xref rid="Fig1" ref-type="fig">1</xref>b). Giotto Viewer provides an interactive workspace allowing users to easily explore the data in both physical and expression space and identify relationships between different data modalities. Taken together, these two modules provide an integrated toolbox for spatial expression data analysis and visualization.</p>
      <p id="Par7">The spatial omics field is diverse and rapidly expanding; each technology has its strength and weaknesses. In order to demonstrate the general applicability of Giotto, we selected and analyzed 10 public datasets obtained from 9 state-of-the-art technologies (Fig. <xref rid="Fig1" ref-type="fig">1</xref>c, Additional file <xref rid="MOESM2" ref-type="media">2</xref>: Table S1), which differ in terms of resolution (single-cell vs multiple cells), physical dimension (2D vs 3D), molecular modality (protein vs RNA), number of cells and genes, and tissue of origin. Throughout this paper, we use these datasets to highlight the rich set of analysis tools that are supported by Giotto.</p>
    </sec>
    <sec id="Sec4">
      <title>Cell type identification and data visualization</title>
      <p id="Par8">Giotto Analyzer starts by identifying different cell types that are present in a spatial transcriptomic or proteomic dataset. As an illustrating example for the first common steps, we considered the seqFISH+ mouse somatosensory cortex dataset, which profiled 10,000 genes in hundreds of cells at single-cell resolution using super-resolved imaging [<xref ref-type="bibr" rid="CR9">9</xref>]. The input gene-by-cell count matrix was first pre-processed through a sequence of steps including normalization, quality control of raw counts, and adjustment for batch effects or technical variations. Then downstream analyses were carried out for highly variable gene selection (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1B), dimensionality reduction (such as PCA, tSNE [<xref ref-type="bibr" rid="CR19">19</xref>], and UMAP [<xref ref-type="bibr" rid="CR20">20</xref>]), and clustering (such as Louvain [<xref ref-type="bibr" rid="CR21">21</xref>] and Leiden clustering algorithms [<xref ref-type="bibr" rid="CR22">22</xref>]) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1C). Cluster-specific marker genes (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1D-E) were identified through a number of algorithms (such as Scran [<xref ref-type="bibr" rid="CR23">23</xref>] and MAST [<xref ref-type="bibr" rid="CR24">24</xref>]) and a new algorithm based on Gini coefficients [<xref ref-type="bibr" rid="CR25">25</xref>]. Whereas the strongest marker genes are typically identified by all three methods, each method has its own strength in detecting specific types of genes (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S2A-G, see Methods and Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes for details). In total, we identified 12 distinct cell types, including layer-specific excitatory neurons (eNeurons) (<italic>Syt17</italic> in layer 2/3, <italic>Grm2</italic> in layer 4, <italic>Islr2</italic> in layer 5/6), two types of inhibitory neurons (iNeurons) (<italic>Lhx6</italic> vs <italic>Adarb2</italic>), astrocytes (<italic>Gli3</italic>), oligodendrocytes (<italic>Plekhh</italic>), oligodendrocyte precursors (OPCs) (<italic>Sox10</italic>), endothelial cells (<italic>Cldn5</italic>), mural (<italic>Vtn</italic>), and microglia (<italic>Itgam</italic>) cells. The distribution of these cell types can then be visualized in both expression and physical space (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1F).</p>
      <p id="Par9">Next, we analyzed additional complex imaging-based spatial transcriptomic datasets generated by merFISH [<xref ref-type="bibr" rid="CR14">14</xref>], STARmap [<xref ref-type="bibr" rid="CR7">7</xref>], and osmFISH [<xref ref-type="bibr" rid="CR11">11</xref>]. In the merFISH dataset, 12 selected thin slices from a 3D mouse pre-optic cortex sample were imaged, resulting in a total of roughly 75,000 cells and 155 genes. Here Giotto was used to identify 8 distinct clusters. Based on known marker genes, we were able to annotate these clusters as microglia (<italic>Selplg</italic>), ependymal cells (<italic>Cd24a</italic>), astrocytes (<italic>Aqp4</italic>), endothelial cells (<italic>Fn1</italic>), mature (Mbp), and immature (<italic>Pdgfra</italic>) oligodendrocytes, excitatory (<italic>Slc17a6</italic>) and inhibitory (<italic>Gad1</italic>) neurons, respectively, which is in agreement with the original paper [<xref ref-type="bibr" rid="CR14">14</xref>] (Fig. <xref rid="Fig2" ref-type="fig">2</xref>a, b, Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes). Cells that did not fall into these clusters were collectively assigned to an “ambiguous” group, as done in the original paper. Next, to visualize the results, Giotto can create an interactive 3D plot for the whole dataset or specifically highlight one or more selected 2D slices (Fig. <xref rid="Fig2" ref-type="fig">2</xref>c). Together with overlaying gene expression information (Fig. <xref rid="Fig2" ref-type="fig">2</xref>d, e), such visualization enables the user to explore tissue structure and concomitant gene expression variation in a detailed manner.
<fig id="Fig2"><label>Fig. 2</label><caption><p>Analysis and visualization of large-scale spatial transcriptomic and proteomic datasets. <bold>a</bold> Visualization in both expression (top) and physical (bottom) space of the cell types identified by Giotto Analyzer in the pre-optic hypothalamic merFISH dataset, which consists of 12 slices from the same 3D sample (distance unit = 1 μm). <bold>b</bold> Heatmap showing the marker genes for the identified cell populations in <bold>a, c</bold> Visualization in both expression and physical space of two representative slices within the <italic>z</italic>-orientation (100 μm and 400 μm). <bold>d, e</bold> Overlay of gene expression in both expression and physical space for the selected slices in <bold>c, f</bold>. Visualization in both expression (top) and spatial (bottom) space of the clusters identified by Giotto Analyzer in the pancreatic ductal adenocarcinoma (PDAC) tissue-CyCIF dataset, which covers multiple tissues, including pancreas, small intestine, and cancer cells (distance unit = 1 μm). <bold>g</bold> Heatmap showing the marker proteins for the identified cell clusters in <bold>f, h</bold>. Visualization in both expression and physical space of two selected windows (red squares in <bold>f</bold>) in the normal pancreas and small-intestinal regions. <bold>i</bold>, <bold>j</bold> Overlay of gene expression in both expression and physical space for the selected windows in <bold>h</bold></p></caption><graphic xlink:href="13059_2021_2286_Fig2_HTML" id="MO2"/></fig></p>
      <p id="Par10">In a similar manner, we analyzed the mouse visual cortex STARmap (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S3 A-D) and mouse somatosensory cortex osmFISH (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S4 A-D) datasets (see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes for details). Both datasets show the typical anatomical multi-layered structure of the cortex. In the 3D STARmap analysis, we present an additional functionality that allows the user to create 2D virtual sections of a 3D sample (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S3 A, C and E), which could be useful for more refined structural analysis, as demonstrated in our analysis of the STARmap dataset (see section “<xref rid="Sec7" ref-type="sec">Giotto identifies distinct cellular neighborhoods and interactions</xref>” and Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes for details).</p>
      <p id="Par11">Due to the similarity of data structure, it is straightforward to apply Giotto to analyze large-scale spatial proteomic datasets such as CyCIF, CODEX, and MIBI (see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes for details). As an illustrating example, we analyzed a public dataset obtained by CyCIF [<xref ref-type="bibr" rid="CR10">10</xref>]. The dataset profiled the spatial distribution of 21 proteins and 3 cellular compartment or organelle markers at single-cell resolution in a human pancreatic ductal adenocarcinoma (PDAC) sample that spanned across three distinct tissues: the pancreas, small intestine, and tumor. In total, 160,000 cells were profiled. Giotto identified 13 coarse clusters which include mesenchymal, epithelial, immune, and cancer cells (Fig. <xref rid="Fig2" ref-type="fig">2</xref>f, g). Next, we zoomed into each tissue to refine the cell type structure in the pancreas and small intestine separately (Fig. <xref rid="Fig2" ref-type="fig">2</xref>h). For example, we can now see clearly that the pancreas is structured in distinct zones enriched with epithelial (<italic>E-cadherin</italic>) and mesenchymal or stromal (<italic>Vimentin</italic>) cells, respectively. On the other hand, the small intestine shows a clear proliferating zone (PCNA) and the activation of Wnt signaling (<italic>b-catenin</italic>) in intestinal epithelial cells (Fig. <xref rid="Fig2" ref-type="fig">2</xref>i, j). Both observations are consistent with the original paper [<xref ref-type="bibr" rid="CR10">10</xref>]. Applying the same approach to analyze a mouse spleen dataset from CODEX [<xref ref-type="bibr" rid="CR12">12</xref>] allowed us to identify zones enriched with CD8(+) T cells (Zone 1) and enriched with erythroblasts and F4/80 macrophages (Zone 2) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S4 E-I). As such, the employment of Giotto to quickly zoom in to different regions is useful for uncovering the organization of spatial tissues or expression levels in a hierarchical manner.</p>
    </sec>
    <sec id="Sec5">
      <title>Analysis of data with lower spatial resolution</title>
      <p id="Par12">Recently, a number of lower-resolution spatial transcriptomic technologies have been developed, such as 10X Genomics Visium [<xref ref-type="bibr" rid="CR26">26</xref>], Slide-seq [<xref ref-type="bibr" rid="CR8">8</xref>], and DBiT-seq [<xref ref-type="bibr" rid="CR27">27</xref>]. Despite their lower spatial resolution, these technologies are useful because they are currently more accessible. To overcome the challenge of lower resolution, Giotto implements a number of algorithms for estimating the enrichment of a cell type in different regions (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a). In this approach, a continuous value representing the likelihood of the presence of a cell type of interest is assigned to a spatial location which contains multiple cells. To this end, Giotto requires additional input representing the gene signatures of known cell types. Currently, the input gene signatures for the known cell types can either be provided by the user directly as cell type marker gene lists, or be automatically inferred by Giotto based on an additional scRNAseq data matrix input. Giotto then evaluates the match between each cell type’s gene signatures and the expression pattern at each spatial location and reports an enrichment score by using one of the three algorithms: PAGE [<xref ref-type="bibr" rid="CR28">28</xref>], RANK, and Hypergeometric testing (Fig. <xref rid="Fig3" ref-type="fig">3</xref>a, see “Methods” for details). PAGE calculates an enrichment score based on the fold change of cell type marker genes for each spot. RANK does not require predefined marker genes but instead creates a full ranking of genes ordered by the cell-type specificity score in the scRNAseq data matrix, and computes a ranking-based statistic. Hypergeometric test computes a <italic>p</italic> value based on the overlap between each cell-type-specific marker gene set and the set of spot-specific genes, i.e., those that are expressed at significantly higher levels at certain spots than others (see “Methods”). As negative controls, enrichment scores are also calculated for scrambled spatial transcriptomic data. This allows us to evaluate the statistical significance of an observed enrichment score.
<fig id="Fig3"><label>Fig. 3</label><caption><p>Cell-type enrichment analysis on spatial expression data<bold>. a</bold> Schematic of cell-type enrichment analysis pipeline. The inputs are spatial expression data and cell-type-specific gene signatures. These two sources of information are integrated to infer cell type enrichment scores. Giotto implements three methods for enrichment analysis: PAGE, RANK, and Hypergeometric. <bold>b</bold> Single-cell resolution seqFISH+ data are used to simulate coarse-resolution spatial transcriptomic data generated from spot-like squares by projecting onto a regular spatial grid (500 × 500 pixels). Colored squares indicate those that contain cells. External scRNAseq data are visualized by UMAP. <bold>c</bold> Comparison of cell-type enrichment scores (left, inferred by PAGE) and observed frequency of various cell types (right, based on seqFISH+ data). The agreement between the two is quantified by area under curve (AUC) scores (green circles). <bold>d</bold> Cell type enrichment analysis for the mouse Visium brain dataset (distance unit = 1 pixel, 1 pixel ≈ 1.46 μm). Enrichment scores for selected cell types are displayed (top left) and compared with the expression level of known marker genes (bottom left). For comparison, a snapshot of the anatomic structure image obtained from mouse Allen Brain Atlas is displayed. Known locations for the selected cell types are highlighted</p></caption><graphic xlink:href="13059_2021_2286_Fig3_HTML" id="MO3"/></fig></p>
      <p id="Par13">To rigorously evaluate the performance of these cell-type enrichment algorithms, we created a simulated dataset based on the aforementioned seqFISH+ dataset, for which the cell type annotation has been established at the single-cell resolution. To mimic the effect of spatial barcoding, such as that being used in Visium, the merged fields of view were divided into spot-like squares from a regular spatial grid (500 × 500 pixels, ~ 51.5 μm) (Fig. <xref rid="Fig3" ref-type="fig">3</xref>b). For cells located in each square, their gene expression profiles were averaged, thereby creating a new dataset with lower spatial resolution. To apply cell-type enrichment analysis, we obtained scRNAseq data and derived marker gene lists for somatosensory cortex associated cell types from a previous study [<xref ref-type="bibr" rid="CR29">29</xref>]. To facilitate cross-platform comparison, we focused on the six major cell types that were annotated by both studies: astrocytes, microgila, endothelial mural, excitatory neurons, inhibitory neurons, and oligodendrocytes (Fig. <xref rid="Fig3" ref-type="fig">3</xref>b). For each cell type, we assigned an enrichment score and <italic>p</italic> value for each spot by using one of the three enrichment analysis methods mentioned above (Fig. <xref rid="Fig3" ref-type="fig">3</xref>c). To quantify the performance of each method, we evaluated the area under curve (AUC) score, which was obtained by using the ranking of enrichment score values to predict the presence of a cell type at each spot. Both PAGE and RANK provide high accuracy (median AUC = 0.95 and 0.96, respectively, Fig. <xref rid="Fig3" ref-type="fig">3</xref>c, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S5 and S6A). Even if a spot contains only one cell from a given type, it can often be identified (47 out of 67, ~ 70%). The only cell type that cannot be well predicted by this approach is inhibitory neurons, whose gene signatures are less distinct than others.</p>
      <p id="Par14">In comparison, the hypergeometric test and Spearman correlation methods are less accurate (median AUC = 0.86 and 0.72, respectively, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S5 and S6A, Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes). We also compared it with RCTD [<xref ref-type="bibr" rid="CR30">30</xref>], which is a newly developed method for deconvolution. RCTD also performed well (median AUC value of 0.95, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S5. and S6A), but it was considerably slower than the other methods (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S6C). The four methods that performed well were also robust to changes in number of transcripts (UMIs) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S6B).</p>
      <p id="Par15">Next, we applied cell-type enrichment analysis to a publicly available mouse brain Visium dataset (downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/">https://www.10xgenomics.com/</ext-link>). Spatial transcriptomic information was obtained by using 2698 spatially barcoded array spots, each covering a circled area with 55 μm in diameter. To comprehensively perform enrichment analysis, cell type annotations and corresponding gene signatures were obtained from a public scRNAseq dataset [<xref ref-type="bibr" rid="CR31">31</xref>]. Here, we applied PAGE to identify the spatial patterns of the major cell taxonomies identified previously [<xref ref-type="bibr" rid="CR31">31</xref>]. We found that a number of cell types are spatially restricted to distinct anatomical regions (Fig. <xref rid="Fig3" ref-type="fig">3</xref>d, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S6D). The spatial patterns of the enrichment scores are consistent with the literature for a number of cell types, such as peptidergic cells, granule neurons, ependyma astrocytes, and medium spiny neurons (Fig. <xref rid="Fig3" ref-type="fig">3</xref>d) [<xref ref-type="bibr" rid="CR32">32</xref>–<xref ref-type="bibr" rid="CR34">34</xref>]. Similar but less obvious trends can be observed by inspecting the expression pattern of specific marker genes (Fig. <xref rid="Fig3" ref-type="fig">3</xref>d), which is consistent with the fact that cell types are typically defined by the concerted activities of multiple genes. Of note, the enrichment analysis also correctly predicted the absence of cell types that should not be present in the sample, such as cerebellum, olfactory bulb, and spinal cord cells (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S6D).</p>
      <p id="Par16">To test the general applicability of the enrichment analysis algorithms, we re-analyzed a Slide-seq dataset [<xref ref-type="bibr" rid="CR8">8</xref>] (see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes for details), where the read coverage is lower than Visium. This dataset profiles the mouse cerebellum, containing 21,000 beads and 10,500 genes at a coverage of 80 UMIs per bead. Cell-type gene signature information was obtained from a public scRNAseq dataset for a similar region [<xref ref-type="bibr" rid="CR31">31</xref>]. Analysis of this scRNAseq dataset identified 15 different cell types. We applied the RANK method for enrichment analysis (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7A) and noticed distinct spatial enrichment of cell types in the Slide-seq data that are consistent with prior knowledge. For example, the Purkinje cells were correctly mapped to the Purkinje layer, granule cells were correctly mapped to the nuclear layer, and GABAergic interneurons were mapped to the molecular layer (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7B). For comparison, we also applied RCTD to analyze the same dataset and obtained similar results (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7B, C).</p>
    </sec>
    <sec id="Sec6">
      <title>Giotto uncovers different layers of spatial expression variability</title>
      <p id="Par17">A key component of Giotto Analyzer is the implementation of a wide range of computational methods to identify spatial patterns based on gene expression. On a fundamental level, Giotto Analyzer represents the spatial relationship among different cells as a spatial grid or network (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a). To create a spatial grid, each image field is partitioned into regular squares and the gene expression patterns associated with cells within each square are averaged. As such, the spatial grid is a coarse-resolution representation of the data. A spatial network preserves single-cell resolution, and it is created by connecting neighboring cells through a Delaunay triangulation network (see “Methods”). As an alternative approach to create a spatial network, the user can create a spatial network by selecting the <italic>k</italic>-nearest neighbors or using a fixed distance cut-off, which allows the user to fine-tune the influence of neighboring cells in more downstream applications (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8A). However, as shown in Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes, our analysis results are typically insensitive to the specific choice of parameter values.
<fig id="Fig4"><label>Fig. 4</label><caption><p>Layers of spatial gene expression variability. <bold>a</bold> Schematic representation of the subsequent steps needed to dissect the different layers of spatial gene expression variability. The original cell locations, a spatial grid, or a spatial network is required to identify individual genes with spatial coherent expression patterns. Those spatial genes can then be used as input to compute continuous spatial co-expression patterns or to find discrete spatial domains with HMRF. <bold>b–d</bold> Spatial gene expression analysis of the seqFISH+ somatosensory cortex dataset (distance unit = 1 pixel, 1 pixel ≈ 103 nm). <bold>b</bold> Examples of identified spatial genes within the somatosensory multi-layered cortex. The outer layers are on the left, while more inner layers are on the right. <bold>c</bold> Overlap between the top 1000 spatial genes identified from the 5 methods implemented in Giotto. <bold>d</bold> Visualization of spatial domains identified by the HMRF model. The layered anatomical structure (L1–6) of the somatosensory cortex is indicated on top. <bold>e, f</bold> Spatial gene expression analysis of the Visium kidney dataset (distance unit = 1 pixel, 1 pixel ≈ 1.46 μm). <bold>e</bold> Heatmap showing the spatial gene co-expression results. Identified spatial co-expression modules are indicated with different colors on top. <bold>f</bold> Metagene visualizations for all the identified spatial gene co-expression modules from <bold>e, g</bold> Selected gene visualizations for each identified spatial metagene in <bold>e</bold> and <bold>f</bold></p></caption><graphic xlink:href="13059_2021_2286_Fig4_HTML" id="MO4"/></fig></p>
      <p id="Par18">A basic and often first important task in spatial transcriptomic or proteomic analysis is to identify genes whose expression displays a coherent spatial pattern. To this end, Giotto implements a number of methods, including SpatialDE [<xref ref-type="bibr" rid="CR35">35</xref>], Trendsceek [<xref ref-type="bibr" rid="CR36">36</xref>], SPARK [<xref ref-type="bibr" rid="CR37">37</xref>], and two novel methods that are based on spatial network calculations. More specifically, the latter two methods are based on statistical enrichment of spatial network neighbors in the high gene expression state after binarization therefore named as BinSpect (Binary Spatial Extraction). The two methods, called BinSpect-<italic>k</italic>means and BinSpect-rank, respectively, differ in the way of binarization (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8B, Methods). To evaluate the performance of these methods, we applied each to the seqFISH+ dataset, where many genes are expected to display layer-specific patterns that are consistent with the anatomical structure of the somatosensory cortex (Fig. <xref rid="Fig4" ref-type="fig">4</xref>b, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8C). For each method, we selected the top 1000 genes as candidates for spatially coherent genes. Of note, a large subset of these genes was identified by at least four of the methods (Fig. <xref rid="Fig4" ref-type="fig">4</xref>c), these include previously established layer-specific genes such as <italic>Cux2</italic>, <italic>Grm2</italic>, and <italic>Rprm</italic>, indicating that genes with a known and strong spatially coherent expression pattern can be found in a robust manner. On the other hand, subsets of genes were detected by only one or a combination of specific method(s) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8D-G, see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes), suggesting it may be beneficial to combine results from all methods for comprehensiveness. The main advantage of the BinSpect methods introduced here is that they are significantly faster compared to SpatialDE (~ 6–8×), SPARK (~ 29–45×), and Trendsceek (~ 816–3300×) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8H-I, see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes).</p>
      <p id="Par19">Next, to assess how effective each method could retrieve known spatial patterns, we performed a quantitative evaluation based on simulated patterns. In this evaluation, we excluded trendsceek since its speed inhibited its use in large-scale simulation studies. Since each method was based on different assumptions or statistical models, we established an unbiased simulation strategy based on real high-quality data (seqFISH+), which did not rely on a simplified and arbitrary representation of spatial expression data, but instead incorporated all known and unknown variability factors observed in a large subset of genes (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S9, see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes for details). These results show that BinSpect (<italic>k</italic>means and rank) perform systematically better at retrieving known spatial genes, especially when additional noise is introduced. This observation is consistent irrespective of the spatial expression pattern that is evaluated (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8J).</p>
      <p id="Par20">Giotto implements two approaches to systematically summarize the spatial patterns of a large number of spatial genes (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a). First, Giotto identifies spatial domains with coherent gene expression patterns by implementing our recently developed hidden Markov random field (HMRF) model [<xref ref-type="bibr" rid="CR38">38</xref>]. An HMRF model detects spatial domains by comparing the gene expression patterns of each cell with its neighborhood to search for coherent patterns (see “Methods” for details). The inference is based on the joint probability of the intrinsic factor (expression pattern of each cell) and the extrinsic factor (domain state distribution of the surrounding cells) [<xref ref-type="bibr" rid="CR38">38</xref>]. The analysis starts with the identification of spatial genes using one of the previously described methods. Then we apply our HMRF model to infer the spatial domain state for each cell or spot. In applying HMRF to the seqFISH+ dataset, our analysis identified 9 distinct spatial domains that were consistent with the anatomic layer structure (Fig. <xref rid="Fig4" ref-type="fig">4</xref>d). For example, Domain D7 is similar to Layer L1, and Domain D2 is similar to Layer L2/3. Of note, such layered structure is not completely reflected by the distribution of different cell types (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1F), as numerous cell types (such as inhibitory neurons and endothelial cells) are distributed across multiple layers.</p>
      <p id="Par21">In addition, Giotto also implements a summary view of spatial gene expression patterns based on co-expression analysis. As an illustrating example, we analyzed a Visium dataset obtained from the kidney coronal section, which has known and distinguishable anatomic structures [<xref ref-type="bibr" rid="CR39">39</xref>, <xref ref-type="bibr" rid="CR40">40</xref>]. Using the BinSpect-<italic>k</italic>means algorithm in Giotto, we selected the top 500 spatially coherent genes. To identify spatial patterns, we created a co-expression matrix as follows. First, we spatially smoothed the gene expression data through spatial neighbor averaging, and then created co-expression modules by clustering the spatially smoothed data (Fig. <xref rid="Fig4" ref-type="fig">4</xref>e). Next, the spatial pattern of each module was summarized by a metagene defined by averaging the expression of all associated genes, which were stored and visualized (Fig. <xref rid="Fig4" ref-type="fig">4</xref>f). These spatial metagene profiles resemble the known anatomical structures of the mouse kidney and its surrounding environment, which is further corroborated by the spatial co-expressed genes in each module (see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes). Moreover, individual genes representing the co-expression patterns were easily extracted and displayed (Fig. <xref rid="Fig4" ref-type="fig">4</xref>g), providing researchers the opportunity to explore these spatial co-expression patterns in an unbiased manner on a transcriptome wide level. In addition, Giotto also provides a co-expression network based on single-cell expression data so that users can further filter or distinguish spatial co-expression within a local neighborhood from co-expression within the same cell. Finally, these global co-expression patterns are largely insensitive to the characteristics of the underlying spatial network (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S10A-D, see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes for details).</p>
    </sec>
    <sec id="Sec7">
      <title>Giotto identifies distinct cellular neighborhoods and interactions</title>
      <p id="Par22">Most cells reside within complex tissue structures, where they can communicate with their neighboring cells through specific molecules and signaling pathways. Hence, gene expression within each cell is likely driven by the combination of an intrinsic (cell-type-specific) component and an extrinsic component mediated by cell-cell communications (Fig. <xref rid="Fig5" ref-type="fig">5</xref>a). Giotto Analyzer provides a number of tools to explore and extract information related to the cell neighborhood organization, cell-cell communication, and the effect of neighboring cell types on gene expression. To identify distinct cell-type/cell-type interacting patterns, Giotto evaluates the enrichment of the frequency that each pair of cell types is proximal to each other. When analyzing the seqFISH+ somatosensory cortex data, we observed that layer-specific neurons usually interact with each other, which agrees with the known multi-layered organization of the cortex (Fig. <xref rid="Fig5" ref-type="fig">5</xref>b). Such homo-typic (same cell types) relationships are in agreement with what has been observed by others, including in other tissues [<xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR41">41</xref>]. Here we also notice that astrocytes and oligodendrocytes, L2/3 and L4 excitatory neurons, and L5 and L6 excitatory neurons form frequent hetero-typic (two different cell types) interactions. This is again in line with the expected anatomical structure of the cortex, due to positioning of the cortex layers and the increased presence of astrocytes and oligodendrocytes close to where they originate in the subventrical zone (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1F and Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Fig. <xref rid="Fig3" ref-type="fig">3</xref>F). These observations are robust to changes in number of spatial neighbors (<italic>k</italic>) (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11A, see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes) and are furthermore observed in both the seqFISH+ and osmFISH somatosensory cortex datasets (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11B, see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes).
<fig id="Fig5"><label>Fig. 5</label><caption><p>Cell neighborhood and cell-to-cell communication analyses. <bold>a</bold> Schematic of a multicellular tissue with an organized cellular structure (left) and environment specific gene expression (right). <bold>b</bold> A network representation of the pairwise interacting cell types identified by Giotto in the seqFISH+ somatosensory cortex dataset. Enriched or depleted interactions are depicted in red and green, respectively. Width of the edges indicates the strength of enrichment or depletion. <bold>c</bold> Visualization of the cell-to-cell communication analysis strategy. For each ligand-receptor pair from a known database a combined co-expression score was calculated for all cells of two interacting cell types (e.g., yellow and blue cells, left). This co-expression score was compared with a background distribution of co-expression scores based on spatial permutations (<italic>n</italic> = 1000). A cell-cell communication score based on adjusted <italic>p</italic> value and log2 fold change was used to rank a ligand-receptor pair across all identified cells of interacting cell types (right). <bold>d</bold> Heatmap (left) showing the ranking results for the ligand-receptor analysis as in <bold>c</bold> (<italic>y</italic>-axis) versus the same analysis but without spatial information (<italic>x</italic>-axis) for all the ligand-receptor pairs. AUC plot (right) indicating the percentage of expression ranks that need to be considered to recover all the first spatial ranks. <bold>e</bold> Dotplot for ligand-receptor pairs that exhibit differential cell-cell communication scores due to spatial cell-cell interactions. The size of the dot is correlated with the adjusted <italic>p</italic> value and the color indicates increased (red) or decreased (blue) activity. Dots highlighted with a green box are used as examples in <bold>f</bold>. <bold>f</bold> Heatmaps showing the increased expression of indicated ligand-receptor pairs between cells of two interacting cell types. <bold>g</bold> Barplot showing gene expression changes in subsets of endothelial cells (left) stratified based on their spatial interaction with other indicated cell types (right, schematic visualization)</p></caption><graphic xlink:href="13059_2021_2286_Fig5_HTML" id="MO5"/></fig></p>
      <p id="Par23">To extend this type of analysis to less defined tissues, we also analyzed a public MIBI dataset profiling the spatial proteomic patterns in triple negative breast cancer (TNBC) patients [<xref ref-type="bibr" rid="CR13">13</xref>]. Over 200,000 cells from 41 patients were analyzed together to generate over 20 cell populations (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S12A). Of note, the preferred mode of hetero-typic cell-type interactions is highly patient specific (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S12B, C). For example, in patients 4 and 5, the Keratin-marked epithelial cells and immune cells are well segregated from each other, whereas patients 10 and 17 feature a rather mixed environment between T cells, Keratin, and Ki67 cancer cells. (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S12B, C). These observations are consistent with prior findings [<xref ref-type="bibr" rid="CR13">13</xref>].</p>
      <p id="Par24">Giotto builds further on the concept of interacting cell types and aims to identify which known ligand-receptor pairs show increased or decreased co-expression, as a reasonable proxy for activity, in two cell types that spatially interact with each other (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c). By creating a background distribution through spatially aware permutations (see “Methods”), Giotto can identify which ligand-receptor pairs are potentially more or less active when cells from two cell types are spatially adjacent to each other. By comparing with a spatially unaware permutation method, similar as previously done [<xref ref-type="bibr" rid="CR42">42</xref>], we can see that the predictive power is limited without spatial information (AUC = 0.43) (Fig. <xref rid="Fig5" ref-type="fig">5</xref>c,d). This analysis is relatively stable to different numbers of spatial neighbors (<italic>k</italic>) within the spatial network (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11C, see Additional file <xref rid="MOESM3" ref-type="media">3</xref>: Supplementary Notes) and is observed for multiple ligand-receptor pairs spread out over multiple cell type pairs (Fig. <xref rid="Fig5" ref-type="fig">5</xref>e). Two potential examples of increased co-expression of a ligand-receptor pair are seen in spatially interacting astrocytes and <italic>Lhx6+</italic> inhibitory neurons displaying increased expression of <italic>Ddr2</italic>-<italic>Col1a1</italic> and <italic>Bmp6</italic>-<italic>Bmpr1b</italic> in corresponding endothelial cells and oligodendrocytes, respectively (Fig. <xref rid="Fig5" ref-type="fig">5</xref>f).</p>
      <p id="Par25">More generally, Giotto implements a number of statistical tests (<italic>t</italic>-test, limma, Wilcoxon, and a spatial permutation test) to identify genes whose expression level variation within a cell type is significantly associated with an interacting cell type (see “Methods”). After correcting for multiple hypothesis testing, we identified 73 such genes (|log2 FC| &gt; 2 and FDR &lt; 0.1), which we refer to as the interaction changed genes (ICGs). These ICGs are distributed among different interacting cell type pairs (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S11D). For example, we noticed that endothelial cells interacting with Lhx6 iNeuron were associated with increased expression of <italic>Jakmip1</italic> and <italic>Golgb1</italic>, whereas both <italic>Dact2</italic> and <italic>Ddx27</italic> expression levels were increased in cells from the same cell type but interacting with L4 eNeurons (Fig. <xref rid="Fig5" ref-type="fig">5</xref>g). On the opposite direction, interaction with astrocytes was associated with decreased expression of <italic>Abl1</italic> and <italic>Zswim8</italic>. Of note, all these subsets of endothelial cells do not show any difference in expression of their known marker genes, such as <italic>Pltp</italic>, <italic>Cldn5</italic>, and <italic>Apcdd1 (</italic>Fig. <xref rid="Fig5" ref-type="fig">5</xref>g, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S2D<italic>)</italic>.</p>
    </sec>
    <sec id="Sec8">
      <title>Giotto Viewer: interactive visualization and exploration of spatial transcriptomic data</title>
      <p id="Par26">Giotto Viewer is designed for interactive visualization and exploration of spatial transcriptomic data. Compared to the figure outputs from Giotto Analyzer, the objective of Giotto Viewer is to provide an interactive and user-friendly workspace where the user can easily explore the data and integrate the results from various analyses from Giotto Analyzer, and further incorporate additional information that cannot be easily quantified, such as cell staining images.</p>
      <p id="Par27">Giotto Viewer is a web-based application running in a local environment. It supports a multi-panel view of the spatial expression data. Each panel can be configured to display either the cells in physical or the expression space and overlays gene expression information on top. Complex geometries such as the 2D cell morphology and the associated large antibody staining images of the cells can be toggled easily within each panel. We use a Google Map-like algorithm to facilitate efficient navigation of large data (in terms of either images or cell numbers, see “Methods”). Importantly, panels are interlinked and interactive through sharing of cell ID and annotation information (see “Methods”). This allows seamless integration of different views and facilitates synchronous updates across all panels. We were able to apply Giotto Viewer to display over 500,000 data points (or mRNA transcripts) within a group of cells on one screen without any problem. Indicating the Giotto viewer is capable of handling large datasets.</p>
      <p id="Par28">As an illustrating example, we used Giotto Viewer to visualize the Visium brain dataset. By default, Giotto Viewer creates two panels, representing the data in physical and gene expression space, respectively (Fig. <xref rid="Fig6" ref-type="fig">6</xref>a, left). Any property that is contained in a Giotto object, such as gene expression levels, spatial cell-type enrichment values, cell-type or spatial domain annotations, can be selected for visualization. Additional imaging-related information, such as cell staining and segmentation, can also be overlaid. The size and location of field of view can be easily adjusted via the zoom and pan functions. At one end of the spectrum, the image content at each single spot can be visualized (Fig. <xref rid="Fig6" ref-type="fig">6</xref>a, right), revealing the underlying H&amp;E staining pattern. An animated video is provided to illustrate how the user can interactively explore the data and high-level annotations (Additional file 4: Supplementary Video).
<fig id="Fig6"><label>Fig. 6</label><caption><p>Giotto Viewer provides an interactive workspace to visualize and compare multiple cell annotations. <bold>a</bold> Visualization of the Visium brain dataset. Two interlinked panels are displayed, showing the data in the physical (left) and expression space (middle). A zoomed-in view shows underlying cell staining pattern at individual spots (right). <bold>b–e</bold> Visualization of the seqFISH+ mouse somatosensory cortex dataset. <bold>b</bold> Four interlinked panels are displayed, showing the spatial domain (top) and cell type (bottom) distribution in both physical (left) and expression space (right). <bold>c</bold> A zoomed-in view of <bold>b</bold> focusing on the L1–3 regions. Cells in domain D7 are selected (indicated by red outline in left panels and highlighted in the right panels) to enable comparison between spatial domain and cell type annotations. <bold>d</bold> Expression patterns of representative domain-specific genes. <bold>e</bold> Subcellular transcript localization patterns of all (top) or selected genes (middle and bottom) in a representative cell. Each dot represents an individual transcript</p></caption><graphic xlink:href="13059_2021_2286_Fig6_HTML" id="MO6"/></fig></p>
      <p id="Par29">
        <media xlink:href="13059_2021_2286_MOESM4_ESM.mp4" id="MOESM4">
          <caption>
            <p><bold>Additional file 4: Supplementary Video.</bold> Supplementary video demonstrating the usage and options of Giotto Viewer.</p>
          </caption>
        </media>
      </p>
      <p id="Par30">To demonstrate the utility of Giotto Viewer for exploring and integrating a large amount of information generated by Giotto Analyzer, we used the aforementioned seqFISH+ dataset again. Through the analysis described above, we identified various annotations such as cell types, spatially coherent genes, and spatial domains. Therefore, it is of interest to compare the cell type and spatial domain annotation to investigate their relationship. To this end, we created four interlinked panels corresponding to cell type and spatial domain annotations represented in the physical and expression space, respectively (Fig. <xref rid="Fig6" ref-type="fig">6</xref>b). The view of these panels can be synchronously updated through zoom and pan operations, enabling the user to easily explore the data and inspect any area of interest as desired. For example, as the user zooms in to the L1–L2/3 region (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c), it becomes apparent that domain D7 consists of a mixture of cell types including astrocytes, microglias, and interneurons. Giotto Viewer also provides a lasso tool that allows users to select cells of interest for further analyses. The borders of the selected cells are highlighted and can be easily traced across different panels. As an example, cells from domain D7 are selected and highlighted (Fig. <xref rid="Fig6" ref-type="fig">6</xref>c). By inspecting the pattern in the interlinked panels, it becomes obvious that this domain contains cells from multiple cell types. As such, both cell type and spatial domain differences contribute to cellular heterogeneity.</p>
      <p id="Par31">To gain further insights into the difference between cell type and spatial domain annotations, we saved the selected cells to an output file. The corresponding information was directly loaded into Giotto Analyzer for further analysis. This allowed us to identify a number of additional marker genes, such as <italic>Cacng3</italic> and <italic>Scg3</italic> (Fig. <xref rid="Fig6" ref-type="fig">6</xref>d). The seamless iteration between data analysis and visualization is a unique strength of Giotto.</p>
      <p id="Par32">In addition, Giotto Viewer also provides the functionality to explore subcellular transcript or protein localization patterns. As an example, we used Giotto Viewer to visualize the exact locations of individual transcripts in selected cells from the seqFISH+ dataset (Fig. <xref rid="Fig6" ref-type="fig">6</xref>e, Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S12). To facilitate real-time exploration of the transcript localization data, which is much larger than other data components, we adopted a position-based caching of transcriptomic data (see “Methods”). From the original staining image (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S13A), the users can zoom in on any specific region or select specific cells and visualize the locations of either all detected transcripts (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S13B) or selected genes of interest (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S13C). The spatial extent of all transcripts is useful for cell morphology analysis (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S13B), whereas the localization pattern of individual genes may provide functional insights into the corresponding genes (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S13C). For example, transcripts of <italic>Snrnp70</italic> and <italic>Car10</italic> are preferentially localized to the cell nucleus (delineated by DAPI background), while <italic>Agap2</italic> and <italic>Kif5a</italic> transcripts are distributed closer to the cell periphery (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S13C).</p>
    </sec>
  </sec>
  <sec id="Sec9">
    <title>Discussion</title>
    <p id="Par33">Single-cell analysis has entered a new phase—from characterizing cellular heterogeneity to interpreting the role of spatial organization. To overcome the challenge for data analysis and visualization, we have developed Giotto as a standardized toolbox, which implements a rich set of algorithms to address the common tasks for spatial transcriptomics/proteomic data analysis, including cell-type enrichment analysis, spatially coherent gene detection, spatial pattern recognition, and cell neighborhood and interaction analyses. Through analyzing diverse public datasets, we have demonstrated that Giotto can be broadly applied in conjunction with a wide range of spatial transcriptomic and proteomic technologies.</p>
    <p id="Par34">Giotto has a number of strengths, including modularization, interactive visualization, reproducibility, robustness, and flexibility. It differs from existing spatial data analysis and/or visualization pipelines [<xref ref-type="bibr" rid="CR8">8</xref>, <xref ref-type="bibr" rid="CR35">35</xref>, <xref ref-type="bibr" rid="CR36">36</xref>, <xref ref-type="bibr" rid="CR38">38</xref>, <xref ref-type="bibr" rid="CR43">43</xref>–<xref ref-type="bibr" rid="CR46">46</xref>] and is complementary to alternative strategies that computationally infer spatial information from single-cell RNAseq analysis [<xref ref-type="bibr" rid="CR47">47</xref>]. To our knowledge, Giotto is the first demonstrated general-purpose toolbox for spatial transcriptomic/proteomic data analysis, while the other methods are designed for specific data types [<xref ref-type="bibr" rid="CR44">44</xref>, <xref ref-type="bibr" rid="CR48">48</xref>–<xref ref-type="bibr" rid="CR50">50</xref>] or tasks, such as the identification of cell types [<xref ref-type="bibr" rid="CR43">43</xref>], marker genes [<xref ref-type="bibr" rid="CR35">35</xref>, <xref ref-type="bibr" rid="CR36">36</xref>], or domain patterns [<xref ref-type="bibr" rid="CR38">38</xref>]. Although both Seurat and Scanpy have now adopted spatial transcriptomic analysis functionalities, an important distinction is that our design of the Giotto object is specifically targeted for spatial transcriptomic data analysis, whereas the data structure in the other packages were originally designed for single-cell RNAseq analysis. The flexible design of Giotto makes it an ideal platform for incepting new algorithms. In addition, Giotto provides a convenient venue to integrate external information such as single-cell RNAseq data. As single-cell multi-omics data become more available, such integration may greatly enhance mechanistic understanding of the cell-state variation in development and diseases.</p>
  </sec>
  <sec id="Sec10">
    <title>Methods</title>
    <sec id="Sec11">
      <title>Giotto analyzer</title>
      <p id="Par35">Giotto Analyzer is an open-source R package that at its center creates a S4 Giotto object (Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S1A), which stores a gene expression matrix, the accompanying cell locations, and optionally any associated tissue images for visualization purposes. It contains multiple functions that can either extract or add new information to this object in a flexible manner. In this way users can either follow the default settings or build their own stepwise pipeline to extract and visualize spatial information. In the next part, the core steps and functions of Giotto Analyzer are explained and names of functions are depicted in italic.</p>
    </sec>
    <sec id="Sec12">
      <title>Quality control, pre-processing, and normalization</title>
      <p id="Par36">A Giotto object can be created with the function <italic>createGiottoObject</italic>, which requires as minimum input an expression matrix and the spatial coordinates of corresponding cell centroids. If a dataset is composed of multiple fields of view or tiles, they can be stitched together by using <italic>stitchFieldCoordinates</italic> or <italic>stitchTileCoordinates</italic>, respectively. Next, this Giotto object can be filtered with <italic>filterGiotto</italic> to exclude low-quality cells or lowly expressed or detected genes. As a guide for setting the filtering parameters, the cell and gene distributions can be viewed with <italic>filterDistributions</italic> and the effect of multiple parameters can be tested with <italic>filterCombinations</italic>. Raw counts can further be normalized with <italic>normalizeGiotto</italic>, which can adjust for library size, log transform the matrix, and/or perform rescaling. Next the function <italic>addStatistics</italic> computes general cell and gene statistics such as the total number of detected genes and counts per cell. To adjust for variation due to the former technical covariates the <italic>adjustGiottoMatrix</italic> can be applied to the normalized data. If the dataset does not have single-cell resolution, the above steps can still proceed while treating each spatially barcoded spot as a cell.</p>
    </sec>
    <sec id="Sec13">
      <title>Feature selection</title>
      <p id="Par37">To identify informative genes for clustering the <italic>calculateHVG</italic> can be used. Highly variable genes can be detected in two different manners. In the first method, all genes are divided in a predefined number (default = 20) of equal sized bins based on their expression. Within each bin the coefficient of variation for each gene is calculated and these are subsequently converted to <italic>z</italic>-scores. Genes above a predefined <italic>z</italic>-score threshold (default = 1.5) are selected for further analysis. For the second method, a loess regression model is calculated to predict the coefficient of variation based on the log-normalized expression values. Genes that show higher degree of variability than predicted are considered highly variable genes. Genes can be further filtered based on average expression values or detection percentage, which is returned by the <italic>addStatistics</italic> function.</p>
    </sec>
    <sec id="Sec14">
      <title>Dimensionality reduction</title>
      <p id="Par38">To reduce dimensions of the expression dataset users can perform principal component analysis (PCA) with <italic>runPCA</italic>. Significant PCs can be estimated with the <italic>signPCA</italic> function using a scree plot or the jackstraw method [<xref ref-type="bibr" rid="CR51">51</xref>]. Further nonlinear dimension reduction can be performed with uniform manifold approximation and projection (UMAP) [<xref ref-type="bibr" rid="CR20">20</xref>] and t-distributed stochastic neighbor embedding (t-SNE) [<xref ref-type="bibr" rid="CR19">19</xref>] directly on the expression matrix or on the PCA space using <italic>runUMAP</italic> and <italic>runtSNE</italic>, respectively.</p>
    </sec>
    <sec id="Sec15">
      <title>Clustering</title>
      <p id="Par39">First a shared or <italic>k</italic>-nearest neighbor (sNN or kNN) network needs to be constructed with <italic>createNearestNetwork</italic> which uses as input either processed expression values or their projection onto a selected dimension reduction space, such as that obtained from PCA. Louvain and Leiden clustering [<xref ref-type="bibr" rid="CR22">22</xref>] are implemented as <italic>doLouvainCluster</italic> and <italic>doLeidenCluster</italic> and can be directly applied on the created expression-based network. Further subclustering on all or a selected set of clusters can be performed in an analogous manner with <italic>doLouvainSubCluster</italic> or <italic>doLeidenSubCluster</italic>. Alternative clustering options such as <italic>k</italic>means and hierarchical clustering are also available as <italic>doKmeans</italic> and <italic>doHclust</italic>. To aid in further fine-tuning, the clustering results users can compute cluster correlation scores with <italic>getClusterSimilarity</italic> and decide to merge clusters with <italic>mergeClusters</italic> based on a user defined correlation threshold and cluster size parameters.</p>
    </sec>
    <sec id="Sec16">
      <title>Marker gene detection</title>
      <p id="Par40">Giotto provides 3 different ways within the function <italic>findMarkers</italic> to identify marker genes for one or more clusters: scran, mast, and gini. The first two methods have been previously published [<xref ref-type="bibr" rid="CR24">24</xref>, <xref ref-type="bibr" rid="CR52">52</xref>] and are implemented as <italic>findScranMarkers</italic> and <italic>findMastMarkers</italic>. In addition, we also developed a novel method based on the Gini-coefficient [<xref ref-type="bibr" rid="CR25">25</xref>] and implemented it as f<italic>indGiniMarkers</italic>, as schematically illustrated in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S2B. First, we calculate the average log-normalized expression for each gene in each cluster and represent the result as a matrix <italic>X</italic>, with <italic>X</italic>(<italic>i, j</italic>) representing the average expression of <italic>i</italic>th gene in <italic>j</italic>th cluster. Similarly, we calculate the detection fraction of each gene in each cluster and represent the result as a matrix <italic>Y</italic>, with <italic>Y</italic>(<italic>i, j</italic>) representing the detection fraction of <italic>i</italic>th gene in <italic>j</italic>th cluster. For each gene <italic>i</italic>, we calculate two related quantities <italic>G</italic><sub>expr</sub>(<italic>i</italic>) and <italic>G</italic><sub>det</sub>(<italic>i</italic>), by computing the Gini-coefficient associated with row <italic>X</italic>(<italic>i</italic>,.) and <italic>Y</italic>(<italic>i</italic>,.), respectively. Gini-coefficient of a vector <italic>x</italic> = [<italic>x</italic><sub>1</sub>,<italic>x</italic><sub>2</sub>, …, <italic>x</italic><sub><italic>n</italic></sub>] is defined as:</p>
      <p id="Par41">
        <disp-formula id="Equa">
          <alternatives>
            <tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ G(x)=\frac{\sum_{i=1}^n{\sum}_{j=1}^n\mid {x}_i-{x}_j\mid }{2\ {n}^2\ \overline{x}} $$\end{document}</tex-math>
            <mml:math id="M2" display="block">
              <mml:mi>G</mml:mi>
              <mml:mfenced close=")" open="(">
                <mml:mi>x</mml:mi>
              </mml:mfenced>
              <mml:mo>=</mml:mo>
              <mml:mfrac>
                <mml:mrow>
                  <mml:msubsup>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>i</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                  <mml:msubsup>
                    <mml:mo>∑</mml:mo>
                    <mml:mrow>
                      <mml:mi>j</mml:mi>
                      <mml:mo>=</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                    <mml:mi>n</mml:mi>
                  </mml:msubsup>
                  <mml:mo>∣</mml:mo>
                  <mml:msub>
                    <mml:mi>x</mml:mi>
                    <mml:mi>i</mml:mi>
                  </mml:msub>
                  <mml:mo>−</mml:mo>
                  <mml:msub>
                    <mml:mi>x</mml:mi>
                    <mml:mi>j</mml:mi>
                  </mml:msub>
                  <mml:mo>∣</mml:mo>
                </mml:mrow>
                <mml:mrow>
                  <mml:mn>2</mml:mn>
                  <mml:mspace width="0.25em"/>
                  <mml:msup>
                    <mml:mi>n</mml:mi>
                    <mml:mn>2</mml:mn>
                  </mml:msup>
                  <mml:mspace width="0.25em"/>
                  <mml:mover accent="true">
                    <mml:mi>x</mml:mi>
                    <mml:mo stretchy="true">¯</mml:mo>
                  </mml:mover>
                </mml:mrow>
              </mml:mfrac>
            </mml:math>
            <graphic xlink:href="13059_2021_2286_Article_Equa.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p id="Par42">In the meantime, for each gene <italic>i</italic>, we also rank the clusters based on either gene expression <italic>X</italic>(<italic>i</italic>,.) or detection rate <italic>Y</italic>(<italic>i</italic>,.), and the corresponding ranks are denoted by <italic>R</italic><sub>expr</sub>(<italic>i</italic>,.) and <italic>R</italic><sub>det</sub>(<italic>i</italic>,.), respectively. The ranks are subsequently rescaled between 0.1 and 1. Finally, an aggregated score <italic>G</italic><sub>final</sub>(<italic>i</italic>, <italic>j</italic>) is defined as follows:</p>
      <p id="Par43">
        <disp-formula id="Equb">
          <alternatives>
            <tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {G}_{\mathrm{final}}\left(i,j\right)={G}_{\mathrm{expr}}(i)\times {G}_{\mathrm{det}}(i)\times {R}_{\mathrm{expr}}\left(i,j\right)\times {R}_{\mathrm{det}}\left(i,j\right) $$\end{document}</tex-math>
            <mml:math id="M4" display="block">
              <mml:msub>
                <mml:mi>G</mml:mi>
                <mml:mtext>final</mml:mtext>
              </mml:msub>
              <mml:mfenced close=")" open="(" separators=",">
                <mml:mi>i</mml:mi>
                <mml:mi>j</mml:mi>
              </mml:mfenced>
              <mml:mo>=</mml:mo>
              <mml:msub>
                <mml:mi>G</mml:mi>
                <mml:mtext>expr</mml:mtext>
              </mml:msub>
              <mml:mfenced close=")" open="(">
                <mml:mi>i</mml:mi>
              </mml:mfenced>
              <mml:mo>×</mml:mo>
              <mml:msub>
                <mml:mi>G</mml:mi>
                <mml:mi>det</mml:mi>
              </mml:msub>
              <mml:mfenced close=")" open="(">
                <mml:mi>i</mml:mi>
              </mml:mfenced>
              <mml:mo>×</mml:mo>
              <mml:msub>
                <mml:mi>R</mml:mi>
                <mml:mtext>expr</mml:mtext>
              </mml:msub>
              <mml:mfenced close=")" open="(" separators=",">
                <mml:mi>i</mml:mi>
                <mml:mi>j</mml:mi>
              </mml:mfenced>
              <mml:mo>×</mml:mo>
              <mml:msub>
                <mml:mi>R</mml:mi>
                <mml:mi>det</mml:mi>
              </mml:msub>
              <mml:mfenced close=")" open="(" separators=",">
                <mml:mi>i</mml:mi>
                <mml:mi>j</mml:mi>
              </mml:mfenced>
            </mml:math>
            <graphic xlink:href="13059_2021_2286_Article_Equb.gif" position="anchor"/>
          </alternatives>
        </disp-formula>
      </p>
      <p id="Par44">The marker genes associated with a cluster <italic>j</italic> are then identified as those with top values of <italic>G</italic><sub>final</sub>(<italic>.</italic>, <italic>j</italic>). We have found this to be a fast and simple approach for effectively identifying genes that are both specific and sufficiently expressed in a particular cluster. In addition, an automated version to perform systematic pairwise comparisons between each cluster and all other clusters is also implemented as <italic>findMarkers_one_vs_all</italic>.</p>
    </sec>
    <sec id="Sec17">
      <title>Enrichment analysis of spatial expression data</title>
      <p id="Par45">Three enrichment methods are implemented into Giotto for enrichment analysis:</p>
      <sec id="Sec18">
        <title>Enrichment analysis by using PAGE (Parametric Analysis of Gene Set Enrichment) [<xref ref-type="bibr" rid="CR28">28</xref>]</title>
        <p id="Par46">In this method, a known set of <italic>m</italic> cell-type-specific marker genes is used as input. The objective is to evaluate if these genes are more highly expressed at each spot as compared to other spots. Specifically, for each spot, we define an enrichment score corresponding to a set of marker genes as follows. First, for each gene in the entire genome, we calculate the expression fold change of this gene by using the expression value in this spot versus the mean expression of all spots. Genes associated with high fold change values are annotated as spot-specific genes. The mean and standard deviation of these fold change values are denoted by <italic>μ</italic> and <italic>δ</italic>, respectively. For comparison, we also calculated the mean fold change associated with the set of marker genes, denoted by <italic>S</italic><sub><italic>m</italic></sub>. The enrichment score (ES) is then defined as follows:</p>
        <p id="Par47">
          <disp-formula id="Equc">
            <alternatives>
              <tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \mathrm{ES}=\frac{\left({S}_m-\mu \right)\times \sqrt{m}}{\delta } $$\end{document}</tex-math>
              <mml:math id="M6" display="block">
                <mml:mi>ES</mml:mi>
                <mml:mo>=</mml:mo>
                <mml:mfrac>
                  <mml:mrow>
                    <mml:mfenced close=")" open="(">
                      <mml:mrow>
                        <mml:msub>
                          <mml:mi>S</mml:mi>
                          <mml:mi>m</mml:mi>
                        </mml:msub>
                        <mml:mo>−</mml:mo>
                        <mml:mi>μ</mml:mi>
                      </mml:mrow>
                    </mml:mfenced>
                    <mml:mo>×</mml:mo>
                    <mml:msqrt>
                      <mml:mi>m</mml:mi>
                    </mml:msqrt>
                  </mml:mrow>
                  <mml:mi>δ</mml:mi>
                </mml:mfrac>
              </mml:math>
              <graphic xlink:href="13059_2021_2286_Article_Equc.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p id="Par48">A higher ES value indicates a cell type is more likely to be associated with the spot in question. To estimate the null distribution, we repeat the analysis by using 1000 random gene sets with the same size. The resulting values are fit by a normal distribution. This null distribution is used to derive <italic>p</italic> values associated with the enrichment scores for the real data. The PAGE algorithm is implemented as <italic>runPAGEEnrich</italic>.</p>
      </sec>
      <sec id="Sec19">
        <title>Enrichment analysis based on rank of gene expression</title>
        <p id="Par49">In this method, a known list of marker genes is not required. Instead, an external single-cell RNAseq dataset is used as input along with the cell-type annotation for each cell. A schematic of this method is illustrated in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S7A. The scRNAseq data matrix is used as input to define cell-type-specific gene signatures. A fold-change gene ranking is computed for each cell type (scRNAseq) and a relative gene ranking is computed for each spot or bead (Slide-seq is indicated here as an example), which is then used to derive enrichment scores. More precisely, Giotto automatically identifies cell-type-specific gene signatures (<italic>makeSignMatrixRank</italic>) by computing the fold change for each gene, <italic>g</italic>, defined as the ratio between its mean expression level within a cell type and the mean level across all cell types, followed by evaluating its relative rank <italic>R1</italic><sub><italic>g</italic></sub> among all genes. In the meantime, genes are also ranked based on location specificity, <italic>R2</italic><sub><italic>g</italic></sub>, using the spatial expression data. This is obtained by calculating the fold change comparing its expression level at a specific spot versus the overall mean and then ranking the results. The mutual rank [<xref ref-type="bibr" rid="CR53">53</xref>] of gene <italic>g</italic> is then computed as</p>
        <p id="Par50">
          <disp-formula id="Equd">
            <alternatives>
              <tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ {R}_g=\sqrt{R{1}_g\times R{2}_g} $$\end{document}</tex-math>
              <mml:math id="M8" display="block">
                <mml:msub>
                  <mml:mi>R</mml:mi>
                  <mml:mi>g</mml:mi>
                </mml:msub>
                <mml:mo>=</mml:mo>
                <mml:msqrt>
                  <mml:mrow>
                    <mml:mi>R</mml:mi>
                    <mml:msub>
                      <mml:mn>1</mml:mn>
                      <mml:mi>g</mml:mi>
                    </mml:msub>
                    <mml:mo>×</mml:mo>
                    <mml:mi>R</mml:mi>
                    <mml:msub>
                      <mml:mn>2</mml:mn>
                      <mml:mi>g</mml:mi>
                    </mml:msub>
                  </mml:mrow>
                </mml:msqrt>
              </mml:math>
              <graphic xlink:href="13059_2021_2286_Article_Equd.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p id="Par51">which is then converted to a rank-biased precision (<italic>RBP</italic>) score [<xref ref-type="bibr" rid="CR54">54</xref>], which is defined as follows:</p>
        <p id="Par52">
          <disp-formula id="Eque">
            <alternatives>
              <tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \mathrm{RB}{\mathrm{P}}_g=\left(1-p\right)\times {p}^{\left({R}_g-1\right)} $$\end{document}</tex-math>
              <mml:math id="M10" display="block">
                <mml:mi>RB</mml:mi>
                <mml:msub>
                  <mml:mi mathvariant="normal">P</mml:mi>
                  <mml:mi>g</mml:mi>
                </mml:msub>
                <mml:mo>=</mml:mo>
                <mml:mfenced close=")" open="(">
                  <mml:mrow>
                    <mml:mn>1</mml:mn>
                    <mml:mo>−</mml:mo>
                    <mml:mi>p</mml:mi>
                  </mml:mrow>
                </mml:mfenced>
                <mml:mo>×</mml:mo>
                <mml:msup>
                  <mml:mi>p</mml:mi>
                  <mml:mfenced close=")" open="(">
                    <mml:mrow>
                      <mml:msub>
                        <mml:mi>R</mml:mi>
                        <mml:mi>g</mml:mi>
                      </mml:msub>
                      <mml:mo>−</mml:mo>
                      <mml:mn>1</mml:mn>
                    </mml:mrow>
                  </mml:mfenced>
                </mml:msup>
              </mml:math>
              <graphic xlink:href="13059_2021_2286_Article_Eque.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p id="Par53">where <italic>p</italic> is a constant set at 0.99. Intuitively, the RBP score is used to select genes that are highly ranked in terms of both cell-type specificity and location specificity. The tuning parameter <italic>p</italic> in the above equation is introduced to control the relative weight of highly ranked genes. In the end, the enrichment score (ES) is determined by the sum of genes with top-ranked RBP scores:
<disp-formula id="Equf"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \mathrm{ES}=\sum \limits_{k=1}^{100}{\mathrm{RBP}}_k $$\end{document}</tex-math><mml:math id="M12" display="block"><mml:mi>ES</mml:mi><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>100</mml:mn></mml:munderover><mml:msub><mml:mi>RBP</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math><graphic xlink:href="13059_2021_2286_Article_Equf.gif" position="anchor"/></alternatives></disp-formula></p>
        <p id="Par54">The RANK method is implemented as the <italic>runRankEnrich</italic> function. To estimate the null distribution, we randomly shuffle the ranking of genes in the scRNAseq dataset for 1000 times of each cell type and then apply the above analysis to the shuffled data. The resulting values are fit by a gamma distribution, using the “<italic>fitdistrplus</italic>” package in R. This null distribution is used to derive <italic>p</italic> values associated with the enrichment scores for the real data.</p>
      </sec>
      <sec id="Sec20">
        <title>Enrichment analysis by using hypergeometric distribution</title>
        <p id="Par55">This method also requires a known set of <italic>m</italic> cell-type-specific marker genes as input, but it evaluates enrichment by simply using a hypergeometric test. A contingency table is constructed by dividing all genes into four non-overlapping categories, based on marker gene annotation and binarization of gene expression values. The latter is determined by top 5% expression genes for each spot. Based on this contingency table, a <italic>p</italic> value is calculated. Here the enrichment score is defined as −log10 (<italic>p</italic> value).</p>
      </sec>
    </sec>
    <sec id="Sec21">
      <title>Simulation analysis of seqFISH+ data</title>
      <p id="Par56">We coarse grain seqFISH+ dataset to simulate spatial expression data of a multiple cellular level. The dataset is gridded by 500 pixels by 500 pixels (~ 51.5 μm) length (Fig. <xref rid="Fig3" ref-type="fig">3</xref>b). This length is quite similar with the diameter of spots from Visium spatial expression dataset (55 μm). Then the gene expression for each grid is calculated as the sum of normalized single-cell expressions within the grid. After normalization of gene expression for coarse-gridded data, we perform enrichment analysis by using somatosensory cortex single-cell RNAseq data from [<xref ref-type="bibr" rid="CR29">29</xref>] (GSE60361). scRNAseq data is normalized by <italic>normalizeGiotto</italic> using Giotto. Marker genes for each cell type are identified by using <italic>findMarkers_one_vs_all</italic> with parameter: method = “scran”, expression_values = “normalized”. We then intersect those marker genes with genes in seqFISH+ data. Top 100 intersect marker genes for each cell type are kept for further enrichment analysis.</p>
      <p id="Par57">To match the cell-type annotations between seqFISH+ and scRNAseq data, we aggregated the major clusters annotated by Giotto pipeline. “L2/3 eNeuron,” “L4 eNeuron,” “L5 eNeuron,” and “L6 eNeuron” were marked as excitatory neuron (eNeuron). “Adarb2 iNeuron” and “Lhx6 iNeuron” were marked as inhibitory neurons (iNeuron). “Endothelial” and “mural” were marked as “endothelial_mural”. The percentage of cell type for each grid was calculated to evaluate the performance of enrichment methods. Top 100 marker genes identified were used for PAGE and hypergeometric analysis by <italic>createSpatialEnrich</italic> with parameters: enrich_method = “PAGE” and enrich_method = “hypergeometric,” respectively. The single-cell expression matrix as well as cell labels were used for rank matrix generation by using <italic>makeSignMatrixRank</italic> with default parameters and enrichment analysis by using <italic>createSpatialEnrich</italic> with parameter: enrich_method = “rank.”</p>
    </sec>
    <sec id="Sec22">
      <title>Spatial grid and neighborhood network</title>
      <p id="Par58">A spatial grid is defined as a Cartesian coordinate system with defined units of width and height and is created with the function <italic>createSpatialGrid</italic>. The gene expression levels of cells within each grid box are averaged. Another representation of the spatial relationship is the spatial neighborhood network (Fig. <xref rid="Fig4" ref-type="fig">4</xref>a), where each node represents a cell, and each pair of neighboring cells is connected through an edge. The number of neighbors can be defined by setting (a minimal) <italic>k</italic> and/or radial distance from the centroid position of each cell, and the edge weights can be either binary or continuous. Alternatively, a Delaunay network can be created, which does not require <italic>k</italic> or radial distance to be specified and is based on Delaunay triangulation. The Delaunay triangulation and its related concept of Voronoi Tessellation was previously applied to study species distribution in the field of eco-geography with the goal to partition a space according to certain neighborhood relations of a given set of points (e.g., cells) in this space. It has been used and adopted in various fields of biology, including to analyze tissue distribution at the single-cell level [<xref ref-type="bibr" rid="CR12">12</xref>].</p>
    </sec>
    <sec id="Sec23">
      <title>Spatially coherent gene detection</title>
      <p id="Par59">In total, Giotto currently has five different methods to identify spatial coherent gene expression patterns. Three previously published methods SpatialDE [<xref ref-type="bibr" rid="CR35">35</xref>], Trendsceek [<xref ref-type="bibr" rid="CR36">36</xref>], and SPARK [<xref ref-type="bibr" rid="CR37">37</xref>] can be run with the functions <italic>spatialDE</italic>, <italic>trendSceek</italic>, and <italic>spark</italic>. The two new methods introduced here are based on statistical enrichment of binarized expression data in neighboring cells within the spatial network, as schematically illustrated in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S8B. First, for each gene, expression values are binarized using <italic>k</italic>means clustering (<italic>k</italic> = 2) or simple thresholding on rank (default = 30%), which is the only difference between these two methods. Next, a contingency table is calculated based on the binarized expression values between neighboring cells and used as input for a Fisher exact test to obtain an odds ratio estimate and <italic>p</italic> value. In this way, a gene is considered a spatial gene if it is usually found to be highly expressed in proximal or neighboring cells. In addition to the odds ratio and <italic>p</italic> value for each gene, the average gene expression, the number of highly expressing cells, and the number of hub cells are computed and provided. A hub cell is considered a cell with high expression of a gene of interest and which has multiple high expressing neighboring cells of that gene. These features can be used by the user to further rank and explore spatial genes with different characteristics. We have named the latter method BinSpect (Binary Spatial extract) and implemented it as <italic>binSpect</italic>, within this function the user can choose to use <italic>k</italic>means or threshold ranking to binarize the expression matrix.</p>
    </sec>
    <sec id="Sec24">
      <title>Spatial pattern simulation data</title>
      <p id="Par60">Our strategy for simulating spatial patterns is schematically illustrated in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S9. To generate known spatial patterns based on real spatial data, we first randomly select a large number of genes (<italic>n</italic> = 100) from the seqFISH+ dataset, each with their own unique expression distribution, drop-outs, expression levels, and other unknown factors of variation. We then create a fixed spatial pattern, ordered the cells according to their gene expression levels, and created two groups. One group (group G) contains all the highest expressing cells and is equal to the size of the spatial pattern and another group (group R) contains all the other remaining cells. Cells within group G are given a probability Pr, while cells in group R are given the probability 1 − Pr. This probability is then used to randomly assign each cell to the fixed pattern, such that with Pr = 1 all the highest expressing cells are being randomly positioned into the spatial pattern, while with Pr = 0.5 this process is completely random. This assignment is repeated multiple times (<italic>n</italic> = 6) so that a distribution is obtained for a range of probability levels Pr = {0.5, 0.65. 0.8, 0.9, 0.95, 0.99, 1}. Thus, for each pattern, we create 4200 simulations (100 genes × 7 probability levels × 6 random samples). This analysis is carried out using the function <italic>runPatternSimulation</italic>.</p>
    </sec>
    <sec id="Sec25">
      <title>Spatial co-expression patterns</title>
      <p id="Par61">To identify robust patterns of co-expressed spatial genes the functions <italic>detectSpatialCorGenes</italic> and <italic>clusterSpatialCorGenes</italic> can be used on the identified individual spatial genes. The first function spatially smooths gene expression through a grid averaging or <italic>k</italic>-nearest neighbor approach and then calculates the gene-to-gene correlation (default = Pearson) scores. In addition, it also calculates gene-to-gene correlation within the original single cells to distinguish between spatial and cell intrinsic correlation. The second function performs hierarchical clustering to cluster the gene-to-gene co-expression network into modules and creates metagene scores by averaging all the genes for each identified co-expression module, which can subsequently be viewed using the standard viewing options provided in Giotto.</p>
    </sec>
    <sec id="Sec26">
      <title>Spatial domain detection</title>
      <p id="Par62">Spatial domains are identified with a hidden Markov random field (HMRF) model as previously described [<xref ref-type="bibr" rid="CR38">38</xref>]. In brief, HMRF is a graph-based model that infers the state of each cell as the joint probability of the cell’s intrinsic state (inferred from the cell’s own gene expression vector), and the cell’s extrinsic state, which is based on the distribution of the states of the cell’s neighbors. The notion of state is the spatial domain in our case. The neighborhood graph defines the extent of the neighbor cell influence, together with the parameter beta that defines the strength of the interaction of cells. At the end, HMRF assigns each cell to one of <italic>k</italic> spatial domains (<italic>k</italic> to be defined by the user). This HMRF model is implemented in Python and incorporated in Giotto by using the consecutive wrapper functions <italic>doHMRF</italic>, <italic>viewHMRF</italic>, and <italic>addHMRF</italic> to discover, visualize, and select HMRF domain annotations respectively.</p>
    </sec>
    <sec id="Sec27">
      <title>Identification of proximal or interacting cell types</title>
      <p id="Par63">To identify cell types that are found to be preferentially located in a spatially proximal manner, as a proxy for potential cell-cell interactions, we use a random permutation (default <italic>n</italic> = 1000) strategy of the cell type labels within a defined spatial network. First, we label the edges of the spatial network as homo- or hetero-typic, if they connect cells of identical or different annotated cell types, respectively. Then we determine the ratio of observed-over-expected frequencies between two cell types, where the expected frequencies are calculated from the permutations. Associated <italic>p</italic> values are calculated by observing how often the observed value were higher or lower than the simulated values for respectively increased or decreased frequencies. A wrapper for this analysis is implemented in Giotto Analyzer as <italic>cellProximityEnrichment</italic>.</p>
    </sec>
    <sec id="Sec28">
      <title>Gene expression changes within cellular neighborhood</title>
      <sec id="Sec29">
        <title>Spatially informed ligand-receptor pairing</title>
        <p id="Par64">To investigate how cells communicate within their microenvironment, Giotto can incorporate known ligand-receptor information from existing databases [<xref ref-type="bibr" rid="CR55">55</xref>]. By calculating the increased spatial co-expression of such gene pairs in neighboring cells from two cell types, it estimates which ligand-receptor pairs might be used more (or less) for communication between interacting cells from two cell types. This is implemented in the function <italic>spatCellCellcom</italic>, which is short for spatially informed cell-to-cell communication. More specifically, for each ligand-receptor pair, a cell-cell-communication score S is calculated for every pair of cell types. In particular, for ligand L, receptor R, cell type A, and cell type B, S(L,R,A,B) is defined as the weighted average expression of R and L in all the interacting A and Bs, or in other words in the subset of A and B cells that are proximal to each other (based on spatial network).</p>
        <p id="Par65">
          <disp-formula id="Equg">
            <alternatives>
              <tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$$ \overline{S\left(L,R,A,B\right)}=\frac{1}{n}{\sum}_{i=1}^n{L}_i+\frac{1}{m}{\sum}_{j=1}^m{R}_j; $$\end{document}</tex-math>
              <mml:math id="M14" display="block">
                <mml:mover accent="true">
                  <mml:mrow>
                    <mml:mi>S</mml:mi>
                    <mml:mfenced close=")" open="(" separators=",,,">
                      <mml:mi>L</mml:mi>
                      <mml:mi>R</mml:mi>
                      <mml:mi>A</mml:mi>
                      <mml:mi>B</mml:mi>
                    </mml:mfenced>
                  </mml:mrow>
                  <mml:mo stretchy="true">¯</mml:mo>
                </mml:mover>
                <mml:mo>=</mml:mo>
                <mml:mfrac>
                  <mml:mn>1</mml:mn>
                  <mml:mi>n</mml:mi>
                </mml:mfrac>
                <mml:msubsup>
                  <mml:mo>∑</mml:mo>
                  <mml:mrow>
                    <mml:mi>i</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mi>n</mml:mi>
                </mml:msubsup>
                <mml:msub>
                  <mml:mi>L</mml:mi>
                  <mml:mi>i</mml:mi>
                </mml:msub>
                <mml:mo>+</mml:mo>
                <mml:mfrac>
                  <mml:mn>1</mml:mn>
                  <mml:mi>m</mml:mi>
                </mml:mfrac>
                <mml:msubsup>
                  <mml:mo>∑</mml:mo>
                  <mml:mrow>
                    <mml:mi>j</mml:mi>
                    <mml:mo>=</mml:mo>
                    <mml:mn>1</mml:mn>
                  </mml:mrow>
                  <mml:mi>m</mml:mi>
                </mml:msubsup>
                <mml:msub>
                  <mml:mi>R</mml:mi>
                  <mml:mi>j</mml:mi>
                </mml:msub>
                <mml:mo>;</mml:mo>
              </mml:math>
              <graphic xlink:href="13059_2021_2286_Article_Equg.gif" position="anchor"/>
            </alternatives>
          </disp-formula>
        </p>
        <p id="Par66">where <italic>n</italic> represents the number of A-type cells that interact with B-type cells, <italic>m</italic> represents the number of B-type cells that interact with A-type cells, <italic>L</italic><sub><italic>i</italic></sub> represents the expression level of the ligand in the <italic>i</italic>th A-type cell, and <italic>R</italic><sub><italic>j</italic></sub> represents the expression level of the receptor in the <italic>j</italic>th B-type cell. Next, to assess if the calculated score <italic>S</italic> is statistically significant, a random null distribution is computed. This background distribution is created by shuffling cell locations within the same cell type for A and B for 1000 (= default) times. In each round, a permutation score <italic>Sp</italic> is calculated using the same formula. Associated <italic>p</italic> values were calculated as the probability of <italic>Sp</italic> to be greater or smaller than the actual observed score <italic>S</italic>. The <italic>p</italic> values for all ligand-receptor pairs in all cell-type pairs were subsequently adjusted for multiple hypothesis testing. A final differential activity score was calculated by multiplying the log2 fold change with the adjusted <italic>p</italic> values. The ligand-receptor pair information was retrieved from FANTOM5 [<xref ref-type="bibr" rid="CR55">55</xref>].</p>
      </sec>
      <sec id="Sec30">
        <title>Expression-informed ligand-receptor pairing</title>
        <p id="Par67">This analysis can be performed with <italic>exprCellCellcom</italic>, short for expression-informed cell-to-cell communication, and is analogous to the method for “spatially informed ligand-receptor pairing” (described above) except that no spatial information is used. This means that ligand-receptor expression levels are calculated for all cells from two cell types and that the background null distribution is similarly computed by reshuffling all cell labels. This approach is used to mimic scRNAseq-based analysis.</p>
      </sec>
      <sec id="Sec31">
        <title>Comparison between spatially and expression-informed ligand-receptor pairing</title>
        <p id="Par68">We perform a direct comparison between expression-informed ligand-receptor pairing (with the function <italic>exprCellCellcom</italic>) and spatially informed ligand-receptor pairing (with the function <italic>spatCellCellcom</italic>). For both analyses, we rank all ligand-receptor pairs according to their interaction-induced expression changes in all pairs of cell types. This means that for <italic>spatCellCellcom</italic>, we use the cells from two cell types that proximally interact (based on the spatial network), and for <italic>exprCellCellcom</italic>, we use all cells from two cell types. Next, we compute the AUC to examine how efficient the expression ranked ligand-receptor pairs can predict the top-ranked spatially informed ligand-receptor pair.</p>
      </sec>
      <sec id="Sec32">
        <title>Cell-type interaction mediated gene expression changes</title>
        <p id="Par69">To identify all potential gene expression changes associated with specific cell-type interactions in an unbiased manner, Giotto implements 4 differential expression tests to identify such interaction changed genes (ICG), including <italic>t</italic>-test, limma test, Wilcoxon rank sum test, and spatial permutation test. For each cell type, we divide the annotated cells into two complementary subgroups, with one containing the subset which neighbor cells from another specific cell type. Differentially expressed genes between these groups are identified by using each of the statistical tests mentioned above. To adjust for multiple hypothesis testing, a background null distribution is created by reshuffling the cells within the same cell type. This analysis is implemented as the function <italic>findInteractionChangedGenes</italic> or the shorter version <italic>findICG.</italic> Additional filtering can be achieved by using filterInteractionChangedGenes or filterICG in order to reduce errors due to low (interacting) cell number, fold change or absolute expression differences.</p>
      </sec>
    </sec>
    <sec id="Sec33">
      <title>Giotto viewer</title>
      <p id="Par70">Giotto Viewer is a web-based application that can be installed on any Linux-, Windows-, or MAC OS-based computer. The Giotto Viewer canvas consists of a cell object layer, containing all the differently shaped cells, an image layer corresponding to staining images, and an annotation property layer that specifies the cluster membership and gene expression information. Below is a setup overview:</p>
      <sec id="Sec34">
        <title>Input files</title>
        <p id="Par71">The minimal input files for Giotto Viewer contain the gene expression matrix and the cell centroid spatial coordinates. Such information can be either provided manually in tabular format, or directly loaded through the output files of Giotto Analyzer. If available, additional input files such as cell segmentations (ROI files), staining images (TIFF files), and transcript locations (TXT files) can also be incorporated. Giotto Viewer provides tools to process such information for visualization (see next sections).</p>
        <p id="Par72">To streamline setup, we provide guidelines for setting up various platforms.
<list list-type="simple"><list-item><label>(i)</label><p id="Par73">SeqFISH/MerFISH: this applies to SeqFISH/merFISH where multi-field imaging data, transcript locations, and cell segmentations are available. Giotto Viewer first extracts multi-channel images (where a channel may correspond to Nissl, DAPI, polyA) from TIFF using ImageMagick library (<ext-link ext-link-type="uri" xlink:href="https://imagemagick.org/">https://imagemagick.org/</ext-link>). Images within the same channel are then stitched. For stitching, Giotto provides an option to stitch images across multiple fields of view (FOV) with gaps in between. The layout can be manually controlled by modifying a coordinate offset file specifying the relative positions of FOVs. To automate these various actions, an initial setup is done using “giotto_setup_image --require-stitch=y --image=y --image-multi-channel=y --segmentation=y --multi-fov=y --output-json=step1.json” which creates a template that sets up the sequence of tasks to be performed. Details of the template such as specifying the image file, the stitch offset file, and tiling are next achieved through “giotto_step1_modify_json” script. Lastly, sequence of tasks is performed through “smfish_step1_setup”. An overview of the Giotto Viewer processing steps is in Additional file <xref rid="MOESM1" ref-type="media">1</xref>: Fig. S14.</p><p id="Par74">Cell boundary segmentation is a necessary step for assignment of each transcript to its corresponding cells. However, this task is highly dependent on the specific technology platform therefore not implemented in Giotto. On the other hand, Giotto Viewer can accept user-provided cell boundary segmentation information as input, in the form of Region-of-Interest (ROI) files, for visualization. Giotto Viewer extracts information from the ROI files by adapting a JAVA program based on the ImageJ framework.</p><p id="Par75">The next step is tiling the stitched staining image. The purpose of tiling is to support a Google Maps-like algorithm to facilitate multi-level zooming and navigation. Conceptually, this is achieved by tiling of the large image to smaller chunks at various zoom levels to efficiently display a very large image (our stitched image frequently exceeds several hundred megabytes). This is implemented in Giotto Viewer by using the tileup package in Ruby (<ext-link ext-link-type="uri" xlink:href="https://github.com/rktjmp/tileup">https://github.com/rktjmp/tileup</ext-link>). This creates a set of tiled images corresponding to 6 zoom levels with 1.5× increment. The size of each tile is fixed at 256 by 256 pixels.</p></list-item></list><list list-type="simple"><list-item><label>(ii)</label><p id="Par76">For the Visium platform with an accompanying image, the highest resolution raw H&amp;E staining image is first padded to be square dimension. Next, a template is setup: “giotto_setup_image --require-stitch=n --image=y --image-multi-channel=n --segmentation=n --multi-fov=n --output-json=step1.json”. The next two steps “giotto_step1_modify_json” and “smfish_step1_setup” are proceeded as usual.</p></list-item><list-item><label>(iii)</label><p id="Par77">Other platforms with no image nor cell segmentations (e.g., Slide-seq). We run “giotto_setup_image --require-stitch=n --image=n --image-multi-channel=n --segmentation=n --multi-fov=n --output-json=step1.json”, followed by the subsequent two steps (described in ii). Giotto Viewer renders cells as circles in the physical space, and there is not an image background overlay.</p></list-item></list></p>
      </sec>
      <sec id="Sec35">
        <title>Panels</title>
        <p id="Par78">Giotto Viewer supports a multi-panel view configuration, which means that users can load and visualize any number of panels simultaneously (default number = 2), and add different types of data to each panel. To permit flexibility, there are four types of panels implemented in the Giotto Viewer: <italic>PanelTsne</italic>, <italic>PanelPhysical</italic>, and <italic>PanelPhysicalSimple</italic>, <italic>PanelPhysical10X</italic>. <italic>PanelTsne</italic> requires cell coordinates in the expression space as input. <italic>PanelPhysical</italic> lays out the cells in the physical space in the segmented cell shapes. <italic>PanelPhysicalSimple</italic> is a simplified version of <italic>PanelPhysical</italic> except that cell segmentation and staining images are not required, and instead renders cell objects as fixed size circle markers. <italic>PanelPhysical10X</italic> is unique to Visium in that it also registers the spot-level details of the Visium platform. The number of panels and the panel types can be specified, for example, through: “giotto_setup_viewer --num-panel=2 --input-preprocess-json=step1.json --panel-1=PanelPhysical10X --panel-2=PanelTsne --output-json=step2.json --input-annotation-list=annotation_list.txt”.</p>
      </sec>
      <sec id="Sec36">
        <title>Annotations</title>
        <p id="Par79">Cell annotations, such as spatial domains and cell types, are required input for Giotto Viewer. In brief, Giotto Viewer supports both continuous- and discrete-value annotations. Annotations generated by Giotto Analyzer can be directly imported by using the <italic>exportGiottoFunction().</italic></p>
        <p id="Par80">Once panels, annotations, images are all prepared, then website files are created using: “smfish_read_config -c step2.json -o test.js -p test.html -q test.css”. A python webserver is next launched (python3 -m http.server) and the viewer can be viewed at http://localhost:8000/test.html.</p>
      </sec>
      <sec id="Sec37">
        <title>Implementation of interactive visualization of multi-layer spatial transcriptomic information</title>
        <p id="Par81">The Giotto Viewer package is written in Javascript utilizing a number of state-of-the-art toolboxes including Leaflet.js (<ext-link ext-link-type="uri" xlink:href="https://leafletjs.com/">https://leafletjs.com/</ext-link>), Turf.js (<ext-link ext-link-type="uri" xlink:href="https://turfjs.org/">https://turfjs.org/</ext-link>), Bootstrap (<ext-link ext-link-type="uri" xlink:href="https://getbootstrap.com/">https://getbootstrap.com/</ext-link>), and jQuery (<ext-link ext-link-type="uri" xlink:href="https://jquery.com/">https://jquery.com/</ext-link>). The Leaflet.js toolbox is used to efficiently visualize and explore multiple layers of information in the data, based on a Google Maps-like algorithm. Leaflet.js recognizes tiles prepared previously by the tileup package and implements caching of tiles and tile handling, allowing it to display large stitched images.</p>
        <p id="Par82">As described above, Giotto Viewer contains 4 types of panels: <italic>PanelTsne, PanelPhysical</italic>, and <italic>PanelPhysicalSimple</italic>, <italic>PanelPhysical10X.</italic> The implementation of these 4 panels follows closely the paradigm of object-oriented design in Javascript, specified by the MDN Web Docs and ECMAScript. Briefly, the various panel types are motivated by the fact that depending on data availability, properties of cells change from dataset to dataset, so different ways of cell representation should be considered. In the presence of cell staining images, images should serve as background overlays to the data. If segmentation information is available, cells should be represented in their true cell shape. Yet when neither staining nor segmentation is available, Giotto Viewer represents cells as basic geometric shapes (circles) so that the viewer can still run in the absence of staining or segmentation data. We design the panel classes with these considerations in mind. Giotto Viewer makes it easy for users to specify the number of panels, the type of each panel, and the layout configuration. Users can specify such information in a JSON formatted configuration file. A script then automatically generates the HTML, CSS, and JS files of the comparative viewer that is ready for exploration in a standard web browser.</p>
        <p id="Par83">To enable interactivity, panels are linked to each other. This is implemented by first defining mouseover and mouseout events for each cell object. The exact specification of events depends on the type of panel, the action chosen by the user, and the context in which the action is performed. Next, we maintain equivalent cell objects across panels by creating a master look-up table to link cell IDs in different panels. This is useful to facilitate interactive data exploration and comparison, synchronous updates of zoom and view positions during data exploration. Finally, the order and dependency with which interactions are executed are enforced by constantly polling element states and proceeding each step only when states are changed. In the API, the functions <italic>addInteractions(), addTooltips()</italic> enable the easy specification of cross-panel interactions. In the JSON configuration file, interactions between panels are simply defined by the user using the “interact_X: [panel ids]” and “sync_X: [panel ids]” lines.</p>
        <p id="Par84">Giotto Viewer provides an intuitive utility to select a subset of cells of interest for visualization and further analysis. The toggle lasso utility allows a user to hand-draw an enclosed shape in any displayed panel to select cells directly. We implement this function by modifying the Leaflet-lasso.js toolbox to add support for the selection of the dynamic polygon-shaped markers. Giotto Viewer can also highlight Individual cells with summary information displayed. This is achieved by using built-in functions in the Turf.js toolbox.</p>
      </sec>
      <sec id="Sec38">
        <title>Visualizing subcellular transcript localization</title>
        <p id="Par85">To visualize subcellular transcript localization information, an additional layer is created in Leaflet.js. To efficiently handle the large amount of data, we implemented new functions to cache only a small subset of transcripts that fall within the current viewing area, to be rendered by the Leaflet engine and thereby saving the system resources.</p>
      </sec>
      <sec id="Sec39">
        <title>Visualizing cell-type enrichment data</title>
        <p id="Par86">Continuous annotations providing cell type enrichment per spot are exported from Giotto Analyzer to Giotto Viewer via the <italic>exportGiotto()</italic> function. Then as with all other annotations, these are added to the setup JSON used to generate the website files. The cell type enrichments will appear under the “Annotations” tab of the viewer panel.</p>
      </sec>
      <sec id="Sec40">
        <title>Selecting and exporting cells</title>
        <p id="Par87">To encourage iterative analysis between the Giotto Viewer and Giotto Analyzer, users may select any cells of interest with the Lasso button. Then clicking “Save” will save the cell IDs that can be read in Giotto Analyzer within the R environment.</p>
      </sec>
    </sec>
  </sec>
  <sec sec-type="supplementary-material">
    <title>Supplementary Information</title>
    <sec id="Sec41">
      <p>
        <supplementary-material content-type="local-data" id="MOESM1">
          <media xlink:href="13059_2021_2286_MOESM1_ESM.docx">
            <caption>
              <p><bold>Additional file 1.</bold> Supplementary Figures. Supplementary figures and legends.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM2">
          <media xlink:href="13059_2021_2286_MOESM2_ESM.docx">
            <caption>
              <p><bold>Additional file 2: Table S1.</bold> Table of different technologies and datasets that were analyzed with Giotto.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM3">
          <media xlink:href="13059_2021_2286_MOESM3_ESM.docx">
            <caption>
              <p><bold>Additional file 3.</bold> Supplementary Notes. Supplementary notes and additional information about data analysis with Giotto.</p>
            </caption>
          </media>
        </supplementary-material>
        <supplementary-material content-type="local-data" id="MOESM5">
          <media xlink:href="13059_2021_2286_MOESM5_ESM.docx">
            <caption>
              <p><bold>Additional file 5.</bold> Review history.</p>
            </caption>
          </media>
        </supplementary-material>
      </p>
    </sec>
  </sec>
</body>
<back>
  <fn-group>
    <fn>
      <p>
        <bold>Publisher’s Note</bold>
      </p>
      <p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
    </fn>
    <fn>
      <p>Ruben Dries and Qian Zhu contributed equally to this work.</p>
    </fn>
  </fn-group>
  <ack>
    <sec id="FPar1">
      <title>Review history</title>
      <p id="Par88">The review history is available as Additional file <xref rid="MOESM5" ref-type="media">5</xref>.</p>
    </sec>
    <sec id="FPar2">
      <title>Peer review information</title>
      <p id="Par89">Barbara Cheifet was the primary editor of this article and managed its editorial process and peer review in collaboration with the rest of the editorial team.</p>
    </sec>
  </ack>
  <notes notes-type="author-contribution">
    <title>Authors’ contributions</title>
    <p>R.Dr. conceived the project and developed the Giotto analysis software. Q.Z., A.S. and T.Z. developed the Giotto viewer software. G.Y. supervised the project and helped interpret and present the results. R.Do., Q.Z., and R.Dr. developed and implemented spatial enrichment algorithms. H.L. and R.Dr. developed and implemented in silico slicing. Y.F. and R.Dr. implemented 3D visualization. R.Dr., Q.Z., R.Do., H.L., and K.L. analyzed datasets and validated methods. C.H.L.E., F.B., R.E.G., N.P., and L.C. tested the software and provided feedback. R.Dr., Q.Z., and G.Y. wrote the manuscript with input from all authors. All authors read and approved the final manuscript.</p>
  </notes>
  <notes notes-type="funding-information">
    <title>Funding</title>
    <p>This research was supported by NIH grants UH3HL145609 and R01AG066028 to L.C. and G.Y.</p>
  </notes>
  <notes notes-type="data-availability">
    <title>Availability of data and materials</title>
    <p>General information, examples, and tutorials are available at http://<ext-link ext-link-type="uri" xlink:href="http://www.spatialgiotto.com">www.spatialgiotto.com</ext-link>. Users can follow to replicate the analyses in this paper and to learn more about the parameters of specific functions in the Giotto package. Giotto v1.0.2 was used for generating the analyses in this paper. The tutorials give a detailed description of parameters surrounding functions of interest. Dataset examples give a dataset-centric recipe for connecting various analysis components. Download and setup instructions are available. A Docker image has been created and is readily available [<xref ref-type="bibr" rid="CR56">56</xref>] for ease of access and testing. In addition, more detailed information about both the stable and development version of Giotto is available on <ext-link ext-link-type="uri" xlink:href="https://rubd.github.io/Giotto_site/">https://rubd.github.io/Giotto_site/</ext-link>, which is associated with the Giotto source code from our github repository [<xref ref-type="bibr" rid="CR57">57</xref>] and under MIT license. These links also provide additional information about installation issues, documentation, extensive information about how to use Giotto, a news section, and guidelines for external contributions.</p>
    <p>The following datasets were used for demonstrations: seqFISH+ data was obtained from the Cai lab [<xref ref-type="bibr" rid="CR9">9</xref>], merFISH data was downloaded from <ext-link ext-link-type="uri" xlink:href="https://datadryad.org/stash/dataset/doi:10.5061/dryad.8t8s248">https://datadryad.org/stash/dataset/doi:10.5061/dryad.8t8s248</ext-link> [<xref ref-type="bibr" rid="CR14">14</xref>], osmFISH data was downloaded from <ext-link ext-link-type="uri" xlink:href="https://linnarssonlab.org/osmFISH/">https://linnarssonlab.org/osmFISH/</ext-link> [<xref ref-type="bibr" rid="CR11">11</xref>], STARmap data was downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.starmapresources.com/data">https://www.starmapresources.com/data</ext-link> [<xref ref-type="bibr" rid="CR7">7</xref>], Visium 10X brain and kidney datasets were downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/resources/datasets/">https://www.10xgenomics.com/resources/datasets/</ext-link>, Slide-seq data was obtained from <ext-link ext-link-type="uri" xlink:href="https://portals.broadinstitute.org/single_cell/study/slide-seq-study">https://portals.broadinstitute.org/single_cell/study/slide-seq-study</ext-link> [<xref ref-type="bibr" rid="CR8">8</xref>], t-cyCIF data was downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.cycif.org/data/">https://www.cycif.org/data/</ext-link> [<xref ref-type="bibr" rid="CR10">10</xref>] MIBI data was downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.angelolab.com/mibi-data">https://www.angelolab.com/mibi-data</ext-link> [<xref ref-type="bibr" rid="CR13">13</xref>] and CODEX data was downloaded from <ext-link ext-link-type="uri" xlink:href="http://welikesharingdata.blob.core.windows.net/forshare/index.html">http://welikesharingdata.blob.core.windows.net/forshare/index.html</ext-link> [<xref ref-type="bibr" rid="CR12">12</xref>]. Ready to use and preformatted datasets can be found on <ext-link ext-link-type="uri" xlink:href="https://github.com/RubD/spatial-datasets">https://github.com/RubD/spatial-datasets</ext-link> and can be automatically downloaded with the <italic>getSpatialDataset</italic> function in Giotto.</p>
  </notes>
  <notes id="FPar3">
    <title>Ethics approval and consent to participate</title>
    <p id="Par90">Not applicable.</p>
  </notes>
  <notes id="FPar4" notes-type="COI-statement">
    <title>Competing interests</title>
    <p id="Par91">The authors declare that they have no competing interests.</p>
  </notes>
  <ref-list id="Bib1">
    <title>References</title>
    <ref id="CR1">
      <label>1.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Han</surname>
            <given-names>X</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Fei</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Sun</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Lai</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Mapping the mouse cell atlas by microwell-Seq</article-title>
        <source>Cell.</source>
        <year>2018</year>
        <volume>173</volume>
        <fpage>1307</fpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.05.012</pub-id>
        <pub-id pub-id-type="pmid">29775597</pub-id>
      </element-citation>
    </ref>
    <ref id="CR2">
      <label>2.</label>
      <mixed-citation publication-type="other">Tabula Muris Consortium, overall coordination, logistical coordination, organ collection and processing, library preparation and sequencing, Computational data analysis, et al. Single-cell transcriptomics of 20 mouse organs creates a Tabula Muris. Nature. 2018;562:367–72.</mixed-citation>
    </ref>
    <ref id="CR3">
      <label>3.</label>
      <mixed-citation publication-type="other">Lubeck E, Coskun AF, Zhiyentayev T, Ahmad M, Cai L. Single-cell in situ RNA profiling by sequential hybridization. Nat. Methods. 2014. p. 360–361.</mixed-citation>
    </ref>
    <ref id="CR4">
      <label>4.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chen</surname>
            <given-names>KH</given-names>
          </name>
          <name>
            <surname>Boettiger</surname>
            <given-names>AN</given-names>
          </name>
          <name>
            <surname>Moffitt</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Wang</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Zhuang</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>RNA imaging. Spatially resolved, highly multiplexed RNA profiling in single cells</article-title>
        <source>Science</source>
        <year>2015</year>
        <volume>348</volume>
        <fpage>aaa6090</fpage>
        <pub-id pub-id-type="doi">10.1126/science.aaa6090</pub-id>
        <pub-id pub-id-type="pmid">25858977</pub-id>
      </element-citation>
    </ref>
    <ref id="CR5">
      <label>5.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ståhl</surname>
            <given-names>PL</given-names>
          </name>
          <name>
            <surname>Salmén</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Vickovic</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lundmark</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Navarro</surname>
            <given-names>JF</given-names>
          </name>
          <name>
            <surname>Magnusson</surname>
            <given-names>J</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>
        <source>Science.</source>
        <year>2016</year>
        <volume>353</volume>
        <fpage>78</fpage>
        <lpage>82</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aaf2403</pub-id>
        <pub-id pub-id-type="pmid">27365449</pub-id>
      </element-citation>
    </ref>
    <ref id="CR6">
      <label>6.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Shah</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lubeck</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Cai</surname>
            <given-names>L</given-names>
          </name>
        </person-group>
        <article-title>In situ transcription profiling of single cells reveals spatial organization of cells in the mouse hippocampus</article-title>
        <source>Neuron.</source>
        <year>2016</year>
        <volume>92</volume>
        <fpage>342</fpage>
        <lpage>357</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuron.2016.10.001</pub-id>
        <pub-id pub-id-type="pmid">27764670</pub-id>
      </element-citation>
    </ref>
    <ref id="CR7">
      <label>7.</label>
      <mixed-citation publication-type="other">Wang X, Allen WE, Wright MA, Sylwestrak EL, Samusik N, Vesuna S, et al. Three-dimensional intact-tissue sequencing of single-cell transcriptional states. Science. 2018;361. Available from: 10.1126/science.aat5691</mixed-citation>
    </ref>
    <ref id="CR8">
      <label>8.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Rodriques</surname>
            <given-names>SG</given-names>
          </name>
          <name>
            <surname>Stickels</surname>
            <given-names>RR</given-names>
          </name>
          <name>
            <surname>Goeva</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Martin</surname>
            <given-names>CA</given-names>
          </name>
          <name>
            <surname>Murray</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Vanderburg</surname>
            <given-names>CR</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Slide-seq: a scalable technology for measuring genome-wide expression at high spatial resolution</article-title>
        <source>Science.</source>
        <year>2019</year>
        <volume>363</volume>
        <fpage>1463</fpage>
        <lpage>1467</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aaw1219</pub-id>
        <pub-id pub-id-type="pmid">30923225</pub-id>
      </element-citation>
    </ref>
    <ref id="CR9">
      <label>9.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Eng</surname>
            <given-names>C-HL</given-names>
          </name>
          <name>
            <surname>Lawson</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Dries</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Koulena</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Takei</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Transcriptome-scale super-resolved imaging in tissues by RNA seqFISH+</article-title>
        <source>Nature</source>
        <year>2019</year>
        <volume>568</volume>
        <fpage>235</fpage>
        <lpage>239</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1049-y</pub-id>
        <pub-id pub-id-type="pmid">30911168</pub-id>
      </element-citation>
    </ref>
    <ref id="CR10">
      <label>10.</label>
      <mixed-citation publication-type="other">Lin J-R, Izar B, Wang S, Yapp C, Mei S, Shah PM, et al. Highly multiplexed immunofluorescence imaging of human tissues and tumors using t-CyCIF and conventional optical microscopes. Elife. 2018;7. Available from: 10.7554/eLife.31657</mixed-citation>
    </ref>
    <ref id="CR11">
      <label>11.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Codeluppi</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Borm</surname>
            <given-names>LE</given-names>
          </name>
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>van Lunteren</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Svensson</surname>
            <given-names>CI</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Spatial organization of the somatosensory cortex revealed by osmFISH</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>932</fpage>
        <lpage>935</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-018-0175-z</pub-id>
        <pub-id pub-id-type="pmid">30377364</pub-id>
      </element-citation>
    </ref>
    <ref id="CR12">
      <label>12.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Goltsev</surname>
            <given-names>Y</given-names>
          </name>
          <name>
            <surname>Samusik</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Kennedy-Darling</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Bhate</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Hale</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Vazquez</surname>
            <given-names>G</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Deep profiling of mouse splenic architecture with CODEX multiplexed imaging</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>968</fpage>
        <lpage>981</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.07.010</pub-id>
        <pub-id pub-id-type="pmid">30078711</pub-id>
      </element-citation>
    </ref>
    <ref id="CR13">
      <label>13.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Keren</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Bosse</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Marquez</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Angoshtari</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Jain</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Varma</surname>
            <given-names>S</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A structured tumor-immune microenvironment in triple negative breast cancer revealed by multiplexed ion beam imaging</article-title>
        <source>Cell</source>
        <year>2018</year>
        <volume>174</volume>
        <fpage>1373</fpage>
        <lpage>1387</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2018.08.039</pub-id>
        <pub-id pub-id-type="pmid">30193111</pub-id>
      </element-citation>
    </ref>
    <ref id="CR14">
      <label>14.</label>
      <mixed-citation publication-type="other">Moffitt JR, Bambah-Mukku D, Eichhorn SW, Vaughn E, Shekhar K, Perez JD, et al. Molecular, spatial, and functional single-cell profiling of the hypothalamic preoptic region. Science. 2018;362. Available from: 10.1126/science.aau5324</mixed-citation>
    </ref>
    <ref id="CR15">
      <label>15.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Satija</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Farrell</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Gennert</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Schier</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Regev</surname>
            <given-names>A</given-names>
          </name>
        </person-group>
        <article-title>Spatial reconstruction of single-cell gene expression data</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>495</fpage>
        <lpage>502</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id>
        <pub-id pub-id-type="pmid">25867923</pub-id>
      </element-citation>
    </ref>
    <ref id="CR16">
      <label>16.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Achim</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Pettit</surname>
            <given-names>J-B</given-names>
          </name>
          <name>
            <surname>Saraiva</surname>
            <given-names>LR</given-names>
          </name>
          <name>
            <surname>Gavriouchkina</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Larsson</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Arendt</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>High-throughput spatial mapping of single-cell RNA-seq data to tissue of origin</article-title>
        <source>Nat Biotechnol</source>
        <year>2015</year>
        <volume>33</volume>
        <fpage>503</fpage>
        <lpage>509</lpage>
        <pub-id pub-id-type="doi">10.1038/nbt.3209</pub-id>
        <pub-id pub-id-type="pmid">25867922</pub-id>
      </element-citation>
    </ref>
    <ref id="CR17">
      <label>17.</label>
      <mixed-citation publication-type="other">Regev A, Teichmann SA, Lander ES, Amit I, Benoist C, Birney E, et al. The human cell atlas. Elife. 2017;6. Available from: 10.7554/eLife.27041</mixed-citation>
    </ref>
    <ref id="CR18">
      <label>18.</label>
      <mixed-citation publication-type="other">HuBMAP Consortium. The human body at cellular resolution: the NIH Human Biomolecular Atlas Program. Nature. 2019;574:187–92.</mixed-citation>
    </ref>
    <ref id="CR19">
      <label>19.</label>
      <mixed-citation publication-type="other">Maaten L van der, Hinton G. Visualizing Data using t-SNE. J Mach Learn Res 2008;9:2579–2605.</mixed-citation>
    </ref>
    <ref id="CR20">
      <label>20.</label>
      <mixed-citation publication-type="other">Becht E, McInnes L, Healy J, Dutertre C-A, Kwok IWH, Ng LG, et al. Dimensionality reduction for visualizing single-cell data using UMAP. Nat Biotechnol. 2018; Available from: 10.1038/nbt.4314</mixed-citation>
    </ref>
    <ref id="CR21">
      <label>21.</label>
      <mixed-citation publication-type="other">Blondel VD, Guillaume J-L, Lambiotte R, Lefebvre E. Fast unfolding of communities in large networks. Journal of Statistical Mechanics: Theory and Experiment. 2008. p. P10008. Available from: 10.1088/1742-5468/2008/10/p10008</mixed-citation>
    </ref>
    <ref id="CR22">
      <label>22.</label>
      <mixed-citation publication-type="other">Traag VA, Waltman L, van Eck NJ. From Louvain to Leiden: guaranteeing well-connected communities. Sci Rep 2019;9:5233.</mixed-citation>
    </ref>
    <ref id="CR23">
      <label>23.</label>
      <mixed-citation publication-type="other">Lun A, Bach K, Kim JK, Scialdone A, Haghverdi L. Package “scran.” 2017; Available from: <ext-link ext-link-type="uri" xlink:href="https://bioconductor.org/packages/release/bioc/html/scran.html">https://bioconductor.org/packages/release/bioc/html/scran.html</ext-link>.</mixed-citation>
    </ref>
    <ref id="CR24">
      <label>24.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Finak</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>McDavid</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Yajima</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Deng</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Gersuk</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Shalek</surname>
            <given-names>AK</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title>
        <source>Genome Biol</source>
        <year>2015</year>
        <volume>16</volume>
        <fpage>278</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-015-0844-5</pub-id>
        <pub-id pub-id-type="pmid">26653891</pub-id>
      </element-citation>
    </ref>
    <ref id="CR25">
      <label>25.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jiang</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Chen</surname>
            <given-names>H</given-names>
          </name>
          <name>
            <surname>Pinello</surname>
            <given-names>L</given-names>
          </name>
          <name>
            <surname>Yuan</surname>
            <given-names>G-C</given-names>
          </name>
        </person-group>
        <article-title>GiniClust: detecting rare cell types from single-cell gene expression data with Gini index</article-title>
        <source>Genome Biol</source>
        <year>2016</year>
        <volume>17</volume>
        <fpage>144</fpage>
        <pub-id pub-id-type="doi">10.1186/s13059-016-1010-4</pub-id>
        <pub-id pub-id-type="pmid">27368803</pub-id>
      </element-citation>
    </ref>
    <ref id="CR26">
      <label>26.</label>
      <mixed-citation publication-type="other">Datasets - 10x Genomics. [cited 2020 Sep 27]. Available from: <ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/resources/datasets/">https://www.10xgenomics.com/resources/datasets/</ext-link></mixed-citation>
    </ref>
    <ref id="CR27">
      <label>27.</label>
      <mixed-citation publication-type="other">Liu Y, Yang M, Deng Y, Su G, Enninful A, Guo CC, Tebaldi T, Zhang D, Kim D, Bai Z, Norris E, Pan A, Li J, Xiao Y, Halene S, Fan R. High-Spatial-Resolution Multi-Omics Sequencing via Deterministic Barcoding in Tissue. Cell. 2020;183(6):1665-1681.e18.</mixed-citation>
    </ref>
    <ref id="CR28">
      <label>28.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Kim</surname>
            <given-names>S-Y</given-names>
          </name>
          <name>
            <surname>Volsky</surname>
            <given-names>DJ</given-names>
          </name>
        </person-group>
        <article-title>PAGE: parametric analysis of gene set enrichment</article-title>
        <source>BMC Bioinformatics</source>
        <year>2005</year>
        <volume>6</volume>
        <fpage>144</fpage>
        <pub-id pub-id-type="doi">10.1186/1471-2105-6-144</pub-id>
        <pub-id pub-id-type="pmid">15941488</pub-id>
      </element-citation>
    </ref>
    <ref id="CR29">
      <label>29.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Zeisel</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Muñoz-Manchado</surname>
            <given-names>AB</given-names>
          </name>
          <name>
            <surname>Codeluppi</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Lönnerberg</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>La Manno</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Juréus</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Brain structure. Cell types in the mouse cortex and hippocampus revealed by single-cell RNA-seq</article-title>
        <source>Science.</source>
        <year>2015</year>
        <volume>347</volume>
        <fpage>1138</fpage>
        <lpage>1142</lpage>
        <pub-id pub-id-type="doi">10.1126/science.aaa1934</pub-id>
        <pub-id pub-id-type="pmid">25700174</pub-id>
      </element-citation>
    </ref>
    <ref id="CR30">
      <label>30.</label>
      <mixed-citation publication-type="other">Cable DM, Murray E, Zou LS, Goeva A, Macosko EZ. Robust decomposition of cell type mixtures in spatial transcriptomics. bioRxiv. biorxiv.org; 2020; Available from: <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2020.05.07.082750v1.abstract">https://www.biorxiv.org/content/10.1101/2020.05.07.082750v1.abstract</ext-link></mixed-citation>
    </ref>
    <ref id="CR31">
      <label>31.</label>
      <mixed-citation publication-type="other">Zeisel A, Hochgerner H, Lönnerberg P, Johnsson A, Memic F, van der Zwan J, et al. Molecular architecture of the mouse nervous system. Cell. 2018. 999–1014.e22. Available from: 10.1016/j.cell.2018.06.021</mixed-citation>
    </ref>
    <ref id="CR32">
      <label>32.</label>
      <mixed-citation publication-type="other">Zetler G. Distribution of peptidergic neurons in mammalian brain. Aspects of Neuroendocrinology. Springer Berlin Heidelberg; 1970. p. 287–95.</mixed-citation>
    </ref>
    <ref id="CR33">
      <label>33.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Yager</surname>
            <given-names>LM</given-names>
          </name>
          <name>
            <surname>Garcia</surname>
            <given-names>AF</given-names>
          </name>
          <name>
            <surname>Wunsch</surname>
            <given-names>AM</given-names>
          </name>
          <name>
            <surname>Ferguson</surname>
            <given-names>SM</given-names>
          </name>
        </person-group>
        <article-title>The ins and outs of the striatum: role in drug addiction</article-title>
        <source>Neuroscience.</source>
        <year>2015</year>
        <volume>301</volume>
        <fpage>529</fpage>
        <lpage>541</lpage>
        <pub-id pub-id-type="doi">10.1016/j.neuroscience.2015.06.033</pub-id>
        <pub-id pub-id-type="pmid">26116518</pub-id>
      </element-citation>
    </ref>
    <ref id="CR34">
      <label>34.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Roales-Buján</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Páez</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Guerra</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Rodríguez</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Vío</surname>
            <given-names>K</given-names>
          </name>
          <name>
            <surname>Ho-Plagaro</surname>
            <given-names>A</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Astrocytes acquire morphological and functional characteristics of ependymal cells following disruption of ependyma in hydrocephalus</article-title>
        <source>Acta Neuropathol</source>
        <year>2012</year>
        <volume>124</volume>
        <fpage>531</fpage>
        <lpage>546</lpage>
        <pub-id pub-id-type="doi">10.1007/s00401-012-0992-6</pub-id>
        <pub-id pub-id-type="pmid">22576081</pub-id>
      </element-citation>
    </ref>
    <ref id="CR35">
      <label>35.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Svensson</surname>
            <given-names>V</given-names>
          </name>
          <name>
            <surname>Teichmann</surname>
            <given-names>SA</given-names>
          </name>
          <name>
            <surname>Stegle</surname>
            <given-names>O</given-names>
          </name>
        </person-group>
        <article-title>SpatialDE: identification of spatially variable genes</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>343</fpage>
        <lpage>346</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4636</pub-id>
        <pub-id pub-id-type="pmid">29553579</pub-id>
      </element-citation>
    </ref>
    <ref id="CR36">
      <label>36.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Edsgärd</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Johnsson</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Sandberg</surname>
            <given-names>R</given-names>
          </name>
        </person-group>
        <article-title>Identification of spatial expression trends in single-cell gene expression data</article-title>
        <source>Nat Methods</source>
        <year>2018</year>
        <volume>15</volume>
        <fpage>339</fpage>
        <lpage>342</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4634</pub-id>
        <pub-id pub-id-type="pmid">29553578</pub-id>
      </element-citation>
    </ref>
    <ref id="CR37">
      <label>37.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Sun</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <article-title>Statistical analysis of spatial expression patterns for spatially resolved transcriptomic studies</article-title>
        <source>Nat Methods</source>
        <year>2020</year>
        <volume>17</volume>
        <fpage>193</fpage>
        <lpage>200</lpage>
        <pub-id pub-id-type="doi">10.1038/s41592-019-0701-7</pub-id>
        <pub-id pub-id-type="pmid">31988518</pub-id>
      </element-citation>
    </ref>
    <ref id="CR38">
      <label>38.</label>
      <mixed-citation publication-type="other">Zhu Q, Shah S, Dries R, Cai L, Yuan G-C. Identification of spatially associated subpopulations by combining scRNAseq and sequential fluorescence in situ hybridization data. Nat Biotechnol. 2018; Available from: 10.1038/nbt.4260</mixed-citation>
    </ref>
    <ref id="CR39">
      <label>39.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ban</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Min</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Baek</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Kwon</surname>
            <given-names>HM</given-names>
          </name>
          <name>
            <surname>Popescu</surname>
            <given-names>G</given-names>
          </name>
          <name>
            <surname>Jung</surname>
            <given-names>W</given-names>
          </name>
        </person-group>
        <article-title>Optical properties of acute kidney injury measured by quantitative phase imaging</article-title>
        <source>Biomed Opt Express</source>
        <year>2018</year>
        <volume>9</volume>
        <fpage>921</fpage>
        <lpage>932</lpage>
        <pub-id pub-id-type="doi">10.1364/BOE.9.000921</pub-id>
        <pub-id pub-id-type="pmid">29541494</pub-id>
      </element-citation>
    </ref>
    <ref id="CR40">
      <label>40.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ransick</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Lindström</surname>
            <given-names>NO</given-names>
          </name>
          <name>
            <surname>Liu</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Zhu</surname>
            <given-names>Q</given-names>
          </name>
          <name>
            <surname>Guo</surname>
            <given-names>J-J</given-names>
          </name>
          <name>
            <surname>Alvarado</surname>
            <given-names>GF</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell profiling reveals sex, lineage, and regional diversity in the mouse kidney</article-title>
        <source>Dev Cell</source>
        <year>2019</year>
        <volume>51</volume>
        <fpage>399</fpage>
        <lpage>413</lpage>
        <pub-id pub-id-type="doi">10.1016/j.devcel.2019.10.005</pub-id>
        <pub-id pub-id-type="pmid">31689386</pub-id>
      </element-citation>
    </ref>
    <ref id="CR41">
      <label>41.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Jackson</surname>
            <given-names>HW</given-names>
          </name>
          <name>
            <surname>Fischer</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Zanotelli</surname>
            <given-names>VRT</given-names>
          </name>
          <name>
            <surname>Ali</surname>
            <given-names>HR</given-names>
          </name>
          <name>
            <surname>Mechera</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Soysal</surname>
            <given-names>SD</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>The single-cell pathology landscape of breast cancer</article-title>
        <source>Nature.</source>
        <year>2020</year>
        <volume>578</volume>
        <fpage>615</fpage>
        <lpage>620</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1876-x</pub-id>
        <pub-id pub-id-type="pmid">31959985</pub-id>
      </element-citation>
    </ref>
    <ref id="CR42">
      <label>42.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Vento-Tormo</surname>
            <given-names>R</given-names>
          </name>
          <name>
            <surname>Efremova</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Botting</surname>
            <given-names>RA</given-names>
          </name>
          <name>
            <surname>Turco</surname>
            <given-names>MY</given-names>
          </name>
          <name>
            <surname>Vento-Tormo</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Meyer</surname>
            <given-names>KB</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>Single-cell reconstruction of the early maternal-fetal interface in humans</article-title>
        <source>Nature.</source>
        <year>2018</year>
        <volume>563</volume>
        <fpage>347</fpage>
        <lpage>353</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-018-0698-6</pub-id>
        <pub-id pub-id-type="pmid">30429548</pub-id>
      </element-citation>
    </ref>
    <ref id="CR43">
      <label>43.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stuart</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Butler</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Hoffman</surname>
            <given-names>P</given-names>
          </name>
          <name>
            <surname>Hafemeister</surname>
            <given-names>C</given-names>
          </name>
          <name>
            <surname>Papalexi</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Mauck</surname>
            <given-names>WM</given-names>
            <suffix>3rd</suffix>
          </name>
          <etal/>
        </person-group>
        <article-title>Comprehensive integration of single-cell data</article-title>
        <source>Cell</source>
        <year>2019</year>
        <volume>177</volume>
        <fpage>1888</fpage>
        <lpage>1902</lpage>
        <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id>
        <pub-id pub-id-type="pmid">31178118</pub-id>
      </element-citation>
    </ref>
    <ref id="CR44">
      <label>44.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Schapiro</surname>
            <given-names>D</given-names>
          </name>
          <name>
            <surname>Jackson</surname>
            <given-names>HW</given-names>
          </name>
          <name>
            <surname>Raghuraman</surname>
            <given-names>S</given-names>
          </name>
          <name>
            <surname>Fischer</surname>
            <given-names>JR</given-names>
          </name>
          <name>
            <surname>Zanotelli</surname>
            <given-names>VRT</given-names>
          </name>
          <name>
            <surname>Schulz</surname>
            <given-names>D</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>histoCAT: analysis of cell phenotypes and interactions in multiplex image cytometry data</article-title>
        <source>Nat Methods</source>
        <year>2017</year>
        <volume>14</volume>
        <fpage>873</fpage>
        <lpage>876</lpage>
        <pub-id pub-id-type="doi">10.1038/nmeth.4391</pub-id>
        <pub-id pub-id-type="pmid">28783155</pub-id>
      </element-citation>
    </ref>
    <ref id="CR45">
      <label>45.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Fernández Navarro</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Lundeberg</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Ståhl</surname>
            <given-names>PL</given-names>
          </name>
        </person-group>
        <article-title>ST viewer: a tool for analysis and visualization of spatial transcriptomics datasets</article-title>
        <source>Bioinformatics.</source>
        <year>2019</year>
        <volume>35</volume>
        <fpage>1058</fpage>
        <lpage>1060</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/bty714</pub-id>
        <pub-id pub-id-type="pmid">30875427</pub-id>
      </element-citation>
    </ref>
    <ref id="CR46">
      <label>46.</label>
      <mixed-citation publication-type="other">starfish. Github; [cited 2019 Jul 8]. Available from: <ext-link ext-link-type="uri" xlink:href="https://github.com/spacetx/starfish">https://github.com/spacetx/starfish</ext-link></mixed-citation>
    </ref>
    <ref id="CR47">
      <label>47.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Nitzan</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Karaiskos</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Friedman</surname>
            <given-names>N</given-names>
          </name>
          <name>
            <surname>Rajewsky</surname>
            <given-names>N</given-names>
          </name>
        </person-group>
        <article-title>Gene expression cartography</article-title>
        <source>Nature.</source>
        <year>2019</year>
        <volume>576</volume>
        <fpage>132</fpage>
        <lpage>137</lpage>
        <pub-id pub-id-type="doi">10.1038/s41586-019-1773-3</pub-id>
        <pub-id pub-id-type="pmid">31748748</pub-id>
      </element-citation>
    </ref>
    <ref id="CR48">
      <label>48.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Stoltzfus</surname>
            <given-names>CR</given-names>
          </name>
          <name>
            <surname>Filipek</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Gern</surname>
            <given-names>BH</given-names>
          </name>
          <name>
            <surname>Olin</surname>
            <given-names>BE</given-names>
          </name>
          <name>
            <surname>Leal</surname>
            <given-names>JM</given-names>
          </name>
          <name>
            <surname>Wu</surname>
            <given-names>Y</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>CytoMAP: a spatial analysis toolbox reveals features of myeloid cell organization in lymphoid tissues</article-title>
        <source>Cell Rep</source>
        <year>2020</year>
        <volume>107523</volume>
        <fpage>31</fpage>
      </element-citation>
    </ref>
    <ref id="CR49">
      <label>49.</label>
      <mixed-citation publication-type="other">Queen R, Cheung K, Lisgo S, Coxhead J, Cockell S. Spaniel: analysis and interactive sharing of Spatial Transcriptomics data. bioRxiv. 2019 [cited 2020 May 27]. p. 619197. Available from: <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/619197v1.abstract">https://www.biorxiv.org/content/10.1101/619197v1.abstract</ext-link></mixed-citation>
    </ref>
    <ref id="CR50">
      <label>50.</label>
      <element-citation publication-type="book">
        <person-group person-group-type="author">
          <name>
            <surname>Wang</surname>
            <given-names>W</given-names>
          </name>
          <name>
            <surname>Zhou</surname>
            <given-names>F</given-names>
          </name>
          <name>
            <surname>Wei</surname>
            <given-names>X</given-names>
          </name>
        </person-group>
        <source>The STViewer, a visual method with sentiment analysis: retrieve information and visualize social media text better. Proceedings of the 2nd International Conference on Computer Science and Software Engineering</source>
        <year>2019</year>
        <publisher-loc>New York</publisher-loc>
        <publisher-name>Association for Computing Machinery</publisher-name>
        <fpage>50</fpage>
        <lpage>56</lpage>
      </element-citation>
    </ref>
    <ref id="CR51">
      <label>51.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Chung</surname>
            <given-names>NC</given-names>
          </name>
          <name>
            <surname>Storey</surname>
            <given-names>JD</given-names>
          </name>
        </person-group>
        <article-title>Statistical significance of variables driving systematic variation in high-dimensional data</article-title>
        <source>Bioinformatics.</source>
        <year>2015</year>
        <volume>31</volume>
        <fpage>545</fpage>
        <lpage>554</lpage>
        <pub-id pub-id-type="doi">10.1093/bioinformatics/btu674</pub-id>
        <pub-id pub-id-type="pmid">25336500</pub-id>
      </element-citation>
    </ref>
    <ref id="CR52">
      <label>52.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Lun</surname>
            <given-names>ATL</given-names>
          </name>
          <name>
            <surname>McCarthy</surname>
            <given-names>DJ</given-names>
          </name>
          <name>
            <surname>Marioni</surname>
            <given-names>JC</given-names>
          </name>
        </person-group>
        <article-title>A step-by-step workflow for low-level analysis of single-cell RNA-seq data with Bioconductor</article-title>
        <source>F1000Res.</source>
        <year>2016</year>
        <volume>5</volume>
        <fpage>2122</fpage>
        <?supplied-pmid 27909575?>
        <pub-id pub-id-type="pmid">27909575</pub-id>
      </element-citation>
    </ref>
    <ref id="CR53">
      <label>53.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Obayashi</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Kinoshita</surname>
            <given-names>K</given-names>
          </name>
        </person-group>
        <article-title>Rank of correlation coefficient as a comparable measure for biological significance of gene coexpression</article-title>
        <source>DNA Res</source>
        <year>2009</year>
        <volume>16</volume>
        <fpage>249</fpage>
        <lpage>260</lpage>
        <pub-id pub-id-type="doi">10.1093/dnares/dsp016</pub-id>
        <pub-id pub-id-type="pmid">19767600</pub-id>
      </element-citation>
    </ref>
    <ref id="CR54">
      <label>54.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Moffat</surname>
            <given-names>A</given-names>
          </name>
          <name>
            <surname>Zobel</surname>
            <given-names>J</given-names>
          </name>
        </person-group>
        <article-title>Rank-biased precision for measurement of retrieval effectiveness</article-title>
        <source>ACM Trans Inf Syst Secur</source>
        <year>2008</year>
        <volume>27</volume>
        <fpage>1</fpage>
        <lpage>27</lpage>
        <pub-id pub-id-type="doi">10.1145/1416950.1416952</pub-id>
      </element-citation>
    </ref>
    <ref id="CR55">
      <label>55.</label>
      <element-citation publication-type="journal">
        <person-group person-group-type="author">
          <name>
            <surname>Ramilowski</surname>
            <given-names>JA</given-names>
          </name>
          <name>
            <surname>Goldberg</surname>
            <given-names>T</given-names>
          </name>
          <name>
            <surname>Harshbarger</surname>
            <given-names>J</given-names>
          </name>
          <name>
            <surname>Kloppmann</surname>
            <given-names>E</given-names>
          </name>
          <name>
            <surname>Lizio</surname>
            <given-names>M</given-names>
          </name>
          <name>
            <surname>Satagopam</surname>
            <given-names>VP</given-names>
          </name>
          <etal/>
        </person-group>
        <article-title>A draft network of ligand–receptor-mediated multicellular signalling in human</article-title>
        <source>Nat Commun</source>
        <year>2015</year>
        <volume>6</volume>
        <fpage>7866</fpage>
        <pub-id pub-id-type="doi">10.1038/ncomms8866</pub-id>
        <pub-id pub-id-type="pmid">26198319</pub-id>
      </element-citation>
    </ref>
    <ref id="CR56">
      <label>56.</label>
      <mixed-citation publication-type="other">Dries R, Zhu Q, Dong R, Eng CHL, Li H, Liu K, Fu Y, Zhao T, Sarkar A, Bao F, George RE, Pierson N, Cai L, Yuan GC. Giotto on Zenodo. Giotto Docker. 2020 [cited 2020 Oct 23]. Available from: <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/4381091">https://zenodo.org/record/4381091</ext-link></mixed-citation>
    </ref>
    <ref id="CR57">
      <label>57.</label>
      <mixed-citation publication-type="other">Dries R, Zhu Q, Dong R, Eng CHL, Li H, Liu K, Fu Y, Zhao T, Sarkar A, Bao F, George RE, Pierson N, Cai L, Yuan GC. Giotto on GitHub. Giotto Analyzer. 2020 [cited 2020 Oct 23]. Available from: <ext-link ext-link-type="uri" xlink:href="https://github.com/RubD/Giotto">https://github.com/RubD/Giotto</ext-link></mixed-citation>
    </ref>
  </ref-list>
</back>
